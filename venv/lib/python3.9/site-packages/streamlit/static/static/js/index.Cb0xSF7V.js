import{r as Et,as as vr,a_ as ht,g as Kf,a$ as lU,b0 as yu,_ as oD,j as Cf,F as uU,s as aD,aD as cD,aK as lD,K as T1,b1 as IE,aA as fU,L as hU,ap as dU,aE as ME,b2 as AU,b3 as PE}from"./index.DvRPFfw6.js";import{_ as os,a as pU,C as gU}from"./toConsumableArray.D9x7Ktv4.js";import{a as Lu,b as Nu,_ as cx,c as sA,d as lx}from"./possibleConstructorReturn.DbvQboK3.js";import{E as uD,w as mU}from"./withFullScreenWrapper.CCOXR7N6.js";import{a as _U,T as yU}from"./Toolbar.B3FquPk5.js";import{u as vU}from"./useBasicWidgetState.CUSYQZpm.js";import{u as bU,s as xU}from"./threshold.DjX0wlsa.js";import"./FormClearHelper.BLEIUk6L.js";import"./value.CgPGBV_l.js";function wU(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function Fm(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const ux=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),RE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);RE&&parseFloat(RE[1]);const Dm=globalThis,Om=globalThis.process||{},CU=globalThis.navigator||{};function fD(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function Kc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||fD()}function TU(t){return Kc()?fD()?"Electron":(CU.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const S_="4.1.0";function EU(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let BU=class{constructor(e,r,n="sessionStorage"){this.storage=EU(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}};function SU(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function IU(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var Lm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Lm||(Lm={}));const MU=10;function FE(t){return typeof t!="string"?t:(t=t.toUpperCase(),Lm[t]||Lm.WHITE)}function PU(t,e,r){return!Kc&&typeof t=="string"&&(e&&(t=`\x1B[${FE(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${FE(r)+MU}m${t}\x1B[49m`)),t}function RU(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(u=>o===u)||(i[o]=s.bind(t)))}}function fx(t,e){if(!t)throw new Error("Assertion failed")}function Kh(){let t;if(Kc()&&Dm.performance)t=Dm?.performance?.now?.();else if("hrtime"in Om){const e=Om?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const qh={debug:Kc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},FU={enabled:!0,level:0};function Yh(){}const DE={},OE={once:!0};let hD=class{constructor({id:e}={id:""}){this.VERSION=S_,this._startTs=Kh(),this._deltaTs=Kh(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new BU(`__probe-${this.id}__`,FU),this.timeStamp(`${this.id} started`),RU(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Kh()-this._startTs).toPrecision(10))}getDelta(){return Number((Kh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,qh.warn,arguments,OE)}error(e){return this._getLogFunction(0,e,qh.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,qh.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,qh.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,qh.debug||qh.info,arguments,OE)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||Yh,n&&[n],{tag:OU(r)}):Yh}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||Yh)}group(e,r,n={collapsed:!1}){const i=LE({logLevel:e,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Yh)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=dD(e)}_getLogFunction(e,r,n,i,o){if(this._shouldLog(e)){o=LE({logLevel:e,message:r,args:i,opts:o}),n=n||o.method,fx(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Kh();const s=o.tag||o.message;if(o.once&&s)if(!DE[s])DE[s]=Kh();else return Yh;return r=DU(this.id,o.message,o),n.bind(console,r,...o.args)}return Yh}};hD.VERSION=S_;function dD(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return fx(Number.isFinite(e)&&e>=0),e}function LE(t){const{logLevel:e,message:r}=t;t.logLevel=dD(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return fx(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function DU(t,e,r){if(typeof e=="string"){const n=r.time?IU(SU(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=PU(e,r.color,r.background)}return e}function OU(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}function LU(t,e){return AD(t||{},e)}function AD(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=AD(n[i]||{},e[i],r+1):n[i]=e[i];return n}const NU="latest";function kU(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const UU=kU();function Su(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Of=typeof process!="object"||String(process)!=="[object process]"||process.browser,zU=typeof window<"u"&&typeof window.orientation<"u",NE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);NE&&parseFloat(NE[1]);let GU=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Su(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Su(this.isRunning),this.isRunning=!1,this._reject(e)}},cv=class{terminate(){}};const lv=new Map;function VU(t){Su(t.source&&!t.url||!t.source&&t.url);let e=lv.get(t.source||t.url);return e||(t.url&&(e=HU(t.url),lv.set(t.url,e)),t.source&&(e=pD(t.source),lv.set(t.source,e))),Su(e),e}function HU(t){if(!t.startsWith("http"))return t;const e=jU(t);return pD(e)}function pD(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function jU(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function gD(t,e=!0,r){const n=r||new Set;if(t){if(kE(t))n.add(t);else if(kE(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)gD(t[i],e,n)}}return r===void 0?Array.from(n):[]}function kE(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const uv=()=>{};let E1=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Of||typeof cv<"u"&&!Of}constructor(e){const{name:r,source:n,url:i}=e;Su(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=uv,this.onError=o=>console.log(o),this.worker=Of?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=uv,this.onError=uv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||gD(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=VU({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new cv(n,{eval:!1})}else if(this.source)e=new cv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}},$U=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return E1.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new GU(r.name,e);e.onMessage=i=>r.onMessage(n,i.type,i.payload),e.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Of||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new E1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return zU?this.maxMobileConcurrency:this.maxConcurrency}};const WU={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};let mD=class Sd{props;workerPools=new Map;static _workerFarm;static isSupported(){return E1.isSupported()}static getWorkerFarm(e={}){return Sd._workerFarm=Sd._workerFarm||new Sd({}),Sd._workerFarm.setProps(e),Sd._workerFarm}constructor(e){this.props={...WU},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let o=this.workerPools.get(r);return o||(o=new $U({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function JU(t,e={}){const r=e[t.id]||{},n=Of?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Of?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let o=t.version;o==="latest"&&(o=NU);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${s}/dist/${n}`}return Su(i),i}function XU(t,e=UU){Su(t,"no worker provided");const r=t.version;return!(!e||!r)}const hu={};function KU(t,e){return!mD.isSupported()||!Of&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function qU(t,e,r,n,i){const o=t.id,s=JU(t,r),d=mD.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const y=await d.startJob("process-on-worker",YU.bind(null,i));return y.postMessage("process",{input:e,options:r,context:n}),await(await y.result).result}async function YU(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const u=await t(o,s);e.postMessage("done",{id:i,result:u})}catch(u){const d=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:i,error:d})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function ZU(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function QU(...t){return e5(t)}function e5(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function t5(t){const e=[];for await(const r of t)e.push(r);return QU(...e)}let r5="";const UE={};function n5(t){for(const e in UE)if(t.startsWith(e)){const r=UE[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${r5}${t}`),t}function i5(t){return t&&typeof t=="object"&&t.isBuffer}function _D(t){if(i5(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function yD(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function s5(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const o5=t=>typeof t=="boolean",Mp=t=>typeof t=="function",ug=t=>t!==null&&typeof t=="object",zE=t=>ug(t)&&t.constructor==={}.constructor,a5=t=>!!t&&typeof t[Symbol.iterator]=="function",c5=t=>t&&typeof t[Symbol.asyncIterator]=="function",qf=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Yf=t=>typeof Blob<"u"&&t instanceof Blob,l5=t=>t&&typeof t=="object"&&t.isBuffer,u5=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||ug(t)&&Mp(t.tee)&&Mp(t.cancel)&&Mp(t.getReader),f5=t=>ug(t)&&Mp(t.read)&&Mp(t.pipe)&&o5(t.readable),vD=t=>u5(t)||f5(t);let h5=class extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};const d5=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,A5=/^([-\w.]+\/[-\w.+]+)/;function GE(t,e){return t.toLowerCase()===e.toLowerCase()}function p5(t){const e=A5.exec(t);return e?e[1]:t}function VE(t){const e=d5.exec(t);return e?e[1]:""}const bD=/\?.*/;function g5(t){const e=t.match(bD);return e&&e[0]}function hx(t){return t.replace(bD,"")}function m5(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function I_(t){return qf(t)?t.url:Yf(t)?t.name||"":typeof t=="string"?t:""}function dx(t){if(qf(t)){const e=t,r=e.headers.get("content-type")||"",n=hx(e.url);return p5(r)||VE(n)}return Yf(t)?t.type||"":typeof t=="string"?VE(t):""}function _5(t){return qf(t)?t.headers["content-length"]||-1:Yf(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function xD(t){if(qf(t))return t;const e={},r=_5(t);r>=0&&(e["content-length"]=String(r));const n=I_(t),i=dx(t);i&&(e["content-type"]=i);const o=await b5(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const s=new Response(t,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function y5(t){if(!t.ok)throw await v5(t)}async function v5(t){const e=m5(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=i?.includes("application/json")?await t.json():t.text()}catch{}return new h5(r,n)}async function b5(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=o=>n(o?.target?.result),i.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${x5(r)}`}return null}function x5(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function w5(t){return!C5(t)&&!T5(t)}function C5(t){return t.startsWith("http:")||t.startsWith("https:")}function T5(t){return t.startsWith("data:")}async function HE(t,e){if(typeof t=="string"){const r=n5(t);return w5(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await xD(t)}const jE=globalThis,$E=globalThis.process||{};function E5(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function Ax(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||E5()}const wD="4.0.7";function B5(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let S5=class{constructor(e,r,n="sessionStorage"){this.storage=B5(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}};function I5(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function M5(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var Nm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Nm||(Nm={}));const P5=10;function WE(t){return typeof t!="string"?t:(t=t.toUpperCase(),Nm[t]||Nm.WHITE)}function R5(t,e,r){return!Ax&&typeof t=="string"&&(e&&(t=`\x1B[${WE(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${WE(r)+P5}m${t}\x1B[49m`)),t}function F5(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(u=>o===u)||(i[o]=s.bind(t)))}}function px(t,e){if(!t)throw new Error("Assertion failed")}function Zh(){let t;if(Ax()&&jE.performance)t=jE?.performance?.now?.();else if("hrtime"in $E){const e=$E?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const Qh={debug:Ax()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},D5={enabled:!0,level:0};function ed(){}const JE={},XE={once:!0};let gx=class{constructor({id:e}={id:""}){this.VERSION=wD,this._startTs=Zh(),this._deltaTs=Zh(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new S5(`__probe-${this.id}__`,D5),this.timeStamp(`${this.id} started`),F5(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Zh()-this._startTs).toPrecision(10))}getDelta(){return Number((Zh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Qh.warn,arguments,XE)}error(e){return this._getLogFunction(0,e,Qh.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,Qh.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,Qh.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,Qh.debug||Qh.info,arguments,XE)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||ed,n&&[n],{tag:L5(r)}):ed}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||ed)}group(e,r,n={collapsed:!1}){const i=KE({logLevel:e,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ed)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=CD(e)}_getLogFunction(e,r,n,i,o){if(this._shouldLog(e)){o=KE({logLevel:e,message:r,args:i,opts:o}),n=n||o.method,px(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Zh();const s=o.tag||o.message;if(o.once&&s)if(!JE[s])JE[s]=Zh();else return ed;return r=O5(this.id,o.message,o),n.bind(console,r,...o.args)}return ed}};gx.VERSION=wD;function CD(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return px(Number.isFinite(e)&&e>=0),e}function KE(t){const{logLevel:e,message:r}=t;t.logLevel=CD(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return px(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function O5(t,e,r){if(typeof e=="string"){const n=r.time?M5(I5(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=R5(e,r.color,r.background)}return e}function L5(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const qE=new gx({id:"loaders.gl"});let N5=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},k5=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};const TD={fetch:null,mimeType:void 0,nothrow:!1,log:new k5,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ux,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},U5={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function ED(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function BD(){const t=ED();return t.globalOptions=t.globalOptions||{...TD},t.globalOptions}function z5(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],G5(t,r),H5(e,t,n)}function G5(t,e){YE(t,null,TD,U5,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};YE(n,r.id,i,o,e)}}function YE(t,e,r,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const u in t){const d=!e&&ug(t[u]),y=u==="baseUri"&&!e,x=u==="workerUrl"&&e;if(!(u in r)&&!y&&!x){if(u in n)qE.warn(`${o} loader option '${s}${u}' no longer supported, use '${n[u]}'`)();else if(!d){const E=V5(u,i);qE.warn(`${o} loader option '${s}${u}' not recognized. ${E}`)()}}}}function V5(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(t===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function H5(t,e,r){const i={...t.options||{}};return j5(i,r),i.log===null&&(i.log=new N5),ZE(i,BD()),ZE(i,e),i}function ZE(t,e){for(const r in e)if(r in e){const n=e[r];zE(n)&&zE(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function j5(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function mx(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function _x(t){Fm(t,"null loader"),Fm(mx(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const SD=()=>{const t=ED();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function $5(t){const e=SD();t=Array.isArray(t)?t:[t];for(const r of t){const n=_x(r);e.find(i=>n===i)||e.unshift(n)}}function W5(){return SD()}const J5=new gx({id:"loaders.gl"}),X5=/\.([^.]+)$/;async function K5(t,e=[],r,n){if(!ID(t))return null;let i=QE(t,e,{...r,nothrow:!0},n);if(i)return i;if(Yf(t)&&(t=await t.slice(0,10).arrayBuffer(),i=QE(t,e,r,n)),!i&&!r?.nothrow)throw new Error(MD(t));return i}function QE(t,e=[],r,n){if(!ID(t))return null;if(e&&!Array.isArray(e))return _x(e);let i=[];e&&(i=i.concat(e)),r?.ignoreRegisteredLoaders||i.push(...W5()),Y5(i);const o=q5(t,i,r,n);if(!o&&!r?.nothrow)throw new Error(MD(t));return o}function q5(t,e,r,n){const i=I_(t),o=dx(t),s=hx(i)||n?.url;let u=null,d="";return r?.mimeType&&(u=fv(e,r?.mimeType),d=`match forced by supplied MIME type ${r?.mimeType}`),u=u||Z5(e,s),d=d||(u?`matched url ${s}`:""),u=u||fv(e,o),d=d||(u?`matched MIME type ${o}`:""),u=u||ez(e,t),d=d||(u?`matched initial data ${PD(t)}`:""),r?.fallbackMimeType&&(u=u||fv(e,r?.fallbackMimeType),d=d||(u?`matched fallback MIME type ${o}`:"")),d&&J5.log(1,`selectLoader selected ${u?.name}: ${d}.`),u}function ID(t){return!(t instanceof Response&&t.status===204)}function MD(t){const e=I_(t),r=dx(t);let n="No valid loader found (";n+=e?`${yD(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?PD(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function Y5(t){for(const e of t)_x(e)}function Z5(t,e){const r=e&&X5.exec(e),n=r&&r[1];return n?Q5(t,n):null}function Q5(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function fv(t,e){for(const r of t)if(r.mimeTypes?.some(n=>GE(e,n))||GE(e,`application/x.${r.id}`))return r;return null}function ez(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(tz(e,r))return r}else if(ArrayBuffer.isView(e)){if(eB(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&eB(e,0,r))return r;return null}function tz(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function eB(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>rz(t,e,r,i))}function rz(t,e,r,n){if(n instanceof ArrayBuffer)return ZU(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=B1(t,e,n.length);return n===i;default:return!1}}function PD(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?B1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?B1(t,0,e):""}function B1(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const nz=256*1024;function*iz(t,e){const r=e?.chunkSize||nz;let n=0;const i=new TextEncoder;for(;n<t.length;){const o=Math.min(t.length-n,r),s=t.slice(n,n+o);n+=o,yield i.encode(s)}}const sz=256*1024;function*oz(t,e={}){const{chunkSize:r=sz}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(t,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const az=1024*1024;async function*cz(t,e){const r=e?.chunkSize||az;let n=0;for(;n<t.size;){const i=n+r,o=await t.slice(n,i).arrayBuffer();n=i,yield o}}function tB(t,e){return ux?lz(t,e):uz(t)}async function*lz(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e?._streamReadAhead&&(n=r.read());const{done:o,value:s}=await i;if(o)return;yield _D(s)}}catch{r.releaseLock()}}async function*uz(t,e){for await(const r of t)yield _D(r)}function fz(t,e){if(typeof t=="string")return iz(t,e);if(t instanceof ArrayBuffer)return oz(t,e);if(Yf(t))return cz(t,e);if(vD(t))return tB(t,e);if(qf(t))return tB(t.body,e);throw new Error("makeIterator")}const RD="Cannot convert supplied data type";function hz(t,e,r){if(e.text&&typeof t=="string")return t;if(l5(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(RD)}async function dz(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return hz(t,e);if(Yf(t)&&(t=await xD(t)),qf(t)){const i=t;return await y5(i),e.binary?await i.arrayBuffer():await i.text()}if(vD(t)&&(t=fz(t,r)),a5(t)||c5(t))return t5(t);throw new Error(RD)}function FD(t,e){const r=BD(),n=t||r;return typeof n.fetch=="function"?n.fetch:ug(n.fetch)?i=>HE(i,n.fetch):e?.fetch?e?.fetch:HE}function Az(t,e,r){if(r)return r;const n={fetch:FD(e,t),...t};if(n.url){const i=hx(n.url);n.baseUrl=i,n.queryString=g5(n.url),n.filename=yD(i),n.baseUrl=s5(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function pz(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function km(t,e,r,n){e&&!Array.isArray(e)&&!mx(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=I_(t),s=pz(e,n),u=await K5(t,s,r);return u?(r=z5(r,u,s,i),n=Az({url:i,_parse:km,loaders:s},r,n||null),await gz(u,t,r,n)):null}async function gz(t,e,r,n){if(XU(t),r=LU(t.options,r),qf(e)){const o=e,{ok:s,redirected:u,status:d,statusText:y,type:x,url:E}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:u,status:d,statusText:y,type:x,url:E}}e=await dz(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(KU(t,r))return await qU(t,e,r,n,km);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw Su(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function S1(t,e,r,n){let i,o;!Array.isArray(e)&&!mx(e)?(i=[],o=e):(i=e,o=r);const s=FD(o);let u=t;return typeof t=="string"&&(u=await s(t)),Yf(t)&&(u=await s(t)),Array.isArray(i)?await km(u,i,o):await km(u,i,o)}const mz="4.2.4",_z=globalThis.loaders?.parseImageNode,I1=typeof Image<"u",M1=typeof ImageBitmap<"u",yz=!!_z,P1=ux?!0:yz;function vz(t){switch(t){case"auto":return M1||I1||P1;case"imagebitmap":return M1;case"image":return I1;case"data":return P1;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function bz(){if(M1)return"imagebitmap";if(I1)return"image";if(P1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function xz(t){const e=Cz(t);if(!e)throw new Error("Not an image");return e}function wz(t){switch(xz(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Cz(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Tz=/^data:image\/svg\+xml/,Ez=/\.svg((\?|#).*)?$/;function yx(t){return t&&(Tz.test(t)||Ez.test(t))}function Bz(t,e){if(yx(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return DD(t,e)}function DD(t,e){if(yx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function OD(t,e,r){const n=Bz(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await Sz(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function Sz(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const Iz={};let rB=!0;async function Mz(t,e,r){let n;yx(r)?n=await OD(t,e,r):n=DD(t,r);const i=e&&e.imagebitmap;return await Pz(n,i)}async function Pz(t,e=null){if((Rz(e)||!rB)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),rB=!1}return await createImageBitmap(t)}function Rz(t){for(const e in t||Iz)return!1;return!0}function Fz(t){return!Nz(t,"ftyp",4)||(t[8]&96)===0?null:Dz(t)}function Dz(t){switch(Oz(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Oz(t,e,r){return String.fromCharCode(...t.slice(e,r))}function Lz(t){return[...t].map(e=>e.charCodeAt(0))}function Nz(t,e,r=0){const n=Lz(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const Uc=!1,Pp=!0;function LD(t){const e=fg(t);return Uz(e)||Vz(e)||zz(e)||Gz(e)||kz(e)}function kz(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=Fz(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function Uz(t){const e=fg(t);return e.byteLength>=24&&e.getUint32(0,Uc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Uc),height:e.getUint32(20,Uc)}:null}function zz(t){const e=fg(t);return e.byteLength>=10&&e.getUint32(0,Uc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Pp),height:e.getUint16(8,Pp)}:null}function Gz(t){const e=fg(t);return e.byteLength>=14&&e.getUint16(0,Uc)===16973&&e.getUint32(2,Pp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Pp),height:e.getUint32(22,Pp)}:null}function Vz(t){const e=fg(t);if(!(e.byteLength>=3&&e.getUint16(0,Uc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=Hz();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,Uc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Uc),width:e.getUint16(o+7,Uc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,Uc)}return null}function Hz(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function fg(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function jz(t,e){const{mimeType:r}=LD(t)||{},n=globalThis.loaders?.parseImageNode;return Fm(n),await n(t,r)}async function $z(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=r||{},s=Wz(i);let u;switch(s){case"imagebitmap":u=await Mz(t,e,o);break;case"image":u=await OD(t,e,o);break;case"data":u=await jz(t);break;default:Fm(!1)}return i==="data"&&(u=wz(u)),u}function Wz(t){switch(t){case"auto":case"data":return bz();default:return vz(t),t}}const Jz=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Xz=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Kz={image:{type:"auto",decode:!0}},qz={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:mz,mimeTypes:Xz,extensions:Jz,parse:$z,tests:[t=>!!LD(new DataView(t))],options:Kz},Wr=new hD({id:"deck"});let R1={};function Yz(t){R1=t}function to(t,e,r,n){Wr.level>0&&R1[t]&&R1[t].call(null,e,r,n)}function Zz(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const Qz={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Zz,parseTextSync:JSON.parse};function eG(){const t="9.1.13",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Wr.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Wr,_registerLoggers:Yz},$5([Qz,[qz,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const tG=eG();function vx(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const hv={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function rG(t){const e={};for(const[r,n]of Object.entries(t))e[r]=nG(n);return e}function nG(t){let e=nB(t);if(e!=="object")return{value:t,...hv[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...hv[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=nB(t.value),{...t,...hv[e],type:e}):{type:"object",value:null};throw new Error("props")}function nB(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const iG=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,sG=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,oG={vertex:iG,fragment:sG},iB=/void\s+main\s*\([^)]*\)\s*\{\n?/,sB=/}\n?[^{}]*$/,dv=[],um="__LUMA_INJECT_DECLARATIONS__";function aG(t){const e={vertex:{},fragment:{}};for(const r in t){let n=t[r];const i=cG(r);typeof n=="string"&&(n={order:0,injection:n}),e[i][r]=n}return e}function cG(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Um(t,e,r,n=!1){const i=e==="vertex";for(const o in r){const s=r[o];s.sort((d,y)=>d.order-y.order),dv.length=s.length;for(let d=0,y=s.length;d<y;++d)dv[d]=s[d].injection;const u=`${dv.join(`
`)}
`;switch(o){case"vs:#decl":i&&(t=t.replace(um,u));break;case"vs:#main-start":i&&(t=t.replace(iB,d=>d+u));break;case"vs:#main-end":i&&(t=t.replace(sB,d=>u+d));break;case"fs:#decl":i||(t=t.replace(um,u));break;case"fs:#main-start":i||(t=t.replace(iB,d=>d+u));break;case"fs:#main-end":i||(t=t.replace(sB,d=>u+d));break;default:t=t.replace(o,d=>d+u)}}return t=t.replace(um,""),n&&(t=t.replace(/\}\s*$/,o=>o+oG[e])),t}function zm(t){t.map(e=>ND(e))}function ND(t){if(t.instance)return;zm(t.dependencies||[]);const{propTypes:e={},deprecations:r=[],inject:n={}}=t,i={normalizedInjections:aG(n),parsedDeprecations:lG(r)};e&&(i.propValidators=rG(e)),t.instance=i;let o={};e&&(o=Object.entries(e).reduce((s,[u,d])=>{const y=d?.value;return y&&(s[u]=y),s},{})),t.defaultUniforms={...t.defaultUniforms,...o}}function kD(t,e,r){t.deprecations?.forEach(n=>{n.regex?.test(e)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function lG(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function bx(t){zm(t);const e={},r={};UD({modules:t,level:0,moduleMap:e,moduleDepth:r});const n=Object.keys(r).sort((i,o)=>r[o]-r[i]).map(i=>e[i]);return zm(n),n}function UD(t){const{modules:e,level:r,moduleMap:n,moduleDepth:i}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(i[o.name]===void 0||i[o.name]<r)&&(i[o.name]=r);for(const o of e)o.dependencies&&UD({modules:o.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function uG(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function fG(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=oB(t,hG),t;case"fragment":return t=oB(t,dG),t;default:throw new Error(e)}}const zD=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],hG=[...zD,[F1("attribute"),"in $1"],[F1("varying"),"out $1"]],dG=[...zD,[F1("varying"),"in $1"]];function oB(t,e){for(const[r,n]of e)t=t.replace(r,n);return t}function F1(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function GD(t,e){let r="";for(const n in t){const i=t[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),e[n]){const o=e[n];o.sort((s,u)=>s.order-u.order);for(const s of o)r+=`  ${s.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function VD(t){const e={vertex:{},fragment:{}};for(const r of t){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();const[o,s]=i.split(":"),u=i.replace(/\(.+/,""),d=Object.assign(n,{signature:s});switch(o){case"vs":e.vertex[u]=d;break;case"fs":e.fragment[u]=d;break;default:throw new Error(o)}}return e}function AG(t,e){return{name:pG(t,e),language:"glsl",version:gG(t)}}function pG(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function gG(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const HD=`

${um}
`,mG=`precision highp float;
`;function _G(t){const e=bx(t.modules||[]);return{source:vG(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:jD(e)}}function yG(t){const{vs:e,fs:r}=t,n=bx(t.modules||[]);return{vs:aB(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:aB(t.platformInfo,{...t,source:r,stage:"fragment",modules:n}),getUniforms:jD(n)}}function vG(t,e){const{source:r,stage:n,modules:i,hookFunctions:o=[],inject:s={},log:u}=e;vx(typeof r=="string","shader source must be a string");const d=r;let y="";const x=VD(o),E={},S={},O={};for(const U in s){const J=typeof s[U]=="string"?{injection:s[U],order:0}:s[U],G=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(G){const H=G[2],K=G[3];H?K==="decl"?S[U]=[J]:O[U]=[J]:E[U]=[J]}else O[U]=[J]}const k=i;for(const U of k){u&&kD(U,d,u);const J=$D(U,"wgsl");y+=J;const G=U.injections?.[n]||{};for(const H in G){const K=/^(v|f)s:#([\w-]+)$/.exec(H);if(K){const Y=K[2]==="decl"?S:O;Y[H]=Y[H]||[],Y[H].push(G[H])}else E[H]=E[H]||[],E[H].push(G[H])}}return y+=HD,y=Um(y,n,S),y+=GD(x[n],E),y+=d,y=Um(y,n,O),y}function aB(t,e){const{id:r,source:n,stage:i,language:o="glsl",modules:s,defines:u={},hookFunctions:d=[],inject:y={},prologue:x=!0,log:E}=e;vx(typeof n=="string","shader source must be a string");const S=o==="glsl"?AG(n).version:-1,O=t.shaderLanguageVersion,k=S===100?"#version 100":"#version 300 es",J=n.split(`
`).slice(1).join(`
`),G={};s.forEach(Ee=>{Object.assign(G,Ee.defines)}),Object.assign(G,u);let H="";switch(o){case"wgsl":break;case"glsl":H=x?`${k}

// ----- PROLOGUE -------------------------
${bG({id:r,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${uG(t)}
${i==="fragment"?mG:""}

// ----- APPLICATION DEFINES -------------------------

${xG(G)}

`:`${k}
`;break}const K=VD(d),he={},Y={},oe={};for(const Ee in y){const ze=typeof y[Ee]=="string"?{injection:y[Ee],order:0}:y[Ee],de=/^(v|f)s:(#)?([\w-]+)$/.exec(Ee);if(de){const ve=de[2],Ae=de[3];ve?Ae==="decl"?Y[Ee]=[ze]:oe[Ee]=[ze]:he[Ee]=[ze]}else oe[Ee]=[ze]}for(const Ee of s){E&&kD(Ee,J,E);const ze=$D(Ee,i);H+=ze;const de=Ee.instance?.normalizedInjections[i]||{};for(const ve in de){const Ae=/^(v|f)s:#([\w-]+)$/.exec(ve);if(Ae){const re=Ae[2]==="decl"?Y:oe;re[ve]=re[ve]||[],re[ve].push(de[ve])}else he[ve]=he[ve]||[],he[ve].push(de[ve])}}return H+="// ----- MAIN SHADER SOURCE -------------------------",H+=HD,H=Um(H,i,Y),H+=GD(K[i],he),H+=J,H=Um(H,i,oe),o==="glsl"&&S!==O&&(H=fG(H,i)),H.trim()}function jD(t){return function(r){const n={};for(const i of t){const o=i.getUniforms?.(r,n);Object.assign(n,o)}return n}}function bG(t){const{id:e,source:r,stage:n}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function xG(t={}){let e="";for(const r in t){const n=t[r];(n||Number.isFinite(n))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function $D(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:vx(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}const wG=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,CG=/^\s*\#\s*endif\s*$/;function TG(t,e){const r=t.split(`
`),n=[];let i=!0,o=null;for(const s of r){const u=s.match(wG),d=s.match(CG);u?(o=u[1],i=!!e?.defines?.[o]):d?i=!0:i&&n.push(s)}return n.join(`
`)}class If{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return If.defaultShaderAssembler=If.defaultShaderAssembler||new If,If.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const r=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:o}=_G({...e,source:e.source,modules:r,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?TG(i):i,getUniforms:o,modules:r}}assembleGLSLShaderPair(e){const r=this._getModuleList(e.modules),n=this._hookFunctions;return{...yG({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let o=0,s=this._defaultModules.length;o<s;++o){const u=this._defaultModules[o],d=u.name;r[i++]=u,n[d]=!0}for(let o=0,s=e.length;o<s;++o){const u=e[o],d=u.name;n[d]||(r[i++]=u,n[d]=!0)}return r.length=i,zm(r),r}}const EG=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,BG=`#version 300 es
${EG}`;function WD(t){const{input:e,inputChannels:r,output:n}=t||{};if(!e)return BG;if(!r)throw new Error("inputChannels");const i=SG(r),o=IG(e,r);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function SG(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function IG(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}function cB(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let lB=class{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=cB(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(cB()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},MG=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof lB?i=e:i=new lB(r,n),this.stats[r]=i),i}};class PG{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new MG({id:e})),this.stats.get(e)}}const JD=new PG;function RG(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}let FG=class{constructor(e,r,n="sessionStorage"){this.storage=RG(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}};function DG(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function OG(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var Gm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Gm||(Gm={}));const LG=10;function uB(t){return typeof t!="string"?t:(t=t.toUpperCase(),Gm[t]||Gm.WHITE)}function NG(t,e,r){return!Kc&&typeof t=="string"&&(e&&(t=`\x1B[${uB(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${uB(r)+LG}m${t}\x1B[49m`)),t}function kG(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(u=>o===u)||(i[o]=s.bind(t)))}}function xx(t,e){if(!t)throw new Error("Assertion failed")}function td(){let t;if(Kc()&&Dm.performance)t=Dm?.performance?.now?.();else if("hrtime"in Om){const e=Om?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const rd={debug:Kc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},UG={enabled:!0,level:0};function nd(){}const fB={},hB={once:!0};let XD=class{constructor({id:e}={id:""}){this.VERSION=S_,this._startTs=td(),this._deltaTs=td(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new FG(`__probe-${this.id}__`,UG),this.timeStamp(`${this.id} started`),kG(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((td()-this._startTs).toPrecision(10))}getDelta(){return Number((td()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,rd.warn,arguments,hB)}error(e){return this._getLogFunction(0,e,rd.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,rd.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,rd.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,rd.debug||rd.info,arguments,hB)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||nd,n&&[n],{tag:GG(r)}):nd}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||nd)}group(e,r,n={collapsed:!1}){const i=dB({logLevel:e,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||nd)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=KD(e)}_getLogFunction(e,r,n,i,o){if(this._shouldLog(e)){o=dB({logLevel:e,message:r,args:i,opts:o}),n=n||o.method,xx(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=td();const s=o.tag||o.message;if(o.once&&s)if(!fB[s])fB[s]=td();else return nd;return r=zG(this.id,o.message,o),n.bind(console,r,...o.args)}return nd}};XD.VERSION=S_;function KD(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return xx(Number.isFinite(e)&&e>=0),e}function dB(t){const{logLevel:e,message:r}=t;t.logLevel=KD(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return xx(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function zG(t,e,r){if(typeof e=="string"){const n=r.time?OG(DG(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=NG(e,r.color,r.background)}return e}function GG(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const Xt=new XD({id:"luma.gl"}),Av={};function M_(t="id"){Av[t]=Av[t]||1;const e=Av[t]++;return`${t}-${e}`}let li=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,r,n){if(!e)throw new Error("no device");this._device=e,this.props=VG(r,n);const i=this.props.id!=="undefined"?this.props.id:M_(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}};function VG(t,e){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}let Li=class fm extends li{static defaultProps={...li.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){const n={...r};(r.usage||0)&fm.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,fm.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,n){const i=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:n,fm.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(o):r===0&&n===i.byteLength?this.debugData=i.slice(0,o):this.debugData=i.slice(r,r+o)}};function qD(t){const e=AB[t],r=HG(e),n=t.includes("norm"),i=!n&&!t.startsWith("float"),o=t.startsWith("s");return{dataType:AB[t],byteLength:r,integer:i,signed:o,normalized:n}}function HG(t){return jG[t]}const AB={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},jG={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Zs="texture-compression-bc",oi="texture-compression-astc",Dc="texture-compression-etc2",$G="texture-compression-etc1-webgl",u0="texture-compression-pvrtc-webgl",pv="texture-compression-atc-webgl",f0="float32-renderable-webgl",gv="float16-renderable-webgl",WG="rgb9e5ufloat-renderable-webgl",mv="snorm8-renderable-webgl",lp="norm16-renderable-webgl",_v="snorm16-renderable-webgl",h0="float32-filterable",pB="float16-filterable-webgl";function YD(t){const e=JG[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const JG={r8unorm:{},r8snorm:{render:mv},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:mv},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:gv,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:lp},"r16snorm-webgl":{f:_v},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:mv},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:gv,filter:pB},"rg16unorm-webgl":{render:lp},"rg16snorm-webgl":{render:_v},r32uint:{},r32sint:{},r32float:{render:f0,filter:h0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:WG},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:f0},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:lp},"rgb16snorm-webgl":{f:lp},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:h0},rgba16uint:{},rgba16sint:{},rgba16float:{render:gv,filter:pB},"rgba16unorm-webgl":{render:lp},"rgba16snorm-webgl":{render:_v},"rgb32float-webgl":{render:f0,filter:h0},rgba32uint:{},rgba32sint:{},rgba32float:{render:f0,filter:h0},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Zs},"bc1-rgb-unorm-srgb-webgl":{f:Zs},"bc1-rgba-unorm":{f:Zs},"bc1-rgba-unorm-srgb":{f:Zs},"bc2-rgba-unorm":{f:Zs},"bc2-rgba-unorm-srgb":{f:Zs},"bc3-rgba-unorm":{f:Zs},"bc3-rgba-unorm-srgb":{f:Zs},"bc4-r-unorm":{f:Zs},"bc4-r-snorm":{f:Zs},"bc5-rg-unorm":{f:Zs},"bc5-rg-snorm":{f:Zs},"bc6h-rgb-ufloat":{f:Zs},"bc6h-rgb-float":{f:Zs},"bc7-rgba-unorm":{f:Zs},"bc7-rgba-unorm-srgb":{f:Zs},"etc2-rgb8unorm":{f:Dc},"etc2-rgb8unorm-srgb":{f:Dc},"etc2-rgb8a1unorm":{f:Dc},"etc2-rgb8a1unorm-srgb":{f:Dc},"etc2-rgba8unorm":{f:Dc},"etc2-rgba8unorm-srgb":{f:Dc},"eac-r11unorm":{f:Dc},"eac-r11snorm":{f:Dc},"eac-rg11unorm":{f:Dc},"eac-rg11snorm":{f:Dc},"astc-4x4-unorm":{f:oi},"astc-4x4-unorm-srgb":{f:oi},"astc-5x4-unorm":{f:oi},"astc-5x4-unorm-srgb":{f:oi},"astc-5x5-unorm":{f:oi},"astc-5x5-unorm-srgb":{f:oi},"astc-6x5-unorm":{f:oi},"astc-6x5-unorm-srgb":{f:oi},"astc-6x6-unorm":{f:oi},"astc-6x6-unorm-srgb":{f:oi},"astc-8x5-unorm":{f:oi},"astc-8x5-unorm-srgb":{f:oi},"astc-8x6-unorm":{f:oi},"astc-8x6-unorm-srgb":{f:oi},"astc-8x8-unorm":{f:oi},"astc-8x8-unorm-srgb":{f:oi},"astc-10x5-unorm":{f:oi},"astc-10x5-unorm-srgb":{f:oi},"astc-10x6-unorm":{f:oi},"astc-10x6-unorm-srgb":{f:oi},"astc-10x8-unorm":{f:oi},"astc-10x8-unorm-srgb":{f:oi},"astc-10x10-unorm":{f:oi},"astc-10x10-unorm-srgb":{f:oi},"astc-12x10-unorm":{f:oi},"astc-12x10-unorm-srgb":{f:oi},"astc-12x12-unorm":{f:oi},"astc-12x12-unorm-srgb":{f:oi},"pvrtc-rgb4unorm-webgl":{f:u0},"pvrtc-rgba4unorm-webgl":{f:u0},"pvrtc-rbg2unorm-webgl":{f:u0},"pvrtc-rgba2unorm-webgl":{f:u0},"etc1-rbg-unorm-webgl":{f:$G},"atc-rgb-unorm-webgl":{f:pv},"atc-rgba-unorm-webgl":{f:pv},"atc-rgbai-unorm-webgl":{f:pv}},XG=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],KG=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function ZD(t){return XG.some(e=>t.startsWith(e))}function wx(t){let e=qG(t);if(ZD(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=YG(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const r=KG.exec(t);if(r){const[,n,i,o,s,u]=r,d=`${o}${i}`,y=qD(d),x=y.byteLength*8,E=n.length,S=[x,E>=2?x:0,E>=3?x:0,E>=4?x:0];e={format:t,attachment:e.attachment,dataType:y.dataType,components:E,channels:n,integer:y.integer,signed:y.signed,normalized:y.normalized,bitsPerChannel:S,bytesPerPixel:y.byteLength*n.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),s==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function qG(t){const e=YD(t),r=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function YG(t){const r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){const[,n,i]=r;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function ZG(t){const e=YD(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=wx(t),i=t.startsWith("depth")||t.startsWith("stencil"),o=n?.signed,s=n?.integer,u=n?.webgl;return r.render&&=!o,r.filter&&=!i&&!o&&!s&&!u,r}class QG{}class e7{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Tu{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Xt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Xt.get("debug")||void 0,debugShaders:Xt.get("debug-shaders")||void 0,debugFramebuffers:!!Xt.get("debug-framebuffers"),debugWebGL:!!Xt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Tu.defaultProps,...e},this.id=this.props.id||M_(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=JD;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const r=ZG(e),n=s=>(typeof s=="string"?this.features.has(s):s)??!0,i=n(r.create),o={format:e,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return ZD(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&Li.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Xt.warn("indices buffer content must be of integer type")()),r}}const t7=Kc()&&typeof document<"u",r7=()=>t7&&document.readyState==="complete",n7="set luma.log.level=1 (or higher) to trace rendering",gB="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Fd{static defaultProps={...Tu.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=i7().then(()=>{Xt.probe(2,"DOM is loaded")()});stats=JD;log=Xt;VERSION="9.1.5";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Xt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Xt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Xt.error("This version of luma.gl has already been initialized")()}Xt.log(1,`${this.VERSION} - ${n7}`)(),globalThis.luma=this}registerAdapters(e){for(const r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){const r=this.getAdapterMap(e);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapter(e=[]){const r=this.getAdapterMap(e);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(Fd.defaultProps,e)}async createDevice(e={}){e={...Fd.defaultProps,...e},e.waitForPageLoad&&await Fd.pageLoaded;const r=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const s=await(this.getAdapterMap(e.adapters)||r).get(n)?.create?.(e);if(s)return s;throw new Error(gB)}async attachDevice(e){const r=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Fd.pageLoaded,e.handle===null&&(n="unknown");const o=await r.get(n)?.attach?.(null);if(o)return o;throw new Error(gB)}enforceWebGL2(e=!0,r=[]){const i=this.getAdapterMap(r).get("webgl");i||Xt.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const r=new Map(this.preregisteredAdapters);for(const n of e)r.set(n.type,n);return r}registerDevices(e){Xt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const r of e){const n=r.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}}const D1=new Fd;function i7(){return r7()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class s7{}class Cx{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Cx.defaultProps,...e},e=this.props,!Kc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=a7(e.canvas):this.canvas=e.canvas;else{const r=c7(e),n=o7(e?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){const n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return l7(e,n,i,o,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,i="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Xt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==e){let s=e;const u=Math.floor(n*s),d=Math.floor(i*s);if(this.htmlCanvas.width=u,this.htmlCanvas.height=d,this.device.gl){const[x,E]=this.getDrawingBufferSize();(x!==u||E!==d)&&(s=Math.min(x/n,E/i),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(i*s),Xt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function o7(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function a7(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function c7(t){const{width:e,height:r}=t,n=document.createElement("canvas");return n.id=M_("lumagl-auto-created-canvas"),n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function l7(t,e,r,n,i){const o=t,s=mB(o[0],e,r);let u=_B(o[1],e,n,i),d=mB(o[0]+1,e,r);const y=d===r-1?d:d-1;d=_B(o[1]+1,e,n,i);let x;return i?(d=d===0?d:d+1,x=u,u=d):x=d===n-1?d:d-1,{x:s,y:u,width:Math.max(y-s+1,1),height:Math.max(x-u+1,1)}}function mB(t,e,r){return Math.min(Math.round(t*e),r-1)}function _B(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class Yn extends li{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...li.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,r){if(r=Yn.normalizeProps(e,r),super(e,r,Yn.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const n=Yn.getTextureDataSize(this.props.data);this.width=n?.width||1,this.height=n?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Yn.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const r=e?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return Yn.getTextureDataSize(e[0]);if(Yn.isExternalImage(e))return Yn.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const n=Object.values(e)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,r){let n;return ArrayBuffer.isView(e)?n=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?n=e:n=[e],n}static getMipLevelCount(e,r){return Math.floor(Math.log2(Math.max(e,r)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,r){const n={...r},i=e?.props?._resourceDefaults?.texture||{};Object.assign(n,i);const{width:o,height:s}=n;return typeof o=="number"&&(n.width=Math.max(1,Math.ceil(o))),typeof s=="number"&&(n.height=Math.max(1,Math.ceil(s))),n}}class P_ extends li{static defaultProps={...li.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,P_.defaultProps)}}function u7(t,e,r){let n="";const i=e.split(/\r?\n/),o=t.slice().sort((s,u)=>s.lineNum-u.lineNum);switch(r?.showSourceCode||"no"){case"all":let s=0;for(let u=1;u<=i.length;u++)for(n+=QD(i[u-1],u,r);o.length>s&&o[s].lineNum===u;){const d=o[s++];n+=yB(d,i,d.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const u of t)n+=yB(u,i,u.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function yB(t,e,r,n){if(n?.inlineSource){const o=f7(e,r),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${s}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function f7(t,e,r){let n="";for(let i=e-2;i<=e;i++){const o=t[i-1];o!==void 0&&(n+=QD(o,e,r))}return n}function QD(t,e,r){const n=r?.html?d7(t):t;return`${h7(String(e),4)}: ${n}${r?.html?"<br/>":`
`}`}function h7(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}function d7(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class R_ extends li{static defaultProps={...li.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:A7(r),...r},R_.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const r=eO(this.source),n=`${this.stage} ${r}`;let i=u7(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const s=document.createElement("Button");s.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),s.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}}function A7(t){return eO(t.source)||t.id||M_(`unnamed ${t.stage}-shader`)}function eO(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}class Jp extends li{static defaultProps={...li.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=Jp.normalizeProps(e,r),super(e,r,Jp.defaultProps)}static normalizeProps(e,r){const n=e?.props?._resourceDefaults?.sampler||{};return{...r,...n}}}class F_ extends li{static defaultProps={...li.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,F_.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const r=this.colorAttachments.map(i=>i.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(e){let r=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];r=r||i!==this.height||n!==this.width,this.width=n,this.height=i}r&&(Xt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){const i=this.createColorTexture(r,n);return this.attachResource(i),i.view}return r instanceof Yn?r.view:r});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof Yn?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Yn.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Yn.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}}class oA extends li{static defaultProps={...li.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,oA.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Ef extends li{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...li.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ef.defaultClearColor,clearColors:void 0,clearDepth:Ef.defaultClearDepth,clearStencil:Ef.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=Ef.normalizeProps(e,r),super(e,r,Ef.defaultProps)}static normalizeProps(e,r){return{...e.props._resourceDefaults?.renderPass,...r}}}class Vm extends li{static defaultProps={...li.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,Vm.defaultProps),this.shaderLayout=r.shaderLayout}}class Tx extends li{static defaultProps={...li.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,Tx.defaultProps)}}class Ex extends li{static defaultProps={...li.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,Ex.defaultProps)}}function p7(t){const[e,r]=m7[t],n=e==="i32"||e==="u32",i=e!=="u32",o=_7[e]*r,s=g7(e,r);return{dataType:e,components:r,defaultVertexFormat:s,byteLength:o,integer:n,signed:i}}function g7(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const m7={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},_7={f32:4,f16:2,i32:4,u32:4};function tO(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),i=r,o=n?parseInt(n):1,s=qD(i),u={type:i,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(u.webglOnly=!0),u}function rO(t,e){const r={};for(const n of t.attributes){const i=v7(t,e,n.name);i&&(r[n.name]=i)}return r}function y7(t,e,r=16){const n=rO(t,e),i=new Array(r).fill(null);for(const o of Object.values(n))i[o.location]=o;return i}function v7(t,e,r){const n=b7(t,r),i=x7(e,r);if(!n)return null;const o=p7(n.type),s=i?.vertexFormat||o.defaultVertexFormat,u=tO(s);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:o.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function b7(t,e){const r=t.attributes.find(n=>n.name===e);return r||Xt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function x7(t,e){w7(t);let r=C7(t,e);return r||(r=T7(t,e),r)?r:(Xt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function w7(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Xt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function C7(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function T7(t,e){for(const r of t){let n=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const s=tO(o.format);n+=s.byteLength}const i=r.attributes?.find(o=>o.attribute===e);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}class Bx extends li{static defaultProps={...li.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,Bx.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:i}=r.renderPipeline||{};if(!n||!i)throw new Error("VertexArray");this.attributeInfos=y7(n,i,this.maxVertexAttributes)}setConstantWebGL(e,r){this.device.reportError(new Error("constant attributes not supported"))}}class Sx extends li{static defaultProps={...li.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,Sx.defaultProps)}}class Ix extends li{static defaultProps={...li.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,Ix.defaultProps)}}const E7={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function B7(t){return E7[t]}function S7(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let d0;function nO(t){return(!d0||d0.byteLength<t)&&(d0=new ArrayBuffer(t)),d0}function I7(t,e){const r=nO(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function M7(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Hm(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":M7(t)}const vB=1024;class P7{layout={};byteLength;constructor(e){let r=0;for(const[i,o]of Object.entries(e)){const s=B7(o),{type:u,components:d}=s;r=S7(r,d);const y=r;r+=d,this.layout[i]={type:u,size:d,offset:y}}r+=(4-r%4)%4;const n=r*4;this.byteLength=Math.max(n,vB)}getData(e){const r=Math.max(this.byteLength,vB),n=nO(r),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[o,s]of Object.entries(e)){const u=this.layout[o];if(!u){Xt.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:d,size:y,offset:x}=u,E=i[d];if(y===1){if(typeof s!="number"&&typeof s!="boolean"){Xt.warn(`Supplied value for single component uniform ${o} is not a number: ${s}`)();continue}E[x]=Number(s)}else{if(!Hm(s)){Xt.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${s}`)();continue}E.set(s,x)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function R7(t,e,r=16){if(t!==e)return!1;const n=t,i=e;if(!Hm(n))return!1;if(Hm(i)&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function F7(t){return Hm(t)?t.slice():t}class D7{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const r=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!r)throw new Error(e?.name);const n=r;for(const i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[r,n]of Object.entries(e))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){R7(this.uniforms[e],r)||(this.uniforms[e]=F7(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class O7{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[r,n]of Object.entries(e)){const i=r,o=new P7(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);const s=new D7({name:r});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[r,n]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(r),o=e.createBuffer({usage:Li.UNIFORM|Li.COPY_DST,byteLength:i}),s=this.getUniformBufferData(r);return o.write(s),o}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),i=e.createBuffer({usage:Li.UNIFORM|Li.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);e||=n}return e&&Xt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const r=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&r?.needsRedraw){i||=r.needsRedraw;const o=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(o);const s=this.uniformBlocks.get(e)?.getAllUniforms();Xt.log(4,`Writing to uniform buffer ${String(e)}`,o,s)()}return i}}function iO(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function sO(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function L7(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=iO(t);if(i==="uint8"&&r&&n===1)return"unorm8-webgl";if(i==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}class yv{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){const n=[...e];for(const i of r){const o=n.findIndex(s=>s.name===i.name);o<0?n.push(i):n[o]=i}return n}}class N7{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Dl{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(jm.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r($m.instance)}}}class jm extends Dl{}jm.instance=new jm;class $m extends Dl{}$m.instance=new $m;class Pi extends Dl{constructor(){super()}}let O1=class extends Pi{constructor(e,r,n,i,o,s){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=n,this.body=i,this.startLine=o,this.endLine=s}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class k7 extends Pi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class U7 extends Pi{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class z7 extends Pi{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class G7 extends Pi{constructor(e,r,n,i){super(),this.init=e,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var r,n,i;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Bf extends Pi{constructor(e,r,n,i,o){super(),this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class oO extends Pi{constructor(e,r,n){super(),this.name=e,this.type=r,this.value=n}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class L1 extends Pi{constructor(e,r,n,i,o){super(),this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class bB extends Pi{constructor(e,r,n,i,o){super(),this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var aA;(function(t){t.increment="++",t.decrement="--"})(aA||(aA={}));(function(t){function e(r){const n=r;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}t.parse=e})(aA||(aA={}));class V7 extends Pi{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Xp;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Xp||(Xp={}));(function(t){function e(r){const n=r;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}t.parse=e})(Xp||(Xp={}));class H7 extends Pi{constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class aO extends Pi{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}search(e){for(const r of this.args)r.search(e);e(this)}}class j7 extends Pi{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class $7 extends Pi{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}}class W7 extends Pi{constructor(e,r,n,i){super(),this.condition=e,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class J7 extends Pi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class X7 extends Pi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class K7 extends Pi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class q7 extends Pi{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class cO extends Pi{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class Y7 extends Pi{constructor(){super()}get astNodeType(){return"discard"}}class Z7 extends Pi{constructor(){super()}get astNodeType(){return"break"}}class Q7 extends Pi{constructor(){super()}get astNodeType(){return"continue"}}class Zf extends Pi{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Tf extends Zf{constructor(e,r,n,i){super(e),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}}class lO extends Zf{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}}class eV extends Zf{constructor(e,r,n,i){super(e),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class uO extends Zf{constructor(e,r,n,i){super(e),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class bp extends Zf{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class lc extends Dl{constructor(){super()}}class xB extends lc{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Dd extends lc{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){e(this);for(const r of this.args)r.search(e)}}class fO extends lc{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const r of this.args)r.search(e);e(this)}}class N1 extends lc{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const r=e.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(e)}}class wB extends lc{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,n;if(this.initializer instanceof Dd){const i=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),o=(n=this.initializer.type)===null||n===void 0?void 0:n.name,s=e.structs.get(o),u=s?.getMemberIndex(i);if(u!=-1)return this.initializer.args[u].evaluate(e);console.log(u)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class CB extends lc{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class tV extends lc{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class rV extends lc{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class TB extends lc{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class nV extends lc{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class hO extends lc{constructor(){super()}}class iV extends hO{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Oc extends hO{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class dO extends Dl{constructor(){super()}}class sV extends dO{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class oV extends dO{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class aV extends Dl{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class cV extends Dl{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class lV extends Dl{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}let uV=class extends Dl{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}};var pt,it;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(it||(it={}));class st{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class Oe{}pt=Oe;Oe.none=new st("",it.reserved,"");Oe.eof=new st("EOF",it.token,"");Oe.reserved={asm:new st("asm",it.reserved,"asm"),bf16:new st("bf16",it.reserved,"bf16"),do:new st("do",it.reserved,"do"),enum:new st("enum",it.reserved,"enum"),f16:new st("f16",it.reserved,"f16"),f64:new st("f64",it.reserved,"f64"),handle:new st("handle",it.reserved,"handle"),i8:new st("i8",it.reserved,"i8"),i16:new st("i16",it.reserved,"i16"),i64:new st("i64",it.reserved,"i64"),mat:new st("mat",it.reserved,"mat"),premerge:new st("premerge",it.reserved,"premerge"),regardless:new st("regardless",it.reserved,"regardless"),typedef:new st("typedef",it.reserved,"typedef"),u8:new st("u8",it.reserved,"u8"),u16:new st("u16",it.reserved,"u16"),u64:new st("u64",it.reserved,"u64"),unless:new st("unless",it.reserved,"unless"),using:new st("using",it.reserved,"using"),vec:new st("vec",it.reserved,"vec"),void:new st("void",it.reserved,"void")};Oe.keywords={array:new st("array",it.keyword,"array"),atomic:new st("atomic",it.keyword,"atomic"),bool:new st("bool",it.keyword,"bool"),f32:new st("f32",it.keyword,"f32"),i32:new st("i32",it.keyword,"i32"),mat2x2:new st("mat2x2",it.keyword,"mat2x2"),mat2x3:new st("mat2x3",it.keyword,"mat2x3"),mat2x4:new st("mat2x4",it.keyword,"mat2x4"),mat3x2:new st("mat3x2",it.keyword,"mat3x2"),mat3x3:new st("mat3x3",it.keyword,"mat3x3"),mat3x4:new st("mat3x4",it.keyword,"mat3x4"),mat4x2:new st("mat4x2",it.keyword,"mat4x2"),mat4x3:new st("mat4x3",it.keyword,"mat4x3"),mat4x4:new st("mat4x4",it.keyword,"mat4x4"),ptr:new st("ptr",it.keyword,"ptr"),sampler:new st("sampler",it.keyword,"sampler"),sampler_comparison:new st("sampler_comparison",it.keyword,"sampler_comparison"),struct:new st("struct",it.keyword,"struct"),texture_1d:new st("texture_1d",it.keyword,"texture_1d"),texture_2d:new st("texture_2d",it.keyword,"texture_2d"),texture_2d_array:new st("texture_2d_array",it.keyword,"texture_2d_array"),texture_3d:new st("texture_3d",it.keyword,"texture_3d"),texture_cube:new st("texture_cube",it.keyword,"texture_cube"),texture_cube_array:new st("texture_cube_array",it.keyword,"texture_cube_array"),texture_multisampled_2d:new st("texture_multisampled_2d",it.keyword,"texture_multisampled_2d"),texture_storage_1d:new st("texture_storage_1d",it.keyword,"texture_storage_1d"),texture_storage_2d:new st("texture_storage_2d",it.keyword,"texture_storage_2d"),texture_storage_2d_array:new st("texture_storage_2d_array",it.keyword,"texture_storage_2d_array"),texture_storage_3d:new st("texture_storage_3d",it.keyword,"texture_storage_3d"),texture_depth_2d:new st("texture_depth_2d",it.keyword,"texture_depth_2d"),texture_depth_2d_array:new st("texture_depth_2d_array",it.keyword,"texture_depth_2d_array"),texture_depth_cube:new st("texture_depth_cube",it.keyword,"texture_depth_cube"),texture_depth_cube_array:new st("texture_depth_cube_array",it.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new st("texture_depth_multisampled_2d",it.keyword,"texture_depth_multisampled_2d"),texture_external:new st("texture_external",it.keyword,"texture_external"),u32:new st("u32",it.keyword,"u32"),vec2:new st("vec2",it.keyword,"vec2"),vec3:new st("vec3",it.keyword,"vec3"),vec4:new st("vec4",it.keyword,"vec4"),bitcast:new st("bitcast",it.keyword,"bitcast"),block:new st("block",it.keyword,"block"),break:new st("break",it.keyword,"break"),case:new st("case",it.keyword,"case"),continue:new st("continue",it.keyword,"continue"),continuing:new st("continuing",it.keyword,"continuing"),default:new st("default",it.keyword,"default"),diagnostic:new st("diagnostic",it.keyword,"diagnostic"),discard:new st("discard",it.keyword,"discard"),else:new st("else",it.keyword,"else"),enable:new st("enable",it.keyword,"enable"),fallthrough:new st("fallthrough",it.keyword,"fallthrough"),false:new st("false",it.keyword,"false"),fn:new st("fn",it.keyword,"fn"),for:new st("for",it.keyword,"for"),function:new st("function",it.keyword,"function"),if:new st("if",it.keyword,"if"),let:new st("let",it.keyword,"let"),const:new st("const",it.keyword,"const"),loop:new st("loop",it.keyword,"loop"),while:new st("while",it.keyword,"while"),private:new st("private",it.keyword,"private"),read:new st("read",it.keyword,"read"),read_write:new st("read_write",it.keyword,"read_write"),return:new st("return",it.keyword,"return"),requires:new st("requires",it.keyword,"requires"),storage:new st("storage",it.keyword,"storage"),switch:new st("switch",it.keyword,"switch"),true:new st("true",it.keyword,"true"),alias:new st("alias",it.keyword,"alias"),type:new st("type",it.keyword,"type"),uniform:new st("uniform",it.keyword,"uniform"),var:new st("var",it.keyword,"var"),override:new st("override",it.keyword,"override"),workgroup:new st("workgroup",it.keyword,"workgroup"),write:new st("write",it.keyword,"write"),r8unorm:new st("r8unorm",it.keyword,"r8unorm"),r8snorm:new st("r8snorm",it.keyword,"r8snorm"),r8uint:new st("r8uint",it.keyword,"r8uint"),r8sint:new st("r8sint",it.keyword,"r8sint"),r16uint:new st("r16uint",it.keyword,"r16uint"),r16sint:new st("r16sint",it.keyword,"r16sint"),r16float:new st("r16float",it.keyword,"r16float"),rg8unorm:new st("rg8unorm",it.keyword,"rg8unorm"),rg8snorm:new st("rg8snorm",it.keyword,"rg8snorm"),rg8uint:new st("rg8uint",it.keyword,"rg8uint"),rg8sint:new st("rg8sint",it.keyword,"rg8sint"),r32uint:new st("r32uint",it.keyword,"r32uint"),r32sint:new st("r32sint",it.keyword,"r32sint"),r32float:new st("r32float",it.keyword,"r32float"),rg16uint:new st("rg16uint",it.keyword,"rg16uint"),rg16sint:new st("rg16sint",it.keyword,"rg16sint"),rg16float:new st("rg16float",it.keyword,"rg16float"),rgba8unorm:new st("rgba8unorm",it.keyword,"rgba8unorm"),rgba8unorm_srgb:new st("rgba8unorm_srgb",it.keyword,"rgba8unorm_srgb"),rgba8snorm:new st("rgba8snorm",it.keyword,"rgba8snorm"),rgba8uint:new st("rgba8uint",it.keyword,"rgba8uint"),rgba8sint:new st("rgba8sint",it.keyword,"rgba8sint"),bgra8unorm:new st("bgra8unorm",it.keyword,"bgra8unorm"),bgra8unorm_srgb:new st("bgra8unorm_srgb",it.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new st("rgb10a2unorm",it.keyword,"rgb10a2unorm"),rg11b10float:new st("rg11b10float",it.keyword,"rg11b10float"),rg32uint:new st("rg32uint",it.keyword,"rg32uint"),rg32sint:new st("rg32sint",it.keyword,"rg32sint"),rg32float:new st("rg32float",it.keyword,"rg32float"),rgba16uint:new st("rgba16uint",it.keyword,"rgba16uint"),rgba16sint:new st("rgba16sint",it.keyword,"rgba16sint"),rgba16float:new st("rgba16float",it.keyword,"rgba16float"),rgba32uint:new st("rgba32uint",it.keyword,"rgba32uint"),rgba32sint:new st("rgba32sint",it.keyword,"rgba32sint"),rgba32float:new st("rgba32float",it.keyword,"rgba32float"),static_assert:new st("static_assert",it.keyword,"static_assert")};Oe.tokens={decimal_float_literal:new st("decimal_float_literal",it.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new st("hex_float_literal",it.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new st("int_literal",it.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new st("uint_literal",it.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new st("ident",it.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new st("and",it.token,"&"),and_and:new st("and_and",it.token,"&&"),arrow:new st("arrow ",it.token,"->"),attr:new st("attr",it.token,"@"),forward_slash:new st("forward_slash",it.token,"/"),bang:new st("bang",it.token,"!"),bracket_left:new st("bracket_left",it.token,"["),bracket_right:new st("bracket_right",it.token,"]"),brace_left:new st("brace_left",it.token,"{"),brace_right:new st("brace_right",it.token,"}"),colon:new st("colon",it.token,":"),comma:new st("comma",it.token,","),equal:new st("equal",it.token,"="),equal_equal:new st("equal_equal",it.token,"=="),not_equal:new st("not_equal",it.token,"!="),greater_than:new st("greater_than",it.token,">"),greater_than_equal:new st("greater_than_equal",it.token,">="),shift_right:new st("shift_right",it.token,">>"),less_than:new st("less_than",it.token,"<"),less_than_equal:new st("less_than_equal",it.token,"<="),shift_left:new st("shift_left",it.token,"<<"),modulo:new st("modulo",it.token,"%"),minus:new st("minus",it.token,"-"),minus_minus:new st("minus_minus",it.token,"--"),period:new st("period",it.token,"."),plus:new st("plus",it.token,"+"),plus_plus:new st("plus_plus",it.token,"++"),or:new st("or",it.token,"|"),or_or:new st("or_or",it.token,"||"),paren_left:new st("paren_left",it.token,"("),paren_right:new st("paren_right",it.token,")"),semicolon:new st("semicolon",it.token,";"),star:new st("star",it.token,"*"),tilde:new st("tilde",it.token,"~"),underscore:new st("underscore",it.token,"_"),xor:new st("xor",it.token,"^"),plus_equal:new st("plus_equal",it.token,"+="),minus_equal:new st("minus_equal",it.token,"-="),times_equal:new st("times_equal",it.token,"*="),division_equal:new st("division_equal",it.token,"/="),modulo_equal:new st("modulo_equal",it.token,"%="),and_equal:new st("and_equal",it.token,"&="),or_equal:new st("or_equal",it.token,"|="),xor_equal:new st("xor_equal",it.token,"^="),shift_right_equal:new st("shift_right_equal",it.token,">>="),shift_left_equal:new st("shift_left_equal",it.token,"<<=")};Oe.simpleTokens={"@":pt.tokens.attr,"{":pt.tokens.brace_left,"}":pt.tokens.brace_right,":":pt.tokens.colon,",":pt.tokens.comma,"(":pt.tokens.paren_left,")":pt.tokens.paren_right,";":pt.tokens.semicolon};Oe.literalTokens={"&":pt.tokens.and,"&&":pt.tokens.and_and,"->":pt.tokens.arrow,"/":pt.tokens.forward_slash,"!":pt.tokens.bang,"[":pt.tokens.bracket_left,"]":pt.tokens.bracket_right,"=":pt.tokens.equal,"==":pt.tokens.equal_equal,"!=":pt.tokens.not_equal,">":pt.tokens.greater_than,">=":pt.tokens.greater_than_equal,">>":pt.tokens.shift_right,"<":pt.tokens.less_than,"<=":pt.tokens.less_than_equal,"<<":pt.tokens.shift_left,"%":pt.tokens.modulo,"-":pt.tokens.minus,"--":pt.tokens.minus_minus,".":pt.tokens.period,"+":pt.tokens.plus,"++":pt.tokens.plus_plus,"|":pt.tokens.or,"||":pt.tokens.or_or,"*":pt.tokens.star,"~":pt.tokens.tilde,_:pt.tokens.underscore,"^":pt.tokens.xor,"+=":pt.tokens.plus_equal,"-=":pt.tokens.minus_equal,"*=":pt.tokens.times_equal,"/=":pt.tokens.division_equal,"%=":pt.tokens.modulo_equal,"&=":pt.tokens.and_equal,"|=":pt.tokens.or_equal,"^=":pt.tokens.xor_equal,">>=":pt.tokens.shift_right_equal,"<<=":pt.tokens.shift_left_equal};Oe.regexTokens={decimal_float_literal:pt.tokens.decimal_float_literal,hex_float_literal:pt.tokens.hex_float_literal,int_literal:pt.tokens.int_literal,uint_literal:pt.tokens.uint_literal,ident:pt.tokens.ident};Oe.storage_class=[pt.keywords.function,pt.keywords.private,pt.keywords.workgroup,pt.keywords.uniform,pt.keywords.storage];Oe.access_mode=[pt.keywords.read,pt.keywords.write,pt.keywords.read_write];Oe.sampler_type=[pt.keywords.sampler,pt.keywords.sampler_comparison];Oe.sampled_texture_type=[pt.keywords.texture_1d,pt.keywords.texture_2d,pt.keywords.texture_2d_array,pt.keywords.texture_3d,pt.keywords.texture_cube,pt.keywords.texture_cube_array];Oe.multisampled_texture_type=[pt.keywords.texture_multisampled_2d];Oe.storage_texture_type=[pt.keywords.texture_storage_1d,pt.keywords.texture_storage_2d,pt.keywords.texture_storage_2d_array,pt.keywords.texture_storage_3d];Oe.depth_texture_type=[pt.keywords.texture_depth_2d,pt.keywords.texture_depth_2d_array,pt.keywords.texture_depth_cube,pt.keywords.texture_depth_cube_array,pt.keywords.texture_depth_multisampled_2d];Oe.texture_external_type=[pt.keywords.texture_external];Oe.any_texture_type=[...pt.sampled_texture_type,...pt.multisampled_texture_type,...pt.storage_texture_type,...pt.depth_texture_type,...pt.texture_external_type];Oe.texel_format=[pt.keywords.r8unorm,pt.keywords.r8snorm,pt.keywords.r8uint,pt.keywords.r8sint,pt.keywords.r16uint,pt.keywords.r16sint,pt.keywords.r16float,pt.keywords.rg8unorm,pt.keywords.rg8snorm,pt.keywords.rg8uint,pt.keywords.rg8sint,pt.keywords.r32uint,pt.keywords.r32sint,pt.keywords.r32float,pt.keywords.rg16uint,pt.keywords.rg16sint,pt.keywords.rg16float,pt.keywords.rgba8unorm,pt.keywords.rgba8unorm_srgb,pt.keywords.rgba8snorm,pt.keywords.rgba8uint,pt.keywords.rgba8sint,pt.keywords.bgra8unorm,pt.keywords.bgra8unorm_srgb,pt.keywords.rgb10a2unorm,pt.keywords.rg11b10float,pt.keywords.rg32uint,pt.keywords.rg32sint,pt.keywords.rg32float,pt.keywords.rgba16uint,pt.keywords.rgba16sint,pt.keywords.rgba16float,pt.keywords.rgba32uint,pt.keywords.rgba32sint,pt.keywords.rgba32float];Oe.const_literal=[pt.tokens.int_literal,pt.tokens.uint_literal,pt.tokens.decimal_float_literal,pt.tokens.hex_float_literal,pt.keywords.true,pt.keywords.false];Oe.literal_or_ident=[pt.tokens.ident,pt.tokens.int_literal,pt.tokens.uint_literal,pt.tokens.decimal_float_literal,pt.tokens.hex_float_literal];Oe.element_count_expression=[pt.tokens.int_literal,pt.tokens.uint_literal,pt.tokens.ident];Oe.template_types=[pt.keywords.vec2,pt.keywords.vec3,pt.keywords.vec4,pt.keywords.mat2x2,pt.keywords.mat2x3,pt.keywords.mat2x4,pt.keywords.mat3x2,pt.keywords.mat3x3,pt.keywords.mat3x4,pt.keywords.mat4x2,pt.keywords.mat4x3,pt.keywords.mat4x4,pt.keywords.atomic,pt.keywords.bitcast,...pt.any_texture_type];Oe.attribute_name=[pt.tokens.ident,pt.keywords.block,pt.keywords.diagnostic];Oe.assignment_operators=[pt.tokens.equal,pt.tokens.plus_equal,pt.tokens.minus_equal,pt.tokens.times_equal,pt.tokens.division_equal,pt.tokens.modulo_equal,pt.tokens.and_equal,pt.tokens.or_equal,pt.tokens.xor_equal,pt.tokens.shift_right_equal,pt.tokens.shift_left_equal];Oe.increment_operators=[pt.tokens.plus_plus,pt.tokens.minus_minus];class EB{constructor(e,r,n){this.type=e,this.lexeme=r,this.line=n}toString(){return this.lexeme}isTemplateType(){return Oe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Oe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class fV{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new EB(Oe.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const r=Oe.simpleTokens[e];if(r)return this._addToken(r),!0;let n=Oe.none;const i=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(i){const s=Oe.keywords[e];if(s)return this._addToken(s),!0}if(i||o)return this._addToken(Oe.tokens.ident),!0;for(;;){let s=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(Oe.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(Oe.tokens.minus_minus),!0;const d=this._tokens.length-1;if((Oe.literal_or_ident.indexOf(this._tokens[d].type)!=-1||this._tokens[d].type==Oe.tokens.paren_right)&&u!=">")return this._addToken(s),!0}if(e==">"&&(u==">"||u=="=")){let d=!1,y=this._tokens.length-1;for(let x=0;x<5&&y>=0&&Oe.assignment_operators.indexOf(this._tokens[y].type)===-1;++x,--y)if(this._tokens[y].type===Oe.tokens.less_than){y>0&&this._tokens[y-1].isArrayOrTemplateType()&&(d=!0);break}if(d)return this._addToken(s),!0}if(s===Oe.none){let d=e,y=0;const x=2;for(let E=0;E<x;++E)if(d+=this._peekAhead(E),s=this._findType(d),s!==Oe.none){y=E;break}if(s===Oe.none)return n===Oe.none?!1:(this._current--,this._addToken(n),!0);e=d,this._current+=y+1}if(n=s,this._isAtEnd())break;e+=this._advance()}return n===Oe.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in Oe.regexTokens){const i=Oe.regexTokens[n];if(this._match(e,i.rule))return i}const r=Oe.literalTokens[e];return r||Oe.none}_match(e,r){const n=r.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new EB(e,r,this._line))}}class hV{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new N7,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,o=n.countNode;if(o instanceof N1){const u=o.name,d=this._context.constants.get(u);if(d)try{const y=d.evaluate(this._context);i.count=y}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(e){if(e)if(typeof e=="string"){const r=new fV(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Oe.eof}_match(e){if(e instanceof st)return this._check(e)?(this._advance(),!0):!1;for(let r=0,n=e.length;r<n;++r){const i=e[r];if(this._check(i))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const n=r.type;return e.indexOf(n)!=-1}return r.type==e}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Oe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Oe.keywords.alias)){const r=this._type_alias();return this._consume(Oe.tokens.semicolon,"Expected ';'"),r}if(this._match(Oe.keywords.diagnostic)){const r=this._diagnostic();return this._consume(Oe.tokens.semicolon,"Expected ';'"),r}if(this._match(Oe.keywords.requires)){const r=this._requires_directive();return this._consume(Oe.tokens.semicolon,"Expected ';'"),r}if(this._match(Oe.keywords.enable)){const r=this._enable_directive();return this._consume(Oe.tokens.semicolon,"Expected ';'"),r}const e=this._attribute();if(this._check(Oe.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(Oe.tokens.semicolon,"Expected ';'."),r}if(this._check(Oe.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(Oe.tokens.semicolon,"Expected ';'."),r}if(this._check(Oe.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(Oe.tokens.semicolon,"Expected ';'."),r}if(this._check(Oe.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(Oe.tokens.semicolon,"Expected ';'."),r}if(this._check(Oe.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(Oe.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(Oe.keywords.fn))return null;const e=this._currentLine,r=this._consume(Oe.tokens.ident,"Expected function name.").toString();this._consume(Oe.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Oe.tokens.paren_right))do{if(this._check(Oe.tokens.paren_right))break;const u=this._attribute(),d=this._consume(Oe.tokens.ident,"Expected argument name.").toString();this._consume(Oe.tokens.colon,"Expected ':' for argument type.");const y=this._attribute(),x=this._type_decl();x!=null&&(x.attributes=y,n.push(new aV(d,x,u)))}while(this._match(Oe.tokens.comma));this._consume(Oe.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Oe.tokens.arrow)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}const o=this._compound_statement(),s=this._currentLine;return new O1(r,n,i,o,e,s)}_compound_statement(){const e=[];for(this._consume(Oe.tokens.brace_left,"Expected '{' for block.");!this._check(Oe.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(Oe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Oe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Oe.tokens.attr)&&this._attribute(),this._check(Oe.keywords.if))return this._if_statement();if(this._check(Oe.keywords.switch))return this._switch_statement();if(this._check(Oe.keywords.loop))return this._loop_statement();if(this._check(Oe.keywords.for))return this._for_statement();if(this._check(Oe.keywords.while))return this._while_statement();if(this._check(Oe.keywords.continuing))return this._continuing_statement();if(this._check(Oe.keywords.static_assert))return this._static_assert_statement();if(this._check(Oe.tokens.brace_left))return this._compound_statement();let e=null;return this._check(Oe.keywords.return)?e=this._return_statement():this._check([Oe.keywords.var,Oe.keywords.let,Oe.keywords.const])?e=this._variable_statement():this._match(Oe.keywords.discard)?e=new Y7:this._match(Oe.keywords.break)?e=new Z7:this._match(Oe.keywords.continue)?e=new Q7:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(Oe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Oe.keywords.static_assert))return null;const e=this._optional_paren_expression();return new k7(e)}_while_statement(){if(!this._match(Oe.keywords.while))return null;const e=this._optional_paren_expression();this._check(Oe.tokens.attr)&&this._attribute();const r=this._compound_statement();return new U7(e,r)}_continuing_statement(){if(!this._match(Oe.keywords.continuing))return null;const e=this._compound_statement();return new z7(e)}_for_statement(){if(!this._match(Oe.keywords.for))return null;this._consume(Oe.tokens.paren_left,"Expected '('.");const e=this._check(Oe.tokens.semicolon)?null:this._for_init();this._consume(Oe.tokens.semicolon,"Expected ';'.");const r=this._check(Oe.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(Oe.tokens.semicolon,"Expected ';'.");const n=this._check(Oe.tokens.paren_right)?null:this._for_increment();this._consume(Oe.tokens.paren_right,"Expected ')'."),this._check(Oe.tokens.attr)&&this._attribute();const i=this._compound_statement();return new G7(e,r,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Oe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(Oe.tokens.equal)&&(r=this._short_circuit_or_expression()),new Bf(e.name,e.type,e.storage,e.access,r)}if(this._match(Oe.keywords.let)){const e=this._consume(Oe.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(Oe.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}this._consume(Oe.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new L1(e,r,null,null,n)}if(this._match(Oe.keywords.const)){const e=this._consume(Oe.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(Oe.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}this._consume(Oe.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new bB(e,r,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(Oe.increment_operators))return this._current=e,null;const n=this._consume(Oe.increment_operators,"Expected increment operator");return new V7(n.type===Oe.tokens.plus_plus?aA.increment:aA.decrement,r)}_assignment_statement(){let e=null;if(this._check(Oe.tokens.brace_right))return null;let r=this._match(Oe.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const n=this._consume(Oe.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new H7(Xp.parse(n.lexeme),e,i)}_func_call_statement(){if(!this._check(Oe.tokens.ident))return null;const e=this._current,r=this._consume(Oe.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new aO(r.lexeme,n)}_loop_statement(){if(!this._match(Oe.keywords.loop))return null;this._check(Oe.tokens.attr)&&this._attribute(),this._consume(Oe.tokens.brace_left,"Expected '{' for loop.");const e=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let i of r)e.push(i);else e.push(r);r=this._statement()}let n=null;return this._match(Oe.keywords.continuing)&&(n=this._compound_statement()),this._consume(Oe.tokens.brace_right,"Expected '}' for loop."),new j7(e,n)}_switch_statement(){if(!this._match(Oe.keywords.switch))return null;const e=this._optional_paren_expression();this._check(Oe.tokens.attr)&&this._attribute(),this._consume(Oe.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Oe.tokens.brace_right,"Expected '}' for switch."),new $7(e,r)}_switch_body(){const e=[];if(this._match(Oe.keywords.case)){const r=this._case_selectors();this._match(Oe.tokens.colon),this._check(Oe.tokens.attr)&&this._attribute(),this._consume(Oe.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(Oe.tokens.brace_right,"Exected '}' for switch case."),e.push(new sV(r,n))}if(this._match(Oe.keywords.default)){this._match(Oe.tokens.colon),this._check(Oe.tokens.attr)&&this._attribute(),this._consume(Oe.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(Oe.tokens.brace_right,"Exected '}' for switch default."),e.push(new oV(r))}if(this._check([Oe.keywords.default,Oe.keywords.case])){const r=this._switch_body();e.push(r[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(Oe.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(Oe.keywords.fallthrough))return this._consume(Oe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(Oe.keywords.if))return null;const e=this._optional_paren_expression();this._check(Oe.tokens.attr)&&this._attribute();const r=this._compound_statement();let n=[];this._match_elseif()&&(this._check(Oe.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let i=null;return this._match(Oe.keywords.else)&&(this._check(Oe.tokens.attr)&&this._attribute(),i=this._compound_statement()),new W7(e,r,n,i)}_match_elseif(){return this._tokens[this._current].type===Oe.keywords.else&&this._tokens[this._current+1].type===Oe.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(new cV(r,n)),this._match_elseif()&&(this._check(Oe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Oe.keywords.return))return null;const e=this._short_circuit_or_expression();return new J7(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Oe.tokens.or_or);)e=new Oc(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Oe.tokens.and_and);)e=new Oc(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Oe.tokens.or);)e=new Oc(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Oe.tokens.xor);)e=new Oc(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(Oe.tokens.and);)e=new Oc(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([Oe.tokens.equal_equal,Oe.tokens.not_equal])?new Oc(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Oe.tokens.less_than,Oe.tokens.greater_than,Oe.tokens.less_than_equal,Oe.tokens.greater_than_equal]);)e=new Oc(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Oe.tokens.shift_left,Oe.tokens.shift_right]);)e=new Oc(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Oe.tokens.plus,Oe.tokens.minus]);)e=new Oc(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Oe.tokens.star,Oe.tokens.forward_slash,Oe.tokens.modulo]);)e=new Oc(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([Oe.tokens.minus,Oe.tokens.bang,Oe.tokens.tilde,Oe.tokens.star,Oe.tokens.and])?new iV(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(Oe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Oe.tokens.bracket_right,"Expected ']'.");const r=new nV(e),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(Oe.tokens.period)){const e=this._consume(Oe.tokens.ident,"Expected member name."),r=this._postfix_expression(),n=new xB(e.lexeme);return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(Oe.tokens.ident)){const n=this._previous().toString();if(this._check(Oe.tokens.paren_left)){const i=this._argument_expression_list(),o=this._getStruct(n);return o!=null?new Dd(o,i):new fO(n,i)}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return new wB(n,i.value)}return new N1(n)}if(this._match(Oe.const_literal))return new CB(parseFloat(this._previous().toString()));if(this._check(Oe.tokens.paren_left))return this._paren_expression();if(this._match(Oe.keywords.bitcast)){this._consume(Oe.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Oe.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new tV(n,i)}const e=this._type_decl(),r=this._argument_expression_list();return new rV(e,r)}_argument_expression_list(){if(!this._match(Oe.tokens.paren_left))return null;const e=[];do{if(this._check(Oe.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(Oe.tokens.comma));return this._consume(Oe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Oe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Oe.tokens.paren_right),new TB([e])}_paren_expression(){this._consume(Oe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Oe.tokens.paren_right,"Expected ')'."),new TB([e])}_struct_decl(){if(!this._match(Oe.keywords.struct))return null;const e=this._currentLine,r=this._consume(Oe.tokens.ident,"Expected name for struct.").toString();this._consume(Oe.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Oe.tokens.brace_right);){const s=this._attribute(),u=this._consume(Oe.tokens.ident,"Expected variable name.").toString();this._consume(Oe.tokens.colon,"Expected ':' for struct member type.");const d=this._attribute(),y=this._type_decl();y!=null&&(y.attributes=d),this._check(Oe.tokens.brace_right)?this._match(Oe.tokens.comma):this._consume(Oe.tokens.comma,"Expected ',' for struct member."),n.push(new lV(u,y,s))}this._consume(Oe.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,o=new Tf(r,n,e,i);return this._context.structs.set(r,o),o}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(Oe.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Oe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(Oe.keywords.const))return null;const e=this._consume(Oe.tokens.ident,"Expected variable name");let r=null;if(this._match(Oe.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}let n=null;if(this._match(Oe.tokens.equal)){const o=this._short_circuit_or_expression();if(o instanceof Dd)n=o;else if(o instanceof wB&&o.initializer instanceof Dd)n=o.initializer;else try{const s=o.evaluate(this._context);n=new CB(s)}catch{n=o}}const i=new bB(e.toString(),r,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(Oe.keywords.let))return null;const e=this._consume(Oe.tokens.ident,"Expected variable name");let r=null;if(this._match(Oe.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}let n=null;return this._match(Oe.tokens.equal)&&(n=this._const_expression()),new L1(e.toString(),r,"","",n)}_const_expression(){if(this._match(Oe.const_literal))return new xB(this._previous().toString());const e=this._type_decl();this._consume(Oe.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(Oe.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(Oe.tokens.comma));)this._advance();return this._consume(Oe.tokens.paren_right,"Expected ')'."),new Dd(e,r)}_variable_decl(){if(!this._match(Oe.keywords.var))return null;let e="",r="";this._match(Oe.tokens.less_than)&&(e=this._consume(Oe.storage_class,"Expected storage_class.").toString(),this._match(Oe.tokens.comma)&&(r=this._consume(Oe.access_mode,"Expected access_mode.").toString()),this._consume(Oe.tokens.greater_than,"Expected '>'."));const n=this._consume(Oe.tokens.ident,"Expected variable name");let i=null;if(this._match(Oe.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}return new Bf(n.toString(),i,e,r,null)}_override_decl(){if(!this._match(Oe.keywords.override))return null;const e=this._consume(Oe.tokens.ident,"Expected variable name");let r=null;if(this._match(Oe.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return new oO(e.toString(),r,null)}_diagnostic(){this._consume(Oe.tokens.paren_left,"Expected '('");const e=this._consume(Oe.tokens.ident,"Expected severity control name.");this._consume(Oe.tokens.comma,"Expected ','");const r=this._consume(Oe.tokens.ident,"Expected diagnostic rule name.");return this._consume(Oe.tokens.paren_right,"Expected ')'"),new q7(e.toString(),r.toString())}_enable_directive(){const e=this._consume(Oe.tokens.ident,"identity expected.");return new X7(e.toString())}_requires_directive(){const e=[this._consume(Oe.tokens.ident,"identity expected.").toString()];for(;this._match(Oe.tokens.comma);){const r=this._consume(Oe.tokens.ident,"identity expected.");e.push(r.toString())}return new K7(e)}_type_alias(){const e=this._consume(Oe.tokens.ident,"identity expected.");this._consume(Oe.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=new cO(e.toString(),r);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Oe.tokens.ident,...Oe.texel_format,Oe.keywords.bool,Oe.keywords.f32,Oe.keywords.i32,Oe.keywords.u32])){const n=this._advance(),i=n.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new Zf(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(Oe.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(Oe.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(Oe.tokens.comma)&&(o=this._consume(Oe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Oe.tokens.greater_than,"Expected '>' for type.")),new lO(n,i,o)}if(this._match(Oe.keywords.ptr)){let n=this._previous().toString();this._consume(Oe.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(Oe.storage_class,"Expected storage_class for pointer");this._consume(Oe.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let s=null;return this._match(Oe.tokens.comma)&&(s=this._consume(Oe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Oe.tokens.greater_than,"Expected '>' for pointer."),new eV(n,i.toString(),o,s)}const r=this._attribute();if(this._match(Oe.keywords.array)){let n=null,i=-1;const o=this._previous();let s=null;if(this._match(Oe.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let d="";if(this._match(Oe.tokens.comma)){s=this._shift_expression();try{d=s.evaluate(this._context).toString(),s=null}catch{d="1"}}this._consume(Oe.tokens.greater_than,"Expected '>' for array."),i=d?parseInt(d):0}const u=new uO(o.toString(),r,n,i);return s&&this._deferArrayCountEval.push({arrayType:u,countNode:s}),u}return null}_texture_sampler_types(){if(this._match(Oe.sampler_type))return new bp(this._previous().toString(),null,null);if(this._match(Oe.depth_texture_type))return new bp(this._previous().toString(),null,null);if(this._match(Oe.sampled_texture_type)||this._match(Oe.multisampled_texture_type)){const e=this._previous();this._consume(Oe.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(Oe.tokens.greater_than,"Expected '>' for sampler type."),new bp(e.toString(),r,null)}if(this._match(Oe.storage_texture_type)){const e=this._previous();this._consume(Oe.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(Oe.texel_format,"Invalid texel format.").toString();this._consume(Oe.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Oe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Oe.tokens.greater_than,"Expected '>' for sampler type."),new bp(e.toString(),r,n)}return null}_attribute(){let e=[];for(;this._match(Oe.tokens.attr);){const r=this._consume(Oe.attribute_name,"Expected attribute name"),n=new uV(r.toString(),null);if(this._match(Oe.tokens.paren_left)){if(n.value=this._consume(Oe.literal_or_ident,"Expected attribute value").toString(),this._check(Oe.tokens.comma)){this._advance();do{const i=this._consume(Oe.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(Oe.tokens.comma))}this._consume(Oe.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class Xd{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class BB{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class A0 extends Xd{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class vv extends Xd{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class SB extends Xd{constructor(e,r,n,i){super(e,n),this.format=r,this.access=i}get isTemplate(){return!0}}var vu;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(vu||(vu={}));class p0{constructor(e,r,n,i,o,s,u){this.name=e,this.type=r,this.group=n,this.binding=i,this.attributes=o,this.resourceType=s,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class dV{constructor(e,r){this.name=e,this.type=r}}class g0{constructor(e,r){this.align=e,this.size=r}}class AV{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}}class IB{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i}}class pV{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r}}class gV{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class mV{constructor(e,r,n,i){this.name=e,this.type=r,this.attributes=n,this.id=i}}class _V{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class El{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new gV,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new hV().parse(e);for(const i of n)i instanceof O1&&this._functions.set(i.name,new _V(i));for(const i of n)if(i instanceof Tf){const o=this._getTypeInfo(i,null);o instanceof A0&&this.structs.push(o)}for(const i of n){if(i instanceof cO){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof oO){const o=i,s=this._getAttributeNum(o.attributes,"id",0),u=o.type!=null?this._getTypeInfo(o.type,o.attributes):null;this.overrides.push(new mV(o.name,u,o.attributes,s));continue}if(this._isUniformVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),u=this._getAttributeNum(o.attributes,"binding",0),d=this._getTypeInfo(o.type,o.attributes),y=new p0(o.name,d,s,u,o.attributes,vu.Uniform,o.access);this.uniforms.push(y);continue}if(this._isStorageVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),u=this._getAttributeNum(o.attributes,"binding",0),d=this._getTypeInfo(o.type,o.attributes),y=this._isStorageTexture(d),x=new p0(o.name,d,s,u,o.attributes,y?vu.StorageTexture:vu.Storage,o.access);this.storage.push(x);continue}if(this._isTextureVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),u=this._getAttributeNum(o.attributes,"binding",0),d=this._getTypeInfo(o.type,o.attributes),y=this._isStorageTexture(d),x=new p0(o.name,d,s,u,o.attributes,y?vu.StorageTexture:vu.Texture,o.access);y?this.storage.push(x):this.textures.push(x);continue}if(this._isSamplerVar(i)){const o=i,s=this._getAttributeNum(o.attributes,"group",0),u=this._getAttributeNum(o.attributes,"binding",0),d=this._getTypeInfo(o.type,o.attributes),y=new p0(o.name,d,s,u,o.attributes,vu.Sampler,o.access);this.samplers.push(y);continue}if(i instanceof O1){const o=this._getAttribute(i,"vertex"),s=this._getAttribute(i,"fragment"),u=this._getAttribute(i,"compute"),d=o||s||u,y=new pV(i.name,d?.name);y.startLine=i.startLine,y.endLine=i.endLine,this.functions.push(y),this._functions.get(i.name).info=y,d&&(this._functions.get(i.name).inUse=!0,y.inUse=!0,y.resources=this._findResources(i,!!d),y.inputs=this._getInputs(i.args),y.outputs=this._getOutputs(i.returnType),this.entry[d.name].push(y));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var n;for(const i of e.calls){const o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&r.add(o)}}findResource(e,r){for(const n of this.uniforms)if(n.group==e&&n.binding==r)return n;for(const n of this.storage)if(n.group==e&&n.binding==r)return n;for(const n of this.textures)if(n.group==e&&n.binding==r)return n;for(const n of this.samplers)if(n.group==e&&n.binding==r)return n;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this._getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const n=[],i=this,o=[];return e.search(s=>{if(s instanceof jm)o.push({});else if(s instanceof $m)o.pop();else if(s instanceof Bf){const u=s;r&&u.type!==null&&this._markStructsFromAST(u.type),o.length>0&&(o[o.length-1][u.name]=u)}else if(s instanceof Dd){const u=s;r&&u.type!==null&&this._markStructsFromAST(u.type)}else if(s instanceof L1){const u=s;r&&u.type!==null&&this._markStructsFromAST(u.type),o.length>0&&(o[o.length-1][u.name]=u)}else if(s instanceof N1){const u=s;if(o.length>0&&o[o.length-1][u.name])return;const d=i._findResource(u.name);d&&n.push(d)}else if(s instanceof fO){const u=s,d=i._functions.get(u.name);d&&(r&&(d.inUse=!0),e.calls.add(d.node),d.resources===null&&(d.resources=i._findResources(d.node,r)),n.push(...d.resources))}else if(s instanceof aO){const u=s,d=i._functions.get(u.name);d&&(r&&(d.inUse=!0),e.calls.add(d.node),d.resources===null&&(d.resources=i._findResources(d.node,r)),n.push(...d.resources))}}),[...new Map(n.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function r(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms){r(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.storage){r(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.textures){r(n.group,n.binding);const i=e[n.group];i[n.binding]=n}for(const n of this.samplers){r(n.group,n.binding);const i=e[n.group];i[n.binding]=n}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Tf)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof Tf)this._getStructOutputs(n.type,r);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const o=this._getTypeInfo(n.type,n.type.attributes),s=this._parseInt(i.value),u=new IB(n.name,o,i.name,s);r.push(u)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getTypeInfo(e,e.attributes),i=this._parseInt(r.value);return new IB("",n,r.name,i)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof Tf)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof Tf)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),o=this._parseInt(r.value),s=new AV(e.name,i,r.name,o);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new dV(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof uO){const i=e,o=this._getTypeInfo(i.format,i.attributes),s=new vv(i.name,r);return s.format=o,s.count=i.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Tf){const i=e,o=new A0(i.name,r);o.startLine=i.startLine,o.endLine=i.endLine;for(const s of i.members){const u=this._getTypeInfo(s.type,s.attributes);o.members.push(new BB(s.name,u,s.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof bp){const i=e,o=i.format instanceof Zf,s=i.format?o?this._getTypeInfo(i.format,null):new Xd(i.format,null):null,u=new SB(i.name,s,r,i.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof lO){const i=e,o=i.format?this._getTypeInfo(i.format,null):null,s=new SB(i.name,o,r,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new Xd(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n;const i=this._getTypeSize(e);if(e.size=(r=i?.size)!==null&&r!==void 0?r:0,e instanceof vv){const o=this._getTypeSize(e.format);e.stride=(n=o?.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof A0&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,i=0,o=0,s=0;for(let u=0,d=e.members.length;u<d;++u){const y=e.members[u],x=this._getTypeSize(y);if(!x)continue;(r=this._getAlias(y.type.name))!==null&&r!==void 0||y.type;const E=x.align,S=x.size;n=this._roundUp(E,n+i),i=S,o=n,s=Math.max(s,E),y.offset=n,y.size=S,this._updateTypeInfo(y.type)}e.size=this._roundUp(s,o+i),e.align=s}_getTypeSize(e){var r,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof BB&&(e=e.type),e instanceof Xd){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=El._typeInfo[e.name];if(s!==void 0){const u=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new g0(Math.max(o,s.align/u),Math.max(i,s.size/u))}}{const s=El._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const u=e.name[e.name.length-1]==="h"?2:1;return new g0(Math.max(o,s.align/u),Math.max(i,s.size/u))}}if(e instanceof vv){let s=e,u=8,d=8;const y=this._getTypeSize(s.format);y!==null&&(d=y.size,u=y.align);const x=s.count,E=this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(u,d));return d=x*E,i&&(d=i),new g0(Math.max(o,u),Math.max(i,d))}if(e instanceof A0){let s=0,u=0,d=0,y=0,x=0;for(const E of e.members){const S=this._getTypeSize(E.type);S!==null&&(s=Math.max(S.align,s),d=this._roundUp(S.align,d+y),y=S.size,x=d)}return u=this._roundUp(s,x+y),new g0(Math.max(o,s),Math.max(i,u))}return null}_isUniformVar(e){return e instanceof Bf&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Bf&&e.storage=="storage"}_isTextureVar(e){return e instanceof Bf&&e.type!==null&&El._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Bf&&e.type!==null&&El._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let o of i)if(o.name==r)return o;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let i of e)if(i.name==r){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}El._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};El._textureTypes=Oe.any_texture_type.map(t=>t.name);El._samplerTypes=Oe.sampler_type.map(t=>t.name);function yV(t){const e={attributes:[],bindings:[]};let r;try{r=vV(t)}catch(o){return Xt.error(o.message)(),e}for(const o of r.uniforms){const s=[];for(const u of o.type?.members||[])s.push({name:u.name,type:MB(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:s})}for(const o of r.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of r.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const n=r.entry.vertex[0],i=n?.inputs.length||0;for(let o=0;o<i;o++){const s=n.inputs[o];if(s.locationType==="location"){const u=MB(s.type);e.attributes.push({name:s.name,location:Number(s.location),type:u})}}return e}function MB(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function vV(t){try{return new El(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}const bV=1/Math.PI*180,xV=1/180*Math.PI,wV={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...wV}};const As=globalThis.mathgl.config;function CV(t,{precision:e=As.precision}={}){return t=SV(t),`${parseFloat(t.toPrecision(e))}`}function Iu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function TV(t){return BV(t)}function EV(t){return qa(t)}function BV(t,e){return Mx(t,r=>r*xV,e)}function qa(t,e){return Mx(t,r=>r*bV,e)}function Bl(t,e,r){return Mx(t,n=>Math.max(e,Math.min(r,n)))}function sc(t,e,r){return Iu(t)?t.map((n,i)=>sc(n,e[i],r)):r*e+(1-r)*t}function ra(t,e,r){const n=As.EPSILON;r&&(As.EPSILON=r);try{if(t===e)return!0;if(Iu(t)&&Iu(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!ra(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=As.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{As.EPSILON=n}}function SV(t){return Math.round(t/As.EPSILON)*As.EPSILON}function IV(t){return t.clone?t.clone():new Array(t.length)}function Mx(t,e,r){if(Iu(t)){const n=t;r=r||IV(n);for(let i=0;i<r.length&&i<n.length;++i){const o=typeof t=="number"?t:t[i];r[i]=e(o,i,r)}return r}return e(t)}class Px extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+r];return this.check()}toArray(e=[],r=0){for(let n=0;n<this.ELEMENTS;++n)e[r+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Iu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(As)}formatString(e){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+CV(this[n],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!ra(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,n){if(n===void 0)return this.lerp(this,e,r);for(let i=0;i<this.ELEMENTS;++i){const o=e[i],s=typeof r=="number"?r:r[i];this[i]=o+n*(s-o)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),r[n]);return this.check()}add(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(As.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),r);return this.check()}get elements(){return this}}function MV(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function Hn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Rp(t,e,r=""){if(As.debug&&!MV(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function Za(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Rx extends Px{get x(){return this[0]}set x(e){this[0]=Hn(e)}get y(){return this[1]}set y(e){this[1]=Hn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];r+=i*i}return Hn(r)}dot(e){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*e[n];return Hn(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Za(e>=0&&e<this.ELEMENTS,"index is out of range"),Hn(this[e])}setComponent(e,r){return Za(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const Fp=1e-6;let ac=typeof Float32Array<"u"?Float32Array:Array;function PV(){const t=new ac(2);return ac!=Float32Array&&(t[0]=0,t[1]=0),t}function PB(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function RV(t,e){return t[0]=-e[0],t[1]=-e[1],t}function AO(t,e,r,n){const i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}function FV(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function DV(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function pO(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function gO(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(function(){const t=PV();return function(e,r,n,i,o,s){let u,d;for(r||(r=2),n||(n=0),i?d=Math.min(i*r+n,e.length):d=e.length,u=n;u<d;u+=r)t[0]=e[u],t[1]=e[u+1],o(t,t,s),e[u]=t[0],e[u+1]=t[1];return e}})();function mO(t,e,r){const n=e[0],i=e[1],o=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/o,t[1]=(r[1]*n+r[5]*i)/o,t}function _O(t,e,r){const n=e[0],i=e[1],o=e[2],s=r[3]*n+r[7]*i+r[11]*o||1;return t[0]=(r[0]*n+r[4]*i+r[8]*o)/s,t[1]=(r[1]*n+r[5]*i+r[9]*o)/s,t[2]=(r[2]*n+r[6]*i+r[10]*o)/s,t}function OV(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function LV(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t[3]=e[3],t}function yO(t,e,r){const n=e[0],i=e[1],o=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*o,t[1]=r[1]*n+r[4]*i+r[7]*o,t[2]=r[2]*n+r[5]*i+r[8]*o,t[3]=e[3],t}class Fx extends Rx{constructor(e=0,r=0){super(2),Iu(e)&&arguments.length===1?this.copy(e):(As.debug&&(Hn(e),Hn(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return As.debug&&(Hn(e.x),Hn(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return gO(this,this,e),this.check()}transformAsVector(e){return mO(this,this,e),this.check()}transformByMatrix3(e){return pO(this,this,e),this.check()}transformByMatrix2x3(e){return DV(this,this,e),this.check()}transformByMatrix2(e){return FV(this,this,e),this.check()}}function vO(){const t=new ac(3);return ac!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bO(t){const e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function RB(t,e,r){const n=new ac(3);return n[0]=t,n[1]=e,n[2]=r,n}function NV(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function kV(t){const e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function UV(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function zV(t,e){const r=e[0],n=e[1],i=e[2];let o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Dx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function hm(t,e,r){const n=e[0],i=e[1],o=e[2],s=r[0],u=r[1],d=r[2];return t[0]=i*d-o*u,t[1]=o*s-n*d,t[2]=n*u-i*s,t}function GV(t,e,r,n){const i=e[0],o=e[1],s=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=s+n*(r[2]-s),t}function Ox(t,e,r){const n=e[0],i=e[1],o=e[2];let s=r[3]*n+r[7]*i+r[11]*o+r[15];return s=s||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/s,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/s,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/s,t}function xO(t,e,r){const n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function wO(t,e,r){const n=r[0],i=r[1],o=r[2],s=r[3],u=e[0],d=e[1],y=e[2];let x=i*y-o*d,E=o*u-n*y,S=n*d-i*u,O=i*S-o*E,k=o*x-n*S,U=n*E-i*x;const J=s*2;return x*=J,E*=J,S*=J,O*=2,k*=2,U*=2,t[0]=u+x+O,t[1]=d+E+k,t[2]=y+S+U,t}function VV(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function HV(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function jV(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function $V(t,e){const r=t[0],n=t[1],i=t[2],o=e[0],s=e[1],u=e[2],d=Math.sqrt((r*r+n*n+i*i)*(o*o+s*s+u*u)),y=d&&Dx(t,e)/d;return Math.acos(Math.min(Math.max(y,-1),1))}const CO=NV,TO=bO,bv=kV;(function(){const t=vO();return function(e,r,n,i,o,s){let u,d;for(r||(r=3),n||(n=0),i?d=Math.min(i*r+n,e.length):d=e.length,u=n;u<d;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],o(t,t,s),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}})();const xv=[0,0,0];let m0;class ut extends Rx{static get ZERO(){return m0||(m0=new ut(0,0,0),Object.freeze(m0)),m0}constructor(e=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&Iu(e)?this.copy(e):(As.debug&&(Hn(e),Hn(r),Hn(n)),this[0]=e,this[1]=r,this[2]=n)}set(e,r,n){return this[0]=e,this[1]=r,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return As.debug&&(Hn(e.x),Hn(e.y),Hn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Hn(e)}angle(e){return $V(this,e)}cross(e){return hm(this,this,e),this.check()}rotateX({radians:e,origin:r=xv}){return VV(this,this,r,e),this.check()}rotateY({radians:e,origin:r=xv}){return HV(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=xv}){return jV(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ox(this,this,e),this.check()}transformAsVector(e){return _O(this,this,e),this.check()}transformByMatrix3(e){return xO(this,this,e),this.check()}transformByMatrix2(e){return OV(this,this,e),this.check()}transformByQuaternion(e){return wO(this,this,e),this.check()}}let _0;class Lx extends Rx{static get ZERO(){return _0||(_0=new Lx(0,0,0,0),Object.freeze(_0)),_0}constructor(e=0,r=0,n=0,i=0){super(-0,-0,-0,-0),Iu(e)&&arguments.length===1?this.copy(e):(As.debug&&(Hn(e),Hn(r),Hn(n),Hn(i)),this[0]=e,this[1]=r,this[2]=n,this[3]=i)}set(e,r,n,i){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return As.debug&&(Hn(e.x),Hn(e.y),Hn(e.z),Hn(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Hn(e)}get w(){return this[3]}set w(e){this[3]=Hn(e)}transform(e){return Ox(this,this,e),this.check()}transformByMatrix3(e){return yO(this,this,e),this.check()}transformByMatrix2(e){return LV(this,this,e),this.check()}transformByQuaternion(e){return wO(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class EO extends Px{toString(){let e="[";if(As.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,n){return this[r*this.RANK+e]=Hn(n),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(e,r){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}}function WV(){const t=new ac(9);return ac!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function JV(t,e){if(t===e){const r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function XV(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],u=e[5],d=e[6],y=e[7],x=e[8],E=x*s-u*y,S=-x*o+u*d,O=y*o-s*d;let k=r*E+n*S+i*O;return k?(k=1/k,t[0]=E*k,t[1]=(-x*n+i*y)*k,t[2]=(u*n-i*s)*k,t[3]=S*k,t[4]=(x*r-i*d)*k,t[5]=(-u*r+i*o)*k,t[6]=O*k,t[7]=(-y*r+n*d)*k,t[8]=(s*r-n*o)*k,t):null}function KV(t){const e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],u=t[6],d=t[7],y=t[8];return e*(y*o-s*d)+r*(-y*i+s*u)+n*(d*i-o*u)}function FB(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],u=e[4],d=e[5],y=e[6],x=e[7],E=e[8],S=r[0],O=r[1],k=r[2],U=r[3],J=r[4],G=r[5],H=r[6],K=r[7],he=r[8];return t[0]=S*n+O*s+k*y,t[1]=S*i+O*u+k*x,t[2]=S*o+O*d+k*E,t[3]=U*n+J*s+G*y,t[4]=U*i+J*u+G*x,t[5]=U*o+J*d+G*E,t[6]=H*n+K*s+he*y,t[7]=H*i+K*u+he*x,t[8]=H*o+K*d+he*E,t}function qV(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],u=e[4],d=e[5],y=e[6],x=e[7],E=e[8],S=r[0],O=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=s,t[4]=u,t[5]=d,t[6]=S*n+O*s+y,t[7]=S*i+O*u+x,t[8]=S*o+O*d+E,t}function YV(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],u=e[4],d=e[5],y=e[6],x=e[7],E=e[8],S=Math.sin(r),O=Math.cos(r);return t[0]=O*n+S*s,t[1]=O*i+S*u,t[2]=O*o+S*d,t[3]=O*s-S*n,t[4]=O*u-S*i,t[5]=O*d-S*o,t[6]=y,t[7]=x,t[8]=E,t}function DB(t,e,r){const n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ZV(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,u=n+n,d=i+i,y=r*s,x=n*s,E=n*u,S=i*s,O=i*u,k=i*d,U=o*s,J=o*u,G=o*d;return t[0]=1-E-k,t[3]=x-G,t[6]=S+J,t[1]=x+G,t[4]=1-y-k,t[7]=O-U,t[2]=S-J,t[5]=O+U,t[8]=1-y-E,t}var k1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(k1||(k1={}));const QV=Object.freeze([1,0,0,0,1,0,0,0,1]);class ci extends EO{static get IDENTITY(){return tH()}static get ZERO(){return eH()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return k1}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(QV)}fromObject(e){return this.check()}fromQuaternion(e){return ZV(this,e),this.check()}set(e,r,n,i,o,s,u,d,y){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=u,this[7]=d,this[8]=y,this.check()}setRowMajor(e,r,n,i,o,s,u,d,y){return this[0]=e,this[1]=i,this[2]=u,this[3]=r,this[4]=o,this[5]=d,this[6]=n,this[7]=s,this[8]=y,this.check()}determinant(){return KV(this)}transpose(){return JV(this,this),this.check()}invert(){return XV(this,this),this.check()}multiplyLeft(e){return FB(this,e,this),this.check()}multiplyRight(e){return FB(this,this,e),this.check()}rotate(e){return YV(this,this,e),this.check()}scale(e){return Array.isArray(e)?DB(this,this,e):DB(this,this,[e,e]),this.check()}translate(e){return qV(this,this,e),this.check()}transform(e,r){let n;switch(e.length){case 2:n=pO(r||[-0,-0],e,this);break;case 3:n=xO(r||[-0,-0,-0],e,this);break;case 4:n=yO(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Rp(n,e.length),n}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}}let y0,v0=null;function eH(){return y0||(y0=new ci([0,0,0,0,0,0,0,0,0]),Object.freeze(y0)),y0}function tH(){return v0||(v0=new ci,Object.freeze(v0)),v0}function rH(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nH(t,e){if(t===e){const r=e[1],n=e[2],i=e[3],o=e[6],s=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function U1(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],u=e[5],d=e[6],y=e[7],x=e[8],E=e[9],S=e[10],O=e[11],k=e[12],U=e[13],J=e[14],G=e[15],H=r*u-n*s,K=r*d-i*s,he=r*y-o*s,Y=n*d-i*u,oe=n*y-o*u,Ee=i*y-o*d,ze=x*U-E*k,de=x*J-S*k,ve=x*G-O*k,Ae=E*J-S*U,$=E*G-O*U,re=S*G-O*J;let Te=H*re-K*$+he*Ae+Y*ve-oe*de+Ee*ze;return Te?(Te=1/Te,t[0]=(u*re-d*$+y*Ae)*Te,t[1]=(i*$-n*re-o*Ae)*Te,t[2]=(U*Ee-J*oe+G*Y)*Te,t[3]=(S*oe-E*Ee-O*Y)*Te,t[4]=(d*ve-s*re-y*de)*Te,t[5]=(r*re-i*ve+o*de)*Te,t[6]=(J*he-k*Ee-G*K)*Te,t[7]=(x*Ee-S*he+O*K)*Te,t[8]=(s*$-u*ve+y*ze)*Te,t[9]=(n*ve-r*$-o*ze)*Te,t[10]=(k*oe-U*he+G*H)*Te,t[11]=(E*he-x*oe-O*H)*Te,t[12]=(u*de-s*Ae-d*ze)*Te,t[13]=(r*Ae-n*de+i*ze)*Te,t[14]=(U*K-k*Y-J*H)*Te,t[15]=(x*Y-E*K+S*H)*Te,t):null}function iH(t){const e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],u=t[6],d=t[7],y=t[8],x=t[9],E=t[10],S=t[11],O=t[12],k=t[13],U=t[14],J=t[15],G=e*s-r*o,H=e*u-n*o,K=r*u-n*s,he=y*k-x*O,Y=y*U-E*O,oe=x*U-E*k,Ee=e*oe-r*Y+n*he,ze=o*oe-s*Y+u*he,de=y*K-x*H+E*G,ve=O*K-k*H+U*G;return d*Ee-i*ze+J*de-S*ve}function Lf(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],u=e[4],d=e[5],y=e[6],x=e[7],E=e[8],S=e[9],O=e[10],k=e[11],U=e[12],J=e[13],G=e[14],H=e[15];let K=r[0],he=r[1],Y=r[2],oe=r[3];return t[0]=K*n+he*u+Y*E+oe*U,t[1]=K*i+he*d+Y*S+oe*J,t[2]=K*o+he*y+Y*O+oe*G,t[3]=K*s+he*x+Y*k+oe*H,K=r[4],he=r[5],Y=r[6],oe=r[7],t[4]=K*n+he*u+Y*E+oe*U,t[5]=K*i+he*d+Y*S+oe*J,t[6]=K*o+he*y+Y*O+oe*G,t[7]=K*s+he*x+Y*k+oe*H,K=r[8],he=r[9],Y=r[10],oe=r[11],t[8]=K*n+he*u+Y*E+oe*U,t[9]=K*i+he*d+Y*S+oe*J,t[10]=K*o+he*y+Y*O+oe*G,t[11]=K*s+he*x+Y*k+oe*H,K=r[12],he=r[13],Y=r[14],oe=r[15],t[12]=K*n+he*u+Y*E+oe*U,t[13]=K*i+he*d+Y*S+oe*J,t[14]=K*o+he*y+Y*O+oe*G,t[15]=K*s+he*x+Y*k+oe*H,t}function Wm(t,e,r){const n=r[0],i=r[1],o=r[2];let s,u,d,y,x,E,S,O,k,U,J,G;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],u=e[1],d=e[2],y=e[3],x=e[4],E=e[5],S=e[6],O=e[7],k=e[8],U=e[9],J=e[10],G=e[11],t[0]=s,t[1]=u,t[2]=d,t[3]=y,t[4]=x,t[5]=E,t[6]=S,t[7]=O,t[8]=k,t[9]=U,t[10]=J,t[11]=G,t[12]=s*n+x*i+k*o+e[12],t[13]=u*n+E*i+U*o+e[13],t[14]=d*n+S*i+J*o+e[14],t[15]=y*n+O*i+G*o+e[15]),t}function Nx(t,e,r){const n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sH(t,e,r,n){let i=n[0],o=n[1],s=n[2],u=Math.sqrt(i*i+o*o+s*s),d,y,x,E,S,O,k,U,J,G,H,K,he,Y,oe,Ee,ze,de,ve,Ae,$,re,Te,Qe;return u<Fp?null:(u=1/u,i*=u,o*=u,s*=u,y=Math.sin(r),d=Math.cos(r),x=1-d,E=e[0],S=e[1],O=e[2],k=e[3],U=e[4],J=e[5],G=e[6],H=e[7],K=e[8],he=e[9],Y=e[10],oe=e[11],Ee=i*i*x+d,ze=o*i*x+s*y,de=s*i*x-o*y,ve=i*o*x-s*y,Ae=o*o*x+d,$=s*o*x+i*y,re=i*s*x+o*y,Te=o*s*x-i*y,Qe=s*s*x+d,t[0]=E*Ee+U*ze+K*de,t[1]=S*Ee+J*ze+he*de,t[2]=O*Ee+G*ze+Y*de,t[3]=k*Ee+H*ze+oe*de,t[4]=E*ve+U*Ae+K*$,t[5]=S*ve+J*Ae+he*$,t[6]=O*ve+G*Ae+Y*$,t[7]=k*ve+H*Ae+oe*$,t[8]=E*re+U*Te+K*Qe,t[9]=S*re+J*Te+he*Qe,t[10]=O*re+G*Te+Y*Qe,t[11]=k*re+H*Te+oe*Qe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function BO(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[4],s=e[5],u=e[6],d=e[7],y=e[8],x=e[9],E=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+y*n,t[5]=s*i+x*n,t[6]=u*i+E*n,t[7]=d*i+S*n,t[8]=y*i-o*n,t[9]=x*i-s*n,t[10]=E*i-u*n,t[11]=S*i-d*n,t}function oH(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],u=e[2],d=e[3],y=e[8],x=e[9],E=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-y*n,t[1]=s*i-x*n,t[2]=u*i-E*n,t[3]=d*i-S*n,t[8]=o*n+y*i,t[9]=s*n+x*i,t[10]=u*n+E*i,t[11]=d*n+S*i,t}function SO(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],u=e[2],d=e[3],y=e[4],x=e[5],E=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+y*n,t[1]=s*i+x*n,t[2]=u*i+E*n,t[3]=d*i+S*n,t[4]=y*i-o*n,t[5]=x*i-s*n,t[6]=E*i-u*n,t[7]=S*i-d*n,t}function aH(t,e){const r=e[0],n=e[1],i=e[2],o=e[4],s=e[5],u=e[6],d=e[8],y=e[9],x=e[10];return t[0]=Math.sqrt(r*r+n*n+i*i),t[1]=Math.sqrt(o*o+s*s+u*u),t[2]=Math.sqrt(d*d+y*y+x*x),t}function cH(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=r+r,u=n+n,d=i+i,y=r*s,x=n*s,E=n*u,S=i*s,O=i*u,k=i*d,U=o*s,J=o*u,G=o*d;return t[0]=1-E-k,t[1]=x+G,t[2]=S-J,t[3]=0,t[4]=x-G,t[5]=1-y-k,t[6]=O+U,t[7]=0,t[8]=S+J,t[9]=O-U,t[10]=1-y-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lH(t,e,r,n,i,o,s){const u=1/(r-e),d=1/(i-n),y=1/(o-s);return t[0]=o*2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*d,t[6]=0,t[7]=0,t[8]=(r+e)*u,t[9]=(i+n)*d,t[10]=(s+o)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*y,t[15]=0,t}function uH(t,e,r,n,i){const o=1/Math.tan(e/2);if(t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const s=1/(n-i);t[10]=(i+n)*s,t[14]=2*i*n*s}else t[10]=-1,t[14]=-2*n;return t}const fH=uH;function hH(t,e,r,n,i,o,s){const u=1/(e-r),d=1/(n-i),y=1/(o-s);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+r)*u,t[13]=(i+n)*d,t[14]=(s+o)*y,t[15]=1,t}const dH=hH;function AH(t,e,r,n){let i,o,s,u,d,y,x,E,S,O;const k=e[0],U=e[1],J=e[2],G=n[0],H=n[1],K=n[2],he=r[0],Y=r[1],oe=r[2];return Math.abs(k-he)<Fp&&Math.abs(U-Y)<Fp&&Math.abs(J-oe)<Fp?rH(t):(E=k-he,S=U-Y,O=J-oe,i=1/Math.sqrt(E*E+S*S+O*O),E*=i,S*=i,O*=i,o=H*O-K*S,s=K*E-G*O,u=G*S-H*E,i=Math.sqrt(o*o+s*s+u*u),i?(i=1/i,o*=i,s*=i,u*=i):(o=0,s=0,u=0),d=S*u-O*s,y=O*o-E*u,x=E*s-S*o,i=Math.sqrt(d*d+y*y+x*x),i?(i=1/i,d*=i,y*=i,x*=i):(d=0,y=0,x=0),t[0]=o,t[1]=d,t[2]=E,t[3]=0,t[4]=s,t[5]=y,t[6]=S,t[7]=0,t[8]=u,t[9]=x,t[10]=O,t[11]=0,t[12]=-(o*k+s*U+u*J),t[13]=-(d*k+y*U+x*J),t[14]=-(E*k+S*U+O*J),t[15]=1,t)}function pH(){const t=new ac(4);return ac!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function gH(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function kx(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function mH(t){const e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)}function _H(t){const e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function yH(t,e){const r=e[0],n=e[1],i=e[2],o=e[3];let s=r*r+n*n+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=n*s,t[2]=i*s,t[3]=o*s,t}function vH(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function bH(t,e,r,n){const i=e[0],o=e[1],s=e[2],u=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=s+n*(r[2]-s),t[3]=u+n*(r[3]-u),t}function xA(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,t}function xH(t,e,r){const n=e[0],i=e[1],o=e[2],s=r[0],u=r[1],d=r[2],y=r[3],x=y*n+u*o-d*i,E=y*i+d*n-s*o,S=y*o+s*i-u*n,O=-s*n-u*i-d*o;return t[0]=x*y+O*-s+E*-d-S*-u,t[1]=E*y+O*-u+S*-s-x*-d,t[2]=S*y+O*-d+x*-u-E*-s,t[3]=e[3],t}(function(){const t=pH();return function(e,r,n,i,o,s){let u,d;for(r||(r=4),n||(n=0),i?d=Math.min(i*r+n,e.length):d=e.length,u=n;u<d;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],o(t,t,s),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}})();var z1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(z1||(z1={}));const wH=45*Math.PI/180,CH=1,wv=.1,Cv=500,TH=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class An extends EO{static get IDENTITY(){return BH()}static get ZERO(){return EH()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return z1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,n,i,o,s,u,d,y,x,E,S,O,k,U,J){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=s,this[6]=u,this[7]=d,this[8]=y,this[9]=x,this[10]=E,this[11]=S,this[12]=O,this[13]=k,this[14]=U,this[15]=J,this.check()}setRowMajor(e,r,n,i,o,s,u,d,y,x,E,S,O,k,U,J){return this[0]=e,this[1]=o,this[2]=y,this[3]=O,this[4]=r,this[5]=s,this[6]=x,this[7]=k,this[8]=n,this[9]=u,this[10]=E,this[11]=U,this[12]=i,this[13]=d,this[14]=S,this[15]=J,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(TH)}fromObject(e){return this.check()}fromQuaternion(e){return cH(this,e),this.check()}frustum(e){const{left:r,right:n,bottom:i,top:o,near:s=wv,far:u=Cv}=e;return u===1/0?SH(this,r,n,i,o,s):lH(this,r,n,i,o,s,u),this.check()}lookAt(e){const{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=e;return AH(this,r,n,i),this.check()}ortho(e){const{left:r,right:n,bottom:i,top:o,near:s=wv,far:u=Cv}=e;return dH(this,r,n,i,o,s,u),this.check()}orthographic(e){const{fovy:r=wH,aspect:n=CH,focalDistance:i=1,near:o=wv,far:s=Cv}=e;OB(r);const u=r/2,d=i*Math.tan(u),y=d*n;return this.ortho({left:-y,right:y,bottom:-d,top:d,near:o,far:s})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=e;return OB(r),fH(this,r,n,i,o),this.check()}determinant(){return iH(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],o=1/n[1],s=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*s,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*s,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*s,e}transpose(){return nH(this,this),this.check()}invert(){return U1(this,this),this.check()}multiplyLeft(e){return Lf(this,e,this),this.check()}multiplyRight(e){return Lf(this,this,e),this.check()}rotateX(e){return BO(this,this,e),this.check()}rotateY(e){return oH(this,this,e),this.check()}rotateZ(e){return SO(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return sH(this,this,e,r),this.check()}scale(e){return Nx(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Wm(this,this,e),this.check()}transform(e,r){return e.length===4?(r=xA(r||[-0,-0,-0,-0],e,this),Rp(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:n}=e;let i;switch(n){case 2:i=gO(r||[-0,-0],e,this);break;case 3:i=Ox(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Rp(i,e.length),i}transformAsVector(e,r){let n;switch(e.length){case 2:n=mO(r||[-0,-0],e,this);break;case 3:n=_O(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Rp(n,e.length),n}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,n){return this.identity().translate([e,r,n])}}let b0,x0;function EH(){return b0||(b0=new An([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(b0)),b0}function BH(){return x0||(x0=new An,Object.freeze(x0)),x0}function OB(t){if(t>Math.PI*2)throw Error("expected radians")}function SH(t,e,r,n,i,o){const s=2*o/(r-e),u=2*o/(i-n),d=(r+e)/(r-e),y=(i+n)/(i-n),x=-1,E=-1,S=-2*o;return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=d,t[9]=y,t[10]=x,t[11]=E,t[12]=0,t[13]=0,t[14]=S,t[15]=0,t}function LB(){const t=new ac(4);return ac!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function IH(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function IO(t,e,r){r=r*.5;const n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function NB(t,e,r){const n=e[0],i=e[1],o=e[2],s=e[3],u=r[0],d=r[1],y=r[2],x=r[3];return t[0]=n*x+s*u+i*y-o*d,t[1]=i*x+s*d+o*u-n*y,t[2]=o*x+s*y+n*d-i*u,t[3]=s*x-n*u-i*d-o*y,t}function MH(t,e,r){r*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],u=Math.sin(r),d=Math.cos(r);return t[0]=n*d+s*u,t[1]=i*d+o*u,t[2]=o*d-i*u,t[3]=s*d-n*u,t}function PH(t,e,r){r*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],u=Math.sin(r),d=Math.cos(r);return t[0]=n*d-o*u,t[1]=i*d+s*u,t[2]=o*d+n*u,t[3]=s*d-i*u,t}function RH(t,e,r){r*=.5;const n=e[0],i=e[1],o=e[2],s=e[3],u=Math.sin(r),d=Math.cos(r);return t[0]=n*d+i*u,t[1]=i*d-n*u,t[2]=o*d+s*u,t[3]=s*d-o*u,t}function FH(t,e){const r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t}function dm(t,e,r,n){const i=e[0],o=e[1],s=e[2],u=e[3];let d=r[0],y=r[1],x=r[2],E=r[3],S,O,k,U,J;return S=i*d+o*y+s*x+u*E,S<0&&(S=-S,d=-d,y=-y,x=-x,E=-E),1-S>Fp?(O=Math.acos(S),J=Math.sin(O),k=Math.sin((1-n)*O)/J,U=Math.sin(n*O)/J):(k=1-n,U=n),t[0]=k*i+U*d,t[1]=k*o+U*y,t[2]=k*s+U*x,t[3]=k*u+U*E,t}function DH(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],s=r*r+n*n+i*i+o*o,u=s?1/s:0;return t[0]=-r*u,t[1]=-n*u,t[2]=-i*u,t[3]=o*u,t}function OH(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function MO(t,e){const r=e[0]+e[4]+e[8];let n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[s*3+s]+1),t[i]=.5*n,n=.5/n,t[3]=(e[o*3+s]-e[s*3+o])*n,t[o]=(e[o*3+i]+e[i*3+o])*n,t[s]=(e[s*3+i]+e[i*3+s])*n}return t}const LH=gH,NH=kx,kH=vH,UH=bH,zH=mH,GH=_H,PO=yH,VH=function(){const t=vO(),e=RB(1,0,0),r=RB(0,1,0);return function(n,i,o){const s=Dx(i,o);return s<-.999999?(hm(t,e,i),TO(t)<1e-6&&hm(t,r,i),zV(t,t),IO(n,t,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(hm(t,i,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,PO(n,n))}}();(function(){const t=LB(),e=LB();return function(r,n,i,o,s,u){return dm(t,n,s,u),dm(e,i,o,u),dm(r,t,e,2*u*(1-u)),r}})();(function(){const t=WV();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],PO(e,MO(e,t))}})();const HH=[0,0,0,1];class Kp extends Px{constructor(e=0,r=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,n,i){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return MO(this,e),this.check()}fromAxisRotation(e,r){return IO(this,e,r),this.check()}identity(){return IH(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Hn(e)}get y(){return this[1]}set y(e){this[1]=Hn(e)}get z(){return this[2]}set z(e){this[2]=Hn(e)}get w(){return this[3]}set w(e){this[3]=Hn(e)}len(){return zH(this)}lengthSquared(){return GH(this)}dot(e){return kH(this,e)}rotationTo(e,r){return VH(this,e,r),this.check()}add(e){return LH(this,this,e),this.check()}calculateW(){return FH(this,this),this.check()}conjugate(){return OH(this,this),this.check()}invert(){return DH(this,this),this.check()}lerp(e,r,n){return n===void 0?this.lerp(this,e,r):(UH(this,e,r,n),this.check())}multiplyRight(e){return NB(this,this,e),this.check()}multiplyLeft(e){return NB(this,e,this),this.check()}normalize(){const e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return MH(this,this,e),this.check()}rotateY(e){return PH(this,this,e),this.check()}rotateZ(e){return RH(this,this,e),this.check()}scale(e){return NH(this,this,e),this.check()}slerp(e,r,n){let i,o,s;switch(arguments.length){case 1:({start:i=HH,target:o,ratio:s}=e);break;case 2:i=this,o=e,s=r;break;default:i=e,o=r,s=n}return dm(this,i,o,s),this.check()}transformVector4(e,r=new Lx){return xH(r,e,this),Rp(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const jH=.1,$H=1e-12,RO=1e-15,WH=1e-20;function FO(t,e=[],r=0){const n=Math.fround(t),i=t-n;return e[r]=n,e[r+1]=i,e}function JH(t){return t-Math.fround(t)}function XH(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const i=r*4+n;FO(t[n*4+r],e,i*2)}return e}const KH=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,qH={name:"fp32",vs:KH},YH=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,ZH={ONE:1},QH={name:"fp64arithmetic",vs:YH,defaultUniforms:ZH,uniformTypes:{ONE:"f32"},fp64ify:FO,fp64LowPart:JH,fp64ifyMatrix4:XH},ej=[0,1,1,1],tj=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,rj=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,kB={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:ej},vs:tj,fs:rj,getUniforms:nj};function nj(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}const UB=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,ij=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,DO=3,sj=255;var qp;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(qp||(qp={}));const Kd={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:DO},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:qp.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:ij,vs:UB,fs:UB,getUniforms:oj};function oj(t,e={}){if(t=t&&{...t},!t)return{...Kd.defaultUniforms};t.lights&&(t={...t,...cj(t.lights),lights:void 0});const{ambientLight:r,pointLights:n,directionalLights:i}=t||{};if(!(r||n&&n.length>0||i&&i.length>0))return{...Kd.defaultUniforms,enabled:0};const s={...Kd.defaultUniforms,...e,...aj({ambientLight:r,pointLights:n,directionalLights:i})};return t.enabled!==void 0&&(s.enabled=t.enabled?1:0),s}function aj({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){const n={};n.ambientLightColor=Tv(t);let i=0;for(const o of e){n.lightType=qp.POINT;const s=i;n[`lightColor${s}`]=Tv(o),n[`lightPosition${s}`]=o.position,n[`lightAttenuation${s}`]=o.attenuation||[1,0,0],i++}for(const o of r){n.lightType=qp.DIRECTIONAL;const s=i;n[`lightColor${s}`]=Tv(o),n[`lightDirection${s}`]=o.direction,i++}return i>DO&&Xt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=e.length,n}function cj(t){const e={pointLights:[],directionalLights:[]};for(const r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break}return e}function Tv(t={}){const{color:e=[0,0,0],intensity:r=1}=t;return e.map(n=>n*r/sj)}const OO=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,LO=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,D_={props:{},name:"gouraudMaterial",vs:LO.replace("phongMaterial","gouraudMaterial"),fs:OO.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Kd],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...D_.defaultUniforms,...e}}},lj=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Ux={name:"phongMaterial",dependencies:[Kd],source:lj,vs:OO,fs:LO,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...Ux.defaultUniforms,...e}}},uj=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fj=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,zB=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,hj={name:"pbrProjection",vs:zB,fs:zB,getUniforms:t=>t,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},zx={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Kd,hj],vs:uj,fs:fj,defines:{LIGHTING_FRAGMENT:1},getUniforms:t=>t,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},GB=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,dj={name:"layer",vs:GB,fs:GB,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Aj=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,NO="#define SMOOTH_EDGE_RADIUS 0.5",pj=`${NO}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,gj=`${NO}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,kO={name:"geometry",source:Aj,vs:pj,fs:gj},mj=25;var ss;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(ss||(ss={}));var ds;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(ds||(ds={}));var dn;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(dn||(dn={}));const _j="compute",yj="auto",G1="manipulation",Am="none",V1="pan-x",H1="pan-y";function vj(t){if(t.includes(Am))return Am;const e=t.includes(V1),r=t.includes(H1);return e&&r?Am:e||r?e?V1:H1:t.includes(G1)?G1:yj}class bj{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===_j&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return vj(e.join(" "))}}function Jm(t){return t.trim().split(/\s+/g)}function Ev(t,e,r){if(t)for(const n of Jm(e))t.addEventListener(n,r,!1)}function Bv(t,e,r){if(t)for(const n of Jm(e))t.removeEventListener(n,r,!1)}function VB(t){return(t.ownerDocument||t).defaultView}function xj(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function UO(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,n=0,i=0;for(;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:Math.round(r/e),y:Math.round(n/e)}}function HB(t){const e=[];let r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:UO(e),deltaX:t.deltaX,deltaY:t.deltaY}}function zO(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function jB(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)}function wj(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)*180/Math.PI}function $B(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,r)*180/Math.PI}function GO(t,e){return t===e?ds.None:Math.abs(t)>=Math.abs(e)?t<0?ds.Left:ds.Right:e<0?ds.Up:ds.Down}function Cj(t,e){const r=e.center;let n=t.offsetDelta,i=t.prevDelta;const o=t.prevInput;return(e.eventType===ss.Start||o?.eventType===ss.End)&&(i=t.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},n=t.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function VO(t,e,r){return{x:e/t||0,y:r/t||0}}function Tj(t,e){return jB(e[0],e[1])/jB(t[0],t[1])}function Ej(t,e){return $B(e[1],e[0])-$B(t[1],t[0])}function Bj(t,e){const r=t.lastInterval||e,n=e.timeStamp-r.timeStamp;let i,o,s,u;if(e.eventType!==ss.Cancel&&(n>mj||r.velocity===void 0)){const d=e.deltaX-r.deltaX,y=e.deltaY-r.deltaY,x=VO(n,d,y);o=x.x,s=x.y,i=Math.abs(x.x)>Math.abs(x.y)?x.x:x.y,u=GO(d,y),t.lastInterval=e}else i=r.velocity,o=r.velocityX,s=r.velocityY,u=r.direction;e.velocity=i,e.velocityX=o,e.velocityY=s,e.direction=u}function Sj(t,e){const{session:r}=t,{pointers:n}=e,{length:i}=n;r.firstInput||(r.firstInput=HB(e)),i>1&&!r.firstMultiple?r.firstMultiple=HB(e):i===1&&(r.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=r,u=s?s.center:o.center,d=e.center=UO(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=wj(u,d),e.distance=zO(u,d);const{deltaX:y,deltaY:x}=Cj(r,e);e.deltaX=y,e.deltaY=x,e.offsetDirection=GO(e.deltaX,e.deltaY);const E=VO(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=E.x,e.overallVelocityY=E.y,e.overallVelocity=Math.abs(E.x)>Math.abs(E.y)?E.x:E.y,e.scale=s?Tj(s.pointers,n):1,e.rotation=s?Ej(s.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let S=t.element;return xj(e.srcEvent.target,S)&&(S=e.srcEvent.target),e.target=S,Bj(r,e),e}function Ij(t,e,r){const n=r.pointers.length,i=r.changedPointers.length,o=e&ss.Start&&n-i===0,s=e&(ss.End|ss.Cancel)&&n-i===0;r.isFirst=!!o,r.isFinal=!!s,o&&(t.session={}),r.eventType=e;const u=Sj(t,r);t.emit("hammer.input",u),t.recognize(u),t.session.prevInput=u}let Mj=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){Ij(this.manager,e,r)}init(){Ev(this.element,this.evEl,this.domHandler),Ev(this.target,this.evTarget,this.domHandler),Ev(VB(this.element),this.evWin,this.domHandler)}destroy(){Bv(this.element,this.evEl,this.domHandler),Bv(this.target,this.evTarget,this.domHandler),Bv(VB(this.element),this.evWin,this.domHandler)}};const Pj={pointerdown:ss.Start,pointermove:ss.Move,pointerup:ss.End,pointercancel:ss.Cancel,pointerout:ss.Cancel},Rj="pointerdown",Fj="pointermove pointerup pointercancel";class Dj extends Mj{constructor(e){super(e),this.evEl=Rj,this.evWin=Fj,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:r}=this;let n=!1;const i=Pj[e.type],o=e.pointerType,s=o==="touch";let u=r.findIndex(d=>d.pointerId===e.pointerId);i&ss.Start&&(e.buttons||s)?u<0&&(r.push(e),u=r.length-1):i&(ss.End|ss.Cancel)&&(n=!0),!(u<0)&&(r[u]=e,this.callback(i,{pointers:r,changedPointers:[e],eventType:i,pointerType:o,srcEvent:e}),n&&r.splice(u,1))}}const Oj=["","webkit","Moz","MS","ms","o"];function Lj(t,e){const r=e[0].toUpperCase()+e.slice(1);for(const n of Oj){const i=n?n+r:e;if(i in t)return i}}const Nj=1,WB=2,JB={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};let kj=class{constructor(e,r){this.options={...JB,...r,cssProps:{...JB.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Dj(this),this.touchAction=new bj(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?WB:Nj}recognize(e){const{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:o}=r;(!o||o&&o.state&dn.Recognized)&&(o=r.curRecognizer=null);let s=0;for(;s<i.length;)n=i[s],r.stopped!==WB&&(!o||n===o||n.canRecognizeWith(o))?n.recognize(e):n.reset(),!o&&n.state&(dn.Began|dn.Changed|dn.Ended)&&(o=r.curRecognizer=n),s++}get(e){const{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===e)return r[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const r=typeof e=="string"?this.get(e):e;if(r){const{recognizers:n}=this,i=n.indexOf(r);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;const{handlers:n}=this;for(const i of Jm(e))n[i]=n[i]||[],n[i].push(r)}off(e,r){if(!e)return;const{handlers:n}=this;for(const i of Jm(e))r?n[i]&&n[i].splice(n[i].indexOf(r),1):delete n[i]}emit(e,r){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=r;i.type=e,i.preventDefault=function(){r.srcEvent.preventDefault()};let o=0;for(;o<n.length;)n[o](i),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:r}=this;if(r){for(const[n,i]of Object.entries(this.options.cssProps)){const o=Lj(r.style,n);e?(this.oldCssProps[o]=r.style[o],r.style[o]=i):r.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}},Uj=1;function zj(){return Uj++}function XB(t){return t&dn.Cancelled?"cancel":t&dn.Ended?"end":t&dn.Changed?"move":t&dn.Began?"start":""}class HO{constructor(e){this.options=e,this.id=zj(),this.state=dn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){const n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:r}=this;r<dn.Ended&&this.manager.emit(this.options.event+XB(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=dn.Ended&&this.manager.emit(this.options.event+XB(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=dn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(dn.Failed|dn.Possible)))return!1;e++}return!0}recognize(e){const r={...e};if(!this.options.enable){this.reset(),this.state=dn.Failed;return}this.state&(dn.Recognized|dn.Cancelled|dn.Failed)&&(this.state=dn.Possible),this.state=this.process(r),this.state&(dn.Began|dn.Changed|dn.Ended|dn.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class jO extends HO{attrTest(e){const r=this.options.pointers;return r===0||e.pointers.length===r}process(e){const{state:r}=this,{eventType:n}=e,i=r&(dn.Began|dn.Changed),o=this.attrTest(e);return i&&(n&ss.Cancel||!o)?r|dn.Cancelled:i||o?n&ss.End?r|dn.Ended:r&dn.Began?r|dn.Changed:dn.Began:dn.Failed}}class KB extends HO{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[G1]}process(e){const{options:r}=this,n=e.pointers.length===r.pointers,i=e.distance<r.threshold,o=e.deltaTime<r.time;if(this.reset(),e.eventType&ss.Start&&this.count===0)return this.failTimeout();if(i&&o&&n){if(e.eventType!==ss.End)return this.failTimeout();const s=this.pTime?e.timeStamp-this.pTime<r.interval:!0,u=!this.pCenter||zO(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!s?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=dn.Recognized,this.tryEmit(this._input)},r.interval),dn.Began):dn.Recognized}return dn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=dn.Failed},this.options.interval),dn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===dn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const Gj=["","start","move","end","cancel","up","down","left","right"];class qB extends jO{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ds.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,r=[];return e&ds.Horizontal&&r.push(H1),e&ds.Vertical&&r.push(V1),r}getEventNames(){return Gj.map(e=>this.options.event+e)}directionTest(e){const{options:r}=this;let n=!0,{distance:i}=e,{direction:o}=e;const s=e.deltaX,u=e.deltaY;return o&r.direction||(r.direction&ds.Horizontal?(o=s===0?ds.None:s<0?ds.Left:ds.Right,n=s!==this.pX,i=Math.abs(e.deltaX)):(o=u===0?ds.None:u<0?ds.Up:ds.Down,n=u!==this.pY,i=Math.abs(e.deltaY))),e.direction=o,n&&i>r.threshold&&!!(o&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&dn.Began)||!(this.state&dn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const r=ds[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}}const Vj=["","start","move","end","cancel","in","out"];class Hj extends jO{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Am]}getEventNames(){return Vj.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&dn.Began))}emit(e){if(e.scale!==1){const r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}}let O_=class{constructor(e,r,n){this.element=e,this.callback=r,this.options=n}};const jj=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",$j=jj.indexOf("firefox")!==-1,YB=4.000244140625,Wj=40,Jj=.25;let Xj=class extends O_{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;globalThis.WheelEvent&&($j&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=Wj)),o!==0&&o%YB===0&&(o=Math.floor(o/YB)),i.shiftKey&&o&&(o=o*Jj),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}};const ZB=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];let Kj=class extends O_{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,ZB.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){ZB.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};const QB=["keydown","keyup"];let qj=class extends O_{constructor(e,r,n){super(e,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",QB.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){QB.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}},Yj=class extends O_{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}};const eS=1,j1=2,tS=4,Zj={pointerdown:eS,pointermove:j1,pointerup:tS,mousedown:eS,mousemove:j1,mouseup:tS},Qj=0,e$=1,t$=2,r$=1,n$=2,i$=4;function s$(t){const e=Zj[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let i=!1,o=!1,s=!1;return e===j1?(i=!!(r&r$),o=!!(r&i$),s=!!(r&n$)):(i=n===Qj,o=n===e$,s=n===t$),{leftButton:i,middleButton:o,rightButton:s}}function o$(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/o};return{center:r,offsetCenter:s}}const a$={srcElement:"root",priority:0};let c$=class{constructor(e,r){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,i=!1,o=!1){const{handlers:s,handlersByElement:u}=this,d={...a$,...n};let y=u.get(d.srcElement);y||(y=[],u.set(d.srcElement,y));const x={type:e,handler:r,srcElement:d.srcElement,priority:d.priority};i&&(x.once=!0),o&&(x.passive=!0),s.push(x),this._active=this._active||!x.passive;let E=y.length-1;for(;E>=0&&!(y[E].priority>=x.priority);)E--;y.splice(E+1,0,x)}remove(e,r){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===e&&s.handler===r){n.splice(o,1);const u=i.get(s.srcElement);u.splice(u.indexOf(s),1),u.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let i=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,i=!0},u=[];for(let d=0;d<n.length;d++){const{type:y,handler:x,once:E}=n[d];if(x({...e,type:y,stopPropagation:o,stopImmediatePropagation:s}),E&&u.push(n[d]),i)break}for(let d=0;d<u.length;d++){const{type:y,handler:x}=u[d];this.remove(y,x)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...s$(e),...o$(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function l$(t){if("recognizer"in t)return t;let e;const r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){const n=r.shift(),i=r.shift()||{};e=new n(i)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}let u$=class{constructor(e=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new kj(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:o,requireFailure:s}=l$(n);this.manager.add(i),o&&i.recognizeWith(o),s&&i.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Xj(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Kj(e,this._onOtherEvent,{enable:!1}),this.keyInput=new qj(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new Yj(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:r}),n.touchAction.update()),this.wheelInput?.enableEventType(e,r),this.moveInput?.enableEventType(e,r),this.keyInput?.enableEventType(e,r),this.contextmenuInput?.enableEventType(e,r)}_addEventHandler(e,r,n,i,o){if(typeof e!="string"){n=r;for(const[y,x]of Object.entries(e))this._addEventHandler(y,x,n,i,o);return}const{manager:s,events:u}=this;if(!s)return;let d=u.get(e);if(!d){const y=this._getRecognizerName(e)||e;d=new c$(this,y),u.set(e,d),s&&s.on(e,d.handleEvent)}d.add(e,r,n,i,o),d.isEmpty()||this._toggleRecognizer(d.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const[o,s]of Object.entries(e))this._removeEventHandler(o,s);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,r),i.isEmpty())){const{recognizerName:o}=i;let s=!1;for(const u of n.values())if(u.recognizerName===o&&!u.isEmpty()){s=!0;break}s||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(r=>r.getEventNames().includes(e))?.options.event}};const Xr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Xr,"IDENTITY",{get:()=>(Wr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Zo={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},mo={common:0,meters:1,pixels:2},$1={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},rS={multipan:[qB,{threshold:10,direction:ds.Vertical,pointers:2}],pinch:[Hj,{},null,["multipan"]],pan:[qB,{threshold:1},["pinch"],["multipan"]],dblclick:[KB,{event:"dblclick",taps:2}],click:[KB,{event:"click"},null,["dblclick"]]};function f$(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function hg(t){let e={},r;return n=>{for(const i in n)if(!f$(n[i],e[i])){r=t(n),e=n;break}return r}}const nS=[0,0,0,0],h$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$O=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d$=[0,0,0],WO=[0,0,0],A$=hg(m$);function JO(t,e,r=WO){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,o=!0;switch(e===Xr.LNGLAT_OFFSETS||e===Xr.METER_OFFSETS?i=r:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Zo.WEB_MERCATOR:(e===Xr.LNGLAT||e===Xr.CARTESIAN)&&(i=[0,0,0],o=!1);break;case Zo.WEB_MERCATOR_AUTO_OFFSET:e===Xr.LNGLAT?n=i:e===Xr.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case Zo.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case Zo.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function p$(t,e,r){const{viewMatrixUncentered:n,projectionMatrix:i}=t;let{viewMatrix:o,viewProjectionMatrix:s}=t,u=nS,d=nS,y=t.cameraPosition;const{geospatialOrigin:x,shaderCoordinateOrigin:E,offsetMode:S}=JO(t,e,r);return S&&(d=t.projectPosition(x||E),y=[y[0]-d[0],y[1]-d[1],y[2]-d[2]],d[3]=1,u=xA([],d,s),o=n||o,s=Lf([],i,o),s=Lf([],s,h$)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:u,originCommon:d,cameraPosCommon:y,shaderCoordinateOrigin:E,geospatialOrigin:x}}function g$({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=Xr.DEFAULT,coordinateOrigin:i=WO,autoWrapLongitude:o=!1}){n===Xr.DEFAULT&&(n=t.isGeospatial?Xr.LNGLAT:Xr.CARTESIAN);const s=A$({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return s.wrapLongitude=o,s.modelMatrix=r||$O,s}function m$({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:u,shaderCoordinateOrigin:d,geospatialOrigin:y}=p$(t,r,n),x=t.getDistanceScales(),E=[t.width*e,t.height*e],S=xA([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,O={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:d,commonOrigin:s.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:E,devicePixelRatio:e,focalDistance:S,commonUnitsPerMeter:x.unitsPerMeter,commonUnitsPerWorldUnit:x.unitsPerMeter,commonUnitsPerWorldUnit2:d$,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:$O,cameraPosition:u};if(y){const k=t.getDistanceScales(y);switch(r){case Xr.METER_OFFSETS:O.commonUnitsPerWorldUnit=k.unitsPerMeter,O.commonUnitsPerWorldUnit2=k.unitsPerMeter2;break;case Xr.LNGLAT:case Xr.LNGLAT_OFFSETS:t._pseudoMeters||(O.commonUnitsPerMeter=k.unitsPerMeter),O.commonUnitsPerWorldUnit=k.unitsPerDegree,O.commonUnitsPerWorldUnit2=k.unitsPerDegree2;break;case Xr.CARTESIAN:O.commonUnitsPerWorldUnit=[1,1,k.unitsPerMeter[2]],O.commonUnitsPerWorldUnit2=[0,0,k.unitsPerMeter2[2]];break}}return O}const _$=Object.keys(Xr).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Xr[t]};`).join(""),y$=Object.keys(Zo).map(t=>`const PROJECTION_MODE_${t}: i32 = ${Zo[t]};`).join(""),v$=Object.keys(mo).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${mo[t]};`).join(""),b$=`${_$}
${y$}
${v$}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,x$=`${b$}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,w$=Object.keys(Xr).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Xr[t]};`).join(""),C$=Object.keys(Zo).map(t=>`const int PROJECTION_MODE_${t} = ${Zo[t]};`).join(""),T$=Object.keys(mo).map(t=>`const int UNIT_${t.toUpperCase()} = ${mo[t]};`).join(""),E$=`${w$}
${C$}
${T$}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,B$={};function S$(t=B$){return"viewport"in t?g$(t):{}}const L_={name:"project",dependencies:[qH,kO],source:x$,vs:E$,getUniforms:S$,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},I$=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,M$=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ts={name:"project32",dependencies:[L_],source:I$,vs:M$};function P$(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function qd(t,e){const r=xA([],e,t);return kx(r,r,1/r[3]),r}function iS(t,e){const r=t%e;return r<0?e+r:r}function W1(t,e,r){return t<e?e:t>r?r:t}function R$(t){return Math.log(t)*Math.LOG2E}const Gx=Math.log2||R$;function Pl(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ec=Math.PI,XO=ec/4,Ba=ec/180,J1=180/ec,cA=512,Xm=4003e4,Od=85.051129,F$=1.5;function D$(t){return Gx(t)}function Rl(t){const[e,r]=t;Pl(Number.isFinite(e)),Pl(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*Ba,i=r*Ba,o=cA*(n+ec)/(2*ec),s=cA*(ec+Math.log(Math.tan(XO+i*.5)))/(2*ec);return[o,s]}function Wc(t){const[e,r]=t,n=e/cA*(2*ec)-ec,i=2*(Math.atan(Math.exp(r/cA*(2*ec)-ec))-XO);return[n*J1,i*J1]}function O$(t){const{latitude:e}=t;Pl(Number.isFinite(e));const r=Math.cos(e*Ba);return D$(Xm*r)-9}function Sv(t){const e=Math.cos(t*Ba);return cA/Xm/e}function X1(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;Pl(Number.isFinite(e)&&Number.isFinite(r));const i=cA,o=Math.cos(e*Ba),s=i/360,u=s/o,d=i/Xm/o,y={unitsPerMeter:[d,d,d],metersPerUnit:[1/d,1/d,1/d],unitsPerDegree:[s,u,d],degreesPerUnit:[1/s,1/u,1/d]};if(n){const x=Ba*Math.tan(e*Ba)/o,E=s*x/2,S=i/Xm*x,O=S/u*d;y.unitsPerDegree2=[0,E,S],y.unitsPerMeter2=[O,0,O]}return y}function KO(t,e){const[r,n,i]=t,[o,s,u]=e,{unitsPerMeter:d,unitsPerMeter2:y}=X1({longitude:r,latitude:n,highPrecision:!0}),x=Rl(t);x[0]+=o*(d[0]+y[0]*s),x[1]+=s*(d[1]+y[1]*s);const E=Wc(x),S=(i||0)+(u||0);return Number.isFinite(i)||Number.isFinite(u)?[E[0],E[1],S]:E}function L$(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:o,center:s}=t,u=P$();Wm(u,u,[0,0,-i]),BO(u,u,-r*Ba),SO(u,u,n*Ba);const d=o/e;return Nx(u,u,[d,d,d]),s&&Wm(u,u,UV([],s)),u}function N$(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:u,nearZMultiplier:d=1,farZMultiplier:y=1}=t;let{fovy:x=Yp(F$)}=t;n!==void 0&&(x=Yp(n));const E=x*Ba,S=i*Ba,O=Vx(x);let k=O;s&&(k+=s[2]*u/Math.cos(S)/r);const U=E*(.5+(o?o[1]:0)/r),J=Math.sin(U)*k/Math.sin(W1(Math.PI/2-S-U,.01,Math.PI-.01)),G=Math.sin(S)*J+k,H=k*10,K=Math.min(G*y,H);return{fov:E,aspect:e/r,focalDistance:O,near:d,far:K}}function Yp(t){return 2*Math.atan(.5/t)*J1}function Vx(t){return .5/Math.tan(.5*t*Ba)}function qO(t,e){const[r,n,i=0]=t;return Pl(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),qd(e,[r,n,i,1])}function Hx(t,e,r=0){const[n,i,o]=t;if(Pl(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return qd(e,[n,i,o,1]);const s=qd(e,[n,i,0,1]),u=qd(e,[n,i,1,1]),d=s[2],y=u[2],x=d===y?0:((r||0)-d)/(y-d);return AO([],s,u,x)}function k$(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=t,[[u,d],[y,x]]=n,E=U$(t.padding),S=Rl([u,W1(x,-Od,Od)]),O=Rl([y,W1(d,-Od,Od)]),k=[Math.max(Math.abs(O[0]-S[0]),i),Math.max(Math.abs(O[1]-S[1]),i)],U=[e-E.left-E.right-Math.abs(s[0])*2,r-E.top-E.bottom-Math.abs(s[1])*2];Pl(U[0]>0&&U[1]>0);const J=U[0]/k[0],G=U[1]/k[1],H=(E.right-E.left)/2/J,K=(E.top-E.bottom)/2/G,he=[(O[0]+S[0])/2+H,(O[1]+S[1])/2+K],Y=Wc(he),oe=Math.min(o,Gx(Math.abs(Math.min(J,G))));return Pl(Number.isFinite(oe)),{longitude:Y[0],latitude:Y[1],zoom:oe}}function U$(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Pl(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const sS=Math.PI/180;function z$(t,e=0){const{width:r,height:n,unproject:i}=t,o={targetZ:e},s=i([0,n],o),u=i([r,n],o);let d,y;const x=t.fovy?.5*t.fovy*sS:Math.atan(.5/t.altitude),E=(90-t.pitch)*sS;return x>E-.01?(d=oS(t,0,e),y=oS(t,r,e)):(d=i([0,0],o),y=i([r,0],o)),[s,u,y,d]}function oS(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=qd(n,[e,0,1,1]),o=qd(n,[e,t.height,1,1]),u=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),d=AO([],i,o,u),y=Wc(d);return y.push(r),y}const aS=512;function G$(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:o,zoom:s,bearing:u=0}=t;(i<-180||i>180)&&(i=iS(i+180,360)-180),(u<-180||u>180)&&(u=iS(u+180,360)-180);const d=Gx(r/aS);if(s<=d)s=d,o=0;else{const y=r/2/Math.pow(2,s),x=Wc([0,y])[1];if(o<x)o=x;else{const E=Wc([0,aS-y])[1];o>E&&(o=E)}}return{width:e,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:u}}const YO=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,V$=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,H$=`
${YO}
${V$}
`,j$=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,$$=`
${YO}
${j$}
`,W$=hg(Y$),J$=hg(Z$),X$=[0,0,0,1],K$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function q$(t,e){const[r,n,i]=t,o=Hx([r,n,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function Y$({viewport:t,center:e}){return new An(t.viewProjectionMatrix).invert().transform(e)}function Z$({viewport:t,shadowMatrices:e}){const r=[],n=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,o=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(s=>q$(s,n));for(const s of e){const u=s.clone().translate(new ut(t.center).negate()),d=o.map(x=>u.transform(x)),y=new An().ortho({left:Math.min(...d.map(x=>x[0])),right:Math.max(...d.map(x=>x[0])),bottom:Math.min(...d.map(x=>x[1])),top:Math.max(...d.map(x=>x[1])),near:Math.min(...d.map(x=>-x[2])),far:Math.max(...d.map(x=>-x[2]))});r.push(y.multiplyRight(s))}return r}function Q$(t){const{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=L_.getUniforms(r),i=W$({viewport:r.viewport,center:n.center}),o=[],s=J$({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let d=0;d<t.shadowMatrices.length;d++){const y=s[d],x=y.clone().translate(new ut(r.viewport.center).negate());n.coordinateSystem===Xr.LNGLAT&&n.projectionMode===Zo.WEB_MERCATOR?(s[d]=x,o[d]=i):(s[d]=y.clone().multiplyRight(K$),o[d]=x.transform(i))}const u={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||X$,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let d=0;d<s.length;d++)u[`viewProjectionMatrix${d}`]=s[d],u[`projectCenter${d}`]=o[d];for(let d=0;d<2;d++)u[`shadow_uShadowMap${d}`]=t.shadowMaps&&t.shadowMaps[d]||t.dummyShadowMap;return u}const cS={name:"shadow",dependencies:[L_],vs:H$,fs:$$,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:Q$,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},na={...kB,defaultUniforms:{...kB.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},eW=[kO],tW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],rW=[];function nW(t){const e=If.getDefaultShaderAssembler();for(const n of eW)e.addDefaultModule(n);const r=t==="glsl"?tW:rW;for(const n of r)e.addShaderHook(n);return e}const iW=[255,255,255],sW=1;let oW=0;class aW{constructor(e={}){this.type="ambient";const{color:r=iW}=e,{intensity:n=sW}=e;this.id=e.id||`ambient-${oW++}`,this.color=r,this.intensity=n}}const cW=[255,255,255],lW=1,uW=[0,0,-1];let fW=0;class lS{constructor(e={}){this.type="directional";const{color:r=cW}=e,{intensity:n=lW}=e,{direction:i=uW}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${fW++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new ut(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class ZO{constructor(e,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class N_ extends ZO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,o=e.clearColor??(i?[0,0,0,0]:!1),s=i?1:!1,u=i?0:!1,d=e.colorMask??15,y={viewport:[0,0,r,n]};e.colorMask&&(y.colorMask=d),e.scissorRect&&(y.scissorRect=e.scissorRect);const x=this.device.beginRenderPass({framebuffer:e.target,parameters:y,clearColor:o,clearDepth:s,clearStencil:u});try{return this._drawLayers(x,e)}finally{x.end(),this.device.submit()}}_drawLayers(e,r){const{target:n,shaderModuleProps:i,viewports:o,views:s,onViewportActive:u,clearStack:d=!0}=r;r.pass=r.pass||"unknown",d&&(this._lastRenderIndex=-1);const y=[];for(const x of o){const E=s&&s[x.id];u?.(x);const S=this._getDrawLayerParams(x,r),O=x.subViewports||[x];for(const k of O){const U=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:k,view:E,pass:r.pass,layers:r.layers},S);y.push(U)}}return y}_getDrawLayerParams(e,{layers:r,pass:n,isPicking:i=!1,layerFilter:o,cullRect:s,effects:u,shaderModuleProps:d},y=!1){const x=[],E=QO(this._lastRenderIndex+1),S={layer:r[0],viewport:e,isPicking:i,renderPass:n,cullRect:s},O={};for(let k=0;k<r.length;k++){const U=r[k],J=this._shouldDrawLayer(U,S,o,O),G={shouldDrawLayer:J};J&&!y&&(G.shouldDrawLayer=!0,G.layerRenderIndex=E(U,J),G.shaderModuleProps=this._getShaderModuleProps(U,u,n,d),G.layerParameters={...U.context.deck?.props.parameters,...this.getLayerParameters(U,k,e)}),x[k]=G}return x}_drawLayersInViewport(e,{layers:r,shaderModuleProps:n,pass:i,target:o,viewport:s,view:u},d){const y=hW(this.device,{shaderModuleProps:n,target:o,viewport:s});if(u&&u.props.clear){const E=u.props.clear===!0?{color:!0,depth:!0}:u.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:y,scissorRect:y},clearColor:E.color?[0,0,0,0]:!1,clearDepth:E.depth?1:!1}).end()}const x={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:y});for(let E=0;E<r.length;E++){const S=r[E],O=d[E],{shouldDrawLayer:k}=O;if(k&&S.props.pickable&&x.pickableCount++,S.isComposite&&x.compositeCount++,S.isDrawable&&O.shouldDrawLayer){const{layerRenderIndex:U,shaderModuleProps:J,layerParameters:G}=O;x.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,U),J.project&&(J.project.viewport=s),S.context.renderPass=e;try{S._drawLayer({renderPass:e,shaderModuleProps:J,uniforms:{layerIndex:U},parameters:G})}catch(H){S.raiseError(H,`drawing ${S} to ${i}`)}}}return x}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,n){return null}getLayerParameters(e,r,n){return e.props.parameters}_shouldDrawLayer(e,r,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(n){const u=r.layer.id;if(u in i||(i[u]=n(r)),!i[u])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,n,i){const o=this.device.canvasContext.cssToDeviceRatio(),s=e.internalState?.propsInTransition||e.props,u={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(const d of r)uS(u,d.getShaderModuleProps?.(e,u));return uS(u,this.getShaderModuleProps(e,r,u),i)}}function QO(t=0,e={}){const r={},n=(i,o)=>{const s=i.props._offset,u=i.id,d=i.parent&&i.parent.id;let y;if(d&&!(d in e)&&n(i.parent,!1),d in r){const x=r[d]=r[d]||QO(e[d],e);y=x(i,o),r[u]=x}else Number.isFinite(s)?(y=s+(e[d]||0),r[u]=null):y=t;return o&&y>=t&&(t=y+1),e[u]=y,y};return n}function hW(t,{shaderModuleProps:e,target:r,viewport:n}){const i=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,o]=t.canvasContext.getDrawingBufferSize(),s=r?r.height:o,u=n;return[u.x*i,s-(u.y+u.height)*i,u.width*i,u.height*i]}function uS(t,...e){for(const r of e)if(r)for(const n in r)t[n]?Object.assign(t[n],r[n]):t[n]=r[n];return t}class dW extends N_{constructor(e,r){super(e,r);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],o=i.width*n,s=i.height*n,u=[1,1,1,1];(o!==r.width||s!==r.height)&&r.resize({width:o,height:s}),super.render({...e,clearColor:u,target:r,pass:"shadow"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const AW={color:[255,255,255],intensity:1},fS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],pW=[0,0,0,200/255];class eL{constructor(e={}){this.id="lighting-effect",this.shadowColor=pW,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(cS),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const r in e){const n=e[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){const n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:e})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:n,lighting:i,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(cS))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const n=new An().lookAt({eye:new ut(r.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const n=new dW(e);this.shadowPasses[r]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:n}=this;!e&&r.length===0&&n.length===0&&(this.ambientLight=new aW(AW),this.directionalLights.push(new lS(fS[0]),new lS(fS[1])))}}class gW{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:n=1,type:i,padding:o=0,copy:s=!1,initialize:u=!1,maxCount:d}){const y=i||e&&e.constructor||Float32Array,x=r*n+o;if(ArrayBuffer.isView(e)){if(x<=e.length)return e;if(x*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new y(e.buffer,0,x)}let E=1/0;d&&(E=d*n+o);const S=this._allocate(y,x,u,E);return e&&s?S.set(e):u||S.fill(0,0,4),this._release(e),S}release(e){this._release(e)}_allocate(e,r,n,i){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>i&&(o=i);const s=this._pool,u=e.BYTES_PER_ELEMENT*o,d=s.findIndex(y=>y.byteLength>=u);if(d>=0){const y=new e(s.splice(d,1)[0],0,o);return n&&y.fill(0),y}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:n}=e,{byteLength:i}=n,o=r.findIndex(s=>s.byteLength>=i);o<0?r.push(n):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,n),r.length>this.opts.poolSize&&r.shift()}}const lA=new gW;function xp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mW(t){return[t[12],t[13],t[14]]}function _W(t){return{left:id(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:id(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:id(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:id(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:id(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:id(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const hS=new ut;function id(t,e,r,n){hS.set(t,e,r);const i=hS.len();return{distance:n/i,normal:new ut(-t/i,-e/i,-r/i)}}function yW(t){return t-Math.fround(t)}let up;function Iv(t,e){const{size:r=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,o=(i-n)/r;up=lA.allocate(up,o,{type:Float32Array,size:r*2});let s=n,u=0;for(;s<i;){for(let d=0;d<r;d++){const y=t[s++];up[u+d]=y,up[u+d+r]=yW(y)}u+=r*2}return up.subarray(0,o*r*2)}function vW(t){let e=null,r=!1;for(const n of t)n&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const bW=Math.PI/180,xW=xp(),dS=[0,0,0],wW={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function CW({width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:i,padding:o,near:s,far:u}){const d=t/e,y=r?new An().orthographic({fovy:n,aspect:d,focalDistance:i,near:s,far:u}):new An().perspective({fovy:n,aspect:d,near:s,far:u});if(o){const{left:x=0,right:E=0,top:S=0,bottom:O=0}=o,k=Bl((x+t-E)/2,0,t)-t/2,U=Bl((S+e-O)/2,0,e)-e/2;y[8]-=k*2/t,y[9]+=U*2/e}return y}class Ol{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||wW,this.focalDistance=e.focalDistance||1,this.position=e.position||dS,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Zo.WEB_MERCATOR:Zo.WEB_MERCATOR_AUTO_OFFSET:Zo.IDENTITY}equals(e){return e instanceof Ol?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&ra(e.projectionMatrix,this.projectionMatrix)&&ra(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const n=this.projectPosition(e),i=qO(n,this.pixelProjectionMatrix),[o,s]=i,u=r?s:this.height-s;return e.length===2?[o,u]:[o,u,i[2]]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,o,s]=e,u=r?o:this.height-o,d=n&&n*this.distanceScales.unitsPerMeter[2],y=Hx([i,u,s],this.pixelUnprojectionMatrix,d),[x,E,S]=this.unprojectPosition(y);return Number.isFinite(s)?[x,E,S]:Number.isFinite(n)?[x,E,n]:[x,E]}projectPosition(e){const[r,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(e){const[r,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(e){if(this.isGeospatial){const r=Rl(e);return r[1]=Bl(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?Wc(e):e}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?X1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,_W(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=O$({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||X1({latitude:n,longitude:r}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:s}=e;let u=dS;if(o&&(u=s?new An(s).transformAsVector(o,[]):o),this.isGeospatial){const d=this.projectPosition([r,n,0]);this.center=new ut(u).scale(this.distanceScales.unitsPerMeter).add(d)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:r=xW,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:s=75,near:u=.1,far:d=1e3,padding:y=null,focalDistance:x=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new An().multiplyRight(r).translate(new ut(this.center).negate()),this.projectionMatrix=n||CW({width:this.width,height:this.height,orthographic:i,fovyRadians:o||s*bW,focalDistance:x,padding:y,near:u,far:d});const E=xp();Lf(E,E,this.projectionMatrix),Lf(E,E,this.viewMatrix),this.viewProjectionMatrix=E,this.viewMatrixInverse=U1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=mW(this.viewMatrixInverse);const S=xp(),O=xp();Nx(S,S,[this.width/2,-this.height/2,1]),Wm(S,S,[1,-1,0]),Lf(O,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=O,this.pixelUnprojectionMatrix=U1(xp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Wr.warn("Pixel project matrix not invertible")()}}Ol.displayName="Viewport";let Zp=class K1 extends Ol{constructor(e={}){const{latitude:r=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:s=0,nearZMultiplier:u=.1,farZMultiplier:d=1.01,nearZ:y,farZ:x,orthographic:E=!1,projectionMatrix:S,repeat:O=!1,worldOffset:k=0,position:U,padding:J,legacyMeterSizes:G=!1}=e;let{width:H,height:K,altitude:he=1.5}=e;const Y=Math.pow(2,i);H=H||1,K=K||1;let oe,Ee=null;if(S)he=S[5]/2,oe=Yp(he);else{e.fovy?(oe=e.fovy,he=Vx(oe)):oe=Yp(he);let de;if(J){const{top:ve=0,bottom:Ae=0}=J;de=[0,Bl((ve+K-Ae)/2,0,K)-K/2]}Ee=N$({width:H,height:K,scale:Y,center:U&&[0,0,U[2]*Sv(r)],offset:de,pitch:o,fovy:oe,nearZMultiplier:u,farZMultiplier:d}),Number.isFinite(y)&&(Ee.near=y),Number.isFinite(x)&&(Ee.far=x)}let ze=L$({height:K,pitch:o,bearing:s,scale:Y,altitude:he});k&&(ze=new An().translate([512*k,0,0]).multiplyLeft(ze)),super({...e,width:H,height:K,viewMatrix:ze,longitude:n,latitude:r,zoom:i,...Ee,fovy:oe,focalDistance:he}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=s,this.altitude=he,this.fovy=oe,this.orthographic=E,this._subViewports=O?[]:null,this._pseudoMeters=G,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=r;i<=n;i++){const o=i?new K1({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,n]=this.projectFlat(e),i=(e[2]||0)*Sv(e[1]);return[r,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,n]=this.unprojectFlat(e),i=(e[2]||0)/Sv(n);return[r,n,i]}addMetersToLngLat(e,r){return KO(e,r)}panByPosition(e,r){const n=Hx(r,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=PB([],i,RV([],n)),s=PB([],this.center,o),[u,d]=this.unprojectFlat(s);return{longitude:u,latitude:d}}getBounds(e={}){const r=z$(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:u}=k$({width:n,height:i,bounds:e,...r});return new K1({width:n,height:i,longitude:o,latitude:s,zoom:u})}};Zp.displayName="WebMercatorViewport";const AS=[0,0,0];function Mv(t,e,r=!1){const n=e.projectPosition(t);if(r&&e instanceof Zp){const[i,o,s=0]=t,u=e.getDistanceScales([i,o]);n[2]=s*u.unitsPerMeter[2]}return n}function TW(t){const{viewport:e,modelMatrix:r,coordinateOrigin:n}=t;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:s}=t;return i===Xr.DEFAULT&&(i=e.isGeospatial?Xr.LNGLAT:Xr.CARTESIAN),o===void 0&&(o=i),s===void 0&&(s=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}}function tL(t,{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[s,u,d=0]=t;switch(r&&([s,u,d]=xA([],[s,u,d,1],r)),n){case Xr.LNGLAT:return Mv([s,u,d],e,o);case Xr.LNGLAT_OFFSETS:return Mv([s+i[0],u+i[1],d+(i[2]||0)],e,o);case Xr.METER_OFFSETS:return Mv(KO(i,[s,u,d]),e,o);case Xr.CARTESIAN:default:return e.isGeospatial?[s+i[0],u+i[1],d+i[2]]:e.projectPosition([s,u,d])}}function EW(t,e){const{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:u}=TW(e),{autoOffset:d=!0}=e,{geospatialOrigin:y=AS,shaderCoordinateOrigin:x=AS,offsetMode:E=!1}=d?JO(r,n,i):{},S=tL(t,{viewport:r,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:E});if(E){const O=r.projectPosition(y||x);CO(S,S,O)}return S}let BW=1,SW=1;class rL{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,s=BW++,u={time:0,delay:r,duration:n,rate:i,repeat:o};return this._setChannelTime(u,this.time),this.channels.set(s,u),s}removeChannel(e){this.channels.delete(e);for(const[r,n]of this.animations)n.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const i of r)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:o,channel:s}=i;o.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const n=SW++;return this.animations.set(n,{animation:e,channel:r}),e.setTime(this.getTime(r)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const n=r-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function IW(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function MW(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function pS(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let gS=class{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=pS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(pS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},PW=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof gS?i=e:i=new gS(r,n),this.stats[r]=i),i}},RW=0;const FW={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:D1.stats.get(`animation-loop-${RW++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class DW{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...FW,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new PW({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const n=document.createElement("h1");n.innerHTML=e.message,n.style.position="absolute",n.style.top="20%",n.style.left="10px",n.style.color="black",n.style.backgroundColor="red",document.body.appendChild(n)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=IW(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(MW(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&r>0&&(n=e/r),{width:e,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Pv={};function Qf(t="id"){Pv[t]=Pv[t]||1;const e=Pv[t]++;return`${t}-${e}`}class mS{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Qf("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Li.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function OW(t,e){if(e instanceof mS)return e;const r=LW(t,e),{attributes:n,bufferLayout:i}=NW(t,e);return new mS({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:r,attributes:n})}function LW(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:Li.INDEX,data:r})}function NW(t,e){const r=[],n={};for(const[o,s]of Object.entries(e.attributes)){let u=o;switch(o){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(s){n[u]=t.createBuffer({data:s.value,id:`${o}-buffer`});const{value:d,size:y,normalized:x}=s;r.push({name:u,format:L7(d,y,x)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}class jx{static defaultProps={...oA.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new jx(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const r={...oA.defaultProps,...e},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const r={...Vm.defaultProps,...e},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const r=e.hash,n=e instanceof Vm?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&this.destroyPolicy==="unused"&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${i}BL${o}`;default:const s=this._getHash(JSON.stringify(e.parameters));return`${r}/${n}V${i}T${e.topology}P${s}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class $x{static defaultProps={...R_.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new $x(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const r=this._hashShader(e);let n=this._cache[r];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const r=this._hashShader(e),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function kW(t,e){const r={},n="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const i of t.attributes)if(i){const o=`${i.location} ${i.name}: ${i.type}`;r[`in ${o}`]={[n]:i.stepMode||"vertex"}}for(const i of t.varyings||[]){const o=`${i.location} ${i.name}`;r[`out ${o}`]={[n]:JSON.stringify(i)}}return r}let Cs=null,Rv=null;function UW(t,{id:e,minimap:r,opaque:n,top:i="0",left:o="0",rgbaScale:s=1}){Cs||(Cs=document.createElement("canvas"),Cs.id=e,Cs.title=e,Cs.style.zIndex="100",Cs.style.position="absolute",Cs.style.top=i,Cs.style.left=o,Cs.style.border="blue 5px solid",Cs.style.transform="scaleY(-1)",document.body.appendChild(Cs),Rv=Cs.getContext("2d")),(Cs.width!==t.width||Cs.height!==t.height)&&(Cs.width=t.width/2,Cs.height=t.height/2,Cs.style.width="400px",Cs.style.height="400px");const u=t.device.readPixelsToArrayWebGL(t),d=Rv?.createImageData(t.width,t.height);if(d){for(let x=0;x<u.length;x+=4)d.data[0+x+0]=u[x+0]*s,d.data[0+x+1]=u[x+1]*s,d.data[0+x+2]=u[x+2]*s,d.data[0+x+3]=n?255:u[x+3]*s;Rv?.putImageData(d,0,0)}}function q1(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!q1(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!q1(t[o],e[o],r-1))return!1;return!0}return!1}function zW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function GW(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function nL(t){return zW(t)||GW(t)}function VW(t){return nL(t)||typeof t=="number"||typeof t=="boolean"}function iL(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];VW(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}class HW{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);const n=bx(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Xt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,o]of Object.entries(e))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&Xt.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(e){for(const r of Object.keys(e)){const n=r,i=e[n]||{},o=this.modules[n];if(!o){this.options.disableWarnings||Xt.warn(`Module ${r} not found`)();continue}const s=this.moduleUniforms[n],u=this.moduleBindings[n],d=o.getUniforms?.(i,s)||i,{uniforms:y,bindings:x}=iL(d);this.moduleUniforms[n]={...s,...y},this.moduleBindings[n]={...u,...x}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){const e={};for(const[r,n]of Object.entries(this.moduleUniforms))for(const[i,o]of Object.entries(n))e[`${r}.${i}`]={type:this.modules[r].uniformTypes?.[i],value:String(o)};return e}_addModule(e){const r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}}let jW="";async function $W(t,e){const r=new Image;return r.crossOrigin="anonymous",r.src=t.startsWith("http")?t:jW+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}class Fv{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e,this.id=r.id||Qf("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:$W(r.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(r)}async initAsync(e){let r,n;const i=e.data,o=await sL(i).then(r,n);if(this.destroyed)return;const s={...e,data:o};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}}async function sL(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(sL));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,r=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let o=0;o<n.length;o++)i[n[o]]=r[o];return i}return t}const mf=2,WW=1e4;class Ei{static defaultProps={...oA.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:If.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...Ei.defaultProps,...r},r=this.props,this.id=r.id||Qf("model"),this.device=e,Object.assign(this.userData,r.userData);const n=Object.fromEntries(this.props.modules?.map(d=>[d.name,d])||[]),i=r.shaderInputs||new HW(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const o=XW(e),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:d,getUniforms:y}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:s});this.source=d,this._getModuleUniforms=y,this.props.shaderLayout||=yV(this.source)}else{const{vs:d,fs:y,getUniforms:x}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:s});this.vs=d,this.fs=y,this._getModuleUniforms=x}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||jx.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||$x.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const r=this._areBindingsLoading();if(r)return Xt.info(mf,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),Y1(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:o}=this.vertexArray,s=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const r=e&&OW(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");const n=new yv(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const r=new yv(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){q1(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new O7(this.shaderInputs.modules);for(const[r,n]of Object.entries(this.shaderInputs.modules))if(JW(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){const n=r?.disableWarnings??this.props.disableWarnings;e.indices&&Xt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new yv(this.bufferLayout);for(const[o,s]of Object.entries(e)){const u=i.getBufferLayout(o);if(!u){n||Xt.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const d=i.getAttributeNamesForBuffer(u);let y=!1;for(const x of d){const E=this._attributeInfos[x];E&&(this.vertexArray.setBuffer(E.location,s),y=!0)}!y&&!n&&Xt.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[n,i]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):(r?.disableWarnings??this.props.disableWarnings)||Xt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Y1(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:r,uniforms:n}=iL(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Fv&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[r,n]of Object.entries(this.bindings))n instanceof Fv?n.isReady&&(e[r]=n.texture):e[r]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof P_?e=Math.max(e,r.texture.updateTimestamp):r instanceof Li||r instanceof Yn?e=Math.max(e,r.updateTimestamp):r instanceof Fv?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof Jp||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Xt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=rO(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Xt.level>3?0:WW;Xt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Xt.group(mf,`>>> DRAWING MODEL ${this.id}`,{collapsed:Xt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=kW(this.pipeline.shaderLayout,this.id);Xt.table(mf,e)();const r=this.shaderInputs.getDebugTable();for(const[i,o]of Object.entries(this.uniforms))r[i]={value:o};Xt.table(mf,r)();const n=this._getAttributeDebugTable();Xt.table(mf,this._attributeInfos)(),Xt.table(mf,n)(),Xt.groupEnd(mf)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;const n=e.props.framebuffer;n&&UW(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,r){const n=sO(r);return(e instanceof Li?new n(e.debugData):e).toString()}}function JW(t){return!!(t.uniformTypes&&!Y1(t.uniformTypes))}function XW(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Y1(t){for(const e in t)return!1;return!0}class Vf{device;model;transformFeedback;static defaultProps={...Ei.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=Vf.defaultProps){if(!Vf.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Ei(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||WD(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof Li)return r.readAsync();const{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=r;return n.readAsync(i,o)}}const KW="transform_output";class _S{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,r){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Ei(this.device,{id:r.id||"texture-transform-model",fs:r.fs||WD({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:KW}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:r}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:r,...e});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:r,sourceTextures:n,targetTexture:i}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),i){e.targetTexture=i;const{width:o,height:s}=i;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:s,colorAttachments:[i]}),e.framebuffer.resize({width:o,height:s})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:r}=this.bindings[e];for(const n in r)r[n].sampler=this.sampler}}class zs{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:r={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||Qf("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,s]of Object.entries(r)){const u=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!u.size&&(u.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[o]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let n=1/0;for(const i of Object.values(e)){const{value:o,size:s,constant:u}=i;!u&&o&&s!==void 0&&s>=1&&(n=Math.min(n,o.length/s))}return n}}const qW=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,YW=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,yS=[-1,-1,1,-1,-1,1,1,1];class ZW extends Ei{constructor(e,r){const n=yS.map(i=>i===-1?0:i);r.source&&(r={...r,source:`${qW}
${r.source}`}),super(e,{id:r.id||Qf("clip-space"),...r,vs:YW,vertexCount:4,geometry:new zs({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(yS)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class Km{id;matrix=new An;display=!0;position=new ut;rotation=new ut;scale=new ut(1,1,1);userData={};props={};constructor(e={}){const{id:r}=e;this.id=r||Qf(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:r,rotation:n,scale:i,update:o=!0}=e;return r&&this.setPosition(r),n&&this.setRotation(n),i&&this.setScale(i),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,r=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(n),this}update(e={}){const{position:r,rotation:n,scale:i}=e;return r&&this.setPosition(r),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,r){r=r||this.matrix;const n=new An(e).multiplyRight(r),i=n.invert(),o=i.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Yd extends Km{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:r=[]}=e;Xt.assert(r.every(n=>n instanceof Km),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:n})=>{const i=r.getBounds();if(!i)return;const[o,s]=i,u=new ut(o).add(s).divide([2,2,2]);n.transformAsPoint(u,u);const d=new ut(s).subtract(o).divide([2,2,2]);n.transformAsVector(d,d);for(let y=0;y<8;y++){const x=new ut(y&1?-1:1,y&2?-1:1,y&4?-1:1).multiply(d).add(u);for(let E=0;E<3;E++)e[0][E]=Math.min(e[0][E],x[E]),e[1][E]=Math.max(e[1][E],x[E])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const r=this.children,n=r.indexOf(e);return n>-1&&r.splice(n,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new An}={}){const n=new An(r).multiplyRight(this.matrix);for(const i of this.children)i instanceof Yd?i.traverse(e,{worldMatrix:n}):e(i,{worldMatrix:n})}}class Z1 extends Km{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}}class oL extends zs{constructor(e={}){const{id:r=Qf("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:r,topology:"triangle-list",indices:{size:1,value:QW},attributes:{...oJ,...e.attributes}}:{...e,id:r,topology:"triangle-list",indices:void 0,attributes:{...aJ,...e.attributes}})}}const QW=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),eJ=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),tJ=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),rJ=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),nJ=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),iJ=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),sJ=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),oJ={POSITION:{size:3,value:eJ},NORMAL:{size:3,value:tJ},TEXCOORD_0:{size:2,value:rJ}},aJ={POSITION:{size:3,value:nJ},TEXCOORD_0:{size:2,value:iJ},COLOR_0:{size:3,value:sJ}},cJ=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,lJ={name:"screen",fs:cJ,uniformTypes:{texSize:"vec2<f32>"}};class uJ extends ZO{constructor(e,r){super(e,r);const{module:n,fs:i,id:o}=r,s={depthWriteEnabled:!1,depthCompare:"always"};this.model=new ZW(e,{id:o,fs:i,modules:[n,lJ],parameters:s})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,r){const{clearCanvas:n,inputBuffer:i,outputBuffer:o}=r,s=[i.width,i.height],u={texSrc:i.colorAttachments[0],texSize:s};this.model.shaderInputs.setProps({screen:u,...r.moduleProps});const d=this.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,...s]},clearColor:n?[0,0,0,0]:!1,clearDepth:1,clearStencil:!1});this.model.draw(d),d.end()}}class fJ{constructor(e,r){this.id=`${e.name}-pass`,this.props=r,ND(e),this.module=e}setup({device:e}){this.passes=hJ(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const r=this.passes,{target:n}=e;let i=e.inputBuffer,o=e.swapBuffer;for(let s=0;s<r.length;s++){const u=s===r.length-1,d=n!==void 0&&u;d&&(o=n);const y=!d||!!e.clearCanvas,x={},E=this.module.passes[s].uniforms;x[this.module.name]={...this.props,...E},r[s].render({clearCanvas:y,inputBuffer:i,outputBuffer:o,moduleProps:x});const S=o;o=i,i=S}return i}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function hJ(t,e,r){return e.passes.map((n,i)=>{const o=pJ(e,n),s=`${r}-${i}`;return new uJ(t,{id:s,module:e,fs:o})})}const aL=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,dJ=t=>`${aL}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${t}(fragColor, screen.texSize, coordinate);
}
`,AJ=t=>`${aL}
void main() {
  fragColor = ${t}(texSrc, screen.texSize, coordinate);
}
`;function pJ(t,e){if(e.filter){const r=typeof e.filter=="string"?e.filter:`${t.name}_filterColor_ext`;return dJ(r)}if(e.sampler){const r=typeof e.sampler=="string"?e.sampler:`${t.name}_sampleColor`;return AJ(r)}return""}const gJ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class cL extends N_{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:o,pickingFBO:s,deviceRect:{x:u,y:d,width:y,height:x},cullRect:E,effects:S,pass:O="picking",pickZ:k,shaderModuleProps:U}){this.pickZ=k;const J=this._resetColorEncoder(k),G=[u,d,y,x],H=super.render({target:s,layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:o,cullRect:E,effects:S?.filter(he=>he.useInPicking),pass:O,isPicking:!0,shaderModuleProps:U,clearColor:[0,0,0,0],colorMask:15,scissorRect:G});return this._colorEncoderState=null,{decodePickingColor:J&&_J.bind(null,J),stats:H}}shouldDrawLayer(e){const{pickable:r,operation:n}=e.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,n){const i={...e.props.parameters},{pickable:o,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?i.blend=!1:o&&s.includes("draw")&&(Object.assign(i,gJ),i.blend=!0,i.blendColor=mJ(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function mJ(t,e,r){const{byLayer:n,byAlpha:i}=t;let o,s=n.get(e);return s?(s.viewports.push(r),o=s.a):(o=n.size+1,o<=255?(s={a:o,layer:e,viewports:[r]},n.set(e,s),i[o]=s):(Wr.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function _J(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const Id={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},qm=Symbol.for("component"),Eu=Symbol.for("propTypes"),Dv=Symbol.for("deprecatedProps"),Zd=Symbol.for("asyncPropDefaults"),Hf=Symbol.for("asyncPropOriginal"),xu=Symbol.for("asyncPropResolved");function k_(t,e=()=>!0){return Array.isArray(t)?lL(t,e,[]):e(t)?[t]:[]}function lL(t,e,r){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?lL(i,e,r):e(i)&&r.push(i)}return r}function yJ({target:t,source:e,start:r=0,count:n=1}){const i=e.length,o=n*i;let s=0;for(let u=r;s<i;s++)t[u++]=e[s];for(;s<o;)s<o-s?(t.copyWithin(r+s,r,r+s),s*=2):(t.copyWithin(r+s,r,r+o-s),s=o);return t}function vS(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let bS=class{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=vS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(vS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},uL=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof bS?i=e:i=new bS(r,n),this.stats[r]=i),i}};class vJ{constructor(e,r,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=S1(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class bJ{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(r,n):(o=new vJ(e,r,this._context),this._resources[e]=o),o.persistent=i}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const n in r){const i=r[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:n,requestId:i="default"}){const{_resources:o,protocol:s}=this;e.startsWith(s)&&(e=e.replace(s,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=o[e];if(this._track(n,i,u,r),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,n,i){const o=this._consumers,s=o[e]=o[e]||{};let u=s[r];const d=u&&u.resourceId&&this._resources[u.resourceId];d&&(d.unsubscribe(u),this.prune()),n&&(u?(u.onChange=i,u.resourceId=n.id):u={onChange:i,resourceId:n.id},s[r]=u,n.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const xJ="layerManager.setLayers",wJ="layerManager.activateViewport";class CJ{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{to(wJ,this,u),u&&(this.context.viewport=u)};const{deck:n,stats:i,viewport:o,timeline:s}=r||{};this.layers=[],this.resourceManager=new bJ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:nW(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[dj],renderPass:void 0,stats:i||new uL({id:"deck.gl"}),viewport:o||new Ol({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new rL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){to(xJ,this,r,e),this._lastRenderedLayers=e;const n=k_(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===e.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,n){n.raiseError(r,`${e} of ${n}`)}_updateLayers(e,r){const n={};for(const s of e)n[s.id]?Wr.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of e)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let o=!1;for(const s of i)if(s.hasUniformTransition()){o=`Uniform transition in ${s}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,r,n){for(const i of e){i.context=this.context;const o=r[i.id];o===null&&Wr.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let s=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),s=i.isComposite?i.getSubLayers():null}catch(u){this._handleError("matching",u,i)}s&&this._updateSublayersRecursively(s,r,n)}}_finalizeOldLayers(e){for(const r in e){const n=e[r];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Id.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=Id.MATCHED,r!==e&&(e.lifecycle=Id.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Id.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Id.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function Ji(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Ji(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!Ji(t[o],e[o],r-1))return!1;return!0}return!1}class TJ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,r){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let o=n.length-1;o>=0;--o){const s=n[o];if(s.containsPixel(i)){const u=e.slice();return u[0]-=s.x,u[1]-=s.y,s.unproject(u,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=k_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ji(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Wr.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(e.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(e,r,n,i){const o=e.controller;if(o&&n){const s={...r,...o,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,s)),i&&i.setProps(s),i}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const o=e[i],s=this.getViewState(o),u=o.makeViewport({viewState:s,width:this.width,height:this.height});let d=r[o.id];const y=!!o.controller;y&&!d&&(n=!0),(n||!y)&&d&&(d.finalize(),d=null),this.controllers[o.id]=this._updateController(o,s,u,d),u&&this._viewports.unshift(u)}for(const i in r){const o=r[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((n,i)=>!e[i].equals(r[i]))}}const EJ=/([0-9]+\.?[0-9]*)(%|px)/;function du(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=EJ.exec(t);if(e&&e.length>=3){const r=e[2]==="%",n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function Au(t,e){return t.relative?Math.round(t.position*e):t.position}class uA{constructor(e){const{id:r,x:n=0,y:i=0,width:o="100%",height:s="100%",padding:u=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=du(n),this._y=du(i),this._width=du(o),this._height=du(s),this._padding=u&&{left:du(u.left||0),right:du(u.right||0),top:du(u.top||0),bottom:du(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ji(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:r});if(!i.height||!i.width)return null;const o=this.getViewportType(n);return new o({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return e}getDimensions({width:e,height:r}){const n={x:Au(this._x,e),y:Au(this._y,r),width:Au(this._width,e),height:Au(this._height,r)};return this._padding&&(n.padding={left:Au(this._padding.left,e),top:Au(this._padding.top,r),right:Au(this._padding.right,e),bottom:Au(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class U_{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const xS=()=>{},Q1={BREAK:1,SNAP_TO_END:2,IGNORE:3},BJ=t=>t,SJ=Q1.BREAK;let IJ=class{constructor(e){this._onTransitionUpdate=r=>{const{time:n,settings:{interpolator:i,startProps:o,endProps:s,duration:u,easing:d}}=r,y=d(n/u),x=i.interpolateProps(o,s,y);this.propsInTransition=this.getControllerState({...this.props,...x}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new U_(e.timeline),this.onViewStateChange=e.onViewStateChange||xS,this.onStateChange=e.onStateChange||xS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:o,endProps:s}=this.transition.settings;i={...n,...o===Q1.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(i,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:n}=e;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===Q1.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const n=this.getControllerState(e),i=this.getControllerState(r).shortestPathFrom(n),o=r.transitionInterpolator,s=o.getDuration?o.getDuration(e,r):r.transitionDuration;if(s===0)return;const u=o.initializeProps(e,i);this.propsInTransition={};const d={duration:s,easing:r.transitionEasing||BJ,interpolator:o,interruption:r.transitionInterruption||SJ,startProps:u.start,endProps:u.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(d),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}};function Us(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}let MJ=class{constructor(e){const{compare:r,extract:n,required:i}=e;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(e,r){for(const n of this._propsToCompare)if(!(n in e)||!(n in r)||!ra(e[n],r[n]))return!1;return!0}initializeProps(e,r){const n={},i={};for(const o of this._propsToExtract)(o in e||o in r)&&(n[o]=e[o],i[o]=r[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const n=e[r];Us(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}};const PJ=["longitude","latitude","zoom","bearing","pitch"],RJ=["longitude","latitude","zoom"];let fL=class extends MJ{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:PJ,required:RJ},super(n.transitionProps),this.opts=n}initializeProps(e,r){const n=super.initializeProps(e,r),{makeViewport:i,around:o}=this.opts;if(i&&o){const s=i(e),u=i(r),d=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:u.project(d),aroundPosition:d,width:r.width,height:r.height})}return n}interpolateProps(e,r,n){const i={};for(const o of this._propsToExtract)i[o]=sc(e[o]||0,r[o]||0,n);if(r.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...r,...i});Object.assign(i,o.panByPosition(r.aroundPosition,sc(e.around,r.around,n)))}return i}};const pu={transitionDuration:0},FJ=300,w0=t=>1-(1-t)*(1-t),sd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},_f={};class DJ{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new IJ({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:n}=this.props,{offsetCenter:i}=e;return[i.x-r,i.y-n]}isPointInBounds(e,r){const{width:n,height:i}=this.props;if(r&&r.handled)return!1;const o=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?FJ:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:u=!0,touchRotate:d=!1,keyboard:y=!0}=e,x=!!this.onViewStateChange;this.toggleEvents(sd.WHEEL,x&&n),this.toggleEvents(sd.PAN,x),this.toggleEvents(sd.PINCH,x&&(u||d)),this.toggleEvents(sd.MULTI_PAN,x&&d),this.toggleEvents(sd.DOUBLE_CLICK,x&&s),this.toggleEvents(sd.KEYBOARD,x&&y),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=u,this.touchRotate=d,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,r=null,n={}){const i={...e.getViewportProps(),...r},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),o){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,pu,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),n=this.controllerState.pan({pos:r});return this.updateViewport(n,pu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:w0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,pu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:w0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let s=2/(1+Math.exp(-Math.abs(o*n)));o<0&&s!==0&&(s=1/s);const u=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(u,{...this._getTransitionProps({around:r}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,pu,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,pu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*r/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:w0},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return _f._startPinchRotation=e.rotation,_f._lastPinchEvent=e,this.updateViewport(n,pu,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;r=r.rotate({deltaAngleX:_f._startPinchRotation-n})}return this.updateViewport(r,pu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),_f._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=_f;if(this.touchZoom&&r&&n&&e.scale!==n.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const s=Math.log2(e.scale),u=(s-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),d=Math.pow(2,s+u*r/2);o=o.zoom({pos:i,scale:d}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:w0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return _f._startPinchRotation=null,_f._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let d;const y={};switch(e.srcEvent.code){case"Minus":d=r?u.zoomOut(n).zoomOut(n):u.zoomOut(n),y.isZooming=!0;break;case"Equal":d=r?u.zoomIn(n).zoomIn(n):u.zoomIn(n),y.isZooming=!0;break;case"ArrowLeft":r?(d=u.rotateLeft(o),y.isRotating=!0):(d=u.moveLeft(i),y.isPanning=!0);break;case"ArrowRight":r?(d=u.rotateRight(o),y.isRotating=!0):(d=u.moveRight(i),y.isPanning=!0);break;case"ArrowUp":r?(d=u.rotateUp(s),y.isRotating=!0):(d=u.moveUp(i),y.isPanning=!0);break;case"ArrowDown":r?(d=u.rotateDown(s),y.isRotating=!0):(d=u.moveDown(i),y.isPanning=!0);break;default:return!1}return this.updateViewport(d,this._getTransitionProps(),y),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?pu:e?{...r,transitionInterpolator:new fL({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class OJ{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const wS=5,LJ=1.2;let NJ=class extends OJ{constructor(e){const{width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:u=0,pitch:d=0,altitude:y=1.5,position:x=[0,0,0],maxZoom:E=20,minZoom:S=0,maxPitch:O=60,minPitch:k=0,startPanLngLat:U,startZoomLngLat:J,startRotatePos:G,startBearing:H,startPitch:K,startZoom:he,normalize:Y=!0}=e;Us(Number.isFinite(o)),Us(Number.isFinite(i)),Us(Number.isFinite(s)),super({width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:u,pitch:d,altitude:y,maxZoom:E,minZoom:S,maxPitch:O,minPitch:k,normalize:Y,position:x},{startPanLngLat:U,startZoomLngLat:J,startRotatePos:G,startBearing:H,startPitch:K,startZoom:he}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:o,startPitch:s}=this.getState();if(!i||o===void 0||s===void 0)return this;let u;return e?u=this._getNewRotation(e,i,s,o):u={bearing:o+r,pitch:s+n},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(e)),!o)return this;const{maxZoom:s,minZoom:u}=this.getViewportProps();let d=i+Math.log2(n);d=Bl(d,u,s);const y=this.makeViewport({...this.getViewportProps(),zoom:d});return this._getUpdatedState({zoom:d,...y.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-r.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(e){const{maxZoom:r,minZoom:n,zoom:i}=e;e.zoom=Bl(i,n,r);const{maxPitch:o,minPitch:s,pitch:u}=e;e.pitch=Bl(u,s,o);const{normalize:d=!0}=e;return d&&Object.assign(e,G$(e)),e}_zoomFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:e})}_panFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,n,i){const o=e[0]-r[0],s=e[1]-r[1],u=e[1],d=r[1],{width:y,height:x}=this.getViewportProps(),E=o/y;let S=0;s>0?Math.abs(x-d)>wS&&(S=s/(d-x)*LJ):s<0&&d>wS&&(S=1-u/d),S=Bl(S,-1,1);const{minPitch:O,maxPitch:k}=this.getViewportProps(),U=i+180*E;let J=n;return S>0?J=n+S*(k-n):S<0&&(J=n-S*(O-n)),{pitch:J,bearing:U}}},kJ=class extends DJ{constructor(){super(...arguments),this.ControllerState=NJ,this.transition={transitionDuration:300,transitionInterpolator:new fL({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class hL extends uA{constructor(e={}){super(e)}getViewportType(){return Zp}get ControllerType(){return kJ}}hL.displayName="MapView";const UJ=new eL;function zJ(t,e){const r=t.order??1/0,n=e.order??1/0;return r-n}class GJ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(n=>n.id===e.id)){const n=r.findIndex(i=>zJ(i,e)>0);n<0?r.push(e):r.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ji(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const i of this.effects)r[i.id]=i;const n=[];for(const i of e){const o=r[i.id];let s=i;o&&o!==i?o.setProps?(o.setProps(i.props),s=o):o.cleanup(this._context):o||i.setup(this._context),n.push(s),delete r[i.id]}for(const i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof eL)||this._resolvedEffects.push(UJ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class VJ extends N_{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const HJ="deckRenderer.renderLayers";class jJ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new VJ(e),this.pickLayersPass=new cL(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=r.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,to(HJ,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of e)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(r)}_postRender(e,r){const{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const o of e)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?r.target:void 0;const s=o.postRender(i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}}const $J={pickedColor:null,pickedObjectIndex:-1};function WJ({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:o}){const{x:s,y:u,width:d,height:y}=o;let x=i*i,E=-1,S=0;for(let O=0;O<y;O++){const k=O+u-n,U=k*k;if(U>x)S+=4*d;else for(let J=0;J<d;J++){if(t[S+3]-1>=0){const H=J+s-r,K=H*H+U;K<=x&&(x=K,E=S)}S+=4}}if(E>=0){const O=t.slice(E,E+4),k=e(O);if(k){const U=Math.floor(E/4/d),J=E/4-U*d;return{...k,pickedColor:O,pickedX:s+J,pickedY:u+U}}Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return $J}function JJ({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const o=t.slice(n,n+4),s=o.join(",");if(!r.has(s)){const u=e(o);u?r.set(s,{...u,color:o}):Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function dL({pickInfo:t,viewports:e,pixelRatio:r,x:n,y:i,z:o}){let s=e[0];e.length>1&&(s=KJ(t?.pickedViewports||e,{x:n,y:i}));let u;if(s){const d=[n-s.x,i-s.y];o!==void 0&&(d[2]=o),u=s.unproject(d)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:u,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function XJ(t){const{pickInfo:e,lastPickedInfo:r,mode:n,layers:i}=t,{pickedColor:o,pickedLayer:s,pickedObjectIndex:u}=e,d=s?[s]:[];if(n==="hover"){const E=r.index,S=r.layerId,O=s?s.props.id:null;if(O!==S||u!==E){if(O!==S){const k=i.find(U=>U.props.id===S);k&&d.unshift(k)}r.layerId=O,r.index=u,r.info=null}}const y=dL(t),x=new Map;return x.set(null,y),d.forEach(E=>{let S={...y};E===s&&(S.color=o,S.index=u,S.picked=!0),S=AL({layer:E,info:S,mode:n});const O=S.layer;E===s&&n==="hover"&&(r.info=S),x.set(O.id,S),n==="hover"&&O.updateAutoHighlight(S)}),x}function AL({layer:t,info:e,mode:r}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function KJ(t,e){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e))return n}return t[0]}class qJ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new cL(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:n,viewports:i},o=this.lastPickedInfo.info){const s=o&&o.layer&&o.layer.id,u=o&&o.viewport&&o.viewport.id,d=s?n.find(S=>S.id===s):null,y=u&&i.find(S=>S.id===u)||i[0],x=y&&y.unproject([e-y.x,r-y.y]);return{...o,...{x:e,y:r,viewport:y,coordinate:x,layer:d}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:n,x:i,y:o,radius:s=0,depth:u=1,mode:d="query",unproject3D:y,onViewportActive:x,effects:E}){const S=this.device.canvasContext.cssToDeviceRatio(),O=this._getPickable(e);if(!O||n.length===0)return{result:[],emptyInfo:dL({viewports:n,x:i,y:o,pixelRatio:S})};this._resizeBuffer();const k=this.device.canvasContext.cssToDevicePixels([i,o],!0),U=[k.x+Math.floor(k.width/2),k.y+Math.floor(k.height/2)],J=Math.round(s*S),{width:G,height:H}=this.pickingFBO,K=this._getPickingRect({deviceX:U[0],deviceY:U[1],deviceRadius:J,deviceWidth:G,deviceHeight:H}),he={x:i-s,y:o-s,width:s*2+1,height:s*2+1};let Y;const oe=[],Ee=new Set;for(let ze=0;ze<u;ze++){let de;if(K){const Ae=this._drawAndSample({layers:O,views:r,viewports:n,onViewportActive:x,deviceRect:K,cullRect:he,effects:E,pass:`picking:${d}`});de=WJ({...Ae,deviceX:U[0],deviceY:U[1],deviceRadius:J,deviceRect:K})}else de={pickedColor:null,pickedObjectIndex:-1};let ve;if(de.pickedLayer&&y&&this.depthFBO){const{pickedColors:Ae}=this._drawAndSample({layers:[de.pickedLayer],views:r,viewports:n,onViewportActive:x,deviceRect:{x:de.pickedX,y:de.pickedY,width:1,height:1},cullRect:he,effects:E,pass:`picking:${d}:z`},!0);Ae[3]&&(ve=Ae[0])}de.pickedLayer&&ze+1<u&&(Ee.add(de.pickedLayer),de.pickedLayer.disablePickingIndex(de.pickedObjectIndex)),Y=XJ({pickInfo:de,lastPickedInfo:this.lastPickedInfo,mode:d,layers:O,viewports:n,x:i,y:o,z:ve,pixelRatio:S});for(const Ae of Y.values())Ae.layer&&oe.push(Ae);if(!de.pickedColor)break}for(const ze of Ee)ze.restorePickingColors();return{result:oe,emptyInfo:Y.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:n,x:i,y:o,width:s=1,height:u=1,mode:d="query",maxObjects:y=null,onViewportActive:x,effects:E}){const S=this._getPickable(e);if(!S||n.length===0)return[];this._resizeBuffer();const O=this.device.canvasContext.cssToDeviceRatio(),k=this.device.canvasContext.cssToDevicePixels([i,o],!0),U=k.x,J=k.y+k.height,G=this.device.canvasContext.cssToDevicePixels([i+s,o+u],!0),H=G.x+G.width,K=G.y,he={x:U,y:K,width:H-U,height:J-K},Y=this._drawAndSample({layers:S,views:r,viewports:n,onViewportActive:x,deviceRect:he,cullRect:{x:i,y:o,width:s,height:u},effects:E,pass:`picking:${d}`}),oe=JJ(Y),Ee=new Map,ze=[],de=Number.isFinite(y);for(let ve=0;ve<oe.length&&!(de&&ze.length>=y);ve++){const Ae=oe[ve];let $={color:Ae.pickedColor,layer:null,index:Ae.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:O};$=AL({layer:Ae.pickedLayer,info:$,mode:d});const re=$.layer.id;Ee.has(re)||Ee.set(re,new Set);const Te=Ee.get(re),Qe=$.object??$.index;Te.has(Qe)||(Te.add(Qe),ze.push($))}return ze}_drawAndSample({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:s,effects:u,pass:d},y=!1){const x=y?this.depthFBO:this.pickingFBO,E={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:x,deviceRect:o,cullRect:s,effects:u,pass:d,pickZ:y,preRenderStats:{},isPicking:!0};for(const H of u)H.useInPicking&&(E.preRenderStats[H.id]=H.preRender(E));const{decodePickingColor:S}=this.pickLayersPass.render(E),{x:O,y:k,width:U,height:J}=o,G=new(y?Float32Array:Uint8Array)(U*J*4);return this.device.readPixelsToArrayWebGL(x,{sourceX:O,sourceY:k,sourceWidth:U,sourceHeight:J,target:G}),{pickedColors:G,decodePickingColor:S}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:o}){const s=Math.max(0,e-n),u=Math.max(0,r-n),d=Math.min(i,e+n+1)-s,y=Math.min(o,r+n+1)-u;return d<=0||y<=0?null:{x:s,y:u,width:d,height:y}}}const YJ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},ZJ="top-left",CS="__root";class QJ{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ji(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const i=r[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:r=null,placement:n=ZJ}=e,i=e.onAdd({deck:this.deck,viewId:r});i&&this._getContainer(r,n).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){const n=e||CS;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let o=i.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,YJ[r]),i.append(o)),o}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,o=n===CS||i,s=this.containers[n];o?(s.style.display="block",s.style.left=`${i?i.x:0}px`,s.style.top=`${i?i.y:0}px`,s.style.width=`${i?i.width:e}px`,s.style.height=`${i?i.height:r}px`):s.style.display="none"}}onRedraw({viewports:e,layers:r}){const n=e.reduce((i,o)=>(i[o.id]=o,i),{});for(const i of this.getWidgets()){const{viewId:o}=i;if(o){const s=n[o];s&&(i.onViewportChange&&i.onViewportChange(s),i.onRedraw?.({viewports:[s],layers:r}))}else{if(i.onViewportChange)for(const s of e)i.onViewportChange(s);i.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(e,r){for(const n of this.getWidgets()){const{viewId:i}=n;(!i||i===e.viewport?.id)&&n.onHover?.(e,r)}}onEvent(e,r){const n=$1[r.type];if(n)for(const i of this.getWidgets()){const{viewId:o}=i;(!o||o===e.viewport?.id)&&i[n]?.(e,r)}}}const eX={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class tX{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,eX),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,r,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var Ld;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ld||(Ld={}));const Wx={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ns=(t,e,r)=>e?t.enable(r):t.disable(r),TS=(t,e,r)=>t.hint(r,e),Jo=(t,e,r)=>t.pixelStorei(r,e),ES=(t,e,r)=>{const n=r===36006?36009:36008;return t.bindFramebuffer(n,e)},fp=(t,e,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(i,e)};function Ov(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const rX={3042:ns,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ns,2885:(t,e)=>t.cullFace(e),2929:ns,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ns,35723:TS,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:ES,36010:ES,34964:fp,36662:fp,36663:fp,35053:fp,35055:fp,2886:(t,e)=>t.frontFace(e),33170:TS,2849:(t,e)=>t.lineWidth(e),32823:ns,32824:"polygonOffset",10752:"polygonOffset",35977:ns,32926:ns,32928:ns,32938:"sampleCoverage",32939:"sampleCoverage",3089:ns,3088:(t,e)=>t.scissor(...e),2960:ns,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:ns,10754:ns,12288:ns,12289:ns,12290:ns,12291:ns,12292:ns,12293:ns,12294:ns,12295:ns,3333:Jo,3317:Jo,37440:Jo,37441:Jo,37443:Jo,3330:Jo,3332:Jo,3331:Jo,3314:Jo,32878:Jo,3316:Jo,3315:Jo,32877:Jo,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Ov(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=Ov(e)&&e.length===3?[...e,...e]:e;const[r,n,i,o,s,u]=e;t.stencilFuncSeparate(1028,r,n,i),t.stencilFuncSeparate(1029,o,s,u)},stencilOp:(t,e)=>{e=Ov(e)&&e.length===3?[...e,...e]:e;const[r,n,i,o,s,u]=e;t.stencilOpSeparate(1028,r,n,i),t.stencilOpSeparate(1029,o,s,u)},viewport:(t,e)=>t.viewport(...e)};function Wi(t,e,r){return e[t]!==void 0?e[t]:r[t]}const nX={blendEquation:(t,e,r)=>t.blendEquationSeparate(Wi(32777,e,r),Wi(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(Wi(32969,e,r),Wi(32968,e,r),Wi(32971,e,r),Wi(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(Wi(32824,e,r),Wi(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(Wi(32938,e,r),Wi(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,Wi(2962,e,r),Wi(2967,e,r),Wi(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,Wi(34816,e,r),Wi(36003,e,r),Wi(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,Wi(2964,e,r),Wi(2965,e,r),Wi(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,Wi(34817,e,r),Wi(34818,e,r),Wi(34819,e,r))},BS={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:r}):{valueChanged:!0}},blendColor:(t,e,r,n,i)=>t({32773:new Float32Array([e,r,n,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,n,i)=>t({32969:e,32968:r,32971:n,32970:i}),clearColor:(t,e,r,n,i)=>t({3106:new Float32Array([e,r,n,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,n,i)=>t({3107:[e,r,n,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,n,i)=>t({3088:new Int32Array([e,r,n,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,n)=>t({2962:e,2967:r,2963:n,34816:e,36003:r,36004:n}),stencilFuncSeparate:(t,e,r,n,i)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(t,e,r,n)=>t({2964:e,2965:r,2966:n,34817:e,34818:r,34819:n}),stencilOpSeparate:(t,e,r,n,i)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(t,e,r,n,i)=>t({2978:[e,r,n,i]})},Lc=(t,e)=>t.isEnabled(e),SS={3042:Lc,2884:Lc,2929:Lc,3024:Lc,32823:Lc,32926:Lc,32928:Lc,3089:Lc,2960:Lc,35977:Lc},iX=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function wA(t,e){if(oX(e))return;const r={};for(const i in e){const o=Number(i),s=rX[i];s&&(typeof s=="string"?r[s]=!0:s(t,e[i],o))}const n=t.state&&t.state.cache;if(n)for(const i in r){const o=nX[i];o(t,e,n)}}function pL(t,e=Wx){if(typeof e=="number"){const i=e,o=SS[i];return o?o(t,i):t.getParameter(i)}const r=Array.isArray(e)?e:Object.keys(e),n={};for(const i of r){const o=SS[i];n[i]=o?o(t,Number(i)):t.getParameter(Number(i))}return n}function sX(t){wA(t,Wx)}function oX(t){for(const e in t)return!1;return!0}function aX(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&n&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class Nf{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];wA(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?pL(e):Object.assign({},Wx),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,lX(e);for(const n in BS){const i=BS[n];cX(e,n,i)}IS(e,"getParameter"),IS(e,"isEnabled")}_updateCache(e){let r=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const s=e[o],u=this.cache[o];aX(s,u)||(r=!0,n=u,i&&!(o in i)&&(i[o]=u),this.cache[o]=s)}return{valueChanged:r,oldValue:n}}}function IS(t,e){const r=t[e].bind(t);t[e]=function(i){if(i===void 0||iX.has(i))return r(i);const o=Nf.get(t);return i in o.cache||(o.cache[i]=r(i)),o.enable?o.cache[i]:r(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function cX(t,e,r){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...o){const s=Nf.get(t),{valueChanged:u,oldValue:d}=r(s._updateCache,...o);return u&&n(...o),d},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function lX(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const i=Nf.get(t);i.program!==n&&(e(n),i.program=n)}}function uX(t,e,r){let n="";const i={preserveDrawingBuffer:!0,...r};let o=null;if(o||=t.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,o=t.getContext("webgl2",i),o.luma||={},o.luma.softwareRenderer=!0),o||(o=t.getContext("webgl",{}),o&&(o=null,n||="Your browser only supports WebGL1")),!o)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:s,onContextRestored:u}=e;return t.addEventListener("webglcontextlost",d=>s(d),!1),t.addEventListener("webglcontextrestored",d=>u(d),!1),o.luma||={},o}function fA(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function fX(t,e){const r=t.getParameter(7936),n=t.getParameter(7937);fA(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,o=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),s=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),u=o||r,d=s||n,y=t.getParameter(7938),x=gL(u,d),E=hX(u,d),S=dX(u,d);return{type:"webgl",gpu:x,gpuType:S,gpuBackend:E,vendor:u,renderer:d,version:y,shadingLanguage:"glsl",shadingLanguageVersion:300}}function gL(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function hX(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function dX(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(gL(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function mL(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const wp="WEBGL_compressed_texture_s3tc",Cp="WEBGL_compressed_texture_s3tc_srgb",Nd="EXT_texture_compression_rgtc",kd="EXT_texture_compression_bptc",AX="WEBGL_compressed_texture_etc",pX="WEBGL_compressed_texture_astc",gX="WEBGL_compressed_texture_etc1",mX="WEBGL_compressed_texture_pvrtc",_X="WEBGL_compressed_texture_atc",MS="EXT_texture_norm16",PS="EXT_render_snorm",yX="EXT_color_buffer_float",Jx={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[PS],"norm16-renderable-webgl":[MS],"snorm16-renderable-webgl":[MS,PS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[wp,Cp,Nd,kd],"texture-compression-bc5-webgl":[Nd],"texture-compression-bc7-webgl":[kd],"texture-compression-etc2":[AX],"texture-compression-astc":[pX],"texture-compression-etc1-webgl":[gX],"texture-compression-pvrtc-webgl":[mX],"texture-compression-atc-webgl":[_X]};function vX(t){return t in Jx}function bX(t,e,r){return(Jx[e]||[]).every(i=>fA(t,i,r))}const Xx={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:yX,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:wp},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Cp},"bc1-rgba-unorm":{gl:33777,x:wp},"bc1-rgba-unorm-srgb":{gl:35916,x:Cp},"bc2-rgba-unorm":{gl:33778,x:wp},"bc2-rgba-unorm-srgb":{gl:35918,x:Cp},"bc3-rgba-unorm":{gl:33779,x:wp},"bc3-rgba-unorm-srgb":{gl:35919,x:Cp},"bc4-r-unorm":{gl:36283,x:Nd},"bc4-r-snorm":{gl:36284,x:Nd},"bc5-rg-unorm":{gl:36285,x:Nd},"bc5-rg-snorm":{gl:36286,x:Nd},"bc6h-rgb-ufloat":{gl:36495,x:kd},"bc6h-rgb-float":{gl:36494,x:kd},"bc7-rgba-unorm":{gl:36492,x:kd},"bc7-rgba-unorm-srgb":{gl:36493,x:kd},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function xX(t,e,r){let n=e.create;const i=Xx[e.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!fA(t,i.x,r)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function _L(t){const e=Xx[t],r=TX(t),n=wx(t);return{internalFormat:r,format:e?.dataFormat||CX(n.channels,n.integer,n.normalized,r),type:n.dataType?mL(n.dataType):e?.types?.[0]||5121,compressed:n.compressed||!1}}function wX(t){switch(wx(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function CX(t,e,r,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function TX(t){const r=Xx[t]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}const RS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class EX extends e7{gl;extensions;testedFeatures=new Set;constructor(e,r,n){super([],n),this.gl=e,this.extensions=r,fA(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const e=this.getFeatures();for(const r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),vX(e)&&bX(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of e)this.has(r)}getFeatures(){return[...Object.keys(RS),...Object.keys(Jx)]}getWebGLFeature(e){const r=RS[e];return typeof r=="string"?!!fA(this.gl,r,this.extensions):!!r}}class BX extends QG{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Dp extends F_{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);const n=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const n=this.colorAttachments[r];if(n){const i=36064+r;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){const r=wX(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${IX(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){const{gl:n}=this.device,{texture:i}=r,o=r.props.baseMipLevel,s=r.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,o,s);break;case 34067:const u=SX(s);n.framebufferTexture2D(36160,e,u,i.handle,o);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,o);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}function SX(t){return t<34069?t+34069:t}function IX(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class MX extends Cx{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Dp(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}}async function yL(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((i,o)=>{n.onload=i,n.onerror=s=>o(new Error(`Unable to load script '${t}': ${s}`)),r.appendChild(n)})}const PX=1;let Xo=null,FS=!1;const Kx={debugSpectorJS:Xt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function RX(t){if(!globalThis.SPECTOR)try{await yL(t.debugSpectorJSUrl||Kx.debugSpectorJSUrl)}catch(e){Xt.warn(String(e))}}function FX(t){if(t={...Kx,...t},!t.debugSpectorJS)return null;if(!Xo&&globalThis.SPECTOR&&!globalThis.luma?.spector){Xt.probe(PX,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Xo=new e,globalThis.luma&&(globalThis.luma.spector=Xo)}if(!Xo)return null;if(FS||(FS=!0,Xo.spyCanvases(),Xo?.onCaptureStarted.add(e=>Xt.info("Spector capture started:",e)()),Xo?.onCapture.add(e=>{Xt.info("Spector capture complete:",e)(),Xo?.getResultUI(),Xo?.resultView.display(),Xo?.resultView.addCapture(e)})),t.gl){const e=t.gl,r=e.device;Xo?.startCapture(t.gl,500),e.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{Xt.info("Spector capture stopped after 2 seconds")(),Xo?.stopCapture()})}return Xo}const DX="https://unpkg.com/webgl-debug@2.0.1/index.js";function vL(t){return t.luma=t.luma||{},t.luma}async function OX(){Kc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await yL(DX))}function LX(t,e={}){return e.debugWebGL||e.traceWebGL?kX(t,e):NX(t)}function NX(t){const e=vL(t);return e.realContext?e.realContext:t}function kX(t,e){if(!globalThis.WebGLDebugUtils)return Xt.warn("webgl-debug not loaded")(),t;const r=vL(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Ld,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,UX.bind(null,e),zX.bind(null,e));for(const s in Ld)!(s in n)&&typeof Ld[s]=="number"&&(n[s]=Ld[s]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,n);const o=Object.create(i);return r.realContext=t,r.debugContext=o,o.debug=!0,o}function DS(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function UX(t,e,r,n){n=Array.from(n).map(u=>u===void 0?"undefined":u);const i=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),s=`${i} in gl.${r}(${o})`;Xt.error(s)();debugger}function zX(t,e,r){let n="";Xt.level>=1&&(n=DS(e,r),t.traceWebGL&&Xt.log(1,n)());for(const i of r)if(i===void 0){n=n||DS(e,r);debugger}}const Lv={};function GX(t="id"){Lv[t]=Lv[t]||1;const e=Lv[t]++;return`${t}-${e}`}class Op extends Li{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;const n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=VX(this.props.usage),this.glUsage=HX(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,n=e.byteLength+r){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,r,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;const n=new Uint8Array(r),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,i,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,r),n}}function VX(t){return t&Li.INDEX?34963:t&Li.VERTEX?34962:t&Li.UNIFORM?35345:34962}function HX(t){return t&Li.INDEX||t&Li.VERTEX?35044:t&Li.UNIFORM?35048:35044}function jX(t){const e=t.split(/\r?\n/),r=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[E,S]=i;r.push({message:S.trim(),type:OS(E),lineNum:0,linePos:0});continue}const[o,s,u,...d]=i;let y=parseInt(u,10);isNaN(y)&&(y=0);let x=parseInt(s,10);isNaN(x)&&(x=0),r.push({message:d.join(":").trim(),type:OS(o),lineNum:y,linePos:x})}return r}function OS(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class $X extends R_{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?jX(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Xt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Xt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function WX(t,e,r,n){if(qX(e))return n(t);const i=t;i.pushState();try{return JX(t,e),wA(i.gl,r),n(t)}finally{i.popState()}}function JX(t,e){const r=t,{gl:n}=r;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(kf("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=kf("provokingVertex",e.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(s)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=kf("polygonMode",e.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,s),o?.polygonModeWEBGL(1029,s)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(KX("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(e2("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Xt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,o=e2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Nv("stencilPassOperation",e.stencilPassOperation),o=Nv("stencilFailOperation",e.stencilFailOperation),s=Nv("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,s,i),n.stencilOpSeparate(1029,o,s,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=LS("blendColorOperation",e.blendColorOperation||"add"),o=LS("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);const s=C0("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=C0("blendColorDstFactor",e.blendColorDstFactor||"zero"),d=C0("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),y=C0("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,u,d,y)}}function e2(t,e){return kf(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Nv(t,e){return kf(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function LS(t,e){return kf(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function C0(t,e){return kf(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function XX(t,e){return`Illegal parameter ${e} for ${t}`}function kf(t,e,r){if(!(e in r))throw new Error(XX(t,e));return r[e]}function KX(t,e){return e}function qX(t){let e=!0;for(const r in t){e=!1;break}return e}function bL(t){const e={};return t.addressModeU&&(e[10242]=kv(t.addressModeU)),t.addressModeV&&(e[10243]=kv(t.addressModeV)),t.addressModeW&&(e[32882]=kv(t.addressModeW)),t.magFilter&&(e[10240]=t2(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=YX(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=e2("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function kv(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function t2(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function YX(t,e="none"){if(!e)return t2(t);switch(e){case"none":return t2(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class r2 extends Jp{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=bL(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[r,n]of Object.entries(e)){const i=Number(r);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}}class Ud extends P_{device;gl;handle;texture;constructor(e,r){super(e,{...Yn.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const ZX="Failed to deduce GL constant from typed array";function QX(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ZX)}}function eK(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function xL(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function tK(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Ym(t,e,r){if(rK(e))return r(t);const{nocatch:n=!0}=e,i=Nf.get(t);i.push(),wA(t,e);let o;if(n)o=r(t),i.pop();else try{o=r(t)}finally{i.pop()}return o}function rK(t){for(const e in t)return!1;return!0}function nK(t,e,r){const{dimension:n,width:i,height:o,depth:s=0}=r,{glInternalFormat:u}=r,d=r.glTarget;switch(n){case"2d-array":case"3d":t.texStorage3D(d,e,u,i,o,s);break;default:t.texStorage2D(d,e,u,i,o)}}function NS(t,e,r,n){const{width:i,height:o}=n,{dimension:s,depth:u=0,mipLevel:d=0}=n,{x:y=0,y:x=0,z:E=0}=n,{glFormat:S,glType:O}=n,k=wL(n.glTarget,s,u),U=n.flipY?{37440:!0}:{};Ym(t,U,()=>{switch(s){case"2d-array":case"3d":t.bindTexture(k,e),t.texSubImage3D(k,d,y,x,E,i,o,u,S,O,r),t.bindTexture(k,null);break;case"2d":case"cube":t.bindTexture(k,e),t.texSubImage2D(k,d,y,x,i,o,S,O,r),t.bindTexture(k,null);break;default:throw new Error(s)}})}function kS(t,e,r){const{dimension:n,width:i,height:o,depth:s=0,mipLevel:u=0,byteOffset:d=0}=r,{x:y=0,y:x=0,z:E=0}=r,{glFormat:S,glType:O,compressed:k}=r,U=wL(r.glTarget,n,s);switch(n){case"2d-array":case"3d":k?t.compressedTexSubImage3D(U,u,y,x,E,i,o,s,S,e,d):t.texSubImage3D(U,u,y,x,E,i,o,s,S,O,e,d);break;case"2d":case"cube":k?t.compressedTexSubImage2D(U,u,y,x,i,o,S,e,d):t.texSubImage2D(U,u,y,x,i,o,S,O,e,d);break;default:throw new Error(n)}}function iK(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function wL(t,e,r){return e==="cube"?34069+r:t}function sK(t,e){const{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:o=null,sourceWidth:s,sourceHeight:u,sourceDepth:d,sourceFormat:y,sourceType:x}=e||{};const{framebuffer:E,deleteFramebuffer:S}=CL(t),{gl:O,handle:k}=E;s||=E.width,u||=E.height;const U=E.colorAttachments[i]?.texture;if(!U)throw new Error(`Invalid framebuffer attachment ${i}`);d=U?.depth||1,y||=U?.glFormat||6408,x||=U?.glType||5121,o=cK(o,x,y,s,u),x=x||QX(o);const J=O.bindFramebuffer(36160,k);return O.readBuffer(36064+i),O.readPixels(r,n,s,u,y,x,o),O.readBuffer(36064),O.bindFramebuffer(36160,J||null),S&&E.destroy(),o}function oK(t,e){const{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:s=0}=e||{};let{sourceWidth:u,sourceHeight:d,sourceType:y}=e||{};const{framebuffer:x,deleteFramebuffer:E}=CL(t);u=u||x.width,d=d||x.height;const S=x;y=y||5121;let O=r;if(!O){const U=xL(o),J=tK(y),G=s+u*d*U*J;O=S.device.createBuffer({byteLength:G})}const k=t.device.createCommandEncoder();return k.copyTextureToBuffer({sourceTexture:t,width:u,height:d,origin:[n,i],destinationBuffer:O,byteOffset:s}),k.destroy(),E&&x.destroy(),O}function CL(t){return t instanceof F_?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:aK(t),deleteFramebuffer:!0}}function aK(t,e){const{device:r,width:n,height:i,id:o}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[t]})}function cK(t,e,r,n,i,o){if(t)return t;e||=5121;const s=eK(e,{clamped:!1}),u=xL(r);return new s(n*i*u)}class Lp extends Yn{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,r){super(e,r);const n={...this.props};n.data=r.data,this.device=e,this.gl=this.device.gl,this.glTarget=iK(this.props.dimension);const i=_L(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(n),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:r,height:n}=e;if(!r||!n){const i=Yn.getTextureDataSize(e.data);r=i?.width||1,n=i?.height||1}if(this.width=r,this.height=n,this.depth=e.depth,this.setSampler(e.sampler),this.view=new Ud(this.device,{...this.props,texture:this}),this.bind(),nK(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Ud(this.device,{...e,texture:this})}setSampler(e={}){let r;e instanceof r2?(this.sampler=e,r=e.props):(this.sampler=new r2(this.device,e),r=e);const n=bL(r);this._setSamplerParameters(n)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Xt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Xt.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const r=Yn.getExternalImageSize(e.image),n={...Yn.defaultCopyExternalImageOptions,...r,...e},{image:i,depth:o,mipLevel:s,x:u,y:d,z:y,flipY:x}=n;let{width:E,height:S}=n;const{dimension:O,glTarget:k,glFormat:U,glInternalFormat:J,glType:G}=this;if(E=Math.min(E,this.width-u),S=Math.min(S,this.height-d),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return NS(this.device.gl,this.handle,i,{dimension:O,mipLevel:s,x:u,y:d,z:y,width:E,height:S,depth:o,glFormat:U,glType:G,glTarget:k,flipY:x}),{width:n.width,height:n.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,r=0){this.bind();const n=Yn.normalizeTextureData(e,this);n.length>1&&this.props.mipmaps!==!1&&Xt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const o=n[i];this._setMipLevel(r,i,o)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),kS(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const n of Yn.CubeFaces)this.setTextureCubeFaceData(e[n],n)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,r,n=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Xt.warn(`${this.id} has mipmap and multiple LODs.`)();const i=Yn.CubeFaces.indexOf(r);this.setTexture2DData(e,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:r,width:n,height:i,pixels:o,data:s,format:u=6408,type:d=5121}=e,{gl:y}=this,x=o||s;this.bind(),x instanceof Promise?x.then(E=>this.setImageDataForFace(Object.assign({},e,{face:r,data:E,pixels:E}))):this.width||this.height?y.texImage2D(r,0,u,n,i,0,u,d,x):y.texImage2D(r,0,u,u,d,x)}_getImageDataMap(e){for(let r=0;r<Yn.CubeFaces.length;++r){const n=Yn.CubeFaces[r];e[n]&&(e[34069+r]=e[n],delete e[n])}return e}_setSamplerParameters(e){Xt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,n]of Object.entries(e)){const i=Number(r),o=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,o);break;case 10241:this.gl.texParameteri(this.glTarget,i,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,i,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,o);break;default:this.gl.texParameteri(this.glTarget,i,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,r,n,i=this.glTarget){if(Yn.isExternalImage(n)){NS(this.device.gl,this.handle,n,{...this,depth:e,mipLevel:r,glTarget:i,flipY:this.props.flipY});return}if(Yn.isTextureLevelData(n)){kS(this.device.gl,n.data,{...this,depth:e,mipLevel:r,glTarget:i});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}}const lK=[1,2,4,8];class uK extends Ef{device;glParameters;constructor(e,r){super(e,r),this.device=e;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){const{width:o,height:s}=r.framebuffer;n=[0,0,o,s]}else{const[o,s]=e.getCanvasContext().getDrawingBufferSize();n=[0,0,o,s]}if(this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const o=this.props.framebuffer.colorAttachments.map((s,u)=>36064+u);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=lK.map(n=>!!(n&e.colorMask))),this.glParameters=r,wA(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&Ym(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){Ym(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function fK(t){return hK.includes(t)}const hK=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],TL={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function EL(t){const e=TL[t];if(!e)throw new Error("uniform");const[r,n,,i]=e;return{format:i,components:n,glType:r}}function dK(t){const e=TL[t];if(!e)throw new Error("attribute");const[,r,,n,i]=e;return{attributeType:n,vertexFormat:i,components:r}}function AK(t,e){const r={attributes:[],bindings:[]};r.attributes=pK(t,e);const n=_K(t,e);for(const u of n){const d=u.uniforms.map(y=>({name:y.name,format:y.format,byteOffset:y.byteOffset,byteStride:y.byteStride,arrayLength:y.arrayLength}));r.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:d})}const i=mK(t,e);let o=0;for(const u of i)if(fK(u.type)){const{viewDimension:d,sampleType:y}=vK(u.type);r.bindings.push({type:"texture",name:u.name,group:0,location:o,viewDimension:d,sampleType:y}),u.textureUnit=o,o+=1}i.length&&(r.uniforms=i);const s=gK(t,e);return s?.length&&(r.varyings=s),r}function pK(t,e){const r=[],n=t.getProgramParameter(e,35721);for(let i=0;i<n;i++){const o=t.getActiveAttrib(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:u}=o,d=t.getAttribLocation(e,s);if(d>=0){const{attributeType:y}=dK(u),x=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:d,stepMode:x,type:y})}}return r.sort((i,o)=>i.location-o.location),r}function gK(t,e){const r=[],n=t.getProgramParameter(e,35971);for(let i=0;i<n;i++){const o=t.getTransformFeedbackVarying(e,i);if(!o)throw new Error("activeInfo");const{name:s,type:u,size:d}=o,{glType:y,components:x}=EL(u),E={location:i,name:s,type:y,size:d*x};r.push(E)}return r.sort((i,o)=>i.location-o.location),r}function mK(t,e){const r=[],n=t.getProgramParameter(e,35718);for(let i=0;i<n;i++){const o=t.getActiveUniform(e,i);if(!o)throw new Error("activeInfo");const{name:s,size:u,type:d}=o,{name:y,isArray:x}=bK(s);let E=t.getUniformLocation(e,y);const S={location:E,name:y,size:u,type:d,isArray:x};if(r.push(S),S.size>1)for(let O=0;O<S.size;O++){const k=`${y}[${O}]`;E=t.getUniformLocation(e,k);const U={...S,name:k,location:E};r.push(U)}}return r}function _K(t,e){const r=(o,s)=>t.getActiveUniformBlockParameter(e,o,s),n=[],i=t.getProgramParameter(e,35382);for(let o=0;o<i;o++){const s={name:t.getActiveUniformBlockName(e,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},u=r(o,35395)||[],d=t.getActiveUniforms(e,u,35383),y=t.getActiveUniforms(e,u,35384),x=t.getActiveUniforms(e,u,35387),E=t.getActiveUniforms(e,u,35388);for(let S=0;S<s.uniformCount;++S){const O=t.getActiveUniform(e,u[S]);if(!O)throw new Error("activeInfo");s.uniforms.push({name:O.name,format:EL(d[S]).format,type:d[S],arrayLength:y[S],byteOffset:x[S],byteStride:E[S]})}n.push(s)}return n.sort((o,s)=>o.location-s.location),n}const yK={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function vK(t){const e=yK[t];if(!e)throw new Error("sampler");const[r,n]=e;return{viewDimension:r,sampleType:n}}function bK(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function xK(t,e,r,n){const i=t;let o=n;o===!0&&(o=1),o===!1&&(o=0);const s=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,s);case 35664:return t.uniform2fv(e,s);case 35665:return t.uniform3fv(e,s);case 35666:return t.uniform4fv(e,s);case 5124:return t.uniform1iv(e,s);case 35667:return t.uniform2iv(e,s);case 35668:return t.uniform3iv(e,s);case 35669:return t.uniform4iv(e,s);case 35670:return t.uniform1iv(e,s);case 35671:return t.uniform2iv(e,s);case 35672:return t.uniform3iv(e,s);case 35673:return t.uniform4iv(e,s);case 5125:return i.uniform1uiv(e,s,1);case 36294:return i.uniform2uiv(e,s,2);case 36295:return i.uniform3uiv(e,s,3);case 36296:return i.uniform4uiv(e,s,4);case 35674:return t.uniformMatrix2fv(e,!1,s);case 35675:return t.uniformMatrix3fv(e,!1,s);case 35676:return t.uniformMatrix4fv(e,!1,s);case 35685:return i.uniformMatrix2x3fv(e,!1,s);case 35686:return i.uniformMatrix2x4fv(e,!1,s);case 35687:return i.uniformMatrix3x2fv(e,!1,s);case 35688:return i.uniformMatrix3x4fv(e,!1,s);case 35689:return i.uniformMatrix4x2fv(e,!1,s);case 35690:return i.uniformMatrix4x3fv(e,!1,s)}throw new Error("Illegal uniform")}function wK(t){return nL(t)!==null||typeof t=="number"||typeof t=="boolean"}function CK(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];wK(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}function TK(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function EK(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const US=4;class BK extends oA{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:n,bufferMode:i=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Xt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=AK(this.device.gl,this.handle),Xt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=SK(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(const[n,i]of Object.entries(e)){const o=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!o){const s=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r?.disableWarnings||Xt.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${s}`,i)();continue}switch(i||Xt.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(i instanceof Op)&&!(i.buffer instanceof Op))throw new Error("buffer value");break;case"texture":if(!(i instanceof Ud||i instanceof Lp||i instanceof Dp))throw new Error("texture value");break;case"sampler":Xt.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(o.type)}this.bindings[n]=i}}draw(e){const{renderPass:r,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:o,vertexCount:s,instanceCount:u,isInstanced:d=!1,firstVertex:y=0,transformFeedback:x}=e,E=TK(i),S=!!o.indexBuffer,O=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),x&&x.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const k=r;return WX(this.device,n,k.glParameters,()=>{S&&d?this.device.gl.drawElementsInstanced(E,s||0,O,y,u||0):S?this.device.gl.drawElements(E,s||0,O,y):d?this.device.gl.drawArraysInstanced(E,y,s||0,u||0):this.device.gl.drawArrays(E,y,s||0),x&&x.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(e){const{bindings:r}=CK(e);Object.keys(r).forEach(n=>{Xt.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Xt.time(US,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Xt.timeEnd(US,`linkProgram for ${this.id}`)(),Xt.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Xt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Xt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${r}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async i=>await new Promise(o=>setTimeout(o,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Xt.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let r=0,n=0;for(const i of this.shaderLayout.bindings){const o=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:s}=i,u=e.getUniformBlockIndex(this.handle,s);if(u===4294967295)throw new Error(`Invalid uniform block name ${s}`);e.uniformBlockBinding(this.handle,n,u),o instanceof Op?e.bindBufferBase(35345,n,o.handle):e.bindBufferRange(35345,n,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),n+=1;break;case"texture":if(!(o instanceof Ud||o instanceof Lp||o instanceof Dp))throw new Error("texture");let d;if(o instanceof Ud)d=o.texture;else if(o instanceof Lp)d=o;else if(o instanceof Dp&&o.colorAttachments[0]instanceof Ud)Xt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=o.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(d.glTarget,d.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:r,location:n,type:i,textureUnit:o}=e,s=this.uniforms[r]??o;s!==void 0&&xK(this.device.gl,n,i,s)}}}function SK(t,e){const r={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of e?.attributes||[]){const i=r.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Xt.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class IK extends Ex{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const r of e)switch(r.name){case"copy-buffer-to-buffer":MK(this.device,r.options);break;case"copy-buffer-to-texture":PK(this.device,r.options);break;case"copy-texture-to-buffer":RK(this.device,r.options);break;case"copy-texture-to-texture":FK(this.device,r.options);break;default:throw new Error(r.name)}}}function MK(t,e){const r=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function PK(t,e){throw new Error("Not implemented")}function RK(t,e){const{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:o=e.sourceTexture.width,height:s=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:d=[0,0],destinationBuffer:y,byteOffset:x=0,bytesPerRow:E,rowsPerImage:S}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||u!==0||E||S)throw new Error("not implemented");const{framebuffer:O,destroyFramebuffer:k}=BL(r);let U;try{const J=y,G=o||O.width,H=s||O.height,K=_L(O.colorAttachments[0].texture.props.format),he=K.format,Y=K.type;t.gl.bindBuffer(35051,J.handle),U=t.gl.bindFramebuffer(36160,O.handle),t.gl.readPixels(d[0],d[1],G,H,he,Y,x)}finally{t.gl.bindBuffer(35051,null),U!==void 0&&t.gl.bindFramebuffer(36160,U),k&&O.destroy()}}function FK(t,e){const{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=e;let{width:u=e.destinationTexture.width,height:d=e.destinationTexture.height}=e;const{framebuffer:y,destroyFramebuffer:x}=BL(r),[E,S]=i,[O,k,U]=o,J=t.gl.bindFramebuffer(36160,y.handle);let G=null,H;if(s instanceof Lp)G=s,u=Number.isFinite(u)?u:G.width,d=Number.isFinite(d)?d:G.height,G.bind(0),H=G.glTarget;else throw new Error("invalid destination");switch(H){case 3553:case 34067:t.gl.copyTexSubImage2D(H,n,O,k,E,S,u,d);break;case 35866:case 32879:t.gl.copyTexSubImage3D(H,n,O,k,U,E,S,u,d);break}G&&G.unbind(),t.gl.bindFramebuffer(36160,J),x&&y.destroy()}function BL(t){if(t instanceof Yn){const{width:e,height:r,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class DK extends Tx{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new IK(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,n){}}function OK(t){const{target:e,source:r,start:n=0,count:i=1}=t,o=r.length,s=i*o;let u=0;for(let d=n;u<o;u++)e[d++]=r[u];for(;u<s;)u<s-u?(e.copyWithin(n+u,n,n+u),u*=2):(e.copyWithin(n+u,n,n+s-u),u=s);return t.target}class qx extends Bx{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return TU()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){const n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:o,stride:s,offset:u,normalized:d,integer:y,divisor:x}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),y?this.device.gl.vertexAttribIPointer(e,i,o,s,u):this.device.gl.vertexAttribPointer(e,i,o,d,s,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,x||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){const r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);const n=mL(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){const i=qx.isConstantAttributeZeroSupported(this.device)||e!==0;(r||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){const n=LK(r),i=n.byteLength*e,o=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!NK(n,this.bufferValue),s){const u=I7(r.constructor,o);OK({target:u,source:n,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function LK(t){return Array.isArray(t)?new Float32Array(t):t}function NK(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class kK extends Sx{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(EK(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){const n=this._getVaryingIndex(e),{buffer:i,byteLength:o,byteOffset:s}=this._getBufferRange(r);if(n<0){this.unusedBuffers[e]=i,Xt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:i,byteLength:o,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,o)}getBuffer(e){if(zS(e))return this.buffers[e]||null;const r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Op)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:r,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:r,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(zS(e))return Number(e);for(const r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:r,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,n=0,i){const o=r&&r.handle;!o||i===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,n,i)}}function zS(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class UK extends Ix{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,i)=>{const o=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class zd extends Tu{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||GX("webgl-device")});const r=Tu._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new MX(this,r),this.lost=new Promise(x=>{this._resolveContextLost=x});const i={...e.webgl};r.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const s=this.props._handle||uX(this.canvasContext.canvas,{onContextLost:x=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:x=>console.log("WebGL context restored")},i);if(!s)throw new Error("WebGL context creation failed");if(n=s.device,n){if(e._reuseDevices)return Xt.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=s,this.gl=s,this.spectorJS=FX({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=fX(this.gl,this._extensions),this.limits=new BX(this.gl),this.features=new EX(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Nf(this.gl,{log:(...x)=>Xt.log(1,...x)()}).trackState(this.gl,{copyState:!1});const d=e.debugWebGL||e.debug,y=e.debugWebGL;d&&(this.gl=LX(this.gl,{debugWebGL:d,traceWebGL:y}),Xt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Xt.level=Math.max(Xt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const r=this._normalizeBufferProps(e);return new Op(this,r)}createTexture(e){return new Lp(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new r2(this,e)}createShader(e){return new $X(this,e)}createFramebuffer(e){return new Dp(this,e)}createVertexArray(e){return new qx(this,e)}createTransformFeedback(e){return new kK(this,e)}createQuerySet(e){return new UK(this,e)}createRenderPipeline(e){return new BK(this,e)}beginRenderPass(e){return new uK(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new DK(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return sK(e,r)}readPixelsToBufferWebGL(e,r){return oK(e,r)}setParametersWebGL(e){wA(this.gl,e)}getParametersWebGL(e){return pL(this.gl,e)}withParametersWebGL(e,r){return Ym(this.gl,e,r)}resetWebGL(){Xt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),sX(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return xX(this.gl,e,this._extensions)}loseDevice(){let e=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(e=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Nf.get(this.gl).push()}popState(){Nf.get(this.gl).pop()}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){const r={emptyIfUnknown:!0};return Object.entries(e).reduce((n,[i,o])=>(n[`${i}:${this.getGLKey(i,r)}`]=`${o}:${this.getGLKey(o,r)}`,n),{})}_constants;setConstantAttributeWebGL(e,r){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&HK(i,r)&&Xt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:zK(this,e,r);break;case Int32Array:GK(this,e,r);break;case Uint32Array:VK(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return fA(this.gl,e,this._extensions),this._extensions}}function zK(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break}}function GK(t,e,r){t.gl.vertexAttribI4iv(e,r)}function VK(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function HK(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}const jK={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},$K=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),WK=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),JK=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function XK(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&KK(i),i}return this.originalGetContext(r,n)}}function KK(t){t.getExtension("EXT_color_buffer_float");const e={...jK,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:$K(t),OES_vertex_array_object:WK(t),ANGLE_instanced_arrays:JK(t)},r=t.getExtension;t.getExtension=function(i){const o=r.call(t,i);return o||(i in e?e[i]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(n.apply(t)||[])?.concat(Object.keys(e))}}const T0=1;class qK extends s7{type="webgl";constructor(){super(),Tu.defaultProps={...Tu.defaultProps,...Kx},zd.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){XK(e)}async attach(e){if(e instanceof zd)return e;if(e?.device instanceof Tu)return e.device;if(!YK(e))throw new Error("Invalid WebGL2RenderingContext");return new zd({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){Xt.groupCollapsed(T0,"WebGLDevice created")();const r=[];(e.debugWebGL||e.debug)&&r.push(OX()),e.debugSpectorJS&&r.push(RX(e));const n=await Promise.allSettled(r);for(const s of n)s.status==="rejected"&&Xt.error(`Failed to initialize debug libraries ${s.reason}`)();const i=new zd(e),o=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return Xt.probe(T0,o)(),Xt.table(T0,i.info)(),Xt.groupEnd(T0)(),i}}function YK(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const GS=new qK;function gu(){}const ZK=({isDragging:t})=>t?"grabbing":"grab",SL={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:gu,onWebGLInitialized:gu,onResize:gu,onViewStateChange:gu,onInteractionStateChange:gu,onBeforeRender:gu,onAfterRender:gu,onLoad:gu,onError:t=>Wr.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:ZK,getTooltip:null,debug:!1,drawPickingColors:!1};class Yx{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new uL({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=$1[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const s=this.layerManager.getLayers(),u=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:s,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:d}=u,y=d&&(d[i]||d.props[i]),x=this.props[i];let E=!1;y&&(E=y.call(d,u,n)),E||(x?.(u,n),this.widgetManager.onEvent(u,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...SL,...e},e=this.props,e.viewState&&e.initialViewState&&Wr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Wr.error("WebGL1 context not supported.")(),r=GS.attach(e.gl)),r||(r=D1.createDevice({type:"best-available",_reuseDevices:!0,adapters:[GS],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&lA.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Wr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Wr.removed("onLayerClick","onClick")(),e.initialViewState&&!Ji(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return r=r||n||i||o||s,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Us(this.viewManager),this.viewManager.views}getViewports(e){return Us(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,n){Us(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),o}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),Us(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;const{width:r,height:n}=e;if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=i}if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,n=e.clientHeight??e.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(e,r){const{gl:n,onError:i,useDevicePixels:o}=r;return new DW({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new hL({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let i=n,o=!1;for(const s of r)i=s,o=s.layer?.onHover(s,e.event)||o;o||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new rL;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new u$(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(rS).map(i=>{const[o,s,u,d]=rS[i],y=this.props.eventRecognizerOptions?.[i],x={...s,...y,event:i};return{recognizer:new o(x),recognizeWith:u,requestFailure:d}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in $1)this.eventManager.on(i,this._onEvent);this.viewManager=new TJ({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new CJ(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new GJ({deck:this,device:this.device}),this.deckRenderer=new jJ(this.device),this.deckPicker=new qJ(this.device),this.widgetManager=new QJ({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new tX),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Wr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=D1.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Yx.defaultProps=SL;Yx.VERSION=tG;function QK(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return sO(t)}}const eq=iO;function E0(t,e,r){const n=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Mf(t){return t.stride||t.size*t.bytesPerElement}function tq(t,e){return t.type===e.type&&t.size===e.size&&Mf(t)===Mf(e)&&(t.offset||0)===(e.offset||0)}function n2(t,e){e.offset&&Wr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=Mf(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,o=n*r+i*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:r}}function rq(t,e){const r=n2(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class nq{constructor(e,r,n){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const i=r.logicalType||r.type,o=i==="float64";let{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let u;o?u="float32":!i&&r.isIndexed?u="uint32":u=i||"float32";let d=QK(i||u);this.doublePrecision=o,o&&r.fp64===!1&&(d=Float32Array),this.value=null,this.settings={...r,defaultType:d,defaultValue:s,logicalType:i,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:d.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Mf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),lA.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const n={};if(this.state.constant){const i=this.value;if(r){const o=n2(this.getAccessor(),r),s=o.offset/i.BYTES_PER_ELEMENT,u=o.size||this.size;n[e]=i.subarray(s,s+u)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,r=null){const n=this.getAccessor(),i=[],o={name:this.id,byteStride:Mf(n),attributes:i};if(this.doublePrecision){const s=rq(n,r||{});i.push(E0(e,{...n,...s.high},this.device.type),E0(`${e}64Low`,{...n,...s.low},this.device.type))}else if(r){const s=n2(n,r);i.push(E0(e,{...n,...s},this.device.type))}else i.push(E0(e,n,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:n,size:i}=this,o=n*i;if(r&&o&&r.length>=o){const s=new Array(i).fill(1/0),u=new Array(i).fill(-1/0);for(let d=0;d<o;)for(let y=0;y<i;y++){const x=r[d++];x<s[y]&&(s[y]=x),x>u[y]&&(u[y]=x)}e=[s,u]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Li?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const s=eq(n.value);i.type=i.normalized?s.replace("int","norm"):s}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Mf(i)}if(r.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;r.externalBuffer=o,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:s}=this;const u=Mf(i),d=(i.vertexOffset||0)*u;if(this.doublePrecision&&o instanceof Float64Array&&(o=Iv(o,i)),this.settings.isIndexed){const x=this.settings.defaultType;o.constructor!==x&&(o=new x(o))}const y=o.byteLength+d+u*2;(!s||s.byteLength<y)&&(s=this._createBuffer(y)),s.write(o,d)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?Iv(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:n}=this,i=n.allocatedValue,o=lA.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;const{byteOffset:s}=this;let{buffer:u}=this;return(!u||u.byteLength<o.byteLength+s)&&(u=this._createBuffer(o.byteLength+s),r&&i&&u.write(i instanceof Float64Array?Iv(i,this):i,s)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Wr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,n){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return r[n]=e,r;if(!e){let s=o;for(;--s>=0;)r[n+s]=i[s];return r}switch(o){case 4:r[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:r[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:r[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:r[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let s=o;for(;--s>=0;)r[n+s]=Number.isFinite(e[s])?e[s]:i[s]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==r[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?Li.INDEX:Li.VERTEX)|Li.COPY_DST,indexType:r?n:void 0,byteLength:e}),this._buffer}}const VS=[],HS=[];function qc(t,e=0,r=1/0){let n=VS;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(HS.length=t.length,n=HS):n=VS,(e>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,r),i.index=e-1),{iterable:n,objectInfo:i}}function IL(t){return t&&t[Symbol.asyncIterator]}function ML(t,e){const{size:r,stride:n,offset:i,startIndices:o,nested:s}=e,u=t.BYTES_PER_ELEMENT,d=n?n/u:r,y=i?i/u:0,x=Math.floor((t.length-y)/d);return(E,{index:S,target:O})=>{if(!o){const G=S*d+y;for(let H=0;H<r;H++)O[H]=t[G+H];return O}const k=o[S],U=o[S+1]||x;let J;if(s){J=new Array(U-k);for(let G=k;G<U;G++){const H=G*d+y;O=new Array(r);for(let K=0;K<r;K++)O[K]=t[H+K];J[G-k]=O}}else if(d===r)J=t.subarray(k*r+y,U*r+y);else{J=new t.constructor((U-k)*r);let G=0;for(let H=k;H<U;H++){const K=H*d+y;for(let he=0;he<r;he++)J[G++]=t[K+he]}}return J}}const iq=[],pm=[[0,1/0]];function sq(t,e){if(t===pm||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],n=t.length;let i=0;for(let o=0;o<n;o++){const s=t[o];s[1]<e[0]?(r.push(s),i=o+1):s[0]>e[1]?r.push(s):e=[Math.min(s[0],e[0]),Math.max(s[1],e[1])]}return r.splice(i,0,e),r}const oq={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function PL(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...oq[r],...e,...t,type:r}}class RL extends nq{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:pm}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!tq(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?e[r.find(o=>e[o])]:e[r];return PL(i,n)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=sq(this.state.updateRanges,[n,i])}else this.state.updateRanges=pm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=iq}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,r.updateRanges!==pm),!0):!1}updateBuffer({numInstances:e,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:u}}=this;let d=!0;if(s){for(const[y,x]of o)s.call(i,this,{data:r,startRow:y,endRow:x,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[y,x]of o){const E=Number.isFinite(y)?this.getVertexOffset(y):0,S=Number.isFinite(x)?this.getVertexOffset(x):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:E,endOffset:S})}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const s=e;Us(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);const u=!!s.size&&s.size!==this.size;return n.binaryAccessor=ML(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const n in e)Object.assign(r,super.getValue(n,e[n]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(const o in r){const s=super._getBufferLayout(o,r[o]);n.attributes.push(...s.attributes)}return n}_autoUpdater(e,{data:r,startRow:n,endRow:i,props:o,numInstances:s}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:u,state:d,value:y,size:x,startIndices:E}=e,{accessor:S,transform:O}=u;let k=d.binaryAccessor||(typeof S=="function"?S:o[S]);typeof k!="function"&&(k=()=>k),Us(typeof k=="function",`accessor "${S}" is not a function`);let U=e.getVertexOffset(n);const{iterable:J,objectInfo:G}=qc(r,n,i);for(const H of J){G.index++;let K=k(H,G);if(O&&(K=O.call(this,K)),E){const he=(G.index<E.length-1?E[G.index+1]:s)-E[G.index];if(K&&Array.isArray(K[0])){let Y=U;for(const oe of K)e._normalizeValue(oe,y,Y),Y+=x}else K&&K.length>x?y.set(K,U):(e._normalizeValue(K,G.target,0),yJ({target:y,source:G.target,start:U,count:he}));U+=he*x}else e._normalizeValue(K,y,U),U+=x}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Uv(t){const{source:e,target:r,start:n=0,size:i,getData:o}=t,s=t.end||r.length,u=e.length,d=s-n;if(u>d){r.set(e.subarray(0,d),n);return}if(r.set(e,n),!o)return;let y=u;for(;y<d;){const x=o(y,e);for(let E=0;E<i;E++)r[n+y]=x[E]||0,y++}}function aq({source:t,target:e,size:r,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return Uv({source:t,target:e,size:r,getData:n}),e;let s=0,u=0;const d=n&&((x,E)=>n(x+u,E)),y=Math.min(i.length,o.length);for(let x=1;x<y;x++){const E=i[x]*r,S=o[x]*r;Uv({source:t.subarray(s,E),target:e,start:u,end:S,size:r,getData:d}),s=E,u=S}return u<e.length&&Uv({source:[],target:e,start:u,size:r,getData:d}),e}function cq(t){const{device:e,settings:r,value:n}=t,i=new RL(e,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function FL(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function DL(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function OL(t){t.push(t.shift())}function lq(t,e){const{doublePrecision:r,settings:n,value:i,size:o}=t,s=r&&i instanceof Float64Array?2:1;let u=0;const{shaderAttributes:d}=t.settings;if(d)for(const y of Object.values(d))u=Math.max(u,y.vertexOffset??0);return(n.noAlloc?i.length:(e+u)*o)*s}function LL({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function NL({device:t,buffer:e,attribute:r,fromLength:n,toLength:i,fromStartIndices:o,getData:s=u=>u}){const u=r.doublePrecision&&r.value instanceof Float64Array?2:1,d=r.size*u,y=r.byteOffset,x=r.settings.bytesPerElement<4?y/r.settings.bytesPerElement*4:y,E=r.startIndices,S=o&&E,O=r.isConstant;if(!S&&e&&n>=i)return e;const k=r.value instanceof Float64Array?Float32Array:r.value.constructor,U=O?r.value:new k(r.getBuffer().readSyncWebGL(y,i*k.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!O){const K=s;s=(he,Y)=>r.normalizeConstant(K(he,Y))}const J=O?(K,he)=>s(U,he):(K,he)=>s(U.subarray(K+y,K+y+d),he),G=e?new Float32Array(e.readSyncWebGL(x,n*4).buffer):new Float32Array(0),H=new Float32Array(i);return aq({source:G,target:H,sourceStartIndices:o,targetStartIndices:E,size:d,getData:J}),(!e||e.byteLength<H.byteLength+x)&&(e?.destroy(),e=t.createBuffer({byteLength:H.byteLength+x,usage:35050})),e.write(H,x),e}class kL{constructor({device:e,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new U_(n),this.attribute=r,this.attributeInTransition=cq(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=lq(this.attribute,r),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class uq extends kL{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="interpolation",this.transform=Aq(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:s}=this;OL(o),o[0]=NL({device:this.device,buffer:o[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),o[1]=LL({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:u}=this,d=u.model;let y=Math.floor(this.currentLength/s.size);UL(s)&&(y/=2),d.setVertexCount(y),s.isConstant?(d.setAttributes({aFrom:o[0]}),d.setConstantAttributes({aTo:s.value})):d.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let i=n/e;r&&(i=r(i));const{model:o}=this.transform,s={time:i};o.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const fq=`uniform interpolationUniforms {
  float time;
} interpolation;
`,jS={name:"interpolation",vs:fq,uniformTypes:{time:"f32"}},hq=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,dq=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function UL(t){return t.doublePrecision&&t.value instanceof Float64Array}function Aq(t,e){const r=e.size,n=FL(r),i=DL(r),o=e.getBufferLayout();return UL(e)?new Vf(t,{vs:dq,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[QH,jS],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Vf(t,{vs:hq,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[jS],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class pq extends kL{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="spring",this.texture=bq(e),this.framebuffer=xq(e,this.texture),this.transform=vq(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;super.start(e,r);const{buffers:o,attribute:s}=this;for(let d=0;d<2;d++)o[d]=NL({device:this.device,buffer:o[d],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});o[2]=LL({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?u.setConstantAttributes({aTo:s.value}):u.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:n,transition:i}=this,o=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});const s={stiffness:o.stiffness,damping:o.damping};r.model.shaderInputs.setProps({spring:s}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),OL(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const gq=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,mq={name:"spring",vs:gq,uniformTypes:{damping:"f32",stiffness:"f32"}},_q=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,yq=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function vq(t,e){const r=FL(e.size),n=DL(e.size);return new Vf(t,{vs:_q,fs:yq,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[mq],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function bq(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function xq(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const wq={interpolation:uq,spring:pq};class Cq{constructor(e,{id:r,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:n}){this.numInstances=n||1;for(const i in e){const o=e[i],s=o.getTransitionSetting(r);s&&this._updateAttribute(i,o,s)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(e[r]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,n){const i=this.transitions[e];let o=!i||i.type!==n.type;if(o){i&&this._removeTransition(e);const s=wq[n.type];s?this.transitions[e]=new s({attribute:r,timeline:this.timeline,device:this.device}):(Wr.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const $S="attributeManager.invalidate",Tq="attributeManager.updateStart",Eq="attributeManager.updateEnd",Bq="attribute.updateStart",Sq="attribute.allocate",Iq="attribute.updateEnd";class z_{constructor(e,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=hg(vW),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Cq(e,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const n=this._invalidateTrigger(e,r);to($S,this,e,n)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);to($S,this,"all")}update({data:e,numInstances:r,startIndices:n=null,transitions:i,props:o={},buffers:s={},context:u={}}){let d=!1;to(Tq,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const y in this.attributes){const x=this.attributes[y],E=x.settings.accessor;x.startIndices=n,x.numInstances=r,o[y]&&Wr.removed(`props.${y}`,`data.attributes.${y}`)(),x.setExternalBuffer(s[y])||x.setBinaryValue(typeof E=="string"?s[E]:void 0,e.startIndices)||typeof E=="string"&&!s[E]&&x.setConstantValue(o[E])||x.needsUpdate()&&(d=!0,this._updateAttribute({attribute:x,numInstances:r,data:e,props:o,context:u})),this.needsRedraw=this.needsRedraw||x.needsRedraw()}d&&to(Eq,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const o in r){const s=r[o];s.needsRedraw(e)&&!n.hasAttribute(o)&&(i[o]=s)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const n in e){const i=e[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new RL(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:n,updateTriggers:i}=this,o=i[e];return o&&o.forEach(s=>{const u=n[s];u&&u.setNeedsUpdate(u.id,r)}),o}_updateAttribute(e){const{attribute:r,numInstances:n}=e;if(to(Bq,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&to(Sq,r,n),r.updateBuffer(e)&&(this.needsRedraw=!0,to(Iq,r,n))}}class Mq extends U_{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:n,duration:i,easing:o}}=this,s=o(e/i);this._value=sc(r,n,s)}}const WS=1e-5;function JS(t,e,r,n,i){const o=e-t,u=(r-e)*i,d=-o*n;return u+d+o+e}function Pq(t,e,r,n,i){if(Array.isArray(r)){const o=[];for(let s=0;s<r.length;s++)o[s]=JS(t[s],e[s],r[s],n,i);return o}return JS(t,e,r,n,i)}function XS(t,e){if(Array.isArray(t)){let r=0;for(let n=0;n<t.length;n++){const i=t[n]-e[n];r+=i*i}return Math.sqrt(r)}return Math.abs(t-e)}class Rq extends U_{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:s=e}=this;let u=Pq(o,s,r,n,i);const d=XS(u,r),y=XS(u,s);d<WS&&y<WS&&(u=r,this.end()),this._prevValue=s,this._currValue=u}}const Fq={interpolation:Mq,spring:Rq};class Dq{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,n,i){const{transitions:o}=this;if(o.has(e)){const d=o.get(e),{value:y=d.settings.fromValue}=d;r=y,this.remove(e)}if(i=PL(i),!i)return;const s=Fq[i.type];if(!s){Wr.error(`unsupported transition type '${i.type}'`)();return}const u=new s(this.timeline);u.start({...i,fromValue:r,toValue:n}),o.set(e,u)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,n]of this.transitions)n.update(),e[r]=n.value,n.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Oq(t){const e=t[Eu];for(const r in e){const n=e[r],{validate:i}=n;if(i&&!i(t[r],n))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function Lq(t,e){const r=Zx({newProps:t,oldProps:e,propTypes:t[Eu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=kq(t,e);let i=!1;return n||(i=Uq(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:zq(t,e),transitionsChanged:Nq(t,e)}}function Nq(t,e){if(!t.transitions)return!1;const r={},n=t[Eu];let i=!1;for(const o in t.transitions){const s=n[o],u=s&&s.type;(u==="number"||u==="color"||u==="array")&&i2(t[o],e[o],s)&&(r[o]=!0,i=!0)}return i?r:!1}function Zx({newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${i}.${o} added`;const s=i2(t[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}for(const o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(t,o)){const s=i2(t[o],e[o],n[o]);if(s)return`${i}.${o} ${s}`}}return!1}function i2(t,e,r){let n=r&&r.equal;return n&&!n(t,e,r)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function kq(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:i}=t;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&i&&(r=i(t.data,e.data)||r),r}function Uq(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&KS(t,e,"all"))return{all:!0};const r={};let n=!1;for(const i in t.updateTriggers)i!=="all"&&KS(t,e,i)&&(r[i]=!0,n=!0);return n?r:!1}function zq(t,e){if(e===null)return!0;const r=e.extensions,{extensions:n}=t;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function KS(t,e,r){let n=t.updateTriggers[r];n=n??{};let i=e.updateTriggers[r];return i=i??{},Zx({oldProps:i,newProps:n,triggerName:r})}const Gq="count(): argument not an object",Vq="count(): argument not a container";function Hq(t){if(!$q(t))throw new Error(Gq);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(jq(t))return Object.keys(t).length;throw new Error(Vq)}function jq(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function $q(t){return t!==null&&typeof t=="object"}function qS(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const n={...t.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];r.inject=n}return r}const Wq={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},s2={};function Jq(t,e,r,n){if(r instanceof Yn)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const o=e.createTexture({...r,sampler:{...Wq,...i,...n},mipmaps:!0});return s2[o.id]=t,o}function Xq(t,e){!e||!(e instanceof Yn)||s2[e.id]===t&&(e.delete(),delete s2[e.id])}const Kq={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||o2(t)&&(t.length===3||t.length===4)},equal(t,e,r){return Ji(t,e,1)}},accessor:{validate(t,e){const r=Zm(t);return r==="function"||r===Zm(e.value)},equal(t,e,r){return typeof e=="function"?!0:Ji(t,e,1)}},array:{validate(t,e){return e.optional&&!t||o2(t)},equal(t,e,r){const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?Ji(t,e,i):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?Ji(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:n}=r.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const n=r.context;return!n||!n.device?null:Jq(r.id,n.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{Xq(r.id,t)}}};function qq(t){const e={},r={},n={};for(const[i,o]of Object.entries(t)){const s=o?.deprecatedFor;if(s)n[i]=Array.isArray(s)?s:[s];else{const u=Yq(i,o);e[i]=u,r[i]=u.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}function Yq(t,e){switch(Zm(e)){case"object":return hp(t,e);case"array":return hp(t,{type:"array",value:e,compare:!1});case"boolean":return hp(t,{type:"boolean",value:e});case"number":return hp(t,{type:"number",value:e});case"function":return hp(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function hp(t,e){return"type"in e?{name:t,...Kq[e.type],...e}:"value"in e?{name:t,type:Zm(e.value),...e}:{name:t,type:"object",value:e}}function o2(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Zm(t){return o2(t)?"array":t===null?"null":typeof t}function Zq(t,e){let r;for(let o=e.length-1;o>=0;o--){const s=e[o];"extensions"in s&&(r=s.extensions)}const n=a2(t.constructor,r),i=Object.create(n);i[qm]=t,i[Hf]={},i[xu]={};for(let o=0;o<e.length;++o){const s=e[o];for(const u in s)i[u]=s[u]}return Object.freeze(i),i}const Qq="_mergedDefaultProps";function a2(t,e){if(!(t instanceof G_.constructor))return{};let r=Qq;if(e)for(const i of e){const o=i.constructor;o&&(r+=`:${o.extensionName||o.name}`)}const n=zL(t,r);return n||(t[r]=eY(t,e||[]))}function eY(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),i=a2(n),o=zL(t,"defaultProps")||{},s=qq(o),u=Object.assign(Object.create(null),i,s.defaultProps),d=Object.assign(Object.create(null),i?.[Eu],s.propTypes),y=Object.assign(Object.create(null),i?.[Dv],s.deprecatedProps);for(const x of e){const E=a2(x.constructor);E&&(Object.assign(u,E),Object.assign(d,E[Eu]),Object.assign(y,E[Dv]))}return tY(u,t),nY(u,d),rY(u,y),u[Eu]=d,u[Dv]=y,e.length===0&&!Qx(t,"_propTypes")&&(t._propTypes=d),u}function tY(t,e){const r=sY(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function rY(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(n){const i=`${this.id}: ${r}`;for(const o of e[r])Qx(this,o)||(this[o]=n);Wr.deprecated(i,e[r].join("/"))()}})}function nY(t,e){const r={},n={};for(const i in e){const o=e[i],{name:s,value:u}=o;o.async&&(r[s]=u,n[s]=iY(s))}t[Zd]=r,t[Hf]={},Object.defineProperties(t,n)}function iY(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||IL(e)?this[Hf][t]=e:this[xu][t]=e},get(){if(this[xu]){if(t in this[xu])return this[xu][t]||this[Zd][t];if(t in this[Hf]){const e=this[qm]&&this[qm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Zd][t]}}return this[Zd][t]}}}function Qx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zL(t,e){return Qx(t,e)&&t[e]}function sY(t){const e=t.componentName;return e||Wr.warn(`${t.name}.componentName not specified`)(),e||t.name}let oY=0;class G_{constructor(...e){this.props=Zq(this,e),this.id=this.props.id,this.count=oY++}clone(e){const{props:r}=this,n={};for(const i in r[Zd])i in r[xu]?n[i]=r[xu][i]:i in r[Hf]&&(n[i]=r[Hf][i]);return new this.constructor({...r,...n,...e})}}G_.componentName="Component";G_.defaultProps={};const aY=Object.freeze({});class cY{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||aY}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[qm]||this.component;const r=e[xu]||{},n=e[Hf]||e,i=e[Zd]||{};for(const o in r){const s=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s),r[o]=this.getAsyncProp(o)}for(const o in n){const s=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,s)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(IL(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const n=this.asyncProps[e];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,r,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let o=[],s=0;for await(const u of r){if(!this.component)return;const{dataTransform:d}=this.component.props;d?o=d(u,o):o=o.concat(u),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,r){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Eu];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class lY extends cY{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const n=this.layer,i=n?.props.fetch;return i?i(r,{propName:e,layer:n}):super._fetch(e,r)}_onResolve(e,r){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(r,{propName:e,layer:n})}}_onError(e,r){const n=this.layer;n&&n.raiseError(r,`loading ${e} of ${this.layer}`)}}const uY="layer.changeFlag",fY="layer.initialize",hY="layer.update",dY="layer.finalize",AY="layer.matched",YS=2**24-1,pY=Object.freeze([]),gY=hg(({oldViewport:t,viewport:e})=>t.equals(e));let $a=new Uint8ClampedArray(0);const mY={data:{type:"data",value:pY,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:n,loadOptions:i,signal:o})=>{const{resourceManager:s}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,o&&(i={...i,fetch:{...i?.fetch,signal:o}});let u=s.contains(t);return!u&&!i&&(s.add({resourceId:t,data:S1(t,n),persistent:!1}),u=!0),u?s.subscribe({resourceId:t,onChange:d=>r.internalState?.reloadAsyncProp(e,d),consumerId:r.id,requestId:e}):S1(t,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Xr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class ps extends G_{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Id.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Us(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=tL(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,s]=qO(n,r.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,s]}unproject(e){return Us(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){Us(this.internalState);const n=this.internalState.viewport||this.context.viewport;return EW(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Xr.DEFAULT||e===Xr.LNGLAT||e===Xr.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){Us(e instanceof Uint8Array);const[r,n,i]=e;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Hq(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=qS(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=qS(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&r)if(Array.isArray(n))for(const i of n)r.invalidateAll(i);else r.invalidateAll();if(r){const{props:i}=e,o=this.internalState.hasPickingBuffer,s=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(o!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:u,instancePickingColors:d}=r.attributes,y=u||d;y&&(s&&y.constant&&(y.constant=!1,r.invalidate(y.id)),!y.value&&!s&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!gY({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const n in e)e[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),n=Object.create(this.props);for(const i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const n=Math.floor($a.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>YS&&Wr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$a=lA.allocate($a,r,{size:4,copy:!0,maxCount:Math.max(r,YS)});const i=Math.floor($a.length/4),o=[0,0,0];for(let s=n;s<i;s++)this.encodePickingColor(s,o),$a[s*4+0]=o[0],$a[s*4+1]=o[1],$a[s*4+2]=o[2],$a[s*4+3]=0}e.value=$a.subarray(0,r*4)}_setModelAttributes(e,r,n=!1){if(!Object.keys(r).length)return;if(n){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),r=u.getAttributes()}const i=e.userData?.excludeAttributes||{},o={},s={};for(const u in r){if(i[u])continue;const d=r[u].getValue();for(const y in d){const x=d[y];x instanceof Li?r[u].settings.isIndexed?e.setIndexBuffer(x):o[y]=x:x&&(s[y]=x)}}e.setAttributes(o),e.setConstantAttributes(s)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,s=o&&r.attributes&&r.attributes[o.id];if(s&&s.value){const u=s.value,d=this.encodePickingColor(e);for(let y=0;y<r.length;y++){const x=o.getVertexOffset(y);u[x]===d[0]&&u[x+1]===d[1]&&u[x+2]===d[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;const o=i.getVertexOffset(e),s=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==$a.buffer&&(n.value=$a.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Us(!this.internalState),Us(Number.isFinite(this.props.coordinateSystem)),to(fY,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new lY({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Wr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Dq(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){to(AY,this,this===e);const{state:r,internalState:n}=e;this!==e&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(to(hY,this,e),!e)return;const r=this.props,n=this.context,i=this.internalState,o=n.viewport,s=this._updateUniformTransition();i.propsInTransition=s,n.viewport=i.viewport||o,this.props=s;try{const u=this._getUpdateParams(),d=this.getModels();if(n.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const x of this.props.extensions)x.updateState.call(this,u,x);this.setNeedsRedraw(),this._updateAttributes();const y=this.getModels()[0]!==d[0];this._postUpdate(u,y)}finally{n.viewport=o,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){to(dY,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,s=this.context;this.props=this.internalState.propsInTransition||o;try{r&&this.setShaderModuleProps(r);const{getPolygonOffset:u}=this.props,d=u&&u(n)||[0,0];s.device instanceof zd&&s.device.setParametersWebGL({polygonOffset:d});for(const y of this.getModels())y.device.type==="webgpu"?y.setParameters({...y.parameters,...i}):y.setParameters(i);if(s.device instanceof zd)s.device.withParametersWebGL(i,()=>{const y={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(const x of this.props.extensions)x.draw.call(this,y,x);this.draw(y)});else{const y={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:s};for(const x of this.props.extensions)x.draw.call(this,y,x);this.draw(y)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const s=e[i],u=r[i];s&&Array.isArray(u)&&(r.dataChanged=Array.isArray(s)?u.concat(s):s,o=!0);default:r[i]||(r[i]=e[i],o=!0)}o&&to(uY,this,i,e)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){const n=Lq(e,r);if(n.updateTriggersChanged)for(const i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,r[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){Oq(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(r.highlightColor=n(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new z_(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:n,oldProps:i}=e,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:u,highlightColor:d}=n;if(r||i.autoHighlight!==s||i.highlightedObjectIndex!==u||i.highlightColor!==d){const y={};Array.isArray(d)&&(y.highlightColor=d),(r||i.autoHighlight!==s||u!==i.highlightedObjectIndex)&&(y.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:y})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(r=r||i,r)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ps.defaultProps=mY;ps.layerName="Layer";const _Y="compositeLayer.renderLayers";class gs extends ps{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||r}getSubLayerRow(e,r,n){return e.__source={parent:this,object:r,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(r.index=n.__source.index,e(n.__source.object,r)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:u,autoHighlight:d,highlightColor:y,coordinateSystem:x,coordinateOrigin:E,wrapLongitude:S,positionFormat:O,modelMatrix:k,extensions:U,fetch:J,operation:G,_subLayerProps:H}=this.props,K={id:"",updateTriggers:{},opacity:r,pickable:n,visible:i,parameters:o,getPolygonOffset:s,highlightedObjectIndex:u,autoHighlight:d,highlightColor:y,coordinateSystem:x,coordinateOrigin:E,wrapLongitude:S,positionFormat:O,modelMatrix:k,extensions:U,fetch:J,operation:G},he=H&&e.id&&H[e.id],Y=he&&he.updateTriggers,oe=e.id||"sublayer";if(he){const Ee=this.props[Eu],ze=e.type?e.type._propTypes:{};for(const de in he){const ve=ze[de]||Ee[de];ve&&ve.type==="accessor"&&(he[de]=this.getSubLayerAccessor(he[de]))}}Object.assign(K,e,he),K.id=`${this.props.id}-${oe}`,K.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...Y};for(const Ee of U){const ze=Ee.getSubLayerProps.call(this,Ee);ze&&Object.assign(K,ze,{updateTriggers:Object.assign(K.updateTriggers,ze.updateTriggers)})}return K}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const o=this.renderLayers();n=k_(o,Boolean),this.internalState.subLayers=n}to(_Y,this,i,n);for(const o of n)o.parent=this}}gs.layerName="CompositeLayer";const B0=Math.PI/180,ZS=180/Math.PI,gm=6370972,Gd=256;function yY(){const t=Gd/gm,e=Math.PI/180*Gd;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class vY extends Ol{constructor(e={}){const{longitude:r=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:o=1,resolution:s=10}=e;let{latitude:u=0,height:d,altitude:y=1.5,fovy:x}=e;u=Math.max(Math.min(u,Od),-Od),d=d||1,x?y=Vx(x):x=Yp(y);const E=1/Math.PI/Math.cos(u*Math.PI/180),S=Math.pow(2,n)*E,O=e.nearZ??i,k=e.farZ??(y+Gd*2*S/d)*o,U=new An().lookAt({eye:[0,-y,0],up:[0,0,1]});U.rotateX(u*B0),U.rotateZ(-r*B0),U.scale(S/d),super({...e,height:d,viewMatrix:U,longitude:r,latitude:u,zoom:n,distanceScales:yY(),fovy:x,focalDistance:y,near:O,far:k}),this.scale=S,this.latitude=u,this.longitude=r,this.resolution=s}get projectionMode(){return Zo.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,this.height/2],r),i=this.unproject([this.width/2,0],r),o=this.unproject([this.width,this.height/2],r),s=this.unproject([this.width/2,this.height],r);return o[0]<this.longitude&&(o[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],o[0],i[0],s[0]),Math.min(n[1],o[1],i[1],s[1]),Math.max(n[0],o[0],i[0],s[0]),Math.max(n[1],o[1],i[1],s[1])]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,o,s]=e,u=r?o:this.height-o,{pixelUnprojectionMatrix:d}=this;let y;if(Number.isFinite(s))y=zv(d,[i,u,s,1]);else{const O=zv(d,[i,u,-1,1]),k=zv(d,[i,u,1,1]),U=((n||0)/gm+1)*Gd,J=bv(CO([],O,k)),G=bv(O),H=bv(k),he=4*((4*G*H-(J-G-H)**2)/16)/J,Y=Math.sqrt(G-he),oe=Math.sqrt(Math.max(0,U*U-he)),Ee=(Y-oe)/Math.sqrt(J);y=GV([],O,k,Ee)}const[x,E,S]=this.unprojectPosition(y);return Number.isFinite(s)?[x,E,S]:Number.isFinite(n)?[x,E,n]:[x,E]}projectPosition(e){const[r,n,i=0]=e,o=r*B0,s=n*B0,u=Math.cos(s),d=(i/gm+1)*Gd;return[Math.sin(o)*u*d,-Math.cos(o)*u*d,Math.sin(s)*d]}unprojectPosition(e){const[r,n,i]=e,o=TO(e),s=Math.asin(i/o),d=Math.atan2(r,-n)*ZS,y=s*ZS,x=(o/Gd-1)*gm;return[d,y,x]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){const n=this.unproject(r);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function zv(t,e){const r=xA([],e,t);return kx(r,r,1/r[3]),r}class V_{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ji(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:r}=e.constructor,n={updateTriggers:{}};for(const i in r)if(i in this.props){const o=r[i],s=this.props[i];n[i]=s,o&&o.type==="accessor"&&(n.updateTriggers[i]=this.props.updateTriggers[i],typeof s=="function"&&(n[i]=this.getSubLayerAccessor(s)))}return n}initializeState(e,r){}updateState(e,r){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,r){}finalizeState(e,r){}}V_.defaultProps={};V_.extensionName="LayerExtension";class VL{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:r={}}=e;this.typedArrayManager=lA,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:r,buffers:n={},getGeometry:i,geometryBuffer:o,positionFormat:s,dataChanged:u,normalize:d=!0}=this.opts;if(this.data=r,this.getGeometry=i,this.positionSize=o&&o.size||(s==="XY"?2:3),this.buffers=n,this.normalize=d,o&&(Us(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),d||(n.vertexPositions=o)),this.geometryBuffer=n.vertexPositions,Array.isArray(u))for(const y of u)this._rebuildGeometry(y);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){const r=e.value||e;return ArrayBuffer.isView(r)?ML(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){const{attributes:n,buffers:i,_attributeDefs:o,typedArrayManager:s}=this;for(const u in o)if(u in i)s.release(n[u]),n[u]=null;else{const d=o[u];d.copy=r,n[u]=s.allocate(n[u],e,d)}}_forEachGeometry(e,r,n){const{data:i,getGeometry:o}=this,{iterable:s,objectInfo:u}=qc(i,r,n);for(const d of s){u.index++;const y=o?o(d,u):null;e(y,u.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:n,instanceCount:i}=this;const{data:o,geometryBuffer:s}=this,{startRow:u=0,endRow:d=1/0}=e||{},y={};if(e||(r=[0],n=[0]),this.normalize||!s)this._forEachGeometry((E,S)=>{const O=E&&this.normalizeGeometry(E);y[S]=O,n[S+1]=n[S]+(O?this.getGeometrySize(O):0)},u,d),i=n[n.length-1];else if(n=o.startIndices,i=n[o.length]||0,ArrayBuffer.isView(s))i=i||s.length/this.positionSize;else if(s instanceof Li){const E=this.positionSize*4;i=i||s.byteLength/E}else if(s.buffer){const E=s.stride||this.positionSize*4;i=i||s.buffer.byteLength/E}else if(s.value){const E=s.value,S=s.stride/E.BYTES_PER_ELEMENT||this.positionSize;i=i||E.length/S}this._allocate(i,!!e),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=i;const x={};this._forEachGeometry((E,S)=>{const O=y[S]||E;x.vertexStart=n[S],x.indexStart=r[S];const k=S<n.length-1?n[S+1]:i;x.geometrySize=k-n[S],x.geometryIndex=S,this.updateGeometryAttributes(O,x)},u,d),this.vertexCount=r[r.length-1]}}const bY=typeof window<"u"?Et.useLayoutEffect:Et.useEffect;function Qm(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const xY={position:"absolute",zIndex:-1};function HL(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(r=>HL(r,e));if(H_(t)){if(wY(t))return e.style=xY,Et.cloneElement(t,e);if(CY(t))return Et.cloneElement(t,e)}return t}function H_(t){return t&&typeof t=="object"&&"type"in t||!1}function wY(t){return t.props?.mapStyle}function CY(t){const e=t.type;return e&&e.deckGLViewProps}function c2(t){if(typeof t=="function")return Et.createElement(uA,{},t);if(Array.isArray(t))return t.map(c2);if(H_(t)){if(t.type===Et.Fragment)return c2(t.props.children);if(Qm(t.type,uA))return t}return t}function TY({children:t,layers:e=[],views:r=null}){const n=[],i=[],o={};return Et.Children.forEach(c2(t),s=>{if(H_(s)){const u=s.type;if(Qm(u,ps)){const d=EY(u,s.props);i.push(d)}else n.push(s);if(Qm(u,uA)&&u!==uA&&s.props.id){const d=new u(s.props);o[d.id]=d}}else s&&n.push(s)}),Object.keys(o).length>0&&(Array.isArray(r)?r.forEach(s=>{o[s.id]=s}):r&&(o[r.id]=r),r=Object.values(o)),e=i.length>0?[...i,...e]:e,{layers:e,children:n,views:r}}function EY(t,e){const r={},n=t.defaultProps||{};for(const i in e)n[i]!==e[i]&&(r[i]=e[i]);return new t(r)}const BY=Et.createContext();function SY({children:t,deck:e,ContextProvider:r=BY.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const i={},o=n.views[0].id;for(const s of t){let u=o,d=s;H_(s)&&Qm(s.type,uA)&&(u=s.props.id||o,d=s.props.children);const y=n.getViewport(u),x=n.getViewState(u);if(y){x.padding=y.padding;const{x:E,y:S,width:O,height:k}=y;d=HL(d,{x:E,y:S,width:O,height:k,viewport:y,viewState:x}),i[u]||(i[u]={viewport:y,children:[]}),i[u].children.push(d)}}return Object.keys(i).map(s=>{const{viewport:u,children:d}=i[s],{x:y,y:x,width:E,height:S}=u,O={position:"absolute",left:y,top:x,width:E,height:S},k=`view-${s}`,U=Et.createElement("div",{key:k,id:k,style:O},...d),J={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:H=>{H.viewId=s,e._onViewStateChange(H)},widgets:[]},G=`view-${s}-context`;return Et.createElement(r,{key:G,value:J},U)})}const IY={mixBlendMode:null};function MY({width:t,height:e,style:r}){const n={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(r)for(const o in r)o in IY?i[o]=r[o]:n[o]=r[o];return{containerStyle:n,canvasStyle:i}}function PY(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function jL(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function RY(t,e,r){const n=new e({...r,_customRender:r.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:i=>{t.redrawReason=i;const o=n.getViewports();t.lastRenderedViewports!==o?t.forceUpdate():jL(t)}});return n}function FY(t,e){const[r,n]=Et.useState(0),o=Et.useRef({control:null,version:r,forceUpdate:()=>n(Y=>Y+1)}).current,s=Et.useRef(null),u=Et.useRef(null),d=Et.useMemo(()=>TY(t),[t.layers,t.views,t.children]);let y=!0;const x=Y=>y&&t.viewState?(o.viewStateUpdateRequested=Y,null):(o.viewStateUpdateRequested=null,t.onViewStateChange?.(Y)),E=Y=>{y?o.interactionStateUpdateRequested=Y:(o.interactionStateUpdateRequested=null,t.onInteractionStateChange?.(Y))},S=Et.useMemo(()=>{const Y={widgets:[],...t,style:null,width:"100%",height:"100%",parent:s.current,canvas:u.current,layers:d.layers,views:d.views,onViewStateChange:x,onInteractionStateChange:E};return delete Y._customRender,o.deck&&o.deck.setProps(Y),Y},[t]);Et.useEffect(()=>{const Y=t.Deck||Yx;return o.deck=RY(o,Y,{...S,parent:s.current,canvas:u.current}),()=>o.deck?.finalize()},[]),bY(()=>{jL(o);const{viewStateUpdateRequested:Y,interactionStateUpdateRequested:oe}=o;Y&&x(Y),oe&&E(oe)}),Et.useImperativeHandle(e,()=>PY(o),[]);const O=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:k,width:U="100%",height:J="100%",id:G,style:H}=t,{containerStyle:K,canvasStyle:he}=Et.useMemo(()=>MY({width:U,height:J,style:H}),[U,J,H]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===O||o.version!==r){o.lastRenderedViewports=O,o.version=r;const Y=SY({children:d.children,deck:o.deck,ContextProvider:k}),oe=Et.createElement("canvas",{key:"canvas",id:G||"deckgl-overlay",ref:u,style:he});o.control=Et.createElement("div",{id:`${G||"deckgl"}-wrapper`,ref:s,style:K},[oe,Y])}return y=!1,o.control}const DY=Et.forwardRef(FY);function QS(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const $L=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),eI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);eI&&parseFloat(eI[1]);const tI=globalThis,rI=globalThis.process||{};function OY(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function ew(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||OY()}const WL="4.0.7";function LY(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class NY{constructor(e,r,n="sessionStorage"){this.storage=LY(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function kY(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function UY(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var e_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(e_||(e_={}));const zY=10;function nI(t){return typeof t!="string"?t:(t=t.toUpperCase(),e_[t]||e_.WHITE)}function GY(t,e,r){return!ew&&typeof t=="string"&&(e&&(t=`\x1B[${nI(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${nI(r)+zY}m${t}\x1B[49m`)),t}function VY(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const s=i[o];typeof s=="function"&&(e.find(u=>o===u)||(i[o]=s.bind(t)))}}function tw(t,e){if(!t)throw new Error("Assertion failed")}function od(){let t;if(ew()&&tI.performance)t=tI?.performance?.now?.();else if("hrtime"in rI){const e=rI?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const ad={debug:ew()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},HY={enabled:!0,level:0};function cd(){}const iI={},sI={once:!0};class j_{constructor({id:e}={id:""}){this.VERSION=WL,this._startTs=od(),this._deltaTs=od(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new NY(`__probe-${this.id}__`,HY),this.timeStamp(`${this.id} started`),VY(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((od()-this._startTs).toPrecision(10))}getDelta(){return Number((od()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ad.warn,arguments,sI)}error(e){return this._getLogFunction(0,e,ad.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,ad.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,ad.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,ad.debug||ad.info,arguments,sI)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||cd,n&&[n],{tag:$Y(r)}):cd}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||cd)}group(e,r,n={collapsed:!1}){const i=oI({logLevel:e,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||cd)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=JL(e)}_getLogFunction(e,r,n,i,o){if(this._shouldLog(e)){o=oI({logLevel:e,message:r,args:i,opts:o}),n=n||o.method,tw(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=od();const s=o.tag||o.message;if(o.once&&s)if(!iI[s])iI[s]=od();else return cd;return r=jY(this.id,o.message,o),n.bind(console,r,...o.args)}return cd}}j_.VERSION=WL;function JL(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return tw(Number.isFinite(e)&&e>=0),e}function oI(t){const{logLevel:e,message:r}=t;t.logLevel=JL(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return tw(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function jY(t,e,r){if(typeof e=="string"){const n=r.time?UY(kY(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=GY(e,r.color,r.background)}return e}function $Y(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}globalThis.probe={};const XL=new j_({id:"@probe.gl/log"}),Gv="4.3.3",WY=Gv[0]>="0"&&Gv[0]<="9"?`v${Gv}`:"";function JY(){const t=new j_({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=WY,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const XY=JY();function KY(t,e){return KL(t||{},e)}function KL(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=KL(n[i]||{},e[i],r+1):n[i]=e[i];return n}const qY="latest";function YY(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const ZY=YY();function Mu(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Uf=typeof process!="object"||String(process)!=="[object process]"||process.browser,QY=typeof window<"u"&&typeof window.orientation<"u",aI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);aI&&parseFloat(aI[1]);class eZ{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Mu(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Mu(this.isRunning),this.isRunning=!1,this._reject(e)}}class Vv{terminate(){}}const Hv=new Map;function tZ(t){Mu(t.source&&!t.url||!t.source&&t.url);let e=Hv.get(t.source||t.url);return e||(t.url&&(e=rZ(t.url),Hv.set(t.url,e)),t.source&&(e=qL(t.source),Hv.set(t.source,e))),Mu(e),e}function rZ(t){if(!t.startsWith("http"))return t;const e=nZ(t);return qL(e)}function qL(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function nZ(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function YL(t,e=!0,r){const n=r||new Set;if(t){if(cI(t))n.add(t);else if(cI(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)YL(t[i],e,n)}}return r===void 0?Array.from(n):[]}function cI(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const jv=()=>{};class l2{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Uf||typeof Vv<"u"&&!Uf}constructor(e){const{name:r,source:n,url:i}=e;Mu(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=jv,this.onError=o=>console.log(o),this.worker=Uf?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=jv,this.onError=jv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||YL(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=tZ({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Vv(n,{eval:!1})}else if(this.source)e=new Vv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class iZ{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return l2.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(i,o,s)=>i.done(s),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new eZ(r.name,e);e.onMessage=i=>r.onMessage(n,i.type,i.payload),e.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Uf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new l2({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return QY?this.maxMobileConcurrency:this.maxConcurrency}}const sZ={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class bu{props;workerPools=new Map;static _workerFarm;static isSupported(){return l2.isSupported()}static getWorkerFarm(e={}){return bu._workerFarm=bu._workerFarm||new bu({}),bu._workerFarm.setProps(e),bu._workerFarm}constructor(e){this.props={...sZ},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let o=this.workerPools.get(r);return o||(o=new iZ({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function oZ(t,e={}){const r=e[t.id]||{},n=Uf?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Uf?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let o=t.version;o==="latest"&&(o=qY);const s=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${s}/dist/${n}`}return Mu(i),i}function aZ(t,e=ZY){Mu(t,"no worker provided");const r=t.version;return!(!e||!r)}function cZ(t,e){return!bu.isSupported()||!Uf&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function lZ(t,e,r,n,i){const o=t.id,s=oZ(t,r),d=bu.getWorkerFarm(r).getWorkerPool({name:o,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const y=await d.startJob("process-on-worker",uZ.bind(null,i));return y.postMessage("process",{input:e,options:r,context:n}),await(await y.result).result}async function uZ(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:s}=n;try{const u=await t(o,s);e.postMessage("done",{id:i,result:u})}catch(u){const d=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:i,error:d})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function fZ(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function hZ(...t){return dZ(t)}function dZ(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function AZ(t){const e=[];for await(const r of t)e.push(r);return hZ(...e)}function lI(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class uI{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=lI(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(lI()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ZL{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof uI?i=e:i=new uI(r,n),this.stats[r]=i),i}}let pZ="";const fI={};function gZ(t){for(const e in fI)if(t.startsWith(e)){const r=fI[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${pZ}${t}`),t}function mZ(t){return t&&typeof t=="object"&&t.isBuffer}function QL(t){if(mZ(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function e4(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function _Z(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const yZ=t=>typeof t=="boolean",Np=t=>typeof t=="function",dg=t=>t!==null&&typeof t=="object",hI=t=>dg(t)&&t.constructor==={}.constructor,vZ=t=>!!t&&typeof t[Symbol.iterator]=="function",bZ=t=>t&&typeof t[Symbol.asyncIterator]=="function",eh=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,th=t=>typeof Blob<"u"&&t instanceof Blob,xZ=t=>t&&typeof t=="object"&&t.isBuffer,wZ=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||dg(t)&&Np(t.tee)&&Np(t.cancel)&&Np(t.getReader),CZ=t=>dg(t)&&Np(t.read)&&Np(t.pipe)&&yZ(t.readable),t4=t=>wZ(t)||CZ(t);class TZ extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response}const EZ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,BZ=/^([-\w.]+\/[-\w.+]+)/;function dI(t,e){return t.toLowerCase()===e.toLowerCase()}function SZ(t){const e=BZ.exec(t);return e?e[1]:t}function AI(t){const e=EZ.exec(t);return e?e[1]:""}const r4=/\?.*/;function IZ(t){const e=t.match(r4);return e&&e[0]}function rw(t){return t.replace(r4,"")}function MZ(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function $_(t){return eh(t)?t.url:th(t)?t.name||"":typeof t=="string"?t:""}function nw(t){if(eh(t)){const e=t,r=e.headers.get("content-type")||"",n=rw(e.url);return SZ(r)||AI(n)}return th(t)?t.type||"":typeof t=="string"?AI(t):""}function PZ(t){return eh(t)?t.headers["content-length"]||-1:th(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function n4(t){if(eh(t))return t;const e={},r=PZ(t);r>=0&&(e["content-length"]=String(r));const n=$_(t),i=nw(t);i&&(e["content-type"]=i);const o=await DZ(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const s=new Response(t,{headers:e});return Object.defineProperty(s,"url",{value:n}),s}async function RZ(t){if(!t.ok)throw await FZ(t)}async function FZ(t){const e=MZ(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&i?.includes("application/json")?await t.json():await t.text()}catch{}return new TZ(r,n)}async function DZ(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=o=>n(o?.target?.result),i.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${OZ(r)}`}return null}function OZ(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function LZ(t){return!NZ(t)&&!kZ(t)}function NZ(t){return t.startsWith("http:")||t.startsWith("https:")}function kZ(t){return t.startsWith("data:")}async function pI(t,e){if(typeof t=="string"){const r=gZ(t);return LZ(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await n4(t)}const gI=new j_({id:"loaders.gl"});class UZ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class zZ{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const i4={fetch:null,mimeType:void 0,nothrow:!1,log:new zZ,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:$L,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},GZ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function s4(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function o4(){const t=s4();return t.globalOptions=t.globalOptions||{...i4},t.globalOptions}function VZ(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],HZ(t,r),$Z(e,t,n)}function HZ(t,e){mI(t,null,i4,GZ,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};mI(n,r.id,i,o,e)}}function mI(t,e,r,n,i){const o=e||"Top level",s=e?`${e}.`:"";for(const u in t){const d=!e&&dg(t[u]),y=u==="baseUri"&&!e,x=u==="workerUrl"&&e;if(!(u in r)&&!y&&!x){if(u in n)gI.warn(`${o} loader option '${s}${u}' no longer supported, use '${n[u]}'`)();else if(!d){const E=jZ(u,i);gI.warn(`${o} loader option '${s}${u}' not recognized. ${E}`)()}}}}function jZ(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(t===o)return`Did you mean '${i.id}.${o}'?`;const s=o.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function $Z(t,e,r){const i={...t.options||{}};return WZ(i,r),i.log===null&&(i.log=new UZ),_I(i,o4()),_I(i,e),i}function _I(t,e){for(const r in e)if(r in e){const n=e[r];hI(n)&&hI(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function WZ(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function iw(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function sw(t){QS(t,"null loader"),QS(iw(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const a4=()=>{const t=s4();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Ag(t){const e=a4();t=Array.isArray(t)?t:[t];for(const r of t){const n=sw(r);e.find(i=>n===i)||e.unshift(n)}}function JZ(){return a4()}const XZ=/\.([^.]+)$/;async function KZ(t,e=[],r,n){if(!c4(t))return null;let i=yI(t,e,{...r,nothrow:!0},n);if(i)return i;if(th(t)&&(t=await t.slice(0,10).arrayBuffer(),i=yI(t,e,r,n)),!i&&!r?.nothrow)throw new Error(l4(t));return i}function yI(t,e=[],r,n){if(!c4(t))return null;if(e&&!Array.isArray(e))return sw(e);let i=[];e&&(i=i.concat(e)),r?.ignoreRegisteredLoaders||i.push(...JZ()),YZ(i);const o=qZ(t,i,r,n);if(!o&&!r?.nothrow)throw new Error(l4(t));return o}function qZ(t,e,r,n){const i=$_(t),o=nw(t),s=rw(i)||n?.url;let u=null,d="";return r?.mimeType&&(u=$v(e,r?.mimeType),d=`match forced by supplied MIME type ${r?.mimeType}`),u=u||ZZ(e,s),d=d||(u?`matched url ${s}`:""),u=u||$v(e,o),d=d||(u?`matched MIME type ${o}`:""),u=u||eQ(e,t),d=d||(u?`matched initial data ${u4(t)}`:""),r?.fallbackMimeType&&(u=u||$v(e,r?.fallbackMimeType),d=d||(u?`matched fallback MIME type ${o}`:"")),d&&XY.log(1,`selectLoader selected ${u?.name}: ${d}.`),u}function c4(t){return!(t instanceof Response&&t.status===204)}function l4(t){const e=$_(t),r=nw(t);let n="No valid loader found (";n+=e?`${e4(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?u4(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function YZ(t){for(const e of t)sw(e)}function ZZ(t,e){const r=e&&XZ.exec(e),n=r&&r[1];return n?QZ(t,n):null}function QZ(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function $v(t,e){for(const r of t)if(r.mimeTypes?.some(n=>dI(e,n))||dI(e,`application/x.${r.id}`))return r;return null}function eQ(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(tQ(e,r))return r}else if(ArrayBuffer.isView(e)){if(vI(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&vI(e,0,r))return r;return null}function tQ(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function vI(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>rQ(t,e,r,i))}function rQ(t,e,r,n){if(n instanceof ArrayBuffer)return fZ(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=u2(t,e,n.length);return n===i;default:return!1}}function u4(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?u2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?u2(t,0,e):""}function u2(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const nQ=256*1024;function*iQ(t,e){const r=e?.chunkSize||nQ;let n=0;const i=new TextEncoder;for(;n<t.length;){const o=Math.min(t.length-n,r),s=t.slice(n,n+o);n+=o,yield i.encode(s)}}const sQ=256*1024;function*oQ(t,e={}){const{chunkSize:r=sQ}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),o=new ArrayBuffer(i),s=new Uint8Array(t,n,i);new Uint8Array(o).set(s),n+=i,yield o}}const aQ=1024*1024;async function*cQ(t,e){const r=e?.chunkSize||aQ;let n=0;for(;n<t.size;){const i=n+r,o=await t.slice(n,i).arrayBuffer();n=i,yield o}}function bI(t,e){return $L?lQ(t,e):uQ(t)}async function*lQ(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e?._streamReadAhead&&(n=r.read());const{done:o,value:s}=await i;if(o)return;yield QL(s)}}catch{r.releaseLock()}}async function*uQ(t,e){for await(const r of t)yield QL(r)}function fQ(t,e){if(typeof t=="string")return iQ(t,e);if(t instanceof ArrayBuffer)return oQ(t,e);if(th(t))return cQ(t,e);if(t4(t))return bI(t,e);if(eh(t))return bI(t.body,e);throw new Error("makeIterator")}const f4="Cannot convert supplied data type";function hQ(t,e,r){if(e.text&&typeof t=="string")return t;if(xZ(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(f4)}async function dQ(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return hQ(t,e);if(th(t)&&(t=await n4(t)),eh(t)){const i=t;return await RZ(i),e.binary?await i.arrayBuffer():await i.text()}if(t4(t)&&(t=fQ(t,r)),vZ(t)||bZ(t))return AZ(t);throw new Error(f4)}function h4(t,e){const r=o4(),n=t||r;return typeof n.fetch=="function"?n.fetch:dg(n.fetch)?i=>pI(i,n.fetch):e?.fetch?e?.fetch:pI}function AQ(t,e,r){if(r)return r;const n={fetch:h4(e,t),...t};if(n.url){const i=rw(n.url);n.baseUrl=i,n.queryString=IZ(n.url),n.filename=e4(i),n.baseUrl=_Z(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function pQ(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function t_(t,e,r,n){e&&!Array.isArray(e)&&!iw(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=$_(t),s=pQ(e,n),u=await KZ(t,s,r);return u?(r=VZ(r,u,s,i),n=AQ({url:i,_parse:t_,loaders:s},r,n||null),await gQ(u,t,r,n)):null}async function gQ(t,e,r,n){if(aZ(t),r=KY(t.options,r),eh(e)){const o=e,{ok:s,redirected:u,status:d,statusText:y,type:x,url:E}=o,S=Object.fromEntries(o.headers.entries());n.response={headers:S,ok:s,redirected:u,status:d,statusText:y,type:x,url:E}}e=await dQ(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(cZ(t,r))return await lZ(t,e,r,n,t_);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw Mu(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function CA(t,e,r,n){let i,o;!Array.isArray(e)&&!iw(e)?(i=[],o=e):(i=e,o=r);const s=h4(o);let u=t;return typeof t=="string"&&(u=await s(t)),th(t)&&(u=await s(t)),Array.isArray(i)?await t_(u,i,o):await t_(u,i,o)}const xI=100;class mQ{schema;options;shape;length=0;rows=null;cursor=0;_headers=[];constructor(e,r){if(this.options=r,this.schema=e,!Array.isArray(e)){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,r){Number.isFinite(r)&&(this.cursor=r),this.shape="array-row-table",this.rows=this.rows||new Array(xI),this.rows[this.length]=e,this.length++}addObjectRow(e,r){Number.isFinite(r)&&(this.cursor=r),this.shape="object-row-table",this.rows=this.rows||new Array(xI),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function d4(t,e){if(!t)throw new Error("null row");const r={};if(e)for(let n=0;n<e.length;n++)r[e[n]]=t[n];else for(let n=0;n<t.length;n++){const i=`column-${n}`;r[i]=t[n]}return r}function A4(t,e){if(!t)throw new Error("null row");if(e){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=t[e[n]];return r}return Object.values(t)}function _Q(t){const e=[];for(let r=0;r<t.length;r++){const n=`column-${r}`;e.push(n)}return e}function yQ(t){return Object.keys(t)}const wI=100;class vQ{schema;options;length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(e,r){if(this.options=r,this.schema=e,e){this._headers=[];for(const n in e)this._headers[e[n].index]=e[n].name}}rowCount(){return this.length}addArrayRow(e,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||=_Q(e),this.options.shape){case"object-row-table":const n=d4(e,this._headers);this.addObjectRow(n,r);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(wI),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||=yQ(e),this.options.shape){case"array-row-table":const n=A4(e,this._headers);this.addArrayRow(n,r);break;case"object-row-table":this.objectRows=this.objectRows||new Array(wI),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const bQ=100;class xQ{schema;length=0;allocated=0;columns={};constructor(e,r){this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let r=0;for(const n in this.columns)this.columns[n][this.length]=e[r++];this.length++}addObjectRow(e){this._reallocateColumns();for(const r in e)this.columns[r][this.length]=e[r];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const n in this.schema){const i=this.schema[n];e[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:bQ,this.columns={};for(const e in this.schema){const r=this.schema[e],n=r.type||Float32Array,i=this.columns[r.index];if(i&&ArrayBuffer.isView(i)){const o=new n(this.allocated);o.set(i),this.columns[r.index]=o}else i?(i.length=this.allocated,this.columns[r.index]=i):this.columns[r.index]=new n(this.allocated)}}}_pruneColumns(){for(const[e,r]of Object.entries(this.columns))this.columns[e]=r.slice(0,this.length)}}const wQ={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},CQ="TableBatchBuilder";class r_{schema;options;aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=Date.now();totalLength=0;totalBytes=0;rowBytes=0;static ArrowBatch;constructor(e,r){this.schema=e,this.options={...wQ,...r}}limitReached(){return!!(this.options?.limit&&this.totalLength>=this.options.limit||this.options?._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e?.bytesUsed&&(this.bytesUsed=e.bytesUsed);const r=this.aggregator.getBatch();return r.count=this.batchCount,r.bytesUsed=this.bytesUsed,Object.assign(r,e),this.batchCount++,this.aggregator=null,r}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return vQ;case"columnar-table":return xQ;case"arrow-table":if(!r_.ArrowBatch)throw new Error(CQ);return r_.ArrowBatch;default:return mQ}}}class CI extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class TQ{_values;_settlers;_closed;constructor(){this._values=new CI,this._settlers=new CI,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const r=this._settlers.dequeue();e instanceof Error?r.reject(e):r.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,r)=>{this._settlers.enqueue({resolve:e,reject:r})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const TI="\uFEFF";function EQ(t,e={},r=SQ){e=e||{};var n=e.dynamicTyping||!1;tc(n)&&(e.dynamicTypingFunction=n,n={}),e.dynamicTyping=n,e.transform=tc(e.transform)?e.transform:!1;var i=new r(e);return i.stream(t)}function BQ(t,e){var r=!1,n=!0,i=",",o=`\r
`,s='"',u=s+s,d=!1,y=null;E();var x=new RegExp(Qp(s),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return S(null,t,d);if(typeof t[0]=="object")return S(y||Object.keys(t[0]),t,d)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:Object.keys(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),S(t.fields||[],t.data||[],d);throw new Error("Unable to serialize unrecognized input");function E(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!xa.BAD_DELIMITERS.filter(function(U){return e.delimiter.indexOf(U)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(r=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(d=e.skipEmptyLines),typeof e.newline=="string"&&(o=e.newline),typeof e.quoteChar=="string"&&(s=e.quoteChar),typeof e.header=="boolean"&&(n=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");y=e.columns}e.escapeChar!==void 0&&(u=e.escapeChar+s)}}function S(U,J,G){var H="";typeof U=="string"&&(U=JSON.parse(U)),typeof J=="string"&&(J=JSON.parse(J));var K=Array.isArray(U)&&U.length>0,he=!Array.isArray(J[0]);if(K&&n){for(var Y=0;Y<U.length;Y++)Y>0&&(H+=i),H+=O(U[Y],Y);J.length>0&&(H+=o)}for(var oe=0;oe<J.length;oe++){var Ee=K?U.length:J[oe].length,ze=!1,de=K?Object.keys(J[oe]).length===0:J[oe].length===0;if(G&&!K&&(ze=G==="greedy"?J[oe].join("").trim()==="":J[oe].length===1&&J[oe][0].length===0),G==="greedy"&&K){for(var ve=[],Ae=0;Ae<Ee;Ae++){var $=he?U[Ae]:Ae;ve.push(J[oe][$])}ze=ve.join("").trim()===""}if(!ze){for(var re=0;re<Ee;re++){re>0&&!de&&(H+=i);var Te=K&&he?U[re]:re;H+=O(J[oe][Te],re)}oe<J.length-1&&(!G||Ee>0&&!de)&&(H+=o)}}return H}function O(U,J){if(typeof U>"u"||U===null)return"";if(U.constructor===Date)return JSON.stringify(U).slice(1,25);U=U.toString().replace(x,u);var G=typeof r=="boolean"&&r||Array.isArray(r)&&r[J]||k(U,xa.BAD_DELIMITERS)||U.indexOf(i)>-1||U.charAt(0)===" "||U.charAt(U.length-1)===" ";return G?s+U+s:U}function k(U,J){for(var G=0;G<J.length;G++)if(U.indexOf(J[G])>-1)return!0;return!1}}let p4=class{_handle;_config;_finished=!1;_completed=!1;_input=null;_baseIndex=0;_partialLine="";_rowCount=0;_start=0;isFirstChunk=!0;_completeResults={data:[],errors:[],meta:{}};constructor(e){var r={...e};r.chunkSize=parseInt(r.chunkSize),!e.step&&!e.chunk&&(r.chunkSize=null),this._handle=new g4(r),this._handle.streamer=this,this._config=r}parseChunk(e,r){if(this.isFirstChunk&&tc(this._config.beforeFirstChunk)){var n=this._config.beforeFirstChunk(e);n!==void 0&&(e=n)}this.isFirstChunk=!1;var i=this._partialLine+e;this._partialLine="";var o=this._handle.parse(i,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var s=o.meta.cursor;this._finished||(this._partialLine=i.substring(s-this._baseIndex),this._baseIndex=s),o&&o.data&&(this._rowCount+=o.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(tc(this._config.chunk)&&!r){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!this._completed&&u&&tc(this._config.complete)&&(!o||!o.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),o}}_sendError(e){tc(this._config.error)&&this._config.error(e)}};class SQ extends p4{remaining;constructor(e={}){super(e)}stream(e){return this.remaining=e,this._nextChunk()}_nextChunk(){if(!this._finished){var e=this._config.chunkSize,r=e?this.remaining.substr(0,e):this.remaining;return this.remaining=e?this.remaining.substr(e):"",this._finished=!this.remaining,this.parseChunk(r)}}}const IQ=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,MQ=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class g4{_config;_stepCounter=0;_rowCounter=0;_input;_parser;_paused=!1;_aborted=!1;_delimiterError=!1;_fields=[];_results={data:[],errors:[],meta:{}};constructor(e){if(tc(e.step)){var r=e.step;e.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,e.preview&&this._stepCounter>e.preview?this._parser.abort():r(this._results,this)}}}this._config=e}parse(e,r,n){var i=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=PQ(e,i)),this._delimiterError=!1,this._config.delimiter)tc(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(e),this._results.meta.delimiter=this._config.delimiter);else{var o=this.guessDelimiter(e,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);o.successful?this._config.delimiter=o.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=xa.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var s=m4(this._config);return this._config.preview&&this._config.header&&s.preview++,this._input=e,this._parser=new f2(s),this._results=this._parser.parse(this._input,r,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,tc(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(e){return this._config.skipEmptyLines==="greedy"?e.join("").trim()==="":e.length===1&&e[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+xa.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var e=0;e<this._results.data.length;e++)this.testEmptyLine(this._results.data[e])&&this._results.data.splice(e--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const e=n=>{tc(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var r=0;this.needsHeaderRow()&&r<this._results.data.length;r++)this._results.data[r].forEach(e);this._results.data.splice(0,1)}else this._results.data.forEach(e)}shouldApplyDynamicTyping(e){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[e]===void 0&&(this._config.dynamicTyping[e]=this._config.dynamicTypingFunction(e)),(this._config.dynamicTyping[e]||this._config.dynamicTyping)===!0}parseDynamic(e,r){return this.shouldApplyDynamicTyping(e)?r==="true"||r==="TRUE"?!0:r==="false"||r==="FALSE"?!1:IQ.test(r)?parseFloat(r):MQ.test(r)?new Date(r):r===""?null:r:r}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var e=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),e=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=e,this._results}processRow(e,r){var n=this._config.header?{}:[],i;for(i=0;i<e.length;i++){var o=i,s=e[i];this._config.header&&(o=i>=this._fields.length?"__parsed_extra":this._fields[i]),this._config.transform&&(s=this._config.transform(s,o)),s=this.parseDynamic(o,s),o==="__parsed_extra"?(n[o]=n[o]||[],n[o].push(s)):n[o]=s}return this._config.header&&(i>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+r):i<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+i,this._rowCounter+r)),n}guessDelimiter(e,r,n,i,o){var s,u,d;o=o||[",","	","|",";",xa.RECORD_SEP,xa.UNIT_SEP];for(var y=0;y<o.length;y++){var x=o[y],E=0,S=0,O=0;d=void 0;for(var k=new f2({comments:i,delimiter:x,newline:r,preview:10}).parse(e),U=0;U<k.data.length;U++){if(n&&this.testEmptyLine(k.data[U])){O++;continue}var J=k.data[U].length;if(S+=J,typeof d>"u"){d=0;continue}else J>1&&(E+=Math.abs(J-d),d=J)}k.data.length>0&&(S/=k.data.length-O),(typeof u>"u"||E>u)&&S>1.99&&(u=E,s=x)}return this._config.delimiter=s,{successful:!!s,bestDelimiter:s}}addError(e,r,n,i){this._results.errors.push({type:e,code:r,message:n,row:i})}}function PQ(t,e){t=t.substr(0,1024*1024);var r=new RegExp(Qp(e)+"([^]*?)"+Qp(e),"gm");t=t.replace(r,"");var n=t.split("\r"),i=t.split(`
`),o=i.length>1&&i[0].length<n[0].length;if(n.length===1||o)return`
`;for(var s=0,u=0;u<n.length;u++)n[u][0]===`
`&&s++;return s>=n.length/2?`\r
`:"\r"}function Qp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f2(t){t=t||{};var e=t.delimiter,r=t.newline,n=t.comments,i=t.step,o=t.preview,s=t.fastMode,u;t.quoteChar===void 0?u='"':u=t.quoteChar;var d=u;if(t.escapeChar!==void 0&&(d=t.escapeChar),(typeof e!="string"||xa.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),n===e)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||xa.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var y=0,x=!1;this.parse=function(E,S,O){if(typeof E!="string")throw new Error("Input must be a string");var k=E.length,U=e.length,J=r.length,G=n.length,H=tc(i);y=0;var K=[],he=[],Y=[],oe=0;if(!E)return tt();if(s||s!==!1&&E.indexOf(u)===-1){for(var Ee=E.split(r),ze=0;ze<Ee.length;ze++){const mt=Ee[ze];if(y+=mt.length,ze!==Ee.length-1)y+=r.length;else if(O)return tt();if(!(n&&mt.substr(0,G)===n)){if(H){if(K=[],Le(mt.split(e)),ct(),x)return tt()}else Le(mt.split(e));if(o&&ze>=o)return K=K.slice(0,o),tt(!0)}}return tt()}for(var de=E.indexOf(e,y),ve=E.indexOf(r,y),Ae=new RegExp(Qp(d)+Qp(u),"g"),$;;){if(E[y]===u){for($=y,y++;;){if($=E.indexOf(u,$+1),$===-1)return O||he.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:y}),Ye();if($===k-1){var re=E.substring(y,$).replace(Ae,u);return Ye(re)}if(u===d&&E[$+1]===d){$++;continue}if(!(u!==d&&$!==0&&E[$-1]===d)){var Te=ve===-1?de:Math.min(de,ve),Qe=Ue(Te);if(E[$+1+Qe]===e){if(Y.push(E.substring(y,$).replace(Ae,u)),y=$+1+Qe+U,de=E.indexOf(e,y),ve=E.indexOf(r,y),H&&(ct(),x))return tt();if(o&&K.length>=o)return tt(!0);break}var me=Ue(ve);if(E.substr($+1+me,J)===r){if(Y.push(E.substring(y,$).replace(Ae,u)),et($+1+me+J),de=E.indexOf(e,y),H&&(ct(),x))return tt();if(o&&K.length>=o)return tt(!0);break}he.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:y}),$++}}if(H&&(ct(),x))return tt();if(o&&K.length>=o)return tt(!0);continue}if(n&&Y.length===0&&E.substr(y,G)===n){if(ve===-1)return tt();y=ve+J,ve=E.indexOf(r,y),de=E.indexOf(e,y);continue}if(de!==-1&&(de<ve||ve===-1)){Y.push(E.substring(y,de)),y=de+U,de=E.indexOf(e,y);continue}if(ve!==-1){if(Y.push(E.substring(y,ve)),et(ve+J),H&&(ct(),x))return tt();if(o&&K.length>=o)return tt(!0);continue}break}return Ye();function Le(mt){K.push(mt),oe=y}function Ue(mt){var Tt=0;if(mt!==-1){var nt=E.substring($+1,mt);nt&&nt.trim()===""&&(Tt=nt.length)}return Tt}function Ye(mt){return O||(typeof mt>"u"&&(mt=E.substr(y)),Y.push(mt),y=k,Le(Y),H&&ct()),tt()}function et(mt){y=mt,Le(Y),Y=[],ve=E.indexOf(r,y)}function tt(mt,Tt){var nt=Tt||!1;return{data:nt?K[0]:K,errors:he,meta:{delimiter:e,linebreak:r,aborted:x,truncated:!!mt,cursor:oe+(S||0)}}}function ct(){i(tt(void 0,!0)),K=[],he=[]}},this.abort=function(){x=!0},this.getCharIndex=function(){return y}}function m4(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var r in t)e[r]=m4(t[r]);return e}function tc(t){return typeof t=="function"}const xa={parse:EQ,unparse:BQ,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:TI,BAD_DELIMITERS:["\r",`
`,'"',TI],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:f2,ParserHandle:g4,ChunkStreamer:p4},{ChunkStreamer:RQ}=xa;class FQ extends RQ{textDecoder=new TextDecoder(this._config.encoding);constructor(e={}){super(e)}async stream(e){this._input=e;try{for await(const r of e)this.parseChunk(this.getStringChunk(r));this._finished=!0,this.parseChunk("")}catch(r){this._sendError(r)}}_nextChunk(){}getStringChunk(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}const DQ="4.3.3",ow="object-row-table",aw={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:DQ,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>EI(new TextDecoder().decode(t),e),parseText:(t,e)=>EI(t,e),parseInBatches:OQ,options:{csv:{shape:ow,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function EI(t,e){const r={...aw.options.csv,...e?.csv},n=LQ(t),o=r.header==="auto"?_4(n):!!r.header,s={...r,header:o,download:!1,transformHeader:o?y4():void 0,error:E=>{throw new Error(E)}},u=xa.parse(t,s),d=u.data,y=u.meta.fields||v4(r.columnPrefix,n.length),x=r.shape||ow;switch(x){case"object-row-table":return{shape:"object-row-table",data:d.map(E=>Array.isArray(E)?d4(E,y):E)};case"array-row-table":return{shape:"array-row-table",data:d.map(E=>Array.isArray(E)?E:A4(E,y))};default:throw new Error(x)}}function OQ(t,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const r={...aw.options.csv,...e?.csv},n=new TQ;let i=!0,o=null,s=null,u=null;const d={...r,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(y){let x=y.data;if(r.skipEmptyLines&&x.flat().join("").trim()==="")return;const E=y.meta.cursor;if(i&&!o&&(r.header==="auto"?_4(x):!!r.header)){o=x.map(y4());return}i&&(i=!1,o||(o=v4(r.columnPrefix,x.length)),u=NQ(x,o)),r.optimizeMemoryUsage&&(x=JSON.parse(JSON.stringify(x)));const S=r.shape||ow;s=s||new r_(u,{shape:S,...e});try{s.addRow(x);const O=s&&s.getFullBatch({bytesUsed:E});O&&n.enqueue(O)}catch(O){n.enqueue(O)}},complete(y){try{const x=y.meta.cursor,E=s&&s.getFinalBatch({bytesUsed:x});E&&n.enqueue(E)}catch(x){n.enqueue(x)}n.close()}};return xa.parse(t,d,FQ),n}function _4(t){return t&&t.every(e=>typeof e=="string")}function LQ(t){return xa.parse(t,{dynamicTyping:!0,preview:1}).data[0]}function y4(){const t=new Set;return e=>{let r=e,n=1;for(;t.has(r);)r=`${e}.${n}`,n++;return t.add(r),r}}function v4(t,e=0){const r=[];for(let n=0;n<e;n++)r.push(`${t}${n+1}`);return r}function NQ(t,e){const r=e?{}:[];for(let n=0;n<t.length;n++){const i=e&&e[n]||n;switch(typeof t[n]){case"number":case"boolean":r[i]={name:String(i),index:n,type:Float32Array};break;case"string":default:r[i]={name:String(i),index:n,type:Array}}}return r}const kQ="4.3.3";async function b4(t,e,r,n){return n._parse(t,e,r,n)}function jf(t,e){if(!t)throw new Error("loader assertion failed.")}const x4=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),BI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);BI&&parseFloat(BI[1]);function UQ(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function zQ(t){return globalThis.loaders?.modules?.[t]||null}function GQ(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const VQ=GQ();function HQ(t,e){if(!t)throw new Error("loaders.gl assertion failed.")}const pg=typeof process!="object"||String(process)!=="[object process]"||process.browser,cw=typeof importScripts=="function",SI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);SI&&parseFloat(SI[1]);const Wv={};async function zf(t,e=null,r={},n=null){return e&&(t=jQ(t,e,r,n)),Wv[t]=Wv[t]||$Q(t),await Wv[t]}function jQ(t,e,r={},n=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const i=r.modules||{};return i[n]?i[n]:pg?r.CDN?(HQ(r.CDN.startsWith("http")),`${r.CDN}/${e}@${VQ}/dist/libs/${n}`):cw?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function $Q(t){if(t.endsWith("wasm"))return await JQ(t);if(!pg)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(cw)return importScripts(t);const e=await XQ(t);return WQ(e,t)}function WQ(t,e){if(!pg){const{requireFromString:n}=globalThis.loaders||{};return n?.(t,e)}if(cw)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function JQ(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return pg||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function XQ(t){const{readFileAsText:e}=globalThis.loaders||{};return pg||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function KQ(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?II(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?II(t,0,e):""}function II(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function qQ(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${KQ(t)}"`)}}function w4(t,e,r){const n=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function gg(t,e){return jf(t>=0),jf(e>0),t+(e-1)&-4}function YQ(t,e,r){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const i=t.byteOffset,o=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,i,o)}return e.set(n,r),r+gg(n.byteLength,4)}const ZQ=globalThis.loaders?.parseImageNode,h2=typeof Image<"u",d2=typeof ImageBitmap<"u",QQ=!!ZQ,A2=x4?!0:QQ;function eee(t){switch(t){case"auto":return d2||h2||A2;case"imagebitmap":return d2;case"image":return h2;case"data":return A2;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function tee(){if(d2)return"imagebitmap";if(h2)return"image";if(A2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function ree(t){const e=nee(t);if(!e)throw new Error("Not an image");return e}function C4(t){switch(ree(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function nee(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const iee=/^data:image\/svg\+xml/,see=/\.svg((\?|#).*)?$/;function lw(t){return t&&(iee.test(t)||see.test(t))}function oee(t,e){if(lw(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return T4(t,e)}function T4(t,e){if(lw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function E4(t,e,r){const n=oee(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await aee(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function aee(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const cee={};let MI=!0;async function lee(t,e,r){let n;lw(r)?n=await E4(t,e,r):n=T4(t,r);const i=e&&e.imagebitmap;return await uee(n,i)}async function uee(t,e=null){if((fee(e)||!MI)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),MI=!1}return await createImageBitmap(t)}function fee(t){for(const e in t||cee)return!1;return!0}function hee(t){return!gee(t,"ftyp",4)||(t[8]&96)===0?null:dee(t)}function dee(t){switch(Aee(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Aee(t,e,r){return String.fromCharCode(...t.slice(e,r))}function pee(t){return[...t].map(e=>e.charCodeAt(0))}function gee(t,e,r=0){const n=pee(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const zc=!1,kp=!0;function uw(t){const e=mg(t);return _ee(e)||bee(e)||yee(e)||vee(e)||mee(e)}function mee(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=hee(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function _ee(t){const e=mg(t);return e.byteLength>=24&&e.getUint32(0,zc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,zc),height:e.getUint32(20,zc)}:null}function yee(t){const e=mg(t);return e.byteLength>=10&&e.getUint32(0,zc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,kp),height:e.getUint16(8,kp)}:null}function vee(t){const e=mg(t);return e.byteLength>=14&&e.getUint16(0,zc)===16973&&e.getUint32(2,kp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,kp),height:e.getUint32(22,kp)}:null}function bee(t){const e=mg(t);if(!(e.byteLength>=3&&e.getUint16(0,zc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=xee();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,zc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,zc),width:e.getUint16(o+7,zc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,zc)}return null}function xee(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function mg(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function wee(t,e){const{mimeType:r}=uw(t)||{},n=globalThis.loaders?.parseImageNode;return jf(n),await n(t,r)}async function Cee(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=r||{},s=Tee(i);let u;switch(s){case"imagebitmap":u=await lee(t,e,o);break;case"image":u=await E4(t,e,o);break;case"data":u=await wee(t);break;default:jf(!1)}return i==="data"&&(u=C4(u)),u}function Tee(t){switch(t){case"auto":case"data":return tee();default:return eee(t),t}}const Eee=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Bee=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],See={image:{type:"auto",decode:!0}},Iee={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:kQ,mimeTypes:Bee,extensions:Eee,parse:Cee,tests:[t=>!!uw(new DataView(t))],options:See},Jv={};function Mee(t){if(Jv[t]===void 0){const e=x4?Ree(t):Pee(t);Jv[t]=e}return Jv[t]}function Pee(t){const e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function Ree(t){switch(t){case"image/avif":case"image/webp":return Fee(t);default:return!0}}function Fee(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}function wa(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const B4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S4={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},PI=["SCALAR","VEC2","VEC3","VEC4"],Dee=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Oee=new Map(Dee),Lee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nee={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},kee={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function I4(t){return PI[t-1]||PI[0]}function W_(t){const e=Oee.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function M4(t,e){const r=kee[t.componentType],n=Lee[t.type],i=Nee[t.componentType],o=t.count*n,s=t.count*n*i;wa(s>=0&&s<=e.byteLength);const u=S4[t.componentType],d=B4[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:u,numberOfComponentsInElement:d}}function Uee(t,e,r){const n=t.bufferViews[r];wa(n);const i=n.buffer,o=e[i];wa(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function zee(t,e,r){const n=typeof r=="number"?t.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const i=t.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],u=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:d,length:y,componentByteSize:x,numberOfComponentsInElement:E}=M4(n,i),S=x*E,O=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new d(o,u,y);const k=new d(y);for(let U=0;U<n.count;U++){const J=new d(o,u+U*O,E);k.set(J,U*E)}return k}function Gee(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let Es=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Gee(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof r=="string"||typeof n=="string"}getExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return r?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const n=this.json[e]&&this.json[e][r];if(!n)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,n=this.gltf.buffers[r];wa(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return zee(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),i=this.getBuffer(r.buffer).data,o=r.byteOffset||0;return new Uint8Array(i,o,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,n){return e.extensions=e.extensions||{},e.extensions[r]=n,this.registerUsedExtension(r),this}setObjectExtension(e,r,n){const i=e.extensions||{};i[r]=n}removeObjectExtension(e,r){const n=e?.extensions||{};if(n[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(r)||i.push(r)}delete n[r]}addExtension(e,r={}){return wa(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return wa(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:r};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:n,material:i,mode:o=4}=e,u={primitives:[{attributes:this._addAttributes(r),mode:o}]};if(n){const d=this._addIndices(n);u.primitives[0].indices=d}return Number.isFinite(i)&&(u.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(u),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,r){const n=uw(e),i=r||n?.mimeType,s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,r=0,n=this.byteLength){const i=e.byteLength;wa(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:r,byteOffset:n,byteLength:i};return this.byteLength+=gg(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,r){const n={bufferView:e,type:I4(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const n=this.addBufferView(e);let i={min:r.min,max:r.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,r.size));const o={size:r.size,componentType:W_(e),count:Math.round(e.length/r.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,r))}addTexture(e){const{imageIndex:r}=e,n={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,r=new ArrayBuffer(e),n=new Uint8Array(r);let i=0;for(const o of this.sourceBuffers||[])i=YQ(o,n,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let n=!0;for(;n;){const i=e.indexOf(r);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const r={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);r[o]=s}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const n={min:null,max:null};if(e.length<r)return n;n.min=[],n.max=[];const i=e.subarray(0,r);for(const o of i)n.min.push(o),n.max.push(o);for(let o=r;o<e.length;o+=r)for(let s=0;s<r;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}};function RI(t){return(t%1+1)%1}const P4={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Vee={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},R4={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function fw(t,e){return R4[e]*P4[t]}function J_(t,e,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const i=t.getTypedArrayForBufferView(e),o=X_(i,"SCALAR",r,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function X_(t,e,r,n=1){const i=P4[e],o=Vee[r],s=R4[r],u=n*i,d=u*s;let y=t.buffer,x=t.byteOffset;return x%s!==0&&(y=new Uint8Array(y).slice(x,x+d).buffer,x=0),new o(y,x,u)}function hw(t,e,r){const n=`TEXCOORD_${e.texCoord||0}`,i=r.attributes[n],o=t.getTypedArrayForAccessor(i),s=t.gltf.json,u=e.index,d=s.textures?.[u]?.source;if(typeof d<"u"){const y=s.images?.[d]?.mimeType,x=t.gltf.images?.[d];if(x&&typeof x.width<"u"){const E=[];for(let S=0;S<o.length;S+=2){const O=Hee(x,y,o,S,e.channels);E.push(O)}return E}}return[]}function F4(t,e,r,n,i){if(!r?.length)return;const o=[];for(const x of r){let E=n.findIndex(S=>S===x);E===-1&&(E=n.push(x)-1),o.push(E)}const s=new Uint32Array(o),u=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,d=t.addBufferView(s,u,0),y=t.addAccessor(d,{size:1,componentType:W_(s),count:s.length});i.attributes[e]=y}function Hee(t,e,r,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[n],u=r[n+1];let d=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(d=4);const y=jee(s,u,t,d);let x=0;for(const E of i){const S=typeof E=="number"?Object.values(o)[E]:o[E],O=y+S.offset,k=C4(t);if(k.data.length<=O)throw new Error(`${k.data.length} <= ${O}`);const U=k.data[O];x|=U<<S.shift}return x}function jee(t,e,r,n=1){const i=r.width,o=RI(t)*(i-1),s=Math.round(o),u=r.height,d=RI(e)*(u-1),y=Math.round(d),x=r.components?r.components:n;return(y*i+s)*x}function D4(t,e,r,n,i){const o=[];for(let s=0;s<e;s++){const u=r[s],d=r[s+1]-r[s];if(d+u>n)break;const y=u/i,x=d/i;o.push(t.slice(y,y+x))}return o}function O4(t,e,r){const n=[];for(let i=0;i<e;i++){const o=i*r;n.push(t.slice(o,o+r))}return n}function L4(t,e,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let u=0;u<t;u++){const d=n[u+1]-n[u];if(d+s<=e.length){const y=e.subarray(s,d+s),x=o.decode(y);i.push(x),s+=d}}return i}return[]}const Qd="EXT_mesh_features",$ee=Qd;async function Wee(t,e){const r=new Es(t);Xee(r,e)}function Jee(t,e){const r=new Es(t);return qee(r),r.createBinaryChunk(),r.gltf}function Xee(t,e){const r=t.gltf.json;if(r.meshes)for(const n of r.meshes)for(const i of n.primitives)Kee(t,i,e)}function Kee(t,e,r){if(!r?.gltf?.loadBuffers)return;const i=e.extensions?.[Qd]?.featureIds;if(i)for(const o of i){let s;if(typeof o.attribute<"u"){const u=`_FEATURE_ID_${o.attribute}`,d=e.attributes[u];s=t.getTypedArrayForAccessor(d)}else typeof o.texture<"u"&&r?.gltf?.loadImages?s=hw(t,o.texture,e):s=[];o.data=s}}function qee(t,e){const r=t.gltf.json.meshes;if(r)for(const n of r)for(const i of n.primitives)Zee(t,i)}function Yee(t,e,r,n){e.extensions||(e.extensions={});let i=e.extensions[Qd];i||(i={featureIds:[]},e.extensions[Qd]=i);const{featureIds:o}=i,s={featureCount:r.length,propertyTable:n,data:r};o.push(s),t.addObjectExtension(e,Qd,i)}function Zee(t,e){const r=e.extensions?.[Qd];if(!r)return;const n=r.featureIds;n.forEach((i,o)=>{if(i.data){const{accessorKey:s,index:u}=Qee(e.attributes),d=new Uint32Array(i.data);n[o]={featureCount:d.length,propertyTable:i.propertyTable,attribute:u},t.gltf.buffers.push({arrayBuffer:d.buffer,byteOffset:d.byteOffset,byteLength:d.byteLength});const y=t.addBufferView(d),x=t.addAccessor(y,{size:1,componentType:W_(d),count:d.length});e.attributes[s]=x}})}function Qee(t){const e="_FEATURE_ID_",r=Object.keys(t).filter(o=>o.indexOf(e)===0);let n=-1;for(const o of r){const s=Number(o.substring(e.length));s>n&&(n=s)}return n++,{accessorKey:`${e}${n}`,index:n}}const ete=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Yee,decode:Wee,encode:Jee,name:$ee},Symbol.toStringTag,{value:"Module"})),hA="EXT_structural_metadata",tte=hA;async function rte(t,e){const r=new Es(t);ite(r,e)}function nte(t,e){const r=new Es(t);return vte(r),r.createBinaryChunk(),r.gltf}function ite(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(hA);r&&(e.gltf?.loadImages&&ste(t,r),ote(t,r))}function ste(t,e){const r=e.propertyTextures,n=t.gltf.json;if(r&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)cte(t,r,o,e)}function ote(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=ate(i,o);s&&ute(t,r,s)}}function ate(t,e){for(const r of t)if(r.class===e)return r;return null}function cte(t,e,r,n){if(!e)return;const o=r.extensions?.[hA]?.propertyTextures;if(o)for(const s of o){const u=e[s];lte(t,u,r,n)}}function lte(t,e,r,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const o in e.properties){const s=`${i}_${o}`,u=e.properties?.[o];if(!u)continue;u.data||(u.data=[]);const d=u.data,y=hw(t,u,r);y!==null&&(F4(t,s,y,d,r),u.data=d,n.dataAttributeNames.push(s))}}function ute(t,e,r){const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],u=r.properties?.[o];if(u){const d=fte(t,e,s,i,u);u.data=d}}}function fte(t,e,r,n,i){let o=[];const s=i.values,u=t.getTypedArrayForBufferView(s),d=hte(t,r,i,n),y=dte(t,i,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=Ate(r,n,u,d);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=L4(n,u,d,y);break}case"ENUM":{o=pte(e,r,n,u,d);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function hte(t,e,r,n){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?J_(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function dte(t,e,r){return typeof e.stringOffsets<"u"?J_(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function Ate(t,e,r,n){const i=t.array,o=t.count,s=fw(t.type,t.componentType),u=r.byteLength/s;let d;return t.componentType?d=X_(r,t.type,t.componentType,u):d=r,i?n?D4(d,e,n,r.length,s):o?O4(d,e,o):[]:d}function pte(t,e,r,n,i){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=t.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const u=s.valueType||"UINT16",d=fw(e.type,u),y=n.byteLength/d;let x=X_(n,e.type,u,y);if(x||(x=n),e.array){if(i)return gte({valuesData:x,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:d,enumEntry:s});const E=e.count;return E?mte(x,r,E,s):[]}return dw(x,0,r,s)}function gte(t){const{valuesData:e,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=t,u=[];for(let d=0;d<r;d++){const y=n[d],x=n[d+1]-n[d];if(x+y>i)break;const E=y/o,S=x/o,O=dw(e,E,S,s);u.push(O)}return u}function mte(t,e,r,n){const i=[];for(let o=0;o<e;o++){const s=r*o,u=dw(t,s,r,n);i.push(u)}return i}function dw(t,e,r,n){const i=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)i.push("");else{const s=t[e+o],u=_te(n,s);u?i.push(u.name):i.push("")}return i}function _te(t,e){for(const r of t.values)if(r.value===e)return r;return null}const yte="schemaClassId";function vte(t,e){const r=t.getExtension(hA);if(r&&r.propertyTables)for(const n of r.propertyTables){const i=n.class,o=r.schema?.classes?.[i];n.properties&&o&&bte(n,o,t)}}function bte(t,e,r){for(const n in t.properties){const i=t.properties[n].data;if(i){const o=e.properties[n];if(o){const s=Tte(i,o,r);t.properties[n]=s}}}}function xte(t,e,r=yte){let n=t.getExtension(hA);n||(n=t.addExtension(hA)),n.schema=wte(e,r,n.schema);const i=Cte(e,r,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function wte(t,e,r){const n=r??{id:"schema_id"},i={properties:{}};for(const o of t){const s={type:o.elementType,componentType:o.componentType};i.properties[o.name]=s}return n.classes={},n.classes[e]=i,n}function Cte(t,e,r){const n={class:e,count:0};let i=0;const o=r.classes?.[e];for(const s of t){if(i===0&&(i=s.values.length),i!==s.values.length&&s.values.length)throw new Error("Illegal values in attributes");o?.properties[s.name]&&(n.properties||(n.properties={}),n.properties[s.name]={values:0,data:s.values})}return n.count=i,n}function Tte(t,e,r){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:o}=Ste(t);n.stringOffsets=Xv(o,r),n.values=Xv(i,r)}else if(e.type==="SCALAR"&&e.componentType){const i=Bte(t,e.componentType);n.values=Xv(i,r)}return n}const Ete={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Bte(t,e){const r=[];for(const i of t)r.push(Number(i));const n=Ete[e];if(!n)throw new Error("Illegal component type");return new n(r)}function Ste(t){const e=new TextEncoder,r=[];let n=0;for(const d of t){const y=e.encode(d);n+=y.length,r.push(y)}const i=new Uint8Array(n),o=[];let s=0;for(const d of r)i.set(d,s),o.push(s),s+=d.length;o.push(s);const u=new Uint32Array(o);return{stringData:i,stringOffsets:u}}function Xv(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const Ite=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:xte,decode:rte,encode:nte,name:tte},Symbol.toStringTag,{value:"Module"})),N4="EXT_feature_metadata",Mte=N4;async function Pte(t,e){const r=new Es(t);Rte(r,e)}function Rte(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(N4);r&&(e.gltf?.loadImages&&Fte(t,r),Dte(t,r))}function Fte(t,e){const r=e.schema;if(!r)return;const n=r.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],u=Lte(i,o);u&&kte(t,u,s)}}function Dte(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=Ote(i,o);s&&Nte(t,r,s)}}function Ote(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function Lte(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function Nte(t,e,r){if(!r.class)return;const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],u=r.properties?.[o];if(u){const d=Ute(t,e,s,i,u);u.data=d}}}function kte(t,e,r){const n=e.class;for(const i in r.properties){const o=e?.properties?.[i];if(o){const s=jte(t,o,n);o.data=s}}}function Ute(t,e,r,n,i){let o=[];const s=i.bufferView,u=t.getTypedArrayForBufferView(s),d=zte(t,r,i,n),y=Gte(t,r,i,n);return r.type==="STRING"||r.componentType==="STRING"?o=L4(n,u,d,y):Vte(r)&&(o=Hte(r,n,u,d)),o}function zte(t,e,r,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?J_(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function Gte(t,e,r,n){return typeof r.stringOffsetBufferView<"u"?J_(t,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function Vte(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function Hte(t,e,r,n){const i=t.type==="ARRAY",o=t.componentCount,s="SCALAR",u=t.componentType||t.type,d=fw(s,u),y=r.byteLength/d,x=X_(r,s,u,y);return i?n?D4(x,e,n,r.length,d):o?O4(x,e,o):[]:x}function jte(t,e,r){const n=t.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)$te(t,r,e,i,s);return i}function $te(t,e,r,n,i){const o={channels:r.channels,...r.texture},s=hw(t,o,i);s&&F4(t,e,s,n,i)}const Wte=Object.freeze(Object.defineProperty({__proto__:null,decode:Pte,name:Mte},Symbol.toStringTag,{value:"Module"})),Jte="4.3.3",Xte="4.3.3",n_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let FI;async function DI(t){UQ(t.modules);const e=zQ("basis");return e||(FI||=Kte(t),await FI)}async function Kte(t){let e=null,r=null;return[e,r]=await Promise.all([await zf(n_.TRANSCODER,"textures",t),await zf(n_.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await qte(e,r)}function qte(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let Kv;async function OI(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Kv=Kv||Yte(t),await Kv)}async function Yte(t){let e=null,r=null;return[e,r]=await Promise.all([await zf(n_.ENCODER,"textures",t),await zf(n_.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await Zte(e,r)}function Zte(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:u,BasisEncoder:d}=i;u(),n({BasisFile:o,KTX2File:s,BasisEncoder:d})})})}const ld={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Qte=["","WEBKIT_","MOZ_"],LI={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let S0=null;function ere(t){if(!S0){t=t||tre()||void 0,S0=new Set;for(const e of Qte)for(const r in LI)if(t&&t.getExtension(`${e}${r}`)){const n=LI[r];S0.add(n)}}return S0}function tre(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Ko=[171,75,84,88,32,50,48,187,13,10,26,10];function rre(t){const e=new Uint8Array(t);return!(e.byteLength<Ko.length||e[0]!==Ko[0]||e[1]!==Ko[1]||e[2]!==Ko[2]||e[3]!==Ko[3]||e[4]!==Ko[4]||e[5]!==Ko[5]||e[6]!==Ko[6]||e[7]!==Ko[7]||e[8]!==Ko[8]||e[9]!==Ko[9]||e[10]!==Ko[10]||e[11]!==Ko[11])}const nre={etc1:{basisFormat:0,compressed:!0,format:ld.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ld.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:ld.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:ld.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:ld.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:ld.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function ire(t,e){if(e.basis.containerFormat==="auto"){if(rre(t)){const n=await OI(e);return NI(n.KTX2File,t,e)}const{BasisFile:r}=await DI(e);return qv(r,t,e)}switch(e.basis.module){case"encoder":const r=await OI(e);switch(e.basis.containerFormat){case"ktx2":return NI(r.KTX2File,t,e);case"basis":default:return qv(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await DI(e);return qv(n,t,e)}}function qv(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const u=n.getNumLevels(s),d=[];for(let y=0;y<u;y++)d.push(sre(n,s,y,r));o.push(d)}return o}finally{n.close(),n.delete()}}function sre(t,e,r,n){const i=t.getImageWidth(e,r),o=t.getImageHeight(e,r),s=t.getHasAlpha(),{compressed:u,format:d,basisFormat:y}=k4(n,s),x=t.getImageTranscodedSizeInBytes(e,r,y),E=new Uint8Array(x);if(!t.transcodeImage(E,e,r,y,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:E,compressed:u,format:d,hasAlpha:s}}function NI(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++)o.push(ore(n,s,r));return[o]}finally{n.close(),n.delete()}}function ore(t,e,r){const{alphaFlag:n,height:i,width:o}=t.getImageLevelInfo(e,0,0),{compressed:s,format:u,basisFormat:d}=k4(r,n),y=t.getImageTranscodedSizeInBytes(e,0,0,d),x=new Uint8Array(y);if(!t.transcodeImage(x,e,0,0,d,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:x,compressed:s,levelSize:y,hasAlpha:n,format:u}}function k4(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=U4()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),nre[r]}function U4(){const t=ere();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const are={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Xte,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},cre={...are,parse:ire},dA=!0,kI=1735152710,Aw=12,i_=8,lre=1313821514,ure=5130562,fre=0,hre=0,dre=1;function Are(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function pre(t,e=0,r={}){const n=new DataView(t),{magic:i=kI}=r,o=n.getUint32(e,!1);return o===i||o===kI}function gre(t,e,r=0,n={}){const i=new DataView(e),o=Are(i,r+0),s=i.getUint32(r+4,dA),u=i.getUint32(r+8,dA);switch(Object.assign(t,{header:{byteOffset:r,byteLength:u,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=Aw,t.version){case 1:return mre(t,i,r);case 2:return _re(t,i,r,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function mre(t,e,r){jf(t.header.byteLength>Aw+i_);const n=e.getUint32(r+0,dA),i=e.getUint32(r+4,dA);return r+=i_,jf(i===fre),p2(t,e,r,n),r+=n,r+=g2(t,e,r,t.header.byteLength),r}function _re(t,e,r,n){return jf(t.header.byteLength>Aw+i_),yre(t,e,r,n),r+t.header.byteLength}function yre(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,dA),o=e.getUint32(r+4,dA);switch(r+=i_,o){case lre:p2(t,e,r,i);break;case ure:g2(t,e,r,i);break;case hre:n.strict||p2(t,e,r,i);break;case dre:n.strict||g2(t,e,r,i);break}r+=gg(i,4)}return r}function p2(t,e,r,n){const i=new Uint8Array(e.buffer,r,n),s=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(s),gg(n,4)}function g2(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),gg(n,4)}function z4(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return n.substr(0,n.lastIndexOf("/")+1)+t}const vre="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",bre="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",xre=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),wre=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Cre={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Tre={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Ere(t,e,r,n,i,o="NONE"){const s=await Bre();Mre(s,s.exports[Tre[i]],t,e,r,n,s.exports[Cre[o||"NONE"]])}let Yv;async function Bre(){return Yv||(Yv=Sre()),Yv}async function Sre(){let t=vre;WebAssembly.validate(xre)&&(t=bre,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(Ire(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Ire(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?wre[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,r)}function Mre(t,e,r,n,i,o,s){const u=t.exports.sbrk,d=n+3&-4,y=u(d*i),x=u(o.length),E=new Uint8Array(t.exports.memory.buffer);E.set(o,x);const S=e(y,n,i,x,o.length);if(S===0&&s&&s(y,d,i),r.set(E.subarray(y,y+n*i)),u(y-u(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const s_="EXT_meshopt_compression",Pre=s_;async function Rre(t,e){const r=new Es(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of t.json.bufferViews||[])n.push(Fre(r,i));await Promise.all(n),r.removeExtension(s_)}async function Fre(t,e){const r=t.getObjectExtension(e,s_);if(r){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:u,filter:d="NONE",buffer:y}=r,x=t.gltf.buffers[y],E=new Uint8Array(x.arrayBuffer,x.byteOffset+n,i),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await Ere(S,s,o,E,u,d),t.removeObjectExtension(e,s_)}}const Dre=Object.freeze(Object.defineProperty({__proto__:null,decode:Rre,name:Pre},Symbol.toStringTag,{value:"Module"})),Md="EXT_texture_webp",Ore=Md;function Lre(t,e){const r=new Es(t);if(!Mee("image/webp")){if(r.getRequiredExtensions().includes(Md))throw new Error(`gltf: Required extension ${Md} not supported by browser`);return}const{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,Md);o&&(i.source=o.source),r.removeObjectExtension(i,Md)}r.removeExtension(Md)}const Nre=Object.freeze(Object.defineProperty({__proto__:null,name:Ore,preprocess:Lre},Symbol.toStringTag,{value:"Module"})),mm="KHR_texture_basisu",kre=mm;function Ure(t,e){const r=new Es(t),{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,mm);o&&(i.source=o.source,r.removeObjectExtension(i,mm))}r.removeExtension(mm)}const zre=Object.freeze(Object.defineProperty({__proto__:null,name:kre,preprocess:Ure},Symbol.toStringTag,{value:"Module"})),Gre="4.3.3",Vre={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Gre,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Hre(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function jre(t){let e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const u=t.POSITION?t.POSITION.value:[],d=u&&u.length;for(let y=0;y<d;y+=3){const x=u[y],E=u[y+1],S=u[y+2];e=x<e?x:e,r=E<r?E:r,n=S<n?S:n,i=x>i?x:i,o=E>o?E:o,s=S>s?S:s}return[[e,r,n],[i,o,s]]}function $re(t,e,r){const n=Hre(e.value),i=r||Wre(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function Wre(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}function Jre(t,e,r){const n=G4(e.metadata),i=[],o=Xre(e.attributes);for(const s in t){const u=t[s],d=UI(s,u,o[s]);i.push(d)}if(r){const s=UI("indices",r);i.push(s)}return{fields:i,metadata:n}}function Xre(t){const e={};for(const r in t){const n=t[r];e[n.name||"undefined"]=n}return e}function UI(t,e,r){const n=r?G4(r.metadata):void 0;return $re(t,e,n)}function G4(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const zI={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Kre={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},qre=4;let Yre=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const S=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(S)}const u=this._getDracoLoaderData(o,i,r),d=this._getMeshData(o,u,r),y=jre(d.attributes),x=Jre(d.attributes,u,d.indices);return{loader:"draco",loaderData:u,header:{vertexCount:o.num_points(),boundingBox:y},...d,schema:x}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,r,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,r){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const u=this._getQuantizationTransform(o,r);u&&(n[o.unique_id()].quantization_transform=u);const d=this._getOctahedronTransform(o,r);d&&(n[o.unique_id()].octahedron_transform=d)}return n}_getMeshData(e,r,n){const i=this._getMeshAttributes(r,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,r,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const u=this._getAttributeValues(r,o);if(u){const{value:d,size:y}=u;i[s]={value:d,size:y,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*qre,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,n).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),ene(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){const n=Kre[r.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const i=r.num_components,s=e.num_points()*i,u=s*n.BYTES_PER_ELEMENT,d=Zre(this.draco,n);let y;const x=this.draco._malloc(u);try{const E=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,E,d,u,x),y=new n(this.draco.HEAPF32.buffer,x,s).slice()}finally{this.draco._free(x)}return{value:y,size:i}}_deduceAttributeName(e,r){const n=e.unique_id;for(const[s,u]of Object.entries(r.extraAttributes||{}))if(u===n)return s;const i=e.attribute_type;for(const s in zI)if(this.draco[s]===i)return zI[s];const o=r.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){const n=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const r={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);r[o]=this._getDracoMetadataField(e,o)}return r}_getDracoMetadataField(e,r){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,n);const i=Qre(n);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:r=[],octahedronAttributes:n=[]}=e,i=[...r,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,r){const{quantizedAttributes:n=[]}=r,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(u=>s.min_value(u))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,r){const{octahedronAttributes:n=[]}=r,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}};function Zre(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function Qre(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}function ene(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}const tne="1.5.6",rne="1.4.1",Zv=`https://www.gstatic.com/draco/versioned/decoders/${tne}`,So={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Qv={[So.DECODER]:`${Zv}/${So.DECODER}`,[So.DECODER_WASM]:`${Zv}/${So.DECODER_WASM}`,[So.FALLBACK_DECODER]:`${Zv}/${So.FALLBACK_DECODER}`,[So.ENCODER]:`https://raw.githubusercontent.com/google/draco/${rne}/javascript/${So.ENCODER}`};let eb;async function nne(t){const e=t.modules||{};return e.draco3d?eb||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):eb||=ine(t),await eb}async function ine(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await zf(Qv[So.FALLBACK_DECODER],"draco",t,So.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await zf(Qv[So.DECODER],"draco",t,So.DECODER),await zf(Qv[So.DECODER_WASM],"draco",t,So.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await sne(e,r)}function sne(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t({...r,onModuleLoaded:i=>n({draco:i})})})}const one={...Vre,parse:ane};async function ane(t,e){const{draco:r}=await nne(e),n=new Yre(r);try{return n.parseSync(t,e?.draco)}finally{n.destroy()}}function cne(t){const e={};for(const r in t){const n=t[r];if(r!=="indices"){const i=V4(n);e[r]=i}}return e}function V4(t){const{buffer:e,size:r,count:n}=lne(t);return{value:e,size:r,byteOffset:0,count:n,type:I4(r),componentType:W_(e)}}function lne(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=une(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}function une(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const Pu="KHR_draco_mesh_compression",fne=Pu;function hne(t,e,r){const n=new Es(t);for(const i of H4(n))n.getObjectExtension(i,Pu)}async function dne(t,e,r){if(!e?.gltf?.decompressMeshes)return;const n=new Es(t),i=[];for(const o of H4(n))n.getObjectExtension(o,Pu)&&i.push(pne(n,o,e,r));await Promise.all(i),n.removeExtension(Pu)}function Ane(t,e={}){const r=new Es(t);for(const n of r.json.meshes||[])gne(n),r.addRequiredExtension(Pu)}async function pne(t,e,r,n){const i=t.getObjectExtension(e,Pu);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),s=w4(o.buffer,o.byteOffset),u={...r};delete u["3d-tiles"];const d=await b4(s,one,u,n),y=cne(d.attributes);for(const[x,E]of Object.entries(y))if(x in e.attributes){const S=e.attributes[x],O=t.getAccessor(S);O?.min&&O?.max&&(E.min=O.min,E.max=O.max)}e.attributes=y,d.indices&&(e.indices=V4(d.indices)),t.removeObjectExtension(e,Pu),mne(e)}function gne(t,e,r=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),s=i?.parseSync?.({attributes:t}),u=n._addFauxAttributes(s.attributes),d=n.addBufferView(o);return{primitives:[{attributes:u,mode:r,extensions:{[Pu]:{bufferView:d,attributes:u}}}]}}function mne(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*H4(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const _ne=Object.freeze(Object.defineProperty({__proto__:null,decode:dne,encode:Ane,name:fne,preprocess:hne},Symbol.toStringTag,{value:"Module"})),K_="KHR_texture_transform",yne=K_,I0=new ut,vne=new ci,bne=new ci;async function xne(t,e){if(!new Es(t).hasExtension(K_)||!e.gltf?.loadBuffers)return;const i=t.json.materials||[];for(let o=0;o<i.length;o++)wne(o,t)}function wne(t,e){const r=e.json.materials?.[t],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const o of n)o&&o?.extensions?.[K_]&&Cne(e,t,o,i)}function Cne(t,e,r,n){const i=Tne(r,n);if(!i)return;const o=t.json.meshes||[];for(const s of o)for(const u of s.primitives){const d=u.material;Number.isFinite(d)&&e===d&&Ene(t,u,i)}}function Tne(t,e){const r=t.extensions?.[K_],{texCoord:n=0}=t,{texCoord:i=n}=r;if(!(e.findIndex(([s,u])=>s===n&&u===i)!==-1)){const s=Ine(r);return n!==i&&(t.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:s}}return null}function Ene(t,e,r){const{originalTexCoord:n,texCoord:i,matrix:o}=r,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const u=t.json.accessors?.[s];if(u&&u.bufferView){const d=t.json.bufferViews?.[u.bufferView];if(d){const{arrayBuffer:y,byteOffset:x}=t.buffers[d.buffer],E=(x||0)+(u.byteOffset||0)+(d.byteOffset||0),{ArrayType:S,length:O}=M4(u,d),k=S4[u.componentType],U=B4[u.type],J=d.byteStride||k*U,G=new Float32Array(O);for(let H=0;H<u.count;H++){const K=new S(y,E+H*J,2);I0.set(K[0],K[1],1),I0.transformByMatrix3(o),G.set([I0[0],I0[1]],H*U)}n===i?Bne(u,d,t.buffers,G):Sne(i,u,e,t,G)}}}}function Bne(t,e,r,n){t.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Sne(t,e,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function Ine(t){const{offset:e=[0,0],rotation:r=0,scale:n=[1,1]}=t,i=new ci().set(1,0,0,0,1,0,e[0],e[1],1),o=vne.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=bne.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const Mne=Object.freeze(Object.defineProperty({__proto__:null,decode:xne,name:yne},Symbol.toStringTag,{value:"Module"})),Pf="KHR_lights_punctual",Pne=Pf;async function Rne(t){const e=new Es(t),{json:r}=e,n=e.getExtension(Pf);n&&(e.json.lights=n.lights,e.removeExtension(Pf));for(const i of r.nodes||[]){const o=e.getObjectExtension(i,Pf);o&&(i.light=o.light),e.removeObjectExtension(i,Pf)}}async function Fne(t){const e=new Es(t),{json:r}=e;if(r.lights){const n=e.addExtension(Pf);wa(!n.lights),n.lights=r.lights,delete r.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Pf,n)}delete e.json.lights}}const Dne=Object.freeze(Object.defineProperty({__proto__:null,decode:Rne,encode:Fne,name:Pne},Symbol.toStringTag,{value:"Module"})),eg="KHR_materials_unlit",One=eg;async function Lne(t){const e=new Es(t),{json:r}=e;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,eg);e.removeExtension(eg)}function Nne(t){const e=new Es(t),{json:r}=e;if(e.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,eg,{}),e.addExtension(eg))}const kne=Object.freeze(Object.defineProperty({__proto__:null,decode:Lne,encode:Nne,name:One},Symbol.toStringTag,{value:"Module"})),Tp="KHR_techniques_webgl",Une=Tp;async function zne(t){const e=new Es(t),{json:r}=e,n=e.getExtension(Tp);if(n){const i=Vne(n,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,Tp);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Hne(o.technique,e)),e.removeObjectExtension(o,Tp)}e.removeExtension(Tp)}}async function Gne(t,e){}function Vne(t,e){const{programs:r=[],shaders:n=[],techniques:i=[]}=t,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=r[s.program]}),i}function Hne(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in r)&&(r[n]=t.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=e.getTexture(r[n].index))}),r}const jne=Object.freeze(Object.defineProperty({__proto__:null,decode:zne,encode:Gne,name:Une},Symbol.toStringTag,{value:"Module"})),j4=[Ite,ete,Dre,Nre,zre,_ne,Dne,kne,jne,Mne,Wte];function $ne(t,e={},r){const n=j4.filter(i=>$4(i.name,e));for(const i of n)i.preprocess?.(t,e,r)}async function Wne(t,e={},r){const n=j4.filter(i=>$4(i.name,e));for(const i of n)await i.decode?.(t,e,r)}function $4(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const tb="KHR_binary_glTF";function Jne(t){const e=new Es(t),{json:r}=e;for(const n of r.images||[]){const i=e.getObjectExtension(n,tb);i&&Object.assign(n,i),e.removeObjectExtension(n,tb)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(tb)}const GI={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Xne={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let Kne=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Jne(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in GI)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const n=e[r];if(!(!n||Array.isArray(n))){e[r]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[r].length;e[r].push(o),this.idToIndexMap[r][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const r in GI)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:n,indices:i,material:o}=r;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(r.indices=this._convertIdToIndex(i,"accessor")),o&&(r.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const n of e[r])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,r){const n=Xne[r];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return i}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,i=e.textures.findIndex(o=>o.id===n);i!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:i})}}};function qne(t,e={}){return new Kne().normalize(t,e)}async function Yne(t,e,r=0,n,i){return Zne(t,e,r,n),qne(t,{normalize:n?.gltf?.normalize}),$ne(t,n,i),n?.gltf?.loadBuffers&&t.json.buffers&&await Qne(t,n,i),n?.gltf?.loadImages&&await eie(t,n,i),await Wne(t,n,i),t}function Zne(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!pre(e,r,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=qQ(e);else if(e instanceof ArrayBuffer){const s={};r=gre(s,e,r,n.glb),wa(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else wa(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function Qne(t,e,r){const n=t.json.buffers||[];for(let i=0;i<n.length;++i){const o=n[i];if(o.uri){const{fetch:s}=r;wa(s);const u=z4(o.uri,e),y=await(await r?.fetch?.(u))?.arrayBuffer?.();t.buffers[i]={arrayBuffer:y,byteOffset:0,byteLength:y.byteLength},delete o.uri}else t.buffers[i]===null&&(t.buffers[i]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function eie(t,e,r){const n=tie(t),i=t.json.images||[],o=[];for(const s of n)o.push(rie(t,i[s],s,e,r));return await Promise.all(o)}function tie(t){const e=new Set,r=t.json.textures||[];for(const n of r)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function rie(t,e,r,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const u=z4(e.uri,n),{fetch:d}=i;o=await(await d(u)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const u=Uee(t.json,t.buffers,e.bufferView);o=w4(u.buffer,u.byteOffset,u.byteLength)}wa(o,"glTF image has no data");let s=await b4(o,[Iee,cre],{...n,mimeType:e.mimeType,basis:n.basis||{format:U4()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const m2={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Jte,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:nie,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function nie(t,e={},r){e={...m2.options,...e},e.gltf={...m2.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Yne({},t,n,e,r)}var Qs=1e-6,AA=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function iie(){var t=new AA(4);return AA!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function sie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function oie(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,t}(function(){var t=iie();return function(e,r,n,i,o,s){var u,d;for(r||(r=4),n||(n=0),i?d=Math.min(i*r+n,e.length):d=e.length,u=n;u<d;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],o(t,t,s),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}})();function _m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function eA(t,e){const r=oie([],e,t);return sie(r,r,1/r[3]),r}function VI(t,e){const r=t%e;return r<0?e+r:r}function aie(t,e,r){return r*e+(1-r)*t}function _2(t,e,r){return t<e?e:t>r?r:t}function cie(t){return Math.log(t)*Math.LOG2E}const pw=Math.log2||cie;function lie(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],u=e[5],d=e[6],y=e[7],x=e[8],E=e[9],S=e[10],O=e[11],k=e[12],U=e[13],J=e[14],G=e[15],H=r*u-n*s,K=r*d-i*s,he=r*y-o*s,Y=n*d-i*u,oe=n*y-o*u,Ee=i*y-o*d,ze=x*U-E*k,de=x*J-S*k,ve=x*G-O*k,Ae=E*J-S*U,$=E*G-O*U,re=S*G-O*J,Te=H*re-K*$+he*Ae+Y*ve-oe*de+Ee*ze;return Te?(Te=1/Te,t[0]=(u*re-d*$+y*Ae)*Te,t[1]=(i*$-n*re-o*Ae)*Te,t[2]=(U*Ee-J*oe+G*Y)*Te,t[3]=(S*oe-E*Ee-O*Y)*Te,t[4]=(d*ve-s*re-y*de)*Te,t[5]=(r*re-i*ve+o*de)*Te,t[6]=(J*he-k*Ee-G*K)*Te,t[7]=(x*Ee-S*he+O*K)*Te,t[8]=(s*$-u*ve+y*ze)*Te,t[9]=(n*ve-r*$-o*ze)*Te,t[10]=(k*oe-U*he+G*H)*Te,t[11]=(E*he-x*oe-O*H)*Te,t[12]=(u*de-s*Ae-d*ze)*Te,t[13]=(r*Ae-n*de+i*ze)*Te,t[14]=(U*K-k*Y-J*H)*Te,t[15]=(x*Y-E*K+S*H)*Te,t):null}function rb(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],u=e[4],d=e[5],y=e[6],x=e[7],E=e[8],S=e[9],O=e[10],k=e[11],U=e[12],J=e[13],G=e[14],H=e[15],K=r[0],he=r[1],Y=r[2],oe=r[3];return t[0]=K*n+he*u+Y*E+oe*U,t[1]=K*i+he*d+Y*S+oe*J,t[2]=K*o+he*y+Y*O+oe*G,t[3]=K*s+he*x+Y*k+oe*H,K=r[4],he=r[5],Y=r[6],oe=r[7],t[4]=K*n+he*u+Y*E+oe*U,t[5]=K*i+he*d+Y*S+oe*J,t[6]=K*o+he*y+Y*O+oe*G,t[7]=K*s+he*x+Y*k+oe*H,K=r[8],he=r[9],Y=r[10],oe=r[11],t[8]=K*n+he*u+Y*E+oe*U,t[9]=K*i+he*d+Y*S+oe*J,t[10]=K*o+he*y+Y*O+oe*G,t[11]=K*s+he*x+Y*k+oe*H,K=r[12],he=r[13],Y=r[14],oe=r[15],t[12]=K*n+he*u+Y*E+oe*U,t[13]=K*i+he*d+Y*S+oe*J,t[14]=K*o+he*y+Y*O+oe*G,t[15]=K*s+he*x+Y*k+oe*H,t}function y2(t,e,r){var n=r[0],i=r[1],o=r[2],s,u,d,y,x,E,S,O,k,U,J,G;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[0],u=e[1],d=e[2],y=e[3],x=e[4],E=e[5],S=e[6],O=e[7],k=e[8],U=e[9],J=e[10],G=e[11],t[0]=s,t[1]=u,t[2]=d,t[3]=y,t[4]=x,t[5]=E,t[6]=S,t[7]=O,t[8]=k,t[9]=U,t[10]=J,t[11]=G,t[12]=s*n+x*i+k*o+e[12],t[13]=u*n+E*i+U*o+e[13],t[14]=d*n+S*i+J*o+e[14],t[15]=y*n+O*i+G*o+e[15]),t}function W4(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function uie(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],s=e[5],u=e[6],d=e[7],y=e[8],x=e[9],E=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+y*n,t[5]=s*i+x*n,t[6]=u*i+E*n,t[7]=d*i+S*n,t[8]=y*i-o*n,t[9]=x*i-s*n,t[10]=E*i-u*n,t[11]=S*i-d*n,t}function fie(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],s=e[1],u=e[2],d=e[3],y=e[4],x=e[5],E=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+y*n,t[1]=s*i+x*n,t[2]=u*i+E*n,t[3]=d*i+S*n,t[4]=y*i-o*n,t[5]=x*i-s*n,t[6]=E*i-u*n,t[7]=S*i-d*n,t}function hie(t,e,r,n,i){var o=1/Math.tan(e/2),s;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(s=1/(n-i),t[10]=(i+n)*s,t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t}var die=hie;function HI(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],u=t[5],d=t[6],y=t[7],x=t[8],E=t[9],S=t[10],O=t[11],k=t[12],U=t[13],J=t[14],G=t[15],H=e[0],K=e[1],he=e[2],Y=e[3],oe=e[4],Ee=e[5],ze=e[6],de=e[7],ve=e[8],Ae=e[9],$=e[10],re=e[11],Te=e[12],Qe=e[13],me=e[14],Le=e[15];return Math.abs(r-H)<=Qs*Math.max(1,Math.abs(r),Math.abs(H))&&Math.abs(n-K)<=Qs*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(i-he)<=Qs*Math.max(1,Math.abs(i),Math.abs(he))&&Math.abs(o-Y)<=Qs*Math.max(1,Math.abs(o),Math.abs(Y))&&Math.abs(s-oe)<=Qs*Math.max(1,Math.abs(s),Math.abs(oe))&&Math.abs(u-Ee)<=Qs*Math.max(1,Math.abs(u),Math.abs(Ee))&&Math.abs(d-ze)<=Qs*Math.max(1,Math.abs(d),Math.abs(ze))&&Math.abs(y-de)<=Qs*Math.max(1,Math.abs(y),Math.abs(de))&&Math.abs(x-ve)<=Qs*Math.max(1,Math.abs(x),Math.abs(ve))&&Math.abs(E-Ae)<=Qs*Math.max(1,Math.abs(E),Math.abs(Ae))&&Math.abs(S-$)<=Qs*Math.max(1,Math.abs(S),Math.abs($))&&Math.abs(O-re)<=Qs*Math.max(1,Math.abs(O),Math.abs(re))&&Math.abs(k-Te)<=Qs*Math.max(1,Math.abs(k),Math.abs(Te))&&Math.abs(U-Qe)<=Qs*Math.max(1,Math.abs(U),Math.abs(Qe))&&Math.abs(J-me)<=Qs*Math.max(1,Math.abs(J),Math.abs(me))&&Math.abs(G-Le)<=Qs*Math.max(1,Math.abs(G),Math.abs(Le))}function Aie(){var t=new AA(2);return AA!=Float32Array&&(t[0]=0,t[1]=0),t}function v2(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function pie(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function gie(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function mie(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function _ie(t,e){return t[0]=-e[0],t[1]=-e[1],t}function J4(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}var yie=pie;(function(){var t=Aie();return function(e,r,n,i,o,s){var u,d;for(r||(r=2),n||(n=0),i?d=Math.min(i*r+n,e.length):d=e.length,u=n;u<d;u+=r)t[0]=e[u],t[1]=e[u+1],o(t,t,s),e[u]=t[0],e[u+1]=t[1];return e}})();function vie(){var t=new AA(3);return AA!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bie(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function xie(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function wie(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}var Cie=xie;(function(){var t=vie();return function(e,r,n,i,o,s){var u,d;for(r||(r=3),n||(n=0),i?d=Math.min(i*r+n,e.length):d=e.length,u=n;u<d;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],o(t,t,s),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}})();function Ru(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const rc=Math.PI,X4=rc/4,jc=rc/180,b2=180/rc,tg=512,jI=4003e4,M0=85.051129,K4=1.5;function x2(t){return Math.pow(2,t)}function Tie(t){return pw(t)}function wu(t){const[e,r]=t;Ru(Number.isFinite(e)),Ru(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*jc,i=r*jc,o=tg*(n+rc)/(2*rc),s=tg*(rc+Math.log(Math.tan(X4+i*.5)))/(2*rc);return[o,s]}function Bu(t){const[e,r]=t,n=e/tg*(2*rc)-rc,i=2*(Math.atan(Math.exp(r/tg*(2*rc)-rc))-X4);return[n*b2,i*b2]}function Eie(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;Ru(Number.isFinite(e)&&Number.isFinite(r));const i=tg,o=Math.cos(e*jc),s=i/360,u=s/o,d=i/jI/o,y={unitsPerMeter:[d,d,d],metersPerUnit:[1/d,1/d,1/d],unitsPerDegree:[s,u,d],degreesPerUnit:[1/s,1/u,1/d]};if(n){const x=jc*Math.tan(e*jc)/o,E=s*x/2,S=i/jI*x,O=S/u*d;y.unitsPerDegree2=[0,E,S],y.unitsPerMeter2=[O,0,O]}return y}function Bie(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:o,center:s}=t,u=_m();y2(u,u,[0,0,-i]),uie(u,u,-r*jc),fie(u,u,n*jc);const d=o/e;return W4(u,u,[d,d,d]),s&&y2(u,u,wie([],s)),u}function Sie(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:o,center:s,scale:u,nearZMultiplier:d=1,farZMultiplier:y=1}=t;let{fovy:x=o_(K4)}=t;n!==void 0&&(x=o_(n));const E=x*jc,S=i*jc,O=q4(x);let k=O;s&&(k+=s[2]*u/Math.cos(S)/r);const U=E*(.5+(o?o[1]:0)/r),J=Math.sin(U)*k/Math.sin(_2(Math.PI/2-S-U,.01,Math.PI-.01)),G=Math.sin(S)*J+k,H=k*10,K=Math.min(G*y,H);return{fov:E,aspect:e/r,focalDistance:O,near:d,far:K}}function Iie(t){const{fov:e,aspect:r,near:n,far:i}=Sie(t);return die([],e,r,n,i)}function o_(t){return 2*Math.atan(.5/t)*b2}function q4(t){return .5/Math.tan(.5*t*jc)}function Mie(t,e){const[r,n,i=0]=t;return Ru(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),eA(e,[r,n,i,1])}function $I(t,e,r=0){const[n,i,o]=t;if(Ru(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return eA(e,[n,i,o,1]);const s=eA(e,[n,i,0,1]),u=eA(e,[n,i,1,1]),d=s[2],y=u[2],x=d===y?0:((r||0)-d)/(y-d);return J4([],s,u,x)}function Pie(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:s=[0,0]}=t,[[u,d],[y,x]]=n,E=Rie(t.padding),S=wu([u,_2(x,-M0,M0)]),O=wu([y,_2(d,-M0,M0)]),k=[Math.max(Math.abs(O[0]-S[0]),i),Math.max(Math.abs(O[1]-S[1]),i)],U=[e-E.left-E.right-Math.abs(s[0])*2,r-E.top-E.bottom-Math.abs(s[1])*2];Ru(U[0]>0&&U[1]>0);const J=U[0]/k[0],G=U[1]/k[1],H=(E.right-E.left)/2/J,K=(E.top-E.bottom)/2/G,he=[(O[0]+S[0])/2+H,(O[1]+S[1])/2+K],Y=Bu(he),oe=Math.min(o,pw(Math.abs(Math.min(J,G))));return Ru(Number.isFinite(oe)),{longitude:Y[0],latitude:Y[1],zoom:oe}}function Rie(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ru(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const WI=Math.PI/180;function Fie(t,e=0){const{width:r,height:n,unproject:i}=t,o={targetZ:e},s=i([0,n],o),u=i([r,n],o);let d,y;const x=t.fovy?.5*t.fovy*WI:Math.atan(.5/t.altitude),E=(90-t.pitch)*WI;return x>E-.01?(d=JI(t,0,e),y=JI(t,r,e)):(d=i([0,0],o),y=i([r,0],o)),[s,u,y,d]}function JI(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=eA(n,[e,0,1,1]),o=eA(n,[e,t.height,1,1]),u=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),d=J4([],i,o,u),y=Bu(d);return y.push(r),y}class $c{constructor(e={width:1,height:1}){vr(this,"latitude",void 0),vr(this,"longitude",void 0),vr(this,"zoom",void 0),vr(this,"pitch",void 0),vr(this,"bearing",void 0),vr(this,"altitude",void 0),vr(this,"fovy",void 0),vr(this,"meterOffset",void 0),vr(this,"center",void 0),vr(this,"width",void 0),vr(this,"height",void 0),vr(this,"scale",void 0),vr(this,"distanceScales",void 0),vr(this,"viewMatrix",void 0),vr(this,"projectionMatrix",void 0),vr(this,"viewProjectionMatrix",void 0),vr(this,"pixelProjectionMatrix",void 0),vr(this,"pixelUnprojectionMatrix",void 0),vr(this,"equals",G=>G instanceof $c?G.width===this.width&&G.height===this.height&&HI(G.projectionMatrix,this.projectionMatrix)&&HI(G.viewMatrix,this.viewMatrix):!1),vr(this,"project",(G,H={})=>{const{topLeft:K=!0}=H,he=this.projectPosition(G),Y=Mie(he,this.pixelProjectionMatrix),[oe,Ee]=Y,ze=K?Ee:this.height-Ee;return G.length===2?[oe,ze]:[oe,ze,Y[2]]}),vr(this,"unproject",(G,H={})=>{const{topLeft:K=!0,targetZ:he=void 0}=H,[Y,oe,Ee]=G,ze=K?oe:this.height-oe,de=he&&he*this.distanceScales.unitsPerMeter[2],ve=$I([Y,ze,Ee],this.pixelUnprojectionMatrix,de),[Ae,$,re]=this.unprojectPosition(ve);return Number.isFinite(Ee)?[Ae,$,re]:Number.isFinite(he)?[Ae,$,he]:[Ae,$]}),vr(this,"projectPosition",G=>{const[H,K]=wu(G),he=(G[2]||0)*this.distanceScales.unitsPerMeter[2];return[H,K,he]}),vr(this,"unprojectPosition",G=>{const[H,K]=Bu(G),he=(G[2]||0)*this.distanceScales.metersPerUnit[2];return[H,K,he]});let{width:r,height:n,altitude:i=null,fovy:o=null}=e;const{latitude:s=0,longitude:u=0,zoom:d=0,pitch:y=0,bearing:x=0,position:E=null,nearZMultiplier:S=.02,farZMultiplier:O=1.01}=e;r=r||1,n=n||1,o===null&&i===null?(i=K4,o=o_(i)):o===null?o=o_(i):i===null&&(i=q4(o));const k=x2(d);i=Math.max(.75,i);const U=Eie({longitude:u,latitude:s}),J=wu([u,s]);J.push(0),E&&bie(J,J,Cie([],E,U.unitsPerMeter)),this.projectionMatrix=Iie({width:r,height:n,scale:k,center:J,pitch:y,fovy:o,nearZMultiplier:S,farZMultiplier:O}),this.viewMatrix=Bie({height:n,scale:k,center:J,pitch:y,bearing:x,altitude:i}),this.width=r,this.height=n,this.scale=k,this.latitude=s,this.longitude=u,this.zoom=d,this.pitch=y,this.bearing=x,this.altitude=i,this.fovy=o,this.center=J,this.meterOffset=E||[0,0,0],this.distanceScales=U,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:r,projectionMatrix:n,viewMatrix:i}=this,o=_m();rb(o,o,n),rb(o,o,i),this.viewProjectionMatrix=o;const s=_m();W4(s,s,[e/2,-r/2,1]),y2(s,s,[1,-1,0]),rb(s,s,o);const u=lie(_m(),s);if(!u)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=u}projectFlat(e){return wu(e)}unprojectFlat(e){return Bu(e)}getMapCenterByLngLatPosition({lngLat:e,pos:r}){const n=$I(r,this.pixelUnprojectionMatrix),i=wu(e),o=v2([],i,_ie([],n)),s=v2([],this.center,o);return Bu(s)}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:o,latitude:s,zoom:u}=Pie(Object.assign({width:n,height:i,bounds:e},r));return new $c({width:n,height:i,longitude:o,latitude:s,zoom:u})}getBounds(e){const r=this.getBoundingRegion(e),n=Math.min(...r.map(u=>u[0])),i=Math.max(...r.map(u=>u[0])),o=Math.min(...r.map(u=>u[1])),s=Math.max(...r.map(u=>u[1]));return[[n,o],[i,s]]}getBoundingRegion(e={}){return Fie(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:r}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}}const XI=512;function Die(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:o,zoom:s,bearing:u=0}=t;(i<-180||i>180)&&(i=VI(i+180,360)-180),(u<-180||u>180)&&(u=VI(u+180,360)-180);const d=pw(r/XI);if(s<=d)s=d,o=0;else{const y=r/2/Math.pow(2,s),x=Bu([0,y])[1];if(o<x)o=x;else{const E=Bu([0,XI-y])[1];o>E&&(o=E)}}return{width:e,height:r,longitude:i,latitude:o,zoom:s,pitch:n,bearing:u}}const Y4=.01,Oie=["longitude","latitude","zoom"],Z4={curve:1.414,speed:1.2};function Lie(t,e,r,n){const{startZoom:i,startCenterXY:o,uDelta:s,w0:u,u1:d,S:y,rho:x,rho2:E,r0:S}=Q4(t,e,n);if(d<Y4){const he={};for(const Y of Oie){const oe=t[Y],Ee=e[Y];he[Y]=aie(oe,Ee,r)}return he}const O=r*y,k=Math.cosh(S)/Math.cosh(S+x*O),U=u*((Math.cosh(S)*Math.tanh(S+x*O)-Math.sinh(S))/E)/d,J=1/k,G=i+Tie(J),H=gie([],s,U);v2(H,H,o);const K=Bu(H);return{longitude:K[0],latitude:K[1],zoom:G}}function Nie(t,e,r){const n={...Z4,...r},{screenSpeed:i,speed:o,maxDuration:s}=n,{S:u,rho:d}=Q4(t,e,n),y=1e3*u;let x;return Number.isFinite(i)?x=y/(i/d):x=y/o,Number.isFinite(s)&&x>s?0:x}function Q4(t,e,r){r=Object.assign({},Z4,r);const n=r.curve,i=t.zoom,o=[t.longitude,t.latitude],s=x2(i),u=e.zoom,d=[e.longitude,e.latitude],y=x2(u-i),x=wu(o),E=wu(d),S=yie([],E,x),O=Math.max(t.width,t.height),k=O/y,U=mie(S)*s,J=Math.max(U,Y4),G=n*n,H=(k*k-O*O+G*G*J*J)/(2*O*G*J),K=(k*k-O*O-G*G*J*J)/(2*k*G*J),he=Math.log(Math.sqrt(H*H+1)-H),Y=Math.log(Math.sqrt(K*K+1)-K),oe=(Y-he)/n;return{startZoom:i,startCenterXY:x,uDelta:S,w0:O,u1:U,S:oe,rho:n,rho2:G,r0:he,r1:Y}}var Tl=typeof document<"u"?document:{};function KI(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function P0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?KI(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):KI(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function qI(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=kie(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(y){throw y},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,u;return{s:function(){r=t[Symbol.iterator]()},n:function(){var y=r.next();return o=y.done,y},e:function(y){s=!0,u=y},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw u}}}}function kie(t,e){if(t){if(typeof t=="string")return YI(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return YI(t,e)}}function YI(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Uie=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function nb(t){if(!t)return null;if(typeof t=="string")return t;t.toJS&&(t=t.toJS());var e={},r=qI(t.layers),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;e[i.id]=i}}catch(s){r.e(s)}finally{r.f()}var o=t.layers.map(function(s){var u=e[s.ref],d=null;if("interactive"in s&&(d=P0({},s),delete d.interactive),u){d=d||P0({},s),delete d.ref;var y=qI(Uie),x;try{for(y.s();!(x=y.n()).done;){var E=x.value;E in u&&(d[E]=u[E])}}catch(S){y.e(S)}finally{y.f()}}return d||s});return P0(P0({},t),{},{layers:o})}var ZI={};function zie(){}function Gie(t){t&&console.error(t.error)}var e6={container:ht.object,gl:ht.object,mapboxApiAccessToken:ht.string,mapboxApiUrl:ht.string,attributionControl:ht.bool,preserveDrawingBuffer:ht.bool,reuseMaps:ht.bool,transformRequest:ht.func,mapOptions:ht.object,mapStyle:ht.oneOfType([ht.string,ht.object]),preventStyleDiffing:ht.bool,visible:ht.bool,asyncRender:ht.bool,onLoad:ht.func,onError:ht.func,width:ht.number,height:ht.number,viewState:ht.object,longitude:ht.number,latitude:ht.number,zoom:ht.number,bearing:ht.number,pitch:ht.number,altitude:ht.number},ym={container:Tl.body,mapboxApiAccessToken:Vie(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:zie,onError:Gie,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Vie(){var t=null;if(typeof window<"u"&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);t=e&&e[1]}return!t&&typeof process<"u"&&(t=t||ZI.MapboxAccessToken||ZI.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function QI(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&ht.checkPropTypes(e6,t,"prop",e)}var rh=function(){function t(e){var r=this;if(Nu(this,t),vr(this,"props",ym),vr(this,"width",0),vr(this,"height",0),vr(this,"_fireLoadEvent",function(){r.props.onLoad({type:"load",target:r._map})}),vr(this,"_handleError",function(n){r.props.onError(n)}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Lu(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(r){return this._update(this.props,r),this}},{key:"redraw",value:function(){var r=this._map;r.style&&(r._frame&&(r._frame.cancel(),r._frame=null),r._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(r){this._map=t.savedMap;var n=this._map.getContainer(),i=r.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,r.mapStyle&&this._map.setStyle(nb(r.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(r){if(r.reuseMaps&&t.savedMap)this._reuse(r);else{if(r.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,r.gl}}var i={container:r.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:nb(r.mapStyle),interactive:!1,trackResize:!1,attributionControl:r.attributionControl,preserveDrawingBuffer:r.preserveDrawingBuffer};r.transformRequest&&(i.transformRequest=r.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,r.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!t.savedMap?(t.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(r){var n=this;r=Object.assign({},ym,r),QI(r,"Mapbox"),this.mapboxgl.accessToken=r.mapboxApiAccessToken||ym.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=r.mapboxApiUrl,this._create(r);var i=r,o=i.container;Object.defineProperty(o,"offsetWidth",{configurable:!0,get:function(){return n.width}}),Object.defineProperty(o,"clientWidth",{configurable:!0,get:function(){return n.width}}),Object.defineProperty(o,"offsetHeight",{configurable:!0,get:function(){return n.height}}),Object.defineProperty(o,"clientHeight",{configurable:!0,get:function(){return n.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},r),this._updateMapSize({},r),this.props=r}},{key:"_update",value:function(r,n){if(this._map){n=Object.assign({},this.props,n),QI(n,"Mapbox");var i=this._updateMapViewport(r,n),o=this._updateMapSize(r,n);this._updateMapStyle(r,n),!n.asyncRender&&(i||o)&&this.redraw(),this.props=n}}},{key:"_updateMapStyle",value:function(r,n){var i=r.mapStyle!==n.mapStyle;i&&this._map.setStyle(nb(n.mapStyle),{diff:!n.preventStyleDiffing})}},{key:"_updateMapSize",value:function(r,n){var i=r.width!==n.width||r.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this._map.resize()),i}},{key:"_updateMapViewport",value:function(r,n){var i=this._getViewState(r),o=this._getViewState(n),s=o.latitude!==i.latitude||o.longitude!==i.longitude||o.zoom!==i.zoom||o.pitch!==i.pitch||o.bearing!==i.bearing||o.altitude!==i.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(o)),o.altitude!==i.altitude&&(this._map.transform.altitude=o.altitude)),s}},{key:"_getViewState",value:function(r){var n=r.viewState||r,i=n.longitude,o=n.latitude,s=n.zoom,u=n.pitch,d=u===void 0?0:u,y=n.bearing,x=y===void 0?0:y,E=n.altitude,S=E===void 0?1.5:E;return{longitude:i,latitude:o,zoom:s,pitch:d,bearing:x,altitude:S}}},{key:"_checkStyleSheet",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Tl>"u"))try{var n=Tl.createElement("div");n.className="mapboxgl-map",n.style.display="none",Tl.body.appendChild(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var o=Tl.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(r,"/mapbox-gl.css")),Tl.head.appendChild(o)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(r){return{center:[r.longitude,r.latitude],zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}}}]),t}();vr(rh,"initialized",!1);vr(rh,"propTypes",e6);vr(rh,"defaultProps",ym);vr(rh,"savedMap",null);var vm={exports:{}},Hie=vm.exports,e3;function jie(){return e3||(e3=1,function(t,e){(function(r,n){t.exports=n()})(Hie,function(){var r,n,i;function o(s,u){if(!r)r=u;else if(!n)n=u;else{var d="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",y={};r(y),i=u(y),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([d],{type:"text/javascript"})))}}return o(["exports"],function(s){function u(a,l){return a(l={exports:{}},l.exports),l.exports}var d=y;function y(a,l,A,b){this.cx=3*a,this.bx=3*(A-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(b-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=b,this.p2x=A,this.p2y=b}y.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},y.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},y.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},y.prototype.solveCurveX=function(a,l){var A,b,T,I,F;for(l===void 0&&(l=1e-6),T=a,F=0;F<8;F++){if(I=this.sampleCurveX(T)-a,Math.abs(I)<l)return T;var N=this.sampleCurveDerivativeX(T);if(Math.abs(N)<1e-6)break;T-=I/N}if((T=a)<(A=0))return A;if(T>(b=1))return b;for(;A<b;){if(I=this.sampleCurveX(T),Math.abs(I-a)<l)return T;a>I?A=T:b=T,T=.5*(b-A)+A}return T},y.prototype.solve=function(a,l){return this.sampleCurveY(this.solveCurveX(a,l))};var x=E;function E(a,l){this.x=a,this.y=l}E.prototype={clone:function(){return new E(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,l){return this.clone()._rotateAround(a,l)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var l=a.x-this.x,A=a.y-this.y;return l*l+A*A},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,l){return Math.atan2(this.x*l-this.y*a,this.x*a+this.y*l)},_matMult:function(a){var l=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=l,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var l=Math.cos(a),A=Math.sin(a),b=A*this.x+l*this.y;return this.x=l*this.x-A*this.y,this.y=b,this},_rotateAround:function(a,l){var A=Math.cos(a),b=Math.sin(a),T=l.y+b*(this.x-l.x)+A*(this.y-l.y);return this.x=l.x+A*(this.x-l.x)-b*(this.y-l.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},E.convert=function(a){return a instanceof E?a:Array.isArray(a)?new E(a[0],a[1]):a};var S=typeof self<"u"?self:{},O=Math.pow(2,53)-1;function k(a,l,A,b){var T=new d(a,l,A,b);return function(I){return T.solve(I)}}var U=k(.25,.1,.25,1);function J(a,l,A){return Math.min(A,Math.max(l,a))}function G(a,l,A){var b=A-l,T=((a-l)%b+b)%b+l;return T===l?A:T}function H(a){for(var l=[],A=arguments.length-1;A-- >0;)l[A]=arguments[A+1];for(var b=0,T=l;b<T.length;b+=1){var I=T[b];for(var F in I)a[F]=I[F]}return a}var K=1;function he(){return K++}function Y(){return function a(l){return l?(l^16*Math.random()>>l/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function oe(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Ee(a,l){a.forEach(function(A){l[A]&&(l[A]=l[A].bind(l))})}function ze(a,l){return a.indexOf(l,a.length-l.length)!==-1}function de(a,l,A){var b={};for(var T in a)b[T]=l.call(A||this,a[T],T,a);return b}function ve(a,l,A){var b={};for(var T in a)l.call(A||this,a[T],T,a)&&(b[T]=a[T]);return b}function Ae(a){return Array.isArray(a)?a.map(Ae):typeof a=="object"&&a?de(a,Ae):a}var $={};function re(a){$[a]||(typeof console<"u"&&console.warn(a),$[a]=!0)}function Te(a,l,A){return(A.y-a.y)*(l.x-a.x)>(l.y-a.y)*(A.x-a.x)}function Qe(a){for(var l=0,A=0,b=a.length,T=b-1,I=void 0,F=void 0;A<b;T=A++)l+=((F=a[T]).x-(I=a[A]).x)*(I.y+F.y);return l}function me(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Le(a){var l={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(b,T,I,F){var N=I||F;return l[T]=!N||N.toLowerCase(),""}),l["max-age"]){var A=parseInt(l["max-age"],10);isNaN(A)?delete l["max-age"]:l["max-age"]=A}return l}var Ue=null;function Ye(a){if(Ue==null){var l=a.navigator?a.navigator.userAgent:null;Ue=!!a.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ue}function et(a){try{var l=S[a];return l.setItem("_mapbox_test_",1),l.removeItem("_mapbox_test_"),!0}catch{return!1}}var tt,ct,mt,Tt,nt=S.performance&&S.performance.now?S.performance.now.bind(S.performance):Date.now.bind(Date),lr=S.requestAnimationFrame||S.mozRequestAnimationFrame||S.webkitRequestAnimationFrame||S.msRequestAnimationFrame,qt=S.cancelAnimationFrame||S.mozCancelAnimationFrame||S.webkitCancelAnimationFrame||S.msCancelAnimationFrame,$t={now:nt,frame:function(a){var l=lr(a);return{cancel:function(){return qt(l)}}},getImageData:function(a,l){l===void 0&&(l=0);var A=S.document.createElement("canvas"),b=A.getContext("2d");if(!b)throw new Error("failed to create canvas 2d context");return A.width=a.width,A.height=a.height,b.drawImage(a,0,0,a.width,a.height),b.getImageData(-l,-l,a.width+2*l,a.height+2*l)},resolveURL:function(a){return tt||(tt=S.document.createElement("a")),tt.href=a,tt.href},hardwareConcurrency:S.navigator&&S.navigator.hardwareConcurrency||4,get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(ct==null&&(ct=S.matchMedia("(prefers-reduced-motion: reduce)")),ct.matches)}},Ot={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},fr={supported:!1,testSupport:function(a){!rn&&Tt&&(Er?mr(a):mt=a)}},rn=!1,Er=!1;function mr(a){var l=a.createTexture();a.bindTexture(a.TEXTURE_2D,l);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Tt),a.isContextLost())return;fr.supported=!0}catch{}a.deleteTexture(l),rn=!0}S.document&&((Tt=S.document.createElement("img")).onload=function(){mt&&mr(mt),mt=null,Er=!0},Tt.onerror=function(){rn=!0,mt=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ln="01",dr=function(a,l){this._transformRequestFn=a,this._customAccessToken=l,this._createSkuToken()};function Ar(a){return a.indexOf("mapbox:")===0}dr.prototype._createSkuToken=function(){var a=function(){for(var l="",A=0;A<10;A++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ln,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},dr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},dr.prototype.transformRequest=function(a,l){return this._transformRequestFn&&this._transformRequestFn(a,l)||{url:a}},dr.prototype.normalizeStyleURL=function(a,l){if(!Ar(a))return a;var A=jn(a);return A.path="/styles/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||l)},dr.prototype.normalizeGlyphsURL=function(a,l){if(!Ar(a))return a;var A=jn(a);return A.path="/fonts/v1"+A.path,this._makeAPIURL(A,this._customAccessToken||l)},dr.prototype.normalizeSourceURL=function(a,l){if(!Ar(a))return a;var A=jn(a);return A.path="/v4/"+A.authority+".json",A.params.push("secure"),this._makeAPIURL(A,this._customAccessToken||l)},dr.prototype.normalizeSpriteURL=function(a,l,A,b){var T=jn(a);return Ar(a)?(T.path="/styles/v1"+T.path+"/sprite"+l+A,this._makeAPIURL(T,this._customAccessToken||b)):(T.path+=""+l+A,fn(T))},dr.prototype.normalizeTileURL=function(a,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Ar(a))return a;var A=jn(a);A.path=A.path.replace(/(\.(png|jpg)\d*)(?=$)/,($t.devicePixelRatio>=2||l===512?"@2x":"")+(fr.supported?".webp":"$1")),A.path=A.path.replace(/^.+\/v4\//,"/"),A.path="/v4"+A.path;var b=this._customAccessToken||function(T){for(var I=0,F=T;I<F.length;I+=1){var N=F[I].match(/^access_token=(.*)$/);if(N)return N[1]}return null}(A.params)||Ot.ACCESS_TOKEN;return Ot.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&A.params.push("sku="+this._skuToken),this._makeAPIURL(A,b)},dr.prototype.canonicalizeTileURL=function(a,l){var A=jn(a);if(!A.path.match(/(^\/v4\/)/)||!A.path.match(/\.[\w]+$/))return a;var b="mapbox://tiles/";b+=A.path.replace("/v4/","");var T=A.params;return l&&(T=T.filter(function(I){return!I.match(/^access_token=/)})),T.length&&(b+="?"+T.join("&")),b},dr.prototype.canonicalizeTileset=function(a,l){for(var A=!!l&&Ar(l),b=[],T=0,I=a.tiles||[];T<I.length;T+=1){var F=I[T];Ir(F)?b.push(this.canonicalizeTileURL(F,A)):b.push(F)}return b},dr.prototype._makeAPIURL=function(a,l){var A="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",b=jn(Ot.API_URL);if(a.protocol=b.protocol,a.authority=b.authority,a.protocol==="http"){var T=a.params.indexOf("secure");T>=0&&a.params.splice(T,1)}if(b.path!=="/"&&(a.path=""+b.path+a.path),!Ot.REQUIRE_ACCESS_TOKEN)return fn(a);if(!(l=l||Ot.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+A);if(l[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+A);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+l),fn(a)};var nn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ir(a){return nn.test(a)}var ei=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function jn(a){var l=a.match(ei);if(!l)throw new Error("Unable to parse URL object");return{protocol:l[1],authority:l[2],path:l[3]||"/",params:l[4]?l[4].split("&"):[]}}function fn(a){var l=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+l}function Jn(a){if(!a)return null;var l=a.split(".");if(!l||l.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(l[1]).split("").map(function(A){return"%"+("00"+A.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Nn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Nn.prototype.getStorageKey=function(a){var l,A=Jn(Ot.ACCESS_TOKEN);return l=A&&A.u?S.btoa(encodeURIComponent(A.u).replace(/%([0-9A-F]{2})/g,function(b,T){return String.fromCharCode(+("0x"+T))})):Ot.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+l:"mapbox.eventData:"+l},Nn.prototype.fetchEventData=function(){var a=et("localStorage"),l=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{var b=S.localStorage.getItem(l);b&&(this.eventData=JSON.parse(b));var T=S.localStorage.getItem(A);T&&(this.anonId=T)}catch{re("Unable to read from LocalStorage")}},Nn.prototype.saveEventData=function(){var a=et("localStorage"),l=this.getStorageKey(),A=this.getStorageKey("uuid");if(a)try{S.localStorage.setItem(A,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{re("Unable to write to LocalStorage")}},Nn.prototype.processRequests=function(a){},Nn.prototype.postEvent=function(a,l,A,b){var T=this;if(Ot.EVENTS_URL){var I=jn(Ot.EVENTS_URL);I.params.push("access_token="+(b||Ot.ACCESS_TOKEN||""));var F={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Ln,userId:this.anonId},N=l?H(F,l):F,V={url:fn(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([N])};this.pendingRequest=at(V,function(X){T.pendingRequest=null,A(X),T.saveEventData(),T.processRequests(b)})}},Nn.prototype.queueRequest=function(a,l){this.queue.push(a),this.processRequests(l)};var bn,$n,kt=function(a){function l(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.postMapLoadEvent=function(A,b,T,I){this.skuToken=T;var F=!(!I&&!Ot.ACCESS_TOKEN),N=Array.isArray(A)&&A.some(function(V){return Ar(V)||Ir(V)});Ot.EVENTS_URL&&F&&N&&this.queueRequest({id:b,timestamp:Date.now()},I)},l.prototype.processRequests=function(A){var b=this;if(!this.pendingRequest&&this.queue.length!==0){var T=this.queue.shift(),I=T.id,F=T.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),oe(this.anonId)||(this.anonId=Y()),this.postEvent(F,{skuToken:this.skuToken},function(N){N||I&&(b.success[I]=!0)},A))}},l}(Nn),hr=new(function(a){function l(A){a.call(this,"appUserTurnstile"),this._customAccessToken=A}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.postTurnstileEvent=function(A,b){Ot.EVENTS_URL&&Ot.ACCESS_TOKEN&&Array.isArray(A)&&A.some(function(T){return Ar(T)||Ir(T)})&&this.queueRequest(Date.now(),b)},l.prototype.processRequests=function(A){var b=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var T=Jn(Ot.ACCESS_TOKEN),I=T?T.u:Ot.ACCESS_TOKEN,F=I!==this.eventData.tokenU;oe(this.anonId)||(this.anonId=Y(),F=!0);var N=this.queue.shift();if(this.eventData.lastSuccess){var V=new Date(this.eventData.lastSuccess),X=new Date(N),Q=(N-this.eventData.lastSuccess)/864e5;F=F||Q>=1||Q<-1||V.getDate()!==X.getDate()}else F=!0;if(!F)return this.processRequests();this.postEvent(N,{"enabled.telemetry":!1},function(ie){ie||(b.eventData.lastSuccess=N,b.eventData.tokenU=I)},A)}},l}(Nn)),Br=hr.postTurnstileEvent.bind(hr),Zr=new kt,ui=Zr.postMapLoadEvent.bind(Zr),Me=500,Dt=50;function Gt(){S.caches&&!bn&&(bn=S.caches.open("mapbox-tiles"))}function sr(a){var l=a.indexOf("?");return l<0?a:a.slice(0,l)}var qe,It=1/0;function pe(){return qe==null&&(qe=S.OffscreenCanvas&&new S.OffscreenCanvas(1,1).getContext("2d")&&typeof S.createImageBitmap=="function"),qe}var Nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Nt);var xt=function(a){function l(A,b,T){b===401&&Ir(T)&&(A+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,A),this.status=b,this.url=T,this.name=this.constructor.name,this.message=A}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},l}(Error),j=me()?function(){return self.worker&&self.worker.referrer}:function(){return(S.location.protocol==="blob:"?S.parent:S).location.href},_t,Ct,Ce=function(a,l){if(!(/^file:/.test(A=a.url)||/^file:/.test(j())&&!/^\w+:/.test(A))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(b,T){var I,F=new S.AbortController,N=new S.Request(b.url,{method:b.method||"GET",body:b.body,credentials:b.credentials,headers:b.headers,referrer:j(),signal:F.signal}),V=!1,X=!1,Q=(I=N.url).indexOf("sku=")>0&&Ir(I);b.type==="json"&&N.headers.set("Accept","application/json");var ie=function(_e,Ne,ke){if(!X){if(_e&&_e.message!=="SecurityError"&&re(_e),Ne&&ke)return ue(Ne);var He=Date.now();S.fetch(N).then(function(Ge){if(Ge.ok){var Ke=Q?Ge.clone():null;return ue(Ge,Ke,He)}return T(new xt(Ge.statusText,Ge.status,b.url))}).catch(function(Ge){Ge.code!==20&&T(new Error(Ge.message))})}},ue=function(_e,Ne,ke){(b.type==="arrayBuffer"?_e.arrayBuffer():b.type==="json"?_e.json():_e.text()).then(function(He){X||(Ne&&ke&&function(Ge,Ke,ot){if(Gt(),bn){var At={status:Ke.status,statusText:Ke.statusText,headers:new S.Headers};Ke.headers.forEach(function(Mt,zt){return At.headers.set(zt,Mt)});var gt=Le(Ke.headers.get("Cache-Control")||"");gt["no-store"]||(gt["max-age"]&&At.headers.set("Expires",new Date(ot+1e3*gt["max-age"]).toUTCString()),new Date(At.headers.get("Expires")).getTime()-ot<42e4||function(Mt,zt){if($n===void 0)try{new Response(new ReadableStream),$n=!0}catch{$n=!1}$n?zt(Mt.body):Mt.blob().then(zt)}(Ke,function(Mt){var zt=new S.Response(Mt,At);Gt(),bn&&bn.then(function(Wt){return Wt.put(sr(Ge.url),zt)}).catch(function(Wt){return re(Wt.message)})}))}}(N,Ne,ke),V=!0,T(null,He,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(function(He){X||T(new Error(He.message))})};return Q?function(_e,Ne){if(Gt(),!bn)return Ne(null);var ke=sr(_e.url);bn.then(function(He){He.match(ke).then(function(Ge){var Ke=function(ot){if(!ot)return!1;var At=new Date(ot.headers.get("Expires")||0),gt=Le(ot.headers.get("Cache-Control")||"");return At>Date.now()&&!gt["no-cache"]}(Ge);He.delete(ke),Ke&&He.put(ke,Ge.clone()),Ne(null,Ge,Ke)}).catch(Ne)}).catch(Ne)}(N,ie):ie(null,null),{cancel:function(){X=!0,V||F.abort()}}}(a,l);if(me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,l,void 0,!0)}var A;return function(b,T){var I=new S.XMLHttpRequest;for(var F in I.open(b.method||"GET",b.url,!0),b.type==="arrayBuffer"&&(I.responseType="arraybuffer"),b.headers)I.setRequestHeader(F,b.headers[F]);return b.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=b.credentials==="include",I.onerror=function(){T(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var N=I.response;if(b.type==="json")try{N=JSON.parse(I.response)}catch(V){return T(V)}T(null,N,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else T(new xt(I.statusText,I.status,b.url))},I.send(b.body),{cancel:function(){return I.abort()}}}(a,l)},We=function(a,l){return Ce(H(a,{type:"arrayBuffer"}),l)},at=function(a,l){return Ce(H(a,{method:"POST"}),l)},q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";_t=[],Ct=0;var ne=function(a,l){if(fr.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Ct>=Ot.MAX_PARALLEL_IMAGE_REQUESTS){var A={requestParameters:a,callback:l,cancelled:!1,cancel:function(){this.cancelled=!0}};return _t.push(A),A}Ct++;var b=!1,T=function(){if(!b)for(b=!0,Ct--;_t.length&&Ct<Ot.MAX_PARALLEL_IMAGE_REQUESTS;){var F=_t.shift();F.cancelled||(F.cancel=ne(F.requestParameters,F.callback).cancel)}},I=We(a,function(F,N,V,X){T(),F?l(F):N&&(pe()?function(Q,ie){var ue=new S.Blob([new Uint8Array(Q)],{type:"image/png"});S.createImageBitmap(ue).then(function(_e){ie(null,_e)}).catch(function(_e){ie(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(N,l):function(Q,ie,ue,_e){var Ne=new S.Image,ke=S.URL;Ne.onload=function(){ie(null,Ne),ke.revokeObjectURL(Ne.src),Ne.onload=null,S.requestAnimationFrame(function(){Ne.src=q})},Ne.onerror=function(){return ie(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var He=new S.Blob([new Uint8Array(Q)],{type:"image/png"});Ne.cacheControl=ue,Ne.expires=_e,Ne.src=Q.byteLength?ke.createObjectURL(He):q}(N,l,V,X))});return{cancel:function(){I.cancel(),T()}}};function le(a,l,A){A[a]&&A[a].indexOf(l)!==-1||(A[a]=A[a]||[],A[a].push(l))}function ye(a,l,A){if(A&&A[a]){var b=A[a].indexOf(l);b!==-1&&A[a].splice(b,1)}}var De=function(a,l){l===void 0&&(l={}),H(this,l),this.type=a},fe=function(a){function l(A,b){b===void 0&&(b={}),a.call(this,"error",H({error:A},b))}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l}(De),be=function(){};be.prototype.on=function(a,l){return this._listeners=this._listeners||{},le(a,l,this._listeners),this},be.prototype.off=function(a,l){return ye(a,l,this._listeners),ye(a,l,this._oneTimeListeners),this},be.prototype.once=function(a,l){return this._oneTimeListeners=this._oneTimeListeners||{},le(a,l,this._oneTimeListeners),this},be.prototype.fire=function(a,l){typeof a=="string"&&(a=new De(a,l||{}));var A=a.type;if(this.listens(A)){a.target=this;for(var b=0,T=this._listeners&&this._listeners[A]?this._listeners[A].slice():[];b<T.length;b+=1)T[b].call(this,a);for(var I=0,F=this._oneTimeListeners&&this._oneTimeListeners[A]?this._oneTimeListeners[A].slice():[];I<F.length;I+=1){var N=F[I];ye(A,N,this._oneTimeListeners),N.call(this,a)}var V=this._eventedParent;V&&(H(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(a))}else a instanceof fe&&console.error(a.error);return this},be.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},be.prototype.setEventedParent=function(a,l){return this._eventedParent=a,this._eventedParentData=l,this};var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Be=function(a,l,A,b){this.message=(a?a+": ":"")+A,b&&(this.identifier=b),l!=null&&l.__line__&&(this.line=l.__line__)};function p(a){var l=a.value;return l?[new Be(a.key,l,"constants have been deprecated as of v8")]:[]}function ce(a){for(var l=[],A=arguments.length-1;A-- >0;)l[A]=arguments[A+1];for(var b=0,T=l;b<T.length;b+=1){var I=T[b];for(var F in I)a[F]=I[F]}return a}function yt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Xe(a){if(Array.isArray(a))return a.map(Xe);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var l={};for(var A in a)l[A]=Xe(a[A]);return l}return yt(a)}var wt=function(a){function l(A,b){a.call(this,b),this.message=b,this.key=A}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l}(Error),St=function(a,l){l===void 0&&(l=[]),this.parent=a,this.bindings={};for(var A=0,b=l;A<b.length;A+=1){var T=b[A];this.bindings[T[0]]=T[1]}};St.prototype.concat=function(a){return new St(this,a)},St.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},St.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Rt={kind:"null"},lt={kind:"number"},Ft={kind:"string"},Bt={kind:"boolean"},Ut={kind:"color"},Dr={kind:"object"},Kt={kind:"value"},Kr={kind:"collator"},tn={kind:"formatted"},Gr={kind:"resolvedImage"};function Vr(a,l){return{kind:"array",itemType:a,N:l}}function Nr(a){if(a.kind==="array"){var l=Nr(a.itemType);return typeof a.N=="number"?"array<"+l+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+l+">"}return a.kind}var fi=[Rt,lt,Ft,Bt,Ut,tn,Dr,Vr(Kt),Gr];function Hr(a,l){if(l.kind==="error")return null;if(a.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Hr(a.itemType,l.itemType))&&(typeof a.N!="number"||a.N===l.N))return null}else{if(a.kind===l.kind)return null;if(a.kind==="value"){for(var A=0,b=fi;A<b.length;A+=1)if(!Hr(b[A],l))return null}}return"Expected "+Nr(a)+" but found "+Nr(l)+" instead."}function ur(a,l){return l.some(function(A){return A.kind===a.kind})}function Ie(a,l){return l.some(function(A){return A==="null"?a===null:A==="array"?Array.isArray(a):A==="object"?a&&!Array.isArray(a)&&typeof a=="object":A===typeof a})}var jt=u(function(a,l){var A={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function b(N){return(N=Math.round(N))<0?0:N>255?255:N}function T(N){return b(N[N.length-1]==="%"?parseFloat(N)/100*255:parseInt(N))}function I(N){return(V=N[N.length-1]==="%"?parseFloat(N)/100:parseFloat(N))<0?0:V>1?1:V;var V}function F(N,V,X){return X<0?X+=1:X>1&&(X-=1),6*X<1?N+(V-N)*X*6:2*X<1?V:3*X<2?N+(V-N)*(2/3-X)*6:N}try{l.parseCSSColor=function(N){var V,X=N.replace(/ /g,"").toLowerCase();if(X in A)return A[X].slice();if(X[0]==="#")return X.length===4?(V=parseInt(X.substr(1),16))>=0&&V<=4095?[(3840&V)>>4|(3840&V)>>8,240&V|(240&V)>>4,15&V|(15&V)<<4,1]:null:X.length===7&&(V=parseInt(X.substr(1),16))>=0&&V<=16777215?[(16711680&V)>>16,(65280&V)>>8,255&V,1]:null;var Q=X.indexOf("("),ie=X.indexOf(")");if(Q!==-1&&ie+1===X.length){var ue=X.substr(0,Q),_e=X.substr(Q+1,ie-(Q+1)).split(","),Ne=1;switch(ue){case"rgba":if(_e.length!==4)return null;Ne=I(_e.pop());case"rgb":return _e.length!==3?null:[T(_e[0]),T(_e[1]),T(_e[2]),Ne];case"hsla":if(_e.length!==4)return null;Ne=I(_e.pop());case"hsl":if(_e.length!==3)return null;var ke=(parseFloat(_e[0])%360+360)%360/360,He=I(_e[1]),Ge=I(_e[2]),Ke=Ge<=.5?Ge*(He+1):Ge+He-Ge*He,ot=2*Ge-Ke;return[b(255*F(ot,Ke,ke+1/3)),b(255*F(ot,Ke,ke)),b(255*F(ot,Ke,ke-1/3)),Ne];default:return null}}return null}}catch{}}).parseCSSColor,qr=function(a,l,A,b){b===void 0&&(b=1),this.r=a,this.g=l,this.b=A,this.a=b};qr.parse=function(a){if(a){if(a instanceof qr)return a;if(typeof a=="string"){var l=jt(a);if(l)return new qr(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3])}}},qr.prototype.toString=function(){var a=this.toArray(),l=a[1],A=a[2],b=a[3];return"rgba("+Math.round(a[0])+","+Math.round(l)+","+Math.round(A)+","+b+")"},qr.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},qr.black=new qr(0,0,0,1),qr.white=new qr(1,1,1,1),qr.transparent=new qr(0,0,0,0),qr.red=new qr(1,0,0,1);var Ni=function(a,l,A){this.sensitivity=a?l?"variant":"case":l?"accent":"base",this.locale=A,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ni.prototype.compare=function(a,l){return this.collator.compare(a,l)},Ni.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ia=function(a,l,A,b,T){this.text=a,this.image=l,this.scale=A,this.fontStack=b,this.textColor=T},ti=function(a){this.sections=a};ti.fromString=function(a){return new ti([new ia(a,null,null,null,null)])},ti.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ti.factory=function(a){return a instanceof ti?a:ti.fromString(a)},ti.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ti.prototype.serialize=function(){for(var a=["format"],l=0,A=this.sections;l<A.length;l+=1){var b=A[l];if(b.image)a.push(["image",b.image.name]);else{a.push(b.text);var T={};b.fontStack&&(T["text-font"]=["literal",b.fontStack.split(",")]),b.scale&&(T["font-scale"]=b.scale),b.textColor&&(T["text-color"]=["rgba"].concat(b.textColor.toArray())),a.push(T)}}return a};var kn=function(a){this.name=a.name,this.available=a.available};function Se(a,l,A,b){return typeof a=="number"&&a>=0&&a<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof A=="number"&&A>=0&&A<=255?b===void 0||typeof b=="number"&&b>=0&&b<=1?null:"Invalid rgba value ["+[a,l,A,b].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof b=="number"?[a,l,A,b]:[a,l,A]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Po(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof qr||a instanceof Ni||a instanceof ti||a instanceof kn)return!0;if(Array.isArray(a)){for(var l=0,A=a;l<A.length;l+=1)if(!Po(A[l]))return!1;return!0}if(typeof a=="object"){for(var b in a)if(!Po(a[b]))return!1;return!0}return!1}function Un(a){if(a===null)return Rt;if(typeof a=="string")return Ft;if(typeof a=="boolean")return Bt;if(typeof a=="number")return lt;if(a instanceof qr)return Ut;if(a instanceof Ni)return Kr;if(a instanceof ti)return tn;if(a instanceof kn)return Gr;if(Array.isArray(a)){for(var l,A=a.length,b=0,T=a;b<T.length;b+=1){var I=Un(T[b]);if(l){if(l===I)continue;l=Kt;break}l=I}return Vr(l||Kt,A)}return Dr}function Ro(a){var l=typeof a;return a===null?"":l==="string"||l==="number"||l==="boolean"?String(a):a instanceof qr||a instanceof ti||a instanceof kn?a.toString():JSON.stringify(a)}kn.prototype.toString=function(){return this.name},kn.fromString=function(a){return a?new kn({name:a,available:!1}):null},kn.prototype.serialize=function(){return["image",this.name]};var Bi=function(a,l){this.type=a,this.value=l};Bi.parse=function(a,l){if(a.length!==2)return l.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Po(a[1]))return l.error("invalid value");var A=a[1],b=Un(A),T=l.expectedType;return b.kind!=="array"||b.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(b=T),new Bi(b,A)},Bi.prototype.evaluate=function(){return this.value},Bi.prototype.eachChild=function(){},Bi.prototype.outputDefined=function(){return!0},Bi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof qr?["rgba"].concat(this.value.toArray()):this.value instanceof ti?this.value.serialize():this.value};var ri=function(a){this.name="ExpressionEvaluationError",this.message=a};ri.prototype.toJSON=function(){return this.message};var bi={string:Ft,number:lt,boolean:Bt,object:Dr},En=function(a,l){this.type=a,this.args=l};En.parse=function(a,l){if(a.length<2)return l.error("Expected at least one argument.");var A,b=1,T=a[0];if(T==="array"){var I,F;if(a.length>2){var N=a[1];if(typeof N!="string"||!(N in bi)||N==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);I=bi[N],b++}else I=Kt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return l.error('The length argument to "array" must be a positive integer literal',2);F=a[2],b++}A=Vr(I,F)}else A=bi[T];for(var V=[];b<a.length;b++){var X=l.parse(a[b],b,Kt);if(!X)return null;V.push(X)}return new En(A,V)},En.prototype.evaluate=function(a){for(var l=0;l<this.args.length;l++){var A=this.args[l].evaluate(a);if(!Hr(this.type,Un(A)))return A;if(l===this.args.length-1)throw new ri("Expected value to be of type "+Nr(this.type)+", but found "+Nr(Un(A))+" instead.")}return null},En.prototype.eachChild=function(a){this.args.forEach(a)},En.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},En.prototype.serialize=function(){var a=this.type,l=[a.kind];if(a.kind==="array"){var A=a.itemType;if(A.kind==="string"||A.kind==="number"||A.kind==="boolean"){l.push(A.kind);var b=a.N;(typeof b=="number"||this.args.length>1)&&l.push(b)}}return l.concat(this.args.map(function(T){return T.serialize()}))};var as=function(a){this.type=tn,this.sections=a};as.parse=function(a,l){if(a.length<2)return l.error("Expected at least one argument.");var A=a[1];if(!Array.isArray(A)&&typeof A=="object")return l.error("First argument must be an image or text section.");for(var b=[],T=!1,I=1;I<=a.length-1;++I){var F=a[I];if(T&&typeof F=="object"&&!Array.isArray(F)){T=!1;var N=null;if(F["font-scale"]&&!(N=l.parse(F["font-scale"],1,lt)))return null;var V=null;if(F["text-font"]&&!(V=l.parse(F["text-font"],1,Vr(Ft))))return null;var X=null;if(F["text-color"]&&!(X=l.parse(F["text-color"],1,Ut)))return null;var Q=b[b.length-1];Q.scale=N,Q.font=V,Q.textColor=X}else{var ie=l.parse(a[I],1,Kt);if(!ie)return null;var ue=ie.type.kind;if(ue!=="string"&&ue!=="value"&&ue!=="null"&&ue!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,b.push({content:ie,scale:null,font:null,textColor:null})}}return new as(b)},as.prototype.evaluate=function(a){return new ti(this.sections.map(function(l){var A=l.content.evaluate(a);return Un(A)===Gr?new ia("",A,null,null,null):new ia(Ro(A),null,l.scale?l.scale.evaluate(a):null,l.font?l.font.evaluate(a).join(","):null,l.textColor?l.textColor.evaluate(a):null)}))},as.prototype.eachChild=function(a){for(var l=0,A=this.sections;l<A.length;l+=1){var b=A[l];a(b.content),b.scale&&a(b.scale),b.font&&a(b.font),b.textColor&&a(b.textColor)}},as.prototype.outputDefined=function(){return!1},as.prototype.serialize=function(){for(var a=["format"],l=0,A=this.sections;l<A.length;l+=1){var b=A[l];a.push(b.content.serialize());var T={};b.scale&&(T["font-scale"]=b.scale.serialize()),b.font&&(T["text-font"]=b.font.serialize()),b.textColor&&(T["text-color"]=b.textColor.serialize()),a.push(T)}return a};var ki=function(a){this.type=Gr,this.input=a};ki.parse=function(a,l){if(a.length!==2)return l.error("Expected two arguments.");var A=l.parse(a[1],1,Ft);return A?new ki(A):l.error("No image name provided.")},ki.prototype.evaluate=function(a){var l=this.input.evaluate(a),A=kn.fromString(l);return A&&a.availableImages&&(A.available=a.availableImages.indexOf(l)>-1),A},ki.prototype.eachChild=function(a){a(this.input)},ki.prototype.outputDefined=function(){return!1},ki.prototype.serialize=function(){return["image",this.input.serialize()]};var Bs={"to-boolean":Bt,"to-color":Ut,"to-number":lt,"to-string":Ft},xn=function(a,l){this.type=a,this.args=l};xn.parse=function(a,l){if(a.length<2)return l.error("Expected at least one argument.");var A=a[0];if((A==="to-boolean"||A==="to-string")&&a.length!==2)return l.error("Expected one argument.");for(var b=Bs[A],T=[],I=1;I<a.length;I++){var F=l.parse(a[I],I,Kt);if(!F)return null;T.push(F)}return new xn(b,T)},xn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var l,A,b=0,T=this.args;b<T.length;b+=1){if(A=null,(l=T[b].evaluate(a))instanceof qr)return l;if(typeof l=="string"){var I=a.parseColor(l);if(I)return I}else if(Array.isArray(l)&&!(A=l.length<3||l.length>4?"Invalid rbga value "+JSON.stringify(l)+": expected an array containing either three or four numeric values.":Se(l[0],l[1],l[2],l[3])))return new qr(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ri(A||"Could not parse color from value '"+(typeof l=="string"?l:String(JSON.stringify(l)))+"'")}if(this.type.kind==="number"){for(var F=null,N=0,V=this.args;N<V.length;N+=1){if((F=V[N].evaluate(a))===null)return 0;var X=Number(F);if(!isNaN(X))return X}throw new ri("Could not convert "+JSON.stringify(F)+" to number.")}return this.type.kind==="formatted"?ti.fromString(Ro(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?kn.fromString(Ro(this.args[0].evaluate(a))):Ro(this.args[0].evaluate(a))},xn.prototype.eachChild=function(a){this.args.forEach(a)},xn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},xn.prototype.serialize=function(){if(this.type.kind==="formatted")return new as([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ki(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(l){a.push(l.serialize())}),a};var Qc=["Unknown","Point","LineString","Polygon"],xe=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};xe.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},xe.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Qc[this.feature.type]:this.feature.type:null},xe.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},xe.prototype.canonicalID=function(){return this.canonical},xe.prototype.properties=function(){return this.feature&&this.feature.properties||{}},xe.prototype.parseColor=function(a){var l=this._parseColorCache[a];return l||(l=this._parseColorCache[a]=qr.parse(a)),l};var Pe=function(a,l,A,b){this.name=a,this.type=l,this._evaluate=A,this.args=b};Pe.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Pe.prototype.eachChild=function(a){this.args.forEach(a)},Pe.prototype.outputDefined=function(){return!1},Pe.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Pe.parse=function(a,l){var A,b=a[0],T=Pe.definitions[b];if(!T)return l.error('Unknown expression "'+b+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(T)?T[0]:T.type,F=Array.isArray(T)?[[T[1],T[2]]]:T.overloads,N=F.filter(function(xr){var er=xr[0];return!Array.isArray(er)||er.length===a.length-1}),V=null,X=0,Q=N;X<Q.length;X+=1){var ie=Q[X],ue=ie[0],_e=ie[1];V=new hi(l.registry,l.path,null,l.scope);for(var Ne=[],ke=!1,He=1;He<a.length;He++){var Ge=a[He],Ke=Array.isArray(ue)?ue[He-1]:ue.type,ot=V.parse(Ge,1+Ne.length,Ke);if(!ot){ke=!0;break}Ne.push(ot)}if(!ke)if(Array.isArray(ue)&&ue.length!==Ne.length)V.error("Expected "+ue.length+" arguments, but found "+Ne.length+" instead.");else{for(var At=0;At<Ne.length;At++){var gt=Array.isArray(ue)?ue[At]:ue.type,Mt=Ne[At];V.concat(At+1).checkSubtype(gt,Mt.type)}if(V.errors.length===0)return new Pe(b,I,_e,Ne)}}if(N.length===1)(A=l.errors).push.apply(A,V.errors);else{for(var zt=(N.length?N:F).map(function(xr){var er;return er=xr[0],Array.isArray(er)?"("+er.map(Nr).join(", ")+")":"("+Nr(er.type)+"...)"}).join(" | "),Wt=[],gr=1;gr<a.length;gr++){var Qt=l.parse(a[gr],1+Wt.length);if(!Qt)return null;Wt.push(Nr(Qt.type))}l.error("Expected arguments of type "+zt+", but found ("+Wt.join(", ")+") instead.")}return null},Pe.register=function(a,l){for(var A in Pe.definitions=l,l)a[A]=Pe};var je=function(a,l,A){this.type=Kr,this.locale=A,this.caseSensitive=a,this.diacriticSensitive=l};function dt(a,l){a[0]=Math.min(a[0],l[0]),a[1]=Math.min(a[1],l[1]),a[2]=Math.max(a[2],l[0]),a[3]=Math.max(a[3],l[1])}function Vt(a,l){return!(a[0]<=l[0]||a[2]>=l[2]||a[1]<=l[1]||a[3]>=l[3])}function pr(a,l){var A=(180+a[0])/360,b=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,T=Math.pow(2,l.z);return[Math.round(A*T*8192),Math.round(b*T*8192)]}function Cr(a,l,A){return l[1]>a[1]!=A[1]>a[1]&&a[0]<(A[0]-l[0])*(a[1]-l[1])/(A[1]-l[1])+l[0]}function ni(a,l){for(var A,b,T,I,F,N,V,X=!1,Q=0,ie=l.length;Q<ie;Q++)for(var ue=l[Q],_e=0,Ne=ue.length;_e<Ne-1;_e++){if((I=(A=a)[0]-(b=ue[_e])[0])*(V=A[1]-(T=ue[_e+1])[1])-(N=A[0]-T[0])*(F=A[1]-b[1])==0&&I*N<=0&&F*V<=0)return!1;Cr(a,ue[_e],ue[_e+1])&&(X=!X)}return X}function Si(a,l){for(var A=0;A<l.length;A++)if(ni(a,l[A]))return!0;return!1}function Ui(a,l,A,b){var T=b[0]-A[0],I=b[1]-A[1],F=(a[0]-A[0])*I-T*(a[1]-A[1]),N=(l[0]-A[0])*I-T*(l[1]-A[1]);return F>0&&N<0||F<0&&N>0}function Vs(a,l,A){for(var b=0,T=A;b<T.length;b+=1)for(var I=T[b],F=0;F<I.length-1;++F)if((ie=[(Q=I[F+1])[0]-(X=I[F])[0],Q[1]-X[1]])[0]*(ue=[(V=l)[0]-(N=a)[0],V[1]-N[1]])[1]-ie[1]*ue[0]!=0&&Ui(N,V,X,Q)&&Ui(X,Q,N,V))return!0;var N,V,X,Q,ie,ue;return!1}function lh(a,l){for(var A=0;A<a.length;++A)if(!ni(a[A],l))return!1;for(var b=0;b<a.length-1;++b)if(Vs(a[b],a[b+1],l))return!1;return!0}function $u(a,l){for(var A=0;A<l.length;A++)if(lh(a,l[A]))return!0;return!1}function sa(a,l,A){for(var b=[],T=0;T<a.length;T++){for(var I=[],F=0;F<a[T].length;F++){var N=pr(a[T][F],A);dt(l,N),I.push(N)}b.push(I)}return b}function el(a,l,A){for(var b=[],T=0;T<a.length;T++){var I=sa(a[T],l,A);b.push(I)}return b}function tl(a,l,A,b){if(a[0]<A[0]||a[0]>A[2]){var T=.5*b,I=a[0]-A[0]>T?-b:A[0]-a[0]>T?b:0;I===0&&(I=a[0]-A[2]>T?-b:A[2]-a[0]>T?b:0),a[0]+=I}dt(l,a)}function uh(a,l,A,b){for(var T=8192*Math.pow(2,b.z),I=[8192*b.x,8192*b.y],F=[],N=0,V=a;N<V.length;N+=1)for(var X=0,Q=V[N];X<Q.length;X+=1){var ie=Q[X],ue=[ie.x+I[0],ie.y+I[1]];tl(ue,l,A,T),F.push(ue)}return F}function rl(a,l,A,b){for(var T,I=8192*Math.pow(2,b.z),F=[8192*b.x,8192*b.y],N=[],V=0,X=a;V<X.length;V+=1){for(var Q=[],ie=0,ue=X[V];ie<ue.length;ie+=1){var _e=ue[ie],Ne=[_e.x+F[0],_e.y+F[1]];dt(l,Ne),Q.push(Ne)}N.push(Q)}if(l[2]-l[0]<=I/2){(T=l)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(var ke=0,He=N;ke<He.length;ke+=1)for(var Ge=0,Ke=He[ke];Ge<Ke.length;Ge+=1)tl(Ke[Ge],l,A,I)}return N}je.parse=function(a,l){if(a.length!==2)return l.error("Expected one argument.");var A=a[1];if(typeof A!="object"||Array.isArray(A))return l.error("Collator options argument must be an object.");var b=l.parse(A["case-sensitive"]!==void 0&&A["case-sensitive"],1,Bt);if(!b)return null;var T=l.parse(A["diacritic-sensitive"]!==void 0&&A["diacritic-sensitive"],1,Bt);if(!T)return null;var I=null;return A.locale&&!(I=l.parse(A.locale,1,Ft))?null:new je(b,T,I)},je.prototype.evaluate=function(a){return new Ni(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},je.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Ss=function(a,l){this.type=Bt,this.geojson=a,this.geometries=l};function Fo(a){if(a instanceof Pe&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ss)return!1;var l=!0;return a.eachChild(function(A){l&&!Fo(A)&&(l=!1)}),l}function oa(a){if(a instanceof Pe&&a.name==="feature-state")return!1;var l=!0;return a.eachChild(function(A){l&&!oa(A)&&(l=!1)}),l}function Sa(a,l){if(a instanceof Pe&&l.indexOf(a.name)>=0)return!1;var A=!0;return a.eachChild(function(b){A&&!Sa(b,l)&&(A=!1)}),A}Ss.parse=function(a,l){if(a.length!==2)return l.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Po(a[1])){var A=a[1];if(A.type==="FeatureCollection")for(var b=0;b<A.features.length;++b){var T=A.features[b].geometry.type;if(T==="Polygon"||T==="MultiPolygon")return new Ss(A,A.features[b].geometry)}else if(A.type==="Feature"){var I=A.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new Ss(A,A.geometry)}else if(A.type==="Polygon"||A.type==="MultiPolygon")return new Ss(A,A)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ss.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(l,A){var b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],I=l.canonicalID();if(A.type==="Polygon"){var F=sa(A.coordinates,T,I),N=uh(l.geometry(),b,T,I);if(!Vt(b,T))return!1;for(var V=0,X=N;V<X.length;V+=1)if(!ni(X[V],F))return!1}if(A.type==="MultiPolygon"){var Q=el(A.coordinates,T,I),ie=uh(l.geometry(),b,T,I);if(!Vt(b,T))return!1;for(var ue=0,_e=ie;ue<_e.length;ue+=1)if(!Si(_e[ue],Q))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(l,A){var b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],I=l.canonicalID();if(A.type==="Polygon"){var F=sa(A.coordinates,T,I),N=rl(l.geometry(),b,T,I);if(!Vt(b,T))return!1;for(var V=0,X=N;V<X.length;V+=1)if(!lh(X[V],F))return!1}if(A.type==="MultiPolygon"){var Q=el(A.coordinates,T,I),ie=rl(l.geometry(),b,T,I);if(!Vt(b,T))return!1;for(var ue=0,_e=ie;ue<_e.length;ue+=1)if(!$u(_e[ue],Q))return!1}return!0}(a,this.geometries)}return!1},Ss.prototype.eachChild=function(){},Ss.prototype.outputDefined=function(){return!0},Ss.prototype.serialize=function(){return["within",this.geojson]};var aa=function(a,l){this.type=l.type,this.name=a,this.boundExpression=l};aa.parse=function(a,l){if(a.length!==2||typeof a[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");var A=a[1];return l.scope.has(A)?new aa(A,l.scope.get(A)):l.error('Unknown variable "'+A+'". Make sure "'+A+'" has been bound in an enclosing "let" expression before using it.',1)},aa.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},aa.prototype.eachChild=function(){},aa.prototype.outputDefined=function(){return!1},aa.prototype.serialize=function(){return["var",this.name]};var hi=function(a,l,A,b,T){l===void 0&&(l=[]),b===void 0&&(b=new St),T===void 0&&(T=[]),this.registry=a,this.path=l,this.key=l.map(function(I){return"["+I+"]"}).join(""),this.scope=b,this.errors=T,this.expectedType=A};function _o(a,l){for(var A,b=a.length-1,T=0,I=b,F=0;T<=I;)if((A=a[F=Math.floor((T+I)/2)])<=l){if(F===b||l<a[F+1])return F;T=F+1}else{if(!(A>l))throw new ri("Input is not a number.");I=F-1}return 0}hi.prototype.parse=function(a,l,A,b,T){return T===void 0&&(T={}),l?this.concat(l,A,b)._parse(a,T):this._parse(a,T)},hi.prototype._parse=function(a,l){function A(X,Q,ie){return ie==="assert"?new En(Q,[X]):ie==="coerce"?new xn(Q,[X]):X}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var b=a[0];if(typeof b!="string")return this.error("Expression name must be a string, but found "+typeof b+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var T=this.registry[b];if(T){var I=T.parse(a,this);if(!I)return null;if(this.expectedType){var F=this.expectedType,N=I.type;if(F.kind!=="string"&&F.kind!=="number"&&F.kind!=="boolean"&&F.kind!=="object"&&F.kind!=="array"||N.kind!=="value")if(F.kind!=="color"&&F.kind!=="formatted"&&F.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(F,N))return null}else I=A(I,F,l.typeAnnotation||"coerce");else I=A(I,F,l.typeAnnotation||"assert")}if(!(I instanceof Bi)&&I.type.kind!=="resolvedImage"&&function X(Q){if(Q instanceof aa)return X(Q.boundExpression);if(Q instanceof Pe&&Q.name==="error"||Q instanceof je||Q instanceof Ss)return!1;var ie=Q instanceof xn||Q instanceof En,ue=!0;return Q.eachChild(function(_e){ue=ie?ue&&X(_e):ue&&_e instanceof Bi}),!!ue&&Fo(Q)&&Sa(Q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(I)){var V=new xe;try{I=new Bi(I.type,I.evaluate(V))}catch(X){return this.error(X.message),null}}return I}return this.error('Unknown expression "'+b+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},hi.prototype.concat=function(a,l,A){var b=typeof a=="number"?this.path.concat(a):this.path,T=A?this.scope.concat(A):this.scope;return new hi(this.registry,b,l||null,T,this.errors)},hi.prototype.error=function(a){for(var l=[],A=arguments.length-1;A-- >0;)l[A]=arguments[A+1];var b=""+this.key+l.map(function(T){return"["+T+"]"}).join("");this.errors.push(new wt(b,a))},hi.prototype.checkSubtype=function(a,l){var A=Hr(a,l);return A&&this.error(A),A};var Dn=function(a,l,A){this.type=a,this.input=l,this.labels=[],this.outputs=[];for(var b=0,T=A;b<T.length;b+=1){var I=T[b],F=I[1];this.labels.push(I[0]),this.outputs.push(F)}};function ii(a,l,A){return a*(1-A)+l*A}Dn.parse=function(a,l){if(a.length-1<4)return l.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return l.error("Expected an even number of arguments.");var A=l.parse(a[1],1,lt);if(!A)return null;var b=[],T=null;l.expectedType&&l.expectedType.kind!=="value"&&(T=l.expectedType);for(var I=1;I<a.length;I+=2){var F=I===1?-1/0:a[I],N=a[I+1],V=I,X=I+1;if(typeof F!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(b.length&&b[b.length-1][0]>=F)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);var Q=l.parse(N,X,T);if(!Q)return null;T=T||Q.type,b.push([F,Q])}return new Dn(T,A,b)},Dn.prototype.evaluate=function(a){var l=this.labels,A=this.outputs;if(l.length===1)return A[0].evaluate(a);var b=this.input.evaluate(a);if(b<=l[0])return A[0].evaluate(a);var T=l.length;return b>=l[T-1]?A[T-1].evaluate(a):A[_o(l,b)].evaluate(a)},Dn.prototype.eachChild=function(a){a(this.input);for(var l=0,A=this.outputs;l<A.length;l+=1)a(A[l])},Dn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Dn.prototype.serialize=function(){for(var a=["step",this.input.serialize()],l=0;l<this.labels.length;l++)l>0&&a.push(this.labels[l]),a.push(this.outputs[l].serialize());return a};var Ia=Object.freeze({__proto__:null,number:ii,color:function(a,l,A){return new qr(ii(a.r,l.r,A),ii(a.g,l.g,A),ii(a.b,l.b,A),ii(a.a,l.a,A))},array:function(a,l,A){return a.map(function(b,T){return ii(b,l[T],A)})}}),nl=6/29*3*(6/29),PA=Math.PI/180,RA=180/Math.PI;function Wu(a){return a>.008856451679035631?Math.pow(a,1/3):a/nl+4/29}function zl(a){return a>6/29?a*a*a:nl*(a-4/29)}function hc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Do(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ju(a){var l=Do(a.r),A=Do(a.g),b=Do(a.b),T=Wu((.4124564*l+.3575761*A+.1804375*b)/.95047),I=Wu((.2126729*l+.7151522*A+.072175*b)/1);return{l:116*I-16,a:500*(T-I),b:200*(I-Wu((.0193339*l+.119192*A+.9503041*b)/1.08883)),alpha:a.a}}function Xu(a){var l=(a.l+16)/116,A=isNaN(a.a)?l:l+a.a/500,b=isNaN(a.b)?l:l-a.b/200;return l=1*zl(l),A=.95047*zl(A),b=1.08883*zl(b),new qr(hc(3.2404542*A-1.5371385*l-.4985314*b),hc(-.969266*A+1.8760108*l+.041556*b),hc(.0556434*A-.2040259*l+1.0572252*b),a.alpha)}function Gl(a,l,A){var b=l-a;return a+A*(b>180||b<-180?b-360*Math.round(b/360):b)}var co={forward:Ju,reverse:Xu,interpolate:function(a,l,A){return{l:ii(a.l,l.l,A),a:ii(a.a,l.a,A),b:ii(a.b,l.b,A),alpha:ii(a.alpha,l.alpha,A)}}},Hs={forward:function(a){var l=Ju(a),A=l.l,b=l.a,T=l.b,I=Math.atan2(T,b)*RA;return{h:I<0?I+360:I,c:Math.sqrt(b*b+T*T),l:A,alpha:a.a}},reverse:function(a){var l=a.h*PA,A=a.c;return Xu({l:a.l,a:Math.cos(l)*A,b:Math.sin(l)*A,alpha:a.alpha})},interpolate:function(a,l,A){return{h:Gl(a.h,l.h,A),c:ii(a.c,l.c,A),l:ii(a.l,l.l,A),alpha:ii(a.alpha,l.alpha,A)}}},Ku=Object.freeze({__proto__:null,lab:co,hcl:Hs}),Ri=function(a,l,A,b,T){this.type=a,this.operator=l,this.interpolation=A,this.input=b,this.labels=[],this.outputs=[];for(var I=0,F=T;I<F.length;I+=1){var N=F[I],V=N[1];this.labels.push(N[0]),this.outputs.push(V)}};function il(a,l,A,b){var T=b-A,I=a-A;return T===0?0:l===1?I/T:(Math.pow(l,I)-1)/(Math.pow(l,T)-1)}Ri.interpolationFactor=function(a,l,A,b){var T=0;if(a.name==="exponential")T=il(l,a.base,A,b);else if(a.name==="linear")T=il(l,1,A,b);else if(a.name==="cubic-bezier"){var I=a.controlPoints;T=new d(I[0],I[1],I[2],I[3]).solve(il(l,1,A,b))}return T},Ri.parse=function(a,l){var A=a[0],b=a[1],T=a[2],I=a.slice(3);if(!Array.isArray(b)||b.length===0)return l.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){var F=b[1];if(typeof F!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:F}}else{if(b[0]!=="cubic-bezier")return l.error("Unknown interpolation type "+String(b[0]),1,0);var N=b.slice(1);if(N.length!==4||N.some(function(He){return typeof He!="number"||He<0||He>1}))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:N}}if(a.length-1<4)return l.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(!(T=l.parse(T,2,lt)))return null;var V=[],X=null;A==="interpolate-hcl"||A==="interpolate-lab"?X=Ut:l.expectedType&&l.expectedType.kind!=="value"&&(X=l.expectedType);for(var Q=0;Q<I.length;Q+=2){var ie=I[Q],ue=I[Q+1],_e=Q+3,Ne=Q+4;if(typeof ie!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(V.length&&V[V.length-1][0]>=ie)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var ke=l.parse(ue,Ne,X);if(!ke)return null;X=X||ke.type,V.push([ie,ke])}return X.kind==="number"||X.kind==="color"||X.kind==="array"&&X.itemType.kind==="number"&&typeof X.N=="number"?new Ri(X,A,b,T,V):l.error("Type "+Nr(X)+" is not interpolatable.")},Ri.prototype.evaluate=function(a){var l=this.labels,A=this.outputs;if(l.length===1)return A[0].evaluate(a);var b=this.input.evaluate(a);if(b<=l[0])return A[0].evaluate(a);var T=l.length;if(b>=l[T-1])return A[T-1].evaluate(a);var I=_o(l,b),F=Ri.interpolationFactor(this.interpolation,b,l[I],l[I+1]),N=A[I].evaluate(a),V=A[I+1].evaluate(a);return this.operator==="interpolate"?Ia[this.type.kind.toLowerCase()](N,V,F):this.operator==="interpolate-hcl"?Hs.reverse(Hs.interpolate(Hs.forward(N),Hs.forward(V),F)):co.reverse(co.interpolate(co.forward(N),co.forward(V),F))},Ri.prototype.eachChild=function(a){a(this.input);for(var l=0,A=this.outputs;l<A.length;l+=1)a(A[l])},Ri.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ri.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var l=[this.operator,a,this.input.serialize()],A=0;A<this.labels.length;A++)l.push(this.labels[A],this.outputs[A].serialize());return l};var ca=function(a,l){this.type=a,this.args=l};ca.parse=function(a,l){if(a.length<2)return l.error("Expectected at least one argument.");var A=null,b=l.expectedType;b&&b.kind!=="value"&&(A=b);for(var T=[],I=0,F=a.slice(1);I<F.length;I+=1){var N=l.parse(F[I],1+T.length,A,void 0,{typeAnnotation:"omit"});if(!N)return null;A=A||N.type,T.push(N)}var V=b&&T.some(function(X){return Hr(b,X.type)});return new ca(V?Kt:A,T)},ca.prototype.evaluate=function(a){for(var l,A=null,b=0,T=0,I=this.args;T<I.length&&(b++,(A=I[T].evaluate(a))&&A instanceof kn&&!A.available&&(l||(l=A.name),A=null,b===this.args.length&&(A=l)),A===null);T+=1);return A},ca.prototype.eachChild=function(a){this.args.forEach(a)},ca.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ca.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(l){a.push(l.serialize())}),a};var la=function(a,l){this.type=l.type,this.bindings=[].concat(a),this.result=l};la.prototype.evaluate=function(a){return this.result.evaluate(a)},la.prototype.eachChild=function(a){for(var l=0,A=this.bindings;l<A.length;l+=1)a(A[l][1]);a(this.result)},la.parse=function(a,l){if(a.length<4)return l.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var A=[],b=1;b<a.length-1;b+=2){var T=a[b];if(typeof T!="string")return l.error("Expected string, but found "+typeof T+" instead.",b);if(/[^a-zA-Z0-9_]/.test(T))return l.error("Variable names must contain only alphanumeric characters or '_'.",b);var I=l.parse(a[b+1],b+1);if(!I)return null;A.push([T,I])}var F=l.parse(a[a.length-1],a.length-1,l.expectedType,A);return F?new la(A,F):null},la.prototype.outputDefined=function(){return this.result.outputDefined()},la.prototype.serialize=function(){for(var a=["let"],l=0,A=this.bindings;l<A.length;l+=1){var b=A[l];a.push(b[0],b[1].serialize())}return a.push(this.result.serialize()),a};var ua=function(a,l,A){this.type=a,this.index=l,this.input=A};ua.parse=function(a,l){if(a.length!==3)return l.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=l.parse(a[1],1,lt),b=l.parse(a[2],2,Vr(l.expectedType||Kt));return A&&b?new ua(b.type.itemType,A,b):null},ua.prototype.evaluate=function(a){var l=this.index.evaluate(a),A=this.input.evaluate(a);if(l<0)throw new ri("Array index out of bounds: "+l+" < 0.");if(l>=A.length)throw new ri("Array index out of bounds: "+l+" > "+(A.length-1)+".");if(l!==Math.floor(l))throw new ri("Array index must be an integer, but found "+l+" instead.");return A[l]},ua.prototype.eachChild=function(a){a(this.index),a(this.input)},ua.prototype.outputDefined=function(){return!1},ua.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ma=function(a,l){this.type=Bt,this.needle=a,this.haystack=l};Ma.parse=function(a,l){if(a.length!==3)return l.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var A=l.parse(a[1],1,Kt),b=l.parse(a[2],2,Kt);return A&&b?ur(A.type,[Bt,Ft,lt,Rt,Kt])?new Ma(A,b):l.error("Expected first argument to be of type boolean, string, number or null, but found "+Nr(A.type)+" instead"):null},Ma.prototype.evaluate=function(a){var l=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!A)return!1;if(!Ie(l,["boolean","string","number","null"]))throw new ri("Expected first argument to be of type boolean, string, number or null, but found "+Nr(Un(l))+" instead.");if(!Ie(A,["string","array"]))throw new ri("Expected second argument to be of type array or string, but found "+Nr(Un(A))+" instead.");return A.indexOf(l)>=0},Ma.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Ma.prototype.outputDefined=function(){return!0},Ma.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var fa=function(a,l,A){this.type=lt,this.needle=a,this.haystack=l,this.fromIndex=A};fa.parse=function(a,l){if(a.length<=2||a.length>=5)return l.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=l.parse(a[1],1,Kt),b=l.parse(a[2],2,Kt);if(!A||!b)return null;if(!ur(A.type,[Bt,Ft,lt,Rt,Kt]))return l.error("Expected first argument to be of type boolean, string, number or null, but found "+Nr(A.type)+" instead");if(a.length===4){var T=l.parse(a[3],3,lt);return T?new fa(A,b,T):null}return new fa(A,b)},fa.prototype.evaluate=function(a){var l=this.needle.evaluate(a),A=this.haystack.evaluate(a);if(!Ie(l,["boolean","string","number","null"]))throw new ri("Expected first argument to be of type boolean, string, number or null, but found "+Nr(Un(l))+" instead.");if(!Ie(A,["string","array"]))throw new ri("Expected second argument to be of type array or string, but found "+Nr(Un(A))+" instead.");if(this.fromIndex){var b=this.fromIndex.evaluate(a);return A.indexOf(l,b)}return A.indexOf(l)},fa.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},fa.prototype.outputDefined=function(){return!1},fa.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Pa=function(a,l,A,b,T,I){this.inputType=a,this.type=l,this.input=A,this.cases=b,this.outputs=T,this.otherwise=I};Pa.parse=function(a,l){if(a.length<5)return l.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return l.error("Expected an even number of arguments.");var A,b;l.expectedType&&l.expectedType.kind!=="value"&&(b=l.expectedType);for(var T={},I=[],F=2;F<a.length-1;F+=2){var N=a[F],V=a[F+1];Array.isArray(N)||(N=[N]);var X=l.concat(F);if(N.length===0)return X.error("Expected at least one branch label.");for(var Q=0,ie=N;Q<ie.length;Q+=1){var ue=ie[Q];if(typeof ue!="number"&&typeof ue!="string")return X.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return X.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ue=="number"&&Math.floor(ue)!==ue)return X.error("Numeric branch labels must be integer values.");if(A){if(X.checkSubtype(A,Un(ue)))return null}else A=Un(ue);if(T[String(ue)]!==void 0)return X.error("Branch labels must be unique.");T[String(ue)]=I.length}var _e=l.parse(V,F,b);if(!_e)return null;b=b||_e.type,I.push(_e)}var Ne=l.parse(a[1],1,Kt);if(!Ne)return null;var ke=l.parse(a[a.length-1],a.length-1,b);return ke?Ne.type.kind!=="value"&&l.concat(1).checkSubtype(A,Ne.type)?null:new Pa(A,b,Ne,T,I,ke):null},Pa.prototype.evaluate=function(a){var l=this.input.evaluate(a);return(Un(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(a)},Pa.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Pa.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Pa.prototype.serialize=function(){for(var a=this,l=["match",this.input.serialize()],A=[],b={},T=0,I=Object.keys(this.cases).sort();T<I.length;T+=1){var F=I[T];(ie=b[this.cases[F]])===void 0?(b[this.cases[F]]=A.length,A.push([this.cases[F],[F]])):A[ie][1].push(F)}for(var N=function(_e){return a.inputType.kind==="number"?Number(_e):_e},V=0,X=A;V<X.length;V+=1){var Q=X[V],ie=Q[0],ue=Q[1];l.push(ue.length===1?N(ue[0]):ue.map(N)),l.push(this.outputs[outputIndex$1].serialize())}return l.push(this.otherwise.serialize()),l};var Ra=function(a,l,A){this.type=a,this.branches=l,this.otherwise=A};Ra.parse=function(a,l){if(a.length<4)return l.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return l.error("Expected an odd number of arguments.");var A;l.expectedType&&l.expectedType.kind!=="value"&&(A=l.expectedType);for(var b=[],T=1;T<a.length-1;T+=2){var I=l.parse(a[T],T,Bt);if(!I)return null;var F=l.parse(a[T+1],T+1,A);if(!F)return null;b.push([I,F]),A=A||F.type}var N=l.parse(a[a.length-1],a.length-1,A);return N?new Ra(A,b,N):null},Ra.prototype.evaluate=function(a){for(var l=0,A=this.branches;l<A.length;l+=1){var b=A[l],T=b[1];if(b[0].evaluate(a))return T.evaluate(a)}return this.otherwise.evaluate(a)},Ra.prototype.eachChild=function(a){for(var l=0,A=this.branches;l<A.length;l+=1){var b=A[l],T=b[1];a(b[0]),a(T)}a(this.otherwise)},Ra.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},Ra.prototype.serialize=function(){var a=["case"];return this.eachChild(function(l){a.push(l.serialize())}),a};var ha=function(a,l,A,b){this.type=a,this.input=l,this.beginIndex=A,this.endIndex=b};function fh(a,l){return a==="=="||a==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function hh(a,l,A,b){return b.compare(l,A)===0}function wn(a,l,A){var b=a!=="=="&&a!=="!=";return function(){function T(I,F,N){this.type=Bt,this.lhs=I,this.rhs=F,this.collator=N,this.hasUntypedArgument=I.type.kind==="value"||F.type.kind==="value"}return T.parse=function(I,F){if(I.length!==3&&I.length!==4)return F.error("Expected two or three arguments.");var N=I[0],V=F.parse(I[1],1,Kt);if(!V)return null;if(!fh(N,V.type))return F.concat(1).error('"'+N+`" comparisons are not supported for type '`+Nr(V.type)+"'.");var X=F.parse(I[2],2,Kt);if(!X)return null;if(!fh(N,X.type))return F.concat(2).error('"'+N+`" comparisons are not supported for type '`+Nr(X.type)+"'.");if(V.type.kind!==X.type.kind&&V.type.kind!=="value"&&X.type.kind!=="value")return F.error("Cannot compare types '"+Nr(V.type)+"' and '"+Nr(X.type)+"'.");b&&(V.type.kind==="value"&&X.type.kind!=="value"?V=new En(X.type,[V]):V.type.kind!=="value"&&X.type.kind==="value"&&(X=new En(V.type,[X])));var Q=null;if(I.length===4){if(V.type.kind!=="string"&&X.type.kind!=="string"&&V.type.kind!=="value"&&X.type.kind!=="value")return F.error("Cannot use collator to compare non-string types.");if(!(Q=F.parse(I[3],3,Kr)))return null}return new T(V,X,Q)},T.prototype.evaluate=function(I){var F=this.lhs.evaluate(I),N=this.rhs.evaluate(I);if(b&&this.hasUntypedArgument){var V=Un(F),X=Un(N);if(V.kind!==X.kind||V.kind!=="string"&&V.kind!=="number")throw new ri('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+V.kind+", "+X.kind+") instead.")}if(this.collator&&!b&&this.hasUntypedArgument){var Q=Un(F),ie=Un(N);if(Q.kind!=="string"||ie.kind!=="string")return l(I,F,N)}return this.collator?A(I,F,N,this.collator.evaluate(I)):l(I,F,N)},T.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},T.prototype.outputDefined=function(){return!0},T.prototype.serialize=function(){var I=[a];return this.eachChild(function(F){I.push(F.serialize())}),I},T}()}ha.parse=function(a,l){if(a.length<=2||a.length>=5)return l.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var A=l.parse(a[1],1,Kt),b=l.parse(a[2],2,lt);if(!A||!b)return null;if(!ur(A.type,[Vr(Kt),Ft,Kt]))return l.error("Expected first argument to be of type array or string, but found "+Nr(A.type)+" instead");if(a.length===4){var T=l.parse(a[3],3,lt);return T?new ha(A.type,A,b,T):null}return new ha(A.type,A,b)},ha.prototype.evaluate=function(a){var l=this.input.evaluate(a),A=this.beginIndex.evaluate(a);if(!Ie(l,["string","array"]))throw new ri("Expected first argument to be of type array or string, but found "+Nr(Un(l))+" instead.");if(this.endIndex){var b=this.endIndex.evaluate(a);return l.slice(A,b)}return l.slice(A)},ha.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Vl=wn("==",function(a,l,A){return l===A},hh),Hl=wn("!=",function(a,l,A){return l!==A},function(a,l,A,b){return!hh(0,l,A,b)}),dh=wn("<",function(a,l,A){return l<A},function(a,l,A,b){return b.compare(l,A)<0}),Ah=wn(">",function(a,l,A){return l>A},function(a,l,A,b){return b.compare(l,A)>0}),dc=wn("<=",function(a,l,A){return l<=A},function(a,l,A,b){return b.compare(l,A)<=0}),ph=wn(">=",function(a,l,A){return l>=A},function(a,l,A,b){return b.compare(l,A)>=0}),Oo=function(a,l,A,b,T){this.type=Ft,this.number=a,this.locale=l,this.currency=A,this.minFractionDigits=b,this.maxFractionDigits=T};Oo.parse=function(a,l){if(a.length!==3)return l.error("Expected two arguments.");var A=l.parse(a[1],1,lt);if(!A)return null;var b=a[2];if(typeof b!="object"||Array.isArray(b))return l.error("NumberFormat options argument must be an object.");var T=null;if(b.locale&&!(T=l.parse(b.locale,1,Ft)))return null;var I=null;if(b.currency&&!(I=l.parse(b.currency,1,Ft)))return null;var F=null;if(b["min-fraction-digits"]&&!(F=l.parse(b["min-fraction-digits"],1,lt)))return null;var N=null;return b["max-fraction-digits"]&&!(N=l.parse(b["max-fraction-digits"],1,lt))?null:new Oo(A,T,I,F,N)},Oo.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Oo.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Lo=function(a){this.type=lt,this.input=a};Lo.parse=function(a,l){if(a.length!==2)return l.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var A=l.parse(a[1],1);return A?A.type.kind!=="array"&&A.type.kind!=="string"&&A.type.kind!=="value"?l.error("Expected argument of type string or array, but found "+Nr(A.type)+" instead."):new Lo(A):null},Lo.prototype.evaluate=function(a){var l=this.input.evaluate(a);if(typeof l=="string"||Array.isArray(l))return l.length;throw new ri("Expected value to be of type string or array, but found "+Nr(Un(l))+" instead.")},Lo.prototype.eachChild=function(a){a(this.input)},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){var a=["length"];return this.eachChild(function(l){a.push(l.serialize())}),a};var js={"==":Vl,"!=":Hl,">":Ah,"<":dh,">=":ph,"<=":dc,array:En,at:ua,boolean:En,case:Ra,coalesce:ca,collator:je,format:as,image:ki,in:Ma,"index-of":fa,interpolate:Ri,"interpolate-hcl":Ri,"interpolate-lab":Ri,length:Lo,let:la,literal:Bi,match:Pa,number:En,"number-format":Oo,object:En,slice:ha,step:Dn,string:En,"to-boolean":xn,"to-color":xn,"to-number":xn,"to-string":xn,var:aa,within:Ss};function gh(a,l){var A=l[0],b=l[1],T=l[2],I=l[3];A=A.evaluate(a),b=b.evaluate(a),T=T.evaluate(a);var F=I?I.evaluate(a):1,N=Se(A,b,T,F);if(N)throw new ri(N);return new qr(A/255*F,b/255*F,T/255*F,F)}function jl(a,l){return a in l}function $l(a,l){var A=l[a];return A===void 0?null:A}function Fa(a){return{type:a}}function qu(a){return{result:"success",value:a}}function No(a){return{result:"error",value:a}}function ko(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function sl(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Bn(a){return!!a.expression&&a.expression.interpolated}function In(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Wl(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function FA(a){return a}function Ac(a,l,A){return a!==void 0?a:l!==void 0?l:A!==void 0?A:void 0}function mh(a,l,A,b,T){return Ac(typeof A===T?b[A]:void 0,a.default,l.default)}function DA(a,l,A){if(In(A)!=="number")return Ac(a.default,l.default);var b=a.stops.length;if(b===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[b-1][0])return a.stops[b-1][1];var T=_o(a.stops.map(function(I){return I[0]}),A);return a.stops[T][1]}function _h(a,l,A){var b=a.base!==void 0?a.base:1;if(In(A)!=="number")return Ac(a.default,l.default);var T=a.stops.length;if(T===1||A<=a.stops[0][0])return a.stops[0][1];if(A>=a.stops[T-1][0])return a.stops[T-1][1];var I=_o(a.stops.map(function(ie){return ie[0]}),A),F=function(ie,ue,_e,Ne){var ke=Ne-_e,He=ie-_e;return ke===0?0:ue===1?He/ke:(Math.pow(ue,He)-1)/(Math.pow(ue,ke)-1)}(A,b,a.stops[I][0],a.stops[I+1][0]),N=a.stops[I][1],V=a.stops[I+1][1],X=Ia[l.type]||FA;if(a.colorSpace&&a.colorSpace!=="rgb"){var Q=Ku[a.colorSpace];X=function(ie,ue){return Q.reverse(Q.interpolate(Q.forward(ie),Q.forward(ue),F))}}return typeof N.evaluate=="function"?{evaluate:function(){for(var ie=[],ue=arguments.length;ue--;)ie[ue]=arguments[ue];var _e=N.evaluate.apply(void 0,ie),Ne=V.evaluate.apply(void 0,ie);if(_e!==void 0&&Ne!==void 0)return X(_e,Ne,F)}}:X(N,V,F)}function Xi(a,l,A){return l.type==="color"?A=qr.parse(A):l.type==="formatted"?A=ti.fromString(A.toString()):l.type==="resolvedImage"?A=kn.fromString(A.toString()):In(A)===l.type||l.type==="enum"&&l.values[A]||(A=void 0),Ac(A,a.default,l.default)}Pe.register(js,{error:[{kind:"error"},[Ft],function(a,l){throw new ri(l[0].evaluate(a))}],typeof:[Ft,[Kt],function(a,l){return Nr(Un(l[0].evaluate(a)))}],"to-rgba":[Vr(lt,4),[Ut],function(a,l){return l[0].evaluate(a).toArray()}],rgb:[Ut,[lt,lt,lt],gh],rgba:[Ut,[lt,lt,lt,lt],gh],has:{type:Bt,overloads:[[[Ft],function(a,l){return jl(l[0].evaluate(a),a.properties())}],[[Ft,Dr],function(a,l){var A=l[1];return jl(l[0].evaluate(a),A.evaluate(a))}]]},get:{type:Kt,overloads:[[[Ft],function(a,l){return $l(l[0].evaluate(a),a.properties())}],[[Ft,Dr],function(a,l){var A=l[1];return $l(l[0].evaluate(a),A.evaluate(a))}]]},"feature-state":[Kt,[Ft],function(a,l){return $l(l[0].evaluate(a),a.featureState||{})}],properties:[Dr,[],function(a){return a.properties()}],"geometry-type":[Ft,[],function(a){return a.geometryType()}],id:[Kt,[],function(a){return a.id()}],zoom:[lt,[],function(a){return a.globals.zoom}],"heatmap-density":[lt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[lt,[],function(a){return a.globals.lineProgress||0}],accumulated:[Kt,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[lt,Fa(lt),function(a,l){for(var A=0,b=0,T=l;b<T.length;b+=1)A+=T[b].evaluate(a);return A}],"*":[lt,Fa(lt),function(a,l){for(var A=1,b=0,T=l;b<T.length;b+=1)A*=T[b].evaluate(a);return A}],"-":{type:lt,overloads:[[[lt,lt],function(a,l){var A=l[1];return l[0].evaluate(a)-A.evaluate(a)}],[[lt],function(a,l){return-l[0].evaluate(a)}]]},"/":[lt,[lt,lt],function(a,l){var A=l[1];return l[0].evaluate(a)/A.evaluate(a)}],"%":[lt,[lt,lt],function(a,l){var A=l[1];return l[0].evaluate(a)%A.evaluate(a)}],ln2:[lt,[],function(){return Math.LN2}],pi:[lt,[],function(){return Math.PI}],e:[lt,[],function(){return Math.E}],"^":[lt,[lt,lt],function(a,l){var A=l[1];return Math.pow(l[0].evaluate(a),A.evaluate(a))}],sqrt:[lt,[lt],function(a,l){return Math.sqrt(l[0].evaluate(a))}],log10:[lt,[lt],function(a,l){return Math.log(l[0].evaluate(a))/Math.LN10}],ln:[lt,[lt],function(a,l){return Math.log(l[0].evaluate(a))}],log2:[lt,[lt],function(a,l){return Math.log(l[0].evaluate(a))/Math.LN2}],sin:[lt,[lt],function(a,l){return Math.sin(l[0].evaluate(a))}],cos:[lt,[lt],function(a,l){return Math.cos(l[0].evaluate(a))}],tan:[lt,[lt],function(a,l){return Math.tan(l[0].evaluate(a))}],asin:[lt,[lt],function(a,l){return Math.asin(l[0].evaluate(a))}],acos:[lt,[lt],function(a,l){return Math.acos(l[0].evaluate(a))}],atan:[lt,[lt],function(a,l){return Math.atan(l[0].evaluate(a))}],min:[lt,Fa(lt),function(a,l){return Math.min.apply(Math,l.map(function(A){return A.evaluate(a)}))}],max:[lt,Fa(lt),function(a,l){return Math.max.apply(Math,l.map(function(A){return A.evaluate(a)}))}],abs:[lt,[lt],function(a,l){return Math.abs(l[0].evaluate(a))}],round:[lt,[lt],function(a,l){var A=l[0].evaluate(a);return A<0?-Math.round(-A):Math.round(A)}],floor:[lt,[lt],function(a,l){return Math.floor(l[0].evaluate(a))}],ceil:[lt,[lt],function(a,l){return Math.ceil(l[0].evaluate(a))}],"filter-==":[Bt,[Ft,Kt],function(a,l){var A=l[0],b=l[1];return a.properties()[A.value]===b.value}],"filter-id-==":[Bt,[Kt],function(a,l){var A=l[0];return a.id()===A.value}],"filter-type-==":[Bt,[Ft],function(a,l){var A=l[0];return a.geometryType()===A.value}],"filter-<":[Bt,[Ft,Kt],function(a,l){var A=l[0],b=l[1],T=a.properties()[A.value],I=b.value;return typeof T==typeof I&&T<I}],"filter-id-<":[Bt,[Kt],function(a,l){var A=l[0],b=a.id(),T=A.value;return typeof b==typeof T&&b<T}],"filter->":[Bt,[Ft,Kt],function(a,l){var A=l[0],b=l[1],T=a.properties()[A.value],I=b.value;return typeof T==typeof I&&T>I}],"filter-id->":[Bt,[Kt],function(a,l){var A=l[0],b=a.id(),T=A.value;return typeof b==typeof T&&b>T}],"filter-<=":[Bt,[Ft,Kt],function(a,l){var A=l[0],b=l[1],T=a.properties()[A.value],I=b.value;return typeof T==typeof I&&T<=I}],"filter-id-<=":[Bt,[Kt],function(a,l){var A=l[0],b=a.id(),T=A.value;return typeof b==typeof T&&b<=T}],"filter->=":[Bt,[Ft,Kt],function(a,l){var A=l[0],b=l[1],T=a.properties()[A.value],I=b.value;return typeof T==typeof I&&T>=I}],"filter-id->=":[Bt,[Kt],function(a,l){var A=l[0],b=a.id(),T=A.value;return typeof b==typeof T&&b>=T}],"filter-has":[Bt,[Kt],function(a,l){return l[0].value in a.properties()}],"filter-has-id":[Bt,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Bt,[Vr(Ft)],function(a,l){return l[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Bt,[Vr(Kt)],function(a,l){return l[0].value.indexOf(a.id())>=0}],"filter-in-small":[Bt,[Ft,Vr(Kt)],function(a,l){var A=l[0];return l[1].value.indexOf(a.properties()[A.value])>=0}],"filter-in-large":[Bt,[Ft,Vr(Kt)],function(a,l){var A=l[0],b=l[1];return function(T,I,F,N){for(;F<=N;){var V=F+N>>1;if(I[V]===T)return!0;I[V]>T?N=V-1:F=V+1}return!1}(a.properties()[A.value],b.value,0,b.value.length-1)}],all:{type:Bt,overloads:[[[Bt,Bt],function(a,l){var A=l[1];return l[0].evaluate(a)&&A.evaluate(a)}],[Fa(Bt),function(a,l){for(var A=0,b=l;A<b.length;A+=1)if(!b[A].evaluate(a))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],function(a,l){var A=l[1];return l[0].evaluate(a)||A.evaluate(a)}],[Fa(Bt),function(a,l){for(var A=0,b=l;A<b.length;A+=1)if(b[A].evaluate(a))return!0;return!1}]]},"!":[Bt,[Bt],function(a,l){return!l[0].evaluate(a)}],"is-supported-script":[Bt,[Ft],function(a,l){var A=a.globals&&a.globals.isSupportedScript;return!A||A(l[0].evaluate(a))}],upcase:[Ft,[Ft],function(a,l){return l[0].evaluate(a).toUpperCase()}],downcase:[Ft,[Ft],function(a,l){return l[0].evaluate(a).toLowerCase()}],concat:[Ft,Fa(Kt),function(a,l){return l.map(function(A){return Ro(A.evaluate(a))}).join("")}],"resolved-locale":[Ft,[Kr],function(a,l){return l[0].evaluate(a).resolvedLocale()}]});var da=function(a,l){this.expression=a,this._warningHistory={},this._evaluator=new xe,this._defaultValue=l?function(A){return A.type==="color"&&Wl(A.default)?new qr(0,0,0,0):A.type==="color"?qr.parse(A.default)||null:A.default===void 0?null:A.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null};function lo(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in js}function Jl(a,l){var A=new hi(js,[],l?function(T){var I={color:Ut,string:Ft,number:lt,enum:Ft,boolean:Bt,formatted:tn,resolvedImage:Gr};return T.type==="array"?Vr(I[T.value]||Kt,T.length):I[T.type]}(l):void 0),b=A.parse(a,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?qu(new da(b,l)):No(A.errors)}da.prototype.evaluateWithoutErrorHandling=function(a,l,A,b,T,I){return this._evaluator.globals=a,this._evaluator.feature=l,this._evaluator.featureState=A,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},da.prototype.evaluate=function(a,l,A,b,T,I){this._evaluator.globals=a,this._evaluator.feature=l||null,this._evaluator.featureState=A||null,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=I||null;try{var F=this.expression.evaluate(this._evaluator);if(F==null||typeof F=="number"&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new ri("Expected value to be one of "+Object.keys(this._enumValues).map(function(N){return JSON.stringify(N)}).join(", ")+", but found "+JSON.stringify(F)+" instead.");return F}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}};var Da=function(a,l){this.kind=a,this._styleExpression=l,this.isStateDependent=a!=="constant"&&!oa(l.expression)};Da.prototype.evaluateWithoutErrorHandling=function(a,l,A,b,T,I){return this._styleExpression.evaluateWithoutErrorHandling(a,l,A,b,T,I)},Da.prototype.evaluate=function(a,l,A,b,T,I){return this._styleExpression.evaluate(a,l,A,b,T,I)};var pc=function(a,l,A,b){this.kind=a,this.zoomStops=A,this._styleExpression=l,this.isStateDependent=a!=="camera"&&!oa(l.expression),this.interpolationType=b};function Is(a,l){if((a=Jl(a,l)).result==="error")return a;var A=a.value.expression,b=Fo(A);if(!b&&!ko(l))return No([new wt("","data expressions not supported")]);var T=Sa(A,["zoom"]);if(!T&&!sl(l))return No([new wt("","zoom expressions not supported")]);var I=function F(N){var V=null;if(N instanceof la)V=F(N.result);else if(N instanceof ca)for(var X=0,Q=N.args;X<Q.length&&!(V=F(Q[X]));X+=1);else(N instanceof Dn||N instanceof Ri)&&N.input instanceof Pe&&N.input.name==="zoom"&&(V=N);return V instanceof wt||N.eachChild(function(ie){var ue=F(ie);ue instanceof wt?V=ue:!V&&ue?V=new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):V&&ue&&V!==ue&&(V=new wt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),V}(A);return I||T?I instanceof wt?No([I]):I instanceof Ri&&!Bn(l)?No([new wt("",'"interpolate" expressions cannot be used with this property')]):qu(I?new pc(b?"camera":"composite",a.value,I.labels,I instanceof Ri?I.interpolation:void 0):new Da(b?"constant":"source",a.value)):No([new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pc.prototype.evaluateWithoutErrorHandling=function(a,l,A,b,T,I){return this._styleExpression.evaluateWithoutErrorHandling(a,l,A,b,T,I)},pc.prototype.evaluate=function(a,l,A,b,T,I){return this._styleExpression.evaluate(a,l,A,b,T,I)},pc.prototype.interpolationFactor=function(a,l,A){return this.interpolationType?Ri.interpolationFactor(this.interpolationType,a,l,A):0};var Oa=function(a,l){this._parameters=a,this._specification=l,ce(this,function A(b,T){var I,F,N,V=T.type==="color",X=b.stops&&typeof b.stops[0][0]=="object",Q=X||!(X||b.property!==void 0),ie=b.type||(Bn(T)?"exponential":"interval");if(V&&((b=ce({},b)).stops&&(b.stops=b.stops.map(function(Qt){return[Qt[0],qr.parse(Qt[1])]})),b.default=qr.parse(b.default?b.default:T.default)),b.colorSpace&&b.colorSpace!=="rgb"&&!Ku[b.colorSpace])throw new Error("Unknown color space: "+b.colorSpace);if(ie==="exponential")I=_h;else if(ie==="interval")I=DA;else if(ie==="categorical"){I=mh,F=Object.create(null);for(var ue=0,_e=b.stops;ue<_e.length;ue+=1){var Ne=_e[ue];F[Ne[0]]=Ne[1]}N=typeof b.stops[0][0]}else{if(ie!=="identity")throw new Error('Unknown function type "'+ie+'"');I=Xi}if(X){for(var ke={},He=[],Ge=0;Ge<b.stops.length;Ge++){var Ke=b.stops[Ge],ot=Ke[0].zoom;ke[ot]===void 0&&(ke[ot]={zoom:ot,type:b.type,property:b.property,default:b.default,stops:[]},He.push(ot)),ke[ot].stops.push([Ke[0].value,Ke[1]])}for(var At=[],gt=0,Mt=He;gt<Mt.length;gt+=1){var zt=Mt[gt];At.push([ke[zt].zoom,A(ke[zt],T)])}var Wt={name:"linear"};return{kind:"composite",interpolationType:Wt,interpolationFactor:Ri.interpolationFactor.bind(void 0,Wt),zoomStops:At.map(function(Qt){return Qt[0]}),evaluate:function(Qt,xr){var er=Qt.zoom;return _h({stops:At,base:b.base},T,er).evaluate(er,xr)}}}if(Q){var gr=ie==="exponential"?{name:"exponential",base:b.base!==void 0?b.base:1}:null;return{kind:"camera",interpolationType:gr,interpolationFactor:Ri.interpolationFactor.bind(void 0,gr),zoomStops:b.stops.map(function(Qt){return Qt[0]}),evaluate:function(Qt){return I(b,T,Qt.zoom,F,N)}}}return{kind:"source",evaluate:function(Qt,xr){var er=xr&&xr.properties?xr.properties[b.property]:void 0;return er===void 0?Ac(b.default,T.default):I(b,T,er,F,N)}}}(this._parameters,this._specification))};function Ms(a){var l=a.key,A=a.value,b=a.valueSpec||{},T=a.objectElementValidators||{},I=a.style,F=a.styleSpec,N=[],V=In(A);if(V!=="object")return[new Be(l,A,"object expected, "+V+" found")];for(var X in A){var Q=X.split(".")[0],ie=b[Q]||b["*"],ue=void 0;if(T[Q])ue=T[Q];else if(b[Q])ue=sn;else if(T["*"])ue=T["*"];else{if(!b["*"]){N.push(new Be(l,A[X],'unknown property "'+X+'"'));continue}ue=sn}N=N.concat(ue({key:(l&&l+".")+X,value:A[X],valueSpec:ie,style:I,styleSpec:F,object:A,objectKey:X},A))}for(var _e in b)T[_e]||b[_e].required&&b[_e].default===void 0&&A[_e]===void 0&&N.push(new Be(l,A,'missing required property "'+_e+'"'));return N}function La(a){var l=a.value,A=a.valueSpec,b=a.style,T=a.styleSpec,I=a.key,F=a.arrayElementValidator||sn;if(In(l)!=="array")return[new Be(I,l,"array expected, "+In(l)+" found")];if(A.length&&l.length!==A.length)return[new Be(I,l,"array length "+A.length+" expected, length "+l.length+" found")];if(A["min-length"]&&l.length<A["min-length"])return[new Be(I,l,"array length at least "+A["min-length"]+" expected, length "+l.length+" found")];var N={type:A.value,values:A.values};T.$version<7&&(N.function=A.function),In(A.value)==="object"&&(N=A.value);for(var V=[],X=0;X<l.length;X++)V=V.concat(F({array:l,arrayIndex:X,value:l[X],valueSpec:N,style:b,styleSpec:T,key:I+"["+X+"]"}));return V}function gc(a){var l=a.key,A=a.value,b=a.valueSpec,T=In(A);return T==="number"&&A!=A&&(T="NaN"),T!=="number"?[new Be(l,A,"number expected, "+T+" found")]:"minimum"in b&&A<b.minimum?[new Be(l,A,A+" is less than the minimum value "+b.minimum)]:"maximum"in b&&A>b.maximum?[new Be(l,A,A+" is greater than the maximum value "+b.maximum)]:[]}function mc(a){var l,A,b,T=a.valueSpec,I=yt(a.value.type),F={},N=I!=="categorical"&&a.value.property===void 0,V=!N,X=In(a.value.stops)==="array"&&In(a.value.stops[0])==="array"&&In(a.value.stops[0][0])==="object",Q=Ms({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(_e){if(I==="identity")return[new Be(_e.key,_e.value,'identity function may not have a "stops" property')];var Ne=[],ke=_e.value;return Ne=Ne.concat(La({key:_e.key,value:ke,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:ie})),In(ke)==="array"&&ke.length===0&&Ne.push(new Be(_e.key,ke,"array must have at least one stop")),Ne},default:function(_e){return sn({key:_e.key,value:_e.value,valueSpec:T,style:_e.style,styleSpec:_e.styleSpec})}}});return I==="identity"&&N&&Q.push(new Be(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||Q.push(new Be(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!Bn(a.valueSpec)&&Q.push(new Be(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(V&&!ko(a.valueSpec)?Q.push(new Be(a.key,a.value,"property functions not supported")):N&&!sl(a.valueSpec)&&Q.push(new Be(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!X||a.value.property!==void 0||Q.push(new Be(a.key,a.value,'"property" property is required')),Q;function ie(_e){var Ne=[],ke=_e.value,He=_e.key;if(In(ke)!=="array")return[new Be(He,ke,"array expected, "+In(ke)+" found")];if(ke.length!==2)return[new Be(He,ke,"array length 2 expected, length "+ke.length+" found")];if(X){if(In(ke[0])!=="object")return[new Be(He,ke,"object expected, "+In(ke[0])+" found")];if(ke[0].zoom===void 0)return[new Be(He,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new Be(He,ke,"object stop key must have value")];if(b&&b>yt(ke[0].zoom))return[new Be(He,ke[0].zoom,"stop zoom values must appear in ascending order")];yt(ke[0].zoom)!==b&&(b=yt(ke[0].zoom),A=void 0,F={}),Ne=Ne.concat(Ms({key:He+"[0]",value:ke[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:gc,value:ue}}))}else Ne=Ne.concat(ue({key:He+"[0]",value:ke[0],style:_e.style,styleSpec:_e.styleSpec},ke));return lo(Xe(ke[1]))?Ne.concat([new Be(He+"[1]",ke[1],"expressions are not allowed in function stops.")]):Ne.concat(sn({key:He+"[1]",value:ke[1],valueSpec:T,style:_e.style,styleSpec:_e.styleSpec}))}function ue(_e,Ne){var ke=In(_e.value),He=yt(_e.value),Ge=_e.value!==null?_e.value:Ne;if(l){if(ke!==l)return[new Be(_e.key,Ge,ke+" stop domain type must match previous stop domain type "+l)]}else l=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new Be(_e.key,Ge,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&I!=="categorical"){var Ke="number expected, "+ke+" found";return ko(T)&&I===void 0&&(Ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(_e.key,Ge,Ke)]}return I!=="categorical"||ke!=="number"||isFinite(He)&&Math.floor(He)===He?I!=="categorical"&&ke==="number"&&A!==void 0&&He<A?[new Be(_e.key,Ge,"stop domain values must appear in ascending order")]:(A=He,I==="categorical"&&He in F?[new Be(_e.key,Ge,"stop domain values must be unique")]:(F[He]=!0,[])):[new Be(_e.key,Ge,"integer expected, found "+He)]}}function Na(a){var l=(a.expressionContext==="property"?Is:Jl)(Xe(a.value),a.valueSpec);if(l.result==="error")return l.value.map(function(b){return new Be(""+a.key+b.key,a.value,b.message)});var A=l.value.expression||l.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!A.outputDefined())return[new Be(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!oa(A))return[new Be(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!oa(A))return[new Be(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Sa(A,["zoom","feature-state"]))return[new Be(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Fo(A))return[new Be(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _c(a){var l=a.key,A=a.value,b=a.valueSpec,T=[];return Array.isArray(b.values)?b.values.indexOf(yt(A))===-1&&T.push(new Be(l,A,"expected one of ["+b.values.join(", ")+"], "+JSON.stringify(A)+" found")):Object.keys(b.values).indexOf(yt(A))===-1&&T.push(new Be(l,A,"expected one of ["+Object.keys(b.values).join(", ")+"], "+JSON.stringify(A)+" found")),T}function Xl(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var l=0,A=a.slice(1);l<A.length;l+=1){var b=A[l];if(!Xl(b)&&typeof b!="boolean")return!1}return!0;default:return!0}}Oa.deserialize=function(a){return new Oa(a._parameters,a._specification)},Oa.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var ol={type:"boolean",default:!1};function Kl(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};Xl(a)||(a=al(a));var l=Jl(a,ol);if(l.result==="error")throw new Error(l.value.map(function(A){return A.key+": "+A.message}).join(", "));return{filter:function(A,b,T){return l.value.evaluate(A,b,{},T)},needGeometry:function A(b){if(!Array.isArray(b))return!1;if(b[0]==="within")return!0;for(var T=1;T<b.length;T++)if(A(b[T]))return!0;return!1}(a)}}function OA(a,l){return a<l?-1:a>l?1:0}function al(a){if(!a)return!0;var l,A=a[0];return a.length<=1?A!=="any":A==="=="?ql(a[1],a[2],"=="):A==="!="?Yl(ql(a[1],a[2],"==")):A==="<"||A===">"||A==="<="||A===">="?ql(a[1],a[2],A):A==="any"?(l=a.slice(1),["any"].concat(l.map(al))):A==="all"?["all"].concat(a.slice(1).map(al)):A==="none"?["all"].concat(a.slice(1).map(al).map(Yl)):A==="in"?yc(a[1],a.slice(2)):A==="!in"?Yl(yc(a[1],a.slice(2))):A==="has"?ka(a[1]):A==="!has"?Yl(ka(a[1])):A!=="within"||a}function ql(a,l,A){switch(a){case"$type":return["filter-type-"+A,l];case"$id":return["filter-id-"+A,l];default:return["filter-"+A,a,l]}}function yc(a,l){if(l.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(function(A){return typeof A!=typeof l[0]})?["filter-in-large",a,["literal",l.sort(OA)]]:["filter-in-small",a,["literal",l]]}}function ka(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Yl(a){return["!",a]}function Ua(a){return Xl(Xe(a.value))?Na(ce({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function l(A){var b=A.value,T=A.key;if(In(b)!=="array")return[new Be(T,b,"array expected, "+In(b)+" found")];var I,F=A.styleSpec,N=[];if(b.length<1)return[new Be(T,b,"filter array must have at least 1 element")];switch(N=N.concat(_c({key:T+"[0]",value:b[0],valueSpec:F.filter_operator,style:A.style,styleSpec:A.styleSpec})),yt(b[0])){case"<":case"<=":case">":case">=":b.length>=2&&yt(b[1])==="$type"&&N.push(new Be(T,b,'"$type" cannot be use with operator "'+b[0]+'"'));case"==":case"!=":b.length!==3&&N.push(new Be(T,b,'filter array for operator "'+b[0]+'" must have 3 elements'));case"in":case"!in":b.length>=2&&(I=In(b[1]))!=="string"&&N.push(new Be(T+"[1]",b[1],"string expected, "+I+" found"));for(var V=2;V<b.length;V++)I=In(b[V]),yt(b[1])==="$type"?N=N.concat(_c({key:T+"["+V+"]",value:b[V],valueSpec:F.geometry_type,style:A.style,styleSpec:A.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&N.push(new Be(T+"["+V+"]",b[V],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var X=1;X<b.length;X++)N=N.concat(l({key:T+"["+X+"]",value:b[X],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":I=In(b[1]),b.length!==2?N.push(new Be(T,b,'filter array for "'+b[0]+'" operator must have 2 elements')):I!=="string"&&N.push(new Be(T+"[1]",b[1],"string expected, "+I+" found"));break;case"within":I=In(b[1]),b.length!==2?N.push(new Be(T,b,'filter array for "'+b[0]+'" operator must have 2 elements')):I!=="object"&&N.push(new Be(T+"[1]",b[1],"object expected, "+I+" found"))}return N}(a)}function Yu(a,l){var A=a.key,b=a.style,T=a.styleSpec,I=a.value,F=a.objectKey,N=T[l+"_"+a.layerType];if(!N)return[];var V=F.match(/^(.*)-transition$/);if(l==="paint"&&V&&N[V[1]]&&N[V[1]].transition)return sn({key:A,value:I,valueSpec:T.transition,style:b,styleSpec:T});var X,Q=a.valueSpec||N[F];if(!Q)return[new Be(A,I,'unknown property "'+F+'"')];if(In(I)==="string"&&ko(Q)&&!Q.tokens&&(X=/^{([^}]+)}$/.exec(I)))return[new Be(A,I,'"'+F+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(X[1])+" }`.")];var ie=[];return a.layerType==="symbol"&&(F==="text-field"&&b&&!b.glyphs&&ie.push(new Be(A,I,'use of "text-field" requires a style "glyphs" property')),F==="text-font"&&Wl(Xe(I))&&yt(I.type)==="identity"&&ie.push(new Be(A,I,'"text-font" does not support identity functions'))),ie.concat(sn({key:a.key,value:I,valueSpec:Q,style:b,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:F}))}function Zu(a){return Yu(a,"paint")}function cl(a){return Yu(a,"layout")}function yh(a){var l=[],A=a.value,b=a.key,T=a.style,I=a.styleSpec;A.type||A.ref||l.push(new Be(b,A,'either "type" or "ref" is required'));var F,N=yt(A.type),V=yt(A.ref);if(A.id)for(var X=yt(A.id),Q=0;Q<a.arrayIndex;Q++){var ie=T.layers[Q];yt(ie.id)===X&&l.push(new Be(b,A.id,'duplicate layer id "'+A.id+'", previously used at line '+ie.id.__line__))}if("ref"in A)["type","source","source-layer","filter","layout"].forEach(function(Ne){Ne in A&&l.push(new Be(b,A[Ne],'"'+Ne+'" is prohibited for ref layers'))}),T.layers.forEach(function(Ne){yt(Ne.id)===V&&(F=Ne)}),F?F.ref?l.push(new Be(b,A.ref,"ref cannot reference another ref layer")):N=yt(F.type):l.push(new Be(b,A.ref,'ref layer "'+V+'" not found'));else if(N!=="background")if(A.source){var ue=T.sources&&T.sources[A.source],_e=ue&&yt(ue.type);ue?_e==="vector"&&N==="raster"?l.push(new Be(b,A.source,'layer "'+A.id+'" requires a raster source')):_e==="raster"&&N!=="raster"?l.push(new Be(b,A.source,'layer "'+A.id+'" requires a vector source')):_e!=="vector"||A["source-layer"]?_e==="raster-dem"&&N!=="hillshade"?l.push(new Be(b,A.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!A.paint||!A.paint["line-gradient"]||_e==="geojson"&&ue.lineMetrics||l.push(new Be(b,A,'layer "'+A.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):l.push(new Be(b,A,'layer "'+A.id+'" must specify a "source-layer"')):l.push(new Be(b,A.source,'source "'+A.source+'" not found'))}else l.push(new Be(b,A,'missing required property "source"'));return l=l.concat(Ms({key:b,value:A,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return sn({key:b+".type",value:A.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:A,objectKey:"type"})},filter:Ua,layout:function(Ne){return Ms({layer:A,key:Ne.key,value:Ne.value,style:Ne.style,styleSpec:Ne.styleSpec,objectElementValidators:{"*":function(ke){return cl(ce({layerType:N},ke))}}})},paint:function(Ne){return Ms({layer:A,key:Ne.key,value:Ne.value,style:Ne.style,styleSpec:Ne.styleSpec,objectElementValidators:{"*":function(ke){return Zu(ce({layerType:N},ke))}}})}}}))}function za(a){var l=a.value,A=a.key,b=In(l);return b!=="string"?[new Be(A,l,"string expected, "+b+" found")]:[]}var zn={promoteId:function(a){var l=a.key,A=a.value;if(In(A)==="string")return za({key:l,value:A});var b=[];for(var T in A)b.push.apply(b,za({key:l+"."+T,value:A[T]}));return b}};function Zl(a){var l=a.value,A=a.key,b=a.styleSpec,T=a.style;if(!l.type)return[new Be(A,l,'"type" is required')];var I,F=yt(l.type);switch(F){case"vector":case"raster":case"raster-dem":return Ms({key:A,value:l,valueSpec:b["source_"+F.replace("-","_")],style:a.style,styleSpec:b,objectElementValidators:zn});case"geojson":if(I=Ms({key:A,value:l,valueSpec:b.source_geojson,style:T,styleSpec:b,objectElementValidators:zn}),l.cluster)for(var N in l.clusterProperties){var V=l.clusterProperties[N],X=V[0],Q=typeof X=="string"?[X,["accumulated"],["get",N]]:X;I.push.apply(I,Na({key:A+"."+N+".map",value:V[1],expressionContext:"cluster-map"})),I.push.apply(I,Na({key:A+"."+N+".reduce",value:Q,expressionContext:"cluster-reduce"}))}return I;case"video":return Ms({key:A,value:l,valueSpec:b.source_video,style:T,styleSpec:b});case"image":return Ms({key:A,value:l,valueSpec:b.source_image,style:T,styleSpec:b});case"canvas":return[new Be(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _c({key:A+".type",value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Uo(a){var l=a.value,A=a.styleSpec,b=A.light,T=a.style,I=[],F=In(l);if(l===void 0)return I;if(F!=="object")return I.concat([new Be("light",l,"object expected, "+F+" found")]);for(var N in l){var V=N.match(/^(.*)-transition$/);I=I.concat(V&&b[V[1]]&&b[V[1]].transition?sn({key:N,value:l[N],valueSpec:A.transition,style:T,styleSpec:A}):b[N]?sn({key:N,value:l[N],valueSpec:b[N],style:T,styleSpec:A}):[new Be(N,l[N],'unknown property "'+N+'"')])}return I}var zo={"*":function(){return[]},array:La,boolean:function(a){var l=a.value,A=a.key,b=In(l);return b!=="boolean"?[new Be(A,l,"boolean expected, "+b+" found")]:[]},number:gc,color:function(a){var l=a.key,A=a.value,b=In(A);return b!=="string"?[new Be(l,A,"color expected, "+b+" found")]:jt(A)===null?[new Be(l,A,'color expected, "'+A+'" found')]:[]},constants:p,enum:_c,filter:Ua,function:mc,layer:yh,object:Ms,source:Zl,light:Uo,string:za,formatted:function(a){return za(a).length===0?[]:Na(a)},resolvedImage:function(a){return za(a).length===0?[]:Na(a)}};function sn(a){var l=a.value,A=a.valueSpec,b=a.styleSpec;return A.expression&&Wl(yt(l))?mc(a):A.expression&&lo(Xe(l))?Na(a):A.type&&zo[A.type]?zo[A.type](a):Ms(ce({},a,{valueSpec:A.type?b[A.type]:A}))}function Mn(a){var l=a.value,A=a.key,b=za(a);return b.length||(l.indexOf("{fontstack}")===-1&&b.push(new Be(A,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&b.push(new Be(A,l,'"glyphs" url must include a "{range}" token'))),b}function Ps(a,l){l===void 0&&(l=ae);var A=[];return A=A.concat(sn({key:"",value:a,valueSpec:l.$root,styleSpec:l,style:a,objectElementValidators:{glyphs:Mn,"*":function(){return[]}}})),a.constants&&(A=A.concat(p({key:"constants",value:a.constants}))),ll(A)}function ll(a){return[].concat(a).sort(function(l,A){return l.line-A.line})}function vc(a){return function(){for(var l=[],A=arguments.length;A--;)l[A]=arguments[A];return ll(a.apply(this,l))}}Ps.source=vc(Zl),Ps.light=vc(Uo),Ps.layer=vc(yh),Ps.filter=vc(Ua),Ps.paintProperty=vc(Zu),Ps.layoutProperty=vc(cl);var ul=Ps,LA=ul.light,NA=ul.paintProperty,bc=ul.layoutProperty;function fl(a,l){var A=!1;if(l&&l.length)for(var b=0,T=l;b<T.length;b+=1)a.fire(new fe(new Error(T[b].message))),A=!0;return A}var yo=Pn;function Pn(a,l,A){var b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(l=T[1])+2*(A=T[2]);for(var I=0;I<this.d*this.d;I++){var F=T[3+I],N=T[3+I+1];b.push(F===N?null:T.subarray(F,N))}var V=T[3+b.length+1];this.keys=T.subarray(T[3+b.length],V),this.bboxes=T.subarray(V),this.insert=this._insertReadonly}else{this.d=l+2*A;for(var X=0;X<this.d*this.d;X++)b.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=a,this.padding=A,this.scale=l/a,this.uid=0;var Q=A/l*a;this.min=-Q,this.max=a+Q}Pn.prototype.insert=function(a,l,A,b,T){this._forEachCell(l,A,b,T,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(l),this.bboxes.push(A),this.bboxes.push(b),this.bboxes.push(T)},Pn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Pn.prototype._insertCell=function(a,l,A,b,T,I){this.cells[T].push(I)},Pn.prototype.query=function(a,l,A,b,T){var I=this.min,F=this.max;if(a<=I&&l<=I&&F<=A&&F<=b&&!T)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,l,A,b,this._queryCell,N,{},T),N},Pn.prototype._queryCell=function(a,l,A,b,T,I,F,N){var V=this.cells[T];if(V!==null)for(var X=this.keys,Q=this.bboxes,ie=0;ie<V.length;ie++){var ue=V[ie];if(F[ue]===void 0){var _e=4*ue;(N?N(Q[_e+0],Q[_e+1],Q[_e+2],Q[_e+3]):a<=Q[_e+2]&&l<=Q[_e+3]&&A>=Q[_e+0]&&b>=Q[_e+1])?(F[ue]=!0,I.push(X[ue])):F[ue]=!1}}},Pn.prototype._forEachCell=function(a,l,A,b,T,I,F,N){for(var V=this._convertToCellCoord(a),X=this._convertToCellCoord(l),Q=this._convertToCellCoord(A),ie=this._convertToCellCoord(b),ue=V;ue<=Q;ue++)for(var _e=X;_e<=ie;_e++){var Ne=this.d*_e+ue;if((!N||N(this._convertFromCellCoord(ue),this._convertFromCellCoord(_e),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(_e+1)))&&T.call(this,a,l,A,b,Ne,I,F,N))return}},Pn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Pn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Pn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,l=3+this.cells.length+1+1,A=0,b=0;b<this.cells.length;b++)A+=this.cells[b].length;var T=new Int32Array(l+A+this.keys.length+this.bboxes.length);T[0]=this.extent,T[1]=this.n,T[2]=this.padding;for(var I=l,F=0;F<a.length;F++){var N=a[F];T[3+F]=I,T.set(N,I),I+=N.length}return T[3+a.length]=I,T.set(this.keys,I),T[3+a.length+1]=I+=this.keys.length,T.set(this.bboxes,I),I+=this.bboxes.length,T.buffer};var xc=S.ImageData,vh=S.ImageBitmap,gi={};function rr(a,l,A){A===void 0&&(A={}),Object.defineProperty(l,"_classRegistryKey",{value:a,writeable:!1}),gi[a]={klass:l,omit:A.omit||[],shallow:A.shallow||[]}}for(var ms in rr("Object",Object),yo.serialize=function(a,l){var A=a.toArrayBuffer();return l&&l.push(A),{buffer:A}},yo.deserialize=function(a){return new yo(a.buffer)},rr("Grid",yo),rr("Color",qr),rr("Error",Error),rr("ResolvedImage",kn),rr("StylePropertyFunction",Oa),rr("StyleExpression",da,{omit:["_evaluator"]}),rr("ZoomDependentExpression",pc),rr("ZoomConstantExpression",Da),rr("CompoundExpression",Pe,{omit:["_evaluate"]}),js)js[ms]._classRegistryKey||rr("Expression_"+ms,js[ms]);function Ql(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Rs(a){return vh&&a instanceof vh}function $s(a,l){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Ql(a)||Rs(a))return l&&l.push(a),a;if(ArrayBuffer.isView(a)){var A=a;return l&&l.push(A.buffer),A}if(a instanceof xc)return l&&l.push(a.data.buffer),a;if(Array.isArray(a)){for(var b=[],T=0,I=a;T<I.length;T+=1)b.push($s(I[T],l));return b}if(typeof a=="object"){var F=a.constructor,N=F._classRegistryKey;if(!N)throw new Error("can't serialize object of unregistered class");var V=F.serialize?F.serialize(a,l):{};if(!F.serialize){for(var X in a)if(a.hasOwnProperty(X)&&!(gi[N].omit.indexOf(X)>=0)){var Q=a[X];V[X]=gi[N].shallow.indexOf(X)>=0?Q:$s(Q,l)}a instanceof Error&&(V.message=a.message)}if(V.$name)throw new Error("$name property is reserved for worker serialization logic.");return N!=="Object"&&(V.$name=N),V}throw new Error("can't serialize object of type "+typeof a)}function cs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Ql(a)||Rs(a)||ArrayBuffer.isView(a)||a instanceof xc)return a;if(Array.isArray(a))return a.map(cs);if(typeof a=="object"){var l=a.$name||"Object",A=gi[l].klass;if(!A)throw new Error("can't deserialize unregistered class "+l);if(A.deserialize)return A.deserialize(a);for(var b=Object.create(A.prototype),T=0,I=Object.keys(a);T<I.length;T+=1){var F=I[T];if(F!=="$name"){var N=a[F];b[F]=gi[l].shallow.indexOf(F)>=0?N:cs(N)}}return b}throw new Error("can't deserialize object of type "+typeof a)}var Qu=function(){this.first=!0};Qu.prototype.update=function(a,l){var A=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=A,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=A,!0):(this.lastFloorZoom>A?(this.lastIntegerZoom=A+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<A&&(this.lastIntegerZoom=A,this.lastIntegerZoomTime=l),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=A,!0))};var Jt={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function ef(a){for(var l=0,A=a;l<A.length;l+=1)if(eu(A[l].charCodeAt(0)))return!0;return!1}function eu(a){return!(a!==746&&a!==747&&(a<4352||!(Jt["Bopomofo Extended"](a)||Jt.Bopomofo(a)||Jt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Jt["CJK Compatibility Ideographs"](a)||Jt["CJK Compatibility"](a)||Jt["CJK Radicals Supplement"](a)||Jt["CJK Strokes"](a)||!(!Jt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Jt["CJK Unified Ideographs Extension A"](a)||Jt["CJK Unified Ideographs"](a)||Jt["Enclosed CJK Letters and Months"](a)||Jt["Hangul Compatibility Jamo"](a)||Jt["Hangul Jamo Extended-A"](a)||Jt["Hangul Jamo Extended-B"](a)||Jt["Hangul Jamo"](a)||Jt["Hangul Syllables"](a)||Jt.Hiragana(a)||Jt["Ideographic Description Characters"](a)||Jt.Kanbun(a)||Jt["Kangxi Radicals"](a)||Jt["Katakana Phonetic Extensions"](a)||Jt.Katakana(a)&&a!==12540||!(!Jt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Jt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Jt["Unified Canadian Aboriginal Syllabics"](a)||Jt["Unified Canadian Aboriginal Syllabics Extended"](a)||Jt["Vertical Forms"](a)||Jt["Yijing Hexagram Symbols"](a)||Jt["Yi Syllables"](a)||Jt["Yi Radicals"](a))))}function tf(a){return!(eu(a)||function(l){return!!(Jt["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Jt["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Jt["Letterlike Symbols"](l)||Jt["Number Forms"](l)||Jt["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Jt["Control Pictures"](l)&&l!==9251||Jt["Optical Character Recognition"](l)||Jt["Enclosed Alphanumerics"](l)||Jt["Geometric Shapes"](l)||Jt["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Jt["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Jt["CJK Symbols and Punctuation"](l)||Jt.Katakana(l)||Jt["Private Use Area"](l)||Jt["CJK Compatibility Forms"](l)||Jt["Small Form Variants"](l)||Jt["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(a))}function Ws(a){return a>=1424&&a<=2303||Jt["Arabic Presentation Forms-A"](a)||Jt["Arabic Presentation Forms-B"](a)}function _s(a,l){return!(!l&&Ws(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Jt.Khmer(a))}function tu(a){for(var l=0,A=a;l<A.length;l+=1)if(Ws(A[l].charCodeAt(0)))return!0;return!1}var ru=null,ys="unavailable",Go=null,rf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ys="error"),ru&&ru(a)};function wc(){mi.fire(new De("pluginStateChange",{pluginStatus:ys,pluginURL:Go}))}var mi=new be,nf=function(){return ys},uo=function(){if(ys!=="deferred"||!Go)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ys="loading",wc(),Go&&We({url:Go},function(a){a?rf(a):(ys="loaded",wc())})},Ki={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ys==="loaded"||Ki.applyArabicShaping!=null},isLoading:function(){return ys==="loading"},setState:function(a){ys=a.pluginStatus,Go=a.pluginURL},isParsed:function(){return Ki.applyArabicShaping!=null&&Ki.processBidirectionalText!=null&&Ki.processStyledBidirectionalText!=null},getPluginURL:function(){return Go}},kr=function(a,l){this.zoom=a,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qu,this.transition={})};kr.prototype.isSupportedScript=function(a){return function(l,A){for(var b=0,T=l;b<T.length;b+=1)if(!_s(T[b].charCodeAt(0),A))return!1;return!0}(a,Ki.isLoaded())},kr.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},kr.prototype.getCrossfadeParameters=function(){var a=this.zoom,l=a-Math.floor(a),A=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*A}:{fromScale:.5,toScale:1,t:1-(1-A)*l}};var vo=function(a,l){this.property=a,this.value=l,this.expression=function(A,b){if(Wl(A))return new Oa(A,b);if(lo(A)){var T=Is(A,b);if(T.result==="error")throw new Error(T.value.map(function(F){return F.key+": "+F.message}).join(", "));return T.value}var I=A;return typeof A=="string"&&b.type==="color"&&(I=qr.parse(A)),{kind:"constant",evaluate:function(){return I}}}(l===void 0?a.specification.default:l,a.specification)};vo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},vo.prototype.possiblyEvaluate=function(a,l,A){return this.property.possiblyEvaluate(this,a,l,A)};var Js=function(a){this.property=a,this.value=new vo(a,void 0)};Js.prototype.transitioned=function(a,l){return new Aa(this.property,this.value,l,H({},a.transition,this.transition),a.now)},Js.prototype.untransitioned=function(){return new Aa(this.property,this.value,null,{},0)};var zi=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};zi.prototype.getValue=function(a){return Ae(this._values[a].value.value)},zi.prototype.setValue=function(a,l){this._values.hasOwnProperty(a)||(this._values[a]=new Js(this._values[a].property)),this._values[a].value=new vo(this._values[a].property,l===null?void 0:Ae(l))},zi.prototype.getTransition=function(a){return Ae(this._values[a].transition)},zi.prototype.setTransition=function(a,l){this._values.hasOwnProperty(a)||(this._values[a]=new Js(this._values[a].property)),this._values[a].transition=Ae(l)||void 0},zi.prototype.serialize=function(){for(var a={},l=0,A=Object.keys(this._values);l<A.length;l+=1){var b=A[l],T=this.getValue(b);T!==void 0&&(a[b]=T);var I=this.getTransition(b);I!==void 0&&(a[b+"-transition"]=I)}return a},zi.prototype.transitioned=function(a,l){for(var A=new Vo(this._properties),b=0,T=Object.keys(this._values);b<T.length;b+=1){var I=T[b];A._values[I]=this._values[I].transitioned(a,l._values[I])}return A},zi.prototype.untransitioned=function(){for(var a=new Vo(this._properties),l=0,A=Object.keys(this._values);l<A.length;l+=1){var b=A[l];a._values[b]=this._values[b].untransitioned()}return a};var Aa=function(a,l,A,b,T){this.property=a,this.value=l,this.begin=T+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=A)};Aa.prototype.possiblyEvaluate=function(a,l,A){var b=a.now||0,T=this.value.possiblyEvaluate(a,l,A),I=this.prior;if(I){if(b>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(b<this.begin)return I.possiblyEvaluate(a,l,A);var F=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,l,A),T,function(N){if(N<=0)return 0;if(N>=1)return 1;var V=N*N,X=V*N;return 4*(N<.5?X:3*(N-V)+X-.75)}(F))}return T};var Vo=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};Vo.prototype.possiblyEvaluate=function(a,l,A){for(var b=new hl(this._properties),T=0,I=Object.keys(this._values);T<I.length;T+=1){var F=I[T];b._values[F]=this._values[F].possiblyEvaluate(a,l,A)}return b},Vo.prototype.hasTransition=function(){for(var a=0,l=Object.keys(this._values);a<l.length;a+=1)if(this._values[l[a]].prior)return!0;return!1};var Xs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};Xs.prototype.getValue=function(a){return Ae(this._values[a].value)},Xs.prototype.setValue=function(a,l){this._values[a]=new vo(this._values[a].property,l===null?void 0:Ae(l))},Xs.prototype.serialize=function(){for(var a={},l=0,A=Object.keys(this._values);l<A.length;l+=1){var b=A[l],T=this.getValue(b);T!==void 0&&(a[b]=T)}return a},Xs.prototype.possiblyEvaluate=function(a,l,A){for(var b=new hl(this._properties),T=0,I=Object.keys(this._values);T<I.length;T+=1){var F=I[T];b._values[F]=this._values[F].possiblyEvaluate(a,l,A)}return b};var qi=function(a,l,A){this.property=a,this.value=l,this.parameters=A};qi.prototype.isConstant=function(){return this.value.kind==="constant"},qi.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},qi.prototype.evaluate=function(a,l,A,b){return this.property.evaluate(this.value,this.parameters,a,l,A,b)};var hl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};hl.prototype.get=function(a){return this._values[a]};var _r=function(a){this.specification=a};_r.prototype.possiblyEvaluate=function(a,l){return a.expression.evaluate(l)},_r.prototype.interpolate=function(a,l,A){var b=Ia[this.specification.type];return b?b(a,l,A):a};var or=function(a,l){this.specification=a,this.overrides=l};or.prototype.possiblyEvaluate=function(a,l,A,b){return new qi(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(l,null,{},A,b)}:a.expression,l)},or.prototype.interpolate=function(a,l,A){if(a.value.kind!=="constant"||l.value.kind!=="constant")return a;if(a.value.value===void 0||l.value.value===void 0)return new qi(this,{kind:"constant",value:void 0},a.parameters);var b=Ia[this.specification.type];return b?new qi(this,{kind:"constant",value:b(a.value.value,l.value.value,A)},a.parameters):a},or.prototype.evaluate=function(a,l,A,b,T,I){return a.kind==="constant"?a.value:a.evaluate(l,A,b,T,I)};var nu=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.possiblyEvaluate=function(A,b,T,I){if(A.value===void 0)return new qi(this,{kind:"constant",value:void 0},b);if(A.expression.kind==="constant"){var F=A.expression.evaluate(b,null,{},T,I),N=A.property.specification.type==="resolvedImage"&&typeof F!="string"?F.name:F,V=this._calculate(N,N,N,b);return new qi(this,{kind:"constant",value:V},b)}if(A.expression.kind==="camera"){var X=this._calculate(A.expression.evaluate({zoom:b.zoom-1}),A.expression.evaluate({zoom:b.zoom}),A.expression.evaluate({zoom:b.zoom+1}),b);return new qi(this,{kind:"constant",value:X},b)}return new qi(this,A.expression,b)},l.prototype.evaluate=function(A,b,T,I,F,N){if(A.kind==="source"){var V=A.evaluate(b,T,I,F,N);return this._calculate(V,V,V,b)}return A.kind==="composite"?this._calculate(A.evaluate({zoom:Math.floor(b.zoom)-1},T,I),A.evaluate({zoom:Math.floor(b.zoom)},T,I),A.evaluate({zoom:Math.floor(b.zoom)+1},T,I),b):A.value},l.prototype._calculate=function(A,b,T,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:A,to:b}:{from:T,to:b}},l.prototype.interpolate=function(A){return A},l}(or),rs=function(a){this.specification=a};rs.prototype.possiblyEvaluate=function(a,l,A,b){if(a.value!==void 0){if(a.expression.kind==="constant"){var T=a.expression.evaluate(l,null,{},A,b);return this._calculate(T,T,T,l)}return this._calculate(a.expression.evaluate(new kr(Math.floor(l.zoom-1),l)),a.expression.evaluate(new kr(Math.floor(l.zoom),l)),a.expression.evaluate(new kr(Math.floor(l.zoom+1),l)),l)}},rs.prototype._calculate=function(a,l,A,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:l}:{from:A,to:l}},rs.prototype.interpolate=function(a){return a};var Gi=function(a){this.specification=a};Gi.prototype.possiblyEvaluate=function(a,l,A,b){return!!a.expression.evaluate(l,null,{},A,b)},Gi.prototype.interpolate=function(){return!1};var Gn=function(a){for(var l in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var A=a[l];A.specification.overridable&&this.overridableProperties.push(l);var b=this.defaultPropertyValues[l]=new vo(A,void 0),T=this.defaultTransitionablePropertyValues[l]=new Js(A);this.defaultTransitioningPropertyValues[l]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=b.possiblyEvaluate({})}};rr("DataDrivenProperty",or),rr("DataConstantProperty",_r),rr("CrossFadedDataDrivenProperty",nu),rr("CrossFadedProperty",rs),rr("ColorRampProperty",Gi);var Or=function(a){function l(A,b){if(a.call(this),this.id=A.id,this.type=A.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},A.type!=="custom"&&(this.metadata=(A=A).metadata,this.minzoom=A.minzoom,this.maxzoom=A.maxzoom,A.type!=="background"&&(this.source=A.source,this.sourceLayer=A["source-layer"],this.filter=A.filter),b.layout&&(this._unevaluatedLayout=new Xs(b.layout)),b.paint)){for(var T in this._transitionablePaint=new zi(b.paint),A.paint)this.setPaintProperty(T,A.paint[T],{validate:!1});for(var I in A.layout)this.setLayoutProperty(I,A.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hl(b.paint)}}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},l.prototype.getLayoutProperty=function(A){return A==="visibility"?this.visibility:this._unevaluatedLayout.getValue(A)},l.prototype.setLayoutProperty=function(A,b,T){T===void 0&&(T={}),b!=null&&this._validate(bc,"layers."+this.id+".layout."+A,A,b,T)||(A!=="visibility"?this._unevaluatedLayout.setValue(A,b):this.visibility=b)},l.prototype.getPaintProperty=function(A){return ze(A,"-transition")?this._transitionablePaint.getTransition(A.slice(0,-11)):this._transitionablePaint.getValue(A)},l.prototype.setPaintProperty=function(A,b,T){if(T===void 0&&(T={}),b!=null&&this._validate(NA,"layers."+this.id+".paint."+A,A,b,T))return!1;if(ze(A,"-transition"))return this._transitionablePaint.setTransition(A.slice(0,-11),b||void 0),!1;var I=this._transitionablePaint._values[A],F=I.property.specification["property-type"]==="cross-faded-data-driven",N=I.value.isDataDriven(),V=I.value;this._transitionablePaint.setValue(A,b),this._handleSpecialPaintPropertyUpdate(A);var X=this._transitionablePaint._values[A].value;return X.isDataDriven()||N||F||this._handleOverridablePaintPropertyUpdate(A,V,X)},l.prototype._handleSpecialPaintPropertyUpdate=function(A){},l.prototype._handleOverridablePaintPropertyUpdate=function(A,b,T){return!1},l.prototype.isHidden=function(A){return!!(this.minzoom&&A<this.minzoom)||!!(this.maxzoom&&A>=this.maxzoom)||this.visibility==="none"},l.prototype.updateTransitions=function(A){this._transitioningPaint=this._transitionablePaint.transitioned(A,this._transitioningPaint)},l.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},l.prototype.recalculate=function(A,b){A.getCrossfadeParameters&&(this._crossfadeParameters=A.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(A,void 0,b)),this.paint=this._transitioningPaint.possiblyEvaluate(A,void 0,b)},l.prototype.serialize=function(){var A={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(A.layout=A.layout||{},A.layout.visibility=this.visibility),ve(A,function(b,T){return!(b===void 0||T==="layout"&&!Object.keys(b).length||T==="paint"&&!Object.keys(b).length)})},l.prototype._validate=function(A,b,T,I,F){return F===void 0&&(F={}),(!F||F.validate!==!1)&&fl(this,A.call(ul,{key:b,layerType:this.type,objectKey:T,value:I,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))},l.prototype.is3D=function(){return!1},l.prototype.isTileClipped=function(){return!1},l.prototype.hasOffscreenPass=function(){return!1},l.prototype.resize=function(){},l.prototype.isStateDependent=function(){for(var A in this.paint._values){var b=this.paint.get(A);if(b instanceof qi&&ko(b.property.specification)&&(b.value.kind==="source"||b.value.kind==="composite")&&b.value.isStateDependent)return!0}return!1},l}(be),Ks={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ln=function(a,l){this._structArray=a,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},jr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ii(a,l){l===void 0&&(l=1);var A=0,b=0;return{members:a.map(function(T){var I=Ks[T.type].BYTES_PER_ELEMENT,F=A=iu(A,Math.max(l,I)),N=T.components||1;return b=Math.max(b,I),A+=I*N,{name:T.name,type:T.type,components:N,offset:F}}),size:iu(A,Math.max(b,l)),alignment:l}}function iu(a,l){return Math.ceil(a/l)*l}jr.serialize=function(a,l){return a._trim(),l&&(a.isTransferred=!0,l.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},jr.deserialize=function(a){var l=Object.create(this.prototype);return l.arrayBuffer=a.arrayBuffer,l.length=a.length,l.capacity=a.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l},jr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},jr.prototype.clear=function(){this.length=0},jr.prototype.resize=function(a){this.reserve(a),this.length=a},jr.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}},jr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Fs=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b){var T=this.length;return this.resize(T+1),this.emplace(T,A,b)},l.prototype.emplace=function(A,b,T){var I=2*A;return this.int16[I+0]=b,this.int16[I+1]=T,A},l}(jr);Fs.prototype.bytesPerElement=4,rr("StructArrayLayout2i4",Fs);var sf=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I){var F=this.length;return this.resize(F+1),this.emplace(F,A,b,T,I)},l.prototype.emplace=function(A,b,T,I,F){var N=4*A;return this.int16[N+0]=b,this.int16[N+1]=T,this.int16[N+2]=I,this.int16[N+3]=F,A},l}(jr);sf.prototype.bytesPerElement=8,rr("StructArrayLayout4i8",sf);var si=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N){var V=this.length;return this.resize(V+1),this.emplace(V,A,b,T,I,F,N)},l.prototype.emplace=function(A,b,T,I,F,N,V){var X=6*A;return this.int16[X+0]=b,this.int16[X+1]=T,this.int16[X+2]=I,this.int16[X+3]=F,this.int16[X+4]=N,this.int16[X+5]=V,A},l}(jr);si.prototype.bytesPerElement=12,rr("StructArrayLayout2i4i12",si);var Yi=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N){var V=this.length;return this.resize(V+1),this.emplace(V,A,b,T,I,F,N)},l.prototype.emplace=function(A,b,T,I,F,N,V){var X=4*A,Q=8*A;return this.int16[X+0]=b,this.int16[X+1]=T,this.uint8[Q+4]=I,this.uint8[Q+5]=F,this.uint8[Q+6]=N,this.uint8[Q+7]=V,A},l}(jr);Yi.prototype.bytesPerElement=8,rr("StructArrayLayout2i4ub8",Yi);var fo=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b){var T=this.length;return this.resize(T+1),this.emplace(T,A,b)},l.prototype.emplace=function(A,b,T){var I=2*A;return this.float32[I+0]=b,this.float32[I+1]=T,A},l}(jr);fo.prototype.bytesPerElement=8,rr("StructArrayLayout2f8",fo);var ho=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N,V,X,Q,ie){var ue=this.length;return this.resize(ue+1),this.emplace(ue,A,b,T,I,F,N,V,X,Q,ie)},l.prototype.emplace=function(A,b,T,I,F,N,V,X,Q,ie,ue){var _e=10*A;return this.uint16[_e+0]=b,this.uint16[_e+1]=T,this.uint16[_e+2]=I,this.uint16[_e+3]=F,this.uint16[_e+4]=N,this.uint16[_e+5]=V,this.uint16[_e+6]=X,this.uint16[_e+7]=Q,this.uint16[_e+8]=ie,this.uint16[_e+9]=ue,A},l}(jr);ho.prototype.bytesPerElement=20,rr("StructArrayLayout10ui20",ho);var Ht=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N,V,X,Q,ie,ue,_e){var Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,A,b,T,I,F,N,V,X,Q,ie,ue,_e)},l.prototype.emplace=function(A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne){var ke=12*A;return this.int16[ke+0]=b,this.int16[ke+1]=T,this.int16[ke+2]=I,this.int16[ke+3]=F,this.uint16[ke+4]=N,this.uint16[ke+5]=V,this.uint16[ke+6]=X,this.uint16[ke+7]=Q,this.int16[ke+8]=ie,this.int16[ke+9]=ue,this.int16[ke+10]=_e,this.int16[ke+11]=Ne,A},l}(jr);Ht.prototype.bytesPerElement=24,rr("StructArrayLayout4i4ui4i24",Ht);var Yt=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,A,b,T)},l.prototype.emplace=function(A,b,T,I){var F=3*A;return this.float32[F+0]=b,this.float32[F+1]=T,this.float32[F+2]=I,A},l}(jr);Yt.prototype.bytesPerElement=12,rr("StructArrayLayout3f12",Yt);var Cc=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A){var b=this.length;return this.resize(b+1),this.emplace(b,A)},l.prototype.emplace=function(A,b){return this.uint32[1*A+0]=b,A},l}(jr);Cc.prototype.bytesPerElement=4,rr("StructArrayLayout1ul4",Cc);var dl=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N,V,X,Q){var ie=this.length;return this.resize(ie+1),this.emplace(ie,A,b,T,I,F,N,V,X,Q)},l.prototype.emplace=function(A,b,T,I,F,N,V,X,Q,ie){var ue=10*A,_e=5*A;return this.int16[ue+0]=b,this.int16[ue+1]=T,this.int16[ue+2]=I,this.int16[ue+3]=F,this.int16[ue+4]=N,this.int16[ue+5]=V,this.uint32[_e+3]=X,this.uint16[ue+8]=Q,this.uint16[ue+9]=ie,A},l}(jr);dl.prototype.bytesPerElement=20,rr("StructArrayLayout6i1ul2ui20",dl);var Ho=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N){var V=this.length;return this.resize(V+1),this.emplace(V,A,b,T,I,F,N)},l.prototype.emplace=function(A,b,T,I,F,N,V){var X=6*A;return this.int16[X+0]=b,this.int16[X+1]=T,this.int16[X+2]=I,this.int16[X+3]=F,this.int16[X+4]=N,this.int16[X+5]=V,A},l}(jr);Ho.prototype.bytesPerElement=12,rr("StructArrayLayout2i2i2i12",Ho);var bo=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F){var N=this.length;return this.resize(N+1),this.emplace(N,A,b,T,I,F)},l.prototype.emplace=function(A,b,T,I,F,N){var V=4*A,X=8*A;return this.float32[V+0]=b,this.float32[V+1]=T,this.float32[V+2]=I,this.int16[X+6]=F,this.int16[X+7]=N,A},l}(jr);bo.prototype.bytesPerElement=16,rr("StructArrayLayout2f1f2i16",bo);var jo=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I){var F=this.length;return this.resize(F+1),this.emplace(F,A,b,T,I)},l.prototype.emplace=function(A,b,T,I,F){var N=12*A,V=3*A;return this.uint8[N+0]=b,this.uint8[N+1]=T,this.float32[V+1]=I,this.float32[V+2]=F,A},l}(jr);jo.prototype.bytesPerElement=12,rr("StructArrayLayout2ub2f12",jo);var $o=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,A,b,T)},l.prototype.emplace=function(A,b,T,I){var F=3*A;return this.uint16[F+0]=b,this.uint16[F+1]=T,this.uint16[F+2]=I,A},l}(jr);$o.prototype.bytesPerElement=6,rr("StructArrayLayout3ui6",$o);var ls=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke,He,Ge,Ke){var ot=this.length;return this.resize(ot+1),this.emplace(ot,A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke,He,Ge,Ke)},l.prototype.emplace=function(A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke,He,Ge,Ke,ot){var At=24*A,gt=12*A,Mt=48*A;return this.int16[At+0]=b,this.int16[At+1]=T,this.uint16[At+2]=I,this.uint16[At+3]=F,this.uint32[gt+2]=N,this.uint32[gt+3]=V,this.uint32[gt+4]=X,this.uint16[At+10]=Q,this.uint16[At+11]=ie,this.uint16[At+12]=ue,this.float32[gt+7]=_e,this.float32[gt+8]=Ne,this.uint8[Mt+36]=ke,this.uint8[Mt+37]=He,this.uint8[Mt+38]=Ge,this.uint32[gt+10]=Ke,this.int16[At+22]=ot,A},l}(jr);ls.prototype.bytesPerElement=48,rr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ls);var _=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke,He,Ge,Ke,ot,At,gt,Mt,zt,Wt,gr,Qt,xr,er,Qr){var Pr=this.length;return this.resize(Pr+1),this.emplace(Pr,A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke,He,Ge,Ke,ot,At,gt,Mt,zt,Wt,gr,Qt,xr,er,Qr)},l.prototype.emplace=function(A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke,He,Ge,Ke,ot,At,gt,Mt,zt,Wt,gr,Qt,xr,er,Qr,Pr){var cr=34*A,on=17*A;return this.int16[cr+0]=b,this.int16[cr+1]=T,this.int16[cr+2]=I,this.int16[cr+3]=F,this.int16[cr+4]=N,this.int16[cr+5]=V,this.int16[cr+6]=X,this.int16[cr+7]=Q,this.uint16[cr+8]=ie,this.uint16[cr+9]=ue,this.uint16[cr+10]=_e,this.uint16[cr+11]=Ne,this.uint16[cr+12]=ke,this.uint16[cr+13]=He,this.uint16[cr+14]=Ge,this.uint16[cr+15]=Ke,this.uint16[cr+16]=ot,this.uint16[cr+17]=At,this.uint16[cr+18]=gt,this.uint16[cr+19]=Mt,this.uint16[cr+20]=zt,this.uint16[cr+21]=Wt,this.uint16[cr+22]=gr,this.uint32[on+12]=Qt,this.float32[on+13]=xr,this.float32[on+14]=er,this.float32[on+15]=Qr,this.float32[on+16]=Pr,A},l}(jr);_.prototype.bytesPerElement=68,rr("StructArrayLayout8i15ui1ul4f68",_);var m=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A){var b=this.length;return this.resize(b+1),this.emplace(b,A)},l.prototype.emplace=function(A,b){return this.float32[1*A+0]=b,A},l}(jr);m.prototype.bytesPerElement=4,rr("StructArrayLayout1f4",m);var v=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,A,b,T)},l.prototype.emplace=function(A,b,T,I){var F=3*A;return this.int16[F+0]=b,this.int16[F+1]=T,this.int16[F+2]=I,A},l}(jr);v.prototype.bytesPerElement=6,rr("StructArrayLayout3i6",v);var w=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T){var I=this.length;return this.resize(I+1),this.emplace(I,A,b,T)},l.prototype.emplace=function(A,b,T,I){var F=4*A;return this.uint32[2*A+0]=b,this.uint16[F+2]=T,this.uint16[F+3]=I,A},l}(jr);w.prototype.bytesPerElement=8,rr("StructArrayLayout1ul2ui8",w);var B=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b){var T=this.length;return this.resize(T+1),this.emplace(T,A,b)},l.prototype.emplace=function(A,b,T){var I=2*A;return this.uint16[I+0]=b,this.uint16[I+1]=T,A},l}(jr);B.prototype.bytesPerElement=4,rr("StructArrayLayout2ui4",B);var M=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A){var b=this.length;return this.resize(b+1),this.emplace(b,A)},l.prototype.emplace=function(A,b){return this.uint16[1*A+0]=b,A},l}(jr);M.prototype.bytesPerElement=2,rr("StructArrayLayout1ui2",M);var D=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},l.prototype.emplaceBack=function(A,b,T,I){var F=this.length;return this.resize(F+1),this.emplace(F,A,b,T,I)},l.prototype.emplace=function(A,b,T,I,F){var N=4*A;return this.float32[N+0]=b,this.float32[N+1]=T,this.float32[N+2]=I,this.float32[N+3]=F,A},l}(jr);D.prototype.bytesPerElement=16,rr("StructArrayLayout4f16",D);var c=function(a){function l(){a.apply(this,arguments)}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var A={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return A.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},A.x1.get=function(){return this._structArray.int16[this._pos2+2]},A.y1.get=function(){return this._structArray.int16[this._pos2+3]},A.x2.get=function(){return this._structArray.int16[this._pos2+4]},A.y2.get=function(){return this._structArray.int16[this._pos2+5]},A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.anchorPoint.get=function(){return new x(this.anchorPointX,this.anchorPointY)},Object.defineProperties(l.prototype,A),l}(ln);c.prototype.size=20;var h=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.get=function(A){return new c(this,A)},l}(dl);rr("CollisionBoxArray",h);var f=function(a){function l(){a.apply(this,arguments)}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},A.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},A.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},A.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},A.segment.get=function(){return this._structArray.uint16[this._pos2+10]},A.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},A.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},A.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},A.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},A.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},A.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},A.placedOrientation.set=function(b){this._structArray.uint8[this._pos1+37]=b},A.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},A.hidden.set=function(b){this._structArray.uint8[this._pos1+38]=b},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},A.crossTileID.set=function(b){this._structArray.uint32[this._pos4+10]=b},A.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(l.prototype,A),l}(ln);f.prototype.size=48;var g=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.get=function(A){return new f(this,A)},l}(ls);rr("PlacedSymbolArray",g);var C=function(a){function l(){a.apply(this,arguments)}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var A={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return A.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},A.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},A.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},A.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},A.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},A.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},A.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},A.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},A.key.get=function(){return this._structArray.uint16[this._pos2+8]},A.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},A.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},A.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},A.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},A.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},A.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},A.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},A.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},A.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},A.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},A.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},A.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},A.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},A.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},A.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},A.crossTileID.set=function(b){this._structArray.uint32[this._pos4+12]=b},A.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},A.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},A.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},A.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(l.prototype,A),l}(ln);C.prototype.size=68;var P=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.get=function(A){return new C(this,A)},l}(_);rr("SymbolInstanceArray",P);var R=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getoffsetX=function(A){return this.float32[1*A+0]},l}(m);rr("GlyphOffsetArray",R);var L=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.getx=function(A){return this.int16[3*A+0]},l.prototype.gety=function(A){return this.int16[3*A+1]},l.prototype.gettileUnitDistanceFromAnchor=function(A){return this.int16[3*A+2]},l}(v);rr("SymbolLineVertexArray",L);var z=function(a){function l(){a.apply(this,arguments)}a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l;var A={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return A.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},A.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},A.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(l.prototype,A),l}(ln);z.prototype.size=8;var W=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.get=function(A){return new z(this,A)},l}(w);rr("FeatureIndexArray",W);var ee=Ii([{name:"a_pos",components:2,type:"Int16"}],4).members,Z=function(a){a===void 0&&(a=[]),this.segments=a};function te(a,l){return 256*(a=J(Math.floor(a),0,255))+J(Math.floor(l),0,255)}Z.prototype.prepareSegment=function(a,l,A,b){var T=this.segments[this.segments.length-1];return a>Z.MAX_VERTEX_ARRAY_LENGTH&&re("Max vertices per segment is "+Z.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!T||T.vertexLength+a>Z.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==b)&&(T={vertexOffset:l.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0},b!==void 0&&(T.sortKey=b),this.segments.push(T)),T},Z.prototype.get=function(){return this.segments},Z.prototype.destroy=function(){for(var a=0,l=this.segments;a<l.length;a+=1){var A=l[a];for(var b in A.vaos)A.vaos[b].destroy()}},Z.simpleSegment=function(a,l,A,b){return new Z([{vertexOffset:a,primitiveOffset:l,vertexLength:A,primitiveLength:b,vaos:{},sortKey:0}])},Z.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rr("SegmentVector",Z);var se=Ii([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),we=u(function(a){a.exports=function(l,A){var b,T,I,F,N,V,X,Q;for(T=l.length-(b=3&l.length),I=A,N=3432918353,V=461845907,Q=0;Q<T;)X=255&l.charCodeAt(Q)|(255&l.charCodeAt(++Q))<<8|(255&l.charCodeAt(++Q))<<16|(255&l.charCodeAt(++Q))<<24,++Q,I=27492+(65535&(F=5*(65535&(I=(I^=X=(65535&(X=(X=(65535&X)*N+(((X>>>16)*N&65535)<<16)&4294967295)<<15|X>>>17))*V+(((X>>>16)*V&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(F>>>16)&65535)<<16);switch(X=0,b){case 3:X^=(255&l.charCodeAt(Q+2))<<16;case 2:X^=(255&l.charCodeAt(Q+1))<<8;case 1:I^=X=(65535&(X=(X=(65535&(X^=255&l.charCodeAt(Q)))*N+(((X>>>16)*N&65535)<<16)&4294967295)<<15|X>>>17))*V+(((X>>>16)*V&65535)<<16)&4294967295}return I^=l.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),Fe=u(function(a){a.exports=function(l,A){for(var b,T=l.length,I=A^T,F=0;T>=4;)b=1540483477*(65535&(b=255&l.charCodeAt(F)|(255&l.charCodeAt(++F))<<8|(255&l.charCodeAt(++F))<<16|(255&l.charCodeAt(++F))<<24))+((1540483477*(b>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),T-=4,++F;switch(T){case 3:I^=(255&l.charCodeAt(F+2))<<16;case 2:I^=(255&l.charCodeAt(F+1))<<8;case 1:I=1540483477*(65535&(I^=255&l.charCodeAt(F)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),ge=we,Re=Fe;ge.murmur3=we,ge.murmur2=Re;var Ve=function(){this.ids=[],this.positions=[],this.indexed=!1};Ve.prototype.add=function(a,l,A,b){this.ids.push(rt(a)),this.positions.push(l,A,b)},Ve.prototype.getPositions=function(a){for(var l=rt(a),A=0,b=this.ids.length-1;A<b;){var T=A+b>>1;this.ids[T]>=l?b=T:A=T+1}for(var I=[];this.ids[A]===l;)I.push({index:this.positions[3*A],start:this.positions[3*A+1],end:this.positions[3*A+2]}),A++;return I},Ve.serialize=function(a,l){var A=new Float64Array(a.ids),b=new Uint32Array(a.positions);return function T(I,F,N,V){for(;N<V;){for(var X=I[N+V>>1],Q=N-1,ie=V+1;;){do Q++;while(I[Q]<X);do ie--;while(I[ie]>X);if(Q>=ie)break;Je(I,Q,ie),Je(F,3*Q,3*ie),Je(F,3*Q+1,3*ie+1),Je(F,3*Q+2,3*ie+2)}ie-N<V-ie?(T(I,F,N,ie),N=ie+1):(T(I,F,ie+1,V),V=ie)}}(A,b,0,A.length-1),l&&l.push(A.buffer,b.buffer),{ids:A,positions:b}},Ve.deserialize=function(a){var l=new Ve;return l.ids=a.ids,l.positions=a.positions,l.indexed=!0,l};var $e=Math.pow(2,53)-1;function rt(a){var l=+a;return!isNaN(l)&&l<=$e?l:ge(String(a))}function Je(a,l,A){var b=a[l];a[l]=a[A],a[A]=b}rr("FeaturePositionMap",Ve);var Ze=function(a,l){this.gl=a.gl,this.location=l},ft=function(a){function l(A,b){a.call(this,A,b),this.current=0}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))},l}(Ze),Pt=function(a){function l(A,b){a.call(this,A,b),this.current=0}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){this.current!==A&&(this.current=A,this.gl.uniform1f(this.location,A))},l}(Ze),bt=function(a){function l(A,b){a.call(this,A,b),this.current=[0,0]}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))},l}(Ze),Lt=function(a){function l(A,b){a.call(this,A,b),this.current=[0,0,0]}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))},l}(Ze),tr=function(a){function l(A,b){a.call(this,A,b),this.current=[0,0,0,0]}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]&&A[3]===this.current[3]||(this.current=A,this.gl.uniform4f(this.location,A[0],A[1],A[2],A[3]))},l}(Ze),br=function(a){function l(A,b){a.call(this,A,b),this.current=qr.transparent}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){A.r===this.current.r&&A.g===this.current.g&&A.b===this.current.b&&A.a===this.current.a||(this.current=A,this.gl.uniform4f(this.location,A.r,A.g,A.b,A.a))},l}(Ze),Tr=new Float32Array(16),gn=function(a){function l(A,b){a.call(this,A,b),this.current=Tr}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.set=function(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(var b=1;b<16;b++)if(A[b]!==this.current[b]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}},l}(Ze);function nr(a){return[te(255*a.r,255*a.g),te(255*a.b,255*a.a)]}var zr=function(a,l,A){this.value=a,this.uniformNames=l.map(function(b){return"u_"+b}),this.type=A};zr.prototype.setUniform=function(a,l,A){a.set(A.constantOr(this.value))},zr.prototype.getBinding=function(a,l,A){return this.type==="color"?new br(a,l):new Pt(a,l)};var Yr=function(a,l){this.uniformNames=l.map(function(A){return"u_"+A}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Yr.prototype.setConstantPatternPositions=function(a,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=a.tlbr},Yr.prototype.setUniform=function(a,l,A,b){var T=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&a.set(T)},Yr.prototype.getBinding=function(a,l,A){return A.substr(0,9)==="u_pattern"?new tr(a,l):new Pt(a,l)};var Ur=function(a,l,A,b){this.expression=a,this.type=A,this.maxValue=0,this.paintVertexAttributes=l.map(function(T){return{name:"a_"+T,type:"Float32",components:A==="color"?2:1,offset:0}}),this.paintVertexArray=new b};Ur.prototype.populatePaintArray=function(a,l,A,b,T){var I=this.paintVertexArray.length,F=this.expression.evaluate(new kr(0),l,{},b,[],T);this.paintVertexArray.resize(a),this._setPaintValue(I,a,F)},Ur.prototype.updatePaintArray=function(a,l,A,b){var T=this.expression.evaluate({zoom:0},A,b);this._setPaintValue(a,l,T)},Ur.prototype._setPaintValue=function(a,l,A){if(this.type==="color")for(var b=nr(A),T=a;T<l;T++)this.paintVertexArray.emplace(T,b[0],b[1]);else{for(var I=a;I<l;I++)this.paintVertexArray.emplace(I,A);this.maxValue=Math.max(this.maxValue,Math.abs(A))}},Ur.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ur.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Lr=function(a,l,A,b,T,I){this.expression=a,this.uniformNames=l.map(function(F){return"u_"+F+"_t"}),this.type=A,this.useIntegerZoom=b,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=l.map(function(F){return{name:"a_"+F,type:"Float32",components:A==="color"?4:2,offset:0}}),this.paintVertexArray=new I};Lr.prototype.populatePaintArray=function(a,l,A,b,T){var I=this.expression.evaluate(new kr(this.zoom),l,{},b,[],T),F=this.expression.evaluate(new kr(this.zoom+1),l,{},b,[],T),N=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(N,a,I,F)},Lr.prototype.updatePaintArray=function(a,l,A,b){var T=this.expression.evaluate({zoom:this.zoom},A,b),I=this.expression.evaluate({zoom:this.zoom+1},A,b);this._setPaintValue(a,l,T,I)},Lr.prototype._setPaintValue=function(a,l,A,b){if(this.type==="color")for(var T=nr(A),I=nr(b),F=a;F<l;F++)this.paintVertexArray.emplace(F,T[0],T[1],I[0],I[1]);else{for(var N=a;N<l;N++)this.paintVertexArray.emplace(N,A,b);this.maxValue=Math.max(this.maxValue,Math.abs(A),Math.abs(b))}},Lr.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Lr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Lr.prototype.setUniform=function(a,l){var A=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,b=J(this.expression.interpolationFactor(A,this.zoom,this.zoom+1),0,1);a.set(b)},Lr.prototype.getBinding=function(a,l,A){return new Pt(a,l)};var Jr=function(a,l,A,b,T,I){this.expression=a,this.type=l,this.useIntegerZoom=A,this.zoom=b,this.layerId=I,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T};Jr.prototype.populatePaintArray=function(a,l,A){var b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,l.patterns&&l.patterns[this.layerId],A)},Jr.prototype.updatePaintArray=function(a,l,A,b,T){this._setPaintValues(a,l,A.patterns&&A.patterns[this.layerId],T)},Jr.prototype._setPaintValues=function(a,l,A,b){if(b&&A){var T=b[A.min],I=b[A.mid],F=b[A.max];if(T&&I&&F)for(var N=a;N<l;N++)this.zoomInPaintVertexArray.emplace(N,I.tl[0],I.tl[1],I.br[0],I.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],I.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,I.tl[0],I.tl[1],I.br[0],I.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],I.pixelRatio,F.pixelRatio)}},Jr.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,se.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,se.members,this.expression.isStateDependent))},Jr.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Rr=function(a,l,A){this.binders={},this._buffers=[];var b=[];for(var T in a.paint._values)if(A(T)){var I=a.paint.get(T);if(I instanceof qi&&ko(I.property.specification)){var F=Vi(T,a.type),N=I.value,V=I.property.specification.type,X=I.property.useIntegerZoom,Q=I.property.specification["property-type"],ie=Q==="cross-faded"||Q==="cross-faded-data-driven";if(N.kind==="constant")this.binders[T]=ie?new Yr(N.value,F):new zr(N.value,F,V),b.push("/u_"+T);else if(N.kind==="source"||ie){var ue=_i(T,V,"source");this.binders[T]=ie?new Jr(N,V,X,l,ue,a.id):new Ur(N,F,V,ue),b.push("/a_"+T)}else{var _e=_i(T,V,"composite");this.binders[T]=new Lr(N,F,V,X,l,_e),b.push("/z_"+T)}}}this.cacheKey=b.sort().join("")};Rr.prototype.getMaxValue=function(a){var l=this.binders[a];return l instanceof Ur||l instanceof Lr?l.maxValue:0},Rr.prototype.populatePaintArrays=function(a,l,A,b,T){for(var I in this.binders){var F=this.binders[I];(F instanceof Ur||F instanceof Lr||F instanceof Jr)&&F.populatePaintArray(a,l,A,b,T)}},Rr.prototype.setConstantPatternPositions=function(a,l){for(var A in this.binders){var b=this.binders[A];b instanceof Yr&&b.setConstantPatternPositions(a,l)}},Rr.prototype.updatePaintArrays=function(a,l,A,b,T){var I=!1;for(var F in a)for(var N=0,V=l.getPositions(F);N<V.length;N+=1){var X=V[N],Q=A.feature(X.index);for(var ie in this.binders){var ue=this.binders[ie];if((ue instanceof Ur||ue instanceof Lr||ue instanceof Jr)&&ue.expression.isStateDependent===!0){var _e=b.paint.get(ie);ue.expression=_e.value,ue.updatePaintArray(X.start,X.end,Q,a[F],T),I=!0}}}return I},Rr.prototype.defines=function(){var a=[];for(var l in this.binders){var A=this.binders[l];(A instanceof zr||A instanceof Yr)&&a.push.apply(a,A.uniformNames.map(function(b){return"#define HAS_UNIFORM_"+b}))}return a},Rr.prototype.getBinderAttributes=function(){var a=[];for(var l in this.binders){var A=this.binders[l];if(A instanceof Ur||A instanceof Lr)for(var b=0;b<A.paintVertexAttributes.length;b++)a.push(A.paintVertexAttributes[b].name);else if(A instanceof Jr)for(var T=0;T<se.members.length;T++)a.push(se.members[T].name)}return a},Rr.prototype.getBinderUniforms=function(){var a=[];for(var l in this.binders){var A=this.binders[l];if(A instanceof zr||A instanceof Yr||A instanceof Lr)for(var b=0,T=A.uniformNames;b<T.length;b+=1)a.push(T[b])}return a},Rr.prototype.getPaintVertexBuffers=function(){return this._buffers},Rr.prototype.getUniforms=function(a,l){var A=[];for(var b in this.binders){var T=this.binders[b];if(T instanceof zr||T instanceof Yr||T instanceof Lr)for(var I=0,F=T.uniformNames;I<F.length;I+=1){var N=F[I];if(l[N]){var V=T.getBinding(a,l[N],N);A.push({name:N,property:b,binding:V})}}}return A},Rr.prototype.setUniforms=function(a,l,A,b){for(var T=0,I=l;T<I.length;T+=1){var F=I[T],N=F.name,V=F.property;this.binders[V].setUniform(F.binding,b,A.get(V),N)}},Rr.prototype.updatePaintBuffers=function(a){for(var l in this._buffers=[],this.binders){var A=this.binders[l];if(a&&A instanceof Jr){var b=a.fromScale===2?A.zoomInPaintVertexBuffer:A.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(A instanceof Ur||A instanceof Lr)&&A.paintVertexBuffer&&this._buffers.push(A.paintVertexBuffer)}},Rr.prototype.upload=function(a){for(var l in this.binders){var A=this.binders[l];(A instanceof Ur||A instanceof Lr||A instanceof Jr)&&A.upload(a)}this.updatePaintBuffers()},Rr.prototype.destroy=function(){for(var a in this.binders){var l=this.binders[a];(l instanceof Ur||l instanceof Lr||l instanceof Jr)&&l.destroy()}};var Mr=function(a,l,A){A===void 0&&(A=function(){return!0}),this.programConfigurations={};for(var b=0,T=a;b<T.length;b+=1){var I=T[b];this.programConfigurations[I.id]=new Rr(I,l,A)}this.needsUpload=!1,this._featureMap=new Ve,this._bufferOffset=0};function Vi(a,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(l+"-","").replace(/-/g,"_")]}function _i(a,l,A){var b={color:{source:fo,composite:D},number:{source:m,composite:fo}},T=function(I){return{"line-pattern":{source:ho,composite:ho},"fill-pattern":{source:ho,composite:ho},"fill-extrusion-pattern":{source:ho,composite:ho}}[I]}(a);return T&&T[A]||b[l][A]}Mr.prototype.populatePaintArrays=function(a,l,A,b,T,I){for(var F in this.programConfigurations)this.programConfigurations[F].populatePaintArrays(a,l,b,T,I);l.id!==void 0&&this._featureMap.add(l.id,A,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Mr.prototype.updatePaintArrays=function(a,l,A,b){for(var T=0,I=A;T<I.length;T+=1){var F=I[T];this.needsUpload=this.programConfigurations[F.id].updatePaintArrays(a,this._featureMap,l,F,b)||this.needsUpload}},Mr.prototype.get=function(a){return this.programConfigurations[a]},Mr.prototype.upload=function(a){if(this.needsUpload){for(var l in this.programConfigurations)this.programConfigurations[l].upload(a);this.needsUpload=!1}},Mr.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},rr("ConstantBinder",zr),rr("CrossFadedConstantBinder",Yr),rr("SourceExpressionBinder",Ur),rr("CrossFadedCompositeBinder",Jr),rr("CompositeExpressionBinder",Lr),rr("ProgramConfiguration",Rr,{omit:["_buffers"]}),rr("ProgramConfigurationSet",Mr);var us=Math.pow(2,14)-1,Zi=-us-1;function di(a){for(var l=8192/a.extent,A=a.loadGeometry(),b=0;b<A.length;b++)for(var T=A[b],I=0;I<T.length;I++){var F=T[I],N=Math.round(F.x*l),V=Math.round(F.y*l);F.x=J(N,Zi,us),F.y=J(V,Zi,us),(N<F.x||N>F.x+1||V<F.y||V>F.y+1)&&re("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return A}function xi(a,l){return{type:a.type,id:a.id,properties:a.properties,geometry:l?di(a):[]}}function qs(a,l,A,b,T){a.emplaceBack(2*l+(b+1)/2,2*A+(T+1)/2)}var vs=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Fs,this.indexArray=new $o,this.segments=new Z,this.programConfigurations=new Mr(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};function Tc(a,l){for(var A=0;A<a.length;A++)if(pa(l,a[A]))return!0;for(var b=0;b<l.length;b++)if(pa(a,l[b]))return!0;return!!of(a,l)}function Ds(a,l,A){return!!pa(a,l)||!!Ec(l,a,A)}function Wo(a,l){if(a.length===1)return af(l,a[0]);for(var A=0;A<l.length;A++)for(var b=l[A],T=0;T<b.length;T++)if(pa(a,b[T]))return!0;for(var I=0;I<a.length;I++)if(af(l,a[I]))return!0;for(var F=0;F<l.length;F++)if(of(a,l[F]))return!0;return!1}function xo(a,l,A){if(a.length>1){if(of(a,l))return!0;for(var b=0;b<l.length;b++)if(Ec(l[b],a,A))return!0}for(var T=0;T<a.length;T++)if(Ec(a[T],l,A))return!0;return!1}function of(a,l){if(a.length===0||l.length===0)return!1;for(var A=0;A<a.length-1;A++)for(var b=a[A],T=a[A+1],I=0;I<l.length-1;I++)if(su(b,T,l[I],l[I+1]))return!0;return!1}function su(a,l,A,b){return Te(a,A,b)!==Te(l,A,b)&&Te(a,l,A)!==Te(a,l,b)}function Ec(a,l,A){var b=A*A;if(l.length===1)return a.distSqr(l[0])<b;for(var T=1;T<l.length;T++)if(ou(a,l[T-1],l[T])<b)return!0;return!1}function ou(a,l,A){var b=l.distSqr(A);if(b===0)return a.distSqr(l);var T=((a.x-l.x)*(A.x-l.x)+(a.y-l.y)*(A.y-l.y))/b;return a.distSqr(T<0?l:T>1?A:A.sub(l)._mult(T)._add(l))}function af(a,l){for(var A,b,T,I=!1,F=0;F<a.length;F++)for(var N=0,V=(A=a[F]).length-1;N<A.length;V=N++)(b=A[N]).y>l.y!=(T=A[V]).y>l.y&&l.x<(T.x-b.x)*(l.y-b.y)/(T.y-b.y)+b.x&&(I=!I);return I}function pa(a,l){for(var A=!1,b=0,T=a.length-1;b<a.length;T=b++){var I=a[b],F=a[T];I.y>l.y!=F.y>l.y&&l.x<(F.x-I.x)*(l.y-I.y)/(F.y-I.y)+I.x&&(A=!A)}return A}function cf(a,l,A){var b=A[0],T=A[2];if(a.x<b.x&&l.x<b.x||a.x>T.x&&l.x>T.x||a.y<b.y&&l.y<b.y||a.y>T.y&&l.y>T.y)return!1;var I=Te(a,l,A[0]);return I!==Te(a,l,A[1])||I!==Te(a,l,A[2])||I!==Te(a,l,A[3])}function ga(a,l,A){var b=l.paint.get(a).value;return b.kind==="constant"?b.value:A.programConfigurations.get(l.id).getMaxValue(a)}function Hi(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Ga(a,l,A,b,T){if(!l[0]&&!l[1])return a;var I=x.convert(l)._mult(T);A==="viewport"&&I._rotate(-b);for(var F=[],N=0;N<a.length;N++)F.push(a[N].sub(I));return F}vs.prototype.populate=function(a,l,A){var b=this.layers[0],T=[],I=null;b.type==="circle"&&(I=b.layout.get("circle-sort-key"));for(var F=0,N=a;F<N.length;F+=1){var V=N[F],X=V.feature,Q=V.id,ie=V.index,ue=V.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Ne=xi(X,_e);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),Ne,A)){var ke=I?I.evaluate(Ne,{},A):void 0,He={id:Q,properties:X.properties,type:X.type,sourceLayerIndex:ue,index:ie,geometry:_e?Ne.geometry:di(X),patterns:{},sortKey:ke};T.push(He)}}I&&T.sort(function(Wt,gr){return Wt.sortKey-gr.sortKey});for(var Ge=0,Ke=T;Ge<Ke.length;Ge+=1){var ot=Ke[Ge],At=ot.geometry,gt=ot.index,Mt=ot.sourceLayerIndex,zt=a[gt].feature;this.addFeature(ot,At,gt,A),l.featureIndex.insert(zt,At,gt,Mt,this.index)}},vs.prototype.update=function(a,l,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,l,this.stateDependentLayers,A)},vs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},vs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ee),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},vs.prototype.addFeature=function(a,l,A,b){for(var T=0,I=l;T<I.length;T+=1)for(var F=0,N=I[T];F<N.length;F+=1){var V=N[F],X=V.x,Q=V.y;if(!(X<0||X>=8192||Q<0||Q>=8192)){var ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ue=ie.vertexLength;qs(this.layoutVertexArray,X,Q,-1,-1),qs(this.layoutVertexArray,X,Q,1,-1),qs(this.layoutVertexArray,X,Q,1,1),qs(this.layoutVertexArray,X,Q,-1,1),this.indexArray.emplaceBack(ue,ue+1,ue+2),this.indexArray.emplaceBack(ue,ue+3,ue+2),ie.vertexLength+=4,ie.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,{},b)},rr("CircleBucket",vs,{omit:["layers"]});var Bc=new Gn({"circle-sort-key":new or(ae.layout_circle["circle-sort-key"])}),Al={paint:new Gn({"circle-radius":new or(ae.paint_circle["circle-radius"]),"circle-color":new or(ae.paint_circle["circle-color"]),"circle-blur":new or(ae.paint_circle["circle-blur"]),"circle-opacity":new or(ae.paint_circle["circle-opacity"]),"circle-translate":new _r(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new _r(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _r(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _r(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new or(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new or(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new or(ae.paint_circle["circle-stroke-opacity"])}),layout:Bc},vn=typeof Float32Array<"u"?Float32Array:Array;function Ao(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Os(a,l,A){var b=l[0],T=l[1],I=l[2],F=l[3],N=l[4],V=l[5],X=l[6],Q=l[7],ie=l[8],ue=l[9],_e=l[10],Ne=l[11],ke=l[12],He=l[13],Ge=l[14],Ke=l[15],ot=A[0],At=A[1],gt=A[2],Mt=A[3];return a[0]=ot*b+At*N+gt*ie+Mt*ke,a[1]=ot*T+At*V+gt*ue+Mt*He,a[2]=ot*I+At*X+gt*_e+Mt*Ge,a[3]=ot*F+At*Q+gt*Ne+Mt*Ke,a[4]=(ot=A[4])*b+(At=A[5])*N+(gt=A[6])*ie+(Mt=A[7])*ke,a[5]=ot*T+At*V+gt*ue+Mt*He,a[6]=ot*I+At*X+gt*_e+Mt*Ge,a[7]=ot*F+At*Q+gt*Ne+Mt*Ke,a[8]=(ot=A[8])*b+(At=A[9])*N+(gt=A[10])*ie+(Mt=A[11])*ke,a[9]=ot*T+At*V+gt*ue+Mt*He,a[10]=ot*I+At*X+gt*_e+Mt*Ge,a[11]=ot*F+At*Q+gt*Ne+Mt*Ke,a[12]=(ot=A[12])*b+(At=A[13])*N+(gt=A[14])*ie+(Mt=A[15])*ke,a[13]=ot*T+At*V+gt*ue+Mt*He,a[14]=ot*I+At*X+gt*_e+Mt*Ge,a[15]=ot*F+At*Q+gt*Ne+Mt*Ke,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,l=0,A=arguments.length;A--;)l+=a[A]*a[A];return Math.sqrt(l)});var pl,My=Os;function bh(a,l,A){var b=l[0],T=l[1],I=l[2],F=l[3];return a[0]=A[0]*b+A[4]*T+A[8]*I+A[12]*F,a[1]=A[1]*b+A[5]*T+A[9]*I+A[13]*F,a[2]=A[2]*b+A[6]*T+A[10]*I+A[14]*F,a[3]=A[3]*b+A[7]*T+A[11]*I+A[15]*F,a}pl=new vn(3),vn!=Float32Array&&(pl[0]=0,pl[1]=0,pl[2]=0),function(){var a=new vn(4);vn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var Py=(function(){var a=new vn(2);vn!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function l(A){a.call(this,A,Al)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.createBucket=function(A){return new vs(A)},l.prototype.queryRadius=function(A){var b=A;return ga("circle-radius",this,b)+ga("circle-stroke-width",this,b)+Hi(this.paint.get("circle-translate"))},l.prototype.queryIntersectsFeature=function(A,b,T,I,F,N,V,X){for(var Q=Ga(A,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,V),ie=this.paint.get("circle-radius").evaluate(b,T)+this.paint.get("circle-stroke-width").evaluate(b,T),ue=this.paint.get("circle-pitch-alignment")==="map",_e=ue?Q:function(zt,Wt){return zt.map(function(gr){return lf(gr,Wt)})}(Q,X),Ne=ue?ie*V:ie,ke=0,He=I;ke<He.length;ke+=1)for(var Ge=0,Ke=He[ke];Ge<Ke.length;Ge+=1){var ot=Ke[Ge],At=ue?ot:lf(ot,X),gt=Ne,Mt=bh([],[ot.x,ot.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?gt*=Mt[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(gt*=N.cameraToCenterDistance/Mt[3]),Ds(_e,At,gt))return!0}return!1},l}(Or));function lf(a,l){var A=bh([],[a.x,a.y,0,1],l);return new x(A[0]/A[3],A[1]/A[3])}var Pg=function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l}(vs);function au(a,l,A,b){var T=l.width,I=l.height;if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==T*I*A)throw new RangeError("mismatched image size")}else b=new Uint8Array(T*I*A);return a.width=T,a.height=I,a.data=b,a}function xh(a,l,A){var b=l.width,T=l.height;if(b!==a.width||T!==a.height){var I=au({},{width:b,height:T},A);Ry(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,b),height:Math.min(a.height,T)},A),a.width=b,a.height=T,a.data=I.data}}function Ry(a,l,A,b,T,I){if(T.width===0||T.height===0)return l;if(T.width>a.width||T.height>a.height||A.x>a.width-T.width||A.y>a.height-T.height)throw new RangeError("out of range source coordinates for image copy");if(T.width>l.width||T.height>l.height||b.x>l.width-T.width||b.y>l.height-T.height)throw new RangeError("out of range destination coordinates for image copy");for(var F=a.data,N=l.data,V=0;V<T.height;V++)for(var X=((A.y+V)*a.width+A.x)*I,Q=((b.y+V)*l.width+b.x)*I,ie=0;ie<T.width*I;ie++)N[Q+ie]=F[X+ie];return l}rr("HeatmapBucket",Pg,{omit:["layers"]});var uf=function(a,l){au(this,a,1,l)};uf.prototype.resize=function(a){xh(this,a,1)},uf.prototype.clone=function(){return new uf({width:this.width,height:this.height},new Uint8Array(this.data))},uf.copy=function(a,l,A,b,T){Ry(a,l,A,b,T,1)};var Ys=function(a,l){au(this,a,4,l)};Ys.prototype.resize=function(a){xh(this,a,4)},Ys.prototype.replace=function(a,l){l?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Ys.prototype.clone=function(){return new Ys({width:this.width,height:this.height},new Uint8Array(this.data))},Ys.copy=function(a,l,A,b,T){Ry(a,l,A,b,T,4)},rr("AlphaImage",uf),rr("RGBAImage",Ys);var Pk={paint:new Gn({"heatmap-radius":new or(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new or(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _r(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gi(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _r(ae.paint_heatmap["heatmap-opacity"])})};function lT(a){var l={},A=a.resolution||256,b=a.clips?a.clips.length:1,T=a.image||new Ys({width:A,height:b}),I=function(Ne,ke,He){l[a.evaluationKey]=He;var Ge=a.expression.evaluate(l);T.data[Ne+ke+0]=Math.floor(255*Ge.r/Ge.a),T.data[Ne+ke+1]=Math.floor(255*Ge.g/Ge.a),T.data[Ne+ke+2]=Math.floor(255*Ge.b/Ge.a),T.data[Ne+ke+3]=Math.floor(255*Ge.a)};if(a.clips)for(var F=0,N=0;F<b;++F,N+=4*A)for(var V=0,X=0;V<A;V++,X+=4){var Q=V/(A-1),ie=a.clips[F];I(N,X,ie.start*(1-Q)+ie.end*Q)}else for(var ue=0,_e=0;ue<A;ue++,_e+=4)I(0,_e,ue/(A-1));return T}var Rk=function(a){function l(A){a.call(this,A,Pk),this._updateColorRamp()}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.createBucket=function(A){return new Pg(A)},l.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="heatmap-color"&&this._updateColorRamp()},l.prototype._updateColorRamp=function(){this.colorRamp=lT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},l.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},l.prototype.queryRadius=function(){return 0},l.prototype.queryIntersectsFeature=function(){return!1},l.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},l}(Or),Fk={paint:new Gn({"hillshade-illumination-direction":new _r(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _r(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _r(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _r(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _r(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _r(ae.paint_hillshade["hillshade-accent-color"])})},Dk=function(a){function l(A){a.call(this,A,Fk)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},l}(Or),Ok=Ii([{name:"a_pos",components:2,type:"Int16"}],4).members,Fy=Rg,Lk=Rg;function Rg(a,l,A){A=A||2;var b,T,I,F,N,V,X,Q=l&&l.length,ie=Q?l[0]*A:a.length,ue=uT(a,0,ie,A,!0),_e=[];if(!ue||ue.next===ue.prev)return _e;if(Q&&(ue=function(ke,He,Ge,Ke){var ot,At,gt,Mt=[];for(ot=0,At=He.length;ot<At;ot++)(gt=uT(ke,He[ot]*Ke,ot<At-1?He[ot+1]*Ke:ke.length,Ke,!1))===gt.next&&(gt.steiner=!0),Mt.push(jk(gt));for(Mt.sort(Gk),ot=0;ot<Mt.length;ot++)Vk(Mt[ot],Ge),Ge=cu(Ge,Ge.next);return Ge}(a,l,ue,A)),a.length>80*A){b=I=a[0],T=F=a[1];for(var Ne=A;Ne<ie;Ne+=A)(N=a[Ne])<b&&(b=N),(V=a[Ne+1])<T&&(T=V),N>I&&(I=N),V>F&&(F=V);X=(X=Math.max(I-b,F-T))!==0?1/X:0}return kA(ue,_e,A,b,T,X),_e}function uT(a,l,A,b,T){var I,F;if(T===Ly(a,l,A,b)>0)for(I=l;I<A;I+=b)F=dT(I,a[I],a[I+1],F);else for(I=A-b;I>=l;I-=b)F=dT(I,a[I],a[I+1],F);return F&&Fg(F,F.next)&&(zA(F),F=F.next),F}function cu(a,l){if(!a)return a;l||(l=a);var A,b=a;do if(A=!1,b.steiner||!Fg(b,b.next)&&Fi(b.prev,b,b.next)!==0)b=b.next;else{if(zA(b),(b=l=b.prev)===b.next)break;A=!0}while(A||b!==l);return l}function kA(a,l,A,b,T,I,F){if(a){!F&&I&&function(Q,ie,ue,_e){var Ne=Q;do Ne.z===null&&(Ne.z=Dy(Ne.x,Ne.y,ie,ue,_e)),Ne.prevZ=Ne.prev,Ne.nextZ=Ne.next,Ne=Ne.next;while(Ne!==Q);Ne.prevZ.nextZ=null,Ne.prevZ=null,function(ke){var He,Ge,Ke,ot,At,gt,Mt,zt,Wt=1;do{for(Ge=ke,ke=null,At=null,gt=0;Ge;){for(gt++,Ke=Ge,Mt=0,He=0;He<Wt&&(Mt++,Ke=Ke.nextZ);He++);for(zt=Wt;Mt>0||zt>0&&Ke;)Mt!==0&&(zt===0||!Ke||Ge.z<=Ke.z)?(ot=Ge,Ge=Ge.nextZ,Mt--):(ot=Ke,Ke=Ke.nextZ,zt--),At?At.nextZ=ot:ke=ot,ot.prevZ=At,At=ot;Ge=Ke}At.nextZ=null,Wt*=2}while(gt>1)}(Ne)}(a,b,T,I);for(var N,V,X=a;a.prev!==a.next;)if(N=a.prev,V=a.next,I?kk(a,b,T,I):Nk(a))l.push(N.i/A),l.push(a.i/A),l.push(V.i/A),zA(a),a=V.next,X=V.next;else if((a=V)===X){F?F===1?kA(a=Uk(cu(a),l,A),l,A,b,T,I,2):F===2&&zk(a,l,A,b,T,I):kA(cu(a),l,A,b,T,I,1);break}}}function Nk(a){var l=a.prev,A=a,b=a.next;if(Fi(l,A,b)>=0)return!1;for(var T=a.next.next;T!==a.prev;){if(wh(l.x,l.y,A.x,A.y,b.x,b.y,T.x,T.y)&&Fi(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function kk(a,l,A,b){var T=a.prev,I=a,F=a.next;if(Fi(T,I,F)>=0)return!1;for(var N=T.x>I.x?T.x>F.x?T.x:F.x:I.x>F.x?I.x:F.x,V=T.y>I.y?T.y>F.y?T.y:F.y:I.y>F.y?I.y:F.y,X=Dy(T.x<I.x?T.x<F.x?T.x:F.x:I.x<F.x?I.x:F.x,T.y<I.y?T.y<F.y?T.y:F.y:I.y<F.y?I.y:F.y,l,A,b),Q=Dy(N,V,l,A,b),ie=a.prevZ,ue=a.nextZ;ie&&ie.z>=X&&ue&&ue.z<=Q;){if(ie!==a.prev&&ie!==a.next&&wh(T.x,T.y,I.x,I.y,F.x,F.y,ie.x,ie.y)&&Fi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ue!==a.prev&&ue!==a.next&&wh(T.x,T.y,I.x,I.y,F.x,F.y,ue.x,ue.y)&&Fi(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ie&&ie.z>=X;){if(ie!==a.prev&&ie!==a.next&&wh(T.x,T.y,I.x,I.y,F.x,F.y,ie.x,ie.y)&&Fi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ue&&ue.z<=Q;){if(ue!==a.prev&&ue!==a.next&&wh(T.x,T.y,I.x,I.y,F.x,F.y,ue.x,ue.y)&&Fi(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function Uk(a,l,A){var b=a;do{var T=b.prev,I=b.next.next;!Fg(T,I)&&fT(T,b,b.next,I)&&UA(T,I)&&UA(I,T)&&(l.push(T.i/A),l.push(b.i/A),l.push(I.i/A),zA(b),zA(b.next),b=a=I),b=b.next}while(b!==a);return cu(b)}function zk(a,l,A,b,T,I){var F=a;do{for(var N=F.next.next;N!==F.prev;){if(F.i!==N.i&&$k(F,N)){var V=hT(F,N);return F=cu(F,F.next),V=cu(V,V.next),kA(F,l,A,b,T,I),void kA(V,l,A,b,T,I)}N=N.next}F=F.next}while(F!==a)}function Gk(a,l){return a.x-l.x}function Vk(a,l){if(l=function(b,T){var I,F=T,N=b.x,V=b.y,X=-1/0;do{if(V<=F.y&&V>=F.next.y&&F.next.y!==F.y){var Q=F.x+(V-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(Q<=N&&Q>X){if(X=Q,Q===N){if(V===F.y)return F;if(V===F.next.y)return F.next}I=F.x<F.next.x?F:F.next}}F=F.next}while(F!==T);if(!I)return null;if(N===X)return I;var ie,ue=I,_e=I.x,Ne=I.y,ke=1/0;F=I;do N>=F.x&&F.x>=_e&&N!==F.x&&wh(V<Ne?N:X,V,_e,Ne,V<Ne?X:N,V,F.x,F.y)&&(ie=Math.abs(V-F.y)/(N-F.x),UA(F,b)&&(ie<ke||ie===ke&&(F.x>I.x||F.x===I.x&&Hk(I,F)))&&(I=F,ke=ie)),F=F.next;while(F!==ue);return I}(a,l)){var A=hT(l,a);cu(l,l.next),cu(A,A.next)}}function Hk(a,l){return Fi(a.prev,a,l.prev)<0&&Fi(l.next,a,a.next)<0}function Dy(a,l,A,b,T){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-A)*T)|a<<8))|a<<4))|a<<2))|a<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-b)*T)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function jk(a){var l=a,A=a;do(l.x<A.x||l.x===A.x&&l.y<A.y)&&(A=l),l=l.next;while(l!==a);return A}function wh(a,l,A,b,T,I,F,N){return(T-F)*(l-N)-(a-F)*(I-N)>=0&&(a-F)*(b-N)-(A-F)*(l-N)>=0&&(A-F)*(I-N)-(T-F)*(b-N)>=0}function $k(a,l){return a.next.i!==l.i&&a.prev.i!==l.i&&!function(A,b){var T=A;do{if(T.i!==A.i&&T.next.i!==A.i&&T.i!==b.i&&T.next.i!==b.i&&fT(T,T.next,A,b))return!0;T=T.next}while(T!==A);return!1}(a,l)&&(UA(a,l)&&UA(l,a)&&function(A,b){var T=A,I=!1,F=(A.x+b.x)/2,N=(A.y+b.y)/2;do T.y>N!=T.next.y>N&&T.next.y!==T.y&&F<(T.next.x-T.x)*(N-T.y)/(T.next.y-T.y)+T.x&&(I=!I),T=T.next;while(T!==A);return I}(a,l)&&(Fi(a.prev,a,l.prev)||Fi(a,l.prev,l))||Fg(a,l)&&Fi(a.prev,a,a.next)>0&&Fi(l.prev,l,l.next)>0)}function Fi(a,l,A){return(l.y-a.y)*(A.x-l.x)-(l.x-a.x)*(A.y-l.y)}function Fg(a,l){return a.x===l.x&&a.y===l.y}function fT(a,l,A,b){var T=Og(Fi(a,l,A)),I=Og(Fi(a,l,b)),F=Og(Fi(A,b,a)),N=Og(Fi(A,b,l));return T!==I&&F!==N||!(T!==0||!Dg(a,A,l))||!(I!==0||!Dg(a,b,l))||!(F!==0||!Dg(A,a,b))||!(N!==0||!Dg(A,l,b))}function Dg(a,l,A){return l.x<=Math.max(a.x,A.x)&&l.x>=Math.min(a.x,A.x)&&l.y<=Math.max(a.y,A.y)&&l.y>=Math.min(a.y,A.y)}function Og(a){return a>0?1:a<0?-1:0}function UA(a,l){return Fi(a.prev,a,a.next)<0?Fi(a,l,a.next)>=0&&Fi(a,a.prev,l)>=0:Fi(a,l,a.prev)<0||Fi(a,a.next,l)<0}function hT(a,l){var A=new Oy(a.i,a.x,a.y),b=new Oy(l.i,l.x,l.y),T=a.next,I=l.prev;return a.next=l,l.prev=a,A.next=T,T.prev=A,b.next=A,A.prev=b,I.next=b,b.prev=I,b}function dT(a,l,A,b){var T=new Oy(a,l,A);return b?(T.next=b.next,T.prev=b,b.next.prev=T,b.next=T):(T.prev=T,T.next=T),T}function zA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Oy(a,l,A){this.i=a,this.x=l,this.y=A,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ly(a,l,A,b){for(var T=0,I=l,F=A-b;I<A;I+=b)T+=(a[F]-a[I])*(a[I+1]+a[F+1]),F=I;return T}function Wk(a,l,A,b,T){(function I(F,N,V,X,Q){for(;X>V;){if(X-V>600){var ie=X-V+1,ue=N-V+1,_e=Math.log(ie),Ne=.5*Math.exp(2*_e/3),ke=.5*Math.sqrt(_e*Ne*(ie-Ne)/ie)*(ue-ie/2<0?-1:1);I(F,N,Math.max(V,Math.floor(N-ue*Ne/ie+ke)),Math.min(X,Math.floor(N+(ie-ue)*Ne/ie+ke)),Q)}var He=F[N],Ge=V,Ke=X;for(GA(F,V,N),Q(F[X],He)>0&&GA(F,V,X);Ge<Ke;){for(GA(F,Ge,Ke),Ge++,Ke--;Q(F[Ge],He)<0;)Ge++;for(;Q(F[Ke],He)>0;)Ke--}Q(F[V],He)===0?GA(F,V,Ke):GA(F,++Ke,X),Ke<=N&&(V=Ke+1),N<=Ke&&(X=Ke-1)}})(a,l,A,b||a.length-1,T||Jk)}function GA(a,l,A){var b=a[l];a[l]=a[A],a[A]=b}function Jk(a,l){return a<l?-1:a>l?1:0}function Ny(a,l){var A=a.length;if(A<=1)return[a];for(var b,T,I=[],F=0;F<A;F++){var N=Qe(a[F]);N!==0&&(a[F].area=Math.abs(N),T===void 0&&(T=N<0),T===N<0?(b&&I.push(b),b=[a[F]]):b.push(a[F]))}if(b&&I.push(b),l>1)for(var V=0;V<I.length;V++)I[V].length<=l||(Wk(I[V],l,1,I[V].length-1,Xk),I[V]=I[V].slice(0,l));return I}function Xk(a,l){return l.area-a.area}function ky(a,l,A){for(var b=A.patternDependencies,T=!1,I=0,F=l;I<F.length;I+=1){var N=F[I].paint.get(a+"-pattern");N.isConstant()||(T=!0);var V=N.constantOr(null);V&&(T=!0,b[V.to]=!0,b[V.from]=!0)}return T}function Uy(a,l,A,b,T){for(var I=T.patternDependencies,F=0,N=l;F<N.length;F+=1){var V=N[F],X=V.paint.get(a+"-pattern").value;if(X.kind!=="constant"){var Q=X.evaluate({zoom:b-1},A,{},T.availableImages),ie=X.evaluate({zoom:b},A,{},T.availableImages),ue=X.evaluate({zoom:b+1},A,{},T.availableImages);ie=ie&&ie.name?ie.name:ie,ue=ue&&ue.name?ue.name:ue,I[Q=Q&&Q.name?Q.name:Q]=!0,I[ie]=!0,I[ue]=!0,A.patterns[V.id]={min:Q,mid:ie,max:ue}}}return A}Rg.deviation=function(a,l,A,b){var T=l&&l.length,I=Math.abs(Ly(a,0,T?l[0]*A:a.length,A));if(T)for(var F=0,N=l.length;F<N;F++)I-=Math.abs(Ly(a,l[F]*A,F<N-1?l[F+1]*A:a.length,A));var V=0;for(F=0;F<b.length;F+=3){var X=b[F]*A,Q=b[F+1]*A,ie=b[F+2]*A;V+=Math.abs((a[X]-a[ie])*(a[Q+1]-a[X+1])-(a[X]-a[Q])*(a[ie+1]-a[X+1]))}return I===0&&V===0?0:Math.abs((V-I)/I)},Rg.flatten=function(a){for(var l=a[0][0].length,A={vertices:[],holes:[],dimensions:l},b=0,T=0;T<a.length;T++){for(var I=0;I<a[T].length;I++)for(var F=0;F<l;F++)A.vertices.push(a[T][I][F]);T>0&&A.holes.push(b+=a[T-1].length)}return A},Fy.default=Lk;var Va=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fs,this.indexArray=new $o,this.indexArray2=new B,this.programConfigurations=new Mr(a.layers,a.zoom),this.segments=new Z,this.segments2=new Z,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};Va.prototype.populate=function(a,l,A){this.hasPattern=ky("fill",this.layers,l);for(var b=this.layers[0].layout.get("fill-sort-key"),T=[],I=0,F=a;I<F.length;I+=1){var N=F[I],V=N.feature,X=N.id,Q=N.index,ie=N.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,_e=xi(V,ue);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),_e,A)){var Ne=b?b.evaluate(_e,{},A,l.availableImages):void 0,ke={id:X,properties:V.properties,type:V.type,sourceLayerIndex:ie,index:Q,geometry:ue?_e.geometry:di(V),patterns:{},sortKey:Ne};T.push(ke)}}b&&T.sort(function(zt,Wt){return zt.sortKey-Wt.sortKey});for(var He=0,Ge=T;He<Ge.length;He+=1){var Ke=Ge[He],ot=Ke.geometry,At=Ke.index,gt=Ke.sourceLayerIndex;if(this.hasPattern){var Mt=Uy("fill",this.layers,Ke,this.zoom,l);this.patternFeatures.push(Mt)}else this.addFeature(Ke,ot,At,A,{});l.featureIndex.insert(a[At].feature,ot,At,gt,this.index)}},Va.prototype.update=function(a,l,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,l,this.stateDependentLayers,A)},Va.prototype.addFeatures=function(a,l,A){for(var b=0,T=this.patternFeatures;b<T.length;b+=1){var I=T[b];this.addFeature(I,I.geometry,I.index,l,A)}},Va.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Va.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ok),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},Va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Va.prototype.addFeature=function(a,l,A,b,T){for(var I=0,F=Ny(l,500);I<F.length;I+=1){for(var N=F[I],V=0,X=0,Q=N;X<Q.length;X+=1)V+=Q[X].length;for(var ie=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray),ue=ie.vertexLength,_e=[],Ne=[],ke=0,He=N;ke<He.length;ke+=1){var Ge=He[ke];if(Ge.length!==0){Ge!==N[0]&&Ne.push(_e.length/2);var Ke=this.segments2.prepareSegment(Ge.length,this.layoutVertexArray,this.indexArray2),ot=Ke.vertexLength;this.layoutVertexArray.emplaceBack(Ge[0].x,Ge[0].y),this.indexArray2.emplaceBack(ot+Ge.length-1,ot),_e.push(Ge[0].x),_e.push(Ge[0].y);for(var At=1;At<Ge.length;At++)this.layoutVertexArray.emplaceBack(Ge[At].x,Ge[At].y),this.indexArray2.emplaceBack(ot+At-1,ot+At),_e.push(Ge[At].x),_e.push(Ge[At].y);Ke.vertexLength+=Ge.length,Ke.primitiveLength+=Ge.length}}for(var gt=Fy(_e,Ne),Mt=0;Mt<gt.length;Mt+=3)this.indexArray.emplaceBack(ue+gt[Mt],ue+gt[Mt+1],ue+gt[Mt+2]);ie.vertexLength+=V,ie.primitiveLength+=gt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,T,b)},rr("FillBucket",Va,{omit:["layers","patternFeatures"]});var Kk=new Gn({"fill-sort-key":new or(ae.layout_fill["fill-sort-key"])}),qk={paint:new Gn({"fill-antialias":new _r(ae.paint_fill["fill-antialias"]),"fill-opacity":new or(ae.paint_fill["fill-opacity"]),"fill-color":new or(ae.paint_fill["fill-color"]),"fill-outline-color":new or(ae.paint_fill["fill-outline-color"]),"fill-translate":new _r(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new _r(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new nu(ae.paint_fill["fill-pattern"])}),layout:Kk},Yk=function(a){function l(A){a.call(this,A,qk)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.recalculate=function(A,b){a.prototype.recalculate.call(this,A,b);var T=this.paint._values["fill-outline-color"];T.value.kind==="constant"&&T.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},l.prototype.createBucket=function(A){return new Va(A)},l.prototype.queryRadius=function(){return Hi(this.paint.get("fill-translate"))},l.prototype.queryIntersectsFeature=function(A,b,T,I,F,N,V){return Wo(Ga(A,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,V),I)},l.prototype.isTileClipped=function(){return!0},l}(Or),Zk=Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,AT=Ch;function Ch(a,l,A,b,T){this.properties={},this.extent=A,this.type=0,this._pbf=a,this._geometry=-1,this._keys=b,this._values=T,a.readFields(Qk,this,l)}function Qk(a,l,A){a==1?l.id=A.readVarint():a==2?function(b,T){for(var I=b.readVarint()+b.pos;b.pos<I;){var F=T._keys[b.readVarint()],N=T._values[b.readVarint()];T.properties[F]=N}}(A,l):a==3?l.type=A.readVarint():a==4&&(l._geometry=A.pos)}function e9(a){for(var l,A,b=0,T=0,I=a.length,F=I-1;T<I;F=T++)b+=((A=a[F]).x-(l=a[T]).x)*(l.y+A.y);return b}Ch.types=["Unknown","Point","LineString","Polygon"],Ch.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var l,A=a.readVarint()+a.pos,b=1,T=0,I=0,F=0,N=[];a.pos<A;){if(T<=0){var V=a.readVarint();b=7&V,T=V>>3}if(T--,b===1||b===2)I+=a.readSVarint(),F+=a.readSVarint(),b===1&&(l&&N.push(l),l=[]),l.push(new x(I,F));else{if(b!==7)throw new Error("unknown command "+b);l&&l.push(l[0].clone())}}return l&&N.push(l),N},Ch.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var l=a.readVarint()+a.pos,A=1,b=0,T=0,I=0,F=1/0,N=-1/0,V=1/0,X=-1/0;a.pos<l;){if(b<=0){var Q=a.readVarint();A=7&Q,b=Q>>3}if(b--,A===1||A===2)(T+=a.readSVarint())<F&&(F=T),T>N&&(N=T),(I+=a.readSVarint())<V&&(V=I),I>X&&(X=I);else if(A!==7)throw new Error("unknown command "+A)}return[F,V,N,X]},Ch.prototype.toGeoJSON=function(a,l,A){var b,T,I=this.extent*Math.pow(2,A),F=this.extent*a,N=this.extent*l,V=this.loadGeometry(),X=Ch.types[this.type];function Q(_e){for(var Ne=0;Ne<_e.length;Ne++){var ke=_e[Ne];_e[Ne]=[360*(ke.x+F)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+N)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var ie=[];for(b=0;b<V.length;b++)ie[b]=V[b][0];Q(V=ie);break;case 2:for(b=0;b<V.length;b++)Q(V[b]);break;case 3:for(V=function(_e){var Ne=_e.length;if(Ne<=1)return[_e];for(var ke,He,Ge=[],Ke=0;Ke<Ne;Ke++){var ot=e9(_e[Ke]);ot!==0&&(He===void 0&&(He=ot<0),He===ot<0?(ke&&Ge.push(ke),ke=[_e[Ke]]):ke.push(_e[Ke]))}return ke&&Ge.push(ke),Ge}(V),b=0;b<V.length;b++)for(T=0;T<V[b].length;T++)Q(V[b][T])}V.length===1?V=V[0]:X="Multi"+X;var ue={type:"Feature",geometry:{type:X,coordinates:V},properties:this.properties};return"id"in this&&(ue.id=this.id),ue};var pT=gT;function gT(a,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(t9,this,l),this.length=this._features.length}function t9(a,l,A){a===15?l.version=A.readVarint():a===1?l.name=A.readString():a===5?l.extent=A.readVarint():a===2?l._features.push(A.pos):a===3?l._keys.push(A.readString()):a===4&&l._values.push(function(b){for(var T=null,I=b.readVarint()+b.pos;b.pos<I;){var F=b.readVarint()>>3;T=F===1?b.readString():F===2?b.readFloat():F===3?b.readDouble():F===4?b.readVarint64():F===5?b.readVarint():F===6?b.readSVarint():F===7?b.readBoolean():null}return T}(A))}function r9(a,l,A){if(a===3){var b=new pT(A,A.readVarint()+A.pos);b.length&&(l[b.name]=b)}}gT.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var l=this._pbf.readVarint()+this._pbf.pos;return new AT(this._pbf,l,this.extent,this._keys,this._values)};var Th={VectorTile:function(a,l){this.layers=a.readFields(r9,{},l)},VectorTileFeature:AT,VectorTileLayer:pT},n9=Th.VectorTileFeature.types,zy=Math.pow(2,13);function VA(a,l,A,b,T,I,F,N){a.emplaceBack(l,A,2*Math.floor(b*zy)+F,T*zy*2,I*zy*2,Math.round(N))}var Ha=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new si,this.indexArray=new $o,this.programConfigurations=new Mr(a.layers,a.zoom),this.segments=new Z,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};function i9(a,l){return a.x===l.x&&(a.x<0||a.x>8192)||a.y===l.y&&(a.y<0||a.y>8192)}Ha.prototype.populate=function(a,l,A){this.features=[],this.hasPattern=ky("fill-extrusion",this.layers,l);for(var b=0,T=a;b<T.length;b+=1){var I=T[b],F=I.feature,N=I.id,V=I.index,X=I.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,ie=xi(F,Q);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),ie,A)){var ue={id:N,sourceLayerIndex:X,index:V,geometry:Q?ie.geometry:di(F),properties:F.properties,type:F.type,patterns:{}};this.hasPattern?this.features.push(Uy("fill-extrusion",this.layers,ue,this.zoom,l)):this.addFeature(ue,ue.geometry,V,A,{}),l.featureIndex.insert(F,ue.geometry,V,X,this.index,!0)}}},Ha.prototype.addFeatures=function(a,l,A){for(var b=0,T=this.features;b<T.length;b+=1){var I=T[b];this.addFeature(I,I.geometry,I.index,l,A)}},Ha.prototype.update=function(a,l,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,l,this.stateDependentLayers,A)},Ha.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ha.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ha.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Zk),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ha.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ha.prototype.addFeature=function(a,l,A,b,T){for(var I=0,F=Ny(l,500);I<F.length;I+=1){for(var N=F[I],V=0,X=0,Q=N;X<Q.length;X+=1)V+=Q[X].length;for(var ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ue=0,_e=N;ue<_e.length;ue+=1){var Ne=_e[ue];if(Ne.length!==0&&!((on=Ne).every(function($r){return $r.x<0})||on.every(function($r){return $r.x>8192})||on.every(function($r){return $r.y<0})||on.every(function($r){return $r.y>8192})))for(var ke=0,He=0;He<Ne.length;He++){var Ge=Ne[He];if(He>=1){var Ke=Ne[He-1];if(!i9(Ge,Ke)){ie.vertexLength+4>Z.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var ot=Ge.sub(Ke)._perp()._unit(),At=Ke.dist(Ge);ke+At>32768&&(ke=0),VA(this.layoutVertexArray,Ge.x,Ge.y,ot.x,ot.y,0,0,ke),VA(this.layoutVertexArray,Ge.x,Ge.y,ot.x,ot.y,0,1,ke),VA(this.layoutVertexArray,Ke.x,Ke.y,ot.x,ot.y,0,0,ke+=At),VA(this.layoutVertexArray,Ke.x,Ke.y,ot.x,ot.y,0,1,ke);var gt=ie.vertexLength;this.indexArray.emplaceBack(gt,gt+2,gt+1),this.indexArray.emplaceBack(gt+1,gt+2,gt+3),ie.vertexLength+=4,ie.primitiveLength+=2}}}}if(ie.vertexLength+V>Z.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),n9[a.type]==="Polygon"){for(var Mt=[],zt=[],Wt=ie.vertexLength,gr=0,Qt=N;gr<Qt.length;gr+=1){var xr=Qt[gr];if(xr.length!==0){xr!==N[0]&&zt.push(Mt.length/2);for(var er=0;er<xr.length;er++){var Qr=xr[er];VA(this.layoutVertexArray,Qr.x,Qr.y,0,0,1,1,0),Mt.push(Qr.x),Mt.push(Qr.y)}}}for(var Pr=Fy(Mt,zt),cr=0;cr<Pr.length;cr+=3)this.indexArray.emplaceBack(Wt+Pr[cr],Wt+Pr[cr+2],Wt+Pr[cr+1]);ie.primitiveLength+=Pr.length/3,ie.vertexLength+=V}}var on;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,T,b)},rr("FillExtrusionBucket",Ha,{omit:["layers","features"]});var s9={paint:new Gn({"fill-extrusion-opacity":new _r(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new or(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _r(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _r(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nu(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new or(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new or(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _r(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},o9=function(a){function l(A){a.call(this,A,s9)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.createBucket=function(A){return new Ha(A)},l.prototype.queryRadius=function(){return Hi(this.paint.get("fill-extrusion-translate"))},l.prototype.is3D=function(){return!0},l.prototype.queryIntersectsFeature=function(A,b,T,I,F,N,V,X){var Q=Ga(A,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,V),ie=this.paint.get("fill-extrusion-height").evaluate(b,T),ue=this.paint.get("fill-extrusion-base").evaluate(b,T),_e=function(ke,He,Ge,Ke){for(var ot=[],At=0,gt=ke;At<gt.length;At+=1){var Mt=gt[At],zt=[Mt.x,Mt.y,0,1];bh(zt,zt,He),ot.push(new x(zt[0]/zt[3],zt[1]/zt[3]))}return ot}(Q,X),Ne=function(ke,He,Ge,Ke){for(var ot=[],At=[],gt=Ke[8]*He,Mt=Ke[9]*He,zt=Ke[10]*He,Wt=Ke[11]*He,gr=Ke[8]*Ge,Qt=Ke[9]*Ge,xr=Ke[10]*Ge,er=Ke[11]*Ge,Qr=0,Pr=ke;Qr<Pr.length;Qr+=1){for(var cr=[],on=[],$r=0,pn=Pr[Qr];$r<pn.length;$r+=1){var wr=pn[$r],_n=wr.x,Kn=wr.y,yi=Ke[0]*_n+Ke[4]*Kn+Ke[12],Ai=Ke[1]*_n+Ke[5]*Kn+Ke[13],qn=Ke[2]*_n+Ke[6]*Kn+Ke[14],vi=Ke[3]*_n+Ke[7]*Kn+Ke[15],ji=qn+zt,$i=vi+Wt,xs=yi+gr,es=Ai+Qt,ws=qn+xr,wi=vi+er,ts=new x((yi+gt)/$i,(Ai+Mt)/$i);ts.z=ji/$i,cr.push(ts);var un=new x(xs/wi,es/wi);un.z=ws/wi,on.push(un)}ot.push(cr),At.push(on)}return[ot,At]}(I,ue,ie,X);return function(ke,He,Ge){var Ke=1/0;Wo(Ge,He)&&(Ke=mT(Ge,He[0]));for(var ot=0;ot<He.length;ot++)for(var At=He[ot],gt=ke[ot],Mt=0;Mt<At.length-1;Mt++){var zt=At[Mt],Wt=[zt,At[Mt+1],gt[Mt+1],gt[Mt],zt];Tc(Ge,Wt)&&(Ke=Math.min(Ke,mT(Ge,Wt)))}return Ke!==1/0&&Ke}(Ne[0],Ne[1],_e)},l}(Or);function HA(a,l){return a.x*l.x+a.y*l.y}function mT(a,l){if(a.length===1){for(var A,b=0,T=l[b++];!A||T.equals(A);)if(!(A=l[b++]))return 1/0;for(;b<l.length;b++){var I=l[b],F=a[0],N=A.sub(T),V=I.sub(T),X=F.sub(T),Q=HA(N,N),ie=HA(N,V),ue=HA(V,V),_e=HA(X,N),Ne=HA(X,V),ke=Q*ue-ie*ie,He=(ue*_e-ie*Ne)/ke,Ge=(Q*Ne-ie*_e)/ke,Ke=T.z*(1-He-Ge)+A.z*He+I.z*Ge;if(isFinite(Ke))return Ke}return 1/0}for(var ot=1/0,At=0,gt=l;At<gt.length;At+=1)ot=Math.min(ot,gt[At].z);return ot}var a9=Ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,c9=Ii([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,l9=Th.VectorTileFeature.types,u9=Math.cos(Math.PI/180*37.5),_T=Math.pow(2,14)/.5,Ls=function(a){var l=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(A){l.gradients[A.id]={}}),this.layoutVertexArray=new Yi,this.layoutVertexArray2=new fo,this.indexArray=new $o,this.programConfigurations=new Mr(a.layers,a.zoom),this.segments=new Z,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id})};Ls.prototype.populate=function(a,l,A){this.hasPattern=ky("line",this.layers,l);for(var b=this.layers[0].layout.get("line-sort-key"),T=[],I=0,F=a;I<F.length;I+=1){var N=F[I],V=N.feature,X=N.id,Q=N.index,ie=N.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,_e=xi(V,ue);if(this.layers[0]._featureFilter.filter(new kr(this.zoom),_e,A)){var Ne=b?b.evaluate(_e,{},A):void 0,ke={id:X,properties:V.properties,type:V.type,sourceLayerIndex:ie,index:Q,geometry:ue?_e.geometry:di(V),patterns:{},sortKey:Ne};T.push(ke)}}b&&T.sort(function(zt,Wt){return zt.sortKey-Wt.sortKey});for(var He=0,Ge=T;He<Ge.length;He+=1){var Ke=Ge[He],ot=Ke.geometry,At=Ke.index,gt=Ke.sourceLayerIndex;if(this.hasPattern){var Mt=Uy("line",this.layers,Ke,this.zoom,l);this.patternFeatures.push(Mt)}else this.addFeature(Ke,ot,At,A,{});l.featureIndex.insert(a[At].feature,ot,At,gt,this.index)}},Ls.prototype.update=function(a,l,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,l,this.stateDependentLayers,A)},Ls.prototype.addFeatures=function(a,l,A){for(var b=0,T=this.patternFeatures;b<T.length;b+=1){var I=T[b];this.addFeature(I,I.geometry,I.index,l,A)}},Ls.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ls.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ls.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,c9)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,a9),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ls.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ls.prototype.addFeature=function(a,l,A,b,T){var I=this.layers[0].layout,F=I.get("line-join").evaluate(a,{}),N=I.get("line-cap"),V=I.get("line-miter-limit"),X=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var Q=0,ie=l;Q<ie.length;Q+=1)this.addLine(ie[Q],a,F,N,V,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,A,T,b)},Ls.prototype.addLine=function(a,l,A,b,T,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var F=0;F<a.length-1;F++)this.totalDistance+=a[F].dist(a[F+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var N=l9[l.type]==="Polygon",V=a.length;V>=2&&a[V-1].equals(a[V-2]);)V--;for(var X=0;X<V-1&&a[X].equals(a[X+1]);)X++;if(!(V<(N?3:2))){A==="bevel"&&(T=1.05);var Q,ie=this.overscaling<=16?122880/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray),_e=void 0,Ne=void 0,ke=void 0,He=void 0;this.e1=this.e2=-1,N&&(He=a[X].sub(Q=a[V-2])._unit()._perp());for(var Ge=X;Ge<V;Ge++)if(!(Ne=Ge===V-1?N?a[X+1]:void 0:a[Ge+1])||!a[Ge].equals(Ne)){He&&(ke=He),Q&&(_e=Q),Q=a[Ge],He=Ne?Ne.sub(Q)._unit()._perp():ke;var Ke=(ke=ke||He).add(He);Ke.x===0&&Ke.y===0||Ke._unit();var ot=ke.x*He.x+ke.y*He.y,At=Ke.x*He.x+Ke.y*He.y,gt=At!==0?1/At:1/0,Mt=2*Math.sqrt(2-2*At),zt=At<u9&&_e&&Ne,Wt=ke.x*He.y-ke.y*He.x>0;if(zt&&Ge>X){var gr=Q.dist(_e);if(gr>2*ie){var Qt=Q.sub(Q.sub(_e)._mult(ie/gr)._round());this.updateDistance(_e,Qt),this.addCurrentVertex(Qt,ke,0,0,ue),_e=Qt}}var xr=_e&&Ne,er=xr?A:N?"butt":b;if(xr&&er==="round"&&(gt<I?er="miter":gt<=2&&(er="fakeround")),er==="miter"&&gt>T&&(er="bevel"),er==="bevel"&&(gt>2&&(er="flipbevel"),gt<T&&(er="miter")),_e&&this.updateDistance(_e,Q),er==="miter")Ke._mult(gt),this.addCurrentVertex(Q,Ke,0,0,ue);else if(er==="flipbevel"){if(gt>100)Ke=He.mult(-1);else{var Qr=gt*ke.add(He).mag()/ke.sub(He).mag();Ke._perp()._mult(Qr*(Wt?-1:1))}this.addCurrentVertex(Q,Ke,0,0,ue),this.addCurrentVertex(Q,Ke.mult(-1),0,0,ue)}else if(er==="bevel"||er==="fakeround"){var Pr=-Math.sqrt(gt*gt-1),cr=Wt?Pr:0,on=Wt?0:Pr;if(_e&&this.addCurrentVertex(Q,ke,cr,on,ue),er==="fakeround")for(var $r=Math.round(180*Mt/Math.PI/20),pn=1;pn<$r;pn++){var wr=pn/$r;if(wr!==.5){var _n=wr-.5;wr+=wr*_n*(wr-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*_n*_n+(.848013+ot*(.215638*ot-1.06021)))}var Kn=He.sub(ke)._mult(wr)._add(ke)._unit()._mult(Wt?-1:1);this.addHalfVertex(Q,Kn.x,Kn.y,!1,Wt,0,ue)}Ne&&this.addCurrentVertex(Q,He,-cr,-on,ue)}else if(er==="butt")this.addCurrentVertex(Q,Ke,0,0,ue);else if(er==="square"){var yi=_e?1:-1;this.addCurrentVertex(Q,Ke,yi,yi,ue)}else er==="round"&&(_e&&(this.addCurrentVertex(Q,ke,0,0,ue),this.addCurrentVertex(Q,ke,1,1,ue,!0)),Ne&&(this.addCurrentVertex(Q,He,-1,-1,ue,!0),this.addCurrentVertex(Q,He,0,0,ue)));if(zt&&Ge<V-1){var Ai=Q.dist(Ne);if(Ai>2*ie){var qn=Q.add(Ne.sub(Q)._mult(ie/Ai)._round());this.updateDistance(Q,qn),this.addCurrentVertex(qn,He,0,0,ue),Q=qn}}}}},Ls.prototype.addCurrentVertex=function(a,l,A,b,T,I){I===void 0&&(I=!1);var F=l.y*b-l.x,N=-l.y-l.x*b;this.addHalfVertex(a,l.x+l.y*A,l.y-l.x*A,I,!1,A,T),this.addHalfVertex(a,F,N,I,!0,-b,T),this.distance>_T/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,l,A,b,T,I))},Ls.prototype.addHalfVertex=function(a,l,A,b,T,I,F){var N=.5*(this.lineClips?this.scaledDistance*(_T-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(b?1:0),(a.y<<1)+(T?1:0),Math.round(63*l)+128,Math.round(63*A)+128,1+(I===0?0:I<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var V=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),F.primitiveLength++),T?this.e2=V:this.e1=V},Ls.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ls.prototype.updateDistance=function(a,l){this.distance+=a.dist(l),this.updateScaledDistance()},rr("LineBucket",Ls,{omit:["layers","patternFeatures"]});var f9=new Gn({"line-cap":new _r(ae.layout_line["line-cap"]),"line-join":new or(ae.layout_line["line-join"]),"line-miter-limit":new _r(ae.layout_line["line-miter-limit"]),"line-round-limit":new _r(ae.layout_line["line-round-limit"]),"line-sort-key":new or(ae.layout_line["line-sort-key"])}),yT={paint:new Gn({"line-opacity":new or(ae.paint_line["line-opacity"]),"line-color":new or(ae.paint_line["line-color"]),"line-translate":new _r(ae.paint_line["line-translate"]),"line-translate-anchor":new _r(ae.paint_line["line-translate-anchor"]),"line-width":new or(ae.paint_line["line-width"]),"line-gap-width":new or(ae.paint_line["line-gap-width"]),"line-offset":new or(ae.paint_line["line-offset"]),"line-blur":new or(ae.paint_line["line-blur"]),"line-dasharray":new rs(ae.paint_line["line-dasharray"]),"line-pattern":new nu(ae.paint_line["line-pattern"]),"line-gradient":new Gi(ae.paint_line["line-gradient"])}),layout:f9},vT=new(function(a){function l(){a.apply(this,arguments)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.possiblyEvaluate=function(A,b){return b=new kr(Math.floor(b.zoom),{now:b.now,fadeDuration:b.fadeDuration,zoomHistory:b.zoomHistory,transition:b.transition}),a.prototype.possiblyEvaluate.call(this,A,b)},l.prototype.evaluate=function(A,b,T,I){return b=H({},b,{zoom:Math.floor(b.zoom)}),a.prototype.evaluate.call(this,A,b,T,I)},l}(or))(yT.paint.properties["line-width"].specification);vT.useIntegerZoom=!0;var h9=function(a){function l(A){a.call(this,A,yT),this.gradientVersion=0}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype._handleSpecialPaintPropertyUpdate=function(A){A==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Dn,this.gradientVersion=(this.gradientVersion+1)%O)},l.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},l.prototype.recalculate=function(A,b){a.prototype.recalculate.call(this,A,b),this.paint._values["line-floorwidth"]=vT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,A)},l.prototype.createBucket=function(A){return new Ls(A)},l.prototype.queryRadius=function(A){var b=A,T=bT(ga("line-width",this,b),ga("line-gap-width",this,b)),I=ga("line-offset",this,b);return T/2+Math.abs(I)+Hi(this.paint.get("line-translate"))},l.prototype.queryIntersectsFeature=function(A,b,T,I,F,N,V){var X=Ga(A,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,V),Q=V/2*bT(this.paint.get("line-width").evaluate(b,T),this.paint.get("line-gap-width").evaluate(b,T)),ie=this.paint.get("line-offset").evaluate(b,T);return ie&&(I=function(ue,_e){for(var Ne=[],ke=new x(0,0),He=0;He<ue.length;He++){for(var Ge=ue[He],Ke=[],ot=0;ot<Ge.length;ot++){var At=Ge[ot],gt=Ge[ot+1],Mt=ot===0?ke:At.sub(Ge[ot-1])._unit()._perp(),zt=ot===Ge.length-1?ke:gt.sub(At)._unit()._perp(),Wt=Mt._add(zt)._unit();Wt._mult(1/(Wt.x*zt.x+Wt.y*zt.y)),Ke.push(Wt._mult(_e)._add(At))}Ne.push(Ke)}return Ne}(I,ie*V)),function(ue,_e,Ne){for(var ke=0;ke<_e.length;ke++){var He=_e[ke];if(ue.length>=3){for(var Ge=0;Ge<He.length;Ge++)if(pa(ue,He[Ge]))return!0}if(xo(ue,He,Ne))return!0}return!1}(X,I,Q)},l.prototype.isTileClipped=function(){return!0},l}(Or);function bT(a,l){return l>0?l+2*a:a}var d9=Ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),A9=Ii([{name:"a_projected_pos",components:3,type:"Float32"}],4),p9=(Ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),xT=(Ii([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),g9=Ii([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function m9(a,l,A){return a.sections.forEach(function(b){b.text=function(T,I,F){var N=I.layout.get("text-transform").evaluate(F,{});return N==="uppercase"?T=T.toLocaleUpperCase():N==="lowercase"&&(T=T.toLocaleLowerCase()),Ki.applyArabicShaping&&(T=Ki.applyArabicShaping(T)),T}(b.text,l,A)}),a}Ii([{name:"triangle",components:3,type:"Uint16"}]),Ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ii([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ii([{type:"Float32",name:"offsetX"}]),Ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var jA={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},wT=function(a,l,A,b,T){var I,F,N=8*T-b-1,V=(1<<N)-1,X=V>>1,Q=-7,ie=T-1,ue=-1,_e=a[l+ie];for(ie+=ue,I=_e&(1<<-Q)-1,_e>>=-Q,Q+=N;Q>0;I=256*I+a[l+ie],ie+=ue,Q-=8);for(F=I&(1<<-Q)-1,I>>=-Q,Q+=b;Q>0;F=256*F+a[l+ie],ie+=ue,Q-=8);if(I===0)I=1-X;else{if(I===V)return F?NaN:1/0*(_e?-1:1);F+=Math.pow(2,b),I-=X}return(_e?-1:1)*F*Math.pow(2,I-b)},CT=function(a,l,A,b,T,I){var F,N,V,X=8*I-T-1,Q=(1<<X)-1,ie=Q>>1,ue=T===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=0,Ne=1,ke=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(N=isNaN(l)?1:0,F=Q):(F=Math.floor(Math.log(l)/Math.LN2),l*(V=Math.pow(2,-F))<1&&(F--,V*=2),(l+=F+ie>=1?ue/V:ue*Math.pow(2,1-ie))*V>=2&&(F++,V/=2),F+ie>=Q?(N=0,F=Q):F+ie>=1?(N=(l*V-1)*Math.pow(2,T),F+=ie):(N=l*Math.pow(2,ie-1)*Math.pow(2,T),F=0));T>=8;a[A+_e]=255&N,_e+=Ne,N/=256,T-=8);for(F=F<<T|N,X+=T;X>0;a[A+_e]=255&F,_e+=Ne,F/=256,X-=8);a[A+_e-Ne]|=128*ke},Lg=Vn;function Vn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Vn.Varint=0,Vn.Fixed64=1,Vn.Bytes=2,Vn.Fixed32=5;var TT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gl(a){return a.type===Vn.Bytes?a.readVarint()+a.pos:a.pos+1}function Eh(a,l,A){return A?4294967296*l+(a>>>0):4294967296*(l>>>0)+(a>>>0)}function ET(a,l,A){var b=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));A.realloc(b);for(var T=A.pos-1;T>=a;T--)A.buf[T+b]=A.buf[T]}function _9(a,l){for(var A=0;A<a.length;A++)l.writeVarint(a[A])}function y9(a,l){for(var A=0;A<a.length;A++)l.writeSVarint(a[A])}function v9(a,l){for(var A=0;A<a.length;A++)l.writeFloat(a[A])}function b9(a,l){for(var A=0;A<a.length;A++)l.writeDouble(a[A])}function x9(a,l){for(var A=0;A<a.length;A++)l.writeBoolean(a[A])}function w9(a,l){for(var A=0;A<a.length;A++)l.writeFixed32(a[A])}function C9(a,l){for(var A=0;A<a.length;A++)l.writeSFixed32(a[A])}function T9(a,l){for(var A=0;A<a.length;A++)l.writeFixed64(a[A])}function E9(a,l){for(var A=0;A<a.length;A++)l.writeSFixed64(a[A])}function Ng(a,l){return(a[l]|a[l+1]<<8|a[l+2]<<16)+16777216*a[l+3]}function Bh(a,l,A){a[A]=l,a[A+1]=l>>>8,a[A+2]=l>>>16,a[A+3]=l>>>24}function BT(a,l){return(a[l]|a[l+1]<<8|a[l+2]<<16)+(a[l+3]<<24)}function B9(a,l,A){a===1&&A.readMessage(S9,l)}function S9(a,l,A){if(a===3){var b=A.readMessage(I9,{}),T=b.width,I=b.height,F=b.left,N=b.top,V=b.advance;l.push({id:b.id,bitmap:new uf({width:T+6,height:I+6},b.bitmap),metrics:{width:T,height:I,left:F,top:N,advance:V}})}}function I9(a,l,A){a===1?l.id=A.readVarint():a===2?l.bitmap=A.readBytes():a===3?l.width=A.readVarint():a===4?l.height=A.readVarint():a===5?l.left=A.readSVarint():a===6?l.top=A.readSVarint():a===7&&(l.advance=A.readVarint())}function ST(a){for(var l=0,A=0,b=0,T=a;b<T.length;b+=1){var I=T[b];l+=I.w*I.h,A=Math.max(A,I.w)}a.sort(function(ke,He){return He.h-ke.h});for(var F=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),A),h:1/0}],N=0,V=0,X=0,Q=a;X<Q.length;X+=1)for(var ie=Q[X],ue=F.length-1;ue>=0;ue--){var _e=F[ue];if(!(ie.w>_e.w||ie.h>_e.h)){if(ie.x=_e.x,ie.y=_e.y,V=Math.max(V,ie.y+ie.h),N=Math.max(N,ie.x+ie.w),ie.w===_e.w&&ie.h===_e.h){var Ne=F.pop();ue<F.length&&(F[ue]=Ne)}else ie.h===_e.h?(_e.x+=ie.w,_e.w-=ie.w):ie.w===_e.w?(_e.y+=ie.h,_e.h-=ie.h):(F.push({x:_e.x+ie.w,y:_e.y,w:_e.w-ie.w,h:ie.h}),_e.y+=ie.h,_e.h-=ie.h);break}}return{w:N,h:V,fill:l/(N*V)||0}}Vn.prototype={destroy:function(){this.buf=null},readFields:function(a,l,A){for(A=A||this.length;this.pos<A;){var b=this.readVarint(),T=b>>3,I=this.pos;this.type=7&b,a(T,l,this),this.pos===I&&this.skip(b)}return l},readMessage:function(a,l){return this.readFields(a,l,this.readVarint()+this.pos)},readFixed32:function(){var a=Ng(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=BT(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Ng(this.buf,this.pos)+4294967296*Ng(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=Ng(this.buf,this.pos)+4294967296*BT(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=wT(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=wT(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var l,A,b=this.buf;return l=127&(A=b[this.pos++]),A<128?l:(l|=(127&(A=b[this.pos++]))<<7,A<128?l:(l|=(127&(A=b[this.pos++]))<<14,A<128?l:(l|=(127&(A=b[this.pos++]))<<21,A<128?l:function(T,I,F){var N,V,X=F.buf;if(N=(112&(V=X[F.pos++]))>>4,V<128||(N|=(127&(V=X[F.pos++]))<<3,V<128)||(N|=(127&(V=X[F.pos++]))<<10,V<128)||(N|=(127&(V=X[F.pos++]))<<17,V<128)||(N|=(127&(V=X[F.pos++]))<<24,V<128)||(N|=(1&(V=X[F.pos++]))<<31,V<128))return Eh(T,N,I);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(A=b[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,l=this.pos;return this.pos=a,a-l>=12&&TT?function(A,b,T){return TT.decode(A.subarray(b,T))}(this.buf,l,a):function(A,b,T){for(var I="",F=b;F<T;){var N,V,X,Q=A[F],ie=null,ue=Q>239?4:Q>223?3:Q>191?2:1;if(F+ue>T)break;ue===1?Q<128&&(ie=Q):ue===2?(192&(N=A[F+1]))==128&&(ie=(31&Q)<<6|63&N)<=127&&(ie=null):ue===3?(V=A[F+2],(192&(N=A[F+1]))==128&&(192&V)==128&&((ie=(15&Q)<<12|(63&N)<<6|63&V)<=2047||ie>=55296&&ie<=57343)&&(ie=null)):ue===4&&(V=A[F+2],X=A[F+3],(192&(N=A[F+1]))==128&&(192&V)==128&&(192&X)==128&&((ie=(15&Q)<<18|(63&N)<<12|(63&V)<<6|63&X)<=65535||ie>=1114112)&&(ie=null)),ie===null?(ie=65533,ue=1):ie>65535&&(ie-=65536,I+=String.fromCharCode(ie>>>10&1023|55296),ie=56320|1023&ie),I+=String.fromCharCode(ie),F+=ue}return I}(this.buf,l,a)},readBytes:function(){var a=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,a);return this.pos=a,l},readPackedVarint:function(a,l){if(this.type!==Vn.Bytes)return a.push(this.readVarint(l));var A=gl(this);for(a=a||[];this.pos<A;)a.push(this.readVarint(l));return a},readPackedSVarint:function(a){if(this.type!==Vn.Bytes)return a.push(this.readSVarint());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Vn.Bytes)return a.push(this.readBoolean());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Vn.Bytes)return a.push(this.readFloat());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Vn.Bytes)return a.push(this.readDouble());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Vn.Bytes)return a.push(this.readFixed32());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Vn.Bytes)return a.push(this.readSFixed32());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Vn.Bytes)return a.push(this.readFixed64());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Vn.Bytes)return a.push(this.readSFixed64());var l=gl(this);for(a=a||[];this.pos<l;)a.push(this.readSFixed64());return a},skip:function(a){var l=7&a;if(l===Vn.Varint)for(;this.buf[this.pos++]>127;);else if(l===Vn.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Vn.Fixed32)this.pos+=4;else{if(l!==Vn.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(a,l){this.writeVarint(a<<3|l)},realloc:function(a){for(var l=this.length||16;l<this.pos+a;)l*=2;if(l!==this.length){var A=new Uint8Array(l);A.set(this.buf),this.buf=A,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Bh(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Bh(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Bh(this.buf,-1&a,this.pos),Bh(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Bh(this.buf,-1&a,this.pos),Bh(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(l,A){var b,T;if(l>=0?(b=l%4294967296|0,T=l/4294967296|0):(T=~(-l/4294967296),4294967295^(b=~(-l%4294967296))?b=b+1|0:(b=0,T=T+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");A.realloc(10),function(I,F,N){N.buf[N.pos++]=127&I|128,I>>>=7,N.buf[N.pos++]=127&I|128,I>>>=7,N.buf[N.pos++]=127&I|128,I>>>=7,N.buf[N.pos++]=127&I|128,N.buf[N.pos]=127&(I>>>=7)}(b,0,A),function(I,F){var N=(7&I)<<4;F.buf[F.pos++]|=N|((I>>>=3)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I|((I>>>=7)?128:0),I&&(F.buf[F.pos++]=127&I)))))}(T,A)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var l=this.pos;this.pos=function(b,T,I){for(var F,N,V=0;V<T.length;V++){if((F=T.charCodeAt(V))>55295&&F<57344){if(!N){F>56319||V+1===T.length?(b[I++]=239,b[I++]=191,b[I++]=189):N=F;continue}if(F<56320){b[I++]=239,b[I++]=191,b[I++]=189,N=F;continue}F=N-55296<<10|F-56320|65536,N=null}else N&&(b[I++]=239,b[I++]=191,b[I++]=189,N=null);F<128?b[I++]=F:(F<2048?b[I++]=F>>6|192:(F<65536?b[I++]=F>>12|224:(b[I++]=F>>18|240,b[I++]=F>>12&63|128),b[I++]=F>>6&63|128),b[I++]=63&F|128)}return I}(this.buf,a,this.pos);var A=this.pos-l;A>=128&&ET(l,A,this),this.pos=l-1,this.writeVarint(A),this.pos+=A},writeFloat:function(a){this.realloc(4),CT(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),CT(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var l=a.length;this.writeVarint(l),this.realloc(l);for(var A=0;A<l;A++)this.buf[this.pos++]=a[A]},writeRawMessage:function(a,l){this.pos++;var A=this.pos;a(l,this);var b=this.pos-A;b>=128&&ET(A,b,this),this.pos=A-1,this.writeVarint(b),this.pos+=b},writeMessage:function(a,l,A){this.writeTag(a,Vn.Bytes),this.writeRawMessage(l,A)},writePackedVarint:function(a,l){l.length&&this.writeMessage(a,_9,l)},writePackedSVarint:function(a,l){l.length&&this.writeMessage(a,y9,l)},writePackedBoolean:function(a,l){l.length&&this.writeMessage(a,x9,l)},writePackedFloat:function(a,l){l.length&&this.writeMessage(a,v9,l)},writePackedDouble:function(a,l){l.length&&this.writeMessage(a,b9,l)},writePackedFixed32:function(a,l){l.length&&this.writeMessage(a,w9,l)},writePackedSFixed32:function(a,l){l.length&&this.writeMessage(a,C9,l)},writePackedFixed64:function(a,l){l.length&&this.writeMessage(a,T9,l)},writePackedSFixed64:function(a,l){l.length&&this.writeMessage(a,E9,l)},writeBytesField:function(a,l){this.writeTag(a,Vn.Bytes),this.writeBytes(l)},writeFixed32Field:function(a,l){this.writeTag(a,Vn.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(a,l){this.writeTag(a,Vn.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(a,l){this.writeTag(a,Vn.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(a,l){this.writeTag(a,Vn.Fixed64),this.writeSFixed64(l)},writeVarintField:function(a,l){this.writeTag(a,Vn.Varint),this.writeVarint(l)},writeSVarintField:function(a,l){this.writeTag(a,Vn.Varint),this.writeSVarint(l)},writeStringField:function(a,l){this.writeTag(a,Vn.Bytes),this.writeString(l)},writeFloatField:function(a,l){this.writeTag(a,Vn.Fixed32),this.writeFloat(l)},writeDoubleField:function(a,l){this.writeTag(a,Vn.Fixed64),this.writeDouble(l)},writeBooleanField:function(a,l){this.writeVarintField(a,!!l)}};var kg=function(a,l){var A=l.pixelRatio,b=l.version,T=l.stretchX,I=l.stretchY,F=l.content;this.paddedRect=a,this.pixelRatio=A,this.stretchX=T,this.stretchY=I,this.content=F,this.version=b},$A={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};$A.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},$A.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},$A.tlbr.get=function(){return this.tl.concat(this.br)},$A.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(kg.prototype,$A);var WA=function(a,l){var A={},b={};this.haveRenderCallbacks=[];var T=[];this.addImages(a,A,T),this.addImages(l,b,T);var I=ST(T),F=new Ys({width:I.w||1,height:I.h||1});for(var N in a){var V=a[N],X=A[N].paddedRect;Ys.copy(V.data,F,{x:0,y:0},{x:X.x+1,y:X.y+1},V.data)}for(var Q in l){var ie=l[Q],ue=b[Q].paddedRect,_e=ue.x+1,Ne=ue.y+1,ke=ie.data.width,He=ie.data.height;Ys.copy(ie.data,F,{x:0,y:0},{x:_e,y:Ne},ie.data),Ys.copy(ie.data,F,{x:0,y:He-1},{x:_e,y:Ne-1},{width:ke,height:1}),Ys.copy(ie.data,F,{x:0,y:0},{x:_e,y:Ne+He},{width:ke,height:1}),Ys.copy(ie.data,F,{x:ke-1,y:0},{x:_e-1,y:Ne},{width:1,height:He}),Ys.copy(ie.data,F,{x:0,y:0},{x:_e+ke,y:Ne},{width:1,height:He})}this.image=F,this.iconPositions=A,this.patternPositions=b};WA.prototype.addImages=function(a,l,A){for(var b in a){var T=a[b],I={x:0,y:0,w:T.data.width+2,h:T.data.height+2};A.push(I),l[b]=new kg(I,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(b)}},WA.prototype.patchUpdatedImages=function(a,l){for(var A in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[A],a.getImage(A),l),this.patchUpdatedImage(this.patternPositions[A],a.getImage(A),l)},WA.prototype.patchUpdatedImage=function(a,l,A){if(a&&l&&a.version!==l.version){a.version=l.version;var b=a.tl;A.update(l.data,void 0,{x:b[0],y:b[1]})}},rr("ImagePosition",kg),rr("ImageAtlas",WA);var wo={horizontal:1,vertical:2,horizontalOnly:3},Sh=function(){this.scale=1,this.fontStack="",this.imageName=null};Sh.forText=function(a,l){var A=new Sh;return A.scale=a||1,A.fontStack=l,A},Sh.forImage=function(a){var l=new Sh;return l.imageName=a,l};var bs=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Ug(a,l,A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke){var He,Ge=bs.fromFeature(a,T);ie===wo.vertical&&Ge.verticalizePunctuation();var Ke=Ki.processBidirectionalText,ot=Ki.processStyledBidirectionalText;if(Ke&&Ge.sections.length===1){He=[];for(var At=0,gt=Ke(Ge.toString(),Gy(Ge,X,I,l,b,_e,Ne));At<gt.length;At+=1){var Mt=gt[At],zt=new bs;zt.text=Mt,zt.sections=Ge.sections;for(var Wt=0;Wt<Mt.length;Wt++)zt.sectionIndex.push(0);He.push(zt)}}else if(ot){He=[];for(var gr=0,Qt=ot(Ge.text,Ge.sectionIndex,Gy(Ge,X,I,l,b,_e,Ne));gr<Qt.length;gr+=1){var xr=Qt[gr],er=new bs;er.text=xr[0],er.sectionIndex=xr[1],er.sections=Ge.sections,He.push(er)}}else He=function(cr,on){for(var $r=[],pn=cr.text,wr=0,_n=0,Kn=on;_n<Kn.length;_n+=1){var yi=Kn[_n];$r.push(cr.substring(wr,yi)),wr=yi}return wr<pn.length&&$r.push(cr.substring(wr,pn.length)),$r}(Ge,Gy(Ge,X,I,l,b,_e,Ne));var Qr=[],Pr={positionedLines:Qr,text:Ge.toString(),top:Q[1],bottom:Q[1],left:Q[0],right:Q[0],writingMode:ie,iconsInText:!1,verticalizable:!1};return function(cr,on,$r,pn,wr,_n,Kn,yi,Ai,qn,vi,ji){for(var $i=0,xs=-17,es=0,ws=0,wi=yi==="right"?1:yi==="left"?0:.5,ts=0,un=0,Rn=wr;un<Rn.length;un+=1){var Cn=Rn[un];Cn.trim();var mn=Cn.getMaxScale(),Ns=24*(mn-1),fs={positionedGlyphs:[],lineOffset:0};cr.positionedLines[ts]=fs;var Wn=fs.positionedGlyphs,Mi=0;if(Cn.length()){for(var hs=0;hs<Cn.length();hs++){var yn=Cn.getSection(hs),Sc=Cn.getSectionIndex(hs),Co=Cn.getCharCode(hs),Ic=0,Ci=null,Mc=null,ma=null,Lh=24,Af=!(Ai===wo.horizontal||!vi&&!eu(Co)||vi&&(zg[Co]||(vl=Co,Jt.Arabic(vl)||Jt["Arabic Supplement"](vl)||Jt["Arabic Extended-A"](vl)||Jt["Arabic Presentation Forms-A"](vl)||Jt["Arabic Presentation Forms-B"](vl))));if(yn.imageName){var Nh=pn[yn.imageName];if(!Nh)continue;ma=yn.imageName,cr.iconsInText=cr.iconsInText||!0,Mc=Nh.paddedRect;var yl=Nh.displaySize;yn.scale=24*yn.scale/ji,Ic=Ns+(24-yl[1]*yn.scale),Lh=(Ci={width:yl[0],height:yl[1],left:1,top:-3,advance:Af?yl[1]:yl[0]}).advance;var kh=Af?yl[0]*yn.scale-24*mn:yl[1]*yn.scale-24*mn;kh>0&&kh>Mi&&(Mi=kh)}else{var Kg=$r[yn.fontStack],Uh=Kg&&Kg[Co];if(Uh&&Uh.rect)Mc=Uh.rect,Ci=Uh.metrics;else{var KA=on[yn.fontStack],qg=KA&&KA[Co];if(!qg)continue;Ci=qg.metrics}Ic=24*(mn-yn.scale)}Af?(cr.verticalizable=!0,Wn.push({glyph:Co,imageName:ma,x:$i,y:xs+Ic,vertical:Af,scale:yn.scale,fontStack:yn.fontStack,sectionIndex:Sc,metrics:Ci,rect:Mc}),$i+=Lh*yn.scale+qn):(Wn.push({glyph:Co,imageName:ma,x:$i,y:xs+Ic,vertical:Af,scale:yn.scale,fontStack:yn.fontStack,sectionIndex:Sc,metrics:Ci,rect:Mc}),$i+=Ci.advance*yn.scale+qn)}Wn.length!==0&&(es=Math.max($i-qn,es),P9(Wn,0,Wn.length-1,wi,Mi)),$i=0;var Yg=_n*mn+Mi;fs.lineOffset=Math.max(Mi,Ns),xs+=Yg,ws=Math.max(Yg,ws),++ts}else xs+=_n,++ts}var vl,qA=xs- -17,zh=Vy(Kn),uu=zh.horizontalAlign,Gh=zh.verticalAlign;(function(Zg,Qg,YA,ZA,e0,QA,ep,tp,t0){var Vh,r0=(Qg-YA)*e0;Vh=QA!==ep?-tp*ZA- -17:(-ZA*t0+.5)*ep;for(var Hh=0,rp=Zg;Hh<rp.length;Hh+=1)for(var pf=0,np=rp[Hh].positionedGlyphs;pf<np.length;pf+=1){var jh=np[pf];jh.x+=r0,jh.y+=Vh}})(cr.positionedLines,wi,uu,Gh,es,ws,_n,qA,wr.length),cr.top+=-Gh*qA,cr.bottom=cr.top+qA,cr.left+=-uu*es,cr.right=cr.left+es}(Pr,l,A,b,He,F,N,V,ie,X,ue,ke),!function(cr){for(var on=0,$r=cr;on<$r.length;on+=1)if($r[on].positionedGlyphs.length!==0)return!1;return!0}(Qr)&&Pr}bs.fromFeature=function(a,l){for(var A=new bs,b=0;b<a.sections.length;b++){var T=a.sections[b];T.image?A.addImageSection(T):A.addTextSection(T,l)}return A},bs.prototype.length=function(){return this.text.length},bs.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},bs.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},bs.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},bs.prototype.verticalizePunctuation=function(){this.text=function(a){for(var l="",A=0;A<a.length;A++){var b=a.charCodeAt(A+1)||null,T=a.charCodeAt(A-1)||null;l+=b&&tf(b)&&!jA[a[A+1]]||T&&tf(T)&&!jA[a[A-1]]||!jA[a[A]]?a[A]:jA[a[A]]}return l}(this.text)},bs.prototype.trim=function(){for(var a=0,l=0;l<this.text.length&&zg[this.text.charCodeAt(l)];l++)a++;for(var A=this.text.length,b=this.text.length-1;b>=0&&b>=a&&zg[this.text.charCodeAt(b)];b--)A--;this.text=this.text.substring(a,A),this.sectionIndex=this.sectionIndex.slice(a,A)},bs.prototype.substring=function(a,l){var A=new bs;return A.text=this.text.substring(a,l),A.sectionIndex=this.sectionIndex.slice(a,l),A.sections=this.sections,A},bs.prototype.toString=function(){return this.text},bs.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(l,A){return Math.max(l,a.sections[A].scale)},0)},bs.prototype.addTextSection=function(a,l){this.text+=a.text,this.sections.push(Sh.forText(a.scale,a.fontStack||l));for(var A=this.sections.length-1,b=0;b<a.text.length;++b)this.sectionIndex.push(A)},bs.prototype.addImageSection=function(a){var l=a.image?a.image.name:"";if(l.length!==0){var A=this.getNextImageSectionCharCode();A?(this.text+=String.fromCharCode(A),this.sections.push(Sh.forImage(l)),this.sectionIndex.push(this.sections.length-1)):re("Reached maximum number of images 6401")}else re("Can't add FormattedSection with an empty image.")},bs.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var zg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},po={};function IT(a,l,A,b,T,I){if(l.imageName){var F=b[l.imageName];return F?F.displaySize[0]*l.scale*24/I+T:0}var N=A[l.fontStack],V=N&&N[a];return V?V.metrics.advance*l.scale+T:0}function MT(a,l,A,b){var T=Math.pow(a-l,2);return b?a<l?T/2:2*T:T+Math.abs(A)*A}function M9(a,l,A){var b=0;return a===10&&(b-=1e4),A&&(b+=150),a!==40&&a!==65288||(b+=50),l!==41&&l!==65289||(b+=50),b}function PT(a,l,A,b,T,I){for(var F=null,N=MT(l,A,T,I),V=0,X=b;V<X.length;V+=1){var Q=X[V],ie=MT(l-Q.x,A,T,I)+Q.badness;ie<=N&&(F=Q,N=ie)}return{index:a,x:l,priorBreak:F,badness:N}}function Gy(a,l,A,b,T,I,F){if(I!=="point")return[];if(!a)return[];for(var N,V=[],X=function(He,Ge,Ke,ot,At,gt){for(var Mt=0,zt=0;zt<He.length();zt++){var Wt=He.getSection(zt);Mt+=IT(He.getCharCode(zt),Wt,ot,At,Ge,gt)}return Mt/Math.max(1,Math.ceil(Mt/Ke))}(a,l,A,b,T,F),Q=a.text.indexOf("")>=0,ie=0,ue=0;ue<a.length();ue++){var _e=a.getSection(ue),Ne=a.getCharCode(ue);if(zg[Ne]||(ie+=IT(Ne,_e,b,T,l,F)),ue<a.length()-1){var ke=!((N=Ne)<11904||!(Jt["Bopomofo Extended"](N)||Jt.Bopomofo(N)||Jt["CJK Compatibility Forms"](N)||Jt["CJK Compatibility Ideographs"](N)||Jt["CJK Compatibility"](N)||Jt["CJK Radicals Supplement"](N)||Jt["CJK Strokes"](N)||Jt["CJK Symbols and Punctuation"](N)||Jt["CJK Unified Ideographs Extension A"](N)||Jt["CJK Unified Ideographs"](N)||Jt["Enclosed CJK Letters and Months"](N)||Jt["Halfwidth and Fullwidth Forms"](N)||Jt.Hiragana(N)||Jt["Ideographic Description Characters"](N)||Jt["Kangxi Radicals"](N)||Jt["Katakana Phonetic Extensions"](N)||Jt.Katakana(N)||Jt["Vertical Forms"](N)||Jt["Yi Radicals"](N)||Jt["Yi Syllables"](N)));(po[Ne]||ke||_e.imageName)&&V.push(PT(ue+1,ie,X,V,M9(Ne,a.getCharCode(ue+1),ke&&Q),!1))}}return function He(Ge){return Ge?He(Ge.priorBreak).concat(Ge.index):[]}(PT(a.length(),ie,X,V,0,!0))}function Vy(a){var l=.5,A=.5;switch(a){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0}return{horizontalAlign:l,verticalAlign:A}}function P9(a,l,A,b,T){if(b||T)for(var I=a[A],F=(a[A].x+I.metrics.advance*I.scale)*b,N=l;N<=A;N++)a[N].x-=F,a[N].y+=T}function RT(a,l,A,b,T,I){var F,N=a.image;if(N.content){var V=N.content,X=N.pixelRatio||1;F=[V[0]/X,V[1]/X,N.displaySize[0]-V[2]/X,N.displaySize[1]-V[3]/X]}var Q,ie,ue,_e,Ne=l.left*I,ke=l.right*I;A==="width"||A==="both"?(_e=T[0]+Ne-b[3],ie=T[0]+ke+b[1]):ie=(_e=T[0]+(Ne+ke-N.displaySize[0])/2)+N.displaySize[0];var He=l.top*I,Ge=l.bottom*I;return A==="height"||A==="both"?(Q=T[1]+He-b[0],ue=T[1]+Ge+b[2]):ue=(Q=T[1]+(He+Ge-N.displaySize[1])/2)+N.displaySize[1],{image:N,top:Q,right:ie,bottom:ue,left:_e,collisionPadding:F}}po[10]=!0,po[32]=!0,po[38]=!0,po[40]=!0,po[41]=!0,po[43]=!0,po[45]=!0,po[47]=!0,po[173]=!0,po[183]=!0,po[8203]=!0,po[8208]=!0,po[8211]=!0,po[8231]=!0;var Ih=function(a){function l(A,b,T,I){a.call(this,A,b),this.angle=T,I!==void 0&&(this.segment=I)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.clone=function(){return new l(this.x,this.y,this.angle,this.segment)},l}(x);function Hy(a,l){var A=l.expression;if(A.kind==="constant")return{kind:"constant",layoutSize:A.evaluate(new kr(a+1))};if(A.kind==="source")return{kind:"source"};for(var b=A.zoomStops,T=A.interpolationType,I=0;I<b.length&&b[I]<=a;)I++;for(var F=I=Math.max(0,I-1);F<b.length&&b[F]<a+1;)F++;F=Math.min(b.length-1,F);var N=b[I],V=b[F];return A.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:V,interpolationType:T}:{kind:"camera",minZoom:N,maxZoom:V,minSize:A.evaluate(new kr(N)),maxSize:A.evaluate(new kr(V)),interpolationType:T}}function FT(a,l,A){var b=l.uSize,T=A.lowerSize;return a.kind==="source"?T/128:a.kind==="composite"?ii(T/128,A.upperSize/128,l.uSizeT):b}function DT(a,l){var A=0,b=0;if(a.kind==="constant")b=a.layoutSize;else if(a.kind!=="source"){var T=a.interpolationType,I=T?J(Ri.interpolationFactor(T,l,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?b=ii(a.minSize,a.maxSize,I):A=I}return{uSizeT:A,uSize:b}}rr("Anchor",Ih);var R9=Object.freeze({__proto__:null,getSizeData:Hy,evaluateSizeForFeature:FT,evaluateSizeForZoom:DT,SIZE_PACK_FACTOR:128});function OT(a,l,A,b,T){if(l.segment===void 0)return!0;for(var I=l,F=l.segment+1,N=0;N>-A/2;){if(--F<0)return!1;N-=a[F].dist(I),I=a[F]}N+=a[F].dist(a[F+1]),F++;for(var V=[],X=0;N<A/2;){var Q=a[F],ie=a[F+1];if(!ie)return!1;var ue=a[F-1].angleTo(Q)-Q.angleTo(ie);for(ue=Math.abs((ue+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:N,angleDelta:ue}),X+=ue;N-V[0].distance>b;)X-=V.shift().angleDelta;if(X>T)return!1;F++,N+=Q.dist(ie)}return!0}function LT(a){for(var l=0,A=0;A<a.length-1;A++)l+=a[A].dist(a[A+1]);return l}function NT(a,l,A){return a?.6*l*A:0}function kT(a,l){return Math.max(a?a.right-a.left:0,l?l.right-l.left:0)}function F9(a,l,A,b,T,I){for(var F=NT(A,T,I),N=kT(A,b)*I,V=0,X=LT(a)/2,Q=0;Q<a.length-1;Q++){var ie=a[Q],ue=a[Q+1],_e=ie.dist(ue);if(V+_e>X){var Ne=(X-V)/_e,ke=ii(ie.x,ue.x,Ne),He=ii(ie.y,ue.y,Ne),Ge=new Ih(ke,He,ue.angleTo(ie),Q);return Ge._round(),!F||OT(a,Ge,N,F,l)?Ge:void 0}V+=_e}}function D9(a,l,A,b,T,I,F,N,V){var X=NT(b,I,F),Q=kT(b,T),ie=Q*F,ue=a[0].x===0||a[0].x===V||a[0].y===0||a[0].y===V;return l-ie<l/4&&(l=ie+l/4),function _e(Ne,ke,He,Ge,Ke,ot,At,gt,Mt){for(var zt=ot/2,Wt=LT(Ne),gr=0,Qt=ke-He,xr=[],er=0;er<Ne.length-1;er++){for(var Qr=Ne[er],Pr=Ne[er+1],cr=Qr.dist(Pr),on=Pr.angleTo(Qr);Qt+He<gr+cr;){var $r=((Qt+=He)-gr)/cr,pn=ii(Qr.x,Pr.x,$r),wr=ii(Qr.y,Pr.y,$r);if(pn>=0&&pn<Mt&&wr>=0&&wr<Mt&&Qt-zt>=0&&Qt+zt<=Wt){var _n=new Ih(pn,wr,on,er);_n._round(),Ge&&!OT(Ne,_n,ot,Ge,Ke)||xr.push(_n)}}gr+=cr}return gt||xr.length||At||(xr=_e(Ne,gr/2,He,Ge,Ke,ot,At,!0,Mt)),xr}(a,ue?l/2*N%l:(Q/2+2*I)*F*N%l,l,X,A,ie,ue,!1,V)}function UT(a,l,A,b,T){for(var I=[],F=0;F<a.length;F++)for(var N=a[F],V=void 0,X=0;X<N.length-1;X++){var Q=N[X],ie=N[X+1];Q.x<l&&ie.x<l||(Q.x<l?Q=new x(l,Q.y+(l-Q.x)/(ie.x-Q.x)*(ie.y-Q.y))._round():ie.x<l&&(ie=new x(l,Q.y+(l-Q.x)/(ie.x-Q.x)*(ie.y-Q.y))._round()),Q.y<A&&ie.y<A||(Q.y<A?Q=new x(Q.x+(A-Q.y)/(ie.y-Q.y)*(ie.x-Q.x),A)._round():ie.y<A&&(ie=new x(Q.x+(A-Q.y)/(ie.y-Q.y)*(ie.x-Q.x),A)._round()),Q.x>=b&&ie.x>=b||(Q.x>=b?Q=new x(b,Q.y+(b-Q.x)/(ie.x-Q.x)*(ie.y-Q.y))._round():ie.x>=b&&(ie=new x(b,Q.y+(b-Q.x)/(ie.x-Q.x)*(ie.y-Q.y))._round()),Q.y>=T&&ie.y>=T||(Q.y>=T?Q=new x(Q.x+(T-Q.y)/(ie.y-Q.y)*(ie.x-Q.x),T)._round():ie.y>=T&&(ie=new x(Q.x+(T-Q.y)/(ie.y-Q.y)*(ie.x-Q.x),T)._round()),V&&Q.equals(V[V.length-1])||I.push(V=[Q]),V.push(ie)))))}return I}function zT(a,l,A,b){var T=[],I=a.image,F=I.pixelRatio,N=I.paddedRect.w-2,V=I.paddedRect.h-2,X=a.right-a.left,Q=a.bottom-a.top,ie=I.stretchX||[[0,N]],ue=I.stretchY||[[0,V]],_e=function(pn,wr){return pn+wr[1]-wr[0]},Ne=ie.reduce(_e,0),ke=ue.reduce(_e,0),He=N-Ne,Ge=V-ke,Ke=0,ot=Ne,At=0,gt=ke,Mt=0,zt=He,Wt=0,gr=Ge;if(I.content&&b){var Qt=I.content;Ke=Gg(ie,0,Qt[0]),At=Gg(ue,0,Qt[1]),ot=Gg(ie,Qt[0],Qt[2]),gt=Gg(ue,Qt[1],Qt[3]),Mt=Qt[0]-Ke,Wt=Qt[1]-At,zt=Qt[2]-Qt[0]-ot,gr=Qt[3]-Qt[1]-gt}var xr=function(pn,wr,_n,Kn){var yi=Vg(pn.stretch-Ke,ot,X,a.left),Ai=Hg(pn.fixed-Mt,zt,pn.stretch,Ne),qn=Vg(wr.stretch-At,gt,Q,a.top),vi=Hg(wr.fixed-Wt,gr,wr.stretch,ke),ji=Vg(_n.stretch-Ke,ot,X,a.left),$i=Hg(_n.fixed-Mt,zt,_n.stretch,Ne),xs=Vg(Kn.stretch-At,gt,Q,a.top),es=Hg(Kn.fixed-Wt,gr,Kn.stretch,ke),ws=new x(yi,qn),wi=new x(ji,qn),ts=new x(ji,xs),un=new x(yi,xs),Rn=new x(Ai/F,vi/F),Cn=new x($i/F,es/F),mn=l*Math.PI/180;if(mn){var Ns=Math.sin(mn),fs=Math.cos(mn),Wn=[fs,-Ns,Ns,fs];ws._matMult(Wn),wi._matMult(Wn),un._matMult(Wn),ts._matMult(Wn)}var Mi=pn.stretch+pn.fixed,hs=wr.stretch+wr.fixed;return{tl:ws,tr:wi,bl:un,br:ts,tex:{x:I.paddedRect.x+1+Mi,y:I.paddedRect.y+1+hs,w:_n.stretch+_n.fixed-Mi,h:Kn.stretch+Kn.fixed-hs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rn,pixelOffsetBR:Cn,minFontScaleX:zt/F/X,minFontScaleY:gr/F/Q,isSDF:A}};if(b&&(I.stretchX||I.stretchY))for(var er=GT(ie,He,Ne),Qr=GT(ue,Ge,ke),Pr=0;Pr<er.length-1;Pr++)for(var cr=er[Pr],on=er[Pr+1],$r=0;$r<Qr.length-1;$r++)T.push(xr(cr,Qr[$r],on,Qr[$r+1]));else T.push(xr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:V+1}));return T}function Gg(a,l,A){for(var b=0,T=0,I=a;T<I.length;T+=1){var F=I[T];b+=Math.max(l,Math.min(A,F[1]))-Math.max(l,Math.min(A,F[0]))}return b}function GT(a,l,A){for(var b=[{fixed:-1,stretch:0}],T=0,I=a;T<I.length;T+=1){var F=I[T],N=F[0],V=F[1],X=b[b.length-1];b.push({fixed:N-X.stretch,stretch:X.stretch}),b.push({fixed:N-X.stretch,stretch:X.stretch+(V-N)})}return b.push({fixed:l+1,stretch:A}),b}function Vg(a,l,A,b){return a/l*A+b}function Hg(a,l,A,b){return a-l*A/b}var jg=function(a,l,A,b,T,I,F,N,V,X){if(this.boxStartIndex=a.length,V){var Q=I.top,ie=I.bottom,ue=I.collisionPadding;ue&&(Q-=ue[1],ie+=ue[3]);var _e=ie-Q;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Ne=I.top*F-N,ke=I.bottom*F+N,He=I.left*F-N,Ge=I.right*F+N,Ke=I.collisionPadding;if(Ke&&(He-=Ke[0]*F,Ne-=Ke[1]*F,Ge+=Ke[2]*F,ke+=Ke[3]*F),X){var ot=new x(He,Ne),At=new x(Ge,Ne),gt=new x(He,ke),Mt=new x(Ge,ke),zt=X*Math.PI/180;ot._rotate(zt),At._rotate(zt),gt._rotate(zt),Mt._rotate(zt),He=Math.min(ot.x,At.x,gt.x,Mt.x),Ge=Math.max(ot.x,At.x,gt.x,Mt.x),Ne=Math.min(ot.y,At.y,gt.y,Mt.y),ke=Math.max(ot.y,At.y,gt.y,Mt.y)}a.emplaceBack(l.x,l.y,He,Ne,Ge,ke,A,b,T)}this.boxEndIndex=a.length},Mh=function(a,l){if(a===void 0&&(a=[]),l===void 0&&(l=O9),this.data=a,this.length=this.data.length,this.compare=l,this.length>0)for(var A=(this.length>>1)-1;A>=0;A--)this._down(A)};function O9(a,l){return a<l?-1:a>l?1:0}function L9(a,l,A){A===void 0&&(A=!1);for(var b=1/0,T=1/0,I=-1/0,F=-1/0,N=a[0],V=0;V<N.length;V++){var X=N[V];(!V||X.x<b)&&(b=X.x),(!V||X.y<T)&&(T=X.y),(!V||X.x>I)&&(I=X.x),(!V||X.y>F)&&(F=X.y)}var Q=Math.min(I-b,F-T),ie=Q/2,ue=new Mh([],N9);if(Q===0)return new x(b,T);for(var _e=b;_e<I;_e+=Q)for(var Ne=T;Ne<F;Ne+=Q)ue.push(new Ph(_e+ie,Ne+ie,ie,a));for(var ke=function(Ke){for(var ot=0,At=0,gt=0,Mt=Ke[0],zt=0,Wt=Mt.length,gr=Wt-1;zt<Wt;gr=zt++){var Qt=Mt[zt],xr=Mt[gr],er=Qt.x*xr.y-xr.x*Qt.y;At+=(Qt.x+xr.x)*er,gt+=(Qt.y+xr.y)*er,ot+=3*er}return new Ph(At/ot,gt/ot,0,Ke)}(a),He=ue.length;ue.length;){var Ge=ue.pop();(Ge.d>ke.d||!ke.d)&&(ke=Ge,A&&console.log("found best %d after %d probes",Math.round(1e4*Ge.d)/1e4,He)),Ge.max-ke.d<=l||(ue.push(new Ph(Ge.p.x-(ie=Ge.h/2),Ge.p.y-ie,ie,a)),ue.push(new Ph(Ge.p.x+ie,Ge.p.y-ie,ie,a)),ue.push(new Ph(Ge.p.x-ie,Ge.p.y+ie,ie,a)),ue.push(new Ph(Ge.p.x+ie,Ge.p.y+ie,ie,a)),He+=4)}return A&&(console.log("num probes: "+He),console.log("best distance: "+ke.d)),ke.p}function N9(a,l){return l.max-a.max}function Ph(a,l,A,b){this.p=new x(a,l),this.h=A,this.d=function(T,I){for(var F=!1,N=1/0,V=0;V<I.length;V++)for(var X=I[V],Q=0,ie=X.length,ue=ie-1;Q<ie;ue=Q++){var _e=X[Q],Ne=X[ue];_e.y>T.y!=Ne.y>T.y&&T.x<(Ne.x-_e.x)*(T.y-_e.y)/(Ne.y-_e.y)+_e.x&&(F=!F),N=Math.min(N,ou(T,_e,Ne))}return(F?1:-1)*Math.sqrt(N)}(this.p,b),this.max=this.d+this.h*Math.SQRT2}Mh.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Mh.prototype.pop=function(){if(this.length!==0){var a=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),a}},Mh.prototype.peek=function(){return this.data[0]},Mh.prototype._up=function(a){for(var l=this.data,A=this.compare,b=l[a];a>0;){var T=a-1>>1,I=l[T];if(A(b,I)>=0)break;l[a]=I,a=T}l[a]=b},Mh.prototype._down=function(a){for(var l=this.data,A=this.compare,b=this.length>>1,T=l[a];a<b;){var I=1+(a<<1),F=l[I],N=I+1;if(N<this.length&&A(l[N],F)<0&&(I=N,F=l[N]),A(F,T)>=0)break;l[a]=F,a=I}l[a]=T};var jy=Number.POSITIVE_INFINITY;function VT(a,l){return l[1]!==jy?function(A,b,T){var I=0,F=0;switch(b=Math.abs(b),T=Math.abs(T),A){case"top-right":case"top-left":case"top":F=T-7;break;case"bottom-right":case"bottom-left":case"bottom":F=7-T}switch(A){case"top-right":case"bottom-right":case"right":I=-b;break;case"top-left":case"bottom-left":case"left":I=b}return[I,F]}(a,l[0],l[1]):function(A,b){var T=0,I=0;b<0&&(b=0);var F=b/Math.sqrt(2);switch(A){case"top-right":case"top-left":I=F-7;break;case"bottom-right":case"bottom-left":I=7-F;break;case"bottom":I=7-b;break;case"top":I=b-7}switch(A){case"top-right":case"bottom-right":T=-F;break;case"top-left":case"bottom-left":T=F;break;case"left":T=b;break;case"right":T=-b}return[T,I]}(a,l[0])}function $y(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function HT(a,l,A,b,T,I,F,N,V,X,Q,ie,ue,_e,Ne){var ke=function(At,gt,Mt,zt,Wt,gr,Qt,xr){for(var er=zt.layout.get("text-rotate").evaluate(gr,{})*Math.PI/180,Qr=[],Pr=0,cr=gt.positionedLines;Pr<cr.length;Pr+=1)for(var on=cr[Pr],$r=0,pn=on.positionedGlyphs;$r<pn.length;$r+=1){var wr=pn[$r];if(wr.rect){var _n=wr.rect||{},Kn=4,yi=!0,Ai=1,qn=0,vi=(Wt||xr)&&wr.vertical,ji=wr.metrics.advance*wr.scale/2;if(xr&&gt.verticalizable&&(qn=on.lineOffset/2-(wr.imageName?-(24-wr.metrics.width*wr.scale)/2:24*(wr.scale-1))),wr.imageName){var $i=Qt[wr.imageName];yi=$i.sdf,Kn=1/(Ai=$i.pixelRatio)}var xs=Wt?[wr.x+ji,wr.y]:[0,0],es=Wt?[0,0]:[wr.x+ji+Mt[0],wr.y+Mt[1]-qn],ws=[0,0];vi&&(ws=es,es=[0,0]);var wi=(wr.metrics.left-Kn)*wr.scale-ji+es[0],ts=(-wr.metrics.top-Kn)*wr.scale+es[1],un=wi+_n.w*wr.scale/Ai,Rn=ts+_n.h*wr.scale/Ai,Cn=new x(wi,ts),mn=new x(un,ts),Ns=new x(wi,Rn),fs=new x(un,Rn);if(vi){var Wn=new x(-ji,ji- -17),Mi=-Math.PI/2,hs=12-ji,yn=new x(22-hs,-(wr.imageName?hs:0)),Sc=new(Function.prototype.bind.apply(x,[null].concat(ws)));Cn._rotateAround(Mi,Wn)._add(yn)._add(Sc),mn._rotateAround(Mi,Wn)._add(yn)._add(Sc),Ns._rotateAround(Mi,Wn)._add(yn)._add(Sc),fs._rotateAround(Mi,Wn)._add(yn)._add(Sc)}if(er){var Co=Math.sin(er),Ic=Math.cos(er),Ci=[Ic,-Co,Co,Ic];Cn._matMult(Ci),mn._matMult(Ci),Ns._matMult(Ci),fs._matMult(Ci)}var Mc=new x(0,0),ma=new x(0,0);Qr.push({tl:Cn,tr:mn,bl:Ns,br:fs,tex:_n,writingMode:gt.writingMode,glyphOffset:xs,sectionIndex:wr.sectionIndex,isSDF:yi,pixelOffsetTL:Mc,pixelOffsetBR:ma,minFontScaleX:0,minFontScaleY:0})}}return Qr}(0,A,N,T,I,F,b,a.allowVerticalPlacement),He=a.textSizeData,Ge=null;He.kind==="source"?(Ge=[128*T.layout.get("text-size").evaluate(F,{})])[0]>32640&&re(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):He.kind==="composite"&&((Ge=[128*_e.compositeTextSizes[0].evaluate(F,{},Ne),128*_e.compositeTextSizes[1].evaluate(F,{},Ne)])[0]>32640||Ge[1]>32640)&&re(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,ke,Ge,N,I,F,X,l,V.lineStartIndex,V.lineLength,ue,Ne);for(var Ke=0,ot=Q;Ke<ot.length;Ke+=1)ie[ot[Ke]]=a.text.placedSymbolArray.length-1;return 4*ke.length}function jT(a){for(var l in a)return a[l];return null}function k9(a,l,A,b){var T=a.compareText;if(l in T){for(var I=T[l],F=I.length-1;F>=0;F--)if(b.dist(I[F])<A)return!0}else T[l]=[];return T[l].push(b),!1}var U9=Th.VectorTileFeature.types,z9=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $g(a,l,A,b,T,I,F,N,V,X,Q,ie,ue){var _e=N?Math.min(32640,Math.round(N[0])):0,Ne=N?Math.min(32640,Math.round(N[1])):0;a.emplaceBack(l,A,Math.round(32*b),Math.round(32*T),I,F,(_e<<1)+(V?1:0),Ne,16*X,16*Q,256*ie,256*ue)}function Wy(a,l,A){a.emplaceBack(l.x,l.y,A),a.emplaceBack(l.x,l.y,A),a.emplaceBack(l.x,l.y,A),a.emplaceBack(l.x,l.y,A)}function G9(a){for(var l=0,A=a.sections;l<A.length;l+=1)if(tu(A[l].text))return!0;return!1}var Rh=function(a){this.layoutVertexArray=new Ht,this.indexArray=new $o,this.programConfigurations=a,this.segments=new Z,this.dynamicLayoutVertexArray=new Yt,this.opacityVertexArray=new Cc,this.placedSymbolArray=new g};Rh.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Rh.prototype.upload=function(a,l,A,b){this.isEmpty()||(A&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,d9.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,A9.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,z9,!0),this.opacityVertexBuffer.itemSize=1),(A||b)&&this.programConfigurations.upload(a))},Rh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},rr("SymbolBuffers",Rh);var JA=function(a,l,A){this.layoutVertexArray=new a,this.layoutAttributes=l,this.indexArray=new A,this.segments=new Z,this.collisionVertexArray=new jo};JA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,p9.members,!0)},JA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},rr("CollisionBuffers",JA);var Sn=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ao([]),this.placementViewportMatrix=Ao([]);var l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hy(this.zoom,l["text-size"]),this.iconSizeData=Hy(this.zoom,l["icon-size"]);var A=this.layers[0].layout,b=A.get("symbol-sort-key"),T=A.get("symbol-z-order");this.canOverlap=A.get("text-allow-overlap")||A.get("icon-allow-overlap")||A.get("text-ignore-placement")||A.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&b.constantOr(1)!==void 0,this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,A.get("symbol-placement")==="point"&&(this.writingModes=A.get("text-writing-mode").map(function(I){return wo[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};Sn.prototype.createArrays=function(){this.text=new Rh(new Mr(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new Rh(new Mr(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new R,this.lineVertexArray=new L,this.symbolInstances=new P},Sn.prototype.calculateGlyphDependencies=function(a,l,A,b,T){for(var I=0;I<a.length;I++)if(l[a.charCodeAt(I)]=!0,(A||b)&&T){var F=jA[a.charAt(I)];F&&(l[F.charCodeAt(0)]=!0)}},Sn.prototype.populate=function(a,l,A){var b=this.layers[0],T=b.layout,I=T.get("text-font"),F=T.get("text-field"),N=T.get("icon-image"),V=(F.value.kind!=="constant"||F.value.value instanceof ti&&!F.value.value.isEmpty()||F.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),X=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,Q=T.get("symbol-sort-key");if(this.features=[],V||X){for(var ie=l.iconDependencies,ue=l.glyphDependencies,_e=l.availableImages,Ne=new kr(this.zoom),ke=0,He=a;ke<He.length;ke+=1){var Ge=He[ke],Ke=Ge.feature,ot=Ge.id,At=Ge.index,gt=Ge.sourceLayerIndex,Mt=b._featureFilter.needGeometry,zt=xi(Ke,Mt);if(b._featureFilter.filter(Ne,zt,A)){Mt||(zt.geometry=di(Ke));var Wt=void 0;if(V){var gr=b.getValueAndResolveTokens("text-field",zt,A,_e),Qt=ti.factory(gr);G9(Qt)&&(this.hasRTLText=!0),(!this.hasRTLText||nf()==="unavailable"||this.hasRTLText&&Ki.isParsed())&&(Wt=m9(Qt,b,zt))}var xr=void 0;if(X){var er=b.getValueAndResolveTokens("icon-image",zt,A,_e);xr=er instanceof kn?er:kn.fromString(er)}if(Wt||xr){var Qr=this.sortFeaturesByKey?Q.evaluate(zt,{},A):void 0;if(this.features.push({id:ot,text:Wt,icon:xr,index:At,sourceLayerIndex:gt,geometry:zt.geometry,properties:Ke.properties,type:U9[Ke.type],sortKey:Qr}),xr&&(ie[xr.name]=!0),Wt){var Pr=I.evaluate(zt,{},A).join(","),cr=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wo.vertical)>=0;for(var on=0,$r=Wt.sections;on<$r.length;on+=1){var pn=$r[on];if(pn.image)ie[pn.image.name]=!0;else{var wr=ef(Wt.toString()),_n=pn.fontStack||Pr,Kn=ue[_n]=ue[_n]||{};this.calculateGlyphDependencies(pn.text,Kn,cr,this.allowVerticalPlacement,wr)}}}}}}T.get("symbol-placement")==="line"&&(this.features=function(yi){var Ai={},qn={},vi=[],ji=0;function $i(Wn){vi.push(yi[Wn]),ji++}function xs(Wn,Mi,hs){var yn=qn[Wn];return delete qn[Wn],qn[Mi]=yn,vi[yn].geometry[0].pop(),vi[yn].geometry[0]=vi[yn].geometry[0].concat(hs[0]),yn}function es(Wn,Mi,hs){var yn=Ai[Mi];return delete Ai[Mi],Ai[Wn]=yn,vi[yn].geometry[0].shift(),vi[yn].geometry[0]=hs[0].concat(vi[yn].geometry[0]),yn}function ws(Wn,Mi,hs){var yn=hs?Mi[0][Mi[0].length-1]:Mi[0][0];return Wn+":"+yn.x+":"+yn.y}for(var wi=0;wi<yi.length;wi++){var ts=yi[wi],un=ts.geometry,Rn=ts.text?ts.text.toString():null;if(Rn){var Cn=ws(Rn,un),mn=ws(Rn,un,!0);if(Cn in qn&&mn in Ai&&qn[Cn]!==Ai[mn]){var Ns=es(Cn,mn,un),fs=xs(Cn,mn,vi[Ns].geometry);delete Ai[Cn],delete qn[mn],qn[ws(Rn,vi[fs].geometry,!0)]=fs,vi[Ns].geometry=null}else Cn in qn?xs(Cn,mn,un):mn in Ai?es(Cn,mn,un):($i(wi),Ai[Cn]=ji-1,qn[mn]=ji-1)}else $i(wi)}return vi.filter(function(Wn){return Wn.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(yi,Ai){return yi.sortKey-Ai.sortKey})}},Sn.prototype.update=function(a,l,A){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,l,this.layers,A),this.icon.programConfigurations.updatePaintArrays(a,l,this.layers,A))},Sn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Sn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Sn.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Sn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Sn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Sn.prototype.addToLineVertexArray=function(a,l){var A=this.lineVertexArray.length;if(a.segment!==void 0){for(var b=a.dist(l[a.segment+1]),T=a.dist(l[a.segment]),I={},F=a.segment+1;F<l.length;F++)I[F]={x:l[F].x,y:l[F].y,tileUnitDistanceFromAnchor:b},F<l.length-1&&(b+=l[F+1].dist(l[F]));for(var N=a.segment||0;N>=0;N--)I[N]={x:l[N].x,y:l[N].y,tileUnitDistanceFromAnchor:T},N>0&&(T+=l[N-1].dist(l[N]));for(var V=0;V<l.length;V++){var X=I[V];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:A,lineLength:this.lineVertexArray.length-A}},Sn.prototype.addSymbols=function(a,l,A,b,T,I,F,N,V,X,Q,ie){for(var ue=a.indexArray,_e=a.layoutVertexArray,Ne=a.segments.prepareSegment(4*l.length,_e,ue,this.canOverlap?I.sortKey:void 0),ke=this.glyphOffsetArray.length,He=Ne.vertexLength,Ge=this.allowVerticalPlacement&&F===wo.vertical?Math.PI/2:0,Ke=I.text&&I.text.sections,ot=0;ot<l.length;ot++){var At=l[ot],gt=At.tl,Mt=At.tr,zt=At.bl,Wt=At.br,gr=At.tex,Qt=At.pixelOffsetTL,xr=At.pixelOffsetBR,er=At.minFontScaleX,Qr=At.minFontScaleY,Pr=At.glyphOffset,cr=At.isSDF,on=At.sectionIndex,$r=Ne.vertexLength,pn=Pr[1];$g(_e,N.x,N.y,gt.x,pn+gt.y,gr.x,gr.y,A,cr,Qt.x,Qt.y,er,Qr),$g(_e,N.x,N.y,Mt.x,pn+Mt.y,gr.x+gr.w,gr.y,A,cr,xr.x,Qt.y,er,Qr),$g(_e,N.x,N.y,zt.x,pn+zt.y,gr.x,gr.y+gr.h,A,cr,Qt.x,xr.y,er,Qr),$g(_e,N.x,N.y,Wt.x,pn+Wt.y,gr.x+gr.w,gr.y+gr.h,A,cr,xr.x,xr.y,er,Qr),Wy(a.dynamicLayoutVertexArray,N,Ge),ue.emplaceBack($r,$r+1,$r+2),ue.emplaceBack($r+1,$r+2,$r+3),Ne.vertexLength+=4,Ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pr[0]),ot!==l.length-1&&on===l[ot+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,I,I.index,{},ie,Ke&&Ke[on])}a.placedSymbolArray.emplaceBack(N.x,N.y,ke,this.glyphOffsetArray.length-ke,He,V,X,N.segment,A?A[0]:0,A?A[1]:0,b[0],b[1],F,0,!1,0,Q)},Sn.prototype._addCollisionDebugVertex=function(a,l,A,b,T,I){return l.emplaceBack(0,0),a.emplaceBack(A.x,A.y,b,T,Math.round(I.x),Math.round(I.y))},Sn.prototype.addCollisionDebugVertices=function(a,l,A,b,T,I,F){var N=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),V=N.vertexLength,X=T.layoutVertexArray,Q=T.collisionVertexArray,ie=F.anchorX,ue=F.anchorY;this._addCollisionDebugVertex(X,Q,I,ie,ue,new x(a,l)),this._addCollisionDebugVertex(X,Q,I,ie,ue,new x(A,l)),this._addCollisionDebugVertex(X,Q,I,ie,ue,new x(A,b)),this._addCollisionDebugVertex(X,Q,I,ie,ue,new x(a,b)),N.vertexLength+=4;var _e=T.indexArray;_e.emplaceBack(V,V+1),_e.emplaceBack(V+1,V+2),_e.emplaceBack(V+2,V+3),_e.emplaceBack(V+3,V),N.primitiveLength+=4},Sn.prototype.addDebugCollisionBoxes=function(a,l,A,b){for(var T=a;T<l;T++){var I=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,b?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,A)}},Sn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new JA(Ho,xT.members,B),this.iconCollisionBox=new JA(Ho,xT.members,B);for(var a=0;a<this.symbolInstances.length;a++){var l=this.symbolInstances.get(a);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}},Sn.prototype._deserializeCollisionBoxesForSymbol=function(a,l,A,b,T,I,F,N,V){for(var X={},Q=l;Q<A;Q++){var ie=a.get(Q);X.textBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},X.textFeatureIndex=ie.featureIndex;break}for(var ue=b;ue<T;ue++){var _e=a.get(ue);X.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},X.verticalTextFeatureIndex=_e.featureIndex;break}for(var Ne=I;Ne<F;Ne++){var ke=a.get(Ne);X.iconBox={x1:ke.x1,y1:ke.y1,x2:ke.x2,y2:ke.y2,anchorPointX:ke.anchorPointX,anchorPointY:ke.anchorPointY},X.iconFeatureIndex=ke.featureIndex;break}for(var He=N;He<V;He++){var Ge=a.get(He);X.verticalIconBox={x1:Ge.x1,y1:Ge.y1,x2:Ge.x2,y2:Ge.y2,anchorPointX:Ge.anchorPointX,anchorPointY:Ge.anchorPointY},X.verticalIconFeatureIndex=Ge.featureIndex;break}return X},Sn.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var l=0;l<this.symbolInstances.length;l++){var A=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,A.textBoxStartIndex,A.textBoxEndIndex,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A.iconBoxStartIndex,A.iconBoxEndIndex,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex))}},Sn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Sn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Sn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Sn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Sn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Sn.prototype.addIndicesForPlacedSymbol=function(a,l){for(var A=a.placedSymbolArray.get(l),b=A.vertexStartIndex+4*A.numGlyphs,T=A.vertexStartIndex;T<b;T+=4)a.indexArray.emplaceBack(T,T+1,T+2),a.indexArray.emplaceBack(T+1,T+2,T+3)},Sn.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var l=Math.sin(a),A=Math.cos(a),b=[],T=[],I=[],F=0;F<this.symbolInstances.length;++F){I.push(F);var N=this.symbolInstances.get(F);b.push(0|Math.round(l*N.anchorX+A*N.anchorY)),T.push(N.featureIndex)}return I.sort(function(V,X){return b[V]-b[X]||T[X]-T[V]}),I},Sn.prototype.addToSortKeyRanges=function(a,l){var A=this.sortKeyRanges[this.sortKeyRanges.length-1];A&&A.sortKey===l?A.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Sn.prototype.sortFeatures=function(a){var l=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var A=0,b=this.symbolInstanceIndexes;A<b.length;A+=1){var T=this.symbolInstances.get(b[A]);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach(function(I,F,N){I>=0&&N.indexOf(I)===F&&l.addIndicesForPlacedSymbol(l.text,I)}),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},rr("SymbolBucket",Sn,{omit:["layers","collisionBoxArray","features","compareText"]}),Sn.MAX_GLYPHS=65535,Sn.addDynamicAttributes=Wy;var V9=new Gn({"symbol-placement":new _r(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new _r(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _r(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new or(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _r(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _r(ae.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _r(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new _r(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _r(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new or(ae.layout_symbol["icon-size"]),"icon-text-fit":new _r(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _r(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new or(ae.layout_symbol["icon-image"]),"icon-rotate":new or(ae.layout_symbol["icon-rotate"]),"icon-padding":new _r(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new _r(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new or(ae.layout_symbol["icon-offset"]),"icon-anchor":new or(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _r(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _r(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _r(ae.layout_symbol["text-rotation-alignment"]),"text-field":new or(ae.layout_symbol["text-field"]),"text-font":new or(ae.layout_symbol["text-font"]),"text-size":new or(ae.layout_symbol["text-size"]),"text-max-width":new or(ae.layout_symbol["text-max-width"]),"text-line-height":new _r(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new or(ae.layout_symbol["text-letter-spacing"]),"text-justify":new or(ae.layout_symbol["text-justify"]),"text-radial-offset":new or(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _r(ae.layout_symbol["text-variable-anchor"]),"text-anchor":new or(ae.layout_symbol["text-anchor"]),"text-max-angle":new _r(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new _r(ae.layout_symbol["text-writing-mode"]),"text-rotate":new or(ae.layout_symbol["text-rotate"]),"text-padding":new _r(ae.layout_symbol["text-padding"]),"text-keep-upright":new _r(ae.layout_symbol["text-keep-upright"]),"text-transform":new or(ae.layout_symbol["text-transform"]),"text-offset":new or(ae.layout_symbol["text-offset"]),"text-allow-overlap":new _r(ae.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _r(ae.layout_symbol["text-ignore-placement"]),"text-optional":new _r(ae.layout_symbol["text-optional"])}),Jy={paint:new Gn({"icon-opacity":new or(ae.paint_symbol["icon-opacity"]),"icon-color":new or(ae.paint_symbol["icon-color"]),"icon-halo-color":new or(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new or(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new or(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new _r(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new _r(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new or(ae.paint_symbol["text-opacity"]),"text-color":new or(ae.paint_symbol["text-color"],{runtimeType:Ut,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new or(ae.paint_symbol["text-halo-color"]),"text-halo-width":new or(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new or(ae.paint_symbol["text-halo-blur"]),"text-translate":new _r(ae.paint_symbol["text-translate"]),"text-translate-anchor":new _r(ae.paint_symbol["text-translate-anchor"])}),layout:V9},Fh=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Rt,this.defaultValue=a};Fh.prototype.evaluate=function(a){if(a.formattedSection){var l=this.defaultValue.property.overrides;if(l&&l.hasOverride(a.formattedSection))return l.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Fh.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Fh.prototype.outputDefined=function(){return!1},Fh.prototype.serialize=function(){return null},rr("FormatSectionOverride",Fh,{omit:["defaultValue"]});var H9=function(a){function l(A){a.call(this,A,Jy)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.recalculate=function(A,b){if(a.prototype.recalculate.call(this,A,b),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var T=this.layout.get("text-writing-mode");if(T){for(var I=[],F=0,N=T;F<N.length;F+=1){var V=N[F];I.indexOf(V)<0&&I.push(V)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},l.prototype.getValueAndResolveTokens=function(A,b,T,I){var F=this.layout.get(A).evaluate(b,{},T,I),N=this._unevaluatedLayout._values[A];return N.isDataDriven()||lo(N.value)||!F?F:function(V,X){return X.replace(/{([^{}]+)}/g,function(Q,ie){return ie in V?String(V[ie]):""})}(b.properties,F)},l.prototype.createBucket=function(A){return new Sn(A)},l.prototype.queryRadius=function(){return 0},l.prototype.queryIntersectsFeature=function(){return!1},l.prototype._setPaintOverrides=function(){for(var A=0,b=Jy.paint.overridableProperties;A<b.length;A+=1){var T=b[A];if(l.hasPaintOverride(this.layout,T)){var I,F=this.paint.get(T),N=new Fh(F),V=new da(N,F.property.specification);I=F.value.kind==="constant"||F.value.kind==="source"?new Da("source",V):new pc("composite",V,F.value.zoomStops,F.value._interpolationType),this.paint._values[T]=new qi(F.property,I,F.parameters)}}},l.prototype._handleOverridablePaintPropertyUpdate=function(A,b,T){return!(!this.layout||b.isDataDriven()||T.isDataDriven())&&l.hasPaintOverride(this.layout,A)},l.hasPaintOverride=function(A,b){var T=A.get("text-field"),I=Jy.paint.properties[b],F=!1,N=function(Q){for(var ie=0,ue=Q;ie<ue.length;ie+=1)if(I.overrides&&I.overrides.hasOverride(ue[ie]))return void(F=!0)};if(T.value.kind==="constant"&&T.value.value instanceof ti)N(T.value.value.sections);else if(T.value.kind==="source"){var V=function(Q){F||(Q instanceof Bi&&Un(Q.value)===tn?N(Q.value.sections):Q instanceof as?N(Q.sections):Q.eachChild(V))},X=T.value;X._styleExpression&&V(X._styleExpression.expression)}return F},l}(Or),j9={paint:new Gn({"background-color":new _r(ae.paint_background["background-color"]),"background-pattern":new rs(ae.paint_background["background-pattern"]),"background-opacity":new _r(ae.paint_background["background-opacity"])})},$9=function(a){function l(A){a.call(this,A,j9)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l}(Or),W9={paint:new Gn({"raster-opacity":new _r(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new _r(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _r(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _r(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new _r(ae.paint_raster["raster-saturation"]),"raster-contrast":new _r(ae.paint_raster["raster-contrast"]),"raster-resampling":new _r(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new _r(ae.paint_raster["raster-fade-duration"])})},J9=function(a){function l(A){a.call(this,A,W9)}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l}(Or),X9=function(a){function l(A){a.call(this,A,{}),this.implementation=A}return a&&(l.__proto__=a),(l.prototype=Object.create(a&&a.prototype)).constructor=l,l.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},l.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},l.prototype.recalculate=function(){},l.prototype.updateTransitions=function(){},l.prototype.hasTransition=function(){},l.prototype.serialize=function(){},l.prototype.onAdd=function(A){this.implementation.onAdd&&this.implementation.onAdd(A,A.painter.context.gl)},l.prototype.onRemove=function(A){this.implementation.onRemove&&this.implementation.onRemove(A,A.painter.context.gl)},l}(Or),K9={circle:Py,heatmap:Rk,hillshade:Dk,fill:Yk,"fill-extrusion":o9,line:h9,symbol:H9,background:$9,raster:J9},$T=S.HTMLImageElement,WT=S.HTMLCanvasElement,JT=S.HTMLVideoElement,XT=S.ImageData,Wg=S.ImageBitmap,ff=function(a,l,A,b){this.context=a,this.format=A,this.texture=a.gl.createTexture(),this.update(l,b)};ff.prototype.update=function(a,l,A){var b=a.width,T=a.height,I=!(this.size&&this.size[0]===b&&this.size[1]===T||A),F=this.context,N=F.gl;if(this.useMipmap=!!(l&&l.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),F.pixelStoreUnpackFlipY.set(!1),F.pixelStoreUnpack.set(1),F.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!l||l.premultiply!==!1)),I)this.size=[b,T],a instanceof $T||a instanceof WT||a instanceof JT||a instanceof XT||Wg&&a instanceof Wg?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,a):N.texImage2D(N.TEXTURE_2D,0,this.format,b,T,0,this.format,N.UNSIGNED_BYTE,a.data);else{var V=A||{x:0,y:0},X=V.x,Q=V.y;a instanceof $T||a instanceof WT||a instanceof JT||a instanceof XT||Wg&&a instanceof Wg?N.texSubImage2D(N.TEXTURE_2D,0,X,Q,N.RGBA,N.UNSIGNED_BYTE,a):N.texSubImage2D(N.TEXTURE_2D,0,X,Q,b,T,N.RGBA,N.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)},ff.prototype.bind=function(a,l,A){var b=this.context.gl;b.bindTexture(b.TEXTURE_2D,this.texture),A!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(A=b.LINEAR),a!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,A||a),this.filter=a),l!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,l),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,l),this.wrap=l)},ff.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ff.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Xy=function(a){var l=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){l._triggered=!1,l._callback()})};Xy.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Xy.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Dh=function(a,l,A){this.target=a,this.parent=l,this.mapId=A,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ee(["receive","process"],this),this.invoker=new Xy(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=me()?a:S};function KT(a,l,A){var b=2*Math.PI*6378137/256/Math.pow(2,A);return[a*b-2*Math.PI*6378137/2,l*b-2*Math.PI*6378137/2]}Dh.prototype.send=function(a,l,A,b,T){var I=this;T===void 0&&(T=!1);var F=Math.round(1e18*Math.random()).toString(36).substring(0,10);A&&(this.callbacks[F]=A);var N=Ye(this.globalScope)?void 0:[];return this.target.postMessage({id:F,type:a,hasCallback:!!A,targetMapId:b,mustQueue:T,sourceMapId:this.mapId,data:$s(l,N)},N),{cancel:function(){A&&delete I.callbacks[F],I.target.postMessage({id:F,type:"<cancel>",targetMapId:b,sourceMapId:I.mapId})}}},Dh.prototype.receive=function(a){var l=a.data,A=l.id;if(A&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){delete this.tasks[A];var b=this.cancelCallbacks[A];delete this.cancelCallbacks[A],b&&b()}else me()||l.mustQueue?(this.tasks[A]=l,this.taskQueue.push(A),this.invoker.trigger()):this.processTask(A,l)},Dh.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),l=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),l&&this.processTask(a,l)}},Dh.prototype.processTask=function(a,l){var A=this;if(l.type==="<response>"){var b=this.callbacks[a];delete this.callbacks[a],b&&(l.error?b(cs(l.error)):b(null,cs(l.data)))}else{var T=!1,I=Ye(this.globalScope)?void 0:[],F=l.hasCallback?function(Q,ie){T=!0,delete A.cancelCallbacks[a],A.target.postMessage({id:a,type:"<response>",sourceMapId:A.mapId,error:Q?$s(Q):null,data:$s(ie,I)},I)}:function(Q){T=!0},N=null,V=cs(l.data);if(this.parent[l.type])N=this.parent[l.type](l.sourceMapId,V,F);else if(this.parent.getWorkerSource){var X=l.type.split(".");N=this.parent.getWorkerSource(l.sourceMapId,X[0],V.source)[X[1]](V,F)}else F(new Error("Could not find function "+l.type));!T&&N&&N.cancel&&(this.cancelCallbacks[a]=N.cancel)}},Dh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Di=function(a,l){a&&(l?this.setSouthWest(a).setNorthEast(l):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};Di.prototype.setNorthEast=function(a){return this._ne=a instanceof Xn?new Xn(a.lng,a.lat):Xn.convert(a),this},Di.prototype.setSouthWest=function(a){return this._sw=a instanceof Xn?new Xn(a.lng,a.lat):Xn.convert(a),this},Di.prototype.extend=function(a){var l,A,b=this._sw,T=this._ne;if(a instanceof Xn)l=a,A=a;else{if(!(a instanceof Di))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Di.convert(a)):this.extend(Xn.convert(a)):this;if(A=a._ne,!(l=a._sw)||!A)return this}return b||T?(b.lng=Math.min(l.lng,b.lng),b.lat=Math.min(l.lat,b.lat),T.lng=Math.max(A.lng,T.lng),T.lat=Math.max(A.lat,T.lat)):(this._sw=new Xn(l.lng,l.lat),this._ne=new Xn(A.lng,A.lat)),this},Di.prototype.getCenter=function(){return new Xn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Di.prototype.getSouthWest=function(){return this._sw},Di.prototype.getNorthEast=function(){return this._ne},Di.prototype.getNorthWest=function(){return new Xn(this.getWest(),this.getNorth())},Di.prototype.getSouthEast=function(){return new Xn(this.getEast(),this.getSouth())},Di.prototype.getWest=function(){return this._sw.lng},Di.prototype.getSouth=function(){return this._sw.lat},Di.prototype.getEast=function(){return this._ne.lng},Di.prototype.getNorth=function(){return this._ne.lat},Di.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Di.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Di.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Di.prototype.contains=function(a){var l=Xn.convert(a),A=l.lng,b=l.lat,T=this._sw.lng<=A&&A<=this._ne.lng;return this._sw.lng>this._ne.lng&&(T=this._sw.lng>=A&&A>=this._ne.lng),this._sw.lat<=b&&b<=this._ne.lat&&T},Di.convert=function(a){return!a||a instanceof Di?a:new Di(a)};var Xn=function(a,l){if(isNaN(a)||isNaN(l))throw new Error("Invalid LngLat object: ("+a+", "+l+")");if(this.lng=+a,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Xn.prototype.wrap=function(){return new Xn(G(this.lng,-180,180),this.lat)},Xn.prototype.toArray=function(){return[this.lng,this.lat]},Xn.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Xn.prototype.distanceTo=function(a){var l=Math.PI/180,A=this.lat*l,b=a.lat*l,T=Math.sin(A)*Math.sin(b)+Math.cos(A)*Math.cos(b)*Math.cos((a.lng-this.lng)*l);return 63710088e-1*Math.acos(Math.min(T,1))},Xn.prototype.toBounds=function(a){a===void 0&&(a=0);var l=360*a/40075017,A=l/Math.cos(Math.PI/180*this.lat);return new Di(new Xn(this.lng-A,this.lat-l),new Xn(this.lng+A,this.lat+l))},Xn.convert=function(a){if(a instanceof Xn)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Xn(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Xn(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var qT=2*Math.PI*63710088e-1;function YT(a){return qT*Math.cos(a*Math.PI/180)}function ZT(a){return(180+a)/360}function QT(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function eE(a,l){return a/YT(l)}function Ky(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var hf=function(a,l,A){A===void 0&&(A=0),this.x=+a,this.y=+l,this.z=+A};hf.fromLngLat=function(a,l){l===void 0&&(l=0);var A=Xn.convert(a);return new hf(ZT(A.lng),QT(A.lat),eE(l,A.lat))},hf.prototype.toLngLat=function(){return new Xn(360*this.x-180,Ky(this.y))},hf.prototype.toAltitude=function(){return this.z*YT(Ky(this.y))},hf.prototype.meterInMercatorCoordinateUnits=function(){return 1/qT*(a=Ky(this.y),1/Math.cos(a*Math.PI/180));var a};var df=function(a,l,A){this.z=a,this.x=l,this.y=A,this.key=XA(0,a,a,l,A)};df.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},df.prototype.url=function(a,l){var A,b,T,I,F,N=(b=this.y,T=this.z,I=KT(256*(A=this.x),256*(b=Math.pow(2,T)-b-1),T),F=KT(256*(A+1),256*(b+1),T),I[0]+","+I[1]+","+F[0]+","+F[1]),V=function(X,Q,ie){for(var ue,_e="",Ne=X;Ne>0;Ne--)_e+=(Q&(ue=1<<Ne-1)?1:0)+(ie&ue?2:0);return _e}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",V).replace("{bbox-epsg-3857}",N)},df.prototype.getTilePoint=function(a){var l=Math.pow(2,this.z);return new x(8192*(a.x*l-this.x),8192*(a.y*l-this.y))},df.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var tE=function(a,l){this.wrap=a,this.canonical=l,this.key=XA(a,l.z,l.z,l.x,l.y)},Oi=function(a,l,A,b,T){this.overscaledZ=a,this.wrap=l,this.canonical=new df(A,+b,+T),this.key=XA(l,a,A,b,T)};function XA(a,l,A,b,T){(a*=2)<0&&(a=-1*a-1);var I=1<<A;return(I*I*a+I*T+b).toString(36)+A.toString(36)+l.toString(36)}Oi.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Oi.prototype.scaledTo=function(a){var l=this.canonical.z-a;return a>this.canonical.z?new Oi(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Oi(a,this.wrap,a,this.canonical.x>>l,this.canonical.y>>l)},Oi.prototype.calculateScaledKey=function(a,l){var A=this.canonical.z-a;return a>this.canonical.z?XA(this.wrap*+l,a,this.canonical.z,this.canonical.x,this.canonical.y):XA(this.wrap*+l,a,a,this.canonical.x>>A,this.canonical.y>>A)},Oi.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var l=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>l&&a.canonical.y===this.canonical.y>>l},Oi.prototype.children=function(a){if(this.overscaledZ>=a)return[new Oi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var l=this.canonical.z+1,A=2*this.canonical.x,b=2*this.canonical.y;return[new Oi(l,this.wrap,l,A,b),new Oi(l,this.wrap,l,A+1,b),new Oi(l,this.wrap,l,A,b+1),new Oi(l,this.wrap,l,A+1,b+1)]},Oi.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Oi.prototype.wrapped=function(){return new Oi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Oi.prototype.unwrapTo=function(a){return new Oi(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Oi.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Oi.prototype.toUnwrapped=function(){return new tE(this.wrap,this.canonical)},Oi.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Oi.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new hf(a.x-this.wrap,a.y))},rr("CanonicalTileID",df),rr("OverscaledTileID",Oi,{omit:["posMatrix"]});var ml=function(a,l,A){if(this.uid=a,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(A&&A!=="mapbox"&&A!=="terrarium")return re('"'+A+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=l.height;var b=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=A||"mapbox";for(var T=0;T<b;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(b,T)]=this.data[this._idx(b-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,b)]=this.data[this._idx(T,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)]};ml.prototype.get=function(a,l){var A=new Uint8Array(this.data.buffer),b=4*this._idx(a,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(A[b],A[b+1],A[b+2])},ml.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},ml.prototype._idx=function(a,l){if(a<-1||a>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(a+1)},ml.prototype._unpackMapbox=function(a,l,A){return(256*a*256+256*l+A)/10-1e4},ml.prototype._unpackTerrarium=function(a,l,A){return 256*a+l+A/256-32768},ml.prototype.getPixels=function(){return new Ys({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},ml.prototype.backfillBorder=function(a,l,A){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var b=l*this.dim,T=l*this.dim+this.dim,I=A*this.dim,F=A*this.dim+this.dim;switch(l){case-1:b=T-1;break;case 1:T=b+1}switch(A){case-1:I=F-1;break;case 1:F=I+1}for(var N=-l*this.dim,V=-A*this.dim,X=I;X<F;X++)for(var Q=b;Q<T;Q++)this.data[this._idx(Q,X)]=a.data[this._idx(Q+N,X+V)]},rr("DEMData",ml);var Jg=function(a){this._stringToNumber={},this._numberToString=[];for(var l=0;l<a.length;l++){var A=a[l];this._stringToNumber[A]=l,this._numberToString[l]=A}};Jg.prototype.encode=function(a){return this._stringToNumber[a]},Jg.prototype.decode=function(a){return this._numberToString[a]};var Xg=function(a,l,A,b,T){this.type="Feature",this._vectorTileFeature=a,a._z=l,a._x=A,a._y=b,this.properties=a.properties,this.id=T},qy={geometry:{configurable:!0}};qy.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},qy.geometry.set=function(a){this._geometry=a},Xg.prototype.toJSON=function(){var a={geometry:this.geometry};for(var l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(a[l]=this[l]);return a},Object.defineProperties(Xg.prototype,qy);var Oh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Oh.prototype.updateState=function(a,l,A){var b=String(l);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][b]=this.stateChanges[a][b]||{},H(this.stateChanges[a][b],A),this.deletedStates[a]===null)for(var T in this.deletedStates[a]={},this.state[a])T!==b&&(this.deletedStates[a][T]=null);else if(this.deletedStates[a]&&this.deletedStates[a][b]===null)for(var I in this.deletedStates[a][b]={},this.state[a][b])A[I]||(this.deletedStates[a][b][I]=null);else for(var F in A)this.deletedStates[a]&&this.deletedStates[a][b]&&this.deletedStates[a][b][F]===null&&delete this.deletedStates[a][b][F]},Oh.prototype.removeFeatureState=function(a,l,A){if(this.deletedStates[a]!==null){var b=String(l);if(this.deletedStates[a]=this.deletedStates[a]||{},A&&l!==void 0)this.deletedStates[a][b]!==null&&(this.deletedStates[a][b]=this.deletedStates[a][b]||{},this.deletedStates[a][b][A]=null);else if(l!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][b])for(A in this.deletedStates[a][b]={},this.stateChanges[a][b])this.deletedStates[a][b][A]=null;else this.deletedStates[a][b]=null;else this.deletedStates[a]=null}},Oh.prototype.getState=function(a,l){var A=String(l),b=H({},(this.state[a]||{})[A],(this.stateChanges[a]||{})[A]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var T=this.deletedStates[a][l];if(T===null)return{};for(var I in T)delete b[I]}return b},Oh.prototype.initializeTileState=function(a,l){a.setFeatureState(this.state,l)},Oh.prototype.coalesceChanges=function(a,l){var A={};for(var b in this.stateChanges){this.state[b]=this.state[b]||{};var T={};for(var I in this.stateChanges[b])this.state[b][I]||(this.state[b][I]={}),H(this.state[b][I],this.stateChanges[b][I]),T[I]=this.state[b][I];A[b]=T}for(var F in this.deletedStates){this.state[F]=this.state[F]||{};var N={};if(this.deletedStates[F]===null)for(var V in this.state[F])N[V]={},this.state[F][V]={};else for(var X in this.deletedStates[F]){if(this.deletedStates[F][X]===null)this.state[F][X]={};else for(var Q=0,ie=Object.keys(this.deletedStates[F][X]);Q<ie.length;Q+=1)delete this.state[F][X][ie[Q]];N[X]=this.state[F][X]}A[F]=A[F]||{},H(A[F],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(A).length!==0)for(var ue in a)a[ue].setFeatureState(A,l)};var _l=function(a,l){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new yo(8192,16,0),this.grid3D=new yo(8192,16,0),this.featureIndexArray=new W,this.promoteId=l};function rE(a,l,A,b,T){return de(a,function(I,F){var N=l instanceof hl?l.get(F):null;return N&&N.evaluate?N.evaluate(A,b,T):N})}function nE(a){for(var l=1/0,A=1/0,b=-1/0,T=-1/0,I=0,F=a;I<F.length;I+=1){var N=F[I];l=Math.min(l,N.x),A=Math.min(A,N.y),b=Math.max(b,N.x),T=Math.max(T,N.y)}return{minX:l,minY:A,maxX:b,maxY:T}}function q9(a,l){return l-a}_l.prototype.insert=function(a,l,A,b,T,I){var F=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(A,b,T);for(var N=I?this.grid3D:this.grid,V=0;V<l.length;V++){for(var X=l[V],Q=[1/0,1/0,-1/0,-1/0],ie=0;ie<X.length;ie++){var ue=X[ie];Q[0]=Math.min(Q[0],ue.x),Q[1]=Math.min(Q[1],ue.y),Q[2]=Math.max(Q[2],ue.x),Q[3]=Math.max(Q[3],ue.y)}Q[0]<8192&&Q[1]<8192&&Q[2]>=0&&Q[3]>=0&&N.insert(F,Q[0],Q[1],Q[2],Q[3])}},_l.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Th.VectorTile(new Lg(this.rawTileData)).layers,this.sourceLayerCoder=new Jg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},_l.prototype.query=function(a,l,A,b){var T=this;this.loadVTLayers();for(var I=a.params||{},F=8192/a.tileSize/a.scale,N=Kl(I.filter),V=a.queryGeometry,X=a.queryPadding*F,Q=nE(V),ie=this.grid.query(Q.minX-X,Q.minY-X,Q.maxX+X,Q.maxY+X),ue=nE(a.cameraQueryGeometry),_e=this.grid3D.query(ue.minX-X,ue.minY-X,ue.maxX+X,ue.maxY+X,function(At,gt,Mt,zt){return function(Wt,gr,Qt,xr,er){for(var Qr=0,Pr=Wt;Qr<Pr.length;Qr+=1){var cr=Pr[Qr];if(gr<=cr.x&&Qt<=cr.y&&xr>=cr.x&&er>=cr.y)return!0}var on=[new x(gr,Qt),new x(gr,er),new x(xr,er),new x(xr,Qt)];if(Wt.length>2){for(var $r=0,pn=on;$r<pn.length;$r+=1)if(pa(Wt,pn[$r]))return!0}for(var wr=0;wr<Wt.length-1;wr++)if(cf(Wt[wr],Wt[wr+1],on))return!0;return!1}(a.cameraQueryGeometry,At-X,gt-X,Mt+X,zt+X)}),Ne=0,ke=_e;Ne<ke.length;Ne+=1)ie.push(ke[Ne]);ie.sort(q9);for(var He,Ge={},Ke=function(At){var gt=ie[At];if(gt!==He){He=gt;var Mt=T.featureIndexArray.get(gt),zt=null;T.loadMatchingFeature(Ge,Mt.bucketIndex,Mt.sourceLayerIndex,Mt.featureIndex,N,I.layers,I.availableImages,l,A,b,function(Wt,gr,Qt){return zt||(zt=di(Wt)),gr.queryIntersectsFeature(V,Wt,Qt,zt,T.z,a.transform,F,a.pixelPosMatrix)})}},ot=0;ot<ie.length;ot++)Ke(ot);return Ge},_l.prototype.loadMatchingFeature=function(a,l,A,b,T,I,F,N,V,X,Q){var ie=this.bucketLayerIDs[l];if(!I||function(Wt,gr){for(var Qt=0;Qt<Wt.length;Qt++)if(gr.indexOf(Wt[Qt])>=0)return!0;return!1}(I,ie)){var ue=this.sourceLayerCoder.decode(A),_e=this.vtLayers[ue].feature(b);if(T.needGeometry){var Ne=xi(_e,!0);if(!T.filter(new kr(this.tileID.overscaledZ),Ne,this.tileID.canonical))return}else if(!T.filter(new kr(this.tileID.overscaledZ),_e))return;for(var ke=this.getId(_e,ue),He=0;He<ie.length;He++){var Ge=ie[He];if(!(I&&I.indexOf(Ge)<0)){var Ke=N[Ge];if(Ke){var ot={};ke!==void 0&&X&&(ot=X.getState(Ke.sourceLayer||"_geojsonTileLayer",ke));var At=H({},V[Ge]);At.paint=rE(At.paint,Ke.paint,_e,ot,F),At.layout=rE(At.layout,Ke.layout,_e,ot,F);var gt=!Q||Q(_e,Ke,ot);if(gt){var Mt=new Xg(_e,this.z,this.x,this.y,ke);Mt.layer=At;var zt=a[Ge];zt===void 0&&(zt=a[Ge]=[]),zt.push({featureIndex:b,feature:Mt,intersectionZ:gt})}}}}}},_l.prototype.lookupSymbolFeatures=function(a,l,A,b,T,I,F,N){var V={};this.loadVTLayers();for(var X=Kl(T),Q=0,ie=a;Q<ie.length;Q+=1)this.loadMatchingFeature(V,A,b,ie[Q],X,I,F,N,l);return V},_l.prototype.hasLayer=function(a){for(var l=0,A=this.bucketLayerIDs;l<A.length;l+=1)for(var b=0,T=A[l];b<T.length;b+=1)if(a===T[b])return!0;return!1},_l.prototype.getId=function(a,l){var A=a.id;return this.promoteId&&typeof(A=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]])=="boolean"&&(A=Number(A)),A},rr("FeatureIndex",_l,{omit:["rawTileData","sourceLayerCoder"]});var Qi=function(a,l){this.tileID=a,this.uid=he(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Qi.prototype.registerFadeDuration=function(a){var l=a+this.timeAdded;l<$t.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)},Qi.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Qi.prototype.loadVectorData=function(a,l,A){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var b in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(X,Q){var ie={};if(!Q)return ie;for(var ue=function(){var ke=Ne[_e],He=ke.layerIds.map(function(ot){return Q.getLayer(ot)}).filter(Boolean);if(He.length!==0){ke.layers=He,ke.stateDependentLayerIds&&(ke.stateDependentLayers=ke.stateDependentLayerIds.map(function(ot){return He.filter(function(At){return At.id===ot})[0]}));for(var Ge=0,Ke=He;Ge<Ke.length;Ge+=1)ie[Ke[Ge].id]=ke}},_e=0,Ne=X;_e<Ne.length;_e+=1)ue();return ie}(a.buckets,l.style),this.hasSymbolBuckets=!1,this.buckets){var T=this.buckets[b];if(T instanceof Sn){if(this.hasSymbolBuckets=!0,!A)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var F=this.buckets[I];if(F instanceof Sn&&F.hasRTLText){this.hasRTLText=!0,Ki.isLoading()||Ki.isLoaded()||nf()!=="deferred"||uo();break}}for(var N in this.queryPadding=0,this.buckets){var V=this.buckets[N];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(N).queryRadius(V))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new h},Qi.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Qi.prototype.getBucket=function(a){return this.buckets[a.id]},Qi.prototype.upload=function(a){for(var l in this.buckets){var A=this.buckets[l];A.uploadPending()&&A.upload(a)}var b=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ff(a,this.imageAtlas.image,b.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ff(a,this.glyphAtlasImage,b.ALPHA),this.glyphAtlasImage=null)},Qi.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Qi.prototype.queryRenderedFeatures=function(a,l,A,b,T,I,F,N,V,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:T,scale:I,tileSize:this.tileSize,pixelPosMatrix:X,transform:N,params:F,queryPadding:this.queryPadding*V},a,l,A):{}},Qi.prototype.querySourceFeatures=function(a,l){var A=this.latestFeatureIndex;if(A&&A.rawTileData){var b=A.loadVTLayers(),T=l?l.sourceLayer:"",I=b._geojsonTileLayer||b[T];if(I)for(var F=Kl(l&&l.filter),N=this.tileID.canonical,V=N.z,X=N.x,Q=N.y,ie={z:V,x:X,y:Q},ue=0;ue<I.length;ue++){var _e=I.feature(ue);if(F.needGeometry){var Ne=xi(_e,!0);if(!F.filter(new kr(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!F.filter(new kr(this.tileID.overscaledZ),_e))continue;var ke=A.getId(_e,T),He=new Xg(_e,V,X,Q,ke);He.tile=ie,a.push(He)}}},Qi.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Qi.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Qi.prototype.setExpiryData=function(a){var l=this.expirationTime;if(a.cacheControl){var A=Le(a.cacheControl);A["max-age"]&&(this.expirationTime=Date.now()+1e3*A["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var b=Date.now(),T=!1;if(this.expirationTime>b)T=!1;else if(l)if(this.expirationTime<l)T=!0;else{var I=this.expirationTime-l;I?this.expirationTime=b+Math.max(I,3e4):T=!0}else T=!0;T?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Qi.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Qi.prototype.setFeatureState=function(a,l){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var A=this.latestFeatureIndex.loadVTLayers();for(var b in this.buckets)if(l.style.hasLayer(b)){var T=this.buckets[b],I=T.layers[0].sourceLayer||"_geojsonTileLayer",F=A[I],N=a[I];if(F&&N&&Object.keys(N).length!==0){T.update(N,F,this.imageAtlas&&this.imageAtlas.patternPositions||{});var V=l&&l.style&&l.style.getLayer(b);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(T)))}}}},Qi.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Qi.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$t.now()},Qi.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Qi.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=$t.now()+a},Qi.prototype.setDependencies=function(a,l){for(var A={},b=0,T=l;b<T.length;b+=1)A[T[b]]=!0;this.dependencies[a]=A},Qi.prototype.hasDependency=function(a,l){for(var A=0,b=a;A<b.length;A+=1){var T=this.dependencies[b[A]];if(T){for(var I=0,F=l;I<F.length;I+=1)if(T[F[I]])return!0}}return!1};var lu=S.performance,iE=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},lu.mark(this._marks.start)};iE.prototype.finish=function(){lu.mark(this._marks.end);var a=lu.getEntriesByName(this._marks.measure);return a.length===0&&(lu.measure(this._marks.measure,this._marks.start,this._marks.end),a=lu.getEntriesByName(this._marks.measure),lu.clearMarks(this._marks.start),lu.clearMarks(this._marks.end),lu.clearMeasures(this._marks.measure)),a},s.Actor=Dh,s.AlphaImage=uf,s.CanonicalTileID=df,s.CollisionBoxArray=h,s.Color=qr,s.DEMData=ml,s.DataConstantProperty=_r,s.DictionaryCoder=Jg,s.EXTENT=8192,s.ErrorEvent=fe,s.EvaluationParameters=kr,s.Event=De,s.Evented=be,s.FeatureIndex=_l,s.FillBucket=Va,s.FillExtrusionBucket=Ha,s.ImageAtlas=WA,s.ImagePosition=kg,s.LineBucket=Ls,s.LngLat=Xn,s.LngLatBounds=Di,s.MercatorCoordinate=hf,s.ONE_EM=24,s.OverscaledTileID=Oi,s.Point=x,s.Point$1=x,s.Properties=Gn,s.Protobuf=Lg,s.RGBAImage=Ys,s.RequestManager=dr,s.RequestPerformance=iE,s.ResourceType=Nt,s.SegmentVector=Z,s.SourceFeatureState=Oh,s.StructArrayLayout1ui2=M,s.StructArrayLayout2f1f2i16=bo,s.StructArrayLayout2i4=Fs,s.StructArrayLayout3ui6=$o,s.StructArrayLayout4i8=sf,s.SymbolBucket=Sn,s.Texture=ff,s.Tile=Qi,s.Transitionable=zi,s.Uniform1f=Pt,s.Uniform1i=ft,s.Uniform2f=bt,s.Uniform3f=Lt,s.Uniform4f=tr,s.UniformColor=br,s.UniformMatrix4f=gn,s.UnwrappedTileID=tE,s.ValidationError=Be,s.WritingMode=wo,s.ZoomHistory=Qu,s.add=function(a,l,A){return a[0]=l[0]+A[0],a[1]=l[1]+A[1],a[2]=l[2]+A[2],a},s.addDynamicAttributes=Wy,s.asyncAll=function(a,l,A){if(!a.length)return A(null,[]);var b=a.length,T=new Array(a.length),I=null;a.forEach(function(F,N){l(F,function(V,X){V&&(I=V),T[N]=X,--b==0&&A(I,T)})})},s.bezier=k,s.bindAll=Ee,s.browser=$t,s.cacheEntryPossiblyAdded=function(a){++It>Dt&&(a.getActor().send("enforceCacheSizeLimit",Me),It=0)},s.clamp=J,s.clearTileCache=function(a){var l=S.caches.delete("mapbox-tiles");a&&l.catch(a).then(function(){return a()})},s.clipLine=UT,s.clone=function(a){var l=new vn(16);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=a[7],l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15],l},s.clone$1=Ae,s.clone$2=function(a){var l=new vn(3);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l},s.collisionCircleLayout=g9,s.config=Ot,s.create=function(){var a=new vn(16);return vn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new vn(9);return vn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new vn(4);return vn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=u,s.createExpression=Jl,s.createLayout=Ii,s.createStyleLayer=function(a){return a.type==="custom"?new X9(a):new K9[a.type](a)},s.cross=function(a,l,A){var b=l[0],T=l[1],I=l[2],F=A[0],N=A[1],V=A[2];return a[0]=T*V-I*N,a[1]=I*F-b*V,a[2]=b*N-T*F,a},s.deepEqual=function a(l,A){if(Array.isArray(l)){if(!Array.isArray(A)||l.length!==A.length)return!1;for(var b=0;b<l.length;b++)if(!a(l[b],A[b]))return!1;return!0}if(typeof l=="object"&&l!==null&&A!==null){if(typeof A!="object"||Object.keys(l).length!==Object.keys(A).length)return!1;for(var T in l)if(!a(l[T],A[T]))return!1;return!0}return l===A},s.dot=function(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]},s.dot$1=function(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3]},s.ease=U,s.emitValidationErrors=fl,s.endsWith=ze,s.enforceCacheSizeLimit=function(a){Gt(),bn&&bn.then(function(l){l.keys().then(function(A){for(var b=0;b<A.length-a;b++)l.delete(A[b])})})},s.evaluateSizeForFeature=FT,s.evaluateSizeForZoom=DT,s.evaluateVariableOffset=VT,s.evented=mi,s.extend=H,s.featureFilter=Kl,s.filterObject=ve,s.fromRotation=function(a,l){var A=Math.sin(l),b=Math.cos(l);return a[0]=b,a[1]=A,a[2]=0,a[3]=-A,a[4]=b,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=Vy,s.getAnchorJustification=$y,s.getArrayBuffer=We,s.getImage=ne,s.getJSON=function(a,l){return Ce(H(a,{type:"json"}),l)},s.getRTLTextPluginStatus=nf,s.getReferrer=j,s.getVideo=function(a,l){var A,b,T=S.document.createElement("video");T.muted=!0,T.onloadstart=function(){l(null,T)};for(var I=0;I<a.length;I++){var F=S.document.createElement("source");A=a[I],b=void 0,(b=S.document.createElement("a")).href=A,(b.protocol!==S.document.location.protocol||b.host!==S.document.location.host)&&(T.crossOrigin="Anonymous"),F.src=a[I],T.appendChild(F)}return{cancel:function(){}}},s.identity=Ao,s.invert=function(a,l){var A=l[0],b=l[1],T=l[2],I=l[3],F=l[4],N=l[5],V=l[6],X=l[7],Q=l[8],ie=l[9],ue=l[10],_e=l[11],Ne=l[12],ke=l[13],He=l[14],Ge=l[15],Ke=A*N-b*F,ot=A*V-T*F,At=A*X-I*F,gt=b*V-T*N,Mt=b*X-I*N,zt=T*X-I*V,Wt=Q*ke-ie*Ne,gr=Q*He-ue*Ne,Qt=Q*Ge-_e*Ne,xr=ie*He-ue*ke,er=ie*Ge-_e*ke,Qr=ue*Ge-_e*He,Pr=Ke*Qr-ot*er+At*xr+gt*Qt-Mt*gr+zt*Wt;return Pr?(a[0]=(N*Qr-V*er+X*xr)*(Pr=1/Pr),a[1]=(T*er-b*Qr-I*xr)*Pr,a[2]=(ke*zt-He*Mt+Ge*gt)*Pr,a[3]=(ue*Mt-ie*zt-_e*gt)*Pr,a[4]=(V*Qt-F*Qr-X*gr)*Pr,a[5]=(A*Qr-T*Qt+I*gr)*Pr,a[6]=(He*At-Ne*zt-Ge*ot)*Pr,a[7]=(Q*zt-ue*At+_e*ot)*Pr,a[8]=(F*er-N*Qt+X*Wt)*Pr,a[9]=(b*Qt-A*er-I*Wt)*Pr,a[10]=(Ne*Mt-ke*At+Ge*Ke)*Pr,a[11]=(ie*At-Q*Mt-_e*Ke)*Pr,a[12]=(N*gr-F*xr-V*Wt)*Pr,a[13]=(A*xr-b*gr+T*Wt)*Pr,a[14]=(ke*ot-Ne*gt-He*Ke)*Pr,a[15]=(Q*gt-ie*ot+ue*Ke)*Pr,a):null},s.isChar=Jt,s.isMapboxURL=Ar,s.keysDifference=function(a,l){var A=[];for(var b in a)b in l||A.push(b);return A},s.makeRequest=Ce,s.mapObject=de,s.mercatorXfromLng=ZT,s.mercatorYfromLat=QT,s.mercatorZfromAltitude=eE,s.mul=My,s.multiply=Os,s.mvt=Th,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,l){var A=l[0],b=l[1],T=l[2],I=A*A+b*b+T*T;return I>0&&(I=1/Math.sqrt(I)),a[0]=l[0]*I,a[1]=l[1]*I,a[2]=l[2]*I,a},s.number=ii,s.offscreenCanvasSupported=pe,s.ortho=function(a,l,A,b,T,I,F){var N=1/(l-A),V=1/(b-T),X=1/(I-F);return a[0]=-2*N,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*V,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*X,a[11]=0,a[12]=(l+A)*N,a[13]=(T+b)*V,a[14]=(F+I)*X,a[15]=1,a},s.parseGlyphPBF=function(a){return new Lg(a).readFields(B9,[])},s.pbf=Lg,s.performSymbolLayout=function(a,l,A,b,T,I,F){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var N=a.layers[0].layout,V=a.layers[0]._unevaluatedLayout._values,X={};if(a.textSizeData.kind==="composite"){var Q=a.textSizeData,ie=Q.maxZoom;X.compositeTextSizes=[V["text-size"].possiblyEvaluate(new kr(Q.minZoom),F),V["text-size"].possiblyEvaluate(new kr(ie),F)]}if(a.iconSizeData.kind==="composite"){var ue=a.iconSizeData,_e=ue.maxZoom;X.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new kr(ue.minZoom),F),V["icon-size"].possiblyEvaluate(new kr(_e),F)]}X.layoutTextSize=V["text-size"].possiblyEvaluate(new kr(a.zoom+1),F),X.layoutIconSize=V["icon-size"].possiblyEvaluate(new kr(a.zoom+1),F),X.textMaxSize=V["text-size"].possiblyEvaluate(new kr(18));for(var Ne=24*N.get("text-line-height"),ke=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",He=N.get("text-keep-upright"),Ge=N.get("text-size"),Ke=function(){var gt=At[ot],Mt=N.get("text-font").evaluate(gt,{},F).join(","),zt=Ge.evaluate(gt,{},F),Wt=X.layoutTextSize.evaluate(gt,{},F),gr=X.layoutIconSize.evaluate(gt,{},F),Qt={horizontal:{},vertical:void 0},xr=gt.text,er=[0,0];if(xr){var Qr=xr.toString(),Pr=24*N.get("text-letter-spacing").evaluate(gt,{},F),cr=function(un){for(var Rn=0,Cn=un;Rn<Cn.length;Rn+=1)if(mn=Cn[Rn].charCodeAt(0),Jt.Arabic(mn)||Jt["Arabic Supplement"](mn)||Jt["Arabic Extended-A"](mn)||Jt["Arabic Presentation Forms-A"](mn)||Jt["Arabic Presentation Forms-B"](mn))return!1;var mn;return!0}(Qr)?Pr:0,on=N.get("text-anchor").evaluate(gt,{},F),$r=N.get("text-variable-anchor");if(!$r){var pn=N.get("text-radial-offset").evaluate(gt,{},F);er=pn?VT(on,[24*pn,jy]):N.get("text-offset").evaluate(gt,{},F).map(function(un){return 24*un})}var wr=ke?"center":N.get("text-justify").evaluate(gt,{},F),_n=N.get("symbol-placement"),Kn=_n==="point"?24*N.get("text-max-width").evaluate(gt,{},F):0,yi=function(){a.allowVerticalPlacement&&ef(Qr)&&(Qt.vertical=Ug(xr,l,A,T,Mt,Kn,Ne,on,"left",cr,er,wo.vertical,!0,_n,Wt,zt))};if(!ke&&$r){for(var Ai=wr==="auto"?$r.map(function(un){return $y(un)}):[wr],qn=!1,vi=0;vi<Ai.length;vi++){var ji=Ai[vi];if(!Qt.horizontal[ji])if(qn)Qt.horizontal[ji]=Qt.horizontal[0];else{var $i=Ug(xr,l,A,T,Mt,Kn,Ne,"center",ji,cr,er,wo.horizontal,!1,_n,Wt,zt);$i&&(Qt.horizontal[ji]=$i,qn=$i.positionedLines.length===1)}}yi()}else{wr==="auto"&&(wr=$y(on));var xs=Ug(xr,l,A,T,Mt,Kn,Ne,on,wr,cr,er,wo.horizontal,!1,_n,Wt,zt);xs&&(Qt.horizontal[wr]=xs),yi(),ef(Qr)&&ke&&He&&(Qt.vertical=Ug(xr,l,A,T,Mt,Kn,Ne,on,wr,cr,er,wo.vertical,!1,_n,Wt,zt))}}var es=void 0,ws=!1;if(gt.icon&&gt.icon.name){var wi=b[gt.icon.name];wi&&(es=function(un,Rn,Cn){var mn=Vy(Cn),Ns=Rn[0]-un.displaySize[0]*mn.horizontalAlign,fs=Rn[1]-un.displaySize[1]*mn.verticalAlign;return{image:un,top:fs,bottom:fs+un.displaySize[1],left:Ns,right:Ns+un.displaySize[0]}}(T[gt.icon.name],N.get("icon-offset").evaluate(gt,{},F),N.get("icon-anchor").evaluate(gt,{},F)),ws=wi.sdf,a.sdfIcons===void 0?a.sdfIcons=wi.sdf:a.sdfIcons!==wi.sdf&&re("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wi.pixelRatio!==a.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var ts=jT(Qt.horizontal)||Qt.vertical;a.iconsInText=!!ts&&ts.iconsInText,(ts||es)&&function(un,Rn,Cn,mn,Ns,fs,Wn,Mi,hs,yn,Sc){var Co=fs.textMaxSize.evaluate(Rn,{});Co===void 0&&(Co=Wn);var Ic,Ci=un.layers[0].layout,Mc=Ci.get("icon-offset").evaluate(Rn,{},Sc),ma=jT(Cn.horizontal),Lh=Wn/24,Af=un.tilePixelRatio*Lh,Nh=un.tilePixelRatio*Co/24,yl=un.tilePixelRatio*Mi,kh=un.tilePixelRatio*Ci.get("symbol-spacing"),Kg=Ci.get("text-padding")*un.tilePixelRatio,Uh=Ci.get("icon-padding")*un.tilePixelRatio,KA=Ci.get("text-max-angle")/180*Math.PI,qg=Ci.get("text-rotation-alignment")==="map"&&Ci.get("symbol-placement")!=="point",Yg=Ci.get("icon-rotation-alignment")==="map"&&Ci.get("symbol-placement")!=="point",vl=Ci.get("symbol-placement"),qA=kh/2,zh=Ci.get("icon-text-fit");mn&&zh!=="none"&&(un.allowVerticalPlacement&&Cn.vertical&&(Ic=RT(mn,Cn.vertical,zh,Ci.get("icon-text-fit-padding"),Mc,Lh)),ma&&(mn=RT(mn,ma,zh,Ci.get("icon-text-fit-padding"),Mc,Lh)));var uu=function(Y9,ip){ip.x<0||ip.x>=8192||ip.y<0||ip.y>=8192||function(Ti,ja,Z9,fu,ev,aE,n0,Pc,i0,sp,s0,o0,tv,cE,op,lE,uE,fE,hE,dE,To,a0,AE,Rc,Q9){var pE,gf,$h,Wh,Jh,Xh=Ti.addToLineVertexArray(ja,Z9),gE=0,mE=0,_E=0,yE=0,rv=-1,nv=-1,bl={},vE=ge(""),iv=0,sv=0;if(Pc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(iv=(pE=Pc.layout.get("text-offset").evaluate(To,{},Rc).map(function(cp){return 24*cp}))[0],sv=pE[1]):(iv=24*Pc.layout.get("text-radial-offset").evaluate(To,{},Rc),sv=jy),Ti.allowVerticalPlacement&&fu.vertical){var bE=Pc.layout.get("text-rotate").evaluate(To,{},Rc)+90;Wh=new jg(i0,ja,sp,s0,o0,fu.vertical,tv,cE,op,bE),n0&&(Jh=new jg(i0,ja,sp,s0,o0,n0,uE,fE,op,bE))}if(ev){var ov=Pc.layout.get("icon-rotate").evaluate(To,{}),xE=Pc.layout.get("icon-text-fit")!=="none",wE=zT(ev,ov,AE,xE),av=n0?zT(n0,ov,AE,xE):void 0;$h=new jg(i0,ja,sp,s0,o0,ev,uE,fE,!1,ov),gE=4*wE.length;var CE=Ti.iconSizeData,ap=null;CE.kind==="source"?(ap=[128*Pc.layout.get("icon-size").evaluate(To,{})])[0]>32640&&re(Ti.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):CE.kind==="composite"&&((ap=[128*a0.compositeIconSizes[0].evaluate(To,{},Rc),128*a0.compositeIconSizes[1].evaluate(To,{},Rc)])[0]>32640||ap[1]>32640)&&re(Ti.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ti.addSymbols(Ti.icon,wE,ap,dE,hE,To,!1,ja,Xh.lineStartIndex,Xh.lineLength,-1,Rc),rv=Ti.icon.placedSymbolArray.length-1,av&&(mE=4*av.length,Ti.addSymbols(Ti.icon,av,ap,dE,hE,To,wo.vertical,ja,Xh.lineStartIndex,Xh.lineLength,-1,Rc),nv=Ti.icon.placedSymbolArray.length-1)}for(var TE in fu.horizontal){var c0=fu.horizontal[TE];if(!gf){vE=ge(c0.text);var eU=Pc.layout.get("text-rotate").evaluate(To,{},Rc);gf=new jg(i0,ja,sp,s0,o0,c0,tv,cE,op,eU)}var EE=c0.positionedLines.length===1;if(_E+=HT(Ti,ja,c0,aE,Pc,op,To,lE,Xh,fu.vertical?wo.horizontal:wo.horizontalOnly,EE?Object.keys(fu.horizontal):[TE],bl,rv,a0,Rc),EE)break}fu.vertical&&(yE+=HT(Ti,ja,fu.vertical,aE,Pc,op,To,lE,Xh,wo.vertical,["vertical"],bl,nv,a0,Rc));var tU=gf?gf.boxStartIndex:Ti.collisionBoxArray.length,rU=gf?gf.boxEndIndex:Ti.collisionBoxArray.length,nU=Wh?Wh.boxStartIndex:Ti.collisionBoxArray.length,iU=Wh?Wh.boxEndIndex:Ti.collisionBoxArray.length,sU=$h?$h.boxStartIndex:Ti.collisionBoxArray.length,oU=$h?$h.boxEndIndex:Ti.collisionBoxArray.length,aU=Jh?Jh.boxStartIndex:Ti.collisionBoxArray.length,cU=Jh?Jh.boxEndIndex:Ti.collisionBoxArray.length,Fc=-1,l0=function(cp,SE){return cp&&cp.circleDiameter?Math.max(cp.circleDiameter,SE):SE};Fc=l0(gf,Fc),Fc=l0(Wh,Fc),Fc=l0($h,Fc);var BE=(Fc=l0(Jh,Fc))>-1?1:0;BE&&(Fc*=Q9/24),Ti.glyphOffsetArray.length>=Sn.MAX_GLYPHS&&re("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),To.sortKey!==void 0&&Ti.addToSortKeyRanges(Ti.symbolInstances.length,To.sortKey),Ti.symbolInstances.emplaceBack(ja.x,ja.y,bl.right>=0?bl.right:-1,bl.center>=0?bl.center:-1,bl.left>=0?bl.left:-1,bl.vertical||-1,rv,nv,vE,tU,rU,nU,iU,sU,oU,aU,cU,sp,_E,yE,gE,mE,BE,0,tv,iv,sv,Fc)}(un,ip,Y9,Cn,mn,Ns,Ic,un.layers[0],un.collisionBoxArray,Rn.index,Rn.sourceLayerIndex,un.index,Af,Kg,qg,hs,yl,Uh,Yg,Mc,Rn,fs,yn,Sc,Wn)};if(vl==="line")for(var Gh=0,Zg=UT(Rn.geometry,0,0,8192,8192);Gh<Zg.length;Gh+=1)for(var Qg=Zg[Gh],YA=0,ZA=D9(Qg,kh,KA,Cn.vertical||ma,mn,24,Nh,un.overscaling,8192);YA<ZA.length;YA+=1){var e0=ZA[YA];ma&&k9(un,ma.text,qA,e0)||uu(Qg,e0)}else if(vl==="line-center")for(var QA=0,ep=Rn.geometry;QA<ep.length;QA+=1){var tp=ep[QA];if(tp.length>1){var t0=F9(tp,KA,Cn.vertical||ma,mn,24,Nh);t0&&uu(tp,t0)}}else if(Rn.type==="Polygon")for(var Vh=0,r0=Ny(Rn.geometry,0);Vh<r0.length;Vh+=1){var Hh=r0[Vh],rp=L9(Hh,16);uu(Hh[0],new Ih(rp.x,rp.y,0))}else if(Rn.type==="LineString")for(var pf=0,np=Rn.geometry;pf<np.length;pf+=1){var jh=np[pf];uu(jh,new Ih(jh[0].x,jh[0].y,0))}else if(Rn.type==="Point")for(var Yy=0,sE=Rn.geometry;Yy<sE.length;Yy+=1)for(var Zy=0,oE=sE[Yy];Zy<oE.length;Zy+=1){var Qy=oE[Zy];uu([Qy],new Ih(Qy.x,Qy.y,0))}}(a,gt,Qt,es,b,X,Wt,gr,er,ws,F)},ot=0,At=a.features;ot<At.length;ot+=1)Ke();I&&a.generateCollisionDebugBuffers()},s.perspective=function(a,l,A,b,T){var I,F=1/Math.tan(l/2);return a[0]=F/A,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=F,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,T!=null&&T!==1/0?(a[10]=(T+b)*(I=1/(b-T)),a[14]=2*T*b*I):(a[10]=-1,a[14]=-2*b),a},s.pick=function(a,l){for(var A={},b=0;b<l.length;b++){var T=l[b];T in a&&(A[T]=a[T])}return A},s.plugin=Ki,s.polygonIntersectsPolygon=Tc,s.postMapLoadEvent=ui,s.postTurnstileEvent=Br,s.potpack=ST,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=rr,s.registerForPluginStateChange=function(a){return a({pluginStatus:ys,pluginURL:Go}),mi.on("pluginStateChange",a),a},s.renderColorRamp=lT,s.rotate=function(a,l,A){var b=l[0],T=l[1],I=l[2],F=l[3],N=Math.sin(A),V=Math.cos(A);return a[0]=b*V+I*N,a[1]=T*V+F*N,a[2]=b*-N+I*V,a[3]=T*-N+F*V,a},s.rotateX=function(a,l,A){var b=Math.sin(A),T=Math.cos(A),I=l[4],F=l[5],N=l[6],V=l[7],X=l[8],Q=l[9],ie=l[10],ue=l[11];return l!==a&&(a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=l[3],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),a[4]=I*T+X*b,a[5]=F*T+Q*b,a[6]=N*T+ie*b,a[7]=V*T+ue*b,a[8]=X*T-I*b,a[9]=Q*T-F*b,a[10]=ie*T-N*b,a[11]=ue*T-V*b,a},s.rotateZ=function(a,l,A){var b=Math.sin(A),T=Math.cos(A),I=l[0],F=l[1],N=l[2],V=l[3],X=l[4],Q=l[5],ie=l[6],ue=l[7];return l!==a&&(a[8]=l[8],a[9]=l[9],a[10]=l[10],a[11]=l[11],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15]),a[0]=I*T+X*b,a[1]=F*T+Q*b,a[2]=N*T+ie*b,a[3]=V*T+ue*b,a[4]=X*T-I*b,a[5]=Q*T-F*b,a[6]=ie*T-N*b,a[7]=ue*T-V*b,a},s.scale=function(a,l,A){var b=A[0],T=A[1],I=A[2];return a[0]=l[0]*b,a[1]=l[1]*b,a[2]=l[2]*b,a[3]=l[3]*b,a[4]=l[4]*T,a[5]=l[5]*T,a[6]=l[6]*T,a[7]=l[7]*T,a[8]=l[8]*I,a[9]=l[9]*I,a[10]=l[10]*I,a[11]=l[11]*I,a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15],a},s.scale$1=function(a,l,A){return a[0]=l[0]*A,a[1]=l[1]*A,a[2]=l[2]*A,a[3]=l[3]*A,a},s.scale$2=function(a,l,A){return a[0]=l[0]*A,a[1]=l[1]*A,a[2]=l[2]*A,a},s.setCacheLimits=function(a,l){Me=a,Dt=l},s.setRTLTextPlugin=function(a,l,A){if(A===void 0&&(A=!1),ys==="deferred"||ys==="loading"||ys==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Go=$t.resolveURL(a),ys="deferred",ru=l,wc(),A||uo()},s.sphericalToCartesian=function(a){var l=a[0],A=a[1],b=a[2];return A+=90,A*=Math.PI/180,b*=Math.PI/180,{x:l*Math.cos(A)*Math.sin(b),y:l*Math.sin(A)*Math.sin(b),z:l*Math.cos(b)}},s.sqrLen=function(a){var l=a[0],A=a[1];return l*l+A*A},s.styleSpec=ae,s.sub=function(a,l,A){return a[0]=l[0]-A[0],a[1]=l[1]-A[1],a[2]=l[2]-A[2],a},s.symbolSize=R9,s.transformMat3=function(a,l,A){var b=l[0],T=l[1],I=l[2];return a[0]=b*A[0]+T*A[3]+I*A[6],a[1]=b*A[1]+T*A[4]+I*A[7],a[2]=b*A[2]+T*A[5]+I*A[8],a},s.transformMat4=bh,s.translate=function(a,l,A){var b,T,I,F,N,V,X,Q,ie,ue,_e,Ne,ke=A[0],He=A[1],Ge=A[2];return l===a?(a[12]=l[0]*ke+l[4]*He+l[8]*Ge+l[12],a[13]=l[1]*ke+l[5]*He+l[9]*Ge+l[13],a[14]=l[2]*ke+l[6]*He+l[10]*Ge+l[14],a[15]=l[3]*ke+l[7]*He+l[11]*Ge+l[15]):(T=l[1],I=l[2],F=l[3],N=l[4],V=l[5],X=l[6],Q=l[7],ie=l[8],ue=l[9],_e=l[10],Ne=l[11],a[0]=b=l[0],a[1]=T,a[2]=I,a[3]=F,a[4]=N,a[5]=V,a[6]=X,a[7]=Q,a[8]=ie,a[9]=ue,a[10]=_e,a[11]=Ne,a[12]=b*ke+N*He+ie*Ge+l[12],a[13]=T*ke+V*He+ue*Ge+l[13],a[14]=I*ke+X*He+_e*Ge+l[14],a[15]=F*ke+Q*He+Ne*Ge+l[15]),a},s.triggerPluginCompletionEvent=rf,s.uniqueId=he,s.validateCustomStyleLayer=function(a){var l=[],A=a.id;return A===void 0&&l.push({message:"layers."+A+': missing required property "id"'}),a.render===void 0&&l.push({message:"layers."+A+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&l.push({message:"layers."+A+': property "renderingMode" must be either "2d" or "3d"'}),l},s.validateLight=LA,s.validateStyle=ul,s.values=function(a){var l=[];for(var A in a)l.push(a[A]);return l},s.vectorTile=Th,s.version="1.13.3",s.warnOnce=re,s.webpSupported=fr,s.window=S,s.wrap=G}),o(["./shared"],function(s){function u(q){var ne=typeof q;if(ne==="number"||ne==="boolean"||ne==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){for(var le="[",ye=0,De=q;ye<De.length;ye+=1)le+=u(De[ye])+",";return le+"]"}for(var fe=Object.keys(q).sort(),be="{",ae=0;ae<fe.length;ae++)be+=JSON.stringify(fe[ae])+":"+u(q[fe[ae]])+",";return be+"}"}function d(q){for(var ne="",le=0,ye=s.refProperties;le<ye.length;le+=1)ne+="/"+u(q[ye[le]]);return ne}var y=function(q){this.keyCache={},q&&this.replace(q)};y.prototype.replace=function(q){this._layerConfigs={},this._layers={},this.update(q,[])},y.prototype.update=function(q,ne){for(var le=this,ye=0,De=q;ye<De.length;ye+=1){var fe=De[ye];this._layerConfigs[fe.id]=fe;var be=this._layers[fe.id]=s.createStyleLayer(fe);be._featureFilter=s.featureFilter(be.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(var ae=0,Be=ne;ae<Be.length;ae+=1){var p=Be[ae];delete this.keyCache[p],delete this._layerConfigs[p],delete this._layers[p]}this.familiesBySource={};for(var ce=0,yt=function(Bt,Ut){for(var Dr={},Kt=0;Kt<Bt.length;Kt++){var Kr=Ut&&Ut[Bt[Kt].id]||d(Bt[Kt]);Ut&&(Ut[Bt[Kt].id]=Kr);var tn=Dr[Kr];tn||(tn=Dr[Kr]=[]),tn.push(Bt[Kt])}var Gr=[];for(var Vr in Dr)Gr.push(Dr[Vr]);return Gr}(s.values(this._layerConfigs),this.keyCache);ce<yt.length;ce+=1){var Xe=yt[ce].map(function(Bt){return le._layers[Bt.id]}),wt=Xe[0];if(wt.visibility!=="none"){var St=wt.source||"",Rt=this.familiesBySource[St];Rt||(Rt=this.familiesBySource[St]={});var lt=wt.sourceLayer||"_geojsonTileLayer",Ft=Rt[lt];Ft||(Ft=Rt[lt]=[]),Ft.push(Xe)}}};var x=function(q){var ne={},le=[];for(var ye in q){var De=q[ye],fe=ne[ye]={};for(var be in De){var ae=De[+be];if(ae&&ae.bitmap.width!==0&&ae.bitmap.height!==0){var Be={x:0,y:0,w:ae.bitmap.width+2,h:ae.bitmap.height+2};le.push(Be),fe[be]={rect:Be,metrics:ae.metrics}}}}var p=s.potpack(le),ce=new s.AlphaImage({width:p.w||1,height:p.h||1});for(var yt in q){var Xe=q[yt];for(var wt in Xe){var St=Xe[+wt];if(St&&St.bitmap.width!==0&&St.bitmap.height!==0){var Rt=ne[yt][wt].rect;s.AlphaImage.copy(St.bitmap,ce,{x:0,y:0},{x:Rt.x+1,y:Rt.y+1},St.bitmap)}}}this.image=ce,this.positions=ne};s.register("GlyphAtlas",x);var E=function(q){this.tileID=new s.OverscaledTileID(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId};function S(q,ne,le){for(var ye=new s.EvaluationParameters(ne),De=0,fe=q;De<fe.length;De+=1)fe[De].recalculate(ye,le)}function O(q,ne){var le=s.getArrayBuffer(q.request,function(ye,De,fe,be){ye?ne(ye):De&&ne(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(De)),rawData:De,cacheControl:fe,expires:be})});return function(){le.cancel(),ne()}}E.prototype.parse=function(q,ne,le,ye,De){var fe=this;this.status="parsing",this.data=q,this.collisionBoxArray=new s.CollisionBoxArray;var be=new s.DictionaryCoder(Object.keys(q.layers).sort()),ae=new s.FeatureIndex(this.tileID,this.promoteId);ae.bucketLayerIDs=[];var Be,p,ce,yt,Xe={},wt={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},St=ne.familiesBySource[this.source];for(var Rt in St){var lt=q.layers[Rt];if(lt){lt.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+Rt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ft=be.encode(Rt),Bt=[],Ut=0;Ut<lt.length;Ut++){var Dr=lt.feature(Ut),Kt=ae.getId(Dr,Rt);Bt.push({feature:Dr,id:Kt,index:Ut,sourceLayerIndex:Ft})}for(var Kr=0,tn=St[Rt];Kr<tn.length;Kr+=1){var Gr=tn[Kr],Vr=Gr[0];Vr.minzoom&&this.zoom<Math.floor(Vr.minzoom)||Vr.maxzoom&&this.zoom>=Vr.maxzoom||Vr.visibility!=="none"&&(S(Gr,this.zoom,le),(Xe[Vr.id]=Vr.createBucket({index:ae.bucketLayerIDs.length,layers:Gr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(Bt,wt,this.tileID.canonical),ae.bucketLayerIDs.push(Gr.map(function(Ie){return Ie.id})))}}}var Nr=s.mapObject(wt.glyphDependencies,function(Ie){return Object.keys(Ie).map(Number)});Object.keys(Nr).length?ye.send("getGlyphs",{uid:this.uid,stacks:Nr},function(Ie,jt){Be||(Be=Ie,p=jt,ur.call(fe))}):p={};var fi=Object.keys(wt.iconDependencies);fi.length?ye.send("getImages",{icons:fi,source:this.source,tileID:this.tileID,type:"icons"},function(Ie,jt){Be||(Be=Ie,ce=jt,ur.call(fe))}):ce={};var Hr=Object.keys(wt.patternDependencies);function ur(){if(Be)return De(Be);if(p&&ce&&yt){var Ie=new x(p),jt=new s.ImageAtlas(ce,yt);for(var qr in Xe){var Ni=Xe[qr];Ni instanceof s.SymbolBucket?(S(Ni.layers,this.zoom,le),s.performSymbolLayout(Ni,p,Ie.positions,ce,jt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ni.hasPattern&&(Ni instanceof s.LineBucket||Ni instanceof s.FillBucket||Ni instanceof s.FillExtrusionBucket)&&(S(Ni.layers,this.zoom,le),Ni.addFeatures(wt,this.tileID.canonical,jt.patternPositions))}this.status="done",De(null,{buckets:s.values(Xe).filter(function(ia){return!ia.isEmpty()}),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ie.image,imageAtlas:jt,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?ce:null,glyphPositions:this.returnDependencies?Ie.positions:null})}}Hr.length?ye.send("getImages",{icons:Hr,source:this.source,tileID:this.tileID,type:"patterns"},function(Ie,jt){Be||(Be=Ie,yt=jt,ur.call(fe))}):yt={},ur.call(this)};var k=function(q,ne,le,ye){this.actor=q,this.layerIndex=ne,this.availableImages=le,this.loadVectorData=ye||O,this.loading={},this.loaded={}};k.prototype.loadTile=function(q,ne){var le=this,ye=q.uid;this.loading||(this.loading={});var De=!!(q&&q.request&&q.request.collectResourceTiming)&&new s.RequestPerformance(q.request),fe=this.loading[ye]=new E(q);fe.abort=this.loadVectorData(q,function(be,ae){if(delete le.loading[ye],be||!ae)return fe.status="done",le.loaded[ye]=fe,ne(be);var Be=ae.rawData,p={};ae.expires&&(p.expires=ae.expires),ae.cacheControl&&(p.cacheControl=ae.cacheControl);var ce={};if(De){var yt=De.finish();yt&&(ce.resourceTiming=JSON.parse(JSON.stringify(yt)))}fe.vectorTile=ae.vectorTile,fe.parse(ae.vectorTile,le.layerIndex,le.availableImages,le.actor,function(Xe,wt){if(Xe||!wt)return ne(Xe);ne(null,s.extend({rawTileData:Be.slice(0)},wt,p,ce))}),le.loaded=le.loaded||{},le.loaded[ye]=fe})},k.prototype.reloadTile=function(q,ne){var le=this,ye=this.loaded,De=q.uid,fe=this;if(ye&&ye[De]){var be=ye[De];be.showCollisionBoxes=q.showCollisionBoxes;var ae=function(Be,p){var ce=be.reloadCallback;ce&&(delete be.reloadCallback,be.parse(be.vectorTile,fe.layerIndex,le.availableImages,fe.actor,ce)),ne(Be,p)};be.status==="parsing"?be.reloadCallback=ae:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,ae):ae())}},k.prototype.abortTile=function(q,ne){var le=this.loading,ye=q.uid;le&&le[ye]&&le[ye].abort&&(le[ye].abort(),delete le[ye]),ne()},k.prototype.removeTile=function(q,ne){var le=this.loaded,ye=q.uid;le&&le[ye]&&delete le[ye],ne()};var U=s.window.ImageBitmap,J=function(){this.loaded={}};function G(q,ne){if(q.length!==0){H(q[0],ne);for(var le=1;le<q.length;le++)H(q[le],!ne)}}function H(q,ne){for(var le=0,ye=0,De=0,fe=q.length,be=fe-1;De<fe;be=De++){var ae=(q[De][0]-q[be][0])*(q[be][1]+q[De][1]),Be=le+ae;ye+=Math.abs(le)>=Math.abs(ae)?le-Be+ae:ae-Be+le,le=Be}le+ye>=0!=!!ne&&q.reverse()}J.prototype.loadTile=function(q,ne){var le=q.uid,ye=q.encoding,De=q.rawImageData,fe=U&&De instanceof U?this.getImageData(De):De,be=new s.DEMData(le,fe,ye);this.loaded=this.loaded||{},this.loaded[le]=be,ne(null,be)},J.prototype.getImageData=function(q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);var ne=this.offscreenCanvasContext.getImageData(-1,-1,q.width+2,q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:ne.width,height:ne.height},ne.data)},J.prototype.removeTile=function(q){var ne=this.loaded,le=q.uid;ne&&ne[le]&&delete ne[le]};var K=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,he=function(q){this._feature=q,this.extent=s.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))};he.prototype.loadGeometry=function(){if(this._feature.type===1){for(var q=[],ne=0,le=this._feature.geometry;ne<le.length;ne+=1){var ye=le[ne];q.push([new s.Point$1(ye[0],ye[1])])}return q}for(var De=[],fe=0,be=this._feature.geometry;fe<be.length;fe+=1){for(var ae=[],Be=0,p=be[fe];Be<p.length;Be+=1){var ce=p[Be];ae.push(new s.Point$1(ce[0],ce[1]))}De.push(ae)}return De},he.prototype.toGeoJSON=function(q,ne,le){return K.call(this,q,ne,le)};var Y=function(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=q.length,this._features=q};Y.prototype.feature=function(q){return new he(this._features[q])};var oe=s.vectorTile.VectorTileFeature,Ee=ze;function ze(q,ne){this.options=ne||{},this.features=q,this.length=q.length}function de(q,ne){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=ne||4096}ze.prototype.feature=function(q){return new de(this.features[q],this.options.extent)},de.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var ne=0;ne<q.length;ne++){for(var le=q[ne],ye=[],De=0;De<le.length;De++)ye.push(new s.Point$1(le[De][0],le[De][1]));this.geometry.push(ye)}return this.geometry},de.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,ne=1/0,le=-1/0,ye=1/0,De=-1/0,fe=0;fe<q.length;fe++)for(var be=q[fe],ae=0;ae<be.length;ae++){var Be=be[ae];ne=Math.min(ne,Be.x),le=Math.max(le,Be.x),ye=Math.min(ye,Be.y),De=Math.max(De,Be.y)}return[ne,ye,le,De]},de.prototype.toGeoJSON=oe.prototype.toGeoJSON;var ve=$,Ae=Ee;function $(q){var ne=new s.pbf;return function(le,ye){for(var De in le.layers)ye.writeMessage(3,re,le.layers[De])}(q,ne),ne.finish()}function re(q,ne){var le;ne.writeVarintField(15,q.version||1),ne.writeStringField(1,q.name||""),ne.writeVarintField(5,q.extent||4096);var ye={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<q.length;le++)ye.feature=q.feature(le),ne.writeMessage(2,Te,ye);var De=ye.keys;for(le=0;le<De.length;le++)ne.writeStringField(3,De[le]);var fe=ye.values;for(le=0;le<fe.length;le++)ne.writeMessage(4,Ye,fe[le])}function Te(q,ne){var le=q.feature;le.id!==void 0&&ne.writeVarintField(1,le.id),ne.writeMessage(2,Qe,q),ne.writeVarintField(3,le.type),ne.writeMessage(4,Ue,le)}function Qe(q,ne){var le=q.feature,ye=q.keys,De=q.values,fe=q.keycache,be=q.valuecache;for(var ae in le.properties){var Be=fe[ae];Be===void 0&&(ye.push(ae),fe[ae]=Be=ye.length-1),ne.writeVarint(Be);var p=le.properties[ae],ce=typeof p;ce!=="string"&&ce!=="boolean"&&ce!=="number"&&(p=JSON.stringify(p));var yt=ce+":"+p,Xe=be[yt];Xe===void 0&&(De.push(p),be[yt]=Xe=De.length-1),ne.writeVarint(Xe)}}function me(q,ne){return(ne<<3)+(7&q)}function Le(q){return q<<1^q>>31}function Ue(q,ne){for(var le=q.loadGeometry(),ye=q.type,De=0,fe=0,be=le.length,ae=0;ae<be;ae++){var Be=le[ae],p=1;ye===1&&(p=Be.length),ne.writeVarint(me(1,p));for(var ce=ye===3?Be.length-1:Be.length,yt=0;yt<ce;yt++){yt===1&&ye!==1&&ne.writeVarint(me(2,ce-1));var Xe=Be[yt].x-De,wt=Be[yt].y-fe;ne.writeVarint(Le(Xe)),ne.writeVarint(Le(wt)),De+=Xe,fe+=wt}ye===3&&ne.writeVarint(me(7,1))}}function Ye(q,ne){var le=typeof q;le==="string"?ne.writeStringField(1,q):le==="boolean"?ne.writeBooleanField(7,q):le==="number"&&(q%1!=0?ne.writeDoubleField(3,q):q<0?ne.writeSVarintField(6,q):ne.writeVarintField(5,q))}function et(q,ne,le,ye){tt(q,le,ye),tt(ne,2*le,2*ye),tt(ne,2*le+1,2*ye+1)}function tt(q,ne,le){var ye=q[ne];q[ne]=q[le],q[le]=ye}function ct(q,ne,le,ye){var De=q-le,fe=ne-ye;return De*De+fe*fe}ve.fromVectorTileJs=$,ve.fromGeojsonVt=function(q,ne){ne=ne||{};var le={};for(var ye in q)le[ye]=new Ee(q[ye].features,ne),le[ye].name=ye,le[ye].version=ne.version,le[ye].extent=ne.extent;return $({layers:le})},ve.GeoJSONWrapper=Ae;var mt=function(q){return q[0]},Tt=function(q){return q[1]},nt=function(q,ne,le,ye,De){ne===void 0&&(ne=mt),le===void 0&&(le=Tt),ye===void 0&&(ye=64),De===void 0&&(De=Float64Array),this.nodeSize=ye,this.points=q;for(var fe=q.length<65536?Uint16Array:Uint32Array,be=this.ids=new fe(q.length),ae=this.coords=new De(2*q.length),Be=0;Be<q.length;Be++)be[Be]=Be,ae[2*Be]=ne(q[Be]),ae[2*Be+1]=le(q[Be]);(function p(ce,yt,Xe,wt,St,Rt){if(!(St-wt<=Xe)){var lt=wt+St>>1;(function Ft(Bt,Ut,Dr,Kt,Kr,tn){for(;Kr>Kt;){if(Kr-Kt>600){var Gr=Kr-Kt+1,Vr=Dr-Kt+1,Nr=Math.log(Gr),fi=.5*Math.exp(2*Nr/3),Hr=.5*Math.sqrt(Nr*fi*(Gr-fi)/Gr)*(Vr-Gr/2<0?-1:1);Ft(Bt,Ut,Dr,Math.max(Kt,Math.floor(Dr-Vr*fi/Gr+Hr)),Math.min(Kr,Math.floor(Dr+(Gr-Vr)*fi/Gr+Hr)),tn)}var ur=Ut[2*Dr+tn],Ie=Kt,jt=Kr;for(et(Bt,Ut,Kt,Dr),Ut[2*Kr+tn]>ur&&et(Bt,Ut,Kt,Kr);Ie<jt;){for(et(Bt,Ut,Ie,jt),Ie++,jt--;Ut[2*Ie+tn]<ur;)Ie++;for(;Ut[2*jt+tn]>ur;)jt--}Ut[2*Kt+tn]===ur?et(Bt,Ut,Kt,jt):et(Bt,Ut,++jt,Kr),jt<=Dr&&(Kt=jt+1),Dr<=jt&&(Kr=jt-1)}})(ce,yt,lt,wt,St,Rt%2),p(ce,yt,Xe,wt,lt-1,Rt+1),p(ce,yt,Xe,lt+1,St,Rt+1)}})(be,ae,ye,0,be.length-1,0)};nt.prototype.range=function(q,ne,le,ye){return function(De,fe,be,ae,Be,p,ce){for(var yt,Xe,wt=[0,De.length-1,0],St=[];wt.length;){var Rt=wt.pop(),lt=wt.pop(),Ft=wt.pop();if(lt-Ft<=ce)for(var Bt=Ft;Bt<=lt;Bt++)Xe=fe[2*Bt+1],(yt=fe[2*Bt])>=be&&yt<=Be&&Xe>=ae&&Xe<=p&&St.push(De[Bt]);else{var Ut=Math.floor((Ft+lt)/2);Xe=fe[2*Ut+1],(yt=fe[2*Ut])>=be&&yt<=Be&&Xe>=ae&&Xe<=p&&St.push(De[Ut]);var Dr=(Rt+1)%2;(Rt===0?be<=yt:ae<=Xe)&&(wt.push(Ft),wt.push(Ut-1),wt.push(Dr)),(Rt===0?Be>=yt:p>=Xe)&&(wt.push(Ut+1),wt.push(lt),wt.push(Dr))}}return St}(this.ids,this.coords,q,ne,le,ye,this.nodeSize)},nt.prototype.within=function(q,ne,le){return function(ye,De,fe,be,ae,Be){for(var p=[0,ye.length-1,0],ce=[],yt=ae*ae;p.length;){var Xe=p.pop(),wt=p.pop(),St=p.pop();if(wt-St<=Be)for(var Rt=St;Rt<=wt;Rt++)ct(De[2*Rt],De[2*Rt+1],fe,be)<=yt&&ce.push(ye[Rt]);else{var lt=Math.floor((St+wt)/2),Ft=De[2*lt],Bt=De[2*lt+1];ct(Ft,Bt,fe,be)<=yt&&ce.push(ye[lt]);var Ut=(Xe+1)%2;(Xe===0?fe-ae<=Ft:be-ae<=Bt)&&(p.push(St),p.push(lt-1),p.push(Ut)),(Xe===0?fe+ae>=Ft:be+ae>=Bt)&&(p.push(lt+1),p.push(wt),p.push(Ut))}}return ce}(this.ids,this.coords,q,ne,le,this.nodeSize)};var lr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(q){return q}},qt=function(q){this.options=Ln(Object.create(lr),q),this.trees=new Array(this.options.maxZoom+1)};function $t(q,ne,le,ye,De){return{x:q,y:ne,zoom:1/0,id:le,parentId:-1,numPoints:ye,properties:De}}function Ot(q,ne){var le=q.geometry.coordinates,ye=le[1];return{x:Er(le[0]),y:mr(ye),zoom:1/0,index:ne,parentId:-1}}function fr(q){return{type:"Feature",id:q.id,properties:rn(q),geometry:{type:"Point",coordinates:[(ye=q.x,360*(ye-.5)),(ne=q.y,le=(180-360*ne)*Math.PI/180,360*Math.atan(Math.exp(le))/Math.PI-90)]}};var ne,le,ye}function rn(q){var ne=q.numPoints,le=ne>=1e4?Math.round(ne/1e3)+"k":ne>=1e3?Math.round(ne/100)/10+"k":ne;return Ln(Ln({},q.properties),{cluster:!0,cluster_id:q.id,point_count:ne,point_count_abbreviated:le})}function Er(q){return q/360+.5}function mr(q){var ne=Math.sin(q*Math.PI/180),le=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return le<0?0:le>1?1:le}function Ln(q,ne){for(var le in ne)q[le]=ne[le];return q}function dr(q){return q.x}function Ar(q){return q.y}function nn(q,ne,le,ye,De,fe){var be=De-le,ae=fe-ye;if(be!==0||ae!==0){var Be=((q-le)*be+(ne-ye)*ae)/(be*be+ae*ae);Be>1?(le=De,ye=fe):Be>0&&(le+=be*Be,ye+=ae*Be)}return(be=q-le)*be+(ae=ne-ye)*ae}function Ir(q,ne,le,ye){var De={id:q===void 0?null:q,type:ne,geometry:le,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var be=fe.geometry,ae=fe.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")ei(fe,be);else if(ae==="Polygon"||ae==="MultiLineString")for(var Be=0;Be<be.length;Be++)ei(fe,be[Be]);else if(ae==="MultiPolygon")for(Be=0;Be<be.length;Be++)for(var p=0;p<be[Be].length;p++)ei(fe,be[Be][p])}(De),De}function ei(q,ne){for(var le=0;le<ne.length;le+=3)q.minX=Math.min(q.minX,ne[le]),q.minY=Math.min(q.minY,ne[le+1]),q.maxX=Math.max(q.maxX,ne[le]),q.maxY=Math.max(q.maxY,ne[le+1])}function jn(q,ne,le,ye){if(ne.geometry){var De=ne.geometry.coordinates,fe=ne.geometry.type,be=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),ae=[],Be=ne.id;if(le.promoteId?Be=ne.properties[le.promoteId]:le.generateId&&(Be=ye||0),fe==="Point")fn(De,ae);else if(fe==="MultiPoint")for(var p=0;p<De.length;p++)fn(De[p],ae);else if(fe==="LineString")Jn(De,ae,be,!1);else if(fe==="MultiLineString"){if(le.lineMetrics){for(p=0;p<De.length;p++)Jn(De[p],ae=[],be,!1),q.push(Ir(Be,"LineString",ae,ne.properties));return}Nn(De,ae,be,!1)}else if(fe==="Polygon")Nn(De,ae,be,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(p=0;p<ne.geometry.geometries.length;p++)jn(q,{id:Be,geometry:ne.geometry.geometries[p],properties:ne.properties},le,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(p=0;p<De.length;p++){var ce=[];Nn(De[p],ce,be,!0),ae.push(ce)}}q.push(Ir(Be,fe,ae,ne.properties))}}function fn(q,ne){ne.push(bn(q[0])),ne.push($n(q[1])),ne.push(0)}function Jn(q,ne,le,ye){for(var De,fe,be=0,ae=0;ae<q.length;ae++){var Be=bn(q[ae][0]),p=$n(q[ae][1]);ne.push(Be),ne.push(p),ne.push(0),ae>0&&(be+=ye?(De*p-Be*fe)/2:Math.sqrt(Math.pow(Be-De,2)+Math.pow(p-fe,2))),De=Be,fe=p}var ce=ne.length-3;ne[2]=1,function yt(Xe,wt,St,Rt){for(var lt,Ft=Rt,Bt=St-wt>>1,Ut=St-wt,Dr=Xe[wt],Kt=Xe[wt+1],Kr=Xe[St],tn=Xe[St+1],Gr=wt+3;Gr<St;Gr+=3){var Vr=nn(Xe[Gr],Xe[Gr+1],Dr,Kt,Kr,tn);if(Vr>Ft)lt=Gr,Ft=Vr;else if(Vr===Ft){var Nr=Math.abs(Gr-Bt);Nr<Ut&&(lt=Gr,Ut=Nr)}}Ft>Rt&&(lt-wt>3&&yt(Xe,wt,lt,Rt),Xe[lt+2]=Ft,St-lt>3&&yt(Xe,lt,St,Rt))}(ne,0,ce,le),ne[ce+2]=1,ne.size=Math.abs(be),ne.start=0,ne.end=ne.size}function Nn(q,ne,le,ye){for(var De=0;De<q.length;De++){var fe=[];Jn(q[De],fe,le,ye),ne.push(fe)}}function bn(q){return q/360+.5}function $n(q){var ne=Math.sin(q*Math.PI/180),le=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return le<0?0:le>1?1:le}function kt(q,ne,le,ye,De,fe,be,ae){if(ye/=ne,fe>=(le/=ne)&&be<ye)return q;if(be<le||fe>=ye)return null;for(var Be=[],p=0;p<q.length;p++){var ce=q[p],yt=ce.geometry,Xe=ce.type,wt=De===0?ce.minX:ce.minY,St=De===0?ce.maxX:ce.maxY;if(wt>=le&&St<ye)Be.push(ce);else if(!(St<le||wt>=ye)){var Rt=[];if(Xe==="Point"||Xe==="MultiPoint")hr(yt,Rt,le,ye,De);else if(Xe==="LineString")Br(yt,Rt,le,ye,De,!1,ae.lineMetrics);else if(Xe==="MultiLineString")ui(yt,Rt,le,ye,De,!1);else if(Xe==="Polygon")ui(yt,Rt,le,ye,De,!0);else if(Xe==="MultiPolygon")for(var lt=0;lt<yt.length;lt++){var Ft=[];ui(yt[lt],Ft,le,ye,De,!0),Ft.length&&Rt.push(Ft)}if(Rt.length){if(ae.lineMetrics&&Xe==="LineString"){for(lt=0;lt<Rt.length;lt++)Be.push(Ir(ce.id,Xe,Rt[lt],ce.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(Rt.length===1?(Xe="LineString",Rt=Rt[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=Rt.length===3?"Point":"MultiPoint"),Be.push(Ir(ce.id,Xe,Rt,ce.tags))}}}return Be.length?Be:null}function hr(q,ne,le,ye,De){for(var fe=0;fe<q.length;fe+=3){var be=q[fe+De];be>=le&&be<=ye&&(ne.push(q[fe]),ne.push(q[fe+1]),ne.push(q[fe+2]))}}function Br(q,ne,le,ye,De,fe,be){for(var ae,Be,p=Zr(q),ce=De===0?Dt:Gt,yt=q.start,Xe=0;Xe<q.length-3;Xe+=3){var wt=q[Xe],St=q[Xe+1],Rt=q[Xe+2],lt=q[Xe+3],Ft=q[Xe+4],Bt=De===0?wt:St,Ut=De===0?lt:Ft,Dr=!1;be&&(ae=Math.sqrt(Math.pow(wt-lt,2)+Math.pow(St-Ft,2))),Bt<le?Ut>le&&(Be=ce(p,wt,St,lt,Ft,le),be&&(p.start=yt+ae*Be)):Bt>ye?Ut<ye&&(Be=ce(p,wt,St,lt,Ft,ye),be&&(p.start=yt+ae*Be)):Me(p,wt,St,Rt),Ut<le&&Bt>=le&&(Be=ce(p,wt,St,lt,Ft,le),Dr=!0),Ut>ye&&Bt<=ye&&(Be=ce(p,wt,St,lt,Ft,ye),Dr=!0),!fe&&Dr&&(be&&(p.end=yt+ae*Be),ne.push(p),p=Zr(q)),be&&(yt+=ae)}var Kt=q.length-3;wt=q[Kt],St=q[Kt+1],Rt=q[Kt+2],(Bt=De===0?wt:St)>=le&&Bt<=ye&&Me(p,wt,St,Rt),Kt=p.length-3,fe&&Kt>=3&&(p[Kt]!==p[0]||p[Kt+1]!==p[1])&&Me(p,p[0],p[1],p[2]),p.length&&ne.push(p)}function Zr(q){var ne=[];return ne.size=q.size,ne.start=q.start,ne.end=q.end,ne}function ui(q,ne,le,ye,De,fe){for(var be=0;be<q.length;be++)Br(q[be],ne,le,ye,De,fe,!1)}function Me(q,ne,le,ye){q.push(ne),q.push(le),q.push(ye)}function Dt(q,ne,le,ye,De,fe){var be=(fe-ne)/(ye-ne);return q.push(fe),q.push(le+(De-le)*be),q.push(1),be}function Gt(q,ne,le,ye,De,fe){var be=(fe-le)/(De-le);return q.push(ne+(ye-ne)*be),q.push(fe),q.push(1),be}function sr(q,ne){for(var le=[],ye=0;ye<q.length;ye++){var De,fe=q[ye],be=fe.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")De=qe(fe.geometry,ne);else if(be==="MultiLineString"||be==="Polygon"){De=[];for(var ae=0;ae<fe.geometry.length;ae++)De.push(qe(fe.geometry[ae],ne))}else if(be==="MultiPolygon")for(De=[],ae=0;ae<fe.geometry.length;ae++){for(var Be=[],p=0;p<fe.geometry[ae].length;p++)Be.push(qe(fe.geometry[ae][p],ne));De.push(Be)}le.push(Ir(fe.id,be,De,fe.tags))}return le}function qe(q,ne){var le=[];le.size=q.size,q.start!==void 0&&(le.start=q.start,le.end=q.end);for(var ye=0;ye<q.length;ye+=3)le.push(q[ye]+ne,q[ye+1],q[ye+2]);return le}function It(q,ne){if(q.transformed)return q;var le,ye,De,fe=1<<q.z,be=q.x,ae=q.y;for(le=0;le<q.features.length;le++){var Be=q.features[le],p=Be.geometry,ce=Be.type;if(Be.geometry=[],ce===1)for(ye=0;ye<p.length;ye+=2)Be.geometry.push(pe(p[ye],p[ye+1],ne,fe,be,ae));else for(ye=0;ye<p.length;ye++){var yt=[];for(De=0;De<p[ye].length;De+=2)yt.push(pe(p[ye][De],p[ye][De+1],ne,fe,be,ae));Be.geometry.push(yt)}}return q.transformed=!0,q}function pe(q,ne,le,ye,De,fe){return[Math.round(le*(q*ye-De)),Math.round(le*(ne*ye-fe))]}function Nt(q,ne,le,ye,De){for(var fe=ne===De.maxZoom?0:De.tolerance/((1<<ne)*De.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:ye,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<q.length;ae++){be.numFeatures++,xt(be,q[ae],fe,De);var Be=q[ae].minX,p=q[ae].minY,ce=q[ae].maxX,yt=q[ae].maxY;Be<be.minX&&(be.minX=Be),p<be.minY&&(be.minY=p),ce>be.maxX&&(be.maxX=ce),yt>be.maxY&&(be.maxY=yt)}return be}function xt(q,ne,le,ye){var De=ne.geometry,fe=ne.type,be=[];if(fe==="Point"||fe==="MultiPoint")for(var ae=0;ae<De.length;ae+=3)be.push(De[ae]),be.push(De[ae+1]),q.numPoints++,q.numSimplified++;else if(fe==="LineString")j(be,De,q,le,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(ae=0;ae<De.length;ae++)j(be,De[ae],q,le,fe==="Polygon",ae===0);else if(fe==="MultiPolygon")for(var Be=0;Be<De.length;Be++){var p=De[Be];for(ae=0;ae<p.length;ae++)j(be,p[ae],q,le,!0,ae===0)}if(be.length){var ce=ne.tags||null;if(fe==="LineString"&&ye.lineMetrics){for(var yt in ce={},ne.tags)ce[yt]=ne.tags[yt];ce.mapbox_clip_start=De.start/De.size,ce.mapbox_clip_end=De.end/De.size}var Xe={geometry:be,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:ce};ne.id!==null&&(Xe.id=ne.id),q.features.push(Xe)}}function j(q,ne,le,ye,De,fe){var be=ye*ye;if(ye>0&&ne.size<(De?be:ye))le.numPoints+=ne.length/3;else{for(var ae=[],Be=0;Be<ne.length;Be+=3)(ye===0||ne[Be+2]>be)&&(le.numSimplified++,ae.push(ne[Be]),ae.push(ne[Be+1])),le.numPoints++;De&&function(p,ce){for(var yt=0,Xe=0,wt=p.length,St=wt-2;Xe<wt;St=Xe,Xe+=2)yt+=(p[Xe]-p[St])*(p[Xe+1]+p[St+1]);if(yt>0===ce)for(Xe=0,wt=p.length;Xe<wt/2;Xe+=2){var Rt=p[Xe],lt=p[Xe+1];p[Xe]=p[wt-2-Xe],p[Xe+1]=p[wt-1-Xe],p[wt-2-Xe]=Rt,p[wt-1-Xe]=lt}}(ae,fe),q.push(ae)}}function _t(q,ne){var le=(ne=this.options=function(De,fe){for(var be in fe)De[be]=fe[be];return De}(Object.create(this.options),ne)).debug;if(le&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye=function(De,fe){var be=[];if(De.type==="FeatureCollection")for(var ae=0;ae<De.features.length;ae++)jn(be,De.features[ae],fe,ae);else jn(be,De.type==="Feature"?De:{geometry:De},fe);return be}(q,ne);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=function(De,fe){var be=fe.buffer/fe.extent,ae=De,Be=kt(De,1,-1-be,be,0,-1,2,fe),p=kt(De,1,1-be,2+be,0,-1,2,fe);return(Be||p)&&(ae=kt(De,1,-be,1+be,0,-1,2,fe)||[],Be&&(ae=sr(Be,1).concat(ae)),p&&(ae=ae.concat(sr(p,-1)))),ae}(ye,ne)).length&&this.splitTile(ye,0,0,0),le&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ct(q,ne,le){return 32*((1<<q)*le+ne)+q}function Ce(q,ne){var le=q.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);var ye=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!ye)return ne(null,null);var De=new Y(ye.features),fe=ve(De);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),ne(null,{vectorTile:De,rawData:fe.buffer})}qt.prototype.load=function(q){var ne=this.options,le=ne.log,ye=ne.minZoom,De=ne.maxZoom,fe=ne.nodeSize;le&&console.time("total time");var be="prepare "+q.length+" points";le&&console.time(be),this.points=q;for(var ae=[],Be=0;Be<q.length;Be++)q[Be].geometry&&ae.push(Ot(q[Be],Be));this.trees[De+1]=new nt(ae,dr,Ar,fe,Float32Array),le&&console.timeEnd(be);for(var p=De;p>=ye;p--){var ce=+Date.now();ae=this._cluster(ae,p),this.trees[p]=new nt(ae,dr,Ar,fe,Float32Array),le&&console.log("z%d: %d clusters in %dms",p,ae.length,+Date.now()-ce)}return le&&console.timeEnd("total time"),this},qt.prototype.getClusters=function(q,ne){var le=((q[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,q[1])),De=q[2]===180?180:((q[2]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)le=-180,De=180;else if(le>De){var be=this.getClusters([le,ye,180,fe],ne),ae=this.getClusters([-180,ye,De,fe],ne);return be.concat(ae)}for(var Be=this.trees[this._limitZoom(ne)],p=[],ce=0,yt=Be.range(Er(le),mr(fe),Er(De),mr(ye));ce<yt.length;ce+=1){var Xe=Be.points[yt[ce]];p.push(Xe.numPoints?fr(Xe):this.points[Xe.index])}return p},qt.prototype.getChildren=function(q){var ne=this._getOriginId(q),le=this._getOriginZoom(q),ye="No cluster with the specified id.",De=this.trees[le];if(!De)throw new Error(ye);var fe=De.points[ne];if(!fe)throw new Error(ye);for(var be=this.options.radius/(this.options.extent*Math.pow(2,le-1)),ae=[],Be=0,p=De.within(fe.x,fe.y,be);Be<p.length;Be+=1){var ce=De.points[p[Be]];ce.parentId===q&&ae.push(ce.numPoints?fr(ce):this.points[ce.index])}if(ae.length===0)throw new Error(ye);return ae},qt.prototype.getLeaves=function(q,ne,le){var ye=[];return this._appendLeaves(ye,q,ne=ne||10,le=le||0,0),ye},qt.prototype.getTile=function(q,ne,le){var ye=this.trees[this._limitZoom(q)],De=Math.pow(2,q),fe=this.options,be=fe.radius/fe.extent,ae=(le-be)/De,Be=(le+1+be)/De,p={features:[]};return this._addTileFeatures(ye.range((ne-be)/De,ae,(ne+1+be)/De,Be),ye.points,ne,le,De,p),ne===0&&this._addTileFeatures(ye.range(1-be/De,ae,1,Be),ye.points,De,le,De,p),ne===De-1&&this._addTileFeatures(ye.range(0,ae,be/De,Be),ye.points,-1,le,De,p),p.features.length?p:null},qt.prototype.getClusterExpansionZoom=function(q){for(var ne=this._getOriginZoom(q)-1;ne<=this.options.maxZoom;){var le=this.getChildren(q);if(ne++,le.length!==1)break;q=le[0].properties.cluster_id}return ne},qt.prototype._appendLeaves=function(q,ne,le,ye,De){for(var fe=0,be=this.getChildren(ne);fe<be.length;fe+=1){var ae=be[fe],Be=ae.properties;if(Be&&Be.cluster?De+Be.point_count<=ye?De+=Be.point_count:De=this._appendLeaves(q,Be.cluster_id,le,ye,De):De<ye?De++:q.push(ae),q.length===le)break}return De},qt.prototype._addTileFeatures=function(q,ne,le,ye,De,fe){for(var be=0,ae=q;be<ae.length;be+=1){var Be=ne[ae[be]],p=Be.numPoints,ce={type:1,geometry:[[Math.round(this.options.extent*(Be.x*De-le)),Math.round(this.options.extent*(Be.y*De-ye))]],tags:p?rn(Be):this.points[Be.index].properties},yt=void 0;p?yt=Be.id:this.options.generateId?yt=Be.index:this.points[Be.index].id&&(yt=this.points[Be.index].id),yt!==void 0&&(ce.id=yt),fe.features.push(ce)}},qt.prototype._limitZoom=function(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))},qt.prototype._cluster=function(q,ne){for(var le=[],ye=this.options,De=ye.reduce,fe=ye.minPoints,be=ye.radius/(ye.extent*Math.pow(2,ne)),ae=0;ae<q.length;ae++){var Be=q[ae];if(!(Be.zoom<=ne)){Be.zoom=ne;for(var p=this.trees[ne+1],ce=p.within(Be.x,Be.y,be),yt=Be.numPoints||1,Xe=yt,wt=0,St=ce;wt<St.length;wt+=1){var Rt=p.points[St[wt]];Rt.zoom>ne&&(Xe+=Rt.numPoints||1)}if(Xe>=fe){for(var lt=Be.x*yt,Ft=Be.y*yt,Bt=De&&yt>1?this._map(Be,!0):null,Ut=(ae<<5)+(ne+1)+this.points.length,Dr=0,Kt=ce;Dr<Kt.length;Dr+=1){var Kr=p.points[Kt[Dr]];if(!(Kr.zoom<=ne)){Kr.zoom=ne;var tn=Kr.numPoints||1;lt+=Kr.x*tn,Ft+=Kr.y*tn,Kr.parentId=Ut,De&&(Bt||(Bt=this._map(Be,!0)),De(Bt,this._map(Kr)))}}Be.parentId=Ut,le.push($t(lt/Xe,Ft/Xe,Ut,Xe,Bt))}else if(le.push(Be),Xe>1)for(var Gr=0,Vr=ce;Gr<Vr.length;Gr+=1){var Nr=p.points[Vr[Gr]];Nr.zoom<=ne||(Nr.zoom=ne,le.push(Nr))}}}return le},qt.prototype._getOriginId=function(q){return q-this.points.length>>5},qt.prototype._getOriginZoom=function(q){return(q-this.points.length)%32},qt.prototype._map=function(q,ne){if(q.numPoints)return ne?Ln({},q.properties):q.properties;var le=this.points[q.index].properties,ye=this.options.map(le);return ne&&ye===le?Ln({},ye):ye},_t.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_t.prototype.splitTile=function(q,ne,le,ye,De,fe,be){for(var ae=[q,ne,le,ye],Be=this.options,p=Be.debug;ae.length;){ye=ae.pop(),le=ae.pop(),ne=ae.pop(),q=ae.pop();var ce=1<<ne,yt=Ct(ne,le,ye),Xe=this.tiles[yt];if(!Xe&&(p>1&&console.time("creation"),Xe=this.tiles[yt]=Nt(q,ne,le,ye,Be),this.tileCoords.push({z:ne,x:le,y:ye}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,le,ye,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var wt="z"+ne;this.stats[wt]=(this.stats[wt]||0)+1,this.total++}if(Xe.source=q,De){if(ne===Be.maxZoom||ne===De)continue;var St=1<<De-ne;if(le!==Math.floor(fe/St)||ye!==Math.floor(be/St))continue}else if(ne===Be.indexMaxZoom||Xe.numPoints<=Be.indexMaxPoints)continue;if(Xe.source=null,q.length!==0){p>1&&console.time("clipping");var Rt,lt,Ft,Bt,Ut,Dr,Kt=.5*Be.buffer/Be.extent,Kr=.5-Kt,tn=.5+Kt,Gr=1+Kt;Rt=lt=Ft=Bt=null,Ut=kt(q,ce,le-Kt,le+tn,0,Xe.minX,Xe.maxX,Be),Dr=kt(q,ce,le+Kr,le+Gr,0,Xe.minX,Xe.maxX,Be),q=null,Ut&&(Rt=kt(Ut,ce,ye-Kt,ye+tn,1,Xe.minY,Xe.maxY,Be),lt=kt(Ut,ce,ye+Kr,ye+Gr,1,Xe.minY,Xe.maxY,Be),Ut=null),Dr&&(Ft=kt(Dr,ce,ye-Kt,ye+tn,1,Xe.minY,Xe.maxY,Be),Bt=kt(Dr,ce,ye+Kr,ye+Gr,1,Xe.minY,Xe.maxY,Be),Dr=null),p>1&&console.timeEnd("clipping"),ae.push(Rt||[],ne+1,2*le,2*ye),ae.push(lt||[],ne+1,2*le,2*ye+1),ae.push(Ft||[],ne+1,2*le+1,2*ye),ae.push(Bt||[],ne+1,2*le+1,2*ye+1)}}},_t.prototype.getTile=function(q,ne,le){var ye=this.options,De=ye.extent,fe=ye.debug;if(q<0||q>24)return null;var be=1<<q,ae=Ct(q,ne=(ne%be+be)%be,le);if(this.tiles[ae])return It(this.tiles[ae],De);fe>1&&console.log("drilling down to z%d-%d-%d",q,ne,le);for(var Be,p=q,ce=ne,yt=le;!Be&&p>0;)p--,ce=Math.floor(ce/2),yt=Math.floor(yt/2),Be=this.tiles[Ct(p,ce,yt)];return Be&&Be.source?(fe>1&&console.log("found parent tile z%d-%d-%d",p,ce,yt),fe>1&&console.time("drilling down"),this.splitTile(Be.source,p,ce,yt,q,ne,le),fe>1&&console.timeEnd("drilling down"),this.tiles[ae]?It(this.tiles[ae],De):null):null};var We=function(q){function ne(le,ye,De,fe){q.call(this,le,ye,De,Ce),fe&&(this.loadGeoJSON=fe)}return q&&(ne.__proto__=q),(ne.prototype=Object.create(q&&q.prototype)).constructor=ne,ne.prototype.loadData=function(le,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ye,this._pendingLoadDataParams=le,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ne.prototype._loadData=function(){var le=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ye=this._pendingCallback,De=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var fe=!!(De&&De.request&&De.request.collectResourceTiming)&&new s.RequestPerformance(De.request);this.loadGeoJSON(De,function(be,ae){if(be||!ae)return ye(be);if(typeof ae!="object")return ye(new Error("Input data given to '"+De.source+"' is not a valid GeoJSON object."));(function Xe(wt,St){var Rt,lt=wt&&wt.type;if(lt==="FeatureCollection")for(Rt=0;Rt<wt.features.length;Rt++)Xe(wt.features[Rt],St);else if(lt==="GeometryCollection")for(Rt=0;Rt<wt.geometries.length;Rt++)Xe(wt.geometries[Rt],St);else if(lt==="Feature")Xe(wt.geometry,St);else if(lt==="Polygon")G(wt.coordinates,St);else if(lt==="MultiPolygon")for(Rt=0;Rt<wt.coordinates.length;Rt++)G(wt.coordinates[Rt],St);return wt})(ae,!0);try{if(De.filter){var Be=s.createExpression(De.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(function(Xe){return Xe.key+": "+Xe.message}).join(", "));var p=ae.features.filter(function(Xe){return Be.value.evaluate({zoom:0},Xe)});ae={type:"FeatureCollection",features:p}}le._geoJSONIndex=De.cluster?new qt(function(Xe){var wt=Xe.superclusterOptions,St=Xe.clusterProperties;if(!St||!wt)return wt;for(var Rt={},lt={},Ft={accumulated:null,zoom:0},Bt={properties:null},Ut=Object.keys(St),Dr=0,Kt=Ut;Dr<Kt.length;Dr+=1){var Kr=Kt[Dr],tn=St[Kr],Gr=tn[0],Vr=s.createExpression(tn[1]),Nr=s.createExpression(typeof Gr=="string"?[Gr,["accumulated"],["get",Kr]]:Gr);Rt[Kr]=Vr.value,lt[Kr]=Nr.value}return wt.map=function(fi){Bt.properties=fi;for(var Hr={},ur=0,Ie=Ut;ur<Ie.length;ur+=1){var jt=Ie[ur];Hr[jt]=Rt[jt].evaluate(Ft,Bt)}return Hr},wt.reduce=function(fi,Hr){Bt.properties=Hr;for(var ur=0,Ie=Ut;ur<Ie.length;ur+=1){var jt=Ie[ur];Ft.accumulated=fi[jt],fi[jt]=lt[jt].evaluate(Ft,Bt)}},wt}(De)).load(ae.features):function(Xe,wt){return new _t(Xe,wt)}(ae,De.geojsonVtOptions)}catch(Xe){return ye(Xe)}le.loaded={};var ce={};if(fe){var yt=fe.finish();yt&&(ce.resourceTiming={},ce.resourceTiming[De.source]=JSON.parse(JSON.stringify(yt)))}ye(null,ce)})}},ne.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ne.prototype.reloadTile=function(le,ye){var De=this.loaded;return De&&De[le.uid]?q.prototype.reloadTile.call(this,le,ye):this.loadTile(le,ye)},ne.prototype.loadGeoJSON=function(le,ye){if(le.request)s.getJSON(le.request,ye);else{if(typeof le.data!="string")return ye(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."));try{return ye(null,JSON.parse(le.data))}catch{return ye(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."))}}},ne.prototype.removeSource=function(le,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ye()},ne.prototype.getClusterExpansionZoom=function(le,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(De){ye(De)}},ne.prototype.getClusterChildren=function(le,ye){try{ye(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(De){ye(De)}},ne.prototype.getClusterLeaves=function(le,ye){try{ye(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(De){ye(De)}},ne}(k),at=function(q){var ne=this;this.self=q,this.actor=new s.Actor(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:k,geojson:We},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(le,ye){if(ne.workerSourceTypes[le])throw new Error('Worker source with name "'+le+'" already registered.');ne.workerSourceTypes[le]=ye},this.self.registerRTLTextPlugin=function(le){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=le.applyArabicShaping,s.plugin.processBidirectionalText=le.processBidirectionalText,s.plugin.processStyledBidirectionalText=le.processStyledBidirectionalText}};return at.prototype.setReferrer=function(q,ne){this.referrer=ne},at.prototype.setImages=function(q,ne,le){for(var ye in this.availableImages[q]=ne,this.workerSources[q]){var De=this.workerSources[q][ye];for(var fe in De)De[fe].availableImages=ne}le()},at.prototype.setLayers=function(q,ne,le){this.getLayerIndex(q).replace(ne),le()},at.prototype.updateLayers=function(q,ne,le){this.getLayerIndex(q).update(ne.layers,ne.removedIds),le()},at.prototype.loadTile=function(q,ne,le){this.getWorkerSource(q,ne.type,ne.source).loadTile(ne,le)},at.prototype.loadDEMTile=function(q,ne,le){this.getDEMWorkerSource(q,ne.source).loadTile(ne,le)},at.prototype.reloadTile=function(q,ne,le){this.getWorkerSource(q,ne.type,ne.source).reloadTile(ne,le)},at.prototype.abortTile=function(q,ne,le){this.getWorkerSource(q,ne.type,ne.source).abortTile(ne,le)},at.prototype.removeTile=function(q,ne,le){this.getWorkerSource(q,ne.type,ne.source).removeTile(ne,le)},at.prototype.removeDEMTile=function(q,ne){this.getDEMWorkerSource(q,ne.source).removeTile(ne)},at.prototype.removeSource=function(q,ne,le){if(this.workerSources[q]&&this.workerSources[q][ne.type]&&this.workerSources[q][ne.type][ne.source]){var ye=this.workerSources[q][ne.type][ne.source];delete this.workerSources[q][ne.type][ne.source],ye.removeSource!==void 0?ye.removeSource(ne,le):le()}},at.prototype.loadWorkerSource=function(q,ne,le){try{this.self.importScripts(ne.url),le()}catch(ye){le(ye.toString())}},at.prototype.syncRTLPluginState=function(q,ne,le){try{s.plugin.setState(ne);var ye=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);var De=s.plugin.isParsed();le(De?void 0:new Error("RTL Text Plugin failed to import scripts from "+ye),De)}}catch(fe){le(fe.toString())}},at.prototype.getAvailableImages=function(q){var ne=this.availableImages[q];return ne||(ne=[]),ne},at.prototype.getLayerIndex=function(q){var ne=this.layerIndexes[q];return ne||(ne=this.layerIndexes[q]=new y),ne},at.prototype.getWorkerSource=function(q,ne,le){var ye=this;return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][ne]||(this.workerSources[q][ne]={}),this.workerSources[q][ne][le]||(this.workerSources[q][ne][le]=new this.workerSourceTypes[ne]({send:function(De,fe,be){ye.actor.send(De,fe,be,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][ne][le]},at.prototype.getDEMWorkerSource=function(q,ne){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][ne]||(this.demWorkerSources[q][ne]=new J),this.demWorkerSources[q][ne]},at.prototype.enforceCacheSizeLimit=function(q,ne){s.enforceCacheSizeLimit(ne)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new at(self)),at}),o(["./shared"],function(s){var u=s.createCommonjsModule(function(c){function h(C){return!f(C)}function f(C){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,L,z=new Blob([""],{type:"text/javascript"}),W=URL.createObjectURL(z);try{L=new Worker(W),R=!0}catch{R=!1}return L&&L.terminate(),URL.revokeObjectURL(W),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var L=R.getContext("2d");if(!L)return!1;var z=L.getImageData(0,0,1,1);return z&&z.width===R.width}()?(g[P=C&&C.failIfMajorPerformanceCaveat]===void 0&&(g[P]=function(R){var L=function(W){var ee=document.createElement("canvas"),Z=Object.create(h.webGLContextAttributes);return Z.failIfMajorPerformanceCaveat=W,ee.probablySupportsContext?ee.probablySupportsContext("webgl",Z)||ee.probablySupportsContext("experimental-webgl",Z):ee.supportsContext?ee.supportsContext("webgl",Z)||ee.supportsContext("experimental-webgl",Z):ee.getContext("webgl",Z)||ee.getContext("experimental-webgl",Z)}(R);if(!L)return!1;var z=L.createShader(L.VERTEX_SHADER);return!(!z||L.isContextLost())&&(L.shaderSource(z,"void main() {}"),L.compileShader(z),L.getShaderParameter(z,L.COMPILE_STATUS)===!0)}(P)),g[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}c.exports?c.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=f);var g={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),d={create:function(c,h,f){var g=s.window.document.createElement(c);return h!==void 0&&(g.className=h),f&&f.appendChild(g),g},createNS:function(c,h){return s.window.document.createElementNS(c,h)}},y=s.window.document&&s.window.document.documentElement.style;function x(c){if(!y)return c[0];for(var h=0;h<c.length;h++)if(c[h]in y)return c[h];return c[0]}var E,S=x(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);d.disableDrag=function(){y&&S&&(E=y[S],y[S]="none")},d.enableDrag=function(){y&&S&&(y[S]=E)};var O=x(["transform","WebkitTransform"]);d.setTransform=function(c,h){c.style[O]=h};var k=!1;try{var U=Object.defineProperty({},"passive",{get:function(){k=!0}});s.window.addEventListener("test",U,U),s.window.removeEventListener("test",U,U)}catch{k=!1}d.addEventListener=function(c,h,f,g){g===void 0&&(g={}),c.addEventListener(h,f,"passive"in g&&k?g:g.capture)},d.removeEventListener=function(c,h,f,g){g===void 0&&(g={}),c.removeEventListener(h,f,"passive"in g&&k?g:g.capture)};var J=function(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",J,!0)};function G(c){var h=c.userImage;return!!(h&&h.render&&h.render())&&(c.data.replace(new Uint8Array(h.data.buffer)),!0)}d.suppressClick=function(){s.window.addEventListener("click",J,!0),s.window.setTimeout(function(){s.window.removeEventListener("click",J,!0)},0)},d.mousePos=function(c,h){var f=c.getBoundingClientRect();return new s.Point(h.clientX-f.left-c.clientLeft,h.clientY-f.top-c.clientTop)},d.touchPos=function(c,h){for(var f=c.getBoundingClientRect(),g=[],C=0;C<h.length;C++)g.push(new s.Point(h[C].clientX-f.left-c.clientLeft,h[C].clientY-f.top-c.clientTop));return g},d.mouseButton=function(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},d.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var H=function(c){function h(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var g=0,C=this.requestors;g<C.length;g+=1){var P=C[g];this._notify(P.ids,P.callback)}this.requestors=[]}},h.prototype.getImage=function(f){return this.images[f]},h.prototype.addImage=function(f,g){this._validate(f,g)&&(this.images[f]=g)},h.prototype._validate=function(f,g){var C=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),C=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),C=!1),this._validateContent(g.content,g)||(this.fire(new s.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),C=!1),C},h.prototype._validateStretch=function(f,g){if(!f)return!0;for(var C=0,P=0,R=f;P<R.length;P+=1){var L=R[P];if(L[0]<C||L[1]<L[0]||g<L[1])return!1;C=L[1]}return!0},h.prototype._validateContent=function(f,g){return!(f&&(f.length!==4||f[0]<0||g.data.width<f[0]||f[1]<0||g.data.height<f[1]||f[2]<0||g.data.width<f[2]||f[3]<0||g.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},h.prototype.updateImage=function(f,g){g.version=this.images[f].version+1,this.images[f]=g,this.updatedImages[f]=!0},h.prototype.removeImage=function(f){var g=this.images[f];delete this.images[f],delete this.patterns[f],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(f,g){var C=!0;if(!this.isLoaded())for(var P=0,R=f;P<R.length;P+=1)this.images[R[P]]||(C=!1);this.isLoaded()||C?this._notify(f,g):this.requestors.push({ids:f,callback:g})},h.prototype._notify=function(f,g){for(var C={},P=0,R=f;P<R.length;P+=1){var L=R[P];this.images[L]||this.fire(new s.Event("styleimagemissing",{id:L}));var z=this.images[L];z?C[L]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:!!(z.userImage&&z.userImage.render)}:s.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,C)},h.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},h.prototype.getPattern=function(f){var g=this.patterns[f],C=this.getImage(f);if(!C)return null;if(g&&g.position.version===C.version)return g.position;if(g)g.position.version=C.version;else{var P={w:C.data.width+2,h:C.data.height+2,x:0,y:0},R=new s.ImagePosition(P,C);this.patterns[f]={bin:P,position:R}}return this._updatePatternAtlas(),this.patterns[f].position},h.prototype.bind=function(f){var g=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(f,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var f=[];for(var g in this.patterns)f.push(this.patterns[g].bin);var C=s.potpack(f),P=C.w,R=C.h,L=this.atlasImage;for(var z in L.resize({width:P||1,height:R||1}),this.patterns){var W=this.patterns[z].bin,ee=W.x+1,Z=W.y+1,te=this.images[z].data,se=te.width,we=te.height;s.RGBAImage.copy(te,L,{x:0,y:0},{x:ee,y:Z},{width:se,height:we}),s.RGBAImage.copy(te,L,{x:0,y:we-1},{x:ee,y:Z-1},{width:se,height:1}),s.RGBAImage.copy(te,L,{x:0,y:0},{x:ee,y:Z+we},{width:se,height:1}),s.RGBAImage.copy(te,L,{x:se-1,y:0},{x:ee-1,y:Z},{width:1,height:we}),s.RGBAImage.copy(te,L,{x:0,y:0},{x:ee+se,y:Z},{width:1,height:we})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(f){for(var g=0,C=f;g<C.length;g+=1){var P=C[g];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var R=this.images[P];G(R)&&this.updateImage(P,R)}}},h}(s.Evented),K=oe,he=oe,Y=1e20;function oe(c,h,f,g,C,P){this.fontSize=c||24,this.buffer=h===void 0?3:h,this.cutoff=g||.25,this.fontFamily=C||"sans-serif",this.fontWeight=P||"normal",this.radius=f||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ee(c,h,f,g,C,P,R){for(var L=0;L<h;L++){for(var z=0;z<f;z++)g[z]=c[z*h+L];for(ze(g,C,P,R,f),z=0;z<f;z++)c[z*h+L]=C[z]}for(z=0;z<f;z++){for(L=0;L<h;L++)g[L]=c[z*h+L];for(ze(g,C,P,R,h),L=0;L<h;L++)c[z*h+L]=Math.sqrt(C[L])}}function ze(c,h,f,g,C){f[0]=0,g[0]=-Y,g[1]=+Y;for(var P=1,R=0;P<C;P++){for(var L=(c[P]+P*P-(c[f[R]]+f[R]*f[R]))/(2*P-2*f[R]);L<=g[R];)R--,L=(c[P]+P*P-(c[f[R]]+f[R]*f[R]))/(2*P-2*f[R]);f[++R]=P,g[R]=L,g[R+1]=+Y}for(P=0,R=0;P<C;P++){for(;g[R+1]<P;)R++;h[P]=(P-f[R])*(P-f[R])+c[f[R]]}}oe.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var C=h.data[4*g+3]/255;this.gridOuter[g]=C===1?0:C===0?Y:Math.pow(Math.max(0,.5-C),2),this.gridInner[g]=C===1?Y:C===0?0:Math.pow(Math.max(0,C-.5),2)}for(Ee(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ee(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)f[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return f},K.default=he;var de=function(c,h){this.requestManager=c,this.localIdeographFontFamily=h,this.entries={}};de.prototype.setURL=function(c){this.url=c},de.prototype.getGlyphs=function(c,h){var f=this,g=[];for(var C in c)for(var P=0,R=c[C];P<R.length;P+=1)g.push({stack:C,id:R[P]});s.asyncAll(g,function(L,z){var W=L.stack,ee=L.id,Z=f.entries[W];Z||(Z=f.entries[W]={glyphs:{},requests:{},ranges:{}});var te=Z.glyphs[ee];if(te===void 0){if(te=f._tinySDF(Z,W,ee))return Z.glyphs[ee]=te,void z(null,{stack:W,id:ee,glyph:te});var se=Math.floor(ee/256);if(256*se>65535)z(new Error("glyphs > 65535 not supported"));else if(Z.ranges[se])z(null,{stack:W,id:ee,glyph:te});else{var we=Z.requests[se];we||(we=Z.requests[se]=[],de.loadGlyphRange(W,se,f.url,f.requestManager,function(Fe,ge){if(ge){for(var Re in ge)f._doesCharSupportLocalGlyph(+Re)||(Z.glyphs[+Re]=ge[+Re]);Z.ranges[se]=!0}for(var Ve=0,$e=we;Ve<$e.length;Ve+=1)(0,$e[Ve])(Fe,ge);delete Z.requests[se]})),we.push(function(Fe,ge){Fe?z(Fe):ge&&z(null,{stack:W,id:ee,glyph:ge[ee]||null})})}}else z(null,{stack:W,id:ee,glyph:te})},function(L,z){if(L)h(L);else if(z){for(var W={},ee=0,Z=z;ee<Z.length;ee+=1){var te=Z[ee],se=te.stack,we=te.id,Fe=te.glyph;(W[se]||(W[se]={}))[we]=Fe&&{id:Fe.id,bitmap:Fe.bitmap.clone(),metrics:Fe.metrics}}h(null,W)}})},de.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](c)||s.isChar["Hangul Syllables"](c)||s.isChar.Hiragana(c)||s.isChar.Katakana(c))},de.prototype._tinySDF=function(c,h,f){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(f)){var C=c.tinySDF;if(!C){var P="400";/bold/i.test(h)?P="900":/medium/i.test(h)?P="500":/light/i.test(h)&&(P="200"),C=c.tinySDF=new de.TinySDF(24,3,8,.25,g,P)}return{id:f,bitmap:new s.AlphaImage({width:30,height:30},C.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},de.loadGlyphRange=function(c,h,f,g,C){var P=256*h,R=P+255,L=g.transformRequest(g.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",P+"-"+R),s.ResourceType.Glyphs);s.getArrayBuffer(L,function(z,W){if(z)C(z);else if(W){for(var ee={},Z=0,te=s.parseGlyphPBF(W);Z<te.length;Z+=1){var se=te[Z];ee[se.id]=se}C(null,ee)}})},de.TinySDF=K;var ve=function(){this.specification=s.styleSpec.light.position};ve.prototype.possiblyEvaluate=function(c,h){return s.sphericalToCartesian(c.expression.evaluate(h))},ve.prototype.interpolate=function(c,h,f){return{x:s.number(c.x,h.x,f),y:s.number(c.y,h.y,f),z:s.number(c.z,h.z,f)}};var Ae=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new ve,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),$=function(c){function h(f){c.call(this),this._transitionable=new s.Transitionable(Ae),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(f,g){if(g===void 0&&(g={}),!this._validate(s.validateLight,f,g))for(var C in f){var P=f[C];s.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),P):this._transitionable.setValue(C,P)}},h.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},h.prototype._validate=function(f,g,C){return(!C||C.validate!==!1)&&s.emitValidationErrors(this,f.call(s.validateStyle,s.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},h}(s.Evented),re=function(c,h){this.width=c,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};re.prototype.getDash=function(c,h){var f=c.join(",")+String(h);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,h)),this.dashEntry[f]},re.prototype.getDashRanges=function(c,h,f){var g=[],C=c.length%2==1?-c[c.length-1]*f:0,P=c[0]*f,R=!0;g.push({left:C,right:P,isDash:R,zeroLength:c[0]===0});for(var L=c[0],z=1;z<c.length;z++){var W=c[z];g.push({left:C=L*f,right:P=(L+=W)*f,isDash:R=!R,zeroLength:W===0})}return g},re.prototype.addRoundDash=function(c,h,f){for(var g=h/2,C=-f;C<=f;C++)for(var P=this.width*(this.nextRow+f+C),R=0,L=c[R],z=0;z<this.width;z++){z/L.right>1&&(L=c[++R]);var W=Math.abs(z-L.left),ee=Math.abs(z-L.right),Z=Math.min(W,ee),te=void 0,se=C/f*(g+1);if(L.isDash){var we=g-Math.abs(se);te=Math.sqrt(Z*Z+we*we)}else te=g-Math.sqrt(Z*Z+se*se);this.data[P+z]=Math.max(0,Math.min(255,te+128))}},re.prototype.addRegularDash=function(c){for(var h=c.length-1;h>=0;--h){var f=c[h],g=c[h+1];f.zeroLength?c.splice(h,1):g&&g.isDash===f.isDash&&(g.left=f.left,c.splice(h,1))}var C=c[0],P=c[c.length-1];C.isDash===P.isDash&&(C.left=P.left-this.width,P.right=C.right+this.width);for(var R=this.width*this.nextRow,L=0,z=c[L],W=0;W<this.width;W++){W/z.right>1&&(z=c[++L]);var ee=Math.abs(W-z.left),Z=Math.abs(W-z.right),te=Math.min(ee,Z);this.data[R+W]=Math.max(0,Math.min(255,(z.isDash?te:-te)+128))}},re.prototype.addDash=function(c,h){var f=h?7:0,g=2*f+1;if(this.nextRow+g>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var C=0,P=0;P<c.length;P++)C+=c[P];if(C!==0){var R=this.width/C,L=this.getDashRanges(c,this.width,R);h?this.addRoundDash(L,R,f):this.addRegularDash(L)}var z={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:C};return this.nextRow+=g,this.dirty=!0,z},re.prototype.bind=function(c){var h=c.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Te=function c(h,f){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var g=this.workerPool.acquire(this.id),C=0;C<g.length;C++){var P=new c.Actor(g[C],f,this.id);P.name="Worker "+C,this.actors.push(P)}};function Qe(c,h,f){var g=function(C,P){if(C)return f(C);if(P){var R=s.pick(s.extend(P,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(R.vectorLayers=P.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(L){return L.id})),R.tiles=h.canonicalizeTileset(R,c.url),f(null,R)}};return c.url?s.getJSON(h.transformRequest(h.normalizeSourceURL(c.url),s.ResourceType.Source),g):s.browser.frame(function(){return g(null,c)})}Te.prototype.broadcast=function(c,h,f){s.asyncAll(this.actors,function(g,C){g.send(c,h,C)},f=f||function(){})},Te.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Te.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Te.Actor=s.Actor;var me=function(c,h,f){this.bounds=s.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=f||24};me.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},me.prototype.contains=function(c){var h=Math.pow(2,c.z),f=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*h),g=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*h),C=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*h),P=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=f&&c.x<C&&c.y>=g&&c.y<P};var Le=function(c){function h(f,g,C,P){if(c.call(this),this.id=f,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(g,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qe(this._options,this.map._requestManager,function(g,C){f._tileJSONRequest=null,f._loaded=!0,g?f.fire(new s.ErrorEvent(g)):C&&(s.extend(f,C),C.bounds&&(f.tileBounds=new me(C.bounds,f.minzoom,f.maxzoom)),s.postTurnstileEvent(C.tiles,f.map._requestManager._customAccessToken),s.postMapLoadEvent(C.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(f){var g=this;return this.setSourceProperty(function(){g._options.tiles=f}),this},h.prototype.setUrl=function(f){var g=this;return this.setSourceProperty(function(){g.url=f,g._options.url=f}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return s.extend({},this._options)},h.prototype.loadTile=function(f,g){var C=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(C,s.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(L,z){return delete f.request,f.aborted?g(null):L&&L.status!==404?g(L):(z&&z.resourceTiming&&(f.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&f.setExpiryData(z),f.loadVectorData(z,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=g:f.request=f.actor.send("reloadTile",P,R.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",P,R.bind(this)))},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(s.Evented),Ue=function(c){function h(f,g,C,P){c.call(this),this.id=f,this.dispatcher=C,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},g),s.extend(this,s.pick(g,["url","scheme","tileSize"]))}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qe(this._options,this.map._requestManager,function(g,C){f._tileJSONRequest=null,f._loaded=!0,g?f.fire(new s.ErrorEvent(g)):C&&(s.extend(f,C),C.bounds&&(f.tileBounds=new me(C.bounds,f.minzoom,f.maxzoom)),s.postTurnstileEvent(C.tiles),s.postMapLoadEvent(C.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return s.extend({},this._options)},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.loadTile=function(f,g){var C=this,P=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=s.getImage(this.map._requestManager.transformRequest(P,s.ResourceType.Tile),function(R,L){if(delete f.request,f.aborted)f.state="unloaded",g(null);else if(R)f.state="errored",g(R);else if(L){C.map._refreshExpiredTiles&&f.setExpiryData(L),delete L.cacheControl,delete L.expires;var z=C.map.painter.context,W=z.gl;f.texture=C.map.painter.getTileTexture(L.width),f.texture?f.texture.update(L,{useMipmap:!0}):(f.texture=new s.Texture(z,L,W.RGBA,{useMipmap:!0}),f.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&W.texParameterf(W.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),f.state="loaded",s.cacheEntryPossiblyAdded(C.dispatcher),g(null)}})},h.prototype.abortTile=function(f,g){f.request&&(f.request.cancel(),delete f.request),g()},h.prototype.unloadTile=function(f,g){f.texture&&this.map.painter.saveTileTexture(f.texture),g()},h.prototype.hasTransition=function(){return!1},h}(s.Evented),Ye=function(c){function h(f,g,C,P){c.call(this,f,g,C,P),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(f,g){var C=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(R,L){R&&(f.state="errored",g(R)),L&&(f.dem=L,f.needsHillshadePrepare=!0,f.state="loaded",g(null))}f.request=s.getImage(this.map._requestManager.transformRequest(C,s.ResourceType.Tile),(function(R,L){if(delete f.request,f.aborted)f.state="unloaded",g(null);else if(R)f.state="errored",g(R);else if(L){this.map._refreshExpiredTiles&&f.setExpiryData(L),delete L.cacheControl,delete L.expires;var z=s.window.ImageBitmap&&L instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?L:s.browser.getImageData(L,1),W={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:z,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",W,P.bind(this)))}}).bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},h.prototype._getNeighboringTiles=function(f){var g=f.canonical,C=Math.pow(2,g.z),P=(g.x-1+C)%C,R=g.x===0?f.wrap-1:f.wrap,L=(g.x+1+C)%C,z=g.x+1===C?f.wrap+1:f.wrap,W={};return W[new s.OverscaledTileID(f.overscaledZ,R,g.z,P,g.y).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,z,g.z,L,g.y).key]={backfilled:!1},g.y>0&&(W[new s.OverscaledTileID(f.overscaledZ,R,g.z,P,g.y-1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,f.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,z,g.z,L,g.y-1).key]={backfilled:!1}),g.y+1<C&&(W[new s.OverscaledTileID(f.overscaledZ,R,g.z,P,g.y+1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,f.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},W[new s.OverscaledTileID(f.overscaledZ,z,g.z,L,g.y+1).key]={backfilled:!1}),W},h.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},h}(Ue),et=function(c){function h(f,g,C,P){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=C.getActor(),this.setEventedParent(P),this._data=g.data,this._options=s.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:s.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)f.fire(new s.ErrorEvent(g));else{var C={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(C.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new s.Event("data",C))}})},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setData=function(f){var g=this;return this._data=f,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(C){if(C)g.fire(new s.ErrorEvent(C));else{var P={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(P.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new s.Event("data",P))}}),this},h.prototype.getClusterExpansionZoom=function(f,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},g),this},h.prototype.getClusterChildren=function(f,g){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},g),this},h.prototype.getClusterLeaves=function(f,g,C,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:g,offset:C},P),this},h.prototype._updateWorkerData=function(f){var g=this;this._loaded=!1;var C=s.extend({},this.workerOptions),P=this._data;typeof P=="string"?(C.request=this.map._requestManager.transformRequest(s.browser.resolveURL(P),s.ResourceType.Source),C.request.collectResourceTiming=this._collectResourceTiming):C.data=JSON.stringify(P),this.actor.send(this.type+".loadData",C,function(R,L){g._removed||L&&L.abandoned||(g._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[g.id]&&(g._resourceTiming=L.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:C.source},null),f(R))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(f,g){var C=this,P=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(P,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,L){return delete f.request,f.unloadVectorData(),f.aborted?g(null):R?g(R):(f.loadVectorData(L,C.map.painter,P==="reloadTile"),g(null))})},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},h.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(s.Evented),tt=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ct=function(c){function h(f,g,C,P){c.call(this),this.id=f,this.dispatcher=C,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=g}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(f,g){var C=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),function(P,R){C._loaded=!0,P?C.fire(new s.ErrorEvent(P)):R&&(C.image=R,f&&(C.coordinates=f),g&&g(),C._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(f){var g=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){g.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setCoordinates=function(f){var g=this;this.coordinates=f;var C=f.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var L=1/0,z=1/0,W=-1/0,ee=-1/0,Z=0,te=R;Z<te.length;Z+=1){var se=te[Z];L=Math.min(L,se.x),z=Math.min(z,se.y),W=Math.max(W,se.x),ee=Math.max(ee,se.y)}var we=Math.max(W-L,ee-z),Fe=Math.max(0,Math.floor(-Math.log(we)/Math.LN2)),ge=Math.pow(2,Fe);return new s.CanonicalTileID(Fe,Math.floor((L+W)/2*ge),Math.floor((z+ee)/2*ge))}(C),this.minzoom=this.maxzoom=this.tileID.z;var P=C.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,g=f.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(f,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.loadTile=function(f,g){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},g(null)):(f.state="errored",g(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(s.Evented),mt=function(c){function h(f,g,C,P){c.call(this,f,g,C,P),this.roundZoom=!0,this.type="video",this.options=g}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1;var g=this.options;this.urls=[];for(var C=0,P=g.urls;C<P.length;C+=1)this.urls.push(this.map._requestManager.transformRequest(P[C],s.ResourceType.Source).url);s.getVideo(this.urls,function(R,L){f._loaded=!0,R?f.fire(new s.ErrorEvent(R)):L&&(f.video=L,f.video.loop=!0,f.video.setAttribute("playsinline",""),f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(f){if(this.video){var g=this.video.seekable;f<g.start(0)||f>g.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=f}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,g=f.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(f,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(ct),Tt=function(c){function h(f,g,C,P){c.call(this,f,g,C,P),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(L){return typeof L!="number"})})||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,C=g.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(g,this.canvas,C.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[P];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var f=0,g=[this.canvas.width,this.canvas.height];f<g.length;f+=1){var C=g[f];if(isNaN(C)||C<=0)return!0}return!1},h}(ct),nt={vector:Le,raster:Ue,"raster-dem":Ye,geojson:et,video:mt,image:ct,canvas:Tt};function lr(c,h){var f=s.identity([]);return s.translate(f,f,[1,1,0]),s.scale(f,f,[.5*c.width,.5*c.height,1]),s.multiply(f,f,c.calculatePosMatrix(h.toUnwrapped()))}function qt(c,h,f,g,C,P){var R=function(Fe,ge,Re){if(Fe)for(var Ve=0,$e=Fe;Ve<$e.length;Ve+=1){var rt=ge[$e[Ve]];if(rt&&rt.source===Re&&rt.type==="fill-extrusion")return!0}else for(var Je in ge){var Ze=ge[Je];if(Ze.source===Re&&Ze.type==="fill-extrusion")return!0}return!1}(C&&C.layers,h,c.id),L=P.maxPitchScaleFactor(),z=c.tilesIn(g,L,R);z.sort($t);for(var W=[],ee=0,Z=z;ee<Z.length;ee+=1){var te=Z[ee];W.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(h,f,c._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,C,P,L,lr(c.transform,te.tileID))})}var se=function(Fe){for(var ge={},Re={},Ve=0,$e=Fe;Ve<$e.length;Ve+=1){var rt=$e[Ve],Je=rt.queryResults,Ze=rt.wrappedTileID,ft=Re[Ze]=Re[Ze]||{};for(var Pt in Je)for(var bt=Je[Pt],Lt=ft[Pt]=ft[Pt]||{},tr=ge[Pt]=ge[Pt]||[],br=0,Tr=bt;br<Tr.length;br+=1){var gn=Tr[br];Lt[gn.featureIndex]||(Lt[gn.featureIndex]=!0,tr.push(gn))}}return ge}(W);for(var we in se)se[we].forEach(function(Fe){var ge=Fe.feature,Re=c.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Re});return se}function $t(c,h){var f=c.tileID,g=h.tileID;return f.overscaledZ-g.overscaledZ||f.canonical.y-g.canonical.y||f.wrap-g.wrap||f.canonical.x-g.canonical.x}var Ot=function(c,h){this.max=c,this.onRemove=h,this.reset()};Ot.prototype.reset=function(){for(var c in this.data)for(var h=0,f=this.data[c];h<f.length;h+=1){var g=f[h];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},Ot.prototype.add=function(c,h,f){var g=this,C=c.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);var P={value:h,timeout:void 0};if(f!==void 0&&(P.timeout=setTimeout(function(){g.remove(c,P)},f)),this.data[C].push(P),this.order.push(C),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Ot.prototype.has=function(c){return c.wrapped().key in this.data},Ot.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},Ot.prototype._getAndRemoveByKey=function(c){var h=this.data[c].shift();return h.timeout&&clearTimeout(h.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),h.value},Ot.prototype.getByKey=function(c){var h=this.data[c];return h?h[0].value:null},Ot.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},Ot.prototype.remove=function(c,h){if(!this.has(c))return this;var f=c.wrapped().key,g=h===void 0?0:this.data[f].indexOf(h),C=this.data[f][g];return this.data[f].splice(g,1),C.timeout&&clearTimeout(C.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(C.value),this.order.splice(this.order.indexOf(f),1),this},Ot.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},Ot.prototype.filter=function(c){var h=[];for(var f in this.data)for(var g=0,C=this.data[f];g<C.length;g+=1){var P=C[g];c(P.value)||h.push(P)}for(var R=0,L=h;R<L.length;R+=1){var z=L[R];this.remove(z.value.tileID,z)}};var fr=function(c,h,f){this.context=c;var g=c.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};fr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},fr.prototype.updateData=function(c){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},fr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var rn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Er=function(c,h,f,g){this.length=h.length,this.attributes=f,this.itemSize=h.bytesPerElement,this.dynamicDraw=g,this.context=c;var C=c.gl;this.buffer=C.createBuffer(),c.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Er.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Er.prototype.updateData=function(c){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)},Er.prototype.enableAttributes=function(c,h){for(var f=0;f<this.attributes.length;f++){var g=h.attributes[this.attributes[f].name];g!==void 0&&c.enableVertexAttribArray(g)}},Er.prototype.setVertexAttribPointers=function(c,h,f){for(var g=0;g<this.attributes.length;g++){var C=this.attributes[g],P=h.attributes[C.name];P!==void 0&&c.vertexAttribPointer(P,C.components,c[rn[C.type]],!1,this.itemSize,C.offset+this.itemSize*(f||0))}},Er.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mr=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mr.prototype.get=function(){return this.current},mr.prototype.set=function(c){},mr.prototype.getDefault=function(){return this.default},mr.prototype.setDefault=function(){this.set(this.default)};var Ln=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return s.Color.transparent},h.prototype.set=function(f){var g=this.current;(f.r!==g.r||f.g!==g.g||f.b!==g.b||f.a!==g.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(mr),dr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},h}(mr),Ar=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},h}(mr),nn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||f[3]!==g[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(mr),Ir=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},h}(mr),ei=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},h}(mr),jn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(f){var g=this.current;(f.func!==g.func||f.ref!==g.ref||f.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},h}(mr),fn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},h.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},h}(mr),Jn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=f,this.dirty=!1}},h}(mr),Nn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},h}(mr),bn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=f,this.dirty=!1}},h}(mr),$n=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},h}(mr),kt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.BLEND):g.disable(g.BLEND),this.current=f,this.dirty=!1}},h}(mr),hr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},h.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},h}(mr),Br=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return s.Color.transparent},h.prototype.set=function(f){var g=this.current;(f.r!==g.r||f.g!==g.g||f.b!==g.b||f.a!==g.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(mr),Zr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},h}(mr),ui=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=f,this.dirty=!1}},h}(mr),Me=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},h}(mr),Dt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},h}(mr),Gt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},h}(mr),sr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},h}(mr),qe=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},h.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||f[3]!==g[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(mr),It=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},h}(mr),pe=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(mr),Nt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,f),this.current=f,this.dirty=!1}},h}(mr),xt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},h}(mr),j=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},h}(mr),_t=function(c){function h(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},h}(mr),Ct=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},h}(mr),Ce=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},h}(mr),We=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},h}(mr),at=function(c){function h(f,g){c.call(this,f),this.context=f,this.parent=g}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(mr),q=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},h}(at),ne=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(at),le=function(c,h,f,g){this.context=c,this.width=h,this.height=f;var C=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new q(c,C),g&&(this.depthAttachment=new ne(c,C))};le.prototype.destroy=function(){var c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var ye=function(c,h,f){this.func=c,this.mask=h,this.range=f};ye.ReadOnly=!1,ye.ReadWrite=!0,ye.disabled=new ye(519,ye.ReadOnly,[0,1]);var De=function(c,h,f,g,C,P){this.test=c,this.ref=h,this.mask=f,this.fail=g,this.depthFail=C,this.pass=P};De.disabled=new De({func:519,mask:0},0,0,7680,7680,7680);var fe=function(c,h,f){this.blendFunction=c,this.blendColor=h,this.mask=f};fe.disabled=new fe(fe.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),fe.unblended=new fe(fe.Replace,s.Color.transparent,[!0,!0,!0,!0]),fe.alphaBlended=new fe([1,771],s.Color.transparent,[!0,!0,!0,!0]);var be=function(c,h,f){this.enable=c,this.mode=h,this.frontFace=f};be.disabled=new be(!1,1029,2305),be.backCCW=new be(!0,1029,2305);var ae=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ln(this),this.clearDepth=new dr(this),this.clearStencil=new Ar(this),this.colorMask=new nn(this),this.depthMask=new Ir(this),this.stencilMask=new ei(this),this.stencilFunc=new jn(this),this.stencilOp=new fn(this),this.stencilTest=new Jn(this),this.depthRange=new Nn(this),this.depthTest=new bn(this),this.depthFunc=new $n(this),this.blend=new kt(this),this.blendFunc=new hr(this),this.blendColor=new Br(this),this.blendEquation=new Zr(this),this.cullFace=new ui(this),this.cullFaceSide=new Me(this),this.frontFace=new Dt(this),this.program=new Gt(this),this.activeTexture=new sr(this),this.viewport=new qe(this),this.bindFramebuffer=new It(this),this.bindRenderbuffer=new pe(this),this.bindTexture=new Nt(this),this.bindVertexBuffer=new xt(this),this.bindElementBuffer=new j(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _t(this),this.pixelStoreUnpack=new Ct(this),this.pixelStoreUnpackPremultiplyAlpha=new Ce(this),this.pixelStoreUnpackFlipY=new We(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};ae.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ae.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ae.prototype.createIndexBuffer=function(c,h){return new fr(this,c,h)},ae.prototype.createVertexBuffer=function(c,h,f){return new Er(this,c,h,f)},ae.prototype.createRenderbuffer=function(c,h,f){var g=this.gl,C=g.createRenderbuffer();return this.bindRenderbuffer.set(C),g.renderbufferStorage(g.RENDERBUFFER,c,h,f),this.bindRenderbuffer.set(null),C},ae.prototype.createFramebuffer=function(c,h,f){return new le(this,c,h,f)},ae.prototype.clear=function(c){var h=c.color,f=c.depth,g=this.gl,C=0;h&&(C|=g.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(C|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g.clear(C)},ae.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},ae.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},ae.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},ae.prototype.setColorMode=function(c){s.deepEqual(c.blendFunction,fe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},ae.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Be=function(c){function h(f,g,C){var P=this;c.call(this),this.id=f,this.dispatcher=C,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=function(R,L,z,W){var ee=new nt[L.type](R,L,z,W);if(ee.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+ee.id);return s.bindAll(["load","abort","unload","serialize","prepare"],ee),ee}(f,g,C,this),this._tiles={},this._cache=new Ot(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},h.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var g=this._tiles[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(f,g){return this._source.loadTile(f,g)},h.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},h.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(f){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var C=this._tiles[g];C.upload(f),C.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return s.values(this._tiles).map(function(f){return f.tileID}).sort(p).map(function(f){return f.key})},h.prototype.getRenderableIds=function(f){var g=this,C=[];for(var P in this._tiles)this._isIdRenderable(P,f)&&C.push(this._tiles[P]);return f?C.sort(function(R,L){var z=R.tileID,W=L.tileID,ee=new s.Point(z.canonical.x,z.canonical.y)._rotate(g.transform.angle),Z=new s.Point(W.canonical.x,W.canonical.y)._rotate(g.transform.angle);return z.overscaledZ-W.overscaledZ||Z.y-ee.y||Z.x-ee.x}).map(function(R){return R.tileID.key}):C.map(function(R){return R.tileID}).sort(p).map(function(R){return R.key})},h.prototype.hasRenderableParent=function(f){var g=this.findLoadedParent(f,0);return!!g&&this._isIdRenderable(g.tileID.key)},h.prototype._isIdRenderable=function(f,g){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(g||!this._tiles[f].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},h.prototype._reloadTile=function(f,g){var C=this._tiles[f];C&&(C.state!=="loading"&&(C.state=g),this._loadTile(C,this._tileLoaded.bind(this,C,f,g)))},h.prototype._tileLoaded=function(f,g,C,P){if(P)return f.state="errored",void(P.status!==404?this._source.fire(new s.ErrorEvent(P,{tile:f})):this.update(this.transform));f.timeAdded=s.browser.now(),C==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(g,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},h.prototype._backfillDEM=function(f){for(var g=this.getRenderableIds(),C=0;C<g.length;C++){var P=g[C];if(f.neighboringTiles&&f.neighboringTiles[P]){var R=this.getTileByID(P);L(f,R),L(R,f)}}function L(z,W){z.needsHillshadePrepare=!0;var ee=W.tileID.canonical.x-z.tileID.canonical.x,Z=W.tileID.canonical.y-z.tileID.canonical.y,te=Math.pow(2,z.tileID.canonical.z),se=W.tileID.key;ee===0&&Z===0||Math.abs(Z)>1||(Math.abs(ee)>1&&(Math.abs(ee+te)===1?ee+=te:Math.abs(ee-te)===1&&(ee-=te)),W.dem&&z.dem&&(z.dem.backfillBorder(W.dem,ee,Z),z.neighboringTiles&&z.neighboringTiles[se]&&(z.neighboringTiles[se].backfilled=!0)))}},h.prototype.getTile=function(f){return this.getTileByID(f.key)},h.prototype.getTileByID=function(f){return this._tiles[f]},h.prototype._retainLoadedChildren=function(f,g,C,P){for(var R in this._tiles){var L=this._tiles[R];if(!(P[R]||!L.hasData()||L.tileID.overscaledZ<=g||L.tileID.overscaledZ>C)){for(var z=L.tileID;L&&L.tileID.overscaledZ>g+1;){var W=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[W.key])&&L.hasData()&&(z=W)}for(var ee=z;ee.overscaledZ>g;)if(f[(ee=ee.scaledTo(ee.overscaledZ-1)).key]){P[z.key]=z;break}}}},h.prototype.findLoadedParent=function(f,g){if(f.key in this._loadedParentTiles){var C=this._loadedParentTiles[f.key];return C&&C.tileID.overscaledZ>=g?C:null}for(var P=f.overscaledZ-1;P>=g;P--){var R=f.scaledTo(P),L=this._getLoadedTile(R);if(L)return L}},h.prototype._getLoadedTile=function(f){var g=this._tiles[f.key];return g&&g.hasData()?g:this._cache.getByKey(f.wrapped().key)},h.prototype.updateCacheSize=function(f){var g=Math.ceil(f.width/this._source.tileSize)+1,C=Math.ceil(f.height/this._source.tileSize)+1,P=Math.floor(g*C*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(R)},h.prototype.handleWrapJump=function(f){var g=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,g){var C={};for(var P in this._tiles){var R=this._tiles[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),C[R.tileID.key]=R}for(var L in this._tiles=C,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},h.prototype.update=function(f){var g=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var C;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?C=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ft){return new s.OverscaledTileID(ft.canonical.z,ft.wrap,ft.canonical.z,ft.canonical.x,ft.canonical.y)}):(C=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(C=C.filter(function(ft){return g._source.hasTile(ft)}))):C=[];var P=f.coveringZoomLevel(this._source),R=Math.max(P-h.maxOverzooming,this._source.minzoom),L=Math.max(P+h.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(C,P);if(ce(this._source.type)){for(var W={},ee={},Z=0,te=Object.keys(z);Z<te.length;Z+=1){var se=te[Z],we=z[se],Fe=this._tiles[se];if(Fe&&!(Fe.fadeEndTime&&Fe.fadeEndTime<=s.browser.now())){var ge=this.findLoadedParent(we,R);ge&&(this._addTile(ge.tileID),W[ge.tileID.key]=ge.tileID),ee[se]=we}}for(var Re in this._retainLoadedChildren(ee,P,L,z),W)z[Re]||(this._coveredTiles[Re]=!0,z[Re]=W[Re])}for(var Ve in z)this._tiles[Ve].clearFadeHold();for(var $e=0,rt=s.keysDifference(this._tiles,z);$e<rt.length;$e+=1){var Je=rt[$e],Ze=this._tiles[Je];Ze.hasSymbolBuckets&&!Ze.holdingForFade()?Ze.setHoldDuration(this.map._fadeDuration):Ze.hasSymbolBuckets&&!Ze.symbolFadeFinished()||this._removeTile(Je)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},h.prototype._updateRetainedTiles=function(f,g){for(var C={},P={},R=Math.max(g-h.maxOverzooming,this._source.minzoom),L=Math.max(g+h.maxUnderzooming,this._source.minzoom),z={},W=0,ee=f;W<ee.length;W+=1){var Z=ee[W],te=this._addTile(Z);C[Z.key]=Z,te.hasData()||g<this._source.maxzoom&&(z[Z.key]=Z)}this._retainLoadedChildren(z,g,L,C);for(var se=0,we=f;se<we.length;se+=1){var Fe=we[se],ge=this._tiles[Fe.key];if(!ge.hasData()){if(g+1>this._source.maxzoom){var Re=Fe.children(this._source.maxzoom)[0],Ve=this.getTile(Re);if(Ve&&Ve.hasData()){C[Re.key]=Re;continue}}else{var $e=Fe.children(this._source.maxzoom);if(C[$e[0].key]&&C[$e[1].key]&&C[$e[2].key]&&C[$e[3].key])continue}for(var rt=ge.wasRequested(),Je=Fe.overscaledZ-1;Je>=R;--Je){var Ze=Fe.scaledTo(Je);if(P[Ze.key]||(P[Ze.key]=!0,!(ge=this.getTile(Ze))&&rt&&(ge=this._addTile(Ze)),ge&&(C[Ze.key]=Ze,rt=ge.wasRequested(),ge.hasData())))break}}}return C},h.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var g=[],C=void 0,P=this._tiles[f].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){C=this._loadedParentTiles[P.key];break}g.push(P.key);var R=P.scaledTo(P.overscaledZ-1);if(C=this._getLoadedTile(R))break;P=R}for(var L=0,z=g;L<z.length;L+=1)this._loadedParentTiles[z[L]]=C}},h.prototype._addTile=function(f){var g=this._tiles[f.key];if(g)return g;(g=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,g),g.tileID=f,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,g)));var C=!!g;return C||(g=new s.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,f.key,g.state))),g?(g.uses++,this._tiles[f.key]=g,C||this._source.fire(new s.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},h.prototype._setTileReloadTimer=function(f,g){var C=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var P=g.getExpiryTimeout();P&&(this._timers[f]=setTimeout(function(){C._reloadTile(f,"expired"),delete C._timers[f]},P))},h.prototype._removeTile=function(f){var g=this._tiles[f];g&&(g.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},h.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},h.prototype.tilesIn=function(f,g,C){var P=this,R=[],L=this.transform;if(!L)return R;for(var z=C?L.getCameraQueryGeometry(f):f,W=f.map(function(Je){return L.pointCoordinate(Je)}),ee=z.map(function(Je){return L.pointCoordinate(Je)}),Z=this.getIds(),te=1/0,se=1/0,we=-1/0,Fe=-1/0,ge=0,Re=ee;ge<Re.length;ge+=1){var Ve=Re[ge];te=Math.min(te,Ve.x),se=Math.min(se,Ve.y),we=Math.max(we,Ve.x),Fe=Math.max(Fe,Ve.y)}for(var $e=function(Je){var Ze=P._tiles[Z[Je]];if(!Ze.holdingForFade()){var ft=Ze.tileID,Pt=Math.pow(2,L.zoom-Ze.tileID.overscaledZ),bt=g*Ze.queryPadding*s.EXTENT/Ze.tileSize/Pt,Lt=[ft.getTilePoint(new s.MercatorCoordinate(te,se)),ft.getTilePoint(new s.MercatorCoordinate(we,Fe))];if(Lt[0].x-bt<s.EXTENT&&Lt[0].y-bt<s.EXTENT&&Lt[1].x+bt>=0&&Lt[1].y+bt>=0){var tr=W.map(function(Tr){return ft.getTilePoint(Tr)}),br=ee.map(function(Tr){return ft.getTilePoint(Tr)});R.push({tile:Ze,tileID:ft,queryGeometry:tr,cameraQueryGeometry:br,scale:Pt})}}},rt=0;rt<Z.length;rt++)$e(rt);return R},h.prototype.getVisibleCoordinates=function(f){for(var g=this,C=this.getRenderableIds(f).map(function(z){return g._tiles[z].tileID}),P=0,R=C;P<R.length;P+=1){var L=R[P];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return C},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ce(this._source.type))for(var f in this._tiles){var g=this._tiles[f];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=s.browser.now())return!0}return!1},h.prototype.setFeatureState=function(f,g,C){this._state.updateState(f=f||"_geojsonTileLayer",g,C)},h.prototype.removeFeatureState=function(f,g,C){this._state.removeFeatureState(f=f||"_geojsonTileLayer",g,C)},h.prototype.getFeatureState=function(f,g){return this._state.getState(f=f||"_geojsonTileLayer",g)},h.prototype.setDependencies=function(f,g,C){var P=this._tiles[f];P&&P.setDependencies(g,C)},h.prototype.reloadTilesForDependencies=function(f,g){for(var C in this._tiles)this._tiles[C].hasDependency(f,g)&&this._reloadTile(C,"reloading");this._cache.filter(function(P){return!P.hasDependency(f,g)})},h}(s.Evented);function p(c,h){var f=Math.abs(2*c.wrap)-+(c.wrap<0),g=Math.abs(2*h.wrap)-+(h.wrap<0);return c.overscaledZ-h.overscaledZ||g-f||h.canonical.y-c.canonical.y||h.canonical.x-c.canonical.x}function ce(c){return c==="raster"||c==="image"||c==="video"}function yt(){return new s.window.Worker(D.workerUrl)}Be.maxOverzooming=10,Be.maxUnderzooming=3;var Xe="mapboxgl_preloaded_worker_pool",wt=function(){this.active={}};wt.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new yt);return this.active[c]=!0,this.workers.slice()},wt.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},wt.prototype.isPreloaded=function(){return!!this.active[Xe]},wt.prototype.numActive=function(){return Object.keys(this.active).length};var St,Rt=Math.floor(s.browser.hardwareConcurrency/2);function lt(){return St||(St=new wt),St}function Ft(c,h){var f={};for(var g in c)g!=="ref"&&(f[g]=c[g]);return s.refProperties.forEach(function(C){C in h&&(f[C]=h[C])}),f}function Bt(c){c=c.slice();for(var h=Object.create(null),f=0;f<c.length;f++)h[c[f].id]=c[f];for(var g=0;g<c.length;g++)"ref"in c[g]&&(c[g]=Ft(c[g],h[c[g].ref]));return c}wt.workerCount=Math.max(Math.min(Rt,6),1);var Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Dr(c,h,f){f.push({command:Ut.addSource,args:[c,h[c]]})}function Kt(c,h,f){h.push({command:Ut.removeSource,args:[c]}),f[c]=!0}function Kr(c,h,f,g){Kt(c,f,g),Dr(c,h,f)}function tn(c,h,f){var g;for(g in c[f])if(c[f].hasOwnProperty(g)&&g!=="data"&&!s.deepEqual(c[f][g],h[f][g]))return!1;for(g in h[f])if(h[f].hasOwnProperty(g)&&g!=="data"&&!s.deepEqual(c[f][g],h[f][g]))return!1;return!0}function Gr(c,h,f,g,C,P){var R;for(R in h=h||{},c=c||{})c.hasOwnProperty(R)&&(s.deepEqual(c[R],h[R])||f.push({command:P,args:[g,R,h[R],C]}));for(R in h)h.hasOwnProperty(R)&&!c.hasOwnProperty(R)&&(s.deepEqual(c[R],h[R])||f.push({command:P,args:[g,R,h[R],C]}))}function Vr(c){return c.id}function Nr(c,h){return c[h.id]=h,c}var fi=function(c,h){this.reset(c,h)};fi.prototype.reset=function(c,h){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},fi.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=s.clamp(c,0,1);for(var h=1,f=this._distances[h],g=c*this.paddedLength+this.padding;f<g&&h<this._distances.length;)f=this._distances[++h];var C=h-1,P=this._distances[C],R=f-P,L=R>0?(g-P)/R:0;return this.points[C].mult(1-L).add(this.points[h].mult(L))};var Hr=function(c,h,f){var g=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(h/f);for(var P=0;P<this.xCellCount*this.yCellCount;P++)g.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function ur(c,h,f,g,C){var P=s.create();return h?(s.scale(P,P,[1/C,1/C,1]),f||s.rotateZ(P,P,g.angle)):s.multiply(P,g.labelPlaneMatrix,c),P}function Ie(c,h,f,g,C){if(h){var P=s.clone(c);return s.scale(P,P,[C,C,1]),f||s.rotateZ(P,P,-g.angle),P}return g.glCoordMatrix}function jt(c,h){var f=[c.x,c.y,0,1];ri(f,f,h);var g=f[3];return{point:new s.Point(f[0]/g,f[1]/g),signedDistanceFromCamera:g}}function qr(c,h){return .5+c/h*.5}function Ni(c,h){var f=c[0]/c[3],g=c[1]/c[3];return f>=-h[0]&&f<=h[0]&&g>=-h[1]&&g<=h[1]}function ia(c,h,f,g,C,P,R,L){var z=g?c.textSizeData:c.iconSizeData,W=s.evaluateSizeForZoom(z,f.transform.zoom),ee=[256/f.width*2+1,256/f.height*2+1],Z=g?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Z.clear();for(var te=c.lineVertexArray,se=g?c.text.placedSymbolArray:c.icon.placedSymbolArray,we=f.transform.width/f.transform.height,Fe=!1,ge=0;ge<se.length;ge++){var Re=se.get(ge);if(Re.hidden||Re.writingMode===s.WritingMode.vertical&&!Fe)Bi(Re.numGlyphs,Z);else{Fe=!1;var Ve=[Re.anchorX,Re.anchorY,0,1];if(s.transformMat4(Ve,Ve,h),Ni(Ve,ee)){var $e=qr(f.transform.cameraToCenterDistance,Ve[3]),rt=s.evaluateSizeForFeature(z,W,Re),Je=R?rt/$e:rt*$e,Ze=new s.Point(Re.anchorX,Re.anchorY),ft=jt(Ze,C).point,Pt={},bt=Se(Re,Je,!1,L,h,C,P,c.glyphOffsetArray,te,Z,ft,Ze,Pt,we);Fe=bt.useVertical,(bt.notEnoughRoom||Fe||bt.needsFlipping&&Se(Re,Je,!0,L,h,C,P,c.glyphOffsetArray,te,Z,ft,Ze,Pt,we).notEnoughRoom)&&Bi(Re.numGlyphs,Z)}else Bi(Re.numGlyphs,Z)}}g?c.text.dynamicLayoutVertexBuffer.updateData(Z):c.icon.dynamicLayoutVertexBuffer.updateData(Z)}function ti(c,h,f,g,C,P,R,L,z,W,ee){var Z=L.glyphStartIndex+L.numGlyphs,te=L.lineStartIndex,se=L.lineStartIndex+L.lineLength,we=h.getoffsetX(L.glyphStartIndex),Fe=h.getoffsetX(Z-1),ge=Un(c*we,f,g,C,P,R,L.segment,te,se,z,W,ee);if(!ge)return null;var Re=Un(c*Fe,f,g,C,P,R,L.segment,te,se,z,W,ee);return Re?{first:ge,last:Re}:null}function kn(c,h,f,g){return c===s.WritingMode.horizontal&&Math.abs(f.y-h.y)>Math.abs(f.x-h.x)*g?{useVertical:!0}:(c===s.WritingMode.vertical?h.y<f.y:h.x>f.x)?{needsFlipping:!0}:null}function Se(c,h,f,g,C,P,R,L,z,W,ee,Z,te,se){var we,Fe=h/24,ge=c.lineOffsetX*Fe,Re=c.lineOffsetY*Fe;if(c.numGlyphs>1){var Ve=c.glyphStartIndex+c.numGlyphs,$e=c.lineStartIndex,rt=c.lineStartIndex+c.lineLength,Je=ti(Fe,L,ge,Re,f,ee,Z,c,z,P,te);if(!Je)return{notEnoughRoom:!0};var Ze=jt(Je.first.point,R).point,ft=jt(Je.last.point,R).point;if(g&&!f){var Pt=kn(c.writingMode,Ze,ft,se);if(Pt)return Pt}we=[Je.first];for(var bt=c.glyphStartIndex+1;bt<Ve-1;bt++)we.push(Un(Fe*L.getoffsetX(bt),ge,Re,f,ee,Z,c.segment,$e,rt,z,P,te));we.push(Je.last)}else{if(g&&!f){var Lt=jt(Z,C).point,tr=c.lineStartIndex+c.segment+1,br=new s.Point(z.getx(tr),z.gety(tr)),Tr=jt(br,C),gn=Tr.signedDistanceFromCamera>0?Tr.point:Po(Z,br,Lt,1,C),nr=kn(c.writingMode,Lt,gn,se);if(nr)return nr}var zr=Un(Fe*L.getoffsetX(c.glyphStartIndex),ge,Re,f,ee,Z,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,z,P,te);if(!zr)return{notEnoughRoom:!0};we=[zr]}for(var Yr=0,Ur=we;Yr<Ur.length;Yr+=1){var Lr=Ur[Yr];s.addDynamicAttributes(W,Lr.point,Lr.angle)}return{}}function Po(c,h,f,g,C){var P=jt(c.add(c.sub(h)._unit()),C).point,R=f.sub(P);return f.add(R._mult(g/R.mag()))}function Un(c,h,f,g,C,P,R,L,z,W,ee,Z){var te=g?c-h:c+h,se=te>0?1:-1,we=0;g&&(se*=-1,we=Math.PI),se<0&&(we+=Math.PI);for(var Fe=se>0?L+R:L+R+1,ge=C,Re=C,Ve=0,$e=0,rt=Math.abs(te),Je=[];Ve+$e<=rt;){if((Fe+=se)<L||Fe>=z)return null;if(Re=ge,Je.push(ge),(ge=Z[Fe])===void 0){var Ze=new s.Point(W.getx(Fe),W.gety(Fe)),ft=jt(Ze,ee);if(ft.signedDistanceFromCamera>0)ge=Z[Fe]=ft.point;else{var Pt=Fe-se;ge=Po(Ve===0?P:new s.Point(W.getx(Pt),W.gety(Pt)),Ze,Re,rt-Ve+1,ee)}}Ve+=$e,$e=Re.dist(ge)}var bt=(rt-Ve)/$e,Lt=ge.sub(Re),tr=Lt.mult(bt)._add(Re);tr._add(Lt._unit()._perp()._mult(f*se));var br=we+Math.atan2(ge.y-Re.y,ge.x-Re.x);return Je.push(tr),{point:tr,angle:br,path:Je}}Hr.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Hr.prototype.insert=function(c,h,f,g,C){this._forEachCell(h,f,g,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(C)},Hr.prototype.insertCircle=function(c,h,f,g){this._forEachCell(h-g,f-g,h+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(f),this.circles.push(g)},Hr.prototype._insertBoxCell=function(c,h,f,g,C,P){this.boxCells[C].push(P)},Hr.prototype._insertCircleCell=function(c,h,f,g,C,P){this.circleCells[C].push(P)},Hr.prototype._query=function(c,h,f,g,C,P){if(f<0||c>this.width||g<0||h>this.height)return!C&&[];var R=[];if(c<=0&&h<=0&&this.width<=f&&this.height<=g){if(C)return!0;for(var L=0;L<this.boxKeys.length;L++)R.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var z=0;z<this.circleKeys.length;z++){var W=this.circles[3*z],ee=this.circles[3*z+1],Z=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:W-Z,y1:ee-Z,x2:W+Z,y2:ee+Z})}return P?R.filter(P):R}return this._forEachCell(c,h,f,g,this._queryCell,R,{hitTest:C,seenUids:{box:{},circle:{}}},P),C?R.length>0:R},Hr.prototype._queryCircle=function(c,h,f,g,C){var P=c-f,R=c+f,L=h-f,z=h+f;if(R<0||P>this.width||z<0||L>this.height)return!g&&[];var W=[];return this._forEachCell(P,L,R,z,this._queryCellCircle,W,{hitTest:g,circle:{x:c,y:h,radius:f},seenUids:{box:{},circle:{}}},C),g?W.length>0:W},Hr.prototype.query=function(c,h,f,g,C){return this._query(c,h,f,g,!1,C)},Hr.prototype.hitTest=function(c,h,f,g,C){return this._query(c,h,f,g,!0,C)},Hr.prototype.hitTestCircle=function(c,h,f,g){return this._queryCircle(c,h,f,!0,g)},Hr.prototype._queryCell=function(c,h,f,g,C,P,R,L){var z=R.seenUids,W=this.boxCells[C];if(W!==null)for(var ee=this.bboxes,Z=0,te=W;Z<te.length;Z+=1){var se=te[Z];if(!z.box[se]){z.box[se]=!0;var we=4*se;if(c<=ee[we+2]&&h<=ee[we+3]&&f>=ee[we+0]&&g>=ee[we+1]&&(!L||L(this.boxKeys[se]))){if(R.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[se],x1:ee[we],y1:ee[we+1],x2:ee[we+2],y2:ee[we+3]})}}}var Fe=this.circleCells[C];if(Fe!==null)for(var ge=this.circles,Re=0,Ve=Fe;Re<Ve.length;Re+=1){var $e=Ve[Re];if(!z.circle[$e]){z.circle[$e]=!0;var rt=3*$e;if(this._circleAndRectCollide(ge[rt],ge[rt+1],ge[rt+2],c,h,f,g)&&(!L||L(this.circleKeys[$e]))){if(R.hitTest)return P.push(!0),!0;var Je=ge[rt],Ze=ge[rt+1],ft=ge[rt+2];P.push({key:this.circleKeys[$e],x1:Je-ft,y1:Ze-ft,x2:Je+ft,y2:Ze+ft})}}}},Hr.prototype._queryCellCircle=function(c,h,f,g,C,P,R,L){var z=R.circle,W=R.seenUids,ee=this.boxCells[C];if(ee!==null)for(var Z=this.bboxes,te=0,se=ee;te<se.length;te+=1){var we=se[te];if(!W.box[we]){W.box[we]=!0;var Fe=4*we;if(this._circleAndRectCollide(z.x,z.y,z.radius,Z[Fe+0],Z[Fe+1],Z[Fe+2],Z[Fe+3])&&(!L||L(this.boxKeys[we])))return P.push(!0),!0}}var ge=this.circleCells[C];if(ge!==null)for(var Re=this.circles,Ve=0,$e=ge;Ve<$e.length;Ve+=1){var rt=$e[Ve];if(!W.circle[rt]){W.circle[rt]=!0;var Je=3*rt;if(this._circlesCollide(Re[Je],Re[Je+1],Re[Je+2],z.x,z.y,z.radius)&&(!L||L(this.circleKeys[rt])))return P.push(!0),!0}}},Hr.prototype._forEachCell=function(c,h,f,g,C,P,R,L){for(var z=this._convertToXCellCoord(c),W=this._convertToYCellCoord(h),ee=this._convertToXCellCoord(f),Z=this._convertToYCellCoord(g),te=z;te<=ee;te++)for(var se=W;se<=Z;se++)if(C.call(this,c,h,f,g,this.xCellCount*se+te,P,R,L))return},Hr.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Hr.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Hr.prototype._circlesCollide=function(c,h,f,g,C,P){var R=g-c,L=C-h,z=f+P;return z*z>R*R+L*L},Hr.prototype._circleAndRectCollide=function(c,h,f,g,C,P,R){var L=(P-g)/2,z=Math.abs(c-(g+L));if(z>L+f)return!1;var W=(R-C)/2,ee=Math.abs(h-(C+W));if(ee>W+f)return!1;if(z<=L||ee<=W)return!0;var Z=z-L,te=ee-W;return Z*Z+te*te<=f*f};var Ro=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bi(c,h){for(var f=0;f<c;f++){var g=h.length;h.resize(g+4),h.float32.set(Ro,3*g)}}function ri(c,h,f){var g=h[0],C=h[1];return c[0]=f[0]*g+f[4]*C+f[12],c[1]=f[1]*g+f[5]*C+f[13],c[3]=f[3]*g+f[7]*C+f[15],c}var bi=function(c,h,f){h===void 0&&(h=new Hr(c.width+200,c.height+200,25)),f===void 0&&(f=new Hr(c.width+200,c.height+200,25)),this.transform=c,this.grid=h,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function En(c,h,f){return h*(s.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}bi.prototype.placeCollisionBox=function(c,h,f,g,C){var P=this.projectAndGetPerspectiveRatio(g,c.anchorPointX,c.anchorPointY),R=f*P.perspectiveRatio,L=c.x1*R+P.point.x,z=c.y1*R+P.point.y,W=c.x2*R+P.point.x,ee=c.y2*R+P.point.y;return!this.isInsideGrid(L,z,W,ee)||!h&&this.grid.hitTest(L,z,W,ee,C)?{box:[],offscreen:!1}:{box:[L,z,W,ee],offscreen:this.isOffscreen(L,z,W,ee)}},bi.prototype.placeCollisionCircles=function(c,h,f,g,C,P,R,L,z,W,ee,Z,te){var se=[],we=new s.Point(h.anchorX,h.anchorY),Fe=jt(we,P),ge=qr(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Re=(W?C/ge:C*ge)/s.ONE_EM,Ve=jt(we,R).point,$e=ti(Re,g,h.lineOffsetX*Re,h.lineOffsetY*Re,!1,Ve,we,h,f,R,{}),rt=!1,Je=!1,Ze=!0;if($e){for(var ft=.5*Z*ge+te,Pt=new s.Point(-100,-100),bt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),Lt=new fi,tr=$e.first,br=$e.last,Tr=[],gn=tr.path.length-1;gn>=1;gn--)Tr.push(tr.path[gn]);for(var nr=1;nr<br.path.length;nr++)Tr.push(br.path[nr]);var zr=2.5*ft;if(L){var Yr=Tr.map(function(xo){return jt(xo,L)});Tr=Yr.some(function(xo){return xo.signedDistanceFromCamera<=0})?[]:Yr.map(function(xo){return xo.point})}var Ur=[];if(Tr.length>0){for(var Lr=Tr[0].clone(),Jr=Tr[0].clone(),Rr=1;Rr<Tr.length;Rr++)Lr.x=Math.min(Lr.x,Tr[Rr].x),Lr.y=Math.min(Lr.y,Tr[Rr].y),Jr.x=Math.max(Jr.x,Tr[Rr].x),Jr.y=Math.max(Jr.y,Tr[Rr].y);Ur=Lr.x>=Pt.x&&Jr.x<=bt.x&&Lr.y>=Pt.y&&Jr.y<=bt.y?[Tr]:Jr.x<Pt.x||Lr.x>bt.x||Jr.y<Pt.y||Lr.y>bt.y?[]:s.clipLine([Tr],Pt.x,Pt.y,bt.x,bt.y)}for(var Mr=0,Vi=Ur;Mr<Vi.length;Mr+=1){var _i;Lt.reset(Vi[Mr],.25*ft),_i=Lt.length<=.5*ft?1:Math.ceil(Lt.paddedLength/zr)+1;for(var us=0;us<_i;us++){var Zi=us/Math.max(_i-1,1),di=Lt.lerp(Zi),xi=di.x+100,qs=di.y+100;se.push(xi,qs,ft,0);var vs=xi-ft,Tc=qs-ft,Ds=xi+ft,Wo=qs+ft;if(Ze=Ze&&this.isOffscreen(vs,Tc,Ds,Wo),Je=Je||this.isInsideGrid(vs,Tc,Ds,Wo),!c&&this.grid.hitTestCircle(xi,qs,ft,ee)&&(rt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!z&&rt||!Je?[]:se,offscreen:Ze,collisionDetected:rt}},bi.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],f=1/0,g=1/0,C=-1/0,P=-1/0,R=0,L=c;R<L.length;R+=1){var z=L[R],W=new s.Point(z.x+100,z.y+100);f=Math.min(f,W.x),g=Math.min(g,W.y),C=Math.max(C,W.x),P=Math.max(P,W.y),h.push(W)}for(var ee={},Z={},te=0,se=this.grid.query(f,g,C,P).concat(this.ignoredGrid.query(f,g,C,P));te<se.length;te+=1){var we=se[te],Fe=we.key;if(ee[Fe.bucketInstanceId]===void 0&&(ee[Fe.bucketInstanceId]={}),!ee[Fe.bucketInstanceId][Fe.featureIndex]){var ge=[new s.Point(we.x1,we.y1),new s.Point(we.x2,we.y1),new s.Point(we.x2,we.y2),new s.Point(we.x1,we.y2)];s.polygonIntersectsPolygon(h,ge)&&(ee[Fe.bucketInstanceId][Fe.featureIndex]=!0,Z[Fe.bucketInstanceId]===void 0&&(Z[Fe.bucketInstanceId]=[]),Z[Fe.bucketInstanceId].push(Fe.featureIndex))}}return Z},bi.prototype.insertCollisionBox=function(c,h,f,g,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:C},c[0],c[1],c[2],c[3])},bi.prototype.insertCollisionCircles=function(c,h,f,g,C){for(var P=h?this.ignoredGrid:this.grid,R={bucketInstanceId:f,featureIndex:g,collisionGroupID:C},L=0;L<c.length;L+=4)P.insertCircle(R,c[L],c[L+1],c[L+2])},bi.prototype.projectAndGetPerspectiveRatio=function(c,h,f){var g=[h,f,0,1];return ri(g,g,c),{point:new s.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},bi.prototype.isOffscreen=function(c,h,f,g){return f<100||c>=this.screenRightBoundary||g<100||h>this.screenBottomBoundary},bi.prototype.isInsideGrid=function(c,h,f,g){return f>=0&&c<this.gridRightBoundary&&g>=0&&h<this.gridBottomBoundary},bi.prototype.getViewportMatrix=function(){var c=s.identity([]);return s.translate(c,c,[-100,-100,0]),c};var as=function(c,h,f,g){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):g&&f?1:0,this.placed=f};as.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ki=function(c,h,f,g,C){this.text=new as(c?c.text:null,h,f,C),this.icon=new as(c?c.icon:null,h,g,C)};ki.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Bs=function(c,h,f){this.text=c,this.icon=h,this.skipFade=f},xn=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},Qc=function(c,h,f,g,C){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=C},xe=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Pe(c,h,f,g,C){var P=s.getAnchorAlignment(c),R=-(P.horizontalAlign-.5)*h,L=-(P.verticalAlign-.5)*f,z=s.evaluateVariableOffset(c,g);return new s.Point(R+z[0]*C,L+z[1]*C)}function je(c,h,f,g,C,P){var R=c.x1,L=c.x2,z=c.y1,W=c.y2,ee=c.anchorPointX,Z=c.anchorPointY,te=new s.Point(h,f);return g&&te._rotate(C?P:-P),{x1:R+te.x,y1:z+te.y,x2:L+te.x,y2:W+te.y,anchorPointX:ee,anchorPointY:Z}}xe.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:function(f){return f.collisionGroupID===h}}}return this.collisionGroups[c]};var dt=function(c,h,f,g){this.transform=c.clone(),this.collisionIndex=new bi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new xe(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Vt(c,h,f,g,C){c.emplaceBack(h?1:0,f?1:0,g||0,C||0),c.emplaceBack(h?1:0,f?1:0,g||0,C||0),c.emplaceBack(h?1:0,f?1:0,g||0,C||0),c.emplaceBack(h?1:0,f?1:0,g||0,C||0)}dt.prototype.getBucketParts=function(c,h,f,g){var C=f.getBucket(h),P=f.latestFeatureIndex;if(C&&P&&h.id===C.layerIds[0]){var R=f.collisionBoxArray,L=C.layers[0].layout,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),W=f.tileSize/s.EXTENT,ee=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Z=L.get("text-pitch-alignment")==="map",te=L.get("text-rotation-alignment")==="map",se=En(f,1,this.transform.zoom),we=ur(ee,Z,te,this.transform,se),Fe=null;if(Z){var ge=Ie(ee,Z,te,this.transform,se);Fe=s.multiply([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[C.bucketInstanceId]=new Qc(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,f.tileID);var Re={bucket:C,layout:L,posMatrix:ee,textLabelPlaneMatrix:we,labelToScreenMatrix:Fe,scale:z,textPixelRatio:W,holdingForFade:f.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(g)for(var Ve=0,$e=C.sortKeyRanges;Ve<$e.length;Ve+=1){var rt=$e[Ve];c.push({sortKey:rt.sortKey,symbolInstanceStart:rt.symbolInstanceStart,symbolInstanceEnd:rt.symbolInstanceEnd,parameters:Re})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Re})}},dt.prototype.attemptAnchorPlacement=function(c,h,f,g,C,P,R,L,z,W,ee,Z,te,se,we){var Fe,ge=[Z.textOffset0,Z.textOffset1],Re=Pe(c,f,g,ge,C),Ve=this.collisionIndex.placeCollisionBox(je(h,Re.x,Re.y,P,R,this.transform.angle),ee,L,z,W.predicate);if(!we||this.collisionIndex.placeCollisionBox(je(we,Re.x,Re.y,P,R,this.transform.angle),ee,L,z,W.predicate).box.length!==0)return Ve.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),this.variableOffsets[Z.crossTileID]={textOffset:ge,width:f,height:g,anchor:c,textBoxScale:C,prevAnchor:Fe},this.markUsedJustification(te,c,Z,se),te.allowVerticalPlacement&&(this.markUsedOrientation(te,se,Z),this.placedOrientations[Z.crossTileID]=se),{shift:Re,placedGlyphBoxes:Ve}):void 0},dt.prototype.placeLayerBucketPart=function(c,h,f){var g=this,C=c.parameters,P=C.bucket,R=C.layout,L=C.posMatrix,z=C.textLabelPlaneMatrix,W=C.labelToScreenMatrix,ee=C.textPixelRatio,Z=C.holdingForFade,te=C.collisionBoxArray,se=C.partiallyEvaluatedTextSize,we=C.collisionGroup,Fe=R.get("text-optional"),ge=R.get("icon-optional"),Re=R.get("text-allow-overlap"),Ve=R.get("icon-allow-overlap"),$e=R.get("text-rotation-alignment")==="map",rt=R.get("text-pitch-alignment")==="map",Je=R.get("icon-text-fit")!=="none",Ze=R.get("symbol-z-order")==="viewport-y",ft=Re&&(Ve||!P.hasIconData()||ge),Pt=Ve&&(Re||!P.hasTextData()||Fe);!P.collisionArrays&&te&&P.deserializeCollisionBoxes(te);var bt=function(nr,zr){if(!h[nr.crossTileID])if(Z)g.placements[nr.crossTileID]=new Bs(!1,!1,!1);else{var Yr,Ur=!1,Lr=!1,Jr=!0,Rr=null,Mr={box:null,offscreen:null},Vi={box:null,offscreen:null},_i=null,us=null,Zi=0,di=0,xi=0;zr.textFeatureIndex?Zi=zr.textFeatureIndex:nr.useRuntimeCollisionCircles&&(Zi=nr.featureIndex),zr.verticalTextFeatureIndex&&(di=zr.verticalTextFeatureIndex);var qs=zr.textBox;if(qs){var vs=function(vn){var Ao=s.WritingMode.horizontal;if(P.allowVerticalPlacement&&!vn&&g.prevPlacement){var Os=g.prevPlacement.placedOrientations[nr.crossTileID];Os&&(g.placedOrientations[nr.crossTileID]=Os,g.markUsedOrientation(P,Ao=Os,nr))}return Ao},Tc=function(vn,Ao){if(P.allowVerticalPlacement&&nr.numVerticalGlyphVertices>0&&zr.verticalTextBox)for(var Os=0,pl=P.writingModes;Os<pl.length&&(pl[Os]===s.WritingMode.vertical?(Mr=Ao(),Vi=Mr):Mr=vn(),!(Mr&&Mr.box&&Mr.box.length));Os+=1);else Mr=vn()};if(R.get("text-variable-anchor")){var Ds=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[nr.crossTileID]){var Wo=g.prevPlacement.variableOffsets[nr.crossTileID];Ds.indexOf(Wo.anchor)>0&&(Ds=Ds.filter(function(vn){return vn!==Wo.anchor})).unshift(Wo.anchor)}var xo=function(vn,Ao,Os){for(var pl=vn.x2-vn.x1,My=vn.y2-vn.y1,bh=nr.textBoxScale,Py=Je&&!Ve?Ao:null,lf={box:[],offscreen:!1},Pg=Re?2*Ds.length:Ds.length,au=0;au<Pg;++au){var xh=g.attemptAnchorPlacement(Ds[au%Ds.length],vn,pl,My,bh,$e,rt,ee,L,we,au>=Ds.length,nr,P,Os,Py);if(xh&&(lf=xh.placedGlyphBoxes)&&lf.box&&lf.box.length){Ur=!0,Rr=xh.shift;break}}return lf};Tc(function(){return xo(qs,zr.iconBox,s.WritingMode.horizontal)},function(){var vn=zr.verticalTextBox;return P.allowVerticalPlacement&&!(Mr&&Mr.box&&Mr.box.length)&&nr.numVerticalGlyphVertices>0&&vn?xo(vn,zr.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Mr&&(Ur=Mr.box,Jr=Mr.offscreen);var of=vs(Mr&&Mr.box);if(!Ur&&g.prevPlacement){var su=g.prevPlacement.variableOffsets[nr.crossTileID];su&&(g.variableOffsets[nr.crossTileID]=su,g.markUsedJustification(P,su.anchor,nr,of))}}else{var Ec=function(vn,Ao){var Os=g.collisionIndex.placeCollisionBox(vn,Re,ee,L,we.predicate);return Os&&Os.box&&Os.box.length&&(g.markUsedOrientation(P,Ao,nr),g.placedOrientations[nr.crossTileID]=Ao),Os};Tc(function(){return Ec(qs,s.WritingMode.horizontal)},function(){var vn=zr.verticalTextBox;return P.allowVerticalPlacement&&nr.numVerticalGlyphVertices>0&&vn?Ec(vn,s.WritingMode.vertical):{box:null,offscreen:null}}),vs(Mr&&Mr.box&&Mr.box.length)}}if(Ur=(Yr=Mr)&&Yr.box&&Yr.box.length>0,Jr=Yr&&Yr.offscreen,nr.useRuntimeCollisionCircles){var ou=P.text.placedSymbolArray.get(nr.centerJustifiedTextSymbolIndex),af=s.evaluateSizeForFeature(P.textSizeData,se,ou),pa=R.get("text-padding");_i=g.collisionIndex.placeCollisionCircles(Re,ou,P.lineVertexArray,P.glyphOffsetArray,af,L,z,W,f,rt,we.predicate,nr.collisionCircleDiameter,pa),Ur=Re||_i.circles.length>0&&!_i.collisionDetected,Jr=Jr&&_i.offscreen}if(zr.iconFeatureIndex&&(xi=zr.iconFeatureIndex),zr.iconBox){var cf=function(vn){var Ao=Je&&Rr?je(vn,Rr.x,Rr.y,$e,rt,g.transform.angle):vn;return g.collisionIndex.placeCollisionBox(Ao,Ve,ee,L,we.predicate)};Lr=Vi&&Vi.box&&Vi.box.length&&zr.verticalIconBox?(us=cf(zr.verticalIconBox)).box.length>0:(us=cf(zr.iconBox)).box.length>0,Jr=Jr&&us.offscreen}var ga=Fe||nr.numHorizontalGlyphVertices===0&&nr.numVerticalGlyphVertices===0,Hi=ge||nr.numIconVertices===0;if(ga||Hi?Hi?ga||(Lr=Lr&&Ur):Ur=Lr&&Ur:Lr=Ur=Lr&&Ur,Ur&&Yr&&Yr.box&&g.collisionIndex.insertCollisionBox(Yr.box,R.get("text-ignore-placement"),P.bucketInstanceId,Vi&&Vi.box&&di?di:Zi,we.ID),Lr&&us&&g.collisionIndex.insertCollisionBox(us.box,R.get("icon-ignore-placement"),P.bucketInstanceId,xi,we.ID),_i&&(Ur&&g.collisionIndex.insertCollisionCircles(_i.circles,R.get("text-ignore-placement"),P.bucketInstanceId,Zi,we.ID),f)){var Ga=P.bucketInstanceId,Bc=g.collisionCircleArrays[Ga];Bc===void 0&&(Bc=g.collisionCircleArrays[Ga]=new xn);for(var Al=0;Al<_i.circles.length;Al+=4)Bc.circles.push(_i.circles[Al+0]),Bc.circles.push(_i.circles[Al+1]),Bc.circles.push(_i.circles[Al+2]),Bc.circles.push(_i.collisionDetected?1:0)}g.placements[nr.crossTileID]=new Bs(Ur||ft,Lr||Pt,Jr||P.justReloaded),h[nr.crossTileID]=!0}};if(Ze)for(var Lt=P.getSortedSymbolIndexes(this.transform.angle),tr=Lt.length-1;tr>=0;--tr){var br=Lt[tr];bt(P.symbolInstances.get(br),P.collisionArrays[br])}else for(var Tr=c.symbolInstanceStart;Tr<c.symbolInstanceEnd;Tr++)bt(P.symbolInstances.get(Tr),P.collisionArrays[Tr]);if(f&&P.bucketInstanceId in this.collisionCircleArrays){var gn=this.collisionCircleArrays[P.bucketInstanceId];s.invert(gn.invProjMatrix,L),gn.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},dt.prototype.markUsedJustification=function(c,h,f,g){var C;C=g===s.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(h)];for(var P=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];P<R.length;P+=1){var L=R[P];L>=0&&(c.text.placedSymbolArray.get(L).crossTileID=C>=0&&L!==C?0:f.crossTileID)}},dt.prototype.markUsedOrientation=function(c,h,f){for(var g=h===s.WritingMode.horizontal||h===s.WritingMode.horizontalOnly?h:0,C=h===s.WritingMode.vertical?h:0,P=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];P<R.length;P+=1)c.text.placedSymbolArray.get(R[P]).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=C)},dt.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,f=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var g=h?h.symbolFadeChange(c):1,C=h?h.opacities:{},P=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(var L in this.placements){var z=this.placements[L],W=C[L];W?(this.opacities[L]=new ki(W,g,z.text,z.icon),f=f||z.text!==W.text.placed||z.icon!==W.icon.placed):(this.opacities[L]=new ki(null,g,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(var ee in C){var Z=C[ee];if(!this.opacities[ee]){var te=new ki(Z,g,!1,!1);te.isHidden()||(this.opacities[ee]=te,f=f||Z.text.placed||Z.icon.placed)}}for(var se in P)this.variableOffsets[se]||!this.opacities[se]||this.opacities[se].isHidden()||(this.variableOffsets[se]=P[se]);for(var we in R)this.placedOrientations[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.placedOrientations[we]=R[we]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)},dt.prototype.updateLayerOpacities=function(c,h){for(var f={},g=0,C=h;g<C.length;g+=1){var P=C[g],R=P.getBucket(c);R&&P.latestFeatureIndex&&c.id===R.layerIds[0]&&this.updateBucketOpacities(R,f,P.collisionBoxArray)}},dt.prototype.updateBucketOpacities=function(c,h,f){var g=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var C=c.layers[0].layout,P=new ki(null,0,!1,!1,!0),R=C.get("text-allow-overlap"),L=C.get("icon-allow-overlap"),z=C.get("text-variable-anchor"),W=C.get("text-rotation-alignment")==="map",ee=C.get("text-pitch-alignment")==="map",Z=C.get("icon-text-fit")!=="none",te=new ki(null,0,R&&(L||!c.hasIconData()||C.get("icon-optional")),L&&(R||!c.hasTextData()||C.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var se=function(Re,Ve,$e){for(var rt=0;rt<Ve/4;rt++)Re.opacityVertexArray.emplaceBack($e)},we=function(Re){var Ve=c.symbolInstances.get(Re),$e=Ve.numHorizontalGlyphVertices,rt=Ve.numVerticalGlyphVertices,Je=Ve.crossTileID,Ze=g.opacities[Je];h[Je]?Ze=P:Ze||(g.opacities[Je]=Ze=te),h[Je]=!0;var ft=Ve.numIconVertices>0,Pt=g.placedOrientations[Ve.crossTileID],bt=Pt===s.WritingMode.vertical,Lt=Pt===s.WritingMode.horizontal||Pt===s.WritingMode.horizontalOnly;if($e>0||rt>0){var tr=$u(Ze.text);se(c.text,$e,bt?sa:tr),se(c.text,rt,Lt?sa:tr);var br=Ze.text.isHidden();[Ve.rightJustifiedTextSymbolIndex,Ve.centerJustifiedTextSymbolIndex,Ve.leftJustifiedTextSymbolIndex].forEach(function(Mr){Mr>=0&&(c.text.placedSymbolArray.get(Mr).hidden=br||bt?1:0)}),Ve.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Ve.verticalPlacedTextSymbolIndex).hidden=br||Lt?1:0);var Tr=g.variableOffsets[Ve.crossTileID];Tr&&g.markUsedJustification(c,Tr.anchor,Ve,Pt);var gn=g.placedOrientations[Ve.crossTileID];gn&&(g.markUsedJustification(c,"left",Ve,gn),g.markUsedOrientation(c,gn,Ve))}if(ft){var nr=$u(Ze.icon),zr=!(Z&&Ve.verticalPlacedIconSymbolIndex&&bt);Ve.placedIconSymbolIndex>=0&&(se(c.icon,Ve.numIconVertices,zr?nr:sa),c.icon.placedSymbolArray.get(Ve.placedIconSymbolIndex).hidden=Ze.icon.isHidden()),Ve.verticalPlacedIconSymbolIndex>=0&&(se(c.icon,Ve.numVerticalIconVertices,zr?sa:nr),c.icon.placedSymbolArray.get(Ve.verticalPlacedIconSymbolIndex).hidden=Ze.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Yr=c.collisionArrays[Re];if(Yr){var Ur=new s.Point(0,0);if(Yr.textBox||Yr.verticalTextBox){var Lr=!0;if(z){var Jr=g.variableOffsets[Je];Jr?(Ur=Pe(Jr.anchor,Jr.width,Jr.height,Jr.textOffset,Jr.textBoxScale),W&&Ur._rotate(ee?g.transform.angle:-g.transform.angle)):Lr=!1}Yr.textBox&&Vt(c.textCollisionBox.collisionVertexArray,Ze.text.placed,!Lr||bt,Ur.x,Ur.y),Yr.verticalTextBox&&Vt(c.textCollisionBox.collisionVertexArray,Ze.text.placed,!Lr||Lt,Ur.x,Ur.y)}var Rr=!!(!Lt&&Yr.verticalIconBox);Yr.iconBox&&Vt(c.iconCollisionBox.collisionVertexArray,Ze.icon.placed,Rr,Z?Ur.x:0,Z?Ur.y:0),Yr.verticalIconBox&&Vt(c.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!Rr,Z?Ur.x:0,Z?Ur.y:0)}}},Fe=0;Fe<c.symbolInstances.length;Fe++)we(Fe);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var ge=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=ge.invProjMatrix,c.placementViewportMatrix=ge.viewportMatrix,c.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},dt.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},dt.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},dt.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},dt.prototype.stillRecent=function(c,h){var f=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*f>c},dt.prototype.setStale=function(){this.stale=!0};var pr=Math.pow(2,25),Cr=Math.pow(2,24),ni=Math.pow(2,17),Si=Math.pow(2,16),Ui=Math.pow(2,9),Vs=Math.pow(2,8),lh=Math.pow(2,1);function $u(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var h=c.placed?1:0,f=Math.floor(127*c.opacity);return f*pr+h*Cr+f*ni+h*Si+f*Ui+h*Vs+f*lh+h}var sa=0,el=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};el.prototype.continuePlacement=function(c,h,f,g,C){for(var P=this._bucketParts;this._currentTileIndex<c.length;)if(h.getBucketParts(P,g,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(R,L){return R.sortKey-L.sortKey}));this._currentPartIndex<P.length;)if(h.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,C())return!0;return!1};var tl=function(c,h,f,g,C,P,R){this.placement=new dt(c,C,P,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1};tl.prototype.isDone=function(){return this._done},tl.prototype.continuePlacement=function(c,h,f){for(var g=this,C=s.browser.now(),P=function(){var z=s.browser.now()-C;return!g._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var R=h[c[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new el(R)),this._inProgressLayer.continuePlacement(f[R.source],this.placement,this._showCollisionBoxes,R,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},tl.prototype.commit=function(c){return this.placement.commit(c),this.placement};var uh=512/s.EXTENT/2,rl=function(c,h,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var g=0;g<h.length;g++){var C=h.get(g),P=C.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:C.crossTileID,coord:this.getScaledCoordinates(C,c)})}};rl.prototype.getScaledCoordinates=function(c,h){var f=uh/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*s.EXTENT+c.anchorX)*f),y:Math.floor((h.canonical.y*s.EXTENT+c.anchorY)*f)}},rl.prototype.findMatches=function(c,h,f){for(var g=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),C=0;C<c.length;C++){var P=c.get(C);if(!P.crossTileID){var R=this.indexedSymbolInstances[P.key];if(R)for(var L=this.getScaledCoordinates(P,h),z=0,W=R;z<W.length;z+=1){var ee=W[z];if(Math.abs(ee.coord.x-L.x)<=g&&Math.abs(ee.coord.y-L.y)<=g&&!f[ee.crossTileID]){f[ee.crossTileID]=!0,P.crossTileID=ee.crossTileID;break}}}}};var Ss=function(){this.maxCrossTileID=0};Ss.prototype.generate=function(){return++this.maxCrossTileID};var Fo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fo.prototype.handleWrapJump=function(c){var h=Math.round((c-this.lng)/360);if(h!==0)for(var f in this.indexes){var g=this.indexes[f],C={};for(var P in g){var R=g[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),C[R.tileID.key]=R}this.indexes[f]=C}this.lng=c},Fo.prototype.addBucket=function(c,h,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var g=0;g<h.symbolInstances.length;g++)h.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var C=this.usedCrossTileIDs[c.overscaledZ];for(var P in this.indexes){var R=this.indexes[P];if(Number(P)>c.overscaledZ)for(var L in R){var z=R[L];z.tileID.isChildOf(c)&&z.findMatches(h.symbolInstances,c,C)}else{var W=R[c.scaledTo(Number(P)).key];W&&W.findMatches(h.symbolInstances,c,C)}}for(var ee=0;ee<h.symbolInstances.length;ee++){var Z=h.symbolInstances.get(ee);Z.crossTileID||(Z.crossTileID=f.generate(),C[Z.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new rl(c,h.symbolInstances,h.bucketInstanceId),!0},Fo.prototype.removeBucketCrossTileIDs=function(c,h){for(var f in h.indexedSymbolInstances)for(var g=0,C=h.indexedSymbolInstances[f];g<C.length;g+=1)delete this.usedCrossTileIDs[c][C[g].crossTileID]},Fo.prototype.removeStaleBuckets=function(c){var h=!1;for(var f in this.indexes){var g=this.indexes[f];for(var C in g)c[g[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[C]),delete g[C],h=!0)}return h};var oa=function(){this.layerIndexes={},this.crossTileIDs=new Ss,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};oa.prototype.addLayer=function(c,h,f){var g=this.layerIndexes[c.id];g===void 0&&(g=this.layerIndexes[c.id]=new Fo);var C=!1,P={};g.handleWrapJump(f);for(var R=0,L=h;R<L.length;R+=1){var z=L[R],W=z.getBucket(c);W&&c.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(z.tileID,W,this.crossTileIDs)&&(C=!0),P[W.bucketInstanceId]=!0)}return g.removeStaleBuckets(P)&&(C=!0),C},oa.prototype.pruneUnusedLayers=function(c){var h={};for(var f in c.forEach(function(g){h[g]=!0}),this.layerIndexes)h[f]||delete this.layerIndexes[f]};var Sa=function(c,h){return s.emitValidationErrors(c,h&&h.filter(function(f){return f.identifier!=="source.canvas"}))},aa=s.pick(Ut,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),hi=s.pick(Ut,["setCenter","setZoom","setBearing","setPitch"]),_o=function(){var c={},h=s.styleSpec.$version;for(var f in s.styleSpec.$root){var g,C=s.styleSpec.$root[f];C.required&&(g=f==="version"?h:C.type==="array"?[]:{})!=null&&(c[f]=g)}return c}(),Dn=function(c){function h(f,g){var C=this;g===void 0&&(g={}),c.call(this),this.map=f,this.dispatcher=new Te(lt(),this),this.imageManager=new H,this.imageManager.setEventedParent(this),this.glyphManager=new de(f._requestManager,g.localIdeographFontFamily),this.lineAtlas=new re(256,512),this.crossTileSymbolIndex=new oa,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var P=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(R){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(L,z){if(s.triggerPluginCompletionEvent(L),z&&z.every(function(ee){return ee}))for(var W in P.sourceCaches)P.sourceCaches[W].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var L=C.sourceCaches[R.sourceId];if(L){var z=L.getSource();if(z&&z.vectorLayerIds)for(var W in C._layers){var ee=C._layers[W];ee.source===z.id&&C._validateLayer(ee)}}}})}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.loadURL=function(f,g){var C=this;g===void 0&&(g={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var P=typeof g.validate=="boolean"?g.validate:!s.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,g.accessToken);var R=this.map._requestManager.transformRequest(f,s.ResourceType.Style);this._request=s.getJSON(R,function(L,z){C._request=null,L?C.fire(new s.ErrorEvent(L)):z&&C._load(z,P)})},h.prototype.loadJSON=function(f,g){var C=this;g===void 0&&(g={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame(function(){C._request=null,C._load(f,g.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(_o,!1)},h.prototype._load=function(f,g){if(!g||!Sa(this,s.validateStyle(f))){for(var C in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(C,f.sources[C],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var P=Bt(this.stylesheet.layers);this._order=P.map(function(W){return W.id}),this._layers={},this._serializedLayers={};for(var R=0,L=P;R<L.length;R+=1){var z=L[R];(z=s.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new $(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},h.prototype._loadSprite=function(f){var g=this;this._spriteRequest=function(C,P,R){var L,z,W,ee=s.browser.devicePixelRatio>1?"@2x":"",Z=s.getJSON(P.transformRequest(P.normalizeSpriteURL(C,ee,".json"),s.ResourceType.SpriteJSON),function(we,Fe){Z=null,W||(W=we,L=Fe,se())}),te=s.getImage(P.transformRequest(P.normalizeSpriteURL(C,ee,".png"),s.ResourceType.SpriteImage),function(we,Fe){te=null,W||(W=we,z=Fe,se())});function se(){if(W)R(W);else if(L&&z){var we=s.browser.getImageData(z),Fe={};for(var ge in L){var Re=L[ge],Ve=Re.width,$e=Re.height,rt=Re.x,Je=Re.y,Ze=Re.sdf,ft=Re.pixelRatio,Pt=Re.stretchX,bt=Re.stretchY,Lt=Re.content,tr=new s.RGBAImage({width:Ve,height:$e});s.RGBAImage.copy(we,tr,{x:rt,y:Je},{x:0,y:0},{width:Ve,height:$e}),Fe[ge]={data:tr,pixelRatio:ft,sdf:Ze,stretchX:Pt,stretchY:bt,content:Lt}}R(null,Fe)}}return{cancel:function(){Z&&(Z.cancel(),Z=null),te&&(te.cancel(),te=null)}}}(f,this.map._requestManager,function(C,P){if(g._spriteRequest=null,C)g.fire(new s.ErrorEvent(C));else if(P)for(var R in P)g.imageManager.addImage(R,P[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new s.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(f){var g=this.sourceCaches[f.source];if(g){var C=f.sourceLayer;if(C){var P=g.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(C)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+C+'" does not exist on source "'+P.id+'" as specified by style layer "'+f.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(f){for(var g=[],C=0,P=f;C<P.length;C+=1){var R=this._layers[P[C]];R.type!=="custom"&&g.push(R.serialize())}return g},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(f){if(this._loaded){var g=this._changed;if(this._changed){var C=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var R in(C.length||P.length)&&this._updateWorkerLayers(C,P),this._updatedSources){var L=this._updatedSources[R];L==="reload"?this._reloadSource(R):L==="clear"&&this._clearSource(R)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var W={};for(var ee in this.sourceCaches){var Z=this.sourceCaches[ee];W[ee]=Z.used,Z.used=!1}for(var te=0,se=this._order;te<se.length;te+=1){var we=this._layers[se[te]];we.recalculate(f,this._availableImages),!we.isHidden(f.zoom)&&we.source&&(this.sourceCaches[we.source].used=!0)}for(var Fe in W){var ge=this.sourceCaches[Fe];W[Fe]!==ge.used&&ge.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Fe}))}this.light.recalculate(f),this.z=f.zoom,g&&this.fire(new s.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},h.prototype._updateWorkerLayers=function(f,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:g})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(f){var g=this;if(this._checkLoaded(),Sa(this,s.validateStyle(f)))return!1;(f=s.clone$1(f)).layers=Bt(f.layers);var C=function(R,L){if(!R)return[{command:Ut.setStyle,args:[L]}];var z=[];try{if(!s.deepEqual(R.version,L.version))return[{command:Ut.setStyle,args:[L]}];s.deepEqual(R.center,L.center)||z.push({command:Ut.setCenter,args:[L.center]}),s.deepEqual(R.zoom,L.zoom)||z.push({command:Ut.setZoom,args:[L.zoom]}),s.deepEqual(R.bearing,L.bearing)||z.push({command:Ut.setBearing,args:[L.bearing]}),s.deepEqual(R.pitch,L.pitch)||z.push({command:Ut.setPitch,args:[L.pitch]}),s.deepEqual(R.sprite,L.sprite)||z.push({command:Ut.setSprite,args:[L.sprite]}),s.deepEqual(R.glyphs,L.glyphs)||z.push({command:Ut.setGlyphs,args:[L.glyphs]}),s.deepEqual(R.transition,L.transition)||z.push({command:Ut.setTransition,args:[L.transition]}),s.deepEqual(R.light,L.light)||z.push({command:Ut.setLight,args:[L.light]});var W={},ee=[];(function(te,se,we,Fe){var ge;for(ge in se=se||{},te=te||{})te.hasOwnProperty(ge)&&(se.hasOwnProperty(ge)||Kt(ge,we,Fe));for(ge in se)se.hasOwnProperty(ge)&&(te.hasOwnProperty(ge)?s.deepEqual(te[ge],se[ge])||(te[ge].type==="geojson"&&se[ge].type==="geojson"&&tn(te,se,ge)?we.push({command:Ut.setGeoJSONSourceData,args:[ge,se[ge].data]}):Kr(ge,se,we,Fe)):Dr(ge,se,we))})(R.sources,L.sources,ee,W);var Z=[];R.layers&&R.layers.forEach(function(te){W[te.source]?z.push({command:Ut.removeLayer,args:[te.id]}):Z.push(te)}),z=z.concat(ee),function(te,se,we){se=se||[];var Fe,ge,Re,Ve,$e,rt,Je,Ze=(te=te||[]).map(Vr),ft=se.map(Vr),Pt=te.reduce(Nr,{}),bt=se.reduce(Nr,{}),Lt=Ze.slice(),tr=Object.create(null);for(Fe=0,ge=0;Fe<Ze.length;Fe++)bt.hasOwnProperty(Re=Ze[Fe])?ge++:(we.push({command:Ut.removeLayer,args:[Re]}),Lt.splice(Lt.indexOf(Re,ge),1));for(Fe=0,ge=0;Fe<ft.length;Fe++)Lt[Lt.length-1-Fe]!==(Re=ft[ft.length-1-Fe])&&(Pt.hasOwnProperty(Re)?(we.push({command:Ut.removeLayer,args:[Re]}),Lt.splice(Lt.lastIndexOf(Re,Lt.length-ge),1)):ge++,we.push({command:Ut.addLayer,args:[bt[Re],rt=Lt[Lt.length-Fe]]}),Lt.splice(Lt.length-Fe,0,Re),tr[Re]=!0);for(Fe=0;Fe<ft.length;Fe++)if(Ve=Pt[Re=ft[Fe]],$e=bt[Re],!tr[Re]&&!s.deepEqual(Ve,$e))if(s.deepEqual(Ve.source,$e.source)&&s.deepEqual(Ve["source-layer"],$e["source-layer"])&&s.deepEqual(Ve.type,$e.type)){for(Je in Gr(Ve.layout,$e.layout,we,Re,null,Ut.setLayoutProperty),Gr(Ve.paint,$e.paint,we,Re,null,Ut.setPaintProperty),s.deepEqual(Ve.filter,$e.filter)||we.push({command:Ut.setFilter,args:[Re,$e.filter]}),s.deepEqual(Ve.minzoom,$e.minzoom)&&s.deepEqual(Ve.maxzoom,$e.maxzoom)||we.push({command:Ut.setLayerZoomRange,args:[Re,$e.minzoom,$e.maxzoom]}),Ve)Ve.hasOwnProperty(Je)&&Je!=="layout"&&Je!=="paint"&&Je!=="filter"&&Je!=="metadata"&&Je!=="minzoom"&&Je!=="maxzoom"&&(Je.indexOf("paint.")===0?Gr(Ve[Je],$e[Je],we,Re,Je.slice(6),Ut.setPaintProperty):s.deepEqual(Ve[Je],$e[Je])||we.push({command:Ut.setLayerProperty,args:[Re,Je,$e[Je]]}));for(Je in $e)$e.hasOwnProperty(Je)&&!Ve.hasOwnProperty(Je)&&Je!=="layout"&&Je!=="paint"&&Je!=="filter"&&Je!=="metadata"&&Je!=="minzoom"&&Je!=="maxzoom"&&(Je.indexOf("paint.")===0?Gr(Ve[Je],$e[Je],we,Re,Je.slice(6),Ut.setPaintProperty):s.deepEqual(Ve[Je],$e[Je])||we.push({command:Ut.setLayerProperty,args:[Re,Je,$e[Je]]}))}else we.push({command:Ut.removeLayer,args:[Re]}),rt=Lt[Lt.lastIndexOf(Re)+1],we.push({command:Ut.addLayer,args:[$e,rt]})}(Z,L.layers,z)}catch(te){console.warn("Unable to compute style diff:",te),z=[{command:Ut.setStyle,args:[L]}]}return z}(this.serialize(),f).filter(function(R){return!(R.command in hi)});if(C.length===0)return!1;var P=C.filter(function(R){return!(R.command in aa)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(R){return R.command}).join(", ")+".");return C.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=f,!0},h.prototype.addImage=function(f,g){if(this.getImage(f))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,g),this._afterImageUpdated(f)},h.prototype.updateImage=function(f,g){this.imageManager.updateImage(f,g)},h.prototype.getImage=function(f){return this.imageManager.getImage(f)},h.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},h.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(f,g,C){var P=this;if(C===void 0&&(C={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(s.validateStyle.source,"sources."+f,g,null,C))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[f]=new Be(f,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:R.serialize(),sourceId:f}}),R.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===f)return this.fire(new s.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+g+'" is using it.')));var C=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],C.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),C.setEventedParent(null),C.clearTiles(),C.onRemove&&C.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(f,g){this._checkLoaded(),this.sourceCaches[f].getSource().setData(g),this._changed=!0},h.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},h.prototype.addLayer=function(f,g,C){C===void 0&&(C={}),this._checkLoaded();var P=f.id;if(this.getLayer(P))this.fire(new s.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var R;if(f.type==="custom"){if(Sa(this,s.validateCustomStyleLayer(f)))return;R=s.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(P,f.source),f=s.clone$1(f),f=s.extend(f,{source:P})),this._validate(s.validateStyle.layer,"layers."+P,f,{arrayIndex:-1},C))return;R=s.createStyleLayer(f),this._validateLayer(R),R.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[R.id]=R.serialize()}var L=g?this._order.indexOf(g):this._order.length;if(g&&L===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(L,0,P),this._layerOrderChanged=!0,this._layers[P]=R,this._removedLayers[P]&&R.source&&R.type!=="custom"){var z=this._removedLayers[P];delete this._removedLayers[P],z.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},h.prototype.moveLayer=function(f,g){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==g){var C=this._order.indexOf(f);this._order.splice(C,1);var P=g?this._order.indexOf(g):this._order.length;g&&P===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(P,0,f),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(f){this._checkLoaded();var g=this._layers[f];if(g){g.setEventedParent(null);var C=this._order.indexOf(f);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=g,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],g.onRemove&&g.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(f){return this._layers[f]},h.prototype.hasLayer=function(f){return f in this._layers},h.prototype.setLayerZoomRange=function(f,g,C){this._checkLoaded();var P=this.getLayer(f);P?P.minzoom===g&&P.maxzoom===C||(g!=null&&(P.minzoom=g),C!=null&&(P.maxzoom=C),this._updateLayer(P)):this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(f,g,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(f);if(P){if(!s.deepEqual(P.filter,g))return g==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(s.validateStyle.filter,"layers."+P.id+".filter",g,null,C)||(P.filter=s.clone$1(g),this._updateLayer(P)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(f){return s.clone$1(this.getLayer(f).filter)},h.prototype.setLayoutProperty=function(f,g,C,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(f);R?s.deepEqual(R.getLayoutProperty(g),C)||(R.setLayoutProperty(g,C,P),this._updateLayer(R)):this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(f,g){var C=this.getLayer(f);if(C)return C.getLayoutProperty(g);this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(f,g,C,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(f);R?s.deepEqual(R.getPaintProperty(g),C)||(R.setPaintProperty(g,C,P)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(f,g){return this.getLayer(f).getPaintProperty(g)},h.prototype.setFeatureState=function(f,g){this._checkLoaded();var C=f.source,P=f.sourceLayer,R=this.sourceCaches[C];if(R!==void 0){var L=R.getSource().type;L==="geojson"&&P?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||P?(f.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(P,f.id,g)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(f,g){this._checkLoaded();var C=f.source,P=this.sourceCaches[C];if(P!==void 0){var R=P.getSource().type,L=R==="vector"?f.sourceLayer:void 0;R!=="vector"||L?g&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(L,f.id,g):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(f){this._checkLoaded();var g=f.source,C=f.sourceLayer,P=this.sourceCaches[g];if(P!==void 0){if(P.getSource().type!=="vector"||C)return f.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(C,f.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},h.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(f){for(var g=this,C=function(Pt){return g._layers[Pt].type==="fill-extrusion"},P={},R=[],L=this._order.length-1;L>=0;L--){var z=this._order[L];if(C(z)){P[z]=L;for(var W=0,ee=f;W<ee.length;W+=1){var Z=ee[W][z];if(Z)for(var te=0,se=Z;te<se.length;te+=1)R.push(se[te])}}}R.sort(function(Pt,bt){return bt.intersectionZ-Pt.intersectionZ});for(var we=[],Fe=this._order.length-1;Fe>=0;Fe--){var ge=this._order[Fe];if(C(ge))for(var Re=R.length-1;Re>=0;Re--){var Ve=R[Re].feature;if(P[Ve.layer.id]<Fe)break;we.push(Ve),R.pop()}else for(var $e=0,rt=f;$e<rt.length;$e+=1){var Je=rt[$e][ge];if(Je)for(var Ze=0,ft=Je;Ze<ft.length;Ze+=1)we.push(ft[Ze].feature)}}return we},h.prototype.queryRenderedFeatures=function(f,g,C){g&&g.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var P={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,L=g.layers;R<L.length;R+=1){var z=L[R],W=this._layers[z];if(!W)return this.fire(new s.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];P[W.source]=!0}}var ee=[];for(var Z in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!P[Z]||ee.push(qt(this.sourceCaches[Z],this._layers,this._serializedLayers,f,g,C));return this.placement&&ee.push(function(te,se,we,Fe,ge,Re,Ve){for(var $e={},rt=Re.queryRenderedSymbols(Fe),Je=[],Ze=0,ft=Object.keys(rt).map(Number);Ze<ft.length;Ze+=1)Je.push(Ve[ft[Ze]]);Je.sort($t);for(var Pt=function(){var Tr=Lt[bt],gn=Tr.featureIndex.lookupSymbolFeatures(rt[Tr.bucketInstanceId],se,Tr.bucketIndex,Tr.sourceLayerIndex,ge.filter,ge.layers,ge.availableImages,te);for(var nr in gn){var zr=$e[nr]=$e[nr]||[],Yr=gn[nr];Yr.sort(function(Jr,Rr){var Mr=Tr.featureSortOrder;if(Mr){var Vi=Mr.indexOf(Jr.featureIndex);return Mr.indexOf(Rr.featureIndex)-Vi}return Rr.featureIndex-Jr.featureIndex});for(var Ur=0,Lr=Yr;Ur<Lr.length;Ur+=1)zr.push(Lr[Ur])}},bt=0,Lt=Je;bt<Lt.length;bt+=1)Pt();var tr=function(Tr){$e[Tr].forEach(function(gn){var nr=gn.feature,zr=we[te[Tr].source].getFeatureState(nr.layer["source-layer"],nr.id);nr.source=nr.layer.source,nr.layer["source-layer"]&&(nr.sourceLayer=nr.layer["source-layer"]),nr.state=zr})};for(var br in $e)tr(br);return $e}(this._layers,this._serializedLayers,this.sourceCaches,f,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ee)},h.prototype.querySourceFeatures=function(f,g){g&&g.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var C=this.sourceCaches[f];return C?function(P,R){for(var L=P.getRenderableIds().map(function(se){return P.getTileByID(se)}),z=[],W={},ee=0;ee<L.length;ee++){var Z=L[ee],te=Z.tileID.canonical.key;W[te]||(W[te]=!0,Z.querySourceFeatures(z,R))}return z}(C,g):[]},h.prototype.addSourceType=function(f,g,C){return h.getSourceType(f)?C(new Error('A source type called "'+f+'" already exists.')):(h.setSourceType(f,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:g.workerSourceURL},C):C(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(f,g){g===void 0&&(g={}),this._checkLoaded();var C=this.light.getLight(),P=!1;for(var R in f)if(!s.deepEqual(f[R],C[R])){P=!0;break}if(P){var L={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,g),this.light.updateTransitions(L)}},h.prototype._validate=function(f,g,C,P,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Sa(this,f.call(s.validateStyle,s.extend({key:g,style:this.serialize(),value:C,styleSpec:s.styleSpec},P)))},h.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},h.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},h.prototype._updateSources=function(f){for(var g in this.sourceCaches)this.sourceCaches[g].update(f)},h.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},h.prototype._updatePlacement=function(f,g,C,P,R){R===void 0&&(R=!1);for(var L=!1,z=!1,W={},ee=0,Z=this._order;ee<Z.length;ee+=1){var te=this._layers[Z[ee]];if(te.type==="symbol"){if(!W[te.source]){var se=this.sourceCaches[te.source];W[te.source]=se.getRenderableIds(!0).map(function(Ve){return se.getTileByID(Ve)}).sort(function(Ve,$e){return $e.tileID.overscaledZ-Ve.tileID.overscaledZ||(Ve.tileID.isLessThan($e.tileID)?-1:1)})}var we=this.crossTileSymbolIndex.addLayer(te,W[te.source],f.center.lng);L=L||we}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||C===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),f.zoom))&&(this.pauseablePlacement=new tl(f,this._order,R,g,C,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),z=!0),L&&this.pauseablePlacement.placement.setStale()),z||L)for(var Fe=0,ge=this._order;Fe<ge.length;Fe+=1){var Re=this._layers[ge[Fe]];Re.type==="symbol"&&this.placement.updateLayerOpacities(Re,W[Re.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},h.prototype.getImages=function(f,g,C){this.imageManager.getImages(g.icons,C),this._updateTilesForChangedImages();var P=this.sourceCaches[g.source];P&&P.setDependencies(g.tileID.key,g.type,g.icons)},h.prototype.getGlyphs=function(f,g,C){this.glyphManager.getGlyphs(g.stacks,C)},h.prototype.getResource=function(f,g,C){return s.makeRequest(g,C)},h}(s.Evented);Dn.getSourceType=function(c){return nt[c]},Dn.setSourceType=function(c,h){nt[c]=h},Dn.registerForPluginStateChange=s.registerForPluginStateChange;var ii=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ia=wn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),nl=wn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),PA=wn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),RA=wn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Wu=wn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),zl=wn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),hc=wn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Do=wn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ju=wn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Xu=wn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Gl=wn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),co=wn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Hs=wn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Ku=wn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ri=wn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),il=wn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ca=wn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),la=wn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ua=wn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ma=wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),fa=wn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Pa=wn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ra=wn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ha=wn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fh=wn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),hh=wn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function wn(c,h){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=h.match(/attribute ([\w]+) ([\w]+)/g),C=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=P?P.concat(C):C,L={};return{fragmentSource:c=c.replace(f,function(z,W,ee,Z,te){return L[te]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_`+te+`
varying `+ee+" "+Z+" "+te+`;
#else
uniform `+ee+" "+Z+" u_"+te+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+te+`
    `+ee+" "+Z+" "+te+" = u_"+te+`;
#endif
`}),vertexSource:h=h.replace(f,function(z,W,ee,Z,te){var se=Z==="float"?"vec2":"vec4",we=te.match(/color/)?"color":se;return L[te]?W==="define"?`
#ifndef HAS_UNIFORM_u_`+te+`
uniform lowp float u_`+te+`_t;
attribute `+ee+" "+se+" a_"+te+`;
varying `+ee+" "+Z+" "+te+`;
#else
uniform `+ee+" "+Z+" u_"+te+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+te+`
    `+te+" = a_"+te+`;
#else
    `+ee+" "+Z+" "+te+" = u_"+te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+te+`
    `+te+" = unpack_mix_"+we+"(a_"+te+", u_"+te+`_t);
#else
    `+ee+" "+Z+" "+te+" = u_"+te+`;
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_`+te+`
uniform lowp float u_`+te+`_t;
attribute `+ee+" "+se+" a_"+te+`;
#else
uniform `+ee+" "+Z+" u_"+te+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+te+`
    `+ee+" "+Z+" "+te+" = a_"+te+`;
#else
    `+ee+" "+Z+" "+te+" = u_"+te+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+te+`
    `+ee+" "+Z+" "+te+" = unpack_mix_"+we+"(a_"+te+", u_"+te+`_t);
#else
    `+ee+" "+Z+" "+te+" = u_"+te+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var Vl=Object.freeze({__proto__:null,prelude:Ia,background:nl,backgroundPattern:PA,circle:RA,clippingMask:Wu,heatmap:zl,heatmapTexture:hc,collisionBox:Do,collisionCircle:Ju,debug:Xu,fill:Gl,fillOutline:co,fillOutlinePattern:Hs,fillPattern:Ku,fillExtrusion:Ri,fillExtrusionPattern:il,hillshadePrepare:ca,hillshade:la,line:ua,lineGradient:Ma,linePattern:fa,lineSDF:Pa,raster:Ra,symbolIcon:ha,symbolSDF:fh,symbolTextAndIcon:hh}),Hl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function dh(c){for(var h=[],f=0;f<c.length;f++)if(c[f]!==null){var g=c[f].split(" ");h.push(g.pop())}return h}Hl.prototype.bind=function(c,h,f,g,C,P,R,L){this.context=c;for(var z=this.boundPaintVertexBuffers.length!==g.length,W=0;!z&&W<g.length;W++)this.boundPaintVertexBuffers[W]!==g[W]&&(z=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===f&&!z&&this.boundIndexBuffer===C&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===L?(c.bindVertexArrayOES.set(this.vao),R&&R.bind(),C&&C.dynamicDraw&&C.bind(),L&&L.bind()):this.freshBind(h,f,g,C,P,R,L)},Hl.prototype.freshBind=function(c,h,f,g,C,P,R){var L,z=c.numAttributes,W=this.context,ee=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R;else{L=W.currentNumAttributes||0;for(var Z=z;Z<L;Z++)ee.disableVertexAttribArray(Z)}h.enableAttributes(ee,c);for(var te=0,se=f;te<se.length;te+=1)se[te].enableAttributes(ee,c);P&&P.enableAttributes(ee,c),R&&R.enableAttributes(ee,c),h.bind(),h.setVertexAttribPointers(ee,c,C);for(var we=0,Fe=f;we<Fe.length;we+=1){var ge=Fe[we];ge.bind(),ge.setVertexAttribPointers(ee,c,C)}P&&(P.bind(),P.setVertexAttribPointers(ee,c,C)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(ee,c,C)),W.currentNumAttributes=z},Hl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ah=function(c,h,f,g,C,P){var R=c.gl;this.program=R.createProgram();for(var L=dh(f.staticAttributes),z=g?g.getBinderAttributes():[],W=L.concat(z),ee=f.staticUniforms?dh(f.staticUniforms):[],Z=g?g.getBinderUniforms():[],te=[],se=0,we=ee.concat(Z);se<we.length;se+=1){var Fe=we[se];te.indexOf(Fe)<0&&te.push(Fe)}var ge=g?g.defines():[];P&&ge.push("#define OVERDRAW_INSPECTOR;");var Re=ge.concat(Ia.fragmentSource,f.fragmentSource).join(`
`),Ve=ge.concat(Ia.vertexSource,f.vertexSource).join(`
`),$e=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource($e,Re),R.compileShader($e),R.attachShader(this.program,$e);var rt=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(rt,Ve),R.compileShader(rt),R.attachShader(this.program,rt),this.attributes={};var Je={};this.numAttributes=W.length;for(var Ze=0;Ze<this.numAttributes;Ze++)W[Ze]&&(R.bindAttribLocation(this.program,Ze,W[Ze]),this.attributes[W[Ze]]=Ze);R.linkProgram(this.program),R.deleteShader(rt),R.deleteShader($e);for(var ft=0;ft<te.length;ft++){var Pt=te[ft];if(Pt&&!Je[Pt]){var bt=R.getUniformLocation(this.program,Pt);bt&&(Je[Pt]=bt)}}this.fixedUniforms=C(c,Je),this.binderUniforms=g?g.getUniforms(c,Je):[]}}};function dc(c,h,f){var g=1/En(f,1,h.transform.tileZoom),C=Math.pow(2,f.tileID.overscaledZ),P=f.tileSize*Math.pow(2,h.transform.tileZoom)/C,R=P*(f.tileID.canonical.x+f.tileID.wrap*C),L=P*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[g,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[R>>16,L>>16],u_pixel_coord_lower:[65535&R,65535&L]}}Ah.prototype.draw=function(c,h,f,g,C,P,R,L,z,W,ee,Z,te,se,we,Fe){var ge,Re=c.gl;if(!this.failedToCreate){for(var Ve in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(g),c.setColorMode(C),c.setCullFace(P),this.fixedUniforms)this.fixedUniforms[Ve].set(R[Ve]);se&&se.setUniforms(c,this.binderUniforms,Z,{zoom:te});for(var $e=(ge={},ge[Re.LINES]=2,ge[Re.TRIANGLES]=3,ge[Re.LINE_STRIP]=1,ge)[h],rt=0,Je=ee.get();rt<Je.length;rt+=1){var Ze=Je[rt],ft=Ze.vaos||(Ze.vaos={});(ft[L]||(ft[L]=new Hl)).bind(c,this,z,se?se.getPaintVertexBuffers():[],W,Ze.vertexOffset,we,Fe),Re.drawElements(h,Ze.primitiveLength*$e,Re.UNSIGNED_SHORT,Ze.primitiveOffset*$e*2)}}};var ph=function(c,h,f,g){var C=h.style.light,P=C.properties.get("position"),R=[P.x,P.y,P.z],L=s.create$1();C.properties.get("anchor")==="viewport"&&s.fromRotation(L,-h.transform.angle),s.transformMat3(R,R,L);var z=C.properties.get("color");return{u_matrix:c,u_lightpos:R,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+f,u_opacity:g}},Oo=function(c,h,f,g,C,P,R){return s.extend(ph(c,h,f,g),dc(P,h,R),{u_height_factor:-Math.pow(2,C.overscaledZ)/R.tileSize/8})},Lo=function(c){return{u_matrix:c}},js=function(c,h,f,g){return s.extend(Lo(c),dc(f,h,g))},gh=function(c,h){return{u_matrix:c,u_world:h}},jl=function(c,h,f,g,C){return s.extend(js(c,h,f,g),{u_world:C})},$l=function(c,h,f,g){var C,P,R=c.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var L=En(f,1,R.zoom);C=!0,P=[L,L]}else C=!1,P=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(h.posMatrix,f,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+C,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:P}},Fa=function(c,h,f){var g=En(f,1,h.zoom),C=Math.pow(2,h.zoom-f.tileID.overscaledZ),P=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[h.pixelsToGLUnits[0]/(g*C),h.pixelsToGLUnits[1]/(g*C)],u_overscale_factor:P}},qu=function(c,h,f){return{u_matrix:c,u_inv_matrix:h,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},No=function(c,h,f){return f===void 0&&(f=1),{u_matrix:c,u_color:h,u_overlay:0,u_overlay_scale:f}},ko=function(c){return{u_matrix:c}},sl=function(c,h,f,g){return{u_matrix:c,u_extrude_scale:En(h,1,f),u_intensity:g}},Bn=function(c,h,f){var g=c.transform;return{u_matrix:mh(c,h,f),u_ratio:1/En(h,1,g.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},In=function(c,h,f,g){return s.extend(Bn(c,h,f),{u_image:0,u_image_height:g})},Wl=function(c,h,f,g){var C=c.transform,P=Ac(h,C);return{u_matrix:mh(c,h,f),u_texsize:h.imageAtlasTexture.size,u_ratio:1/En(h,1,C.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[P,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},FA=function(c,h,f,g,C){var P=c.lineAtlas,R=Ac(h,c.transform),L=f.layout.get("line-cap")==="round",z=P.getDash(g.from,L),W=P.getDash(g.to,L),ee=z.width*C.fromScale,Z=W.width*C.toScale;return s.extend(Bn(c,h,f),{u_patternscale_a:[R/ee,-z.height/2],u_patternscale_b:[R/Z,-W.height/2],u_sdfgamma:P.width/(256*Math.min(ee,Z)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:W.y,u_mix:C.t})};function Ac(c,h){return 1/En(c,1,h.tileZoom)}function mh(c,h,f){return c.translatePosMatrix(h.tileID.posMatrix,h,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var DA=function(c,h,f,g,C){return{u_matrix:c,u_tl_parent:h,u_scale_parent:f,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(R=C.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(P=C.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:_h(C.paint.get("raster-hue-rotate"))};var P,R};function _h(c){c*=Math.PI/180;var h=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*h-f+1)/3,(Math.sqrt(3)*h-f+1)/3]}var Xi,da=function(c,h,f,g,C,P,R,L,z,W){var ee=C.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:ee.width/ee.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:R,u_coord_matrix:L,u_is_text:+z,u_pitch_with_map:+g,u_texsize:W,u_texture:0}},lo=function(c,h,f,g,C,P,R,L,z,W,ee){var Z=C.transform;return s.extend(da(c,h,f,g,C,P,R,L,z,W),{u_gamma_scale:g?Math.cos(Z._pitch)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},Jl=function(c,h,f,g,C,P,R,L,z,W){return s.extend(lo(c,h,f,g,C,P,R,L,!0,z),{u_texsize_icon:W,u_texture_icon:1})},Da=function(c,h,f){return{u_matrix:c,u_opacity:h,u_color:f}},pc=function(c,h,f,g,C,P){return s.extend(function(R,L,z,W){var ee=z.imageManager.getPattern(R.from.toString()),Z=z.imageManager.getPattern(R.to.toString()),te=z.imageManager.getPixelSize(),se=te.width,we=te.height,Fe=Math.pow(2,W.tileID.overscaledZ),ge=W.tileSize*Math.pow(2,z.transform.tileZoom)/Fe,Re=ge*(W.tileID.canonical.x+W.tileID.wrap*Fe),Ve=ge*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ee.tl,u_pattern_br_a:ee.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[se,we],u_mix:L.t,u_pattern_size_a:ee.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/En(W,1,z.transform.tileZoom),u_pixel_coord_upper:[Re>>16,Ve>>16],u_pixel_coord_lower:[65535&Re,65535&Ve]}}(g,P,f,C),{u_matrix:c,u_opacity:h})},Is={fillExtrusion:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_lightpos:new s.Uniform3f(c,h.u_lightpos),u_lightintensity:new s.Uniform1f(c,h.u_lightintensity),u_lightcolor:new s.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,h.u_vertical_gradient),u_opacity:new s.Uniform1f(c,h.u_opacity)}},fillExtrusionPattern:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_lightpos:new s.Uniform3f(c,h.u_lightpos),u_lightintensity:new s.Uniform1f(c,h.u_lightintensity),u_lightcolor:new s.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,h.u_vertical_gradient),u_height_factor:new s.Uniform1f(c,h.u_height_factor),u_image:new s.Uniform1i(c,h.u_image),u_texsize:new s.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,h.u_scale),u_fade:new s.Uniform1f(c,h.u_fade),u_opacity:new s.Uniform1f(c,h.u_opacity)}},fill:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix)}},fillPattern:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_image:new s.Uniform1i(c,h.u_image),u_texsize:new s.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,h.u_scale),u_fade:new s.Uniform1f(c,h.u_fade)}},fillOutline:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_world:new s.Uniform2f(c,h.u_world)}},fillOutlinePattern:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_world:new s.Uniform2f(c,h.u_world),u_image:new s.Uniform1i(c,h.u_image),u_texsize:new s.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,h.u_scale),u_fade:new s.Uniform1f(c,h.u_fade)}},circle:function(c,h){return{u_camera_to_center_distance:new s.Uniform1f(c,h.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(c,h.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(c,h.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(c,h.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(c,h.u_matrix)}},collisionBox:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_camera_to_center_distance:new s.Uniform1f(c,h.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(c,h.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(c,h.u_extrude_scale),u_overscale_factor:new s.Uniform1f(c,h.u_overscale_factor)}},collisionCircle:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_inv_matrix:new s.UniformMatrix4f(c,h.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(c,h.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(c,h.u_viewport_size)}},debug:function(c,h){return{u_color:new s.UniformColor(c,h.u_color),u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_overlay:new s.Uniform1i(c,h.u_overlay),u_overlay_scale:new s.Uniform1f(c,h.u_overlay_scale)}},clippingMask:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix)}},heatmap:function(c,h){return{u_extrude_scale:new s.Uniform1f(c,h.u_extrude_scale),u_intensity:new s.Uniform1f(c,h.u_intensity),u_matrix:new s.UniformMatrix4f(c,h.u_matrix)}},heatmapTexture:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_world:new s.Uniform2f(c,h.u_world),u_image:new s.Uniform1i(c,h.u_image),u_color_ramp:new s.Uniform1i(c,h.u_color_ramp),u_opacity:new s.Uniform1f(c,h.u_opacity)}},hillshade:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_image:new s.Uniform1i(c,h.u_image),u_latrange:new s.Uniform2f(c,h.u_latrange),u_light:new s.Uniform2f(c,h.u_light),u_shadow:new s.UniformColor(c,h.u_shadow),u_highlight:new s.UniformColor(c,h.u_highlight),u_accent:new s.UniformColor(c,h.u_accent)}},hillshadePrepare:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_image:new s.Uniform1i(c,h.u_image),u_dimension:new s.Uniform2f(c,h.u_dimension),u_zoom:new s.Uniform1f(c,h.u_zoom),u_unpack:new s.Uniform4f(c,h.u_unpack)}},line:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_ratio:new s.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,h.u_units_to_pixels)}},lineGradient:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_ratio:new s.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,h.u_units_to_pixels),u_image:new s.Uniform1i(c,h.u_image),u_image_height:new s.Uniform1f(c,h.u_image_height)}},linePattern:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_texsize:new s.Uniform2f(c,h.u_texsize),u_ratio:new s.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_image:new s.Uniform1i(c,h.u_image),u_units_to_pixels:new s.Uniform2f(c,h.u_units_to_pixels),u_scale:new s.Uniform3f(c,h.u_scale),u_fade:new s.Uniform1f(c,h.u_fade)}},lineSDF:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_ratio:new s.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,h.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(c,h.u_patternscale_a),u_patternscale_b:new s.Uniform2f(c,h.u_patternscale_b),u_sdfgamma:new s.Uniform1f(c,h.u_sdfgamma),u_image:new s.Uniform1i(c,h.u_image),u_tex_y_a:new s.Uniform1f(c,h.u_tex_y_a),u_tex_y_b:new s.Uniform1f(c,h.u_tex_y_b),u_mix:new s.Uniform1f(c,h.u_mix)}},raster:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_tl_parent:new s.Uniform2f(c,h.u_tl_parent),u_scale_parent:new s.Uniform1f(c,h.u_scale_parent),u_buffer_scale:new s.Uniform1f(c,h.u_buffer_scale),u_fade_t:new s.Uniform1f(c,h.u_fade_t),u_opacity:new s.Uniform1f(c,h.u_opacity),u_image0:new s.Uniform1i(c,h.u_image0),u_image1:new s.Uniform1i(c,h.u_image1),u_brightness_low:new s.Uniform1f(c,h.u_brightness_low),u_brightness_high:new s.Uniform1f(c,h.u_brightness_high),u_saturation_factor:new s.Uniform1f(c,h.u_saturation_factor),u_contrast_factor:new s.Uniform1f(c,h.u_contrast_factor),u_spin_weights:new s.Uniform3f(c,h.u_spin_weights)}},symbolIcon:function(c,h){return{u_is_size_zoom_constant:new s.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,h.u_size_t),u_size:new s.Uniform1f(c,h.u_size),u_camera_to_center_distance:new s.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,h.u_pitch),u_rotate_symbol:new s.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,h.u_fade_change),u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new s.Uniform1i(c,h.u_is_text),u_pitch_with_map:new s.Uniform1i(c,h.u_pitch_with_map),u_texsize:new s.Uniform2f(c,h.u_texsize),u_texture:new s.Uniform1i(c,h.u_texture)}},symbolSDF:function(c,h){return{u_is_size_zoom_constant:new s.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,h.u_size_t),u_size:new s.Uniform1f(c,h.u_size),u_camera_to_center_distance:new s.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,h.u_pitch),u_rotate_symbol:new s.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,h.u_fade_change),u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new s.Uniform1i(c,h.u_is_text),u_pitch_with_map:new s.Uniform1i(c,h.u_pitch_with_map),u_texsize:new s.Uniform2f(c,h.u_texsize),u_texture:new s.Uniform1i(c,h.u_texture),u_gamma_scale:new s.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,h.u_is_halo)}},symbolTextAndIcon:function(c,h){return{u_is_size_zoom_constant:new s.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,h.u_size_t),u_size:new s.Uniform1f(c,h.u_size),u_camera_to_center_distance:new s.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,h.u_pitch),u_rotate_symbol:new s.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,h.u_fade_change),u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new s.Uniform1i(c,h.u_is_text),u_pitch_with_map:new s.Uniform1i(c,h.u_pitch_with_map),u_texsize:new s.Uniform2f(c,h.u_texsize),u_texsize_icon:new s.Uniform2f(c,h.u_texsize_icon),u_texture:new s.Uniform1i(c,h.u_texture),u_texture_icon:new s.Uniform1i(c,h.u_texture_icon),u_gamma_scale:new s.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,h.u_is_halo)}},background:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_opacity:new s.Uniform1f(c,h.u_opacity),u_color:new s.UniformColor(c,h.u_color)}},backgroundPattern:function(c,h){return{u_matrix:new s.UniformMatrix4f(c,h.u_matrix),u_opacity:new s.Uniform1f(c,h.u_opacity),u_image:new s.Uniform1i(c,h.u_image),u_pattern_tl_a:new s.Uniform2f(c,h.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(c,h.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(c,h.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(c,h.u_pattern_br_b),u_texsize:new s.Uniform2f(c,h.u_texsize),u_mix:new s.Uniform1f(c,h.u_mix),u_pattern_size_a:new s.Uniform2f(c,h.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(c,h.u_pattern_size_b),u_scale_a:new s.Uniform1f(c,h.u_scale_a),u_scale_b:new s.Uniform1f(c,h.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,h.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(c,h.u_tile_units_to_pixels)}}};function Oa(c,h,f,g,C,P,R){for(var L=c.context,z=L.gl,W=c.useProgram("collisionBox"),ee=[],Z=0,te=0,se=0;se<g.length;se++){var we=g[se],Fe=h.getTile(we),ge=Fe.getBucket(f);if(ge){var Re=we.posMatrix;C[0]===0&&C[1]===0||(Re=c.translatePosMatrix(we.posMatrix,Fe,C,P));var Ve=R?ge.textCollisionBox:ge.iconCollisionBox,$e=ge.collisionCircleArray;if($e.length>0){var rt=s.create(),Je=Re;s.mul(rt,ge.placementInvProjMatrix,c.transform.glCoordMatrix),s.mul(rt,rt,ge.placementViewportMatrix),ee.push({circleArray:$e,circleOffset:te,transform:Je,invTransform:rt}),te=Z+=$e.length/4}Ve&&W.draw(L,z.LINES,ye.disabled,De.disabled,c.colorModeForRenderPass(),be.disabled,Fa(Re,c.transform,Fe),f.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,c.transform.zoom,null,null,Ve.collisionVertexBuffer)}}if(R&&ee.length){var Ze=c.useProgram("collisionCircle"),ft=new s.StructArrayLayout2f1f2i16;ft.resize(4*Z),ft._trim();for(var Pt=0,bt=0,Lt=ee;bt<Lt.length;bt+=1)for(var tr=Lt[bt],br=0;br<tr.circleArray.length/4;br++){var Tr=4*br,gn=tr.circleArray[Tr+0],nr=tr.circleArray[Tr+1],zr=tr.circleArray[Tr+2],Yr=tr.circleArray[Tr+3];ft.emplace(Pt++,gn,nr,zr,Yr,0),ft.emplace(Pt++,gn,nr,zr,Yr,1),ft.emplace(Pt++,gn,nr,zr,Yr,2),ft.emplace(Pt++,gn,nr,zr,Yr,3)}(!Xi||Xi.length<2*Z)&&(Xi=function(_i){var us=2*_i,Zi=new s.StructArrayLayout3ui6;Zi.resize(us),Zi._trim();for(var di=0;di<us;di++){var xi=6*di;Zi.uint16[xi+0]=4*di+0,Zi.uint16[xi+1]=4*di+1,Zi.uint16[xi+2]=4*di+2,Zi.uint16[xi+3]=4*di+2,Zi.uint16[xi+4]=4*di+3,Zi.uint16[xi+5]=4*di+0}return Zi}(Z));for(var Ur=L.createIndexBuffer(Xi,!0),Lr=L.createVertexBuffer(ft,s.collisionCircleLayout.members,!0),Jr=0,Rr=ee;Jr<Rr.length;Jr+=1){var Mr=Rr[Jr],Vi=qu(Mr.transform,Mr.invTransform,c.transform);Ze.draw(L,z.TRIANGLES,ye.disabled,De.disabled,c.colorModeForRenderPass(),be.disabled,Vi,f.id,Lr,Ur,s.SegmentVector.simpleSegment(0,2*Mr.circleOffset,Mr.circleArray.length,Mr.circleArray.length/2),null,c.transform.zoom,null,null,null)}Lr.destroy(),Ur.destroy()}}var Ms=s.identity(new Float32Array(16));function La(c,h,f,g,C,P){var R=s.getAnchorAlignment(c),L=-(R.horizontalAlign-.5)*h,z=-(R.verticalAlign-.5)*f,W=s.evaluateVariableOffset(c,g);return new s.Point((L/C+W[0])*P,(z/C+W[1])*P)}function gc(c,h,f,g,C,P,R,L,z,W,ee){var Z=c.text.placedSymbolArray,te=c.text.dynamicLayoutVertexArray,se=c.icon.dynamicLayoutVertexArray,we={};te.clear();for(var Fe=0;Fe<Z.length;Fe++){var ge=Z.get(Fe),Re=ge.hidden||!ge.crossTileID||c.allowVerticalPlacement&&!ge.placedOrientation?null:g[ge.crossTileID];if(Re){var Ve=new s.Point(ge.anchorX,ge.anchorY),$e=jt(Ve,f?L:R),rt=qr(P.cameraToCenterDistance,$e.signedDistanceFromCamera),Je=C.evaluateSizeForFeature(c.textSizeData,W,ge)*rt/s.ONE_EM;f&&(Je*=c.tilePixelRatio/z);for(var Ze=La(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textBoxScale,Je),ft=f?jt(Ve.add(Ze),R).point:$e.point.add(h?Ze.rotate(-P.angle):Ze),Pt=c.allowVerticalPlacement&&ge.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,bt=0;bt<ge.numGlyphs;bt++)s.addDynamicAttributes(te,ft,Pt);ee&&ge.associatedIconIndex>=0&&(we[ge.associatedIconIndex]={shiftedAnchor:ft,angle:Pt})}else Bi(ge.numGlyphs,te)}if(ee){se.clear();for(var Lt=c.icon.placedSymbolArray,tr=0;tr<Lt.length;tr++){var br=Lt.get(tr);if(br.hidden)Bi(br.numGlyphs,se);else{var Tr=we[tr];if(Tr)for(var gn=0;gn<br.numGlyphs;gn++)s.addDynamicAttributes(se,Tr.shiftedAnchor,Tr.angle);else Bi(br.numGlyphs,se)}}c.icon.dynamicLayoutVertexBuffer.updateData(se)}c.text.dynamicLayoutVertexBuffer.updateData(te)}function mc(c,h,f){return f.iconsInText&&h?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Na(c,h,f,g,C,P,R,L,z,W,ee,Z){for(var te=c.context,se=te.gl,we=c.transform,Fe=L==="map",ge=z==="map",Re=Fe&&f.layout.get("symbol-placement")!=="point",Ve=Fe&&!ge&&!Re,$e=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,rt=!1,Je=c.depthModeForSublayer(0,ye.ReadOnly),Ze=f.layout.get("text-variable-anchor"),ft=[],Pt=0,bt=g;Pt<bt.length;Pt+=1){var Lt=bt[Pt],tr=h.getTile(Lt),br=tr.getBucket(f);if(br){var Tr=C?br.text:br.icon;if(Tr&&Tr.segments.get().length){var gn=Tr.programConfigurations.get(f.id),nr=C||br.sdfIcons,zr=C?br.textSizeData:br.iconSizeData,Yr=ge||we.pitch!==0,Ur=c.useProgram(mc(nr,C,br),gn),Lr=s.evaluateSizeForZoom(zr,we.zoom),Jr=void 0,Rr=[0,0],Mr=void 0,Vi=void 0,_i=null,us=void 0;if(C)Mr=tr.glyphAtlasTexture,Vi=se.LINEAR,Jr=tr.glyphAtlasTexture.size,br.iconsInText&&(Rr=tr.imageAtlasTexture.size,_i=tr.imageAtlasTexture,us=Yr||c.options.rotating||c.options.zooming||zr.kind==="composite"||zr.kind==="camera"?se.LINEAR:se.NEAREST);else{var Zi=f.layout.get("icon-size").constantOr(0)!==1||br.iconsNeedLinear;Mr=tr.imageAtlasTexture,Vi=nr||c.options.rotating||c.options.zooming||Zi||Yr?se.LINEAR:se.NEAREST,Jr=tr.imageAtlasTexture.size}var di=En(tr,1,c.transform.zoom),xi=ur(Lt.posMatrix,ge,Fe,c.transform,di),qs=Ie(Lt.posMatrix,ge,Fe,c.transform,di),vs=Ze&&br.hasTextData(),Tc=f.layout.get("icon-text-fit")!=="none"&&vs&&br.hasIconData();Re&&ia(br,Lt.posMatrix,c,C,xi,qs,ge,W);var Ds=c.translatePosMatrix(Lt.posMatrix,tr,P,R),Wo=Re||C&&Ze||Tc?Ms:xi,xo=c.translatePosMatrix(qs,tr,P,R,!0),of=nr&&f.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0,su={program:Ur,buffers:Tr,uniformValues:nr?br.iconsInText?Jl(zr.kind,Lr,Ve,ge,c,Ds,Wo,xo,Jr,Rr):lo(zr.kind,Lr,Ve,ge,c,Ds,Wo,xo,C,Jr):da(zr.kind,Lr,Ve,ge,c,Ds,Wo,xo,C,Jr),atlasTexture:Mr,atlasTextureIcon:_i,atlasInterpolation:Vi,atlasInterpolationIcon:us,isSDF:nr,hasHalo:of};if($e&&br.canOverlap){rt=!0;for(var Ec=0,ou=Tr.segments.get();Ec<ou.length;Ec+=1){var af=ou[Ec];ft.push({segments:new s.SegmentVector([af]),sortKey:af.sortKey,state:su})}}else ft.push({segments:Tr.segments,sortKey:0,state:su})}}}rt&&ft.sort(function(Bc,Al){return Bc.sortKey-Al.sortKey});for(var pa=0,cf=ft;pa<cf.length;pa+=1){var ga=cf[pa],Hi=ga.state;if(te.activeTexture.set(se.TEXTURE0),Hi.atlasTexture.bind(Hi.atlasInterpolation,se.CLAMP_TO_EDGE),Hi.atlasTextureIcon&&(te.activeTexture.set(se.TEXTURE1),Hi.atlasTextureIcon&&Hi.atlasTextureIcon.bind(Hi.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),Hi.isSDF){var Ga=Hi.uniformValues;Hi.hasHalo&&(Ga.u_is_halo=1,_c(Hi.buffers,ga.segments,f,c,Hi.program,Je,ee,Z,Ga)),Ga.u_is_halo=0}_c(Hi.buffers,ga.segments,f,c,Hi.program,Je,ee,Z,Hi.uniformValues)}}function _c(c,h,f,g,C,P,R,L,z){var W=g.context;C.draw(W,W.gl.TRIANGLES,P,R,L,be.disabled,z,f.id,c.layoutVertexBuffer,c.indexBuffer,h,f.paint,g.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Xl(c,h,f,g,C,P,R){var L,z,W,ee,Z,te=c.context.gl,se=f.paint.get("fill-pattern"),we=se&&se.constantOr(1),Fe=f.getCrossfadeParameters();R?(z=we&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=te.LINES):(z=we?"fillPattern":"fill",L=te.TRIANGLES);for(var ge=0,Re=g;ge<Re.length;ge+=1){var Ve=Re[ge],$e=h.getTile(Ve);if(!we||$e.patternsLoaded()){var rt=$e.getBucket(f);if(rt){var Je=rt.programConfigurations.get(f.id),Ze=c.useProgram(z,Je);we&&(c.context.activeTexture.set(te.TEXTURE0),$e.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Je.updatePaintBuffers(Fe));var ft=se.constantOr(null);if(ft&&$e.imageAtlas){var Pt=$e.imageAtlas,bt=Pt.patternPositions[ft.to.toString()],Lt=Pt.patternPositions[ft.from.toString()];bt&&Lt&&Je.setConstantPatternPositions(bt,Lt)}var tr=c.translatePosMatrix(Ve.posMatrix,$e,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){ee=rt.indexBuffer2,Z=rt.segments2;var br=[te.drawingBufferWidth,te.drawingBufferHeight];W=z==="fillOutlinePattern"&&we?jl(tr,c,Fe,$e,br):gh(tr,br)}else ee=rt.indexBuffer,Z=rt.segments,W=we?js(tr,c,Fe,$e):Lo(tr);Ze.draw(c.context,L,C,c.stencilModeForClipping(Ve),P,be.disabled,W,f.id,rt.layoutVertexBuffer,ee,Z,f.paint,c.transform.zoom,Je)}}}}function ol(c,h,f,g,C,P,R){for(var L=c.context,z=L.gl,W=f.paint.get("fill-extrusion-pattern"),ee=W.constantOr(1),Z=f.getCrossfadeParameters(),te=f.paint.get("fill-extrusion-opacity"),se=0,we=g;se<we.length;se+=1){var Fe=we[se],ge=h.getTile(Fe),Re=ge.getBucket(f);if(Re){var Ve=Re.programConfigurations.get(f.id),$e=c.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",Ve);ee&&(c.context.activeTexture.set(z.TEXTURE0),ge.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ve.updatePaintBuffers(Z));var rt=W.constantOr(null);if(rt&&ge.imageAtlas){var Je=ge.imageAtlas,Ze=Je.patternPositions[rt.to.toString()],ft=Je.patternPositions[rt.from.toString()];Ze&&ft&&Ve.setConstantPatternPositions(Ze,ft)}var Pt=c.translatePosMatrix(Fe.posMatrix,ge,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),bt=f.paint.get("fill-extrusion-vertical-gradient"),Lt=ee?Oo(Pt,c,bt,te,Fe,Z,ge):ph(Pt,c,bt,te);$e.draw(L,L.gl.TRIANGLES,C,P,R,be.backCCW,Lt,f.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,f.paint,c.transform.zoom,Ve)}}}function Kl(c,h,f,g,C,P){var R=c.context,L=R.gl,z=h.fbo;if(z){var W=c.useProgram("hillshade");R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,z.colorAttachment.get());var ee=function(Z,te,se){var we=se.paint.get("hillshade-shadow-color"),Fe=se.paint.get("hillshade-highlight-color"),ge=se.paint.get("hillshade-accent-color"),Re=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(Re-=Z.transform.angle);var Ve,$e,rt,Je=!Z.options.moving;return{u_matrix:Z.transform.calculatePosMatrix(te.tileID.toUnwrapped(),Je),u_image:0,u_latrange:(Ve=te.tileID,$e=Math.pow(2,Ve.canonical.z),rt=Ve.canonical.y,[new s.MercatorCoordinate(0,rt/$e).toLngLat().lat,new s.MercatorCoordinate(0,(rt+1)/$e).toLngLat().lat]),u_light:[se.paint.get("hillshade-exaggeration"),Re],u_shadow:we,u_highlight:Fe,u_accent:ge}}(c,h,f);W.draw(R,L.TRIANGLES,g,C,P,be.disabled,ee,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function OA(c,h,f,g,C,P){var R=c.context,L=R.gl,z=h.dem;if(z&&z.data){var W=z.dim,ee=z.stride,Z=z.getPixels();if(R.activeTexture.set(L.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||c.getTileTexture(ee),h.demTexture){var te=h.demTexture;te.update(Z,{premultiply:!1}),te.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new s.Texture(R,Z,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);R.activeTexture.set(L.TEXTURE0);var se=h.fbo;if(!se){var we=new s.Texture(R,{width:W,height:W,data:null},L.RGBA);we.bind(L.LINEAR,L.CLAMP_TO_EDGE),(se=h.fbo=R.createFramebuffer(W,W,!0)).colorAttachment.set(we.texture)}R.bindFramebuffer.set(se.framebuffer),R.viewport.set([0,0,W,W]),c.useProgram("hillshadePrepare").draw(R,L.TRIANGLES,g,C,P,be.disabled,function(Fe,ge){var Re=ge.stride,Ve=s.create();return s.ortho(Ve,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(Ve,Ve,[0,-s.EXTENT,0]),{u_matrix:Ve,u_image:1,u_dimension:[Re,Re],u_zoom:Fe.overscaledZ,u_unpack:ge.getUnpackVector()}}(h.tileID,z),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function al(c,h,f,g,C){var P=g.paint.get("raster-fade-duration");if(P>0){var R=s.browser.now(),L=(R-c.timeAdded)/P,z=h?(R-h.timeAdded)/P:-1,W=f.getSource(),ee=C.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),Z=!h||Math.abs(h.tileID.overscaledZ-ee)>Math.abs(c.tileID.overscaledZ-ee),te=Z&&c.refreshedUponExpiration?1:s.clamp(Z?L:1-z,0,1);return c.refreshedUponExpiration&&L>=1&&(c.refreshedUponExpiration=!1),h?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}var ql=new s.Color(1,0,0,1),yc=new s.Color(0,1,0,1),ka=new s.Color(0,0,1,1),Yl=new s.Color(1,0,1,1),Ua=new s.Color(0,1,1,1);function Yu(c,h,f,g){cl(c,0,h+f/2,c.transform.width,f,g)}function Zu(c,h,f,g){cl(c,h-f/2,0,f,c.transform.height,g)}function cl(c,h,f,g,C,P){var R=c.context,L=R.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*s.browser.devicePixelRatio,f*s.browser.devicePixelRatio,g*s.browser.devicePixelRatio,C*s.browser.devicePixelRatio),R.clear({color:P}),L.disable(L.SCISSOR_TEST)}function yh(c,h,f){var g=c.context,C=g.gl,P=f.posMatrix,R=c.useProgram("debug"),L=ye.disabled,z=De.disabled,W=c.colorModeForRenderPass();g.activeTexture.set(C.TEXTURE0),c.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R.draw(g,C.LINE_STRIP,L,z,W,be.disabled,No(P,s.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var ee=h.getTileByID(f.key).latestRawTileData,Z=Math.floor((ee&&ee.byteLength||0)/1024),te=h.getTile(f).tileSize,se=512/Math.min(te,512)*(f.overscaledZ/c.transform.zoom)*.5,we=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(we+=" => "+f.overscaledZ),function(Fe,ge){Fe.initDebugOverlayCanvas();var Re=Fe.debugOverlayCanvas,Ve=Fe.context.gl,$e=Fe.debugOverlayCanvas.getContext("2d");$e.clearRect(0,0,Re.width,Re.height),$e.shadowColor="white",$e.shadowBlur=2,$e.lineWidth=1.5,$e.strokeStyle="white",$e.textBaseline="top",$e.font="bold 36px Open Sans, sans-serif",$e.fillText(ge,5,5),$e.strokeText(ge,5,5),Fe.debugOverlayTexture.update(Re),Fe.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(c,we+" "+Z+"kb"),R.draw(g,C.TRIANGLES,L,z,fe.alphaBlended,be.disabled,No(P,s.Color.transparent,se),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var za={symbol:function(c,h,f,g,C){if(c.renderPass==="translucent"){var P=De.disabled,R=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(L,z,W,ee,Z,te,se){for(var we=z.transform,Fe=Z==="map",ge=te==="map",Re=0,Ve=L;Re<Ve.length;Re+=1){var $e=Ve[Re],rt=ee.getTile($e),Je=rt.getBucket(W);if(Je&&Je.text&&Je.text.segments.get().length){var Ze=s.evaluateSizeForZoom(Je.textSizeData,we.zoom),ft=En(rt,1,z.transform.zoom),Pt=ur($e.posMatrix,ge,Fe,z.transform,ft),bt=W.layout.get("icon-text-fit")!=="none"&&Je.hasIconData();if(Ze){var Lt=Math.pow(2,we.zoom-rt.tileID.overscaledZ);gc(Je,Fe,ge,se,s.symbolSize,we,Pt,$e.posMatrix,Lt,Ze,bt)}}}}(g,c,f,h,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),C),f.paint.get("icon-opacity").constantOr(1)!==0&&Na(c,h,f,g,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),P,R),f.paint.get("text-opacity").constantOr(1)!==0&&Na(c,h,f,g,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),P,R),h.map.showCollisionBoxes&&(Oa(c,h,f,g,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),Oa(c,h,f,g,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,h,f,g){if(c.renderPass==="translucent"){var C=f.paint.get("circle-opacity"),P=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),L=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(C.constantOr(1)!==0||P.constantOr(1)!==0&&R.constantOr(1)!==0){for(var z=c.context,W=z.gl,ee=c.depthModeForSublayer(0,ye.ReadOnly),Z=De.disabled,te=c.colorModeForRenderPass(),se=[],we=0;we<g.length;we++){var Fe=g[we],ge=h.getTile(Fe),Re=ge.getBucket(f);if(Re){var Ve=Re.programConfigurations.get(f.id),$e={programConfiguration:Ve,program:c.useProgram("circle",Ve),layoutVertexBuffer:Re.layoutVertexBuffer,indexBuffer:Re.indexBuffer,uniformValues:$l(c,Fe,ge,f)};if(L)for(var rt=0,Je=Re.segments.get();rt<Je.length;rt+=1){var Ze=Je[rt];se.push({segments:new s.SegmentVector([Ze]),sortKey:Ze.sortKey,state:$e})}else se.push({segments:Re.segments,sortKey:0,state:$e})}}L&&se.sort(function(tr,br){return tr.sortKey-br.sortKey});for(var ft=0,Pt=se;ft<Pt.length;ft+=1){var bt=Pt[ft],Lt=bt.state;Lt.program.draw(z,W.TRIANGLES,ee,Z,te,be.disabled,Lt.uniformValues,f.id,Lt.layoutVertexBuffer,Lt.indexBuffer,bt.segments,f.paint,c.transform.zoom,Lt.programConfiguration)}}}},heatmap:function(c,h,f,g){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var C=c.context,P=C.gl,R=De.disabled,L=new fe([P.ONE,P.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(se,we,Fe){var ge=se.gl;se.activeTexture.set(ge.TEXTURE1),se.viewport.set([0,0,we.width/4,we.height/4]);var Re=Fe.heatmapFbo;if(Re)ge.bindTexture(ge.TEXTURE_2D,Re.colorAttachment.get()),se.bindFramebuffer.set(Re.framebuffer);else{var Ve=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,Ve),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Re=Fe.heatmapFbo=se.createFramebuffer(we.width/4,we.height/4,!1),function($e,rt,Je,Ze){var ft=$e.gl;ft.texImage2D(ft.TEXTURE_2D,0,ft.RGBA,rt.width/4,rt.height/4,0,ft.RGBA,$e.extRenderToTextureHalfFloat?$e.extTextureHalfFloat.HALF_FLOAT_OES:ft.UNSIGNED_BYTE,null),Ze.colorAttachment.set(Je)}(se,we,Ve,Re)}})(C,c,f),C.clear({color:s.Color.transparent});for(var z=0;z<g.length;z++){var W=g[z];if(!h.hasRenderableParent(W)){var ee=h.getTile(W),Z=ee.getBucket(f);if(Z){var te=Z.programConfigurations.get(f.id);c.useProgram("heatmap",te).draw(C,P.TRIANGLES,ye.disabled,R,L,be.disabled,sl(W.posMatrix,ee,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,f.paint,c.transform.zoom,te)}}}C.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(se,we){var Fe=se.context,ge=Fe.gl,Re=we.heatmapFbo;if(Re){Fe.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Re.colorAttachment.get()),Fe.activeTexture.set(ge.TEXTURE1);var Ve=we.colorRampTexture;Ve||(Ve=we.colorRampTexture=new s.Texture(Fe,we.colorRamp,ge.RGBA)),Ve.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),se.useProgram("heatmapTexture").draw(Fe,ge.TRIANGLES,ye.disabled,De.disabled,se.colorModeForRenderPass(),be.disabled,function($e,rt,Je,Ze){var ft=s.create();s.ortho(ft,0,$e.width,$e.height,0,0,1);var Pt=$e.context.gl;return{u_matrix:ft,u_world:[Pt.drawingBufferWidth,Pt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:rt.paint.get("heatmap-opacity")}}(se,we),we.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments,we.paint,se.transform.zoom)}}(c,f))},line:function(c,h,f,g){if(c.renderPass==="translucent"){var C=f.paint.get("line-opacity"),P=f.paint.get("line-width");if(C.constantOr(1)!==0&&P.constantOr(1)!==0)for(var R=c.depthModeForSublayer(0,ye.ReadOnly),L=c.colorModeForRenderPass(),z=f.paint.get("line-dasharray"),W=f.paint.get("line-pattern"),ee=W.constantOr(1),Z=f.paint.get("line-gradient"),te=f.getCrossfadeParameters(),se=ee?"linePattern":z?"lineSDF":Z?"lineGradient":"line",we=c.context,Fe=we.gl,ge=!0,Re=0,Ve=g;Re<Ve.length;Re+=1){var $e=Ve[Re],rt=h.getTile($e);if(!ee||rt.patternsLoaded()){var Je=rt.getBucket(f);if(Je){var Ze=Je.programConfigurations.get(f.id),ft=c.context.program.get(),Pt=c.useProgram(se,Ze),bt=ge||Pt.program!==ft,Lt=W.constantOr(null);if(Lt&&rt.imageAtlas){var tr=rt.imageAtlas,br=tr.patternPositions[Lt.to.toString()],Tr=tr.patternPositions[Lt.from.toString()];br&&Tr&&Ze.setConstantPatternPositions(br,Tr)}var gn=ee?Wl(c,rt,f,te):z?FA(c,rt,f,z,te):Z?In(c,rt,f,Je.lineClipsArray.length):Bn(c,rt,f);if(ee)we.activeTexture.set(Fe.TEXTURE0),rt.imageAtlasTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Ze.updatePaintBuffers(te);else if(z&&(bt||c.lineAtlas.dirty))we.activeTexture.set(Fe.TEXTURE0),c.lineAtlas.bind(we);else if(Z){var nr=Je.gradients[f.id],zr=nr.texture;if(f.gradientVersion!==nr.version){var Yr=256;if(f.stepInterpolant){var Ur=h.getSource().maxzoom,Lr=$e.canonical.z===Ur?Math.ceil(1<<c.transform.maxZoom-$e.canonical.z):1;Yr=s.clamp(s.nextPowerOfTwo(Je.maxLineLength/s.EXTENT*1024*Lr),256,we.maxTextureSize)}nr.gradient=s.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Yr,image:nr.gradient||void 0,clips:Je.lineClipsArray}),nr.texture?nr.texture.update(nr.gradient):nr.texture=new s.Texture(we,nr.gradient,Fe.RGBA),nr.version=f.gradientVersion,zr=nr.texture}we.activeTexture.set(Fe.TEXTURE0),zr.bind(f.stepInterpolant?Fe.NEAREST:Fe.LINEAR,Fe.CLAMP_TO_EDGE)}Pt.draw(we,Fe.TRIANGLES,R,c.stencilModeForClipping($e),L,be.disabled,gn,f.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,f.paint,c.transform.zoom,Ze,Je.layoutVertexBuffer2),ge=!1}}}}},fill:function(c,h,f,g){var C=f.paint.get("fill-color"),P=f.paint.get("fill-opacity");if(P.constantOr(1)!==0){var R=c.colorModeForRenderPass(),L=f.paint.get("fill-pattern"),z=c.opaquePassEnabledForLayer()&&!L.constantOr(1)&&C.constantOr(s.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===z){var W=c.depthModeForSublayer(1,c.renderPass==="opaque"?ye.ReadWrite:ye.ReadOnly);Xl(c,h,f,g,W,R,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var ee=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,ye.ReadOnly);Xl(c,h,f,g,ee,R,!0)}}},"fill-extrusion":function(c,h,f,g){var C=f.paint.get("fill-extrusion-opacity");if(C!==0&&c.renderPass==="translucent"){var P=new ye(c.context.gl.LEQUAL,ye.ReadWrite,c.depthRangeFor3D);if(C!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))ol(c,h,f,g,P,De.disabled,fe.disabled),ol(c,h,f,g,P,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var R=c.colorModeForRenderPass();ol(c,h,f,g,P,De.disabled,R)}}},hillshade:function(c,h,f,g){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var C=c.context,P=c.depthModeForSublayer(0,ye.ReadOnly),R=c.colorModeForRenderPass(),L=c.renderPass==="translucent"?c.stencilConfigForOverlap(g):[{},g],z=L[0],W=0,ee=L[1];W<ee.length;W+=1){var Z=ee[W],te=h.getTile(Z);te.needsHillshadePrepare&&c.renderPass==="offscreen"?OA(c,te,f,P,De.disabled,R):c.renderPass==="translucent"&&Kl(c,te,f,P,z[Z.overscaledZ],R)}C.viewport.set([0,0,c.width,c.height])}},raster:function(c,h,f,g){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&g.length)for(var C=c.context,P=C.gl,R=h.getSource(),L=c.useProgram("raster"),z=c.colorModeForRenderPass(),W=R instanceof ct?[{},g]:c.stencilConfigForOverlap(g),ee=W[0],Z=W[1],te=Z[Z.length-1].overscaledZ,se=!c.options.moving,we=0,Fe=Z;we<Fe.length;we+=1){var ge=Fe[we],Re=c.depthModeForSublayer(ge.overscaledZ-te,f.paint.get("raster-opacity")===1?ye.ReadWrite:ye.ReadOnly,P.LESS),Ve=h.getTile(ge),$e=c.transform.calculatePosMatrix(ge.toUnwrapped(),se);Ve.registerFadeDuration(f.paint.get("raster-fade-duration"));var rt=h.findLoadedParent(ge,0),Je=al(Ve,rt,h,f,c.transform),Ze=void 0,ft=void 0,Pt=f.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;C.activeTexture.set(P.TEXTURE0),Ve.texture.bind(Pt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(P.TEXTURE1),rt?(rt.texture.bind(Pt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Ze=Math.pow(2,rt.tileID.overscaledZ-Ve.tileID.overscaledZ),ft=[Ve.tileID.canonical.x*Ze%1,Ve.tileID.canonical.y*Ze%1]):Ve.texture.bind(Pt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var bt=DA($e,ft||[0,0],Ze||1,Je,f);R instanceof ct?L.draw(C,P.TRIANGLES,Re,De.disabled,z,be.disabled,bt,f.id,R.boundsBuffer,c.quadTriangleIndexBuffer,R.boundsSegments):L.draw(C,P.TRIANGLES,Re,ee[ge.overscaledZ],z,be.disabled,bt,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,h,f){var g=f.paint.get("background-color"),C=f.paint.get("background-opacity");if(C!==0){var P=c.context,R=P.gl,L=c.transform,z=L.tileSize,W=f.paint.get("background-pattern");if(!c.isPatternMissing(W)){var ee=!W&&g.a===1&&C===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===ee){var Z=De.disabled,te=c.depthModeForSublayer(0,ee==="opaque"?ye.ReadWrite:ye.ReadOnly),se=c.colorModeForRenderPass(),we=c.useProgram(W?"backgroundPattern":"background"),Fe=L.coveringTiles({tileSize:z});W&&(P.activeTexture.set(R.TEXTURE0),c.imageManager.bind(c.context));for(var ge=f.getCrossfadeParameters(),Re=0,Ve=Fe;Re<Ve.length;Re+=1){var $e=Ve[Re],rt=c.transform.calculatePosMatrix($e.toUnwrapped()),Je=W?pc(rt,C,c,W,{tileID:$e,tileSize:z},ge):Da(rt,C,g);we.draw(P,R.TRIANGLES,te,Z,se,be.disabled,Je,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,h,f){for(var g=0;g<f.length;g++)yh(c,h,f[g])},custom:function(c,h,f){var g=c.context,C=f.implementation;if(c.renderPass==="offscreen"){var P=C.prerender;P&&(c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),P.call(C,g.gl,c.transform.customLayerMatrix()),g.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),g.setStencilMode(De.disabled);var R=C.renderingMode==="3d"?new ye(c.context.gl.LEQUAL,ye.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ye.ReadOnly);g.setDepthMode(R),C.render(g.gl,c.transform.customLayerMatrix()),g.setDirty(),c.setBaseState(),g.bindFramebuffer.set(null)}}},zn=function(c,h){this.context=new ae(c),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Be.maxUnderzooming+Be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new oa,this.gpuTimers={}};zn.prototype.resize=function(c,h){if(this.width=c*s.browser.devicePixelRatio,this.height=h*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,g=this.style._order;f<g.length;f+=1)this.style._layers[g[f]].resize()},zn.prototype.setup=function(){var c=this.context,h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,ii.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=c.createVertexBuffer(f,ii.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var g=new s.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(s.EXTENT,0,s.EXTENT,0),g.emplaceBack(0,s.EXTENT,0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(g,tt.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var C=new s.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(C,ii.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var P=new s.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(P);var R=new s.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(R),this.emptyTexture=new s.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new De({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},zn.prototype.clearStencil=function(){var c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=s.create();s.ortho(f,0,this.width,this.height,0,0,1),s.scale(f,f,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,h.TRIANGLES,ye.disabled,this.stencilClearMode,fe.disabled,be.disabled,ko(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},zn.prototype._renderTileClippingMasks=function(c,h){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&h&&h.length){this.currentStencilSource=c.source;var f=this.context,g=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(fe.disabled),f.setDepthMode(ye.disabled);var C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,R=h;P<R.length;P+=1){var L=R[P],z=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;C.draw(f,g.TRIANGLES,ye.disabled,new De({func:g.ALWAYS,mask:0},z,255,g.KEEP,g.KEEP,g.REPLACE),fe.disabled,be.disabled,ko(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},zn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,h=this.context.gl;return new De({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)},zn.prototype.stencilModeForClipping=function(c){var h=this.context.gl;return new De({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)},zn.prototype.stencilConfigForOverlap=function(c){var h,f=this.context.gl,g=c.sort(function(z,W){return W.overscaledZ-z.overscaledZ}),C=g[g.length-1].overscaledZ,P=g[0].overscaledZ-C+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var R={},L=0;L<P;L++)R[L+C]=new De({func:f.GEQUAL,mask:255},L+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=P,[R,g]}return[(h={},h[C]=De.disabled,h),g]},zn.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new fe([c.CONSTANT_COLOR,c.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fe.unblended:fe.alphaBlended},zn.prototype.depthModeForSublayer=function(c,h,f){if(!this.opaquePassEnabledForLayer())return ye.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new ye(f||this.context.gl.LEQUAL,h,[g,g])},zn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},zn.prototype.render=function(c,h){var f=this;this.style=c,this.options=h,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var g=this.style._order,C=this.style.sourceCaches;for(var P in C){var R=C[P];R.used&&R.prepare(this.context)}var L,z,W={},ee={},Z={};for(var te in C){var se=C[te];W[te]=se.getVisibleCoordinates(),ee[te]=W[te].slice().reverse(),Z[te]=se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var we=0;we<g.length;we++)if(this.style._layers[g[we]].is3D()){this.opaquePassCutoff=we;break}this.renderPass="offscreen";for(var Fe=0,ge=g;Fe<ge.length;Fe+=1){var Re=this.style._layers[ge[Fe]];if(Re.hasOffscreenPass()&&!Re.isHidden(this.transform.zoom)){var Ve=ee[Re.source];(Re.type==="custom"||Ve.length)&&this.renderLayer(this,C[Re.source],Re,Ve)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var $e=this.style._layers[g[this.currentLayer]],rt=C[$e.source],Je=W[$e.source];this._renderTileClippingMasks($e,Je),this.renderLayer(this,rt,$e,Je)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var Ze=this.style._layers[g[this.currentLayer]],ft=C[Ze.source],Pt=(Ze.type==="symbol"?Z:ee)[Ze.source];this._renderTileClippingMasks(Ze,W[Ze.source]),this.renderLayer(this,ft,Ze,Pt)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach(function(bt){bt.source&&!bt.isHidden(f.transform.zoom)&&(bt.source!==(z&&z.id)&&(z=f.style.sourceCaches[bt.source]),(!L||L.getSource().maxzoom<z.getSource().maxzoom)&&(L=z))}),L&&za.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(bt){var Lt=bt.transform.padding;Yu(bt,bt.transform.height-(Lt.top||0),3,ql),Yu(bt,Lt.bottom||0,3,yc),Zu(bt,Lt.left||0,3,ka),Zu(bt,bt.transform.width-(Lt.right||0),3,Yl);var tr=bt.transform.centerPoint;(function(br,Tr,gn,nr){cl(br,Tr-1,gn-10,2,20,nr),cl(br,Tr-10,gn-1,20,2,nr)})(bt,tr.x,bt.transform.height-tr.y,Ua)}(this),this.context.setDefault()},zn.prototype.renderLayer=function(c,h,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||g.length)&&(this.id=f.id,this.gpuTimingStart(f),za[f.type](c,h,f,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},zn.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var h=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),f.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,f.query)}},zn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},zn.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},zn.prototype.queryGpuTimers=function(c){var h={};for(var f in c){var g=c[f],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(g.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(g.query),h[f]=P}return h},zn.prototype.translatePosMatrix=function(c,h,f,g,C){if(!f[0]&&!f[1])return c;var P=C?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(P){var R=Math.sin(P),L=Math.cos(P);f=[f[0]*L-f[1]*R,f[0]*R+f[1]*L]}var z=[C?f[0]:En(h,f[0],this.transform.zoom),C?f[1]:En(h,f[1],this.transform.zoom),0],W=new Float32Array(16);return s.translate(W,c,z),W},zn.prototype.saveTileTexture=function(c){var h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]},zn.prototype.getTileTexture=function(c){var h=this._tileTextures[c];return h&&h.length>0?h.pop():null},zn.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var h=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!h||!f},zn.prototype.useProgram=function(c,h){this.cache=this.cache||{};var f=""+c+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new Ah(this.context,c,Vl[c],h,Is[c],this._showOverdrawInspector)),this.cache[f]},zn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},zn.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},zn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},zn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Zl=function(c,h){this.points=c,this.planes=h};Zl.fromInvProjectionMatrix=function(c,h,f){var g=Math.pow(2,f),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return s.transformMat4([],R,c)}).map(function(R){return s.scale$1([],R,1/R[3]/h*g)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var L=s.sub([],C[R[0]],C[R[1]]),z=s.sub([],C[R[2]],C[R[1]]),W=s.normalize([],s.cross([],L,z)),ee=-s.dot(W,C[R[1]]);return W.concat(ee)});return new Zl(C,P)};var Uo=function(c,h){this.min=c,this.max=h,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};Uo.prototype.quadrant=function(c){for(var h=[c%2==0,c<2],f=s.clone$2(this.min),g=s.clone$2(this.max),C=0;C<h.length;C++)f[C]=h[C]?this.min[C]:this.center[C],g[C]=h[C]?this.center[C]:this.max[C];return g[2]=this.max[2],new Uo(f,g)},Uo.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Uo.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Uo.prototype.intersects=function(c){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,g=0;g<c.planes.length;g++){for(var C=c.planes[g],P=0,R=0;R<h.length;R++)P+=s.dot$1(C,h[R])>=0;if(P===0)return 0;P!==h.length&&(f=!1)}if(f)return 2;for(var L=0;L<3;L++){for(var z=Number.MAX_VALUE,W=-Number.MAX_VALUE,ee=0;ee<c.points.length;ee++){var Z=c.points[ee][L]-this.min[L];z=Math.min(z,Z),W=Math.max(W,Z)}if(W<0||z>this.max[L]-this.min[L])return 0}return 1};var zo=function(c,h,f,g){if(c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0),g===void 0&&(g=0),isNaN(c)||c<0||isNaN(h)||h<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=f,this.right=g};zo.prototype.interpolate=function(c,h,f){return h.top!=null&&c.top!=null&&(this.top=s.number(c.top,h.top,f)),h.bottom!=null&&c.bottom!=null&&(this.bottom=s.number(c.bottom,h.bottom,f)),h.left!=null&&c.left!=null&&(this.left=s.number(c.left,h.left,f)),h.right!=null&&c.right!=null&&(this.right=s.number(c.right,h.right,f)),this},zo.prototype.getCenter=function(c,h){var f=s.clamp((this.left+c-this.right)/2,0,c),g=s.clamp((this.top+h-this.bottom)/2,0,h);return new s.Point(f,g)},zo.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},zo.prototype.clone=function(){return new zo(this.top,this.bottom,this.left,this.right)},zo.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var sn=function(c,h,f,g,C){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=C===void 0||C,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zo,this._posMatrixCache={},this._alignedPosMatrixCache={}},Mn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};sn.prototype.clone=function(){var c=new sn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},Mn.minZoom.get=function(){return this._minZoom},Mn.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},Mn.maxZoom.get=function(){return this._maxZoom},Mn.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},Mn.minPitch.get=function(){return this._minPitch},Mn.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},Mn.maxPitch.get=function(){return this._maxPitch},Mn.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},Mn.renderWorldCopies.get=function(){return this._renderWorldCopies},Mn.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},Mn.worldSize.get=function(){return this.tileSize*this.scale},Mn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Mn.size.get=function(){return new s.Point(this.width,this.height)},Mn.bearing.get=function(){return-this.angle/Math.PI*180},Mn.bearing.set=function(c){var h=-s.wrap(c,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Mn.pitch.get=function(){return this._pitch/Math.PI*180},Mn.pitch.set=function(c){var h=s.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Mn.fov.get=function(){return this._fov/Math.PI*180},Mn.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},Mn.zoom.get=function(){return this._zoom},Mn.zoom.set=function(c){var h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Mn.center.get=function(){return this._center},Mn.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},Mn.padding.get=function(){return this._edgeInsets.toJSON()},Mn.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},Mn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},sn.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},sn.prototype.interpolatePadding=function(c,h,f){this._unmodified=!1,this._edgeInsets.interpolate(c,h,f),this._constrain(),this._calcMatrices()},sn.prototype.coveringZoomLevel=function(c){var h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)},sn.prototype.getVisibleUnwrappedCoordinates=function(c){var h=[new s.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new s.Point(0,0)),g=this.pointCoordinate(new s.Point(this.width,0)),C=this.pointCoordinate(new s.Point(this.width,this.height)),P=this.pointCoordinate(new s.Point(0,this.height)),R=Math.floor(Math.min(f.x,g.x,C.x,P.x)),L=Math.floor(Math.max(f.x,g.x,C.x,P.x)),z=R-1;z<=L+1;z++)z!==0&&h.push(new s.UnwrappedTileID(z,c));return h},sn.prototype.coveringTiles=function(c){var h=this.coveringZoomLevel(c),f=h;if(c.minzoom!==void 0&&h<c.minzoom)return[];c.maxzoom!==void 0&&h>c.maxzoom&&(h=c.maxzoom);var g=s.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,h),P=[C*g.x,C*g.y,0],R=Zl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var z=function(bt){return{aabb:new Uo([bt*C,0,0],[(bt+1)*C,C,0]),zoom:0,x:0,y:0,wrap:bt,fullyVisible:!1}},W=[],ee=[],Z=h,te=c.reparseOverscaled?f:h;if(this._renderWorldCopies)for(var se=1;se<=3;se++)W.push(z(-se)),W.push(z(se));for(W.push(z(0));W.length>0;){var we=W.pop(),Fe=we.x,ge=we.y,Re=we.fullyVisible;if(!Re){var Ve=we.aabb.intersects(R);if(Ve===0)continue;Re=Ve===2}var $e=we.aabb.distanceX(P),rt=we.aabb.distanceY(P),Je=Math.max(Math.abs($e),Math.abs(rt));if(we.zoom===Z||Je>3+(1<<Z-we.zoom)-2&&we.zoom>=L)ee.push({tileID:new s.OverscaledTileID(we.zoom===Z?te:we.zoom,we.wrap,we.zoom,Fe,ge),distanceSq:s.sqrLen([P[0]-.5-Fe,P[1]-.5-ge])});else for(var Ze=0;Ze<4;Ze++){var ft=(Fe<<1)+Ze%2,Pt=(ge<<1)+(Ze>>1);W.push({aabb:we.aabb.quadrant(Ze),zoom:we.zoom+1,x:ft,y:Pt,wrap:we.wrap,fullyVisible:Re})}}return ee.sort(function(bt,Lt){return bt.distanceSq-Lt.distanceSq}).map(function(bt){return bt.tileID})},sn.prototype.resize=function(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()},Mn.unmodified.get=function(){return this._unmodified},sn.prototype.zoomScale=function(c){return Math.pow(2,c)},sn.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},sn.prototype.project=function(c){var h=s.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(c.lng)*this.worldSize,s.mercatorYfromLat(h)*this.worldSize)},sn.prototype.unproject=function(c){return new s.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},Mn.point.get=function(){return this.project(this.center)},sn.prototype.setLocationAtPoint=function(c,h){var f=this.pointCoordinate(h),g=this.pointCoordinate(this.centerPoint),C=this.locationCoordinate(c),P=new s.MercatorCoordinate(C.x-(f.x-g.x),C.y-(f.y-g.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},sn.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},sn.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},sn.prototype.locationCoordinate=function(c){return s.MercatorCoordinate.fromLngLat(c)},sn.prototype.coordinateLocation=function(c){return c.toLngLat()},sn.prototype.pointCoordinate=function(c){var h=[c.x,c.y,0,1],f=[c.x,c.y,1,1];s.transformMat4(h,h,this.pixelMatrixInverse),s.transformMat4(f,f,this.pixelMatrixInverse);var g=h[3],C=f[3],P=h[1]/g,R=f[1]/C,L=h[2]/g,z=f[2]/C,W=L===z?0:(0-L)/(z-L);return new s.MercatorCoordinate(s.number(h[0]/g,f[0]/C,W)/this.worldSize,s.number(P,R,W)/this.worldSize)},sn.prototype.coordinatePoint=function(c){var h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return s.transformMat4(h,h,this.pixelMatrix),new s.Point(h[0]/h[3],h[1]/h[3])},sn.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},sn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},sn.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},sn.prototype.calculatePosMatrix=function(c,h){h===void 0&&(h=!1);var f=c.key,g=h?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];var C=c.canonical,P=this.worldSize/this.zoomScale(C.z),R=C.x+Math.pow(2,C.z)*c.wrap,L=s.identity(new Float64Array(16));return s.translate(L,L,[R*P,C.y*P,0]),s.scale(L,L,[P/s.EXTENT,P/s.EXTENT,1]),s.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),g[f]=new Float32Array(L),g[f]},sn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},sn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,h,f,g,C=-90,P=90,R=-180,L=180,z=this.size,W=this._unmodified;if(this.latRange){var ee=this.latRange;C=s.mercatorYfromLat(ee[1])*this.worldSize,c=(P=s.mercatorYfromLat(ee[0])*this.worldSize)-C<z.y?z.y/(P-C):0}if(this.lngRange){var Z=this.lngRange;R=s.mercatorXfromLng(Z[0])*this.worldSize,h=(L=s.mercatorXfromLng(Z[1])*this.worldSize)-R<z.x?z.x/(L-R):0}var te=this.point,se=Math.max(h||0,c||0);if(se)return this.center=this.unproject(new s.Point(h?(L+R)/2:te.x,c?(P+C)/2:te.y)),this.zoom+=this.scaleZoom(se),this._unmodified=W,void(this._constraining=!1);if(this.latRange){var we=te.y,Fe=z.y/2;we-Fe<C&&(g=C+Fe),we+Fe>P&&(g=P-Fe)}if(this.lngRange){var ge=te.x,Re=z.x/2;ge-Re<R&&(f=R+Re),ge+Re>L&&(f=L-Re)}f===void 0&&g===void 0||(this.center=this.unproject(new s.Point(f!==void 0?f:te.x,g!==void 0?g:te.y))),this._unmodified=W,this._constraining=!1}},sn.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),g=Math.sin(f)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-h-f,.01,Math.PI-.01)),C=this.point,P=C.x,R=C.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),z=this.height/50,W=new Float64Array(16);s.perspective(W,this._fov,this.width/this.height,z,L),W[8]=2*-c.x/this.width,W[9]=2*c.y/this.height,s.scale(W,W,[1,-1,1]),s.translate(W,W,[0,0,-this.cameraToCenterDistance]),s.rotateX(W,W,this._pitch),s.rotateZ(W,W,this.angle),s.translate(W,W,[-P,-R,0]),this.mercatorMatrix=s.scale([],W,[this.worldSize,this.worldSize,this.worldSize]),s.scale(W,W,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=W,this.invProjMatrix=s.invert([],this.projMatrix);var ee=this.width%2/2,Z=this.height%2/2,te=Math.cos(this.angle),se=Math.sin(this.angle),we=P-Math.round(P)+te*ee+se*Z,Fe=R-Math.round(R)+te*Z+se*ee,ge=new Float64Array(W);if(s.translate(ge,ge,[we>.5?we-1:we,Fe>.5?Fe-1:Fe,0]),this.alignedProjMatrix=ge,W=s.create(),s.scale(W,W,[this.width/2,-this.height/2,1]),s.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=s.create(),s.scale(W,W,[1,-1,1]),s.translate(W,W,[-1,-1,0]),s.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(W=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._posMatrixCache={},this._alignedPosMatrixCache={}}},sn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new s.Point(0,0)),h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return s.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},sn.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,c))},sn.prototype.getCameraQueryGeometry=function(c){var h=this.getCameraPoint();if(c.length===1)return[c[0],h];for(var f=h.x,g=h.y,C=h.x,P=h.y,R=0,L=c;R<L.length;R+=1){var z=L[R];f=Math.min(f,z.x),g=Math.min(g,z.y),C=Math.max(C,z.x),P=Math.max(P,z.y)}return[new s.Point(f,g),new s.Point(C,g),new s.Point(C,P),new s.Point(f,P),new s.Point(f,g)]},Object.defineProperties(sn.prototype,Mn);var Ps=function(c){var h,f,g,C;this._hashName=c&&encodeURIComponent(c),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),f=!1,g=null,C=function(){g=null,f&&(h(),g=setTimeout(C,300),f=!1)},function(){return f=!0,g||C(),g})};Ps.prototype.addTo=function(c){return this._map=c,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ps.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ps.prototype.getHashString=function(c){var h=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,g),P=Math.round(h.lng*C)/C,R=Math.round(h.lat*C)/C,L=this._map.getBearing(),z=this._map.getPitch(),W="";if(W+=c?"/"+P+"/"+R+"/"+f:f+"/"+R+"/"+P,(L||z)&&(W+="/"+Math.round(10*L)/10),z&&(W+="/"+Math.round(z)),this._hashName){var ee=this._hashName,Z=!1,te=s.window.location.hash.slice(1).split("&").map(function(se){var we=se.split("=")[0];return we===ee?(Z=!0,we+"="+W):se}).filter(function(se){return se});return Z||te.push(ee+"="+W),"#"+te.join("&")}return"#"+W},Ps.prototype._getCurrentHash=function(){var c,h=this,f=s.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===h._hashName&&(c=g)}),(c&&c[1]||"").split("/")):f.split("/")},Ps.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:h,pitch:+(c[4]||0)}),!0}return!1},Ps.prototype._updateHashUnthrottled=function(){var c=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,c)}catch{}};var ll={linearity:.3,easing:s.bezier(0,0,.3,1)},vc=s.extend({deceleration:2500,maxSpeed:1400},ll),ul=s.extend({deceleration:20,maxSpeed:1400},ll),LA=s.extend({deceleration:1e3,maxSpeed:360},ll),NA=s.extend({deceleration:1e3,maxSpeed:90},ll),bc=function(c){this._map=c,this.clear()};function fl(c,h){(!c.duration||c.duration<h.duration)&&(c.duration=h.duration,c.easing=h.easing)}function yo(c,h,f){var g=f.maxSpeed,C=f.linearity,P=f.deceleration,R=s.clamp(c*C/(h/1e3),-g,g),L=Math.abs(R)/(P*C);return{easing:f.easing,duration:1e3*L,amount:R*(L/2)}}bc.prototype.clear=function(){this._inertiaBuffer=[]},bc.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:c})},bc.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,h=s.browser.now();c.length>0&&h-c[0].time>160;)c.shift()},bc.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},f=0,g=this._inertiaBuffer;f<g.length;f+=1){var C=g[f].settings;h.zoom+=C.zoomDelta||0,h.bearing+=C.bearingDelta||0,h.pitch+=C.pitchDelta||0,C.panDelta&&h.pan._add(C.panDelta),C.around&&(h.around=C.around),C.pinchAround&&(h.pinchAround=C.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(h.pan.mag()){var L=yo(h.pan.mag(),P,s.extend({},vc,c||{}));R.offset=h.pan.mult(L.amount/h.pan.mag()),R.center=this._map.transform.center,fl(R,L)}if(h.zoom){var z=yo(h.zoom,P,ul);R.zoom=this._map.transform.zoom+z.amount,fl(R,z)}if(h.bearing){var W=yo(h.bearing,P,LA);R.bearing=this._map.transform.bearing+s.clamp(W.amount,-179,179),fl(R,W)}if(h.pitch){var ee=yo(h.pitch,P,NA);R.pitch=this._map.transform.pitch+ee.amount,fl(R,ee)}if(R.zoom||R.bearing){var Z=h.pinchAround===void 0?h.around:h.pinchAround;R.around=Z?this._map.unproject(Z):this._map.getCenter()}return this.clear(),s.extend(R,{noMoveStart:!0})}};var Pn=function(c){function h(g,C,P,R){R===void 0&&(R={});var L=d.mousePos(C.getCanvasContainer(),P),z=C.unproject(L);c.call(this,g,s.extend({point:L,lngLat:z,originalEvent:P},R)),this._defaultPrevented=!1,this.target=C}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(s.Event),xc=function(c){function h(g,C,P){var R=g==="touchend"?P.changedTouches:P.touches,L=d.touchPos(C.getCanvasContainer(),R),z=L.map(function(Z){return C.unproject(Z)}),W=L.reduce(function(Z,te,se,we){return Z.add(te.div(we.length))},new s.Point(0,0)),ee=C.unproject(W);c.call(this,g,{points:L,point:W,lngLats:z,lngLat:ee,originalEvent:P}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(s.Event),vh=function(c){function h(g,C,P){c.call(this,g,{originalEvent:P}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(s.Event),gi=function(c,h){this._map=c,this._clickTolerance=h.clickTolerance};gi.prototype.reset=function(){delete this._mousedownPos},gi.prototype.wheel=function(c){return this._firePreventable(new vh(c.type,this._map,c))},gi.prototype.mousedown=function(c,h){return this._mousedownPos=h,this._firePreventable(new Pn(c.type,this._map,c))},gi.prototype.mouseup=function(c){this._map.fire(new Pn(c.type,this._map,c))},gi.prototype.click=function(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Pn(c.type,this._map,c))},gi.prototype.dblclick=function(c){return this._firePreventable(new Pn(c.type,this._map,c))},gi.prototype.mouseover=function(c){this._map.fire(new Pn(c.type,this._map,c))},gi.prototype.mouseout=function(c){this._map.fire(new Pn(c.type,this._map,c))},gi.prototype.touchstart=function(c){return this._firePreventable(new xc(c.type,this._map,c))},gi.prototype.touchmove=function(c){this._map.fire(new xc(c.type,this._map,c))},gi.prototype.touchend=function(c){this._map.fire(new xc(c.type,this._map,c))},gi.prototype.touchcancel=function(c){this._map.fire(new xc(c.type,this._map,c))},gi.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},gi.prototype.isEnabled=function(){return!0},gi.prototype.isActive=function(){return!1},gi.prototype.enable=function(){},gi.prototype.disable=function(){};var rr=function(c){this._map=c};rr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},rr.prototype.mousemove=function(c){this._map.fire(new Pn(c.type,this._map,c))},rr.prototype.mousedown=function(){this._delayContextMenu=!0},rr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},rr.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Pn(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},rr.prototype.isEnabled=function(){return!0},rr.prototype.isActive=function(){return!1},rr.prototype.enable=function(){},rr.prototype.disable=function(){};var ms=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1};function Ql(c,h){for(var f={},g=0;g<c.length;g++)f[c[g].identifier]=h[g];return f}ms.prototype.isEnabled=function(){return!!this._enabled},ms.prototype.isActive=function(){return!!this._active},ms.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ms.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ms.prototype.mousedown=function(c,h){this.isEnabled()&&c.shiftKey&&c.button===0&&(d.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},ms.prototype.mousemoveWindow=function(c,h){if(this._active){var f=h;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=f,this._box||(this._box=d.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var C=Math.min(g.x,f.x),P=Math.max(g.x,f.x),R=Math.min(g.y,f.y),L=Math.max(g.y,f.y);d.setTransform(this._box,"translate("+C+"px,"+R+"px)"),this._box.style.width=P-C+"px",this._box.style.height=L-R+"px"}}},ms.prototype.mouseupWindow=function(c,h){var f=this;if(this._active&&c.button===0){var g=this._startPos,C=h;if(this.reset(),d.suppressClick(),g.x!==C.x||g.y!==C.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(P){return P.fitScreenCoordinates(g,C,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},ms.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},ms.prototype.blur=function(){this.reset()},ms.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(d.remove(this._box),this._box=null),d.enableDrag(),delete this._startPos,delete this._lastPos},ms.prototype._fireEvent=function(c,h){return this._map.fire(new s.Event(c,{originalEvent:h}))};var Rs=function(c){this.reset(),this.numTouches=c.numTouches};Rs.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Rs.prototype.touchstart=function(c,h,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){for(var C=new s.Point(0,0),P=0,R=g;P<R.length;P+=1)C._add(R[P]);return C.div(g.length)}(h),this.touches=Ql(f,h)))},Rs.prototype.touchmove=function(c,h,f){if(!this.aborted&&this.centroid){var g=Ql(f,h);for(var C in this.touches){var P=g[C];(!P||P.dist(this.touches[C])>30)&&(this.aborted=!0)}}},Rs.prototype.touchend=function(c,h,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var $s=function(c){this.singleTap=new Rs(c),this.numTaps=c.numTaps,this.reset()};$s.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},$s.prototype.touchstart=function(c,h,f){this.singleTap.touchstart(c,h,f)},$s.prototype.touchmove=function(c,h,f){this.singleTap.touchmove(c,h,f)},$s.prototype.touchend=function(c,h,f){var g=this.singleTap.touchend(c,h,f);if(g){var C=c.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(g)<30;if(C&&P||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var cs=function(){this._zoomIn=new $s({numTouches:1,numTaps:2}),this._zoomOut=new $s({numTouches:2,numTaps:1}),this.reset()};cs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},cs.prototype.touchstart=function(c,h,f){this._zoomIn.touchstart(c,h,f),this._zoomOut.touchstart(c,h,f)},cs.prototype.touchmove=function(c,h,f){this._zoomIn.touchmove(c,h,f),this._zoomOut.touchmove(c,h,f)},cs.prototype.touchend=function(c,h,f){var g=this,C=this._zoomIn.touchend(c,h,f),P=this._zoomOut.touchend(c,h,f);return C?(this._active=!0,c.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(C)},{originalEvent:c})}}):P?(this._active=!0,c.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(P)},{originalEvent:c})}}):void 0},cs.prototype.touchcancel=function(){this.reset()},cs.prototype.enable=function(){this._enabled=!0},cs.prototype.disable=function(){this._enabled=!1,this.reset()},cs.prototype.isEnabled=function(){return this._enabled},cs.prototype.isActive=function(){return this._active};var Qu={0:1,2:2},Jt=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};Jt.prototype.blur=function(){this.reset()},Jt.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Jt.prototype._correctButton=function(c,h){return!1},Jt.prototype._move=function(c,h){return{}},Jt.prototype.mousedown=function(c,h){if(!this._lastPoint){var f=d.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=h,this._eventButton=f)}},Jt.prototype.mousemoveWindow=function(c,h){var f=this._lastPoint;if(f){if(c.preventDefault(),function(g,C){var P=Qu[C];return g.buttons===void 0||(g.buttons&P)!==P}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(f,h)}},Jt.prototype.mouseupWindow=function(c){this._lastPoint&&d.mouseButton(c)===this._eventButton&&(this._moved&&d.suppressClick(),this.reset())},Jt.prototype.enable=function(){this._enabled=!0},Jt.prototype.disable=function(){this._enabled=!1,this.reset()},Jt.prototype.isEnabled=function(){return this._enabled},Jt.prototype.isActive=function(){return this._active};var ef=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.mousedown=function(f,g){c.prototype.mousedown.call(this,f,g),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(f,g){return g===0&&!f.ctrlKey},h.prototype._move=function(f,g){return{around:g,panDelta:g.sub(f)}},h}(Jt),eu=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,g){return g===0&&f.ctrlKey||g===2},h.prototype._move=function(f,g){var C=.8*(g.x-f.x);if(C)return this._active=!0,{bearingDelta:C}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(Jt),tf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,g){return g===0&&f.ctrlKey||g===2},h.prototype._move=function(f,g){var C=-.5*(g.y-f.y);if(C)return this._active=!0,{pitchDelta:C}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(Jt),Ws=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};Ws.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},Ws.prototype.touchstart=function(c,h,f){return this._calculateTransform(c,h,f)},Ws.prototype.touchmove=function(c,h,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,h,f)},Ws.prototype.touchend=function(c,h,f){this._calculateTransform(c,h,f),this._active&&f.length<this._minTouches&&this.reset()},Ws.prototype.touchcancel=function(){this.reset()},Ws.prototype._calculateTransform=function(c,h,f){f.length>0&&(this._active=!0);var g=Ql(f,h),C=new s.Point(0,0),P=new s.Point(0,0),R=0;for(var L in g){var z=g[L],W=this._touches[L];W&&(C._add(z),P._add(z.sub(W)),R++,g[L]=z)}if(this._touches=g,!(R<this._minTouches)&&P.mag()){var ee=P.div(R);if(this._sum._add(ee),!(this._sum.mag()<this._clickTolerance))return{around:C.div(R),panDelta:ee}}},Ws.prototype.enable=function(){this._enabled=!0},Ws.prototype.disable=function(){this._enabled=!1,this.reset()},Ws.prototype.isEnabled=function(){return this._enabled},Ws.prototype.isActive=function(){return this._active};var _s=function(){this.reset()};function tu(c,h,f){for(var g=0;g<c.length;g++)if(c[g].identifier===f)return h[g]}function ru(c,h){return Math.log(c/h)/Math.LN2}_s.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},_s.prototype._start=function(c){},_s.prototype._move=function(c,h,f){return{}},_s.prototype.touchstart=function(c,h,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([h[0],h[1]]))},_s.prototype.touchmove=function(c,h,f){if(this._firstTwoTouches){c.preventDefault();var g=this._firstTwoTouches,C=g[1],P=tu(f,h,g[0]),R=tu(f,h,C);if(P&&R){var L=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],L,c)}}},_s.prototype.touchend=function(c,h,f){if(this._firstTwoTouches){var g=this._firstTwoTouches,C=g[1],P=tu(f,h,g[0]),R=tu(f,h,C);P&&R||(this._active&&d.suppressClick(),this.reset())}},_s.prototype.touchcancel=function(){this.reset()},_s.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},_s.prototype.disable=function(){this._enabled=!1,this.reset()},_s.prototype.isEnabled=function(){return this._enabled},_s.prototype.isActive=function(){return this._active};var ys=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},h.prototype._move=function(f,g){var C=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(ru(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ru(this._distance,C),pinchAround:g}},h}(_s);function Go(c,h){return 180*c.angleWith(h)/Math.PI}var rf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},h.prototype._move=function(f,g){var C=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Go(this._vector,C),pinchAround:g}},h.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var g=25/(Math.PI*this._minDiameter)*360,C=Go(f,this._startVector);return Math.abs(C)<g},h}(_s);function wc(c){return Math.abs(c.y)>Math.abs(c.x)}var mi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(f){this._lastPoints=f,wc(f[0].sub(f[1]))&&(this._valid=!1)},h.prototype._move=function(f,g,C){var P=f[0].sub(this._lastPoints[0]),R=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,R,C.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(P.y+R.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(f,g,C){if(this._valid!==void 0)return this._valid;var P=f.mag()>=2,R=g.mag()>=2;if(P||R){if(!P||!R)return this._firstMove===void 0&&(this._firstMove=C),C-this._firstMove<100&&void 0;var L=f.y>0==g.y>0;return wc(f)&&wc(g)&&L}},h}(_s),nf={panStep:100,bearingStep:15,pitchStep:10},uo=function(){var c=nf;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function Ki(c){return c*(2-c)}uo.prototype.blur=function(){this.reset()},uo.prototype.reset=function(){this._active=!1},uo.prototype.keydown=function(c){var h=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,g=0,C=0,P=0,R=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?g=-1:(c.preventDefault(),P=-1);break;case 39:c.shiftKey?g=1:(c.preventDefault(),P=1);break;case 38:c.shiftKey?C=1:(c.preventDefault(),R=-1);break;case 40:c.shiftKey?C=-1:(c.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,C=0),{cameraAnimation:function(L){var z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ki,zoom:f?Math.round(z)+f*(c.shiftKey?2:1):z,bearing:L.getBearing()+g*h._bearingStep,pitch:L.getPitch()+C*h._pitchStep,offset:[-P*h._panStep,-R*h._panStep],center:L.getCenter()},{originalEvent:c})}}}},uo.prototype.enable=function(){this._enabled=!0},uo.prototype.disable=function(){this._enabled=!1,this.reset()},uo.prototype.isEnabled=function(){return this._enabled},uo.prototype.isActive=function(){return this._active},uo.prototype.disableRotation=function(){this._rotationDisabled=!0},uo.prototype.enableRotation=function(){this._rotationDisabled=!1};var kr=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};kr.prototype.setZoomRate=function(c){this._defaultZoomRate=c},kr.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},kr.prototype.isEnabled=function(){return!!this._enabled},kr.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},kr.prototype.isZooming=function(){return!!this._zooming},kr.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},kr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},kr.prototype.wheel=function(c){if(this.isEnabled()){var h=c.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=s.browser.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(g*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}},kr.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},kr.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=d.mousePos(this._el,c);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},kr.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&g!==0&&(g=1/g);var C=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(C*g))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,R=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,z=this._easing,W=!1;if(this._type==="wheel"&&L&&z){var ee=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),Z=z(ee);P=s.number(L,R,Z),ee<1?this._frameId||(this._frameId=!0):W=!0}else P=R,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:P-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},kr.prototype._smoothOutEasing=function(c){var h=s.ease;if(this._prevEase){var f=this._prevEase,g=(s.browser.now()-f.start)/f.duration,C=f.easing(g+.01)-f.easing(g),P=.27/Math.sqrt(C*C+1e-4)*.01,R=Math.sqrt(.0729-P*P);h=s.bezier(P,R,.25,1)}return this._prevEase={start:s.browser.now(),duration:c,easing:h},h},kr.prototype.blur=function(){this.reset()},kr.prototype.reset=function(){this._active=!1};var vo=function(c,h){this._clickZoom=c,this._tapZoom=h};vo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},vo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},vo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},vo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Js=function(){this.reset()};Js.prototype.reset=function(){this._active=!1},Js.prototype.blur=function(){this.reset()},Js.prototype.dblclick=function(c,h){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(h)},{originalEvent:c})}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active};var zi=function(){this._tap=new $s({numTouches:1,numTaps:1}),this.reset()};zi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},zi.prototype.touchstart=function(c,h,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=h[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,h,f))},zi.prototype.touchmove=function(c,h,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var g=h[0],C=g.y-this._swipePoint.y;return this._swipePoint=g,c.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(c,h,f)},zi.prototype.touchend=function(c,h,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,h,f)&&(this._tapTime=c.timeStamp)},zi.prototype.touchcancel=function(){this.reset()},zi.prototype.enable=function(){this._enabled=!0},zi.prototype.disable=function(){this._enabled=!1,this.reset()},zi.prototype.isEnabled=function(){return this._enabled},zi.prototype.isActive=function(){return this._active};var Aa=function(c,h,f){this._el=c,this._mousePan=h,this._touchPan=f};Aa.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Aa.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Aa.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Aa.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Vo=function(c,h,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=f};Vo.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Vo.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Vo.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Vo.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Xs=function(c,h,f,g){this._el=c,this._touchZoom=h,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};Xs.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Xs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Xs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Xs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Xs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Xs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var qi=function(c){return c.zoom||c.drag||c.pitch||c.rotate},hl=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h}(s.Event);function _r(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var or=function(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bc(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),s.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[s.window,"blur",void 0]];for(var g=0,C=this._listeners;g<C.length;g+=1){var P=C[g],R=P[0];d.addEventListener(R,P[1],R===s.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};or.prototype.destroy=function(){for(var c=0,h=this._listeners;c<h.length;c+=1){var f=h[c],g=f[0];d.removeEventListener(g,f[1],g===s.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},or.prototype._addDefaultHandlers=function(c){var h=this._map,f=h.getCanvasContainer();this._add("mapEvent",new gi(h,c));var g=h.boxZoom=new ms(h,c);this._add("boxZoom",g);var C=new cs,P=new Js;h.doubleClickZoom=new vo(P,C),this._add("tapZoom",C),this._add("clickZoom",P);var R=new zi;this._add("tapDragZoom",R);var L=h.touchPitch=new mi;this._add("touchPitch",L);var z=new eu(c),W=new tf(c);h.dragRotate=new Vo(c,z,W),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);var ee=new ef(c),Z=new Ws(c);h.dragPan=new Aa(f,ee,Z),this._add("mousePan",ee),this._add("touchPan",Z,["touchZoom","touchRotate"]);var te=new rf,se=new ys;h.touchZoomRotate=new Xs(f,se,te,R),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]);var we=h.scrollZoom=new kr(h,this);this._add("scrollZoom",we,["mousePan"]);var Fe=h.keyboard=new uo;this._add("keyboard",Fe),this._add("blockableMapEvent",new rr(h));for(var ge=0,Re=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ge<Re.length;ge+=1){var Ve=Re[ge];c.interactive&&c[Ve]&&h[Ve].enable(c[Ve])}},or.prototype._add=function(c,h,f){this._handlers.push({handlerName:c,handler:h,allowed:f}),this._handlersById[c]=h},or.prototype.stop=function(c){if(!this._updatingCamera){for(var h=0,f=this._handlers;h<f.length;h+=1)f[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},or.prototype.isActive=function(){for(var c=0,h=this._handlers;c<h.length;c+=1)if(h[c].handler.isActive())return!0;return!1},or.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},or.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},or.prototype.isMoving=function(){return!!qi(this._eventsInProgress)||this.isZooming()},or.prototype._blockedByActive=function(c,h,f){for(var g in c)if(g!==f&&(!h||h.indexOf(g)<0))return!0;return!1},or.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},or.prototype._getMapTouches=function(c){for(var h=[],f=0,g=c;f<g.length;f+=1){var C=g[f];this._el.contains(C.target)&&h.push(C)}return h},or.prototype.handleEvent=function(c,h){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,g={needsRenderFrame:!1},C={},P={},R=c.touches?this._getMapTouches(c.touches):void 0,L=R?d.touchPos(this._el,R):d.mousePos(this._el,c),z=0,W=this._handlers;z<W.length;z+=1){var ee=W[z],Z=ee.handlerName,te=ee.handler,se=ee.allowed;if(te.isEnabled()){var we=void 0;this._blockedByActive(P,se,Z)?te.reset():te[h||c.type]&&(we=te[h||c.type](c,L,R),this.mergeHandlerResult(g,C,we,Z,f),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||te.isActive())&&(P[Z]=te)}}var Fe={};for(var ge in this._previousActiveHandlers)P[ge]||(Fe[ge]=f);this._previousActiveHandlers=P,(Object.keys(Fe).length||_r(g))&&(this._changes.push([g,C,Fe]),this._triggerRenderFrame()),(Object.keys(P).length||_r(g))&&this._map._stop(!0),this._updatingCamera=!1;var Re=g.cameraAnimation;Re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Re(this._map))},or.prototype.mergeHandlerResult=function(c,h,f,g,C){if(f){s.extend(c,f);var P={handlerName:g,originalEvent:f.originalEvent||C};f.zoomDelta!==void 0&&(h.zoom=P),f.panDelta!==void 0&&(h.drag=P),f.pitchDelta!==void 0&&(h.pitch=P),f.bearingDelta!==void 0&&(h.rotate=P)}},or.prototype._applyChanges=function(){for(var c={},h={},f={},g=0,C=this._changes;g<C.length;g+=1){var P=C[g],R=P[0],L=P[1],z=P[2];R.panDelta&&(c.panDelta=(c.panDelta||new s.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(c.around=R.around),R.pinchAround!==void 0&&(c.pinchAround=R.pinchAround),R.noInertia&&(c.noInertia=R.noInertia),s.extend(h,L),s.extend(f,z)}this._updateMapTransform(c,h,f),this._changes=[]},or.prototype._updateMapTransform=function(c,h,f){var g=this._map,C=g.transform;if(!_r(c))return this._fireEvents(h,f,!0);var P=c.panDelta,R=c.zoomDelta,L=c.bearingDelta,z=c.pitchDelta,W=c.around,ee=c.pinchAround;ee!==void 0&&(W=ee),g._stop(!0),W=W||g.transform.centerPoint;var Z=C.pointLocation(P?W.sub(P):W);L&&(C.bearing+=L),z&&(C.pitch+=z),R&&(C.zoom+=R),C.setLocationAtPoint(Z,W),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,f,!0)},or.prototype._fireEvents=function(c,h,f){var g=this,C=qi(this._eventsInProgress),P=qi(c),R={};for(var L in c)this._eventsInProgress[L]||(R[L+"start"]=c[L].originalEvent),this._eventsInProgress[L]=c[L];for(var z in!C&&P&&this._fireEvent("movestart",P.originalEvent),R)this._fireEvent(z,R[z]);for(var W in P&&this._fireEvent("move",P.originalEvent),c)this._fireEvent(W,c[W].originalEvent);var ee,Z={};for(var te in this._eventsInProgress){var se=this._eventsInProgress[te],we=se.handlerName,Fe=se.originalEvent;this._handlersById[we].isActive()||(delete this._eventsInProgress[te],Z[te+"end"]=ee=h[we]||Fe)}for(var ge in Z)this._fireEvent(ge,Z[ge]);var Re=qi(this._eventsInProgress);if(f&&(C||P)&&!Re){this._updatingCamera=!0;var Ve=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$e=function(rt){return rt!==0&&-g._bearingSnap<rt&&rt<g._bearingSnap};Ve?($e(Ve.bearing||this._map.getBearing())&&(Ve.bearing=0),this._map.easeTo(Ve,{originalEvent:ee})):(this._map.fire(new s.Event("moveend",{originalEvent:ee})),$e(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},or.prototype._fireEvent=function(c,h){this._map.fire(new s.Event(c,h?{originalEvent:h}:{}))},or.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete c._frameId,c.handleEvent(new hl("renderFrame",{timeStamp:h})),c._applyChanges()})},or.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var nu=function(c){function h(f,g){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=g.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(f,g){return this.jumpTo({center:f},g)},h.prototype.panBy=function(f,g,C){return f=s.Point.convert(f).mult(-1),this.panTo(this.transform.center,s.extend({offset:f},g),C)},h.prototype.panTo=function(f,g,C){return this.easeTo(s.extend({center:f},g),C)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(f,g){return this.jumpTo({zoom:f},g),this},h.prototype.zoomTo=function(f,g,C){return this.easeTo(s.extend({zoom:f},g),C)},h.prototype.zoomIn=function(f,g){return this.zoomTo(this.getZoom()+1,f,g),this},h.prototype.zoomOut=function(f,g){return this.zoomTo(this.getZoom()-1,f,g),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(f,g){return this.jumpTo({bearing:f},g),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(f,g){return this.jumpTo({padding:f},g),this},h.prototype.rotateTo=function(f,g,C){return this.easeTo(s.extend({bearing:f},g),C)},h.prototype.resetNorth=function(f,g){return this.rotateTo(0,s.extend({duration:1e3},f),g),this},h.prototype.resetNorthPitch=function(f,g){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},f),g),this},h.prototype.snapToNorth=function(f,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,g):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(f,g){return this.jumpTo({pitch:f},g),this},h.prototype.cameraForBounds=function(f,g){f=s.LngLatBounds.convert(f);var C=g&&g.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),C,g)},h.prototype._cameraForBoxAndBearing=function(f,g,C,P){var R={top:0,bottom:0,right:0,left:0};if(typeof(P=s.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var L=P.padding;P.padding={top:L,bottom:L,right:L,left:L}}P.padding=s.extend(R,P.padding);var z=this.transform,W=z.padding,ee=z.project(s.LngLat.convert(f)),Z=z.project(s.LngLat.convert(g)),te=ee.rotate(-C*Math.PI/180),se=Z.rotate(-C*Math.PI/180),we=new s.Point(Math.max(te.x,se.x),Math.max(te.y,se.y)),Fe=new s.Point(Math.min(te.x,se.x),Math.min(te.y,se.y)),ge=we.sub(Fe),Re=(z.width-(W.left+W.right+P.padding.left+P.padding.right))/ge.x,Ve=(z.height-(W.top+W.bottom+P.padding.top+P.padding.bottom))/ge.y;if(!(Ve<0||Re<0)){var $e=Math.min(z.scaleZoom(z.scale*Math.min(Re,Ve)),P.maxZoom),rt=typeof P.offset.x=="number"?new s.Point(P.offset.x,P.offset.y):s.Point.convert(P.offset),Je=new s.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(C*Math.PI/180),Ze=rt.add(Je).mult(z.scale/z.zoomScale($e));return{center:z.unproject(ee.add(Z).div(2).sub(Ze)),zoom:$e,bearing:C}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(f,g,C){return this._fitInternal(this.cameraForBounds(f,g),g,C)},h.prototype.fitScreenCoordinates=function(f,g,C,P,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(f)),this.transform.pointLocation(s.Point.convert(g)),C,P),P,R)},h.prototype._fitInternal=function(f,g,C){return f?(delete(g=s.extend(f,g)).padding,g.linear?this.easeTo(g,C):this.flyTo(g,C)):this},h.prototype.jumpTo=function(f,g){this.stop();var C=this.transform,P=!1,R=!1,L=!1;return"zoom"in f&&C.zoom!==+f.zoom&&(P=!0,C.zoom=+f.zoom),f.center!==void 0&&(C.center=s.LngLat.convert(f.center)),"bearing"in f&&C.bearing!==+f.bearing&&(R=!0,C.bearing=+f.bearing),"pitch"in f&&C.pitch!==+f.pitch&&(L=!0,C.pitch=+f.pitch),f.padding==null||C.isPaddingEqual(f.padding)||(C.padding=f.padding),this.fire(new s.Event("movestart",g)).fire(new s.Event("move",g)),P&&this.fire(new s.Event("zoomstart",g)).fire(new s.Event("zoom",g)).fire(new s.Event("zoomend",g)),R&&this.fire(new s.Event("rotatestart",g)).fire(new s.Event("rotate",g)).fire(new s.Event("rotateend",g)),L&&this.fire(new s.Event("pitchstart",g)).fire(new s.Event("pitch",g)).fire(new s.Event("pitchend",g)),this.fire(new s.Event("moveend",g))},h.prototype.easeTo=function(f,g){var C=this;this._stop(!1,f.easeId),((f=s.extend({offset:[0,0],duration:500,easing:s.ease},f)).animate===!1||!f.essential&&s.browser.prefersReducedMotion)&&(f.duration=0);var P=this.transform,R=this.getZoom(),L=this.getBearing(),z=this.getPitch(),W=this.getPadding(),ee="zoom"in f?+f.zoom:R,Z="bearing"in f?this._normalizeBearing(f.bearing,L):L,te="pitch"in f?+f.pitch:z,se="padding"in f?f.padding:P.padding,we=s.Point.convert(f.offset),Fe=P.centerPoint.add(we),ge=P.pointLocation(Fe),Re=s.LngLat.convert(f.center||ge);this._normalizeCenter(Re);var Ve,$e,rt=P.project(ge),Je=P.project(Re).sub(rt),Ze=P.zoomScale(ee-R);f.around&&(Ve=s.LngLat.convert(f.around),$e=P.locationPoint(Ve));var ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ee!==R,this._rotating=this._rotating||L!==Z,this._pitching=this._pitching||te!==z,this._padding=!P.isPaddingEqual(se),this._easeId=f.easeId,this._prepareEase(g,f.noMoveStart,ft),this._ease(function(Pt){if(C._zooming&&(P.zoom=s.number(R,ee,Pt)),C._rotating&&(P.bearing=s.number(L,Z,Pt)),C._pitching&&(P.pitch=s.number(z,te,Pt)),C._padding&&(P.interpolatePadding(W,se,Pt),Fe=P.centerPoint.add(we)),Ve)P.setLocationAtPoint(Ve,$e);else{var bt=P.zoomScale(P.zoom-R),Lt=ee>R?Math.min(2,Ze):Math.max(.5,Ze),tr=Math.pow(Lt,1-Pt),br=P.unproject(rt.add(Je.mult(Pt*tr)).mult(bt));P.setLocationAtPoint(P.renderWorldCopies?br.wrap():br,Fe)}C._fireMoveEvents(g)},function(Pt){C._afterEase(g,Pt)},f),this},h.prototype._prepareEase=function(f,g,C){C===void 0&&(C={}),this._moving=!0,g||C.moving||this.fire(new s.Event("movestart",f)),this._zooming&&!C.zooming&&this.fire(new s.Event("zoomstart",f)),this._rotating&&!C.rotating&&this.fire(new s.Event("rotatestart",f)),this._pitching&&!C.pitching&&this.fire(new s.Event("pitchstart",f))},h.prototype._fireMoveEvents=function(f){this.fire(new s.Event("move",f)),this._zooming&&this.fire(new s.Event("zoom",f)),this._rotating&&this.fire(new s.Event("rotate",f)),this._pitching&&this.fire(new s.Event("pitch",f))},h.prototype._afterEase=function(f,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var C=this._zooming,P=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new s.Event("zoomend",f)),P&&this.fire(new s.Event("rotateend",f)),R&&this.fire(new s.Event("pitchend",f)),this.fire(new s.Event("moveend",f))}},h.prototype.flyTo=function(f,g){var C=this;if(!f.essential&&s.browser.prefersReducedMotion){var P=s.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,g)}this.stop(),f=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},f);var R=this.transform,L=this.getZoom(),z=this.getBearing(),W=this.getPitch(),ee=this.getPadding(),Z="zoom"in f?s.clamp(+f.zoom,R.minZoom,R.maxZoom):L,te="bearing"in f?this._normalizeBearing(f.bearing,z):z,se="pitch"in f?+f.pitch:W,we="padding"in f?f.padding:R.padding,Fe=R.zoomScale(Z-L),ge=s.Point.convert(f.offset),Re=R.centerPoint.add(ge),Ve=R.pointLocation(Re),$e=s.LngLat.convert(f.center||Ve);this._normalizeCenter($e);var rt=R.project(Ve),Je=R.project($e).sub(rt),Ze=f.curve,ft=Math.max(R.width,R.height),Pt=ft/Fe,bt=Je.mag();if("minZoom"in f){var Lt=s.clamp(Math.min(f.minZoom,L,Z),R.minZoom,R.maxZoom),tr=ft/R.zoomScale(Lt-L);Ze=Math.sqrt(tr/bt*2)}var br=Ze*Ze;function Tr(Rr){var Mr=(Pt*Pt-ft*ft+(Rr?-1:1)*br*br*bt*bt)/(2*(Rr?Pt:ft)*br*bt);return Math.log(Math.sqrt(Mr*Mr+1)-Mr)}function gn(Rr){return(Math.exp(Rr)-Math.exp(-Rr))/2}function nr(Rr){return(Math.exp(Rr)+Math.exp(-Rr))/2}var zr=Tr(0),Yr=function(Rr){return nr(zr)/nr(zr+Ze*Rr)},Ur=function(Rr){return ft*((nr(zr)*(gn(Mr=zr+Ze*Rr)/nr(Mr))-gn(zr))/br)/bt;var Mr},Lr=(Tr(1)-zr)/Ze;if(Math.abs(bt)<1e-6||!isFinite(Lr)){if(Math.abs(ft-Pt)<1e-6)return this.easeTo(f,g);var Jr=Pt<ft?-1:1;Lr=Math.abs(Math.log(Pt/ft))/Ze,Ur=function(){return 0},Yr=function(Rr){return Math.exp(Jr*Ze*Rr)}}return f.duration="duration"in f?+f.duration:1e3*Lr/("screenSpeed"in f?+f.screenSpeed/Ze:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=z!==te,this._pitching=se!==W,this._padding=!R.isPaddingEqual(we),this._prepareEase(g,!1),this._ease(function(Rr){var Mr=Rr*Lr,Vi=1/Yr(Mr);R.zoom=Rr===1?Z:L+R.scaleZoom(Vi),C._rotating&&(R.bearing=s.number(z,te,Rr)),C._pitching&&(R.pitch=s.number(W,se,Rr)),C._padding&&(R.interpolatePadding(ee,we,Rr),Re=R.centerPoint.add(ge));var _i=Rr===1?$e:R.unproject(rt.add(Je.mult(Ur(Mr))).mult(Vi));R.setLocationAtPoint(R.renderWorldCopies?_i.wrap():_i,Re),C._fireMoveEvents(g)},function(){return C._afterEase(g)},f),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(f,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var C=this._onEaseEnd;delete this._onEaseEnd,C.call(this,g)}if(!f){var P=this.handlers;P&&P.stop(!1)}return this},h.prototype._ease=function(f,g,C){C.animate===!1||C.duration===0?(f(1),g()):(this._easeStart=s.browser.now(),this._easeOptions=C,this._onEaseFrame=f,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var f=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(f,g){f=s.wrap(f,-180,180);var C=Math.abs(f-g);return Math.abs(f-360-g)<C&&(f-=360),Math.abs(f+360-g)<C&&(f+=360),f},h.prototype._normalizeCenter=function(f){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var C=f.lng-g.center.lng;f.lng+=C>180?-360:C<-180?360:0}},h}(s.Evented),rs=function(c){c===void 0&&(c={}),this.options=c,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};rs.prototype.getDefaultPosition=function(){return"bottom-right"},rs.prototype.onAdd=function(c){var h=this.options&&this.options.compact;return this._map=c,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=d.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=d.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},rs.prototype.onRemove=function(){d.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},rs.prototype._setElementTitle=function(c,h){var f=this._map._getUIString("AttributionControl."+h);c.title=f,c.setAttribute("aria-label",f)},rs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},rs.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(c){var f=h.reduce(function(g,C,P){return C.value&&(g+=C.key+"="+C.value+(P<h.length-1?"&":"")),g},"?");c.href=s.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},rs.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},rs.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var f=this._map.style.sourceCaches;for(var g in f){var C=f[g];if(C.used){var P=C.getSource();P.attribution&&c.indexOf(P.attribution)<0&&c.push(P.attribution)}}c.sort(function(L,z){return L.length-z.length});var R=(c=c.filter(function(L,z){for(var W=z+1;W<c.length;W++)if(c[W].indexOf(L)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,c.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},rs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Gi=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};Gi.prototype.onAdd=function(c){this._map=c,this._container=d.create("div","mapboxgl-ctrl");var h=d.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Gi.prototype.onRemove=function(){d.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Gi.prototype.getDefaultPosition=function(){return"bottom-left"},Gi.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Gi.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var h in c)if(c[h].getSource().mapbox_logo)return!0;return!1}},Gi.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var Gn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Gn.prototype.add=function(c){var h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h},Gn.prototype.remove=function(c){for(var h=this._currentlyRunning,f=0,g=h?this._queue.concat(h):this._queue;f<g.length;f+=1){var C=g[f];if(C.id===c)return void(C.cancelled=!0)}},Gn.prototype.run=function(c){c===void 0&&(c=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,g=h;f<g.length;f+=1){var C=g[f];if(!C.cancelled&&(C.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Gn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Or={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ks=s.window.HTMLImageElement,ln=s.window.HTMLElement,jr=s.window.ImageBitmap,Ii={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},iu=function(c){function h(g){var C=this;if((g=s.extend({},Ii,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new sn(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(c.call(this,P,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Gn,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Or,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new s.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=s.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof ln))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return C._update(!1)}),this.on("moveend",function(){return C._update(!1)}),this.on("zoom",function(){return C._update(!0)}),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new or(this,g),this._hash=g.hash&&new Ps(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,s.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new rs({customAttribution:g.customAttribution})),this.addControl(new Gi,g.logoPosition),this.on("style.load",function(){C.transform.unmodified&&C.jumpTo(C.style.stylesheet)}),this.on("data",function(R){C._update(R.dataType==="style"),C.fire(new s.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){C.fire(new s.Event(R.dataType+"dataloading",R))})}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(g,C){if(C===void 0&&(C=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[C];return C.indexOf("bottom")!==-1?R.insertBefore(P,R.firstChild):R.appendChild(P),this},h.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var C=this._controls.indexOf(g);return C>-1&&this._controls.splice(C,1),g.onRemove(this),this},h.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},h.prototype.resize=function(g){var C=this._containerDimensions(),P=C[0],R=C[1];if(P===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(P,R),this.transform.resize(P,R),this.painter.resize(P,R);var L=!this._moving;return L&&this.fire(new s.Event("movestart",g)).fire(new s.Event("move",g)),this.fire(new s.Event("resize",g)),L&&this.fire(new s.Event("moveend",g)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(s.LngLatBounds.convert(g)),this._update()},h.prototype.setMinZoom=function(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(g){if((g=g??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},h.prototype.project=function(g){return this.transform.locationPoint(s.LngLat.convert(g))},h.prototype.unproject=function(g){return this.transform.pointLocation(s.Point.convert(g))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(g,C,P){var R,L=this;if(g==="mouseenter"||g==="mouseover"){var z=!1;return{layer:C,listener:P,delegates:{mousemove:function(ee){var Z=L.getLayer(C)?L.queryRenderedFeatures(ee.point,{layers:[C]}):[];Z.length?z||(z=!0,P.call(L,new Pn(g,L,ee.originalEvent,{features:Z}))):z=!1},mouseout:function(){z=!1}}}}if(g==="mouseleave"||g==="mouseout"){var W=!1;return{layer:C,listener:P,delegates:{mousemove:function(ee){(L.getLayer(C)?L.queryRenderedFeatures(ee.point,{layers:[C]}):[]).length?W=!0:W&&(W=!1,P.call(L,new Pn(g,L,ee.originalEvent)))},mouseout:function(ee){W&&(W=!1,P.call(L,new Pn(g,L,ee.originalEvent)))}}}}return{layer:C,listener:P,delegates:(R={},R[g]=function(ee){var Z=L.getLayer(C)?L.queryRenderedFeatures(ee.point,{layers:[C]}):[];Z.length&&(ee.features=Z,P.call(L,ee),delete ee.features)},R)}},h.prototype.on=function(g,C,P){if(P===void 0)return c.prototype.on.call(this,g,C);var R=this._createDelegatedListener(g,C,P);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(L,R.delegates[L]);return this},h.prototype.once=function(g,C,P){if(P===void 0)return c.prototype.once.call(this,g,C);var R=this._createDelegatedListener(g,C,P);for(var L in R.delegates)this.once(L,R.delegates[L]);return this},h.prototype.off=function(g,C,P){var R=this;return P===void 0?c.prototype.off.call(this,g,C):(this._delegatedListeners&&this._delegatedListeners[g]&&function(L){for(var z=L[g],W=0;W<z.length;W++){var ee=z[W];if(ee.layer===C&&ee.listener===P){for(var Z in ee.delegates)R.off(Z,ee.delegates[Z]);return z.splice(W,1),R}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(g,C){if(!this.style)return[];var P;if(C!==void 0||g===void 0||g instanceof s.Point||Array.isArray(g)||(C=g,g=void 0),C=C||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof g[0]=="number")P=[s.Point.convert(g)];else{var R=s.Point.convert(g[0]),L=s.Point.convert(g[1]);P=[R,new s.Point(L.x,R.y),L,new s.Point(R.x,L.y),R]}return this.style.queryRenderedFeatures(P,C,this.transform)},h.prototype.querySourceFeatures=function(g,C){return this.style.querySourceFeatures(g,C)},h.prototype.setStyle=function(g,C){return(C=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},C)).diff!==!1&&C.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,C),this):(this._localIdeographFontFamily=C.localIdeographFontFamily,this._updateStyle(g,C))},h.prototype._getUIString=function(g){var C=this._locale[g];if(C==null)throw new Error("Missing UI string '"+g+"'");return C},h.prototype._updateStyle=function(g,C){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Dn(this,C||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(g,C){var P=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),L=this._requestManager.transformRequest(R,s.ResourceType.Style);s.getJSON(L,function(z,W){z?P.fire(new s.ErrorEvent(z)):W&&P._updateDiff(W,C)})}else typeof g=="object"&&this._updateDiff(g,C)},h.prototype._updateDiff=function(g,C){try{this.style.setState(g)&&this._update(!0)}catch(P){s.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(g,C)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(g,C){return this._lazyInitEmptyStyle(),this.style.addSource(g,C),this._update(!0)},h.prototype.isSourceLoaded=function(g){var C=this.style&&this.style.sourceCaches[g];if(C!==void 0)return C.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},h.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var C in g){var P=g[C]._tiles;for(var R in P){var L=P[R];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(g,C,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,C,P)},h.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},h.prototype.getSource=function(g){return this.style.getSource(g)},h.prototype.addImage=function(g,C,P){P===void 0&&(P={});var R=P.pixelRatio;R===void 0&&(R=1);var L=P.sdf;L===void 0&&(L=!1);var z=P.stretchX,W=P.stretchY,ee=P.content;if(this._lazyInitEmptyStyle(),C instanceof Ks||jr&&C instanceof jr){var Z=s.browser.getImageData(C);this.style.addImage(g,{data:new s.RGBAImage({width:Z.width,height:Z.height},Z.data),pixelRatio:R,stretchX:z,stretchY:W,content:ee,sdf:L,version:0})}else{if(C.width===void 0||C.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var te=C;this.style.addImage(g,{data:new s.RGBAImage({width:C.width,height:C.height},new Uint8Array(C.data)),pixelRatio:R,stretchX:z,stretchY:W,content:ee,sdf:L,version:0,userImage:te}),te.onAdd&&te.onAdd(this,g)}},h.prototype.updateImage=function(g,C){var P=this.style.getImage(g);if(!P)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=C instanceof Ks||jr&&C instanceof jr?s.browser.getImageData(C):C,L=R.width,z=R.height,W=R.data;return L===void 0||z===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==P.data.width||z!==P.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace(W,!(C instanceof Ks||jr&&C instanceof jr)),void this.style.updateImage(g,P))},h.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(g){this.style.removeImage(g)},h.prototype.loadImage=function(g,C){s.getImage(this._requestManager.transformRequest(g,s.ResourceType.Image),C)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(g,C){return this._lazyInitEmptyStyle(),this.style.addLayer(g,C),this._update(!0)},h.prototype.moveLayer=function(g,C){return this.style.moveLayer(g,C),this._update(!0)},h.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},h.prototype.getLayer=function(g){return this.style.getLayer(g)},h.prototype.setLayerZoomRange=function(g,C,P){return this.style.setLayerZoomRange(g,C,P),this._update(!0)},h.prototype.setFilter=function(g,C,P){return P===void 0&&(P={}),this.style.setFilter(g,C,P),this._update(!0)},h.prototype.getFilter=function(g){return this.style.getFilter(g)},h.prototype.setPaintProperty=function(g,C,P,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,C,P,R),this._update(!0)},h.prototype.getPaintProperty=function(g,C){return this.style.getPaintProperty(g,C)},h.prototype.setLayoutProperty=function(g,C,P,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,C,P,R),this._update(!0)},h.prototype.getLayoutProperty=function(g,C){return this.style.getLayoutProperty(g,C)},h.prototype.setLight=function(g,C){return C===void 0&&(C={}),this._lazyInitEmptyStyle(),this.style.setLight(g,C),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(g,C){return this.style.setFeatureState(g,C),this._update()},h.prototype.removeFeatureState=function(g,C){return this.style.removeFeatureState(g,C),this._update()},h.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var g=0,C=0;return this._container&&(g=this._container.clientWidth||400,C=this._container.clientHeight||300),[g,C]},h.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=d.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var C=this._canvasContainer=d.create("div","mapboxgl-canvas-container",g);this._interactive&&C.classList.add("mapboxgl-interactive"),this._canvas=d.create("canvas","mapboxgl-canvas",C),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var R=this._controlContainer=d.create("div","mapboxgl-control-container",g),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){L[z]=d.create("div","mapboxgl-ctrl-"+z,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(g,C){var P=s.browser.devicePixelRatio||1;this._canvas.width=P*g,this._canvas.height=P*C,this._canvas.style.width=g+"px",this._canvas.style.height=C+"px"},h.prototype._setupPainter=function(){var g=s.extend({},u.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),C=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);C?(this.painter=new zn(C,this.transform),s.webpSupported.testSupport(C)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:g}))},h.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:g}))},h.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},h.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},h.prototype._render=function(g){var C,P=this,R=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(C=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,C),R=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var W=this.transform.zoom,ee=s.browser.now();this.style.zoomHistory.update(W,ee);var Z=new s.EvaluationParameters(W,{now:ee,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),te=Z.crossFadingFactor();te===1&&te===this._crossFadingFactor||(z=!0,this._crossFadingFactor=te),this.style.update(Z)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var se=s.browser.now()-R;L.endQueryEXT(L.TIME_ELAPSED_EXT,C),setTimeout(function(){var ge=L.getQueryObjectEXT(C,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(C),P.fire(new s.Event("gpu-timing-frame",{cpuTime:se,gpuTime:ge}))},50)}if(this.listens("gpu-timing-layer")){var we=this.painter.collectGpuTimers();setTimeout(function(){var ge=P.painter.queryGpuTimers(we);P.fire(new s.Event("gpu-timing-layer",{layerTimes:ge}))},50)}var Fe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Fe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||Fe||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,C=this._controls;g<C.length;g+=1)C[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),Fs(this._canvasContainer),Fs(this._controlContainer),Fs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},h.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=s.browser.frame(function(C){g._frame=null,g._render(C)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(g){this._vertices=g,this._update()},h.prototype._setCacheLimits=function(g,C){s.setCacheLimits(g,C)},f.version.get=function(){return s.version},Object.defineProperties(h.prototype,f),h}(nu);function Fs(c){c.parentNode&&c.parentNode.removeChild(c)}var sf={showCompass:!0,showZoom:!0,visualizePitch:!1},si=function(c){var h=this;this.options=s.extend({},sf,c),this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return h._map.zoomIn({},{originalEvent:f})}),d.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return h._map.zoomOut({},{originalEvent:f})}),d.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:f}):h._map.resetNorth({},{originalEvent:f})}),this._compassIcon=d.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};si.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),h=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},si.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},si.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yi(this._map,this._compass,this.options.visualizePitch)),this._container},si.prototype.onRemove=function(){d.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},si.prototype._createButton=function(c,h){var f=d.create("button",c,this._container);return f.type="button",f.addEventListener("click",h),f},si.prototype._setButtonTitle=function(c,h){var f=this._map._getUIString("NavigationControl."+h);c.title=f,c.setAttribute("aria-label",f)};var Yi=function(c,h,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new eu({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new tf({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener(h,"mousedown",this.mousedown),d.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),d.addEventListener(h,"touchmove",this.touchmove),d.addEventListener(h,"touchend",this.touchend),d.addEventListener(h,"touchcancel",this.reset)};function fo(c,h,f){if(c=new s.LngLat(c.lng,c.lat),h){var g=new s.LngLat(c.lng-360,c.lat),C=new s.LngLat(c.lng+360,c.lat),P=f.locationPoint(c).distSqr(h);f.locationPoint(g).distSqr(h)<P?c=g:f.locationPoint(C).distSqr(h)<P&&(c=C)}for(;Math.abs(c.lng-f.center.lng)>180;){var R=f.locationPoint(c);if(R.x>=0&&R.y>=0&&R.x<=f.width&&R.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}Yi.prototype.down=function(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),d.disableDrag()},Yi.prototype.move=function(c,h){var f=this.map,g=this.mouseRotate.mousemoveWindow(c,h);if(g&&g.bearingDelta&&f.setBearing(f.getBearing()+g.bearingDelta),this.mousePitch){var C=this.mousePitch.mousemoveWindow(c,h);C&&C.pitchDelta&&f.setPitch(f.getPitch()+C.pitchDelta)}},Yi.prototype.off=function(){var c=this.element;d.removeEventListener(c,"mousedown",this.mousedown),d.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),d.removeEventListener(c,"touchmove",this.touchmove),d.removeEventListener(c,"touchend",this.touchend),d.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},Yi.prototype.offTemp=function(){d.enableDrag(),d.removeEventListener(s.window,"mousemove",this.mousemove),d.removeEventListener(s.window,"mouseup",this.mouseup)},Yi.prototype.mousedown=function(c){this.down(s.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),d.mousePos(this.element,c)),d.addEventListener(s.window,"mousemove",this.mousemove),d.addEventListener(s.window,"mouseup",this.mouseup)},Yi.prototype.mousemove=function(c){this.move(c,d.mousePos(this.element,c))},Yi.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},Yi.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=d.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},Yi.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=d.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},Yi.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Yi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var ho={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ht(c,h,f){var g=c.classList;for(var C in ho)g.remove("mapboxgl-"+f+"-anchor-"+C);g.add("mapboxgl-"+f+"-anchor-"+h)}var Yt,Cc=function(c){function h(f,g){if(c.call(this),(f instanceof s.window.HTMLElement||g)&&(f=s.extend({element:f},g)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=s.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=d.create("div"),this._element.setAttribute("aria-label","Map marker");var C=d.createNS("http://www.w3.org/2000/svg","svg");C.setAttributeNS(null,"display","block"),C.setAttributeNS(null,"height","41px"),C.setAttributeNS(null,"width","27px"),C.setAttributeNS(null,"viewBox","0 0 27 41");var P=d.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var R=d.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var L=d.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var z=0,W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<W.length;z+=1){var ee=W[z],Z=d.createNS("http://www.w3.org/2000/svg","ellipse");Z.setAttributeNS(null,"opacity","0.04"),Z.setAttributeNS(null,"cx","10.5"),Z.setAttributeNS(null,"cy","5.80029008"),Z.setAttributeNS(null,"rx",ee.rx),Z.setAttributeNS(null,"ry",ee.ry),L.appendChild(Z)}var te=d.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"fill",this._color);var se=d.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),te.appendChild(se);var we=d.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");var Fe=d.createNS("http://www.w3.org/2000/svg","path");Fe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(Fe);var ge=d.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");var Re=d.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ve=d.createNS("http://www.w3.org/2000/svg","circle");Ve.setAttributeNS(null,"fill","#000000"),Ve.setAttributeNS(null,"opacity","0.25"),Ve.setAttributeNS(null,"cx","5.5"),Ve.setAttributeNS(null,"cy","5.5"),Ve.setAttributeNS(null,"r","5.4999962");var $e=d.createNS("http://www.w3.org/2000/svg","circle");$e.setAttributeNS(null,"fill","#FFFFFF"),$e.setAttributeNS(null,"cx","5.5"),$e.setAttributeNS(null,"cy","5.5"),$e.setAttributeNS(null,"r","5.4999962"),Re.appendChild(Ve),Re.appendChild($e),R.appendChild(L),R.appendChild(te),R.appendChild(we),R.appendChild(ge),R.appendChild(Re),C.appendChild(R),C.setAttributeNS(null,"height",41*this._scale+"px"),C.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(C),this._offset=s.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(rt){rt.preventDefault()}),this._element.addEventListener("mousedown",function(rt){rt.preventDefault()}),Ht(this._element,this._anchor,"marker"),this._popup=null}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),d.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=s.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(f){var g=f.code,C=f.charCode||f.keyCode;g!=="Space"&&g!=="Enter"&&C!==32&&C!==13||this.togglePopup()},h.prototype._onMapClick=function(f){var g=f.originalEvent.target,C=this._element;this._popup&&(g===C||C.contains(g))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},h.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=fo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),d.setTransform(this._element,ho[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+C+" "+g)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(f){return this._offset=s.Point.convert(f),this._update(),this},h.prototype._onMove=function(f){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(s.Evented),dl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ho=0,bo=!1,jo=function(c){function h(f){c.call(this),this.options=s.extend({},dl,f),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){var g;return this._map=f,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Yt!==void 0?g(Yt):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(function(C){g(Yt=C.state!=="denied")}):g(Yt=!!s.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),d.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ho=0,bo=!1},h.prototype._isOutOfMapMaxBounds=function(f){var g=this._map.getMaxBounds(),C=f.coords;return g&&(C.longitude<g.getWest()||C.longitude>g.getEast()||C.latitude<g.getSouth()||C.latitude>g.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",f)),this._finish()}},h.prototype._updateCamera=function(f){var g=new s.LngLat(f.coords.longitude,f.coords.latitude),C=f.coords.accuracy,P=this._map.getBearing(),R=s.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(C),R,{geolocateSource:!0})},h.prototype._updateMarker=function(f){if(f){var g=new s.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,g=this._map.unproject([0,f]),C=this._map.unproject([1,f]),P=g.distanceTo(C),R=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&bo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",f)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(f){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=d.create("button","mapboxgl-ctrl-geolocate",this._container),d.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var C=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Cc(this._dotElement),this._circleElement=d.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new s.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ho--,bo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ho>1?(f={maximumAge:6e5,timeout:0},bo=!0):(f=this.options.positionOptions,bo=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(s.Evented),$o={maxWidth:100,unit:"metric"},ls=function(c){this.options=s.extend({},$o,c),s.bindAll(["_onMove","setUnit"],this)};function _(c,h,f){var g=f&&f.maxWidth||100,C=c._container.clientHeight/2,P=c.unproject([0,C]),R=c.unproject([g,C]),L=P.distanceTo(R);if(f&&f.unit==="imperial"){var z=3.2808*L;z>5280?m(h,g,z/5280,c._getUIString("ScaleControl.Miles")):m(h,g,z,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?m(h,g,L/1852,c._getUIString("ScaleControl.NauticalMiles")):L>=1e3?m(h,g,L/1e3,c._getUIString("ScaleControl.Kilometers")):m(h,g,L,c._getUIString("ScaleControl.Meters"))}function m(c,h,f,g){var C,P,R,L=(C=f,(P=Math.pow(10,(""+Math.floor(C)).length-1))*(R=(R=C/P)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(z){var W=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*W)/W}(R)));c.style.width=h*(L/f)+"px",c.innerHTML=L+"&nbsp;"+g}ls.prototype.getDefaultPosition=function(){return"bottom-left"},ls.prototype._onMove=function(){_(this._map,this._container,this.options)},ls.prototype.onAdd=function(c){return this._map=c,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ls.prototype.onRemove=function(){d.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ls.prototype.setUnit=function(c){this.options.unit=c,_(this._map,this._container,this.options)};var v=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};v.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},v.prototype.onRemove=function(){d.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},v.prototype._setupUI=function(){var c=this._fullscreenButton=d.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);d.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},v.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},v.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},v.prototype._isFullscreen=function(){return this._fullscreen},v.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},v.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var w={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},B=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),M=function(c){function h(f){c.call(this),this.options=s.extend(Object.create(w),f),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&d.remove(this._content),this._container&&(d.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=s.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(f){return this.setDOMContent(s.window.document.createTextNode(f))},h.prototype.setHTML=function(f){var g,C=s.window.document.createDocumentFragment(),P=s.window.document.createElement("body");for(P.innerHTML=f;g=P.firstChild;)C.appendChild(g);return this.setDOMContent(C)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},h.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=d.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},h.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},h.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},h.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=d.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(f){this._update(f.point)},h.prototype._onMouseMove=function(f){this._update(f.point)},h.prototype._onDrag=function(f){this._update(f.point)},h.prototype._update=function(f){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=d.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=d.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Z){return g._container.classList.add(Z)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var C=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),P=this.options.anchor,R=function Z(te){if(te){if(typeof te=="number"){var se=Math.round(Math.sqrt(.5*Math.pow(te,2)));return{center:new s.Point(0,0),top:new s.Point(0,te),"top-left":new s.Point(se,se),"top-right":new s.Point(-se,se),bottom:new s.Point(0,-te),"bottom-left":new s.Point(se,-se),"bottom-right":new s.Point(-se,-se),left:new s.Point(te,0),right:new s.Point(-te,0)}}if(te instanceof s.Point||Array.isArray(te)){var we=s.Point.convert(te);return{center:we,top:we,"top-left":we,"top-right":we,bottom:we,"bottom-left":we,"bottom-right":we,left:we,right:we}}return{center:s.Point.convert(te.center||[0,0]),top:s.Point.convert(te.top||[0,0]),"top-left":s.Point.convert(te["top-left"]||[0,0]),"top-right":s.Point.convert(te["top-right"]||[0,0]),bottom:s.Point.convert(te.bottom||[0,0]),"bottom-left":s.Point.convert(te["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(te["bottom-right"]||[0,0]),left:s.Point.convert(te.left||[0,0]),right:s.Point.convert(te.right||[0,0])}}return Z(new s.Point(0,0))}(this.options.offset);if(!P){var L,z=this._container.offsetWidth,W=this._container.offsetHeight;L=C.y+R.bottom.y<W?["top"]:C.y>this._map.transform.height-W?["bottom"]:[],C.x<z/2?L.push("left"):C.x>this._map.transform.width-z/2&&L.push("right"),P=L.length===0?"bottom":L.join("-")}var ee=C.add(R[P]).round();d.setTransform(this._container,ho[P]+" translate("+ee.x+"px,"+ee.y+"px)"),Ht(this._container,P,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(B);f&&f.focus()}},h.prototype._onClose=function(){this.remove()},h}(s.Evented),D={version:s.version,supported:u,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:iu,NavigationControl:si,GeolocateControl:jo,AttributionControl:rs,ScaleControl:ls,FullscreenControl:v,Popup:M,Marker:Cc,Style:Dn,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){lt().acquire(Xe)},clearPrewarmedResources:function(){var c=St;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Xe),St=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return wt.workerCount},set workerCount(c){wt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){s.clearTileCache(c)},workerUrl:""};return D}),i})}(vm)),vm.exports}var $ie=jie();const Jc=Kf($ie);var Wie=1e-7;function w2(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function t6(t,e){if(t===e)return!0;if(w2(t)&&w2(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(!t6(t[r],e[r]))return!1;return!0}return Math.abs(t-e)<=Wie}function R0(t,e,r){return Math.max(e,Math.min(r,t))}function a_(t,e,r){return w2(t)?t.map(function(n,i){return a_(n,e[i],r)}):r*e+(1-r)*t}function Ka(t,e){if(!t)throw new Error(e||"react-map-gl: assertion failed.")}function t3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function r3(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?t3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):t3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Rf={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},ib={pitch:0,bearing:0,altitude:1.5},n3=5,Jie=1.2,tA=function(){function t(e){var r=e.width,n=e.height,i=e.latitude,o=e.longitude,s=e.zoom,u=e.bearing,d=u===void 0?ib.bearing:u,y=e.pitch,x=y===void 0?ib.pitch:y,E=e.altitude,S=E===void 0?ib.altitude:E,O=e.maxZoom,k=O===void 0?Rf.maxZoom:O,U=e.minZoom,J=U===void 0?Rf.minZoom:U,G=e.maxPitch,H=G===void 0?Rf.maxPitch:G,K=e.minPitch,he=K===void 0?Rf.minPitch:K,Y=e.transitionDuration,oe=e.transitionEasing,Ee=e.transitionInterpolator,ze=e.transitionInterruption,de=e.startPanLngLat,ve=e.startZoomLngLat,Ae=e.startRotatePos,$=e.startBearing,re=e.startPitch,Te=e.startZoom;Nu(this,t),Ka(Number.isFinite(r),"`width` must be supplied"),Ka(Number.isFinite(n),"`height` must be supplied"),Ka(Number.isFinite(o),"`longitude` must be supplied"),Ka(Number.isFinite(i),"`latitude` must be supplied"),Ka(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:r,height:n,latitude:i,longitude:o,zoom:s,bearing:d,pitch:x,altitude:S,maxZoom:k,minZoom:J,maxPitch:H,minPitch:he,transitionDuration:Y,transitionEasing:oe,transitionInterpolator:Ee,transitionInterruption:ze}),this._state={startPanLngLat:de,startZoomLngLat:ve,startRotatePos:Ae,startBearing:$,startPitch:re,startZoom:Te}}return Lu(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(r){var n=r.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(n)})}},{key:"pan",value:function(r){var n=r.pos,i=r.startPos,o=this._state.startPanLngLat||this._unproject(i);if(!o)return this;var s=this._calculateNewLngLat({startPanLngLat:o,pos:n}),u=os(s,2),d=u[0],y=u[1];return this._getUpdatedMapState({longitude:d,latitude:y})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(r){var n=r.pos;return this._getUpdatedMapState({startRotatePos:n,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(r){var n=r.pos,i=r.deltaAngleX,o=i===void 0?0:i,s=r.deltaAngleY,u=s===void 0?0:s,d=this._state,y=d.startRotatePos,x=d.startBearing,E=d.startPitch;if(!Number.isFinite(x)||!Number.isFinite(E))return this;var S;return n?S=this._calculateNewPitchAndBearing(r3(r3({},this._getRotationParams(n,y)),{},{startBearing:x,startPitch:E})):S={bearing:x+o,pitch:E+u},this._getUpdatedMapState(S)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(r){var n=r.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(n),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(r){var n=r.pos,i=r.startPos,o=r.scale;Ka(o>0,"`scale` must be a positive number");var s=this._state,u=s.startZoom,d=s.startZoomLngLat;Number.isFinite(u)||(u=this._viewportProps.zoom,d=this._unproject(i)||this._unproject(n)),Ka(d,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var y=this._calculateNewZoom({scale:o,startZoom:u||0}),x=new $c(Object.assign({},this._viewportProps,{zoom:y})),E=x.getMapCenterByLngLatPosition({lngLat:d,pos:n}),S=os(E,2),O=S[0],k=S[1];return this._getUpdatedMapState({zoom:y,longitude:O,latitude:k})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(r){return new t(Object.assign({},this._viewportProps,this._state,r))}},{key:"_applyConstraints",value:function(r){var n=r.maxZoom,i=r.minZoom,o=r.zoom;r.zoom=R0(o,i,n);var s=r.maxPitch,u=r.minPitch,d=r.pitch;return r.pitch=R0(d,u,s),Object.assign(r,Die(r)),r}},{key:"_unproject",value:function(r){var n=new $c(this._viewportProps);return r&&n.unproject(r)}},{key:"_calculateNewLngLat",value:function(r){var n=r.startPanLngLat,i=r.pos,o=new $c(this._viewportProps);return o.getMapCenterByLngLatPosition({lngLat:n,pos:i})}},{key:"_calculateNewZoom",value:function(r){var n=r.scale,i=r.startZoom,o=this._viewportProps,s=o.maxZoom,u=o.minZoom,d=i+Math.log2(n);return R0(d,u,s)}},{key:"_calculateNewPitchAndBearing",value:function(r){var n=r.deltaScaleX,i=r.deltaScaleY,o=r.startBearing,s=r.startPitch;i=R0(i,-1,1);var u=this._viewportProps,d=u.minPitch,y=u.maxPitch,x=o+180*n,E=s;return i>0?E=s+i*(y-s):i<0&&(E=s-i*(d-s)),{pitch:E,bearing:x}}},{key:"_getRotationParams",value:function(r,n){var i=r[0]-n[0],o=r[1]-n[1],s=r[1],u=n[1],d=this._viewportProps,y=d.width,x=d.height,E=i/y,S=0;return o>0?Math.abs(x-u)>n3&&(S=o/(u-x)*Jie):o<0&&u>n3&&(S=1-s/u),S=Math.min(1,Math.max(-1,S)),{deltaScaleX:E,deltaScaleY:S}}}]),t}();function Xie(t){return t[0].toLowerCase()+t.slice(1)}function Kie(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rf;for(var r in e){var n=r.slice(0,3),i=Xie(r.slice(3));if(n==="min"&&t[i]<e[r]||n==="max"&&t[i]>e[r])return!1}return!0}function i3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function s3(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?i3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var nh=Et.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),gw=nh.Provider;function qie(t){var e=t.value,r=t.children,n=Et.useState(null),i=os(n,2),o=i[0],s=i[1],u=Et.useContext(nh);return e=s3(s3({setMap:s},u),{},{map:u&&u.map||o},e),Et.createElement(gw,{value:e},r)}nh.Provider=qie;var C2=typeof window<"u"?Et.useLayoutEffect:Et.useEffect;function o3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Xa(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?o3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Yie="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",r6="A valid API access token is required to use Mapbox data";function Zie(){}function n6(t){var e=t.props,r=t.width,n=t.height;return new $c(Xa(Xa(Xa({},e),e.viewState),{},{width:r,height:n}))}var Qie=401,a3={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},ese=Object.assign({},rh.propTypes,{width:ht.oneOfType([ht.number,ht.string]),height:ht.oneOfType([ht.number,ht.string]),onResize:ht.func,disableTokenWarning:ht.bool,visible:ht.bool,className:ht.string,style:ht.object,visibilityConstraints:ht.object}),tse=Object.assign({},rh.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:Zie,className:"",style:null,visibilityConstraints:Rf});function rse(){var t={position:"absolute",left:0,top:0};return Et.createElement("div",{key:"warning",id:"no-token-warning",style:t},Et.createElement("h3",{key:"header"},r6),Et.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Et.createElement("a",{key:"link",href:Yie},"Note on Map Tokens"))}function nse(t){return{getMap:function(){return t.current&&t.current.getMap()},queryRenderedFeatures:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.current&&t.current.getMap();return i&&i.queryRenderedFeatures(r,n)}}}var Ll=Et.forwardRef(function(t,e){var r=Et.useState(!0),n=os(r,2),i=n[0],o=n[1],s=Et.useState({width:0,height:0}),u=os(s,2),d=u[0],y=u[1],x=Et.useRef(null),E=Et.useRef(null),S=Et.useRef(null),O=Et.useRef(null),k=Et.useContext(nh);C2(function(){if(Ll.supported()){var ve=new rh(Xa(Xa(Xa({},t),d),{},{mapboxgl:Jc,container:E.current,onError:function(re){var Te=re.error&&re.error.status||re.status;Te===Qie&&i&&(console.error(r6),o(!1)),t.onError(re)}}));x.current=ve,k&&k.setMap&&k.setMap(ve.getMap());var Ae=new lU(function($){if($[0].contentRect){var re=$[0].contentRect,Te=re.width,Qe=re.height;y({width:Te,height:Qe}),t.onResize({width:Te,height:Qe})}});return Ae.observe(S.current),function(){ve.finalize(),x.current=null,Ae.disconnect()}}},[]),C2(function(){x.current&&x.current.setProps(Xa(Xa({},t),d))});var U=x.current&&x.current.getMap();Et.useImperativeHandle(e,function(){return nse(x)},[]);var J=Et.useCallback(function(ve){var Ae=ve.target;Ae===O.current&&Ae.scrollTo(0,0)},[]),G=U&&Et.createElement(gw,{value:Xa(Xa({},k),{},{viewport:k.viewport||n6(Xa({map:U,props:t},d)),map:U,container:k.container||S.current})},Et.createElement("div",{key:"map-overlays",className:"overlays",ref:O,style:a3,onScroll:J},t.children)),H=t.className,K=t.width,he=t.height,Y=t.style,oe=t.visibilityConstraints,Ee=Object.assign({position:"relative"},Y,{width:K,height:he}),ze=t.visible&&Kie(t.viewState||t,oe),de=Object.assign({},a3,{visibility:ze?"inherit":"hidden"});return Et.createElement("div",{key:"map-container",ref:S,style:Ee},Et.createElement("div",{key:"map-mapbox",ref:E,style:de,className:H}),G,!i&&!t.disableTokenWarning&&Et.createElement(rse,null))});Ll.supported=function(){return Jc&&Jc.supported()};Ll.propTypes=ese;Ll.defaultProps=tse;function ise(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=sse(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(y){throw y},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,u;return{s:function(){r=t[Symbol.iterator]()},n:function(){var y=r.next();return o=y.done,y},e:function(y){s=!0,u=y},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw u}}}}function sse(t,e){if(t){if(typeof t=="string")return c3(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c3(t,e)}}function c3(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var i6=function(){function t(){Nu(this,t),vr(this,"propNames",[])}return Lu(t,[{key:"arePropsEqual",value:function(r,n){var i=ise(this.propNames||[]),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;if(!t6(r[s],n[s]))return!1}}catch(u){i.e(u)}finally{i.f()}return!0}},{key:"initializeProps",value:function(r,n){return{start:r,end:n}}},{key:"interpolateProps",value:function(r,n,i){Ka(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(r,n){return n.transitionDuration}}]),t}(),ose={longitude:1,bearing:1};function c_(t){return Number.isFinite(t)||Array.isArray(t)}function ase(t){return t in ose}function T2(t,e,r){return ase(t)&&Math.abs(r-e)>180&&(r=r<0?r+360:r-360),r}function sb(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=cse(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(y){throw y},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,u;return{s:function(){r=t[Symbol.iterator]()},n:function(){var y=r.next();return o=y.done,y},e:function(y){s=!0,u=y},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw u}}}}function cse(t,e){if(t){if(typeof t=="string")return l3(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l3(t,e)}}function l3(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function lse(t){var e=use();return function(){var n=sA(t),i;if(e){var o=sA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return lx(this,i)}}function use(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var fse=["longitude","latitude","zoom","bearing","pitch"],hse=["latitude","longitude","zoom","width","height"],u3=["bearing","pitch"],dse={speed:1.2,curve:1.414};(function(t){cx(r,t);var e=lse(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Nu(this,r),n=e.call(this),vr(yu(n),"propNames",fse),n.props=Object.assign({},dse,i),n}return Lu(r,[{key:"initializeProps",value:function(i,o){var s={},u={},d=sb(hse),y;try{for(d.s();!(y=d.n()).done;){var x=y.value,E=i[x],S=o[x];Ka(c_(E)&&c_(S),"".concat(x," must be supplied for transition")),s[x]=E,u[x]=T2(x,E,S)}}catch(H){d.e(H)}finally{d.f()}var O=sb(u3),k;try{for(O.s();!(k=O.n()).done;){var U=k.value,J=i[U]||0,G=o[U]||0;s[U]=J,u[U]=T2(U,J,G)}}catch(H){O.e(H)}finally{O.f()}return{start:s,end:u}}},{key:"interpolateProps",value:function(i,o,s){var u=Lie(i,o,s,this.props),d=sb(u3),y;try{for(d.s();!(y=d.n()).done;){var x=y.value;u[x]=a_(i[x],o[x],s)}}catch(E){d.e(E)}finally{d.f()}return u}},{key:"getDuration",value:function(i,o){var s=o.transitionDuration;return s==="auto"&&(s=Nie(i,o,this.props)),s}}]),r})(i6);function f3(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Ase(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(y){throw y},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,u;return{s:function(){r=t[Symbol.iterator]()},n:function(){var y=r.next();return o=y.done,y},e:function(y){s=!0,u=y},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw u}}}}function Ase(t,e){if(t){if(typeof t=="string")return h3(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h3(t,e)}}function h3(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function pse(t){var e=gse();return function(){var n=sA(t),i;if(e){var o=sA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return lx(this,i)}}function gse(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var mse=["longitude","latitude","zoom","bearing","pitch"],Up=function(t){cx(r,t);var e=pse(r);function r(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Nu(this,r),n=e.call(this),Array.isArray(i)&&(i={transitionProps:i}),n.propNames=i.transitionProps||mse,i.around&&(n.around=i.around),n}return Lu(r,[{key:"initializeProps",value:function(i,o){var s={},u={};if(this.around){s.around=this.around;var d=new $c(i).unproject(this.around);Object.assign(u,o,{around:new $c(o).project(d),aroundLngLat:d})}var y=f3(this.propNames),x;try{for(y.s();!(x=y.n()).done;){var E=x.value,S=i[E],O=o[E];Ka(c_(S)&&c_(O),"".concat(E," must be supplied for transition")),s[E]=S,u[E]=T2(E,S,O)}}catch(k){y.e(k)}finally{y.f()}return{start:s,end:u}}},{key:"interpolateProps",value:function(i,o,s){var u={},d=f3(this.propNames),y;try{for(d.s();!(y=d.n()).done;){var x=y.value;u[x]=a_(i[x],o[x],s)}}catch(U){d.e(U)}finally{d.f()}if(o.around){var E=new $c(Object.assign({},o,u)).getMapCenterByLngLatPosition({lngLat:o.aroundLngLat,pos:a_(i.around,o.around,s)}),S=os(E,2),O=S[0],k=S[1];u.longitude=O,u.latitude=k}return u}}]),r}(i6),zp=function(){};function _se(t,e){var r=t(e);return function(n){return 1/(1-r)*(t(n*(1-e)+e)-r)}}var Gp={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},yse={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new Up,transitionInterruption:Gp.BREAK,onTransitionStart:zp,onTransitionInterrupt:zp,onTransitionEnd:zp},mw=function(){function t(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Nu(this,t),vr(this,"_animationFrame",null),vr(this,"_onTransitionFrame",function(){e._animationFrame=requestAnimationFrame(e._onTransitionFrame),e._updateViewport()}),this.props=null,this.onViewportChange=r.onViewportChange||zp,this.onStateChange=r.onStateChange||zp,this.time=r.getTime||Date.now}return Lu(t,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(r){var n=this.props;if(this.props=r,!n||this._shouldIgnoreViewportChange(n,r))return!1;if(this._isTransitionEnabled(r)){var i=Object.assign({},n),o=Object.assign({},r);if(this._isTransitionInProgress()&&(n.onTransitionInterrupt(),this.state.interruption===Gp.SNAP_TO_END?Object.assign(i,this.state.endProps):Object.assign(i,this.state.propsInTransition),this.state.interruption===Gp.UPDATE)){var s=this.time(),u=(s-this.state.startTime)/this.state.duration;o.transitionDuration=this.state.duration-(s-this.state.startTime),o.transitionEasing=_se(this.state.easing,u),o.transitionInterpolator=i.transitionInterpolator}return o.onTransitionStart(),this._triggerTransition(i,o),!0}return this._isTransitionInProgress()&&(n.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(r){var n=r.transitionDuration,i=r.transitionInterpolator;return(n>0||n==="auto")&&!!i}},{key:"_isUpdateDueToCurrentTransition",value:function(r){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(r,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(r,n){return r?this._isTransitionInProgress()?this.state.interruption===Gp.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(r,n):!0:!0}},{key:"_triggerTransition",value:function(r,n){Ka(this._isTransitionEnabled(n)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var i=n.transitionInterpolator,o=i.getDuration?i.getDuration(r,n):n.transitionDuration;if(o!==0){var s=n.transitionInterpolator.initializeProps(r,n),u={inTransition:!0,isZooming:r.zoom!==n.zoom,isPanning:r.longitude!==n.longitude||r.latitude!==n.latitude,isRotating:r.bearing!==n.bearing||r.pitch!==n.pitch};this.state={duration:o,easing:n.transitionEasing,interpolator:n.transitionInterpolator,interruption:n.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(u)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var r=this.time(),n=this.state,i=n.startTime,o=n.duration,s=n.easing,u=n.interpolator,d=n.startProps,y=n.endProps,x=!1,E=(r-i)/o;E>=1&&(E=1,x=!0),E=s(E);var S=u.interpolateProps(d,y,E),O=new tA(Object.assign({},this.props,S));this.state.propsInTransition=O.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),x&&(this._endTransition(),this.props.onTransitionEnd())}}]),t}();vr(mw,"defaultProps",yse);var ob={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var d3;function vse(){return d3||(d3=1,function(t){(function(e,r,n,i){var o=["","webkit","Moz","MS","ms","o"],s=r.createElement("div"),u="function",d=Math.round,y=Math.abs,x=Date.now;function E(xe,Pe,je){return setTimeout(K(xe,je),Pe)}function S(xe,Pe,je){return Array.isArray(xe)?(O(xe,je[Pe],je),!0):!1}function O(xe,Pe,je){var dt;if(xe)if(xe.forEach)xe.forEach(Pe,je);else if(xe.length!==i)for(dt=0;dt<xe.length;)Pe.call(je,xe[dt],dt,xe),dt++;else for(dt in xe)xe.hasOwnProperty(dt)&&Pe.call(je,xe[dt],dt,xe)}function k(xe,Pe,je){var dt="DEPRECATED METHOD: "+Pe+`
`+je+` AT 
`;return function(){var Vt=new Error("get-stack-trace"),pr=Vt&&Vt.stack?Vt.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Cr=e.console&&(e.console.warn||e.console.log);return Cr&&Cr.call(e.console,dt,pr),xe.apply(this,arguments)}}var U;typeof Object.assign!="function"?U=function(Pe){if(Pe===i||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var je=Object(Pe),dt=1;dt<arguments.length;dt++){var Vt=arguments[dt];if(Vt!==i&&Vt!==null)for(var pr in Vt)Vt.hasOwnProperty(pr)&&(je[pr]=Vt[pr])}return je}:U=Object.assign;var J=k(function(Pe,je,dt){for(var Vt=Object.keys(je),pr=0;pr<Vt.length;)(!dt||dt&&Pe[Vt[pr]]===i)&&(Pe[Vt[pr]]=je[Vt[pr]]),pr++;return Pe},"extend","Use `assign`."),G=k(function(Pe,je){return J(Pe,je,!0)},"merge","Use `assign`.");function H(xe,Pe,je){var dt=Pe.prototype,Vt;Vt=xe.prototype=Object.create(dt),Vt.constructor=xe,Vt._super=dt,je&&U(Vt,je)}function K(xe,Pe){return function(){return xe.apply(Pe,arguments)}}function he(xe,Pe){return typeof xe==u?xe.apply(Pe&&Pe[0]||i,Pe):xe}function Y(xe,Pe){return xe===i?Pe:xe}function oe(xe,Pe,je){O(ve(Pe),function(dt){xe.addEventListener(dt,je,!1)})}function Ee(xe,Pe,je){O(ve(Pe),function(dt){xe.removeEventListener(dt,je,!1)})}function ze(xe,Pe){for(;xe;){if(xe==Pe)return!0;xe=xe.parentNode}return!1}function de(xe,Pe){return xe.indexOf(Pe)>-1}function ve(xe){return xe.trim().split(/\s+/g)}function Ae(xe,Pe,je){if(xe.indexOf&&!je)return xe.indexOf(Pe);for(var dt=0;dt<xe.length;){if(je&&xe[dt][je]==Pe||!je&&xe[dt]===Pe)return dt;dt++}return-1}function $(xe){return Array.prototype.slice.call(xe,0)}function re(xe,Pe,je){for(var dt=[],Vt=[],pr=0;pr<xe.length;){var Cr=xe[pr][Pe];Ae(Vt,Cr)<0&&dt.push(xe[pr]),Vt[pr]=Cr,pr++}return dt=dt.sort(function(Si,Ui){return Si[Pe]>Ui[Pe]}),dt}function Te(xe,Pe){for(var je,dt,Vt=Pe[0].toUpperCase()+Pe.slice(1),pr=0;pr<o.length;){if(je=o[pr],dt=je?je+Vt:Pe,dt in xe)return dt;pr++}return i}var Qe=1;function me(){return Qe++}function Le(xe){var Pe=xe.ownerDocument||xe;return Pe.defaultView||Pe.parentWindow||e}var Ue=/mobile|tablet|ip(ad|hone|od)|android/i,Ye="ontouchstart"in e,et=Te(e,"PointerEvent")!==i,tt=Ye&&Ue.test(navigator.userAgent),ct="touch",mt="pen",Tt="mouse",nt="kinect",lr=25,qt=1,$t=2,Ot=4,fr=8,rn=1,Er=2,mr=4,Ln=8,dr=16,Ar=Er|mr,nn=Ln|dr,Ir=Ar|nn,ei=["x","y"],jn=["clientX","clientY"];function fn(xe,Pe){var je=this;this.manager=xe,this.callback=Pe,this.element=xe.element,this.target=xe.options.inputTarget,this.domHandler=function(dt){he(xe.options.enable,[xe])&&je.handler(dt)},this.init()}fn.prototype={handler:function(){},init:function(){this.evEl&&oe(this.element,this.evEl,this.domHandler),this.evTarget&&oe(this.target,this.evTarget,this.domHandler),this.evWin&&oe(Le(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ee(this.element,this.evEl,this.domHandler),this.evTarget&&Ee(this.target,this.evTarget,this.domHandler),this.evWin&&Ee(Le(this.element),this.evWin,this.domHandler)}};function Jn(xe){var Pe,je=xe.options.inputClass;return je?Pe=je:et?Pe=Ce:tt?Pe=fe:Ye?Pe=p:Pe=Nt,new Pe(xe,Nn)}function Nn(xe,Pe,je){var dt=je.pointers.length,Vt=je.changedPointers.length,pr=Pe&qt&&dt-Vt===0,Cr=Pe&(Ot|fr)&&dt-Vt===0;je.isFirst=!!pr,je.isFinal=!!Cr,pr&&(xe.session={}),je.eventType=Pe,bn(xe,je),xe.emit("hammer.input",je),xe.recognize(je),xe.session.prevInput=je}function bn(xe,Pe){var je=xe.session,dt=Pe.pointers,Vt=dt.length;je.firstInput||(je.firstInput=hr(Pe)),Vt>1&&!je.firstMultiple?je.firstMultiple=hr(Pe):Vt===1&&(je.firstMultiple=!1);var pr=je.firstInput,Cr=je.firstMultiple,ni=Cr?Cr.center:pr.center,Si=Pe.center=Br(dt);Pe.timeStamp=x(),Pe.deltaTime=Pe.timeStamp-pr.timeStamp,Pe.angle=Dt(ni,Si),Pe.distance=Me(ni,Si),$n(je,Pe),Pe.offsetDirection=ui(Pe.deltaX,Pe.deltaY);var Ui=Zr(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=Ui.x,Pe.overallVelocityY=Ui.y,Pe.overallVelocity=y(Ui.x)>y(Ui.y)?Ui.x:Ui.y,Pe.scale=Cr?sr(Cr.pointers,dt):1,Pe.rotation=Cr?Gt(Cr.pointers,dt):0,Pe.maxPointers=je.prevInput?Pe.pointers.length>je.prevInput.maxPointers?Pe.pointers.length:je.prevInput.maxPointers:Pe.pointers.length,kt(je,Pe);var Vs=xe.element;ze(Pe.srcEvent.target,Vs)&&(Vs=Pe.srcEvent.target),Pe.target=Vs}function $n(xe,Pe){var je=Pe.center,dt=xe.offsetDelta||{},Vt=xe.prevDelta||{},pr=xe.prevInput||{};(Pe.eventType===qt||pr.eventType===Ot)&&(Vt=xe.prevDelta={x:pr.deltaX||0,y:pr.deltaY||0},dt=xe.offsetDelta={x:je.x,y:je.y}),Pe.deltaX=Vt.x+(je.x-dt.x),Pe.deltaY=Vt.y+(je.y-dt.y)}function kt(xe,Pe){var je=xe.lastInterval||Pe,dt=Pe.timeStamp-je.timeStamp,Vt,pr,Cr,ni;if(Pe.eventType!=fr&&(dt>lr||je.velocity===i)){var Si=Pe.deltaX-je.deltaX,Ui=Pe.deltaY-je.deltaY,Vs=Zr(dt,Si,Ui);pr=Vs.x,Cr=Vs.y,Vt=y(Vs.x)>y(Vs.y)?Vs.x:Vs.y,ni=ui(Si,Ui),xe.lastInterval=Pe}else Vt=je.velocity,pr=je.velocityX,Cr=je.velocityY,ni=je.direction;Pe.velocity=Vt,Pe.velocityX=pr,Pe.velocityY=Cr,Pe.direction=ni}function hr(xe){for(var Pe=[],je=0;je<xe.pointers.length;)Pe[je]={clientX:d(xe.pointers[je].clientX),clientY:d(xe.pointers[je].clientY)},je++;return{timeStamp:x(),pointers:Pe,center:Br(Pe),deltaX:xe.deltaX,deltaY:xe.deltaY}}function Br(xe){var Pe=xe.length;if(Pe===1)return{x:d(xe[0].clientX),y:d(xe[0].clientY)};for(var je=0,dt=0,Vt=0;Vt<Pe;)je+=xe[Vt].clientX,dt+=xe[Vt].clientY,Vt++;return{x:d(je/Pe),y:d(dt/Pe)}}function Zr(xe,Pe,je){return{x:Pe/xe||0,y:je/xe||0}}function ui(xe,Pe){return xe===Pe?rn:y(xe)>=y(Pe)?xe<0?Er:mr:Pe<0?Ln:dr}function Me(xe,Pe,je){je||(je=ei);var dt=Pe[je[0]]-xe[je[0]],Vt=Pe[je[1]]-xe[je[1]];return Math.sqrt(dt*dt+Vt*Vt)}function Dt(xe,Pe,je){je||(je=ei);var dt=Pe[je[0]]-xe[je[0]],Vt=Pe[je[1]]-xe[je[1]];return Math.atan2(Vt,dt)*180/Math.PI}function Gt(xe,Pe){return Dt(Pe[1],Pe[0],jn)+Dt(xe[1],xe[0],jn)}function sr(xe,Pe){return Me(Pe[0],Pe[1],jn)/Me(xe[0],xe[1],jn)}var qe={mousedown:qt,mousemove:$t,mouseup:Ot},It="mousedown",pe="mousemove mouseup";function Nt(){this.evEl=It,this.evWin=pe,this.pressed=!1,fn.apply(this,arguments)}H(Nt,fn,{handler:function(Pe){var je=qe[Pe.type];je&qt&&Pe.button===0&&(this.pressed=!0),je&$t&&Pe.which!==1&&(je=Ot),this.pressed&&(je&Ot&&(this.pressed=!1),this.callback(this.manager,je,{pointers:[Pe],changedPointers:[Pe],pointerType:Tt,srcEvent:Pe}))}});var xt={pointerdown:qt,pointermove:$t,pointerup:Ot,pointercancel:fr,pointerout:fr},j={2:ct,3:mt,4:Tt,5:nt},_t="pointerdown",Ct="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(_t="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel");function Ce(){this.evEl=_t,this.evWin=Ct,fn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}H(Ce,fn,{handler:function(Pe){var je=this.store,dt=!1,Vt=Pe.type.toLowerCase().replace("ms",""),pr=xt[Vt],Cr=j[Pe.pointerType]||Pe.pointerType,ni=Cr==ct,Si=Ae(je,Pe.pointerId,"pointerId");pr&qt&&(Pe.button===0||ni)?Si<0&&(je.push(Pe),Si=je.length-1):pr&(Ot|fr)&&(dt=!0),!(Si<0)&&(je[Si]=Pe,this.callback(this.manager,pr,{pointers:je,changedPointers:[Pe],pointerType:Cr,srcEvent:Pe}),dt&&je.splice(Si,1))}});var We={touchstart:qt,touchmove:$t,touchend:Ot,touchcancel:fr},at="touchstart",q="touchstart touchmove touchend touchcancel";function ne(){this.evTarget=at,this.evWin=q,this.started=!1,fn.apply(this,arguments)}H(ne,fn,{handler:function(Pe){var je=We[Pe.type];if(je===qt&&(this.started=!0),!!this.started){var dt=le.call(this,Pe,je);je&(Ot|fr)&&dt[0].length-dt[1].length===0&&(this.started=!1),this.callback(this.manager,je,{pointers:dt[0],changedPointers:dt[1],pointerType:ct,srcEvent:Pe})}}});function le(xe,Pe){var je=$(xe.touches),dt=$(xe.changedTouches);return Pe&(Ot|fr)&&(je=re(je.concat(dt),"identifier")),[je,dt]}var ye={touchstart:qt,touchmove:$t,touchend:Ot,touchcancel:fr},De="touchstart touchmove touchend touchcancel";function fe(){this.evTarget=De,this.targetIds={},fn.apply(this,arguments)}H(fe,fn,{handler:function(Pe){var je=ye[Pe.type],dt=be.call(this,Pe,je);dt&&this.callback(this.manager,je,{pointers:dt[0],changedPointers:dt[1],pointerType:ct,srcEvent:Pe})}});function be(xe,Pe){var je=$(xe.touches),dt=this.targetIds;if(Pe&(qt|$t)&&je.length===1)return dt[je[0].identifier]=!0,[je,je];var Vt,pr,Cr=$(xe.changedTouches),ni=[],Si=this.target;if(pr=je.filter(function(Ui){return ze(Ui.target,Si)}),Pe===qt)for(Vt=0;Vt<pr.length;)dt[pr[Vt].identifier]=!0,Vt++;for(Vt=0;Vt<Cr.length;)dt[Cr[Vt].identifier]&&ni.push(Cr[Vt]),Pe&(Ot|fr)&&delete dt[Cr[Vt].identifier],Vt++;if(ni.length)return[re(pr.concat(ni),"identifier"),ni]}var ae=2500,Be=25;function p(){fn.apply(this,arguments);var xe=K(this.handler,this);this.touch=new fe(this.manager,xe),this.mouse=new Nt(this.manager,xe),this.primaryTouch=null,this.lastTouches=[]}H(p,fn,{handler:function(Pe,je,dt){var Vt=dt.pointerType==ct,pr=dt.pointerType==Tt;if(!(pr&&dt.sourceCapabilities&&dt.sourceCapabilities.firesTouchEvents)){if(Vt)ce.call(this,je,dt);else if(pr&&Xe.call(this,dt))return;this.callback(Pe,je,dt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ce(xe,Pe){xe&qt?(this.primaryTouch=Pe.changedPointers[0].identifier,yt.call(this,Pe)):xe&(Ot|fr)&&yt.call(this,Pe)}function yt(xe){var Pe=xe.changedPointers[0];if(Pe.identifier===this.primaryTouch){var je={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(je);var dt=this.lastTouches,Vt=function(){var pr=dt.indexOf(je);pr>-1&&dt.splice(pr,1)};setTimeout(Vt,ae)}}function Xe(xe){for(var Pe=xe.srcEvent.clientX,je=xe.srcEvent.clientY,dt=0;dt<this.lastTouches.length;dt++){var Vt=this.lastTouches[dt],pr=Math.abs(Pe-Vt.x),Cr=Math.abs(je-Vt.y);if(pr<=Be&&Cr<=Be)return!0}return!1}var wt=Te(s.style,"touchAction"),St=wt!==i,Rt="compute",lt="auto",Ft="manipulation",Bt="none",Ut="pan-x",Dr="pan-y",Kt=Gr();function Kr(xe,Pe){this.manager=xe,this.set(Pe)}Kr.prototype={set:function(xe){xe==Rt&&(xe=this.compute()),St&&this.manager.element.style&&Kt[xe]&&(this.manager.element.style[wt]=xe),this.actions=xe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var xe=[];return O(this.manager.recognizers,function(Pe){he(Pe.options.enable,[Pe])&&(xe=xe.concat(Pe.getTouchAction()))}),tn(xe.join(" "))},preventDefaults:function(xe){var Pe=xe.srcEvent,je=xe.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var dt=this.actions,Vt=de(dt,Bt)&&!Kt[Bt],pr=de(dt,Dr)&&!Kt[Dr],Cr=de(dt,Ut)&&!Kt[Ut];if(Vt){var ni=xe.pointers.length===1,Si=xe.distance<2,Ui=xe.deltaTime<250;if(ni&&Si&&Ui)return}if(!(Cr&&pr)&&(Vt||pr&&je&Ar||Cr&&je&nn))return this.preventSrc(Pe)},preventSrc:function(xe){this.manager.session.prevented=!0,xe.preventDefault()}};function tn(xe){if(de(xe,Bt))return Bt;var Pe=de(xe,Ut),je=de(xe,Dr);return Pe&&je?Bt:Pe||je?Pe?Ut:Dr:de(xe,Ft)?Ft:lt}function Gr(){if(!St)return!1;var xe={},Pe=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(je){xe[je]=Pe?e.CSS.supports("touch-action",je):!0}),xe}var Vr=1,Nr=2,fi=4,Hr=8,ur=Hr,Ie=16,jt=32;function qr(xe){this.options=U({},this.defaults,xe||{}),this.id=me(),this.manager=null,this.options.enable=Y(this.options.enable,!0),this.state=Vr,this.simultaneous={},this.requireFail=[]}qr.prototype={defaults:{},set:function(xe){return U(this.options,xe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(xe){if(S(xe,"recognizeWith",this))return this;var Pe=this.simultaneous;return xe=ti(xe,this),Pe[xe.id]||(Pe[xe.id]=xe,xe.recognizeWith(this)),this},dropRecognizeWith:function(xe){return S(xe,"dropRecognizeWith",this)?this:(xe=ti(xe,this),delete this.simultaneous[xe.id],this)},requireFailure:function(xe){if(S(xe,"requireFailure",this))return this;var Pe=this.requireFail;return xe=ti(xe,this),Ae(Pe,xe)===-1&&(Pe.push(xe),xe.requireFailure(this)),this},dropRequireFailure:function(xe){if(S(xe,"dropRequireFailure",this))return this;xe=ti(xe,this);var Pe=Ae(this.requireFail,xe);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(xe){return!!this.simultaneous[xe.id]},emit:function(xe){var Pe=this,je=this.state;function dt(Vt){Pe.manager.emit(Vt,xe)}je<Hr&&dt(Pe.options.event+Ni(je)),dt(Pe.options.event),xe.additionalEvent&&dt(xe.additionalEvent),je>=Hr&&dt(Pe.options.event+Ni(je))},tryEmit:function(xe){if(this.canEmit())return this.emit(xe);this.state=jt},canEmit:function(){for(var xe=0;xe<this.requireFail.length;){if(!(this.requireFail[xe].state&(jt|Vr)))return!1;xe++}return!0},recognize:function(xe){var Pe=U({},xe);if(!he(this.options.enable,[this,Pe])){this.reset(),this.state=jt;return}this.state&(ur|Ie|jt)&&(this.state=Vr),this.state=this.process(Pe),this.state&(Nr|fi|Hr|Ie)&&this.tryEmit(Pe)},process:function(xe){},getTouchAction:function(){},reset:function(){}};function Ni(xe){return xe&Ie?"cancel":xe&Hr?"end":xe&fi?"move":xe&Nr?"start":""}function ia(xe){return xe==dr?"down":xe==Ln?"up":xe==Er?"left":xe==mr?"right":""}function ti(xe,Pe){var je=Pe.manager;return je?je.get(xe):xe}function kn(){qr.apply(this,arguments)}H(kn,qr,{defaults:{pointers:1},attrTest:function(xe){var Pe=this.options.pointers;return Pe===0||xe.pointers.length===Pe},process:function(xe){var Pe=this.state,je=xe.eventType,dt=Pe&(Nr|fi),Vt=this.attrTest(xe);return dt&&(je&fr||!Vt)?Pe|Ie:dt||Vt?je&Ot?Pe|Hr:Pe&Nr?Pe|fi:Nr:jt}});function Se(){kn.apply(this,arguments),this.pX=null,this.pY=null}H(Se,kn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ir},getTouchAction:function(){var xe=this.options.direction,Pe=[];return xe&Ar&&Pe.push(Dr),xe&nn&&Pe.push(Ut),Pe},directionTest:function(xe){var Pe=this.options,je=!0,dt=xe.distance,Vt=xe.direction,pr=xe.deltaX,Cr=xe.deltaY;return Vt&Pe.direction||(Pe.direction&Ar?(Vt=pr===0?rn:pr<0?Er:mr,je=pr!=this.pX,dt=Math.abs(xe.deltaX)):(Vt=Cr===0?rn:Cr<0?Ln:dr,je=Cr!=this.pY,dt=Math.abs(xe.deltaY))),xe.direction=Vt,je&&dt>Pe.threshold&&Vt&Pe.direction},attrTest:function(xe){return kn.prototype.attrTest.call(this,xe)&&(this.state&Nr||!(this.state&Nr)&&this.directionTest(xe))},emit:function(xe){this.pX=xe.deltaX,this.pY=xe.deltaY;var Pe=ia(xe.direction);Pe&&(xe.additionalEvent=this.options.event+Pe),this._super.emit.call(this,xe)}});function Po(){kn.apply(this,arguments)}H(Po,kn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Bt]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.scale-1)>this.options.threshold||this.state&Nr)},emit:function(xe){if(xe.scale!==1){var Pe=xe.scale<1?"in":"out";xe.additionalEvent=this.options.event+Pe}this._super.emit.call(this,xe)}});function Un(){qr.apply(this,arguments),this._timer=null,this._input=null}H(Un,qr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[lt]},process:function(xe){var Pe=this.options,je=xe.pointers.length===Pe.pointers,dt=xe.distance<Pe.threshold,Vt=xe.deltaTime>Pe.time;if(this._input=xe,!dt||!je||xe.eventType&(Ot|fr)&&!Vt)this.reset();else if(xe.eventType&qt)this.reset(),this._timer=E(function(){this.state=ur,this.tryEmit()},Pe.time,this);else if(xe.eventType&Ot)return ur;return jt},reset:function(){clearTimeout(this._timer)},emit:function(xe){this.state===ur&&(xe&&xe.eventType&Ot?this.manager.emit(this.options.event+"up",xe):(this._input.timeStamp=x(),this.manager.emit(this.options.event,this._input)))}});function Ro(){kn.apply(this,arguments)}H(Ro,kn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Bt]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.rotation)>this.options.threshold||this.state&Nr)}});function Bi(){kn.apply(this,arguments)}H(Bi,kn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ar|nn,pointers:1},getTouchAction:function(){return Se.prototype.getTouchAction.call(this)},attrTest:function(xe){var Pe=this.options.direction,je;return Pe&(Ar|nn)?je=xe.overallVelocity:Pe&Ar?je=xe.overallVelocityX:Pe&nn&&(je=xe.overallVelocityY),this._super.attrTest.call(this,xe)&&Pe&xe.offsetDirection&&xe.distance>this.options.threshold&&xe.maxPointers==this.options.pointers&&y(je)>this.options.velocity&&xe.eventType&Ot},emit:function(xe){var Pe=ia(xe.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,xe),this.manager.emit(this.options.event,xe)}});function ri(){qr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}H(ri,qr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ft]},process:function(xe){var Pe=this.options,je=xe.pointers.length===Pe.pointers,dt=xe.distance<Pe.threshold,Vt=xe.deltaTime<Pe.time;if(this.reset(),xe.eventType&qt&&this.count===0)return this.failTimeout();if(dt&&Vt&&je){if(xe.eventType!=Ot)return this.failTimeout();var pr=this.pTime?xe.timeStamp-this.pTime<Pe.interval:!0,Cr=!this.pCenter||Me(this.pCenter,xe.center)<Pe.posThreshold;this.pTime=xe.timeStamp,this.pCenter=xe.center,!Cr||!pr?this.count=1:this.count+=1,this._input=xe;var ni=this.count%Pe.taps;if(ni===0)return this.hasRequireFailures()?(this._timer=E(function(){this.state=ur,this.tryEmit()},Pe.interval,this),Nr):ur}return jt},failTimeout:function(){return this._timer=E(function(){this.state=jt},this.options.interval,this),jt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ur&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function bi(xe,Pe){return Pe=Pe||{},Pe.recognizers=Y(Pe.recognizers,bi.defaults.preset),new ki(xe,Pe)}bi.VERSION="2.0.7",bi.defaults={domEvents:!1,touchAction:Rt,enable:!0,inputTarget:null,inputClass:null,preset:[[Ro,{enable:!1}],[Po,{enable:!1},["rotate"]],[Bi,{direction:Ar}],[Se,{direction:Ar},["swipe"]],[ri],[ri,{event:"doubletap",taps:2},["tap"]],[Un]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var En=1,as=2;function ki(xe,Pe){this.options=U({},bi.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||xe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=xe,this.input=Jn(this),this.touchAction=new Kr(this,this.options.touchAction),Bs(this,!0),O(this.options.recognizers,function(je){var dt=this.add(new je[0](je[1]));je[2]&&dt.recognizeWith(je[2]),je[3]&&dt.requireFailure(je[3])},this)}ki.prototype={set:function(xe){return U(this.options,xe),xe.touchAction&&this.touchAction.update(),xe.inputTarget&&(this.input.destroy(),this.input.target=xe.inputTarget,this.input.init()),this},stop:function(xe){this.session.stopped=xe?as:En},recognize:function(xe){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(xe);var je,dt=this.recognizers,Vt=Pe.curRecognizer;(!Vt||Vt&&Vt.state&ur)&&(Vt=Pe.curRecognizer=null);for(var pr=0;pr<dt.length;)je=dt[pr],Pe.stopped!==as&&(!Vt||je==Vt||je.canRecognizeWith(Vt))?je.recognize(xe):je.reset(),!Vt&&je.state&(Nr|fi|Hr)&&(Vt=Pe.curRecognizer=je),pr++}},get:function(xe){if(xe instanceof qr)return xe;for(var Pe=this.recognizers,je=0;je<Pe.length;je++)if(Pe[je].options.event==xe)return Pe[je];return null},add:function(xe){if(S(xe,"add",this))return this;var Pe=this.get(xe.options.event);return Pe&&this.remove(Pe),this.recognizers.push(xe),xe.manager=this,this.touchAction.update(),xe},remove:function(xe){if(S(xe,"remove",this))return this;if(xe=this.get(xe),xe){var Pe=this.recognizers,je=Ae(Pe,xe);je!==-1&&(Pe.splice(je,1),this.touchAction.update())}return this},on:function(xe,Pe){if(xe!==i&&Pe!==i){var je=this.handlers;return O(ve(xe),function(dt){je[dt]=je[dt]||[],je[dt].push(Pe)}),this}},off:function(xe,Pe){if(xe!==i){var je=this.handlers;return O(ve(xe),function(dt){Pe?je[dt]&&je[dt].splice(Ae(je[dt],Pe),1):delete je[dt]}),this}},emit:function(xe,Pe){this.options.domEvents&&xn(xe,Pe);var je=this.handlers[xe]&&this.handlers[xe].slice();if(!(!je||!je.length)){Pe.type=xe,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var dt=0;dt<je.length;)je[dt](Pe),dt++}},destroy:function(){this.element&&Bs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Bs(xe,Pe){var je=xe.element;if(je.style){var dt;O(xe.options.cssProps,function(Vt,pr){dt=Te(je.style,pr),Pe?(xe.oldCssProps[dt]=je.style[dt],je.style[dt]=Vt):je.style[dt]=xe.oldCssProps[dt]||""}),Pe||(xe.oldCssProps={})}}function xn(xe,Pe){var je=r.createEvent("Event");je.initEvent(xe,!0,!0),je.gesture=Pe,Pe.target.dispatchEvent(je)}U(bi,{INPUT_START:qt,INPUT_MOVE:$t,INPUT_END:Ot,INPUT_CANCEL:fr,STATE_POSSIBLE:Vr,STATE_BEGAN:Nr,STATE_CHANGED:fi,STATE_ENDED:Hr,STATE_RECOGNIZED:ur,STATE_CANCELLED:Ie,STATE_FAILED:jt,DIRECTION_NONE:rn,DIRECTION_LEFT:Er,DIRECTION_RIGHT:mr,DIRECTION_UP:Ln,DIRECTION_DOWN:dr,DIRECTION_HORIZONTAL:Ar,DIRECTION_VERTICAL:nn,DIRECTION_ALL:Ir,Manager:ki,Input:fn,TouchAction:Kr,TouchInput:fe,MouseInput:Nt,PointerEventInput:Ce,TouchMouseInput:p,SingleTouchInput:ne,Recognizer:qr,AttrRecognizer:kn,Tap:ri,Pan:Se,Swipe:Bi,Pinch:Po,Rotate:Ro,Press:Un,on:oe,off:Ee,each:O,merge:G,extend:J,assign:U,inherit:H,bindFn:K,prefixed:Te});var Qc=typeof e<"u"?e:typeof self<"u"?self:{};Qc.Hammer=bi,t.exports?t.exports=bi:e[n]=bi})(window,document,"Hammer")}(ob)),ob.exports}var _g=vse();const bse=Kf(_g),Nc=wU({__proto__:null,default:bse},[_g]),s6=1,o6=2,E2=4,xse={mousedown:s6,mousemove:o6,mouseup:E2};function wse(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}function Cse(t){const e=t.prototype.handler;t.prototype.handler=function(n){const i=this.store;n.button>0&&n.type==="pointerdown"&&(wse(i,o=>o.pointerId===n.pointerId)||i.push(n)),e.call(this,n)}}function Tse(t){t.prototype.handler=function(r){let n=xse[r.type];n&s6&&r.button>=0&&(this.pressed=!0),n&o6&&r.buttons===0&&(n=E2),this.pressed&&(n&E2&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[r],changedPointers:[r],pointerType:"mouse",srcEvent:r}))}}Cse(_g.PointerEventInput);Tse(_g.MouseInput);const Ese=_g.Manager;class q_{constructor(e,r,n){this.element=e,this.callback=r,this.options={enable:!0,...n}}}const Bse=Nc?[[Nc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Nc.Rotate,{enable:!1}],[Nc.Pinch,{enable:!1}],[Nc.Swipe,{enable:!1}],[Nc.Pan,{threshold:0,enable:!1}],[Nc.Press,{enable:!1}],[Nc.Tap,{event:"doubletap",taps:2,enable:!1}],[Nc.Tap,{event:"anytap",enable:!1}],[Nc.Tap,{enable:!1}]]:null,A3={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Sse={doubletap:["tap"]},Ise={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},_w={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Mse={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},p3={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Pse=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Vd=typeof window<"u"?window:global;let B2=!1;try{const t={get passive(){return B2=!0,!0}};Vd.addEventListener("test",null,t),Vd.removeEventListener("test",null)}catch{B2=!1}const Rse=Pse.indexOf("firefox")!==-1,{WHEEL_EVENTS:Fse}=_w,g3="wheel",m3=4.000244140625,Dse=40,Ose=.25;class Lse extends q_{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;Vd.WheelEvent&&(Rse&&i.deltaMode===Vd.WheelEvent.DOM_DELTA_PIXEL&&(o/=Vd.devicePixelRatio),i.deltaMode===Vd.WheelEvent.DOM_DELTA_LINE&&(o*=Dse)),o!==0&&o%m3===0&&(o=Math.floor(o/m3)),i.shiftKey&&o&&(o=o*Ose),this.callback({type:g3,center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(Fse),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,B2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===g3&&(this.options.enable=r)}}const{MOUSE_EVENTS:Nse}=_w,_3="pointermove",y3="pointerover",v3="pointerout",b3="pointerenter",x3="pointerleave";class kse extends q_{constructor(e,r,n){super(e,r,n),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(Nse),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===_3&&(this.enableMoveEvent=r),e===y3&&(this.enableOverEvent=r),e===v3&&(this.enableOutEvent=r),e===b3&&(this.enableEnterEvent=r),e===x3&&(this.enableLeaveEvent=r)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(y3,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(v3,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(b3,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(x3,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(_3,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const{KEY_EVENTS:Use}=_w,w3="keydown",C3="keyup";class zse extends q_{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:w3,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:C3,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Use),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e===w3&&(this.enableDownEvent=r),e===C3&&(this.enableUpEvent=r)}}const T3="contextmenu";class Gse extends q_{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:T3,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e===T3&&(this.options.enable=r)}}const E3=1,S2=2,B3=4,Vse={pointerdown:E3,pointermove:S2,pointerup:B3,mousedown:E3,mousemove:S2,mouseup:B3},Hse=0,jse=1,$se=2,Wse=1,Jse=2,Xse=4;function Kse(t){const e=Vse[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let i=!1,o=!1,s=!1;return e===S2?(i=!!(r&Wse),o=!!(r&Xse),s=!!(r&Jse)):(i=n===Hse,o=n===jse,s=n===$se),{leftButton:i,middleButton:o,rightButton:s}}function qse(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,s={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/o};return{center:r,offsetCenter:s}}const ab={srcElement:"root",priority:0};class Yse{constructor(e){this.handleEvent=r=>{if(this.isEmpty())return;const n=this._normalizeEvent(r);let i=r.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,i=!1,o=!1){const{handlers:s,handlersByElement:u}=this;let d=ab;typeof n=="string"||n&&n.addEventListener?d={...ab,srcElement:n}:n&&(d={...ab,...n});let y=u.get(d.srcElement);y||(y=[],u.set(d.srcElement,y));const x={type:e,handler:r,srcElement:d.srcElement,priority:d.priority};i&&(x.once=!0),o&&(x.passive=!0),s.push(x),this._active=this._active||!x.passive;let E=y.length-1;for(;E>=0&&!(y[E].priority>=x.priority);)E--;y.splice(E+1,0,x)}remove(e,r){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const s=n[o];if(s.type===e&&s.handler===r){n.splice(o,1);const u=i.get(s.srcElement);u.splice(u.indexOf(s),1),u.length===0&&i.delete(s.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let i=!1;const o=()=>{e.handled=!0},s=()=>{e.handled=!0,i=!0},u=[];for(let d=0;d<n.length;d++){const{type:y,handler:x,once:E}=n[d];if(x({...e,type:y,stopPropagation:o,stopImmediatePropagation:s}),E&&u.push(n[d]),i)break}for(let d=0;d<u.length;d++){const{type:y,handler:x}=u[d];this.remove(y,x)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...Kse(e),...qse(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}const Zse={events:null,recognizers:null,recognizerOptions:{},Manager:Ese,touchAction:"none",tabIndex:0};class Qse{constructor(e=null,r){this._onBasicInput=i=>{const{srcEvent:o}=i,s=Ise[o.type];s&&this.manager.emit(s,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...Zse,...r},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:r}=this,n=r.Manager;this.manager=new n(e,{touchAction:r.touchAction,recognizers:r.recognizers||Bse}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(A3).forEach(i=>{const o=this.manager.get(i);o&&A3[i].forEach(s=>{o.recognizeWith(s)})});for(const i in r.recognizerOptions){const o=this.manager.get(i);if(o){const s=r.recognizerOptions[i];delete s.enable,o.set(s)}}this.wheelInput=new Lse(e,this._onOtherEvent,{enable:!1}),this.moveInput=new kse(e,this._onOtherEvent,{enable:!1}),this.keyInput=new zse(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new Gse(e,this._onOtherEvent,{enable:!1});for(const[i,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(i,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==r){i.set({enable:r});const o=Sse[e];o&&!this.options.recognizers&&o.forEach(s=>{const u=n.get(s);r?(u.requireFailure(e),i.dropRequireFailure(s)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,r),this.moveInput.enableEventType(e,r),this.keyInput.enableEventType(e,r),this.contextmenuInput.enableEventType(e,r)}_addEventHandler(e,r,n,i,o){if(typeof e!="string"){n=r;for(const x in e)this._addEventHandler(x,e[x],n,i,o);return}const{manager:s,events:u}=this,d=p3[e]||e;let y=u.get(d);y||(y=new Yse(this),u.set(d,y),y.recognizerName=Mse[d]||d,s&&s.on(d,y.handleEvent)),y.add(e,r,n,i,o),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const s in e)this._removeEventHandler(s,e[s]);return}const{events:n}=this,i=p3[e]||e,o=n.get(i);if(o&&(o.remove(e,r),o.isEmpty())){const{recognizerName:s}=o;let u=!1;for(const d of n.values())if(d.recognizerName===s&&!d.isEmpty()){u=!0;break}u||this._toggleRecognizer(s,!1)}}}function S3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function go(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?S3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):S3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var yf={transitionDuration:0},Cl={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new Up,transitionInterruption:Gp.BREAK},F0=300,D0=function(e){return 1-(1-e)*(1-e)},ud={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},a6=function(){function t(){var e=this;Nu(this,t),vr(this,"events",[]),vr(this,"scrollZoom",!0),vr(this,"dragPan",!0),vr(this,"dragRotate",!0),vr(this,"doubleClickZoom",!0),vr(this,"touchZoom",!0),vr(this,"touchRotate",!1),vr(this,"keyboard",!0),vr(this,"_interactionState",{isDragging:!1}),vr(this,"_events",{}),vr(this,"_setInteractionState",function(r){Object.assign(e._interactionState,r),e.onStateChange&&e.onStateChange(e._interactionState)}),vr(this,"_onTransition",function(r,n){e.onViewportChange(r,e._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new mw({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return Lu(t,[{key:"handleEvent",value:function(r){this.mapState=this.getMapState();var n=this._eventStartBlocked;switch(r.type){case"panstart":return n?!1:this._onPanStart(r);case"panmove":return this._onPan(r);case"panend":return this._onPanEnd(r);case"pinchstart":return n?!1:this._onPinchStart(r);case"pinchmove":return this._onPinch(r);case"pinchend":return this._onPinchEnd(r);case"tripanstart":return n?!1:this._onTriplePanStart(r);case"tripanmove":return this._onTriplePan(r);case"tripanend":return this._onTriplePanEnd(r);case"doubletap":return this._onDoubleTap(r);case"wheel":return this._onWheel(r);case"keydown":return this._onKeyDown(r);default:return!1}}},{key:"getCenter",value:function(r){var n=r.offsetCenter,i=n.x,o=n.y;return[i,o]}},{key:"isFunctionKeyPressed",value:function(r){var n=r.srcEvent;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"blockEvents",value:function(r){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},r);this._eventStartBlocked=i}},{key:"updateViewport",value:function(r,n,i){var o=this.mapState instanceof tA?this.mapState.getViewportProps():this.mapState,s=go(go({},r.getViewportProps()),n),u=Object.keys(s).some(function(d){return o[d]!==s[d]});this._state=r.getState(),this._setInteractionState(i),u&&this.onViewportChange(s,this._interactionState,o)}},{key:"getMapState",value:function(r){return new tA(go(go(go({},this.mapStateProps),this._state),r))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(r){var n=r.onViewportChange,i=r.onStateChange,o=r.eventManager,s=o===void 0?this.eventManager:o,u=r.isInteractive,d=u===void 0?!0:u,y=r.scrollZoom,x=y===void 0?this.scrollZoom:y,E=r.dragPan,S=E===void 0?this.dragPan:E,O=r.dragRotate,k=O===void 0?this.dragRotate:O,U=r.doubleClickZoom,J=U===void 0?this.doubleClickZoom:U,G=r.touchZoom,H=G===void 0?this.touchZoom:G,K=r.touchRotate,he=K===void 0?this.touchRotate:K,Y=r.keyboard,oe=Y===void 0?this.keyboard:Y;this.onViewportChange=n,this.onStateChange=i;var Ee=this.mapStateProps||{},ze=Ee.height!==r.height||Ee.width!==r.width;this.mapStateProps=r,ze&&(this.mapState=Ee,this.updateViewport(new tA(r))),this._transitionManager.processViewportChange(r),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(ud.WHEEL,d&&!!x),this.toggleEvents(ud.PAN,d&&!!(S||k)),this.toggleEvents(ud.PINCH,d&&!!(H||he)),this.toggleEvents(ud.TRIPLE_PAN,d&&!!he),this.toggleEvents(ud.DOUBLE_TAP,d&&!!J),this.toggleEvents(ud.KEYBOARD,d&&!!oe),this.scrollZoom=x,this.dragPan=S,this.dragRotate=k,this.doubleClickZoom=J,this.touchZoom=H,this.touchRotate=he,this.keyboard=oe}},{key:"toggleEvents",value:function(r,n){var i=this;this.eventManager&&r.forEach(function(o){i._events[o]!==n&&(i._events[o]=n,n?i.eventManager.on(o,i.handleEvent):i.eventManager.off(o,i.handleEvent))})}},{key:"_onPanStart",value:function(r){var n=this.getCenter(r);this._panRotate=this.isFunctionKeyPressed(r)||r.rightButton;var i=this._panRotate?this.mapState.rotateStart({pos:n}):this.mapState.panStart({pos:n});return this.updateViewport(i,yf,{isDragging:!0}),!0}},{key:"_onPan",value:function(r){return this.isDragging()?this._panRotate?this._onPanRotate(r):this._onPanMove(r):!1}},{key:"_onPanEnd",value:function(r){return this.isDragging()?this._panRotate?this._onPanRotateEnd(r):this._onPanMoveEnd(r):!1}},{key:"_onPanMove",value:function(r){if(!this.dragPan)return!1;var n=this.getCenter(r),i=this.mapState.pan({pos:n});return this.updateViewport(i,yf,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(r){if(this.dragPan){var n=this.dragPan.inertia,i=n===void 0?F0:n;if(i&&r.velocity){var o=this.getCenter(r),s=[o[0]+r.velocityX*i/2,o[1]+r.velocityY*i/2],u=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(u,go(go({},Cl),{},{transitionDuration:i,transitionEasing:D0}),{isDragging:!1,isPanning:!0}),!0}}var d=this.mapState.panEnd();return this.updateViewport(d,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(r){if(!this.dragRotate)return!1;var n=this.getCenter(r),i=this.mapState.rotate({pos:n});return this.updateViewport(i,yf,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(r){if(this.dragRotate){var n=this.dragRotate.inertia,i=n===void 0?F0:n;if(i&&r.velocity){var o=this.getCenter(r),s=[o[0]+r.velocityX*i/2,o[1]+r.velocityY*i/2],u=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(u,go(go({},Cl),{},{transitionDuration:i,transitionEasing:D0}),{isDragging:!1,isRotating:!0}),!0}}var d=this.mapState.panEnd();return this.updateViewport(d,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(r){if(!this.scrollZoom)return!1;var n=this.scrollZoom,i=n.speed,o=i===void 0?.01:i,s=n.smooth,u=s===void 0?!1:s;r.preventDefault();var d=this.getCenter(r),y=r.delta,x=2/(1+Math.exp(-Math.abs(y*o)));y<0&&x!==0&&(x=1/x);var E=this.mapState.zoom({pos:d,scale:x});return E.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(E,go(go({},Cl),{},{transitionInterpolator:new Up({around:d}),transitionDuration:u?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(r){var n=this.getCenter(r),i=this.mapState.zoomStart({pos:n}).rotateStart({pos:n});return this._startPinchRotation=r.rotation,this._lastPinchEvent=r,this.updateViewport(i,yf,{isDragging:!0}),!0}},{key:"_onPinch",value:function(r){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var n=this.mapState;if(this.touchZoom){var i=r.scale,o=this.getCenter(r);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){var s=r.rotation;n=n.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(n,yf,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=r,!0}},{key:"_onPinchEnd",value:function(r){if(!this.isDragging())return!1;if(this.touchZoom){var n=this.touchZoom.inertia,i=n===void 0?F0:n,o=this._lastPinchEvent;if(i&&o&&r.scale!==o.scale){var s=this.getCenter(r),u=this.mapState.rotateEnd(),d=Math.log2(r.scale),y=(d-Math.log2(o.scale))/(r.deltaTime-o.deltaTime),x=Math.pow(2,d+y*i/2);return u=u.zoom({pos:s,scale:x}).zoomEnd(),this.updateViewport(u,go(go({},Cl),{},{transitionInterpolator:new Up({around:s}),transitionDuration:i,transitionEasing:D0}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(i),!0}}var E=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(E,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(r){var n=this.getCenter(r),i=this.mapState.rotateStart({pos:n});return this.updateViewport(i,yf,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(r){if(!this.isDragging()||!this.touchRotate)return!1;var n=this.getCenter(r);n[0]-=r.deltaX;var i=this.mapState.rotate({pos:n});return this.updateViewport(i,yf,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(r){if(!this.isDragging())return!1;if(this.touchRotate){var n=this.touchRotate.inertia,i=n===void 0?F0:n;if(i&&r.velocityY){var o=this.getCenter(r),s=[o[0],o[1]+=r.velocityY*i/2],u=this.mapState.rotate({pos:s});return this.updateViewport(u,go(go({},Cl),{},{transitionDuration:i,transitionEasing:D0}),{isDragging:!1,isRotating:!0}),this.blockEvents(i),!1}}var d=this.mapState.rotateEnd();return this.updateViewport(d,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(r){if(!this.doubleClickZoom)return!1;var n=this.getCenter(r),i=this.isFunctionKeyPressed(r),o=this.mapState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,Object.assign({},Cl,{transitionInterpolator:new Up({around:n})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(r){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(r),i=this.keyboard,o=i.zoomSpeed,s=o===void 0?2:o,u=i.moveSpeed,d=u===void 0?100:u,y=i.rotateSpeedX,x=y===void 0?15:y,E=i.rotateSpeedY,S=E===void 0?10:E,O=this.mapStateProps,k;switch(r.srcEvent.keyCode){case 189:n?k=this.getMapState({zoom:O.zoom-Math.log2(s)-1}):k=this.getMapState({zoom:O.zoom-Math.log2(s)});break;case 187:n?k=this.getMapState({zoom:O.zoom+Math.log2(s)+1}):k=this.getMapState({zoom:O.zoom+Math.log2(s)});break;case 37:n?k=this.getMapState({bearing:O.bearing-x}):k=this.mapState.pan({pos:[d,0],startPos:[0,0]});break;case 39:n?k=this.getMapState({bearing:O.bearing+x}):k=this.mapState.pan({pos:[-d,0],startPos:[0,0]});break;case 38:n?k=this.getMapState({pitch:O.pitch+S}):k=this.mapState.pan({pos:[0,d],startPos:[0,0]});break;case 40:n?k=this.getMapState({pitch:O.pitch-S}):k=this.mapState.pan({pos:[0,-d],startPos:[0,0]});break;default:return!1}return this.updateViewport(k,Cl)}}]),t}();function I3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function xl(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?I3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var eoe=Object.assign({},Ll.propTypes,{maxZoom:ht.number,minZoom:ht.number,maxPitch:ht.number,minPitch:ht.number,onViewStateChange:ht.func,onViewportChange:ht.func,onInteractionStateChange:ht.func,transitionDuration:ht.oneOfType([ht.number,ht.string]),transitionInterpolator:ht.object,transitionInterruption:ht.number,transitionEasing:ht.func,onTransitionStart:ht.func,onTransitionInterrupt:ht.func,onTransitionEnd:ht.func,scrollZoom:ht.oneOfType([ht.bool,ht.object]),dragPan:ht.oneOfType([ht.bool,ht.object]),dragRotate:ht.oneOfType([ht.bool,ht.object]),doubleClickZoom:ht.bool,touchZoom:ht.oneOfType([ht.bool,ht.object]),touchRotate:ht.oneOfType([ht.bool,ht.object]),keyboard:ht.oneOfType([ht.bool,ht.object]),onHover:ht.func,onClick:ht.func,onDblClick:ht.func,onContextMenu:ht.func,onMouseDown:ht.func,onMouseMove:ht.func,onMouseUp:ht.func,onTouchStart:ht.func,onTouchMove:ht.func,onTouchEnd:ht.func,onMouseEnter:ht.func,onMouseLeave:ht.func,onMouseOut:ht.func,onWheel:ht.func,touchAction:ht.string,eventRecognizerOptions:ht.object,clickRadius:ht.number,interactiveLayerIds:ht.array,getCursor:ht.func,controller:ht.instanceOf(a6)}),toe=function(e){var r=e.isDragging,n=e.isHovering;return r?"grabbing":n?"pointer":"grab"},roe=Object.assign({},Ll.defaultProps,Rf,mw.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:toe});function yw(t){if(t.lngLat||!t.offsetCenter)return t;var e=t.offsetCenter,r=e.x,n=e.y;if(!Number.isFinite(r)||!Number.isFinite(n))return t;var i=[r,n];return t.point=i,t.lngLat=this.viewport.unproject(i),t}function c6(t){var e=this.map;if(!e||!t)return null;var r={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(r.layers=this.props.interactiveLayerIds);try{return e.queryRenderedFeatures(n?[[t[0]-n,t[1]+n],[t[0]+n,t[1]-n]]:t,r)}catch{return null}}function Sl(t,e){var r=this.props[t];r&&r(yw.call(this,e))}function noe(t){Sl.call(this,t.pointerType==="touch"?"onTouchStart":"onMouseDown",t)}function ioe(t){Sl.call(this,t.pointerType==="touch"?"onTouchEnd":"onMouseUp",t)}function soe(t){if(Sl.call(this,t.pointerType==="touch"?"onTouchMove":"onMouseMove",t),!this.state.isDragging){var e=this.props,r=e.onHover,n=e.interactiveLayerIds,i;t=yw.call(this,t),(n||r)&&(i=c6.call(this,t.point));var o=!!(n&&i&&i.length>0),s=o&&!this.state.isHovering,u=!o&&this.state.isHovering;(r||s)&&(t.features=i,r&&r(t)),s&&Sl.call(this,"onMouseEnter",t),u&&Sl.call(this,"onMouseLeave",t),(s||u)&&this.setState({isHovering:o})}}function M3(t){var e=this.props,r=e.onClick,n=e.onNativeClick,i=e.onDblClick,o=e.doubleClickZoom,s=[],u=i||o;switch(t.type){case"anyclick":s.push(n),u||s.push(r);break;case"click":u&&s.push(r);break}s=s.filter(Boolean),s.length&&(t=yw.call(this,t),t.features=c6.call(this,t.point),s.forEach(function(d){return d(t)}))}function ooe(t){return{getMap:t.current&&t.current.getMap,queryRenderedFeatures:t.current&&t.current.queryRenderedFeatures}}var vw=Et.forwardRef(function(t,e){var r=Et.useContext(nh),n=Et.useMemo(function(){return t.controller||new a6},[]),i=Et.useMemo(function(){return new Qse(null,{touchAction:t.touchAction,recognizerOptions:t.eventRecognizerOptions})},[]),o=Et.useRef(null),s=Et.useRef(null),u=Et.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),d=u.current;d.props=t,d.map=s.current&&s.current.getMap(),d.setState=function(oe){d.state=xl(xl({},d.state),oe),o.current.style.cursor=t.getCursor(d.state)};var y=!0,x,E,S=function(Ee,ze,de){if(y){x=[Ee,ze,de];return}var ve=d.props,Ae=ve.onViewStateChange,$=ve.onViewportChange;Ae&&Ae({viewState:Ee,interactionState:ze,oldViewState:de}),$&&$(Ee,ze,de)};Et.useImperativeHandle(e,function(){return ooe(s)},[]);var O=Et.useMemo(function(){return xl(xl({},r),{},{eventManager:i,container:r.container||o.current})},[r,o.current]);O.onViewportChange=S,O.viewport=r.viewport||n6(d),d.viewport=O.viewport;var k=function(Ee){var ze=Ee.isDragging,de=ze===void 0?!1:ze;if(de!==d.state.isDragging&&d.setState({isDragging:de}),y){E=Ee;return}var ve=d.props.onInteractionStateChange;ve&&ve(Ee)},U=function(){d.width&&d.height&&n.setOptions(xl(xl(xl({},d.props),d.props.viewState),{},{isInteractive:!!(d.props.onViewStateChange||d.props.onViewportChange),onViewportChange:S,onStateChange:k,eventManager:i,width:d.width,height:d.height}))},J=function(Ee){var ze=Ee.width,de=Ee.height;d.width=ze,d.height=de,U(),d.props.onResize({width:ze,height:de})};Et.useEffect(function(){return i.setElement(o.current),i.on({pointerdown:noe.bind(d),pointermove:soe.bind(d),pointerup:ioe.bind(d),pointerleave:Sl.bind(d,"onMouseOut"),click:M3.bind(d),anyclick:M3.bind(d),dblclick:Sl.bind(d,"onDblClick"),wheel:Sl.bind(d,"onWheel"),contextmenu:Sl.bind(d,"onContextMenu")}),function(){i.destroy()}},[]),C2(function(){x&&S.apply(void 0,pU(x)),E&&k(E)}),U();var G=t.width,H=t.height,K=t.style,he=t.getCursor,Y=Et.useMemo(function(){return xl(xl({position:"relative"},K),{},{width:G,height:H,cursor:he(d.state)})},[K,G,H,he,d.state]);return(!x||!d._child)&&(d._child=Et.createElement(gw,{value:O},Et.createElement("div",{key:"event-canvas",ref:o,style:Y},Et.createElement(Ll,oD({},t,{width:"100%",height:"100%",style:null,onResize:J,ref:s}))))),y=!1,d._child});vw.supported=Ll.supported;vw.propTypes=eoe;vw.defaultProps=roe;ht.string.isRequired;var aoe=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];ht.oneOf(aoe).isRequired;var ku={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},uc={captureScroll:ht.bool,captureDrag:ht.bool,captureClick:ht.bool,captureDoubleClick:ht.bool,capturePointerMove:ht.bool};function coe(t){var e=t.containerRef.current,r=t.context.eventManager;if(!(!e||!r)){var n={wheel:function(o){var s=t.props;s.captureScroll&&o.stopPropagation(),s.onScroll&&s.onScroll(o,t)},panstart:function(o){var s=t.props;s.captureDrag&&o.stopPropagation(),s.onDragStart&&s.onDragStart(o,t)},anyclick:function(o){var s=t.props;s.captureClick&&o.stopPropagation(),s.onNativeClick&&s.onNativeClick(o,t)},click:function(o){var s=t.props;s.captureClick&&o.stopPropagation(),s.onClick&&s.onClick(o,t)},dblclick:function(o){var s=t.props;s.captureDoubleClick&&o.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(o,t)},pointermove:function(o){var s=t.props;s.capturePointerMove&&o.stopPropagation(),s.onPointerMove&&s.onPointerMove(o,t)}};return r.watch(n,e),function(){r.off(n)}}}function Uu(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Et.useContext(nh),r=Et.useRef(null),n=Et.useRef({props:t,state:{},context:e,containerRef:r}),i=n.current;return i.props=t,i.context=e,Et.useEffect(function(){return coe(i)},[e.eventManager]),i}function loe(t){var e=uoe();return function(){var n=sA(t),i;if(e){var o=sA(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return lx(this,i)}}function uoe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function foe(t){var e=t.instance,r=Uu(t),n=r.context,i=r.containerRef;return e._context=n,e._containerRef=i,e._render()}var l6=function(t){cx(r,t);var e=loe(r);function r(){var n;Nu(this,r);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=e.call.apply(e,[this].concat(o)),vr(yu(n),"_context",{}),vr(yu(n),"_containerRef",Et.createRef()),vr(yu(n),"_onScroll",function(u){}),vr(yu(n),"_onDragStart",function(u){}),vr(yu(n),"_onDblClick",function(u){}),vr(yu(n),"_onClick",function(u){}),vr(yu(n),"_onPointerMove",function(u){}),n}return Lu(r,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Et.createElement(foe,oD({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),r}(Et.PureComponent);vr(l6,"propTypes",uc);vr(l6,"defaultProps",ku);function P3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function R3(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?P3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):P3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var hoe=Object.assign({},uc,{draggable:ht.bool,onDrag:ht.func,onDragEnd:ht.func,onDragStart:ht.func,offsetLeft:ht.number,offsetTop:ht.number}),doe=Object.assign({},ku,{draggable:!1,offsetLeft:0,offsetTop:0});function u6(t){var e=t.offsetCenter,r=e.x,n=e.y;return[r,n]}function Aoe(t,e){var r=t.center,n=r.x,i=r.y;if(e){var o=e.getBoundingClientRect();return[o.left-n,o.top-i]}return null}function bw(t,e,r,n){var i=t[0]+e[0]-r.offsetLeft,o=t[1]+e[1]-r.offsetTop;return n.viewport.unproject([i,o])}function poe(t,e){var r=e.props,n=e.callbacks,i=e.state,o=e.context,s=e.containerRef,u=r.draggable;if(u){t.stopPropagation();var d=u6(t),y=Aoe(t,s.current);if(i.setDragPos(d),i.setDragOffset(y),n.onDragStart&&y){var x=Object.assign({},t);x.lngLat=bw(d,y,r,o),n.onDragStart(x)}}}function goe(t,e){var r=e.props,n=e.callbacks,i=e.state,o=e.context;t.stopPropagation();var s=u6(t);i.setDragPos(s);var u=i.dragOffset;if(n.onDrag&&u){var d=Object.assign({},t);d.lngLat=bw(s,u,r,o),n.onDrag(d)}}function moe(t,e){var r=e.props,n=e.callbacks,i=e.state,o=e.context;t.stopPropagation();var s=i.dragPos,u=i.dragOffset;if(i.setDragPos(null),i.setDragOffset(null),n.onDragEnd&&s&&u){var d=Object.assign({},t);d.lngLat=bw(s,u,r,o),n.onDragEnd(d)}}function _oe(t,e){var r=e.state;t.stopPropagation(),r.setDragPos(null),r.setDragOffset(null)}function yoe(t){var e=t.context.eventManager;if(!(!e||!t.state.dragPos)){var r={panmove:function(i){return goe(i,t)},panend:function(i){return moe(i,t)},pancancel:function(i){return _oe(i,t)}};return e.watch(r),function(){e.off(r)}}}function voe(t){var e=Et.useState(null),r=os(e,2),n=r[0],i=r[1],o=Et.useState(null),s=os(o,2),u=s[0],d=s[1],y=Uu(R3(R3({},t),{},{onDragStart:poe}));return y.callbacks=t,y.state.dragPos=n,y.state.setDragPos=i,y.state.dragOffset=u,y.state.setDragOffset=d,Et.useEffect(function(){return yoe(y)},[y.context.eventManager,!!n]),y}var F3=typeof window<"u"&&window.devicePixelRatio||1,rg=function(e){return Math.round(e*F3)/F3},D3=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return r;var i=n==="x"?e.offsetWidth:e.offsetHeight;return rg(r/100*i)/i*100};function O3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function boe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?O3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var xoe=Object.assign({},hoe,{className:ht.string,longitude:ht.number.isRequired,latitude:ht.number.isRequired,style:ht.object}),woe=Object.assign({},doe,{className:""});function Coe(t){var e=t.props,r=t.state,n=t.context,i=e.longitude,o=e.latitude,s=e.offsetLeft,u=e.offsetTop,d=r.dragPos,y=r.dragOffset;if(d&&y)return[d[0]+y[0],d[1]+y[1]];var x=n.viewport.project([i,o]),E=os(x,2),S=E[0],O=E[1];return S+=s,O+=u,[S,O]}function xw(t){var e=voe(t),r=e.state,n=e.containerRef,i=t.children,o=t.className,s=t.draggable,u=t.style,d=r.dragPos,y=Coe(e),x=os(y,2),E=x[0],S=x[1],O="translate(".concat(rg(E),"px, ").concat(rg(S),"px)"),k=s?d?"grabbing":"grab":"auto",U=Et.useMemo(function(){var G=boe({position:"absolute",left:0,top:0,transform:O,cursor:k},u);return Et.createElement("div",{className:"mapboxgl-marker ".concat(o),ref:e.containerRef,style:G},i)},[i,o]),J=n.current;return J&&(J.style.transform=O,J.style.cursor=k),U}xw.defaultProps=woe;xw.propTypes=xoe;Et.memo(xw);var ng={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},Toe=Object.keys(ng);function Eoe(t){var e=t.x,r=t.y,n=t.width,i=t.height,o=t.selfWidth,s=t.selfHeight,u=t.anchor,d=t.padding,y=d===void 0?0:d,x=ng[u],E=x.x,S=x.y,O=r-S*s,k=O+s,U=Math.max(0,y-O)+Math.max(0,k-i+y);if(U>0){var J=S,G=U;for(S=0;S<=1;S+=.5)O=r-S*s,k=O+s,U=Math.max(0,y-O)+Math.max(0,k-i+y),U<G&&(G=U,J=S);S=J}var H=.5;S===.5&&(E=Math.floor(E),H=1);var K=e-E*o,he=K+o,Y=Math.max(0,y-K)+Math.max(0,he-n+y);if(Y>0){var oe=E,Ee=Y;for(E=0;E<=1;E+=H)K=e-E*o,he=K+o,Y=Math.max(0,y-K)+Math.max(0,he-n+y),Y<Ee&&(Ee=Y,oe=E);E=oe}return Toe.find(function(ze){var de=ng[ze];return de.x===E&&de.y===S})||u}var Boe=Object.assign({},uc,{className:ht.string,longitude:ht.number.isRequired,latitude:ht.number.isRequired,altitude:ht.number,offsetLeft:ht.number,offsetTop:ht.number,tipSize:ht.number,closeButton:ht.bool,closeOnClick:ht.bool,anchor:ht.oneOf(Object.keys(ng)),dynamicPosition:ht.bool,sortByDepth:ht.bool,onClose:ht.func}),Soe=Object.assign({},ku,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function Ioe(t,e,r,n){var i=os(n,2),o=i[0],s=i[1],u=t.anchor,d=t.dynamicPosition,y=t.tipSize;return r&&d?Eoe({x:o,y:s,anchor:u,padding:y,width:e.width,height:e.height,selfWidth:r.clientWidth,selfHeight:r.clientHeight}):u}function Moe(t,e,r,n,i){var o=os(n,3),s=o[0],u=o[1],d=o[2],y=t.offsetLeft,x=t.offsetTop,E=t.sortByDepth,S=ng[i],O=s+y,k=u+x,U=D3(r,-S.x*100),J=D3(r,-S.y*100,"y"),G={position:"absolute",transform:`
      translate(`.concat(U,"%, ").concat(J,`%)
      translate(`).concat(rg(O),"px, ").concat(rg(k),`px)
    `),display:void 0,zIndex:void 0};return E&&(d>1||d<-1||s<0||s>e.width||u<0||u>e.height?G.display="none":G.zIndex=Math.floor((1-d)/2*1e5)),G}function ww(t){var e=Et.useRef(null),r=Uu(t),n=r.context,i=r.containerRef,o=Et.useState(!1),s=os(o,2),u=s[1];Et.useEffect(function(){u(!0)},[e.current]),Et.useEffect(function(){if(n.eventManager&&t.closeOnClick){var he=function(){return r.props.onClose()};return n.eventManager.on("anyclick",he),function(){n.eventManager.off("anyclick",he)}}},[n.eventManager,t.closeOnClick]);var d=n.viewport,y=t.className,x=t.longitude,E=t.latitude,S=t.altitude,O=t.tipSize,k=t.closeButton,U=t.children,J=d.project([x,E,S]),G=Ioe(t,d,e.current,J),H=Moe(t,d,i.current,J,G),K=Et.useCallback(function(he){r.props.onClose();var Y=r.context.eventManager;Y&&Y.once("click",function(oe){return oe.stopPropagation()},he.target)},[]);return Et.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(G," ").concat(y),style:H,ref:i},Et.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:O}}),Et.createElement("div",{key:"content",ref:e,className:"mapboxgl-popup-content"},k&&Et.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:K},""),U))}ww.propTypes=Boe;ww.defaultProps=Soe;Et.memo(ww);function L3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Poe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?L3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):L3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Roe=Object.assign({},uc,{toggleLabel:ht.string,className:ht.string,style:ht.object,compact:ht.bool,customAttribution:ht.oneOfType([ht.string,ht.arrayOf(ht.string)])}),Foe=Object.assign({},ku,{className:"",toggleLabel:"Toggle Attribution"});function Doe(t,e,r,n){var i=new Jc.AttributionControl(t);return i._map=e,i._container=r,i._innerContainer=n,i._updateAttributions(),i._updateEditLink(),e.on("styledata",i._updateData),e.on("sourcedata",i._updateData),i}function Ooe(t){t._map.off("styledata",t._updateData),t._map.off("sourcedata",t._updateData)}function Cw(t){var e=Uu(t),r=e.context,n=e.containerRef,i=Et.useRef(null),o=Et.useState(!1),s=os(o,2),u=s[0],d=s[1];Et.useEffect(function(){var S;return r.map&&(S=Doe({customAttribution:t.customAttribution},r.map,n.current,i.current)),function(){return S&&Ooe(S)}},[r.map]);var y=t.compact===void 0?r.viewport.width<=640:t.compact;Et.useEffect(function(){!y&&u&&d(!1)},[y]);var x=Et.useCallback(function(){return d(function(S){return!S})},[]),E=Et.useMemo(function(){return Poe({position:"absolute"},t.style)},[t.style]);return Et.createElement("div",{style:E,className:t.className},Et.createElement("div",{ref:n,"aria-pressed":u,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(y?"mapboxgl-compact":""," ").concat(u?"mapboxgl-compact-show":"")},Et.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:t.toggleLabel,onClick:x}),Et.createElement("div",{ref:i,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}Cw.propTypes=Roe;Cw.defaultProps=Foe;Et.memo(Cw);function N3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Loe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?N3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):N3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var Noe=Object.assign({},uc,{className:ht.string,style:ht.object,container:ht.object,label:ht.string}),koe=Object.assign({},ku,{className:"",container:null,label:"Toggle fullscreen"});function Tw(t){var e=Uu(t),r=e.context,n=e.containerRef,i=Et.useState(!1),o=os(i,2),s=o[0],u=o[1],d=Et.useState(!1),y=os(d,2),x=y[0],E=y[1],S=Et.useState(null),O=os(S,2),k=O[0],U=O[1];Et.useEffect(function(){var Y=new Jc.FullscreenControl;U(Y),E(Y._checkFullscreenSupport());var oe=function(){var ze=!Y._fullscreen;Y._fullscreen=ze,u(ze)};return Tl.addEventListener(Y._fullscreenchange,oe),function(){Tl.removeEventListener(Y._fullscreenchange,oe)}},[]);var J=function(){k&&(k._container=t.container||r.container,k._onClickFullscreen())},G=Et.useMemo(function(){return Loe({position:"absolute"},t.style)},[t.style]);if(!x)return null;var H=t.className,K=t.label,he=s?"shrink":"fullscreen";return Et.createElement("div",{style:G,className:H},Et.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Et.createElement("button",{key:he,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(he),type:"button",title:K,onClick:J},Et.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Tw.propTypes=Noe;Tw.defaultProps=koe;Et.memo(Tw);var fd;function Uoe(){return fd!==void 0?Promise.resolve(fd):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(t){return fd=t.state!=="denied",fd}):(fd=!!window.navigator.geolocation,Promise.resolve(fd))}function k3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function zoe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?k3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):k3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var U3=function(){},Goe=Object.assign({},uc,{className:ht.string,style:ht.object,label:ht.string,disabledLabel:ht.string,auto:ht.bool,positionOptions:ht.object,fitBoundsOptions:ht.object,trackUserLocation:ht.bool,showUserLocation:ht.bool,showAccuracyCircle:ht.bool,showUserHeading:ht.bool,onViewStateChange:ht.func,onViewportChange:ht.func,onGeolocate:ht.func}),Voe=Object.assign({},ku,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function Hoe(t){var e=new Jc.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=e.toBounds(r);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function joe(t,e,r){var n=new Jc.GeolocateControl(e);n._container=Tl.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=t.map,n._geolocateButton=r;var i=t.eventManager;return n.options.trackUserLocation&&i&&i.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",r.classList.add("mapboxgl-ctrl-geolocate-background"),r.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",e.onGeolocate),n}function $oe(t,e){var r=e.context,n=e.props,i=Hoe(t),o=r.viewport.fitBounds(i,n.fitBoundsOptions),s=o.longitude,u=o.latitude,d=o.zoom,y=Object.assign({},r.viewport,{longitude:s,latitude:u,zoom:d}),x=new tA(y),E=Object.assign({},x.getViewportProps(),Cl),S=n.onViewportChange||r.onViewportChange||U3,O=n.onViewStateChange||r.onViewStateChange||U3;O({viewState:E}),S(E)}function Ew(t){var e=Uu(t),r=e.context,n=e.containerRef,i=Et.useRef(null),o=Et.useState(null),s=os(o,2),u=s[0],d=s[1],y=Et.useState(!1),x=os(y,2),E=x[0],S=x[1];Et.useEffect(function(){var K;return r.map&&Uoe().then(function(he){S(he),i.current&&(K=joe(r,t,i.current),K._updateCamera=function(Y){return $oe(Y,e)},d(K))}),function(){K&&K._clearWatch()}},[r.map]);var O=Et.useCallback(function(){u&&(u.options=e.props,u.trigger())},[u]);Et.useEffect(function(){t.auto&&O()},[u,t.auto]),Et.useEffect(function(){u&&u._onZoom()},[r.viewport.zoom]);var k=t.className,U=t.label,J=t.disabledLabel,G=t.trackUserLocation,H=Et.useMemo(function(){return zoe({position:"absolute"},t.style)},[t.style]);return Et.createElement("div",{style:H,className:k},Et.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Et.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:i,disabled:!E,"aria-pressed":!G,type:"button",title:E?U:J,"aria-label":E?U:J,onClick:O},Et.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}Ew.propTypes=Goe;Ew.defaultProps=Voe;Et.memo(Ew);function Woe(t,e){for(var r=(t||"").split(".").map(Number),n=e.split(".").map(Number),i=0;i<3;i++){var o=r[i]||0,s=n[i]||0;if(o<s)return-1;if(o>s)return 1}return 0}function z3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Joe(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?z3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):z3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var G3=function(){},Xoe=Object.assign({},uc,{className:ht.string,style:ht.object,onViewStateChange:ht.func,onViewportChange:ht.func,showCompass:ht.bool,showZoom:ht.bool,zoomInLabel:ht.string,zoomOutLabel:ht.string,compassLabel:ht.string}),Koe=Object.assign({},ku,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),qoe=1,I2=2;function Yoe(t){return Woe(t,"1.6.0")>=0?I2:qoe}function cb(t,e,r){var n=t.viewport,i=new tA(Object.assign({},n,r)),o=Object.assign({},i.getViewportProps(),Cl),s=e.onViewportChange||t.onViewportChange||G3,u=e.onViewStateChange||t.onViewStateChange||G3;u({viewState:o}),s(o)}function lb(t,e,r,n){return Et.createElement("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:r},n||Et.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function Zoe(t){var e=Et.useMemo(function(){return t.map?Yoe(t.map.version):I2},[t.map]),r=t.viewport.bearing,n={transform:"rotate(".concat(-r,"deg)")};return e===I2?Et.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Et.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function Bw(t){var e=Uu(t),r=e.context,n=e.containerRef,i=function(){cb(r,t,{zoom:r.viewport.zoom+1})},o=function(){cb(r,t,{zoom:r.viewport.zoom-1})},s=function(){cb(r,t,{bearing:0,pitch:0})},u=t.className,d=t.showCompass,y=t.showZoom,x=t.zoomInLabel,E=t.zoomOutLabel,S=t.compassLabel,O=Et.useMemo(function(){return Joe({position:"absolute"},t.style)},[t.style]);return Et.createElement("div",{style:O,className:u},Et.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},y&&lb("zoom-in",x,i),y&&lb("zoom-out",E,o),d&&lb("compass",S,s,Zoe(r))))}Bw.propTypes=Xoe;Bw.defaultProps=Koe;const Qoe=Et.memo(Bw);function V3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function eae(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?V3(Object(r),!0).forEach(function(n){vr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):V3(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var tae=Object.assign({},uc,{className:ht.string,style:ht.object,maxWidth:ht.number,unit:ht.oneOf(["imperial","metric","nautical"])}),rae=Object.assign({},ku,{className:"",maxWidth:100,unit:"metric"});function Sw(t){var e=Uu(t),r=e.context,n=e.containerRef,i=Et.useState(null),o=os(i,2),s=o[0],u=o[1];Et.useEffect(function(){if(r.map){var y=new Jc.ScaleControl;y._map=r.map,y._container=n.current,u(y)}},[r.map]),s&&(s.options=t,s._onMove&&s._onMove());var d=Et.useMemo(function(){return eae({position:"absolute"},t.style)},[t.style]);return Et.createElement("div",{style:d,className:t.className},Et.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}Sw.propTypes=tae;Sw.defaultProps=rae;Et.memo(Sw);Object.assign({},uc,{redraw:ht.func.isRequired});Object.assign({},uc,{redraw:ht.func.isRequired,style:ht.object});Object.assign({},uc,{redraw:ht.func.isRequired,style:ht.object});Jc&&Jc.setRTLTextPlugin;const nae=()=>Cf(uU,{}),H3=aD("div",{target:"ei0oomx0"})(({height:t})=>({position:"relative",height:t,width:"100%"})),iae=aD("div",{target:"ei0oomx1"})(({theme:t})=>({position:"absolute",right:"2.625rem",top:t.spacing.md,zIndex:t.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:t.colors.bgColor},"button:not(:disabled)":{background:t.colors.bgColor,width:t.iconSizes.twoXL,height:t.iconSizes.twoXL,"& + button":{borderTopColor:t.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:t.iconSizes.twoXL,"&:hover":{backgroundColor:t.colors.darkenedBgMix25}},"& span":{filter:cD(t)?"":"invert(100%)"}}})),sae=({container:t,element:e,heightFallback:r="auto",isFullScreen:n,shouldUseContainerWidth:i,widthFallback:o="auto"})=>{const s=Et.useMemo(()=>i||n?"100%":e.width||t.width||o,[t.width,e.width,n,i,o]),u=Et.useMemo(()=>n&&t.height?t.height:e.height||t.height||r,[n,e.height,t.height,r]);return{width:s,height:u}},j3=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,oae={name:"arc",vs:j3,fs:j3,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},aae=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cae=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,l_=[0,0,0,255],lae={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:l_},getTargetColor:{type:"accessor",value:l_},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class yg extends ps{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:aae,fs:cae,modules:[Ts,na,oae]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:l_},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:l_},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:r,widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,wrapLongitude:u,numSegments:d}=this.props,y={numSegments:d,widthUnits:mo[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o,greatCircle:s,useShortestPath:u},x=this.state.model;x.shaderInputs.setProps({arc:y}),x.setVertexCount(d*2),x.draw(this.context.renderPass)}_getModel(){return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}yg.layerName="ArcLayer";yg.defaultProps=lae;const uae=new Uint32Array([0,2,1,0,3,2]),fae=new Float32Array([0,1,0,0,1,0,1,1]);function hae(t,e){if(!e)return dae(t);const r=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),n=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),i=Math.ceil(r/e)+1,o=Math.ceil(n/e)+1,s=(i-1)*(o-1)*6,u=new Uint32Array(s),d=new Float32Array(i*o*2),y=new Float64Array(i*o*3);let x=0,E=0;for(let S=0;S<i;S++){const O=S/(i-1);for(let k=0;k<o;k++){const U=k/(o-1),J=Aae(t,O,U);y[x*3+0]=J[0],y[x*3+1]=J[1],y[x*3+2]=J[2]||0,d[x*2+0]=O,d[x*2+1]=1-U,S>0&&k>0&&(u[E++]=x-o,u[E++]=x-o-1,u[E++]=x-1,u[E++]=x-o,u[E++]=x-1,u[E++]=x),x++}}return{vertexCount:s,positions:y,indices:u,texCoords:d}}function dae(t){const e=new Float64Array(12);for(let r=0;r<t.length;r++)e[r*3+0]=t[r][0],e[r*3+1]=t[r][1],e[r*3+2]=t[r][2]||0;return{vertexCount:6,positions:e,indices:uae,texCoords:fae}}function Aae(t,e,r){return sc(sc(t[0],t[1],r),sc(t[3],t[2],r),e)}const $3=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,pae={name:"bitmap",vs:$3,fs:$3,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},gae=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,mae=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,_ae=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${mae}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,yae={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Xr.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class Y_ extends ps{getShaders(){return super.getShaders({vs:gae,fs:_ae,modules:[Ts,na,pae]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const r=!0;e.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:e,oldProps:r,changeFlags:n}){const i=this.getAttributeManager();if(n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll()),e.bounds!==r.bounds){const o=this.state.mesh,s=this._createMesh();this.state.model.setVertexCount(s.vertexCount);for(const u in s)o&&o[u]!==s[u]&&i.invalidate(u);this.setState({mesh:s,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:r}=this.props,n=e.info;if(!n.color||!r)return n.bitmap=null,n;const{width:i,height:o}=r;n.index=0;const s=vae(n.color);return n.bitmap={size:{width:i,height:o},uv:s,pixel:[Math.floor(s[0]*i),Math.floor(s[1]*o)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let r=e;return W3(e)&&(r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),hae(r,this.context.viewport.resolution)}_getModel(){return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{shaderModuleProps:r}=e,{model:n,coordinateConversion:i,bounds:o,disablePicking:s}=this.state,{image:u,desaturate:d,transparentColor:y,tintColor:x}=this.props;if(!(r.picking.isActive&&s)&&u&&n){const E={bitmapTexture:u,bounds:o,coordinateConversion:i,desaturate:d,tintColor:x.slice(0,3).map(S=>S/255),transparentColor:y.map(S=>S/255)};n.shaderInputs.setProps({bitmap:E}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:r,DEFAULT:n}=Xr;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:o}=this.props;if(!W3(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const s=this.context.viewport.resolution?e:r;if(i=i===e?e:r,i===e&&s===r)return{coordinateConversion:-1,bounds:o};if(i===r&&s===e){const u=Rl([o[0],o[1]]),d=Rl([o[2],o[3]]);return{coordinateConversion:1,bounds:[u[0],u[1],d[0],d[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}Y_.layerName="BitmapLayer";Y_.defaultProps=yae;function vae(t){const[e,r,n]=t,i=(n&240)/256,o=(n&15)/16;return[(e+o)/256,(r+i)/256]}function W3(t){return Number.isFinite(t[0])}const J3=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,bae={name:"icon",vs:J3,fs:J3,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},xae=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,wae=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cae=1024,Tae=4,X3=()=>{},K3={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Eae={x:0,y:0,width:0,height:0};function Bae(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Sae(t,e,r,n){const i=Math.min(r/e.width,n/e.height),o=Math.floor(e.width*i),s=Math.floor(e.height*i);return i===1?{image:e,width:o,height:s}:(t.canvas.height=s,t.canvas.width=o,t.clearRect(0,0,o,s),t.drawImage(e,0,0,e.width,e.height,0,0,o,s),{image:t.canvas,width:o,height:s})}function ig(t){return t&&(t.id||t.url)}function Iae(t,e,r,n){const{width:i,height:o,device:s}=t,u=s.createTexture({format:"rgba8unorm",width:e,height:r,sampler:n,mipmaps:!0}),d=s.createCommandEncoder();return d.copyTextureToTexture({sourceTexture:t,destinationTexture:u,width:i,height:o}),d.finish(),t.destroy(),u}function q3(t,e,r){for(let n=0;n<e.length;n++){const{icon:i,xOffset:o}=e[n],s=ig(i);t[s]={...i,x:o,y:r}}}function Mae({icons:t,buffer:e,mapping:r={},xOffset:n=0,yOffset:i=0,rowHeight:o=0,canvasWidth:s}){let u=[];for(let d=0;d<t.length;d++){const y=t[d],x=ig(y);if(!r[x]){const{height:E,width:S}=y;n+S+e>s&&(q3(r,u,i),n=0,i=o+i+e,o=0,u=[]),u.push({icon:y,xOffset:n}),n=n+S+e,o=Math.max(o,E)}}return u.length>0&&q3(r,u,i),{mapping:r,rowHeight:o,xOffset:n,yOffset:i,canvasWidth:s,canvasHeight:Bae(o+i+e)}}function Pae(t,e,r){if(!t||!e)return null;r=r||{};const n={},{iterable:i,objectInfo:o}=qc(t);for(const s of i){o.index++;const u=e(s,o),d=ig(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");!n[d]&&(!r[d]||u.url!==r[d].url)&&(n[d]={...u,source:s,sourceIndex:o.index})}return n}class Rae{constructor(e,{onUpdate:r=X3,onError:n=X3}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Tae,this._canvasWidth=Cae,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const r=this._autoPacking?ig(e):e;return this._mapping[r]||Eae}setProps({loadOptions:e,autoPacking:r,iconAtlas:n,iconMapping:i,textureParameters:o}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),i&&(this._mapping=i),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(Pae(e,r,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:o,yOffset:s,rowHeight:u,canvasHeight:d}=Mae({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=u,this._mapping=i,this._xOffset=o,this._yOffset=s,this._canvasHeight=d,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||K3,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Iae(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||K3)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const r=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,CA(n.url,this._loadOptions).then(i=>{const o=ig(n),s=this._mapping[o],{x:u,y:d,width:y,height:x}=s,{image:E,width:S,height:O}=Sae(r,i,y,x);this._texture?.copyExternalImage({image:E,x:u+(y-S)/2,y:d+(x-O)/2,width:S,height:O}),s.width=S,s.height=O,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const f6=[0,0,0,255],Fae={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:f6},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class TA extends ps{getShaders(){return super.getShaders({vs:xae,fs:wae,modules:[Ts,na,bae]})}initializeState(){this.state={iconManager:new Rae(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:f6},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:u,data:d,getIcon:y,textureParameters:x}=r,{iconManager:E}=this.state;if(typeof s=="string")return;const S=s||this.internalState.isAsyncPropLoading("iconAtlas");E.setProps({loadOptions:r.loadOptions,autoPacking:!S,iconAtlas:s,iconMapping:S?u:null,textureParameters:x}),S?n.iconMapping!==r.iconMapping&&o.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&E.packIcons(d,y),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:r,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:o,billboard:s,alphaCutoff:u}=this.props,{iconManager:d}=this.state,y=d.getTexture();if(y){const x=this.state.model,E={iconsTexture:y,iconsTextureDim:[y.width,y.height],sizeUnits:mo[o],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:i,billboard:s,alphaCutoff:u};x.shaderInputs.setProps({icon:E}),x.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const r=this.getCurrentLayer()?.props.onIconError;r?r(e):Wr.error(e.error.message)()}getInstanceOffset(e){const{width:r,height:n,anchorX:i=r/2,anchorY:o=n/2}=this.state.iconManager.getIconMapping(e);return[r/2-i,n/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:r,y:n,width:i,height:o}=this.state.iconManager.getIconMapping(e);return[r,n,i,o]}}TA.defaultProps=Fae;TA.layerName="IconLayer";const Dae=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,Y3=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Oae={name:"line",source:Dae,vs:Y3,fs:Y3,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Lae=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Nae=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kae=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Uae=[0,0,0,255],zae={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Uae},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Z_ extends ps{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Nae,fs:kae,source:Lae,modules:[Ts,na,Oae]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:r,widthScale:n,widthMinPixels:i,widthMaxPixels:o,wrapLongitude:s}=this.props,u=this.state.model,d={widthUnits:mo[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o,useShortestPath:s?1:0};u.shaderInputs.setProps({line:d}),u.draw(this.context.renderPass),s&&(u.shaderInputs.setProps({line:{...d,useShortestPath:-1}}),u.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Z_.layerName="LineLayer";Z_.defaultProps=zae;const Z3=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,Gae={name:"pointCloud",vs:Z3,fs:Z3,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},Vae=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Hae=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,h6=[0,0,0,255],d6=[0,0,1],jae={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:d6},getColor:{type:"accessor",value:h6},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function $ae(t){const{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){const{size:n,value:i}=r.COLOR_0;r.instanceColors={size:n,type:"unorm8",value:i}}}class vg extends ps{getShaders(){return super.getShaders({vs:Vae,fs:Hae,modules:[Ts,D_,na,Gae]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:d6},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:h6}})}updateState(e){const{changeFlags:r,props:n}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&$ae(n.data)}draw({uniforms:e}){const{pointSize:r,sizeUnits:n}=this.props,i=this.state.model,o={sizeUnits:mo[n],radiusPixels:r};i.shaderInputs.setProps({pointCloud:o}),i.draw(this.context.renderPass)}_getModel(){const e=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}vg.layerName="PointCloudLayer";vg.defaultProps=jae;const Q3=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Wae={name:"scatterplot",vs:Q3,fs:Q3,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Jae=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Xae=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Kae=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,eM=[0,0,0,255],qae={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:eM},getLineColor:{type:"accessor",value:eM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class bg extends ps{getShaders(){return super.getShaders({vs:Jae,fs:Xae,source:Kae,modules:[Ts,na,Wae]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:s,filled:u,billboard:d,antialiasing:y,lineWidthUnits:x,lineWidthScale:E,lineWidthMinPixels:S,lineWidthMaxPixels:O}=this.props,k={stroked:s,filled:u,billboard:d,antialiasing:y,radiusUnits:mo[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:mo[x],lineWidthScale:E,lineWidthMinPixels:S,lineWidthMaxPixels:O},U=this.state.model;U.shaderInputs.setProps({scatterplot:k}),U.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}bg.defaultProps=qae;bg.layerName="ScatterplotLayer";const Iw={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Mw(t,e,r={}){return Yae(t,r)!==e?(Qae(t,r),!0):!1}function Yae(t,e={}){return Math.sign(Zae(t,e))}const tM={x:0,y:1,z:2};function Zae(t,e={}){const{start:r=0,end:n=t.length,plane:i="xy"}=e,o=e.size||2;let s=0;const u=tM[i[0]],d=tM[i[1]];for(let y=r,x=n-o;y<n;y+=o)s+=(t[y+u]-t[x+u])*(t[y+d]+t[x+d]),x=y;return s/2}function Qae(t,e){const{start:r=0,end:n=t.length,size:i=2}=e,o=(n-r)/i,s=Math.floor(o/2);for(let u=0;u<s;++u){const d=r+u*i,y=r+(o-1-u)*i;for(let x=0;x<i;++x){const E=t[d+x];t[d+x]=t[y+x],t[y+x]=E}}}function nc(t,e){const r=e.length,n=t.length;if(n>0){let i=!0;for(let o=0;o<r;o++)if(t[n-r+o]!==e[o]){i=!1;break}if(i)return!1}for(let i=0;i<r;i++)t[n+i]=e[i];return!0}function M2(t,e){const r=e.length;for(let n=0;n<r;n++)t[n]=e[n]}function sg(t,e,r,n,i=[]){const o=n+e*r;for(let s=0;s<r;s++)i[s]=t[o+s];return i}function P2(t,e,r,n,i=[]){let o,s;if(r&8)o=(n[3]-t[1])/(e[1]-t[1]),s=3;else if(r&4)o=(n[1]-t[1])/(e[1]-t[1]),s=1;else if(r&2)o=(n[2]-t[0])/(e[0]-t[0]),s=2;else if(r&1)o=(n[0]-t[0])/(e[0]-t[0]),s=0;else return null;for(let u=0;u<t.length;u++)i[u]=(s&1)===u?n[s]:o*(e[u]-t[u])+t[u];return i}function bm(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function A6(t,e){const{size:r=2,broken:n=!1,gridResolution:i=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:u=t.length}=e||{},d=(u-s)/r;let y=[];const x=[y],E=sg(t,0,r,s);let S,O;const k=g6(E,i,o,[]),U=[];nc(y,E);for(let J=1;J<d;J++){for(S=sg(t,J,r,s,S),O=bm(S,k);O;){P2(E,S,O,k,U);const G=bm(U,k);G&&(P2(E,U,G,k,U),O=G),nc(y,U),M2(E,U),tce(k,i,O),n&&y.length>r&&(y=[],x.push(y),nc(y,E)),O=bm(S,k)}nc(y,S),M2(E,S)}return n?x:x[0]}const rM=0,ece=1;function p6(t,e=null,r){if(!t.length)return[];const{size:n=2,gridResolution:i=10,gridOffset:o=[0,0],edgeTypes:s=!1}=r||{},u=[],d=[{pos:t,types:s?new Array(t.length/n).fill(ece):null,holes:e||[]}],y=[[],[]];let x=[];for(;d.length;){const{pos:E,types:S,holes:O}=d.shift();rce(E,n,O[0]||E.length,y),x=g6(y[0],i,o,x);const k=bm(y[1],x);if(k){let U=nM(E,S,n,0,O[0]||E.length,x,k);const J={pos:U[0].pos,types:U[0].types,holes:[]},G={pos:U[1].pos,types:U[1].types,holes:[]};d.push(J,G);for(let H=0;H<O.length;H++)U=nM(E,S,n,O[H],O[H+1]||E.length,x,k),U[0]&&(J.holes.push(J.pos.length),J.pos=O0(J.pos,U[0].pos),s&&(J.types=O0(J.types,U[0].types))),U[1]&&(G.holes.push(G.pos.length),G.pos=O0(G.pos,U[1].pos),s&&(G.types=O0(G.types,U[1].types)))}else{const U={positions:E};s&&(U.edgeTypes=S),O.length&&(U.holeIndices=O),u.push(U)}}return u}function nM(t,e,r,n,i,o,s){const u=(i-n)/r,d=[],y=[],x=[],E=[],S=[];let O,k,U;const J=sg(t,u-1,r,n);let G=Math.sign(s&8?J[1]-o[3]:J[0]-o[2]),H=e&&e[u-1],K=0,he=0;for(let Y=0;Y<u;Y++)O=sg(t,Y,r,n,O),k=Math.sign(s&8?O[1]-o[3]:O[0]-o[2]),U=e&&e[n/r+Y],k&&G&&G!==k&&(P2(J,O,s,o,S),nc(d,S)&&x.push(H),nc(y,S)&&E.push(H)),k<=0?(nc(d,O)&&x.push(U),K-=k):x.length&&(x[x.length-1]=rM),k>=0?(nc(y,O)&&E.push(U),he+=k):E.length&&(E[E.length-1]=rM),M2(J,O),G=k,H=U;return[K?{pos:d,types:e&&x}:null,he?{pos:y,types:e&&E}:null]}function g6(t,e,r,n){const i=Math.floor((t[0]-r[0])/e)*e+r[0],o=Math.floor((t[1]-r[1])/e)*e+r[1];return n[0]=i,n[1]=o,n[2]=i+e,n[3]=o+e,n}function tce(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function rce(t,e,r,n){let i=1/0,o=-1/0,s=1/0,u=-1/0;for(let d=0;d<r;d+=e){const y=t[d],x=t[d+1];i=y<i?y:i,o=y>o?y:o,s=x<s?x:s,u=x>u?x:u}return n[0][0]=i,n[0][1]=s,n[1][0]=o,n[1][1]=u,n}function O0(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}const nce=85.051129;function ice(t,e){const{size:r=2,startIndex:n=0,endIndex:i=t.length,normalize:o=!0}=e||{},s=t.slice(n,i);m6(s,r,0,i-n);const u=A6(s,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const d of u)_6(d,r);return u}function sce(t,e=null,r){const{size:n=2,normalize:i=!0,edgeTypes:o=!1}=r||{};e=e||[];const s=[],u=[];let d=0,y=0;for(let E=0;E<=e.length;E++){const S=e[E]||t.length,O=y,k=oce(t,n,d,S);for(let U=k;U<S;U++)s[y++]=t[U];for(let U=d;U<k;U++)s[y++]=t[U];m6(s,n,O,y),ace(s,n,O,y,r?.maxLatitude),d=S,u[E]=y}u.pop();const x=p6(s,u,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(i)for(const E of x)_6(E.positions,n);return x}function oce(t,e,r,n){let i=-1,o=-1;for(let s=r+1;s<n;s+=e){const u=Math.abs(t[s]);u>i&&(i=u,o=s-1)}return o}function ace(t,e,r,n,i=nce){const o=t[r],s=t[n-e];if(Math.abs(o-s)>180){const u=sg(t,0,e,r);u[0]+=Math.round((s-o)/360)*360,nc(t,u),u[1]=Math.sign(u[1])*i,nc(t,u),u[0]=o,nc(t,u)}}function m6(t,e,r,n){let i=t[0],o;for(let s=r;s<n;s+=e){o=t[s];const u=o-i;(u>180||u<-180)&&(o-=Math.round(u/360)*360),t[s]=i=o}}function _6(t,e){let r;const n=t.length/e;for(let o=0;o<n&&(r=t[o*e],(r+180)%360===0);o++);const i=-Math.round(r/360)*360;if(i!==0)for(let o=0;o<n;o++)t[o*e]+=i}class cce extends zs{constructor(e){const{indices:r,attributes:n}=lce(e);super({...e,indices:r,attributes:n})}}function lce(t){const{radius:e,height:r=1,nradial:n=10}=t;let{vertices:i}=t;i&&(Wr.assert(i.length>=n),i=i.flatMap(O=>[O[0],O[1]]),Mw(i,Iw.COUNTER_CLOCKWISE));const o=r>0,s=n+1,u=o?s*3+1:n,d=Math.PI*2/n,y=new Uint16Array(o?n*3*2:0),x=new Float32Array(u*3),E=new Float32Array(u*3);let S=0;if(o){for(let O=0;O<s;O++){const k=O*d,U=O%n,J=Math.sin(k),G=Math.cos(k);for(let H=0;H<2;H++)x[S+0]=i?i[U*2]:G*e,x[S+1]=i?i[U*2+1]:J*e,x[S+2]=(1/2-H)*r,E[S+0]=i?i[U*2]:G,E[S+1]=i?i[U*2+1]:J,S+=3}x[S+0]=x[S-3],x[S+1]=x[S-2],x[S+2]=x[S-1],S+=3}for(let O=o?0:1;O<s;O++){const k=Math.floor(O/2)*Math.sign(.5-O%2),U=k*d,J=(k+n)%n,G=Math.sin(U),H=Math.cos(U);x[S+0]=i?i[J*2]:H*e,x[S+1]=i?i[J*2+1]:G*e,x[S+2]=r/2,E[S+2]=1,S+=3}if(o){let O=0;for(let k=0;k<n;k++)y[O++]=k*2+0,y[O++]=k*2+2,y[O++]=k*2+0,y[O++]=k*2+1,y[O++]=k*2+1,y[O++]=k*2+3}return{indices:y,attributes:{POSITION:{size:3,value:x},NORMAL:{size:3,value:E}}}}const iM=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,uce={name:"column",vs:iM,fs:iM,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},fce=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hce=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,u_=[0,0,0,255],dce={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:u_},getLineColor:{type:"accessor",value:u_},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Yc extends ps{getShaders(){const e={},{flatShading:r}=this.props;return r&&(e.FLAT_SHADING=1),super.getShaders({vs:fce,fs:hce,defines:e,modules:[Ts,r?Ux:D_,na,uce]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:u_},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:u_},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,o=i.extensionsChanged||r.flatShading!==n.flatShading;o&&(this.state.models?.forEach(u=>u.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const s=this.getNumInstances();this.state.fillModel.setInstanceCount(s),this.state.wireframeModel.setInstanceCount(s),(o||r.diskResolution!==n.diskResolution||r.vertices!==n.vertices||(r.extruded||r.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(r)}getGeometry(e,r,n){const i=new cce({radius:1,height:n?2:0,vertices:r,nradial:e});let o=0;if(r)for(let s=0;s<e;s++){const u=r[s],d=Math.sqrt(u[0]*u[0]+u[1]*u[1]);o+=d/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),i}_getModels(){const e=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),n=new Ei(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),i=new Ei(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:n,wireframeModel:i,models:[i,n]}}_updateGeometry({diskResolution:e,vertices:r,extruded:n,stroked:i}){const o=this.getGeometry(e,r,n||i);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});const s=this.state.fillModel,u=this.state.wireframeModel;s.setGeometry(o),s.setTopology("triangle-strip"),s.setIndexBuffer(null),u.setGeometry(o),u.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:r,lineWidthScale:n,lineWidthMinPixels:i,lineWidthMaxPixels:o,radiusUnits:s,elevationScale:u,extruded:d,filled:y,stroked:x,wireframe:E,offset:S,coverage:O,radius:k,angle:U}=this.props,J=this.state.fillModel,G=this.state.wireframeModel,{fillVertexCount:H,edgeDistance:K}=this.state,he={radius:k,angle:U/180*Math.PI,offset:S,extruded:d,stroked:x,coverage:O,elevationScale:u,edgeDistance:K,radiusUnits:mo[s],widthUnits:mo[r],widthScale:n,widthMinPixels:i,widthMaxPixels:o};d&&E&&(G.shaderInputs.setProps({column:{...he,isStroke:!0}}),G.draw(this.context.renderPass)),y&&(J.setVertexCount(H),J.shaderInputs.setProps({column:{...he,isStroke:!1}}),J.draw(this.context.renderPass)),!d&&x&&(J.setVertexCount(H*2/3),J.shaderInputs.setProps({column:{...he,isStroke:!0}}),J.draw(this.context.renderPass))}}Yc.layerName="ColumnLayer";Yc.defaultProps=dce;const Ace={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let Pw=class extends Yc{_updateGeometry(){const e=new oL;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:r,extruded:n,offset:i,coverage:o,cellSize:s,angle:u,radiusUnits:d}=this.props,y=this.state.fillModel,x={radius:s/2,radiusUnits:mo[d],angle:u,offset:i,extruded:n,stroked:!1,coverage:o,elevationScale:r,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};y.shaderInputs.setProps({column:x}),y.draw(this.context.renderPass)}};Pw.layerName="GridCellLayer";Pw.defaultProps=Ace;function pce(t,e,r,n){let i;if(Array.isArray(t[0])){const o=t.length*e;i=new Array(o);for(let s=0;s<t.length;s++)for(let u=0;u<e;u++)i[s*e+u]=t[s][u]||0}else i=t;return r?A6(i,{size:e,gridResolution:r}):n?ice(i,{size:e}):i}const gce=1,mce=2,ub=4;class _ce extends VL{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?pce(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(sM(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}const r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&sM(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){const n=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:s}=r;n.fill(0,o,o+s),i?(n[o]=ub,n[o+s-2]=ub):(n[o]+=gce,n[o+s-2]+=mce),n[o+s-1]=ub}_updatePositions(e,r){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:o}=r,s=new Array(3);for(let u=i,d=0;d<o;u++,d++)this.getPointOnPath(e,d,s),n[u*3]=s[0],n[u*3+1]=s[1],n[u*3+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,n=[]){const{positionSize:i}=this;r*i>=e.length&&(r+=1-e.length/i);const o=r*i;return n[0]=e[o],n[1]=e[o+1],n[2]=i===3&&e[o+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:r}=this,n=e.length-r;return e[0]===e[n]&&e[1]===e[n+1]&&(r===2||e[2]===e[n+2])}}function sM(t){return Array.isArray(t[0])}const oM=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,yce={name:"path",vs:oM,fs:oM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},vce=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bce=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,y6=[0,0,0,255],xce={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:y6},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},fb={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class zu extends ps{getShaders(){return super.getShaders({vs:vce,fs:bce,modules:[Ts,na,yce]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:fb,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:fb,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:fb,defaultValue:y6},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:i,target:o})=>this.encodePickingColor(n&&n.__source?n.__source.index:i,o)}}),this.setState({pathTesselator:new _ce({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:r,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:s}=this.state,u=r.data.attributes||{};s.updateGeometry({data:r.data,geometryBuffer:u.getPath,buffers:u,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(o=>o.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:r,capRounded:n,billboard:i,miterLimit:o,widthUnits:s,widthScale:u,widthMinPixels:d,widthMaxPixels:y}=this.props,x=this.state.model,E={jointType:Number(r),capType:Number(n),billboard:i,widthUnits:mo[s],widthScale:u,miterLimit:o,widthMinPixels:d,widthMaxPixels:y};x.shaderInputs.setProps({path:E}),x.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){const{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}}zu.defaultProps=xce;zu.layerName="PathLayer";var L0={exports:{}},aM;function wce(){if(aM)return L0.exports;aM=1,L0.exports=t,L0.exports.default=t;function t(me,Le,Ue){Ue=Ue||2;var Ye=Le&&Le.length,et=Ye?Le[0]*Ue:me.length,tt=e(me,0,et,Ue,!0),ct=[];if(!tt||tt.next===tt.prev)return ct;var mt,Tt,nt,lr,qt,$t,Ot;if(Ye&&(tt=d(me,Le,tt,Ue)),me.length>80*Ue){mt=nt=me[0],Tt=lr=me[1];for(var fr=Ue;fr<et;fr+=Ue)qt=me[fr],$t=me[fr+1],qt<mt&&(mt=qt),$t<Tt&&(Tt=$t),qt>nt&&(nt=qt),$t>lr&&(lr=$t);Ot=Math.max(nt-mt,lr-Tt),Ot=Ot!==0?32767/Ot:0}return n(tt,ct,Ue,mt,Tt,Ot,0),ct}function e(me,Le,Ue,Ye,et){var tt,ct;if(et===Qe(me,Le,Ue,Ye)>0)for(tt=Le;tt<Ue;tt+=Ye)ct=$(tt,me[tt],me[tt+1],ct);else for(tt=Ue-Ye;tt>=Le;tt-=Ye)ct=$(tt,me[tt],me[tt+1],ct);return ct&&he(ct,ct.next)&&(re(ct),ct=ct.next),ct}function r(me,Le){if(!me)return me;Le||(Le=me);var Ue=me,Ye;do if(Ye=!1,!Ue.steiner&&(he(Ue,Ue.next)||K(Ue.prev,Ue,Ue.next)===0)){if(re(Ue),Ue=Le=Ue.prev,Ue===Ue.next)break;Ye=!0}else Ue=Ue.next;while(Ye||Ue!==Le);return Le}function n(me,Le,Ue,Ye,et,tt,ct){if(me){!ct&&tt&&O(me,Ye,et,tt);for(var mt=me,Tt,nt;me.prev!==me.next;){if(Tt=me.prev,nt=me.next,tt?o(me,Ye,et,tt):i(me)){Le.push(Tt.i/Ue|0),Le.push(me.i/Ue|0),Le.push(nt.i/Ue|0),re(me),me=nt.next,mt=nt.next;continue}if(me=nt,me===mt){ct?ct===1?(me=s(r(me),Le,Ue),n(me,Le,Ue,Ye,et,tt,2)):ct===2&&u(me,Le,Ue,Ye,et,tt):n(r(me),Le,Ue,Ye,et,tt,1);break}}}}function i(me){var Le=me.prev,Ue=me,Ye=me.next;if(K(Le,Ue,Ye)>=0)return!1;for(var et=Le.x,tt=Ue.x,ct=Ye.x,mt=Le.y,Tt=Ue.y,nt=Ye.y,lr=et<tt?et<ct?et:ct:tt<ct?tt:ct,qt=mt<Tt?mt<nt?mt:nt:Tt<nt?Tt:nt,$t=et>tt?et>ct?et:ct:tt>ct?tt:ct,Ot=mt>Tt?mt>nt?mt:nt:Tt>nt?Tt:nt,fr=Ye.next;fr!==Le;){if(fr.x>=lr&&fr.x<=$t&&fr.y>=qt&&fr.y<=Ot&&G(et,mt,tt,Tt,ct,nt,fr.x,fr.y)&&K(fr.prev,fr,fr.next)>=0)return!1;fr=fr.next}return!0}function o(me,Le,Ue,Ye){var et=me.prev,tt=me,ct=me.next;if(K(et,tt,ct)>=0)return!1;for(var mt=et.x,Tt=tt.x,nt=ct.x,lr=et.y,qt=tt.y,$t=ct.y,Ot=mt<Tt?mt<nt?mt:nt:Tt<nt?Tt:nt,fr=lr<qt?lr<$t?lr:$t:qt<$t?qt:$t,rn=mt>Tt?mt>nt?mt:nt:Tt>nt?Tt:nt,Er=lr>qt?lr>$t?lr:$t:qt>$t?qt:$t,mr=U(Ot,fr,Le,Ue,Ye),Ln=U(rn,Er,Le,Ue,Ye),dr=me.prevZ,Ar=me.nextZ;dr&&dr.z>=mr&&Ar&&Ar.z<=Ln;){if(dr.x>=Ot&&dr.x<=rn&&dr.y>=fr&&dr.y<=Er&&dr!==et&&dr!==ct&&G(mt,lr,Tt,qt,nt,$t,dr.x,dr.y)&&K(dr.prev,dr,dr.next)>=0||(dr=dr.prevZ,Ar.x>=Ot&&Ar.x<=rn&&Ar.y>=fr&&Ar.y<=Er&&Ar!==et&&Ar!==ct&&G(mt,lr,Tt,qt,nt,$t,Ar.x,Ar.y)&&K(Ar.prev,Ar,Ar.next)>=0))return!1;Ar=Ar.nextZ}for(;dr&&dr.z>=mr;){if(dr.x>=Ot&&dr.x<=rn&&dr.y>=fr&&dr.y<=Er&&dr!==et&&dr!==ct&&G(mt,lr,Tt,qt,nt,$t,dr.x,dr.y)&&K(dr.prev,dr,dr.next)>=0)return!1;dr=dr.prevZ}for(;Ar&&Ar.z<=Ln;){if(Ar.x>=Ot&&Ar.x<=rn&&Ar.y>=fr&&Ar.y<=Er&&Ar!==et&&Ar!==ct&&G(mt,lr,Tt,qt,nt,$t,Ar.x,Ar.y)&&K(Ar.prev,Ar,Ar.next)>=0)return!1;Ar=Ar.nextZ}return!0}function s(me,Le,Ue){var Ye=me;do{var et=Ye.prev,tt=Ye.next.next;!he(et,tt)&&Y(et,Ye,Ye.next,tt)&&de(et,tt)&&de(tt,et)&&(Le.push(et.i/Ue|0),Le.push(Ye.i/Ue|0),Le.push(tt.i/Ue|0),re(Ye),re(Ye.next),Ye=me=tt),Ye=Ye.next}while(Ye!==me);return r(Ye)}function u(me,Le,Ue,Ye,et,tt){var ct=me;do{for(var mt=ct.next.next;mt!==ct.prev;){if(ct.i!==mt.i&&H(ct,mt)){var Tt=Ae(ct,mt);ct=r(ct,ct.next),Tt=r(Tt,Tt.next),n(ct,Le,Ue,Ye,et,tt,0),n(Tt,Le,Ue,Ye,et,tt,0);return}mt=mt.next}ct=ct.next}while(ct!==me)}function d(me,Le,Ue,Ye){var et=[],tt,ct,mt,Tt,nt;for(tt=0,ct=Le.length;tt<ct;tt++)mt=Le[tt]*Ye,Tt=tt<ct-1?Le[tt+1]*Ye:me.length,nt=e(me,mt,Tt,Ye,!1),nt===nt.next&&(nt.steiner=!0),et.push(J(nt));for(et.sort(y),tt=0;tt<et.length;tt++)Ue=x(et[tt],Ue);return Ue}function y(me,Le){return me.x-Le.x}function x(me,Le){var Ue=E(me,Le);if(!Ue)return Le;var Ye=Ae(Ue,me);return r(Ye,Ye.next),r(Ue,Ue.next)}function E(me,Le){var Ue=Le,Ye=me.x,et=me.y,tt=-1/0,ct;do{if(et<=Ue.y&&et>=Ue.next.y&&Ue.next.y!==Ue.y){var mt=Ue.x+(et-Ue.y)*(Ue.next.x-Ue.x)/(Ue.next.y-Ue.y);if(mt<=Ye&&mt>tt&&(tt=mt,ct=Ue.x<Ue.next.x?Ue:Ue.next,mt===Ye))return ct}Ue=Ue.next}while(Ue!==Le);if(!ct)return null;var Tt=ct,nt=ct.x,lr=ct.y,qt=1/0,$t;Ue=ct;do Ye>=Ue.x&&Ue.x>=nt&&Ye!==Ue.x&&G(et<lr?Ye:tt,et,nt,lr,et<lr?tt:Ye,et,Ue.x,Ue.y)&&($t=Math.abs(et-Ue.y)/(Ye-Ue.x),de(Ue,me)&&($t<qt||$t===qt&&(Ue.x>ct.x||Ue.x===ct.x&&S(ct,Ue)))&&(ct=Ue,qt=$t)),Ue=Ue.next;while(Ue!==Tt);return ct}function S(me,Le){return K(me.prev,me,Le.prev)<0&&K(Le.next,me,me.next)<0}function O(me,Le,Ue,Ye){var et=me;do et.z===0&&(et.z=U(et.x,et.y,Le,Ue,Ye)),et.prevZ=et.prev,et.nextZ=et.next,et=et.next;while(et!==me);et.prevZ.nextZ=null,et.prevZ=null,k(et)}function k(me){var Le,Ue,Ye,et,tt,ct,mt,Tt,nt=1;do{for(Ue=me,me=null,tt=null,ct=0;Ue;){for(ct++,Ye=Ue,mt=0,Le=0;Le<nt&&(mt++,Ye=Ye.nextZ,!!Ye);Le++);for(Tt=nt;mt>0||Tt>0&&Ye;)mt!==0&&(Tt===0||!Ye||Ue.z<=Ye.z)?(et=Ue,Ue=Ue.nextZ,mt--):(et=Ye,Ye=Ye.nextZ,Tt--),tt?tt.nextZ=et:me=et,et.prevZ=tt,tt=et;Ue=Ye}tt.nextZ=null,nt*=2}while(ct>1);return me}function U(me,Le,Ue,Ye,et){return me=(me-Ue)*et|0,Le=(Le-Ye)*et|0,me=(me|me<<8)&16711935,me=(me|me<<4)&252645135,me=(me|me<<2)&858993459,me=(me|me<<1)&1431655765,Le=(Le|Le<<8)&16711935,Le=(Le|Le<<4)&252645135,Le=(Le|Le<<2)&858993459,Le=(Le|Le<<1)&1431655765,me|Le<<1}function J(me){var Le=me,Ue=me;do(Le.x<Ue.x||Le.x===Ue.x&&Le.y<Ue.y)&&(Ue=Le),Le=Le.next;while(Le!==me);return Ue}function G(me,Le,Ue,Ye,et,tt,ct,mt){return(et-ct)*(Le-mt)>=(me-ct)*(tt-mt)&&(me-ct)*(Ye-mt)>=(Ue-ct)*(Le-mt)&&(Ue-ct)*(tt-mt)>=(et-ct)*(Ye-mt)}function H(me,Le){return me.next.i!==Le.i&&me.prev.i!==Le.i&&!ze(me,Le)&&(de(me,Le)&&de(Le,me)&&ve(me,Le)&&(K(me.prev,me,Le.prev)||K(me,Le.prev,Le))||he(me,Le)&&K(me.prev,me,me.next)>0&&K(Le.prev,Le,Le.next)>0)}function K(me,Le,Ue){return(Le.y-me.y)*(Ue.x-Le.x)-(Le.x-me.x)*(Ue.y-Le.y)}function he(me,Le){return me.x===Le.x&&me.y===Le.y}function Y(me,Le,Ue,Ye){var et=Ee(K(me,Le,Ue)),tt=Ee(K(me,Le,Ye)),ct=Ee(K(Ue,Ye,me)),mt=Ee(K(Ue,Ye,Le));return!!(et!==tt&&ct!==mt||et===0&&oe(me,Ue,Le)||tt===0&&oe(me,Ye,Le)||ct===0&&oe(Ue,me,Ye)||mt===0&&oe(Ue,Le,Ye))}function oe(me,Le,Ue){return Le.x<=Math.max(me.x,Ue.x)&&Le.x>=Math.min(me.x,Ue.x)&&Le.y<=Math.max(me.y,Ue.y)&&Le.y>=Math.min(me.y,Ue.y)}function Ee(me){return me>0?1:me<0?-1:0}function ze(me,Le){var Ue=me;do{if(Ue.i!==me.i&&Ue.next.i!==me.i&&Ue.i!==Le.i&&Ue.next.i!==Le.i&&Y(Ue,Ue.next,me,Le))return!0;Ue=Ue.next}while(Ue!==me);return!1}function de(me,Le){return K(me.prev,me,me.next)<0?K(me,Le,me.next)>=0&&K(me,me.prev,Le)>=0:K(me,Le,me.prev)<0||K(me,me.next,Le)<0}function ve(me,Le){var Ue=me,Ye=!1,et=(me.x+Le.x)/2,tt=(me.y+Le.y)/2;do Ue.y>tt!=Ue.next.y>tt&&Ue.next.y!==Ue.y&&et<(Ue.next.x-Ue.x)*(tt-Ue.y)/(Ue.next.y-Ue.y)+Ue.x&&(Ye=!Ye),Ue=Ue.next;while(Ue!==me);return Ye}function Ae(me,Le){var Ue=new Te(me.i,me.x,me.y),Ye=new Te(Le.i,Le.x,Le.y),et=me.next,tt=Le.prev;return me.next=Le,Le.prev=me,Ue.next=et,et.prev=Ue,Ye.next=Ue,Ue.prev=Ye,tt.next=Ye,Ye.prev=tt,Ye}function $(me,Le,Ue,Ye){var et=new Te(me,Le,Ue);return Ye?(et.next=Ye.next,et.prev=Ye,Ye.next.prev=et,Ye.next=et):(et.prev=et,et.next=et),et}function re(me){me.next.prev=me.prev,me.prev.next=me.next,me.prevZ&&(me.prevZ.nextZ=me.nextZ),me.nextZ&&(me.nextZ.prevZ=me.prevZ)}function Te(me,Le,Ue){this.i=me,this.x=Le,this.y=Ue,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.deviation=function(me,Le,Ue,Ye){var et=Le&&Le.length,tt=et?Le[0]*Ue:me.length,ct=Math.abs(Qe(me,0,tt,Ue));if(et)for(var mt=0,Tt=Le.length;mt<Tt;mt++){var nt=Le[mt]*Ue,lr=mt<Tt-1?Le[mt+1]*Ue:me.length;ct-=Math.abs(Qe(me,nt,lr,Ue))}var qt=0;for(mt=0;mt<Ye.length;mt+=3){var $t=Ye[mt]*Ue,Ot=Ye[mt+1]*Ue,fr=Ye[mt+2]*Ue;qt+=Math.abs((me[$t]-me[fr])*(me[Ot+1]-me[$t+1])-(me[$t]-me[Ot])*(me[fr+1]-me[$t+1]))}return ct===0&&qt===0?0:Math.abs((qt-ct)/ct)};function Qe(me,Le,Ue,Ye){for(var et=0,tt=Le,ct=Ue-Ye;tt<Ue;tt+=Ye)et+=(me[ct]-me[tt])*(me[tt+1]+me[ct+1]),ct=tt;return et}return t.flatten=function(me){for(var Le=me[0][0].length,Ue={vertices:[],holes:[],dimensions:Le},Ye=0,et=0;et<me.length;et++){for(var tt=0;tt<me[et].length;tt++)for(var ct=0;ct<Le;ct++)Ue.vertices.push(me[et][tt][ct]);et>0&&(Ye+=me[et-1].length,Ue.holes.push(Ye))}return Ue},L0.exports}var Cce=wce();const v6=Kf(Cce),N0=Iw.CLOCKWISE,cM=Iw.COUNTER_CLOCKWISE,Cu={};function Tce(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Ep(t){return"positions"in t?t.positions:t}function xm(t){return"holeIndices"in t?t.holeIndices:null}function Ece(t){return Array.isArray(t[0])}function Bce(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Sce(t){const e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Ice(t,e,r,n){for(let i=0;i<e;i++)if(t[r+i]!==t[n-e+i])return!1;return!0}function lM(t,e,r,n,i){let o=e;const s=r.length;for(let u=0;u<s;u++)for(let d=0;d<n;d++)t[o++]=r[u][d]||0;if(!Sce(r))for(let u=0;u<n;u++)t[o++]=r[0][u]||0;return Cu.start=e,Cu.end=o,Cu.size=n,Mw(t,i,Cu),o}function uM(t,e,r,n,i=0,o,s){o=o||r.length;const u=o-i;if(u<=0)return e;let d=e;for(let y=0;y<u;y++)t[d++]=r[i+y];if(!Ice(r,n,i,o))for(let y=0;y<n;y++)t[d++]=r[i+y];return Cu.start=e,Cu.end=d,Cu.size=n,Mw(t,s,Cu),d}function b6(t,e){Tce(t);const r=[],n=[];if("positions"in t){const{positions:i,holeIndices:o}=t;if(o){let s=0;for(let u=0;u<=o.length;u++)s=uM(r,s,i,e,o[u-1],o[u],u===0?N0:cM),n.push(s);return n.pop(),{positions:r,holeIndices:n}}t=i}if(!Ece(t))return uM(r,0,t,e,0,r.length,N0),r;if(!Bce(t)){let i=0;for(const[o,s]of t.entries())i=lM(r,i,s,e,o===0?N0:cM),n.push(i);return n.pop(),{positions:r,holeIndices:n}}return lM(r,0,t,e,N0),r}function hb(t,e,r){const n=t.length/3;let i=0;for(let o=0;o<n;o++){const s=(o+1)%n;i+=t[o*3+e]*t[s*3+r],i-=t[s*3+e]*t[o*3+r]}return Math.abs(i/2)}function fM(t,e,r,n){const i=t.length/3;for(let o=0;o<i;o++){const s=o*3,u=t[s+0],d=t[s+1],y=t[s+2];t[s+e]=u,t[s+r]=d,t[s+n]=y}}function Mce(t,e,r,n){let i=xm(t);i&&(i=i.map(u=>u/e));let o=Ep(t);const s=n&&e===3;if(r){const u=o.length;o=o.slice();const d=[];for(let y=0;y<u;y+=e){d[0]=o[y],d[1]=o[y+1],s&&(d[2]=o[y+2]);const x=r(d);o[y]=x[0],o[y+1]=x[1],s&&(o[y+2]=x[2])}}if(s){const u=hb(o,0,1),d=hb(o,0,2),y=hb(o,1,2);if(!u&&!d&&!y)return[];u>d&&u>y||(d>y?(r||(o=o.slice()),fM(o,0,2,1)):(r||(o=o.slice()),fM(o,2,0,1)))}return v6(o,i,e)}class Pce extends VL{constructor(e){const{fp64:r,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);const r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const r=b6(e,this.positionSize);return this.opts.resolution?p6(Ep(r),xm(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?sce(Ep(r),xm(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(hM(e)){let r=0;for(const n of e)r+=this.getGeometrySize(n);return r}return Ep(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&hM(e))for(const n of e){const i=this.getGeometrySize(n);r.geometrySize=i,this.updateGeometryAttributes(n,r),r.vertexStart+=i,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{const n=e;this._updateIndices(n,r),this._updatePositions(n,r),this._updateVertexValid(n,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:n,indexStart:i}){const{attributes:o,indexStarts:s,typedArrayManager:u}=this;let d=o.indices;if(!d||!e)return;let y=i;const x=Mce(e,this.positionSize,this.opts.preproject,this.opts.full3d);d=u.allocate(d,i+x.length,{copy:!0});for(let E=0;E<x.length;E++)d[y++]=x[E]+n;s[r+1]=i+x.length,o.indices=d}_updatePositions(e,{vertexStart:r,geometrySize:n}){const{attributes:{positions:i},positionSize:o}=this;if(!i||!e)return;const s=Ep(e);for(let u=r,d=0;d<n;u++,d++){const y=s[d*o],x=s[d*o+1],E=o>2?s[d*o+2]:0;i[u*3]=y,i[u*3+1]=x,i[u*3+2]=E}}_updateVertexValid(e,{vertexStart:r,geometrySize:n}){const{positionSize:i}=this,o=this.attributes.vertexValid,s=e&&xm(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,r):o.fill(1,r,r+n),s)for(let u=0;u<s.length;u++)o[r+s[u]/i-1]=0;o[r+n-1]=0}}function hM(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const dM=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Rce={name:"solidPolygon",vs:dM,fs:dM,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},x6=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Fce=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${x6}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Dce=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${x6}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Oce=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,f_=[0,0,0,255],Lce={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:f_},getLineColor:{type:"accessor",value:f_},material:!0},k0={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Gu extends ps{getShaders(e){return super.getShaders({vs:e==="top"?Fce:Dce,fs:Oce,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ts,D_,na,Rce]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:n}=this.props;e.isGeospatial&&r===Xr.DEFAULT&&(r=Xr.LNGLAT);let i;r===Xr.LNGLAT&&(n?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Pce({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:k0,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:k0,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:k0,accessor:"getFillColor",defaultValue:f_},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:k0,accessor:"getLineColor",defaultValue:f_},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(u,{index:d,target:y})=>this.encodePickingColor(u&&u.__source?u.__source.index:d,y)}})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n}=r,i=this.props.data;return i[0]&&i[0].__source&&(r.object=i.find(o=>o.__source.index===n)),r}disablePickingIndex(e){const r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:r,filled:n,wireframe:i,elevationScale:o}=this.props,{topModel:s,sideModel:u,wireframeModel:d,polygonTesselator:y}=this.state,x={extruded:!!r,elevationScale:o,isWireframe:!1};d&&i&&(d.setInstanceCount(y.instanceCount-1),d.shaderInputs.setProps({solidPolygon:{...x,isWireframe:!0}}),d.draw(this.context.renderPass)),u&&n&&(u.setInstanceCount(y.instanceCount-1),u.shaderInputs.setProps({solidPolygon:x}),u.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(y.vertexCount),s.shaderInputs.setProps({solidPolygon:x}),s.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:r,oldProps:n,changeFlags:i}=e,o=this.getAttributeManager();(i.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(this.state.models?.forEach(u=>u.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,s=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:r,extruded:n}=this.props;let i,o,s;if(r){const u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1;const d=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Ei(this.context.device,{...u,id:`${e}-top`,topology:"triangle-list",bufferLayout:d,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const u=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new Ei(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:u,geometry:new zs({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new Ei(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:u,geometry:new zs({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,i].filter(Boolean),topModel:i,sideModel:o,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){const{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}Gu.defaultProps=Lce;Gu.layerName="SolidPolygonLayer";function w6({data:t,getIndex:e,dataRange:r,replace:n}){const{startRow:i=0,endRow:o=1/0}=r,s=t.length;let u=s,d=s;for(let S=0;S<s;S++){const O=e(t[S]);if(u>S&&O>=i&&(u=S),O>=o){d=S;break}}let y=u;const E=d-u!==n.length?t.slice(d):void 0;for(let S=0;S<n.length;S++)t[y++]=n[S];if(E){for(let S=0;S<E.length;S++)t[y++]=E[S];t.length=y}return{startRow:u,endRow:u+n.length}}const C6=[0,0,0,255],Nce=[0,0,0,255],kce={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:Nce},getLineColor:{type:"accessor",value:C6},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Vu extends gs{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&Wr.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(r&&Array.isArray(e.dataChanged)){const n=this.state.paths.slice(),i=e.dataChanged.map(o=>w6({data:n,getIndex:s=>s.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:n,pathsDiff:i})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:r,getPolygon:n,positionFormat:i,_normalize:o}=this.props,s=[],u=i==="XY"?2:3,{startRow:d,endRow:y}=e,{iterable:x,objectInfo:E}=qc(r,d,y);for(const S of x){E.index++;let O=n(S,E);o&&(O=b6(O,u));const{holeIndices:k}=O,U=O.positions||O;if(k)for(let J=0;J<=k.length;J++){const G=U.slice(k[J-1]||0,k[J]||U.length);s.push(this.getSubLayerRow({path:G},S,E.index))}else s.push(this.getSubLayerRow({path:U},S,E.index))}return s}renderLayers(){const{data:e,_dataDiff:r,stroked:n,filled:i,extruded:o,wireframe:s,_normalize:u,_windingOrder:d,elevationScale:y,transitions:x,positionFormat:E}=this.props,{lineWidthUnits:S,lineWidthScale:O,lineWidthMinPixels:k,lineWidthMaxPixels:U,lineJointRounded:J,lineMiterLimit:G,lineDashJustified:H}=this.props,{getFillColor:K,getLineColor:he,getLineWidth:Y,getLineDashArray:oe,getElevation:Ee,getPolygon:ze,updateTriggers:de,material:ve}=this.props,{paths:Ae,pathsDiff:$}=this.state,re=this.getSubLayerClass("fill",Gu),Te=this.getSubLayerClass("stroke",zu),Qe=this.shouldRenderSubLayer("fill",Ae)&&new re({_dataDiff:r,extruded:o,elevationScale:y,filled:i,wireframe:s,_normalize:u,_windingOrder:d,getElevation:Ee,getFillColor:K,getLineColor:o&&s?he:C6,material:ve,transitions:x},this.getSubLayerProps({id:"fill",updateTriggers:de&&{getPolygon:de.getPolygon,getElevation:de.getElevation,getFillColor:de.getFillColor,lineColors:o&&s,getLineColor:de.getLineColor}}),{data:e,positionFormat:E,getPolygon:ze}),me=!o&&n&&this.shouldRenderSubLayer("stroke",Ae)&&new Te({_dataDiff:$&&(()=>$),widthUnits:S,widthScale:O,widthMinPixels:k,widthMaxPixels:U,jointRounded:J,miterLimit:G,dashJustified:H,_pathType:"loop",transitions:x&&{getWidth:x.getLineWidth,getColor:x.getLineColor,getPath:x.getPolygon},getColor:this.getSubLayerAccessor(he),getWidth:this.getSubLayerAccessor(Y),getDashArray:this.getSubLayerAccessor(oe)},this.getSubLayerProps({id:"stroke",updateTriggers:de&&{getWidth:de.getLineWidth,getColor:de.getLineColor,getDashArray:de.getLineDashArray}}),{data:Ae,positionFormat:E,getPath:Le=>Le.path});return[!o&&Qe,me,o&&Qe]}}Vu.layerName="PolygonLayer";Vu.defaultProps=kce;function Uce(t,e){if(!t)return null;const r="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[r];return r!==-1?zce(t,n,r):null}function zce(t,e,r){const n={properties:{...t.properties[e]}};for(const i in t.numericProps)n.properties[i]=t.numericProps[i].value[r];return n}function Gce(t,e){const r={points:null,lines:null,polygons:null};for(const n in r){const i=t[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(i.length*4);const o=[];for(let s=0;s<i.length;s++)e(i[s],o),r[n][s*4+0]=o[0],r[n][s*4+1]=o[1],r[n][s*4+2]=o[2],r[n][s*4+3]=255}return r}const AM=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Vce={name:"sdf",vs:AM,fs:AM,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Hce=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,db=192/256,pM=[],jce={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Q_ extends TA{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,Vce],fs:Hce}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:n,target:i})=>this.encodePickingColor(n,i)}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;let{outlineColor:i}=r;i!==n.outlineColor&&(i=i.map(o=>o/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!r.sdf&&r.outlineWidth&&Wr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:r,smoothing:n,outlineWidth:i}=this.props,{outlineColor:o}=this.state,s=i?Math.max(n,db*(1-i)):-1,u=this.state.model,d={buffer:db,outlineBuffer:s,gamma:n,enabled:!!r,outlineColor:o};if(u.shaderInputs.setProps({sdf:d}),super.draw(e),r&&i){const{iconManager:y}=this.state;y.getTexture()&&(u.shaderInputs.setProps({sdf:{...d,outlineBuffer:db}}),u.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):pM}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):pM}}Q_.defaultProps=jce;Q_.layerName="MultiIconLayer";const Vp=1e20;class $ce{constructor({fontSize:e=24,buffer:r=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:s="normal",fontStyle:u="normal"}={}){this.buffer=r,this.cutoff=i,this.radius=n;const d=this.size=e+r*4,y=this._createCanvas(d),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${u} ${s} ${e}px ${o}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){const r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){const{width:r,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:s}=this.ctx.measureText(e),u=Math.ceil(n),d=0,y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-o))),x=Math.min(this.size-this.buffer,u+Math.ceil(i)),E=y+2*this.buffer,S=x+2*this.buffer,O=Math.max(E*S,0),k=new Uint8ClampedArray(O),U={data:k,width:E,height:S,glyphWidth:y,glyphHeight:x,glyphTop:u,glyphLeft:d,glyphAdvance:r};if(y===0||x===0)return U;const{ctx:J,buffer:G,gridInner:H,gridOuter:K}=this;J.clearRect(G,G,y,x),J.fillText(e,G,G+u);const he=J.getImageData(G,G,y,x);K.fill(Vp,0,O),H.fill(0,0,O);for(let Y=0;Y<x;Y++)for(let oe=0;oe<y;oe++){const Ee=he.data[4*(Y*y+oe)+3]/255;if(Ee===0)continue;const ze=(Y+G)*E+oe+G;if(Ee===1)K[ze]=0,H[ze]=Vp;else{const de=.5-Ee;K[ze]=de>0?de*de:0,H[ze]=de<0?de*de:0}}gM(K,0,0,E,S,E,this.f,this.v,this.z),gM(H,G,G,y,x,E,this.f,this.v,this.z);for(let Y=0;Y<O;Y++){const oe=Math.sqrt(K[Y])-Math.sqrt(H[Y]);k[Y]=Math.round(255-255*(oe/this.radius+this.cutoff))}return U}}function gM(t,e,r,n,i,o,s,u,d){for(let y=e;y<e+n;y++)mM(t,r*o+y,o,i,s,u,d);for(let y=r;y<r+i;y++)mM(t,y*o+e,1,n,s,u,d)}function mM(t,e,r,n,i,o,s){o[0]=0,s[0]=-Vp,s[1]=Vp,i[0]=t[e];for(let u=1,d=0,y=0;u<n;u++){i[u]=t[e+u*r];const x=u*u;do{const E=o[d];y=(i[u]-i[E]+x-E*E)/(u-E)/2}while(y<=s[d]&&--d>-1);d++,o[d]=u,s[d]=y,s[d+1]=Vp}for(let u=0,d=0;u<n;u++){for(;s[d+1]<u;)d++;const y=o[d],x=u-y;t[e+u*r]=i[y]+x*x}}const Wce=32,Jce=[];function Xce(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Kce({characterSet:t,getFontWidth:e,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:o={},xOffset:s=0,yOffset:u=0}){let d=0,y=s;const x=r+n*2;for(const E of t)if(!o[E]){const S=e(E);y+S+n*2>i&&(y=0,d++),o[E]={x:y+n,y:u+d*x+n,width:S,height:x,layoutWidth:S,layoutHeight:r},y+=S+n*2}return{mapping:o,xOffset:y,yOffset:u+d*x,canvasHeight:Xce(u+(d+1)*x)}}function T6(t,e,r,n){let i=0;for(let o=e;o<r;o++){const s=t[o];i+=n[s]?.layoutWidth||0}return i}function E6(t,e,r,n,i,o){let s=e,u=0;for(let d=e;d<r;d++){const y=T6(t,d,d+1,i);u+y>n&&(s<d&&o.push(d),s=d,u=0),u+=y}return u}function qce(t,e,r,n,i,o){let s=e,u=e,d=e,y=0;for(let x=e;x<r;x++)if((t[x]===" "||t[x+1]===" "||x+1===r)&&(d=x+1),d>u){let E=T6(t,u,d,i);y+E>n&&(s<u&&(o.push(u),s=u,y=0),E>n&&(E=E6(t,u,d,n,i,o),s=o[o.length-1])),u=d,y+=E}return y}function Yce(t,e,r,n,i=0,o){o===void 0&&(o=t.length);const s=[];return e==="break-all"?E6(t,i,o,r,n,s):qce(t,i,o,r,n,s),s}function Zce(t,e,r,n,i,o){let s=0,u=0;for(let d=e;d<r;d++){const y=t[d],x=n[y];x?(u||(u=x.layoutHeight),i[d]=s+x.layoutWidth/2,s+=x.layoutWidth):(Wr.warn(`Missing character: ${y} (${y.codePointAt(0)})`)(),i[d]=s,s+=Wce)}o[0]=s,o[1]=u}function Qce(t,e,r,n,i){const o=Array.from(t),s=o.length,u=new Array(s),d=new Array(s),y=new Array(s),x=(r==="break-word"||r==="break-all")&&isFinite(n)&&n>0,E=[0,0],S=[0,0];let O=0,k=0,U=0;for(let J=0;J<=s;J++){const G=o[J];if((G===`
`||J===s)&&(U=J),U>k){const H=x?Yce(o,r,n,i,k,U):Jce;for(let K=0;K<=H.length;K++){const he=K===0?k:H[K-1],Y=K<H.length?H[K]:U;Zce(o,he,Y,i,u,S);for(let oe=he;oe<Y;oe++){u[oe]-S[0]/2;const Ee=o[oe],ze=i[Ee]?.layoutOffsetY||0;d[oe]=O+S[1]/2+ze,y[oe]=S[0]}O=O+S[1]*e,E[0]=Math.max(E[0],S[0])}k=U}G===`
`&&(u[k]=0,d[k]=0,y[k]=0,k++)}return E[1]=O,{x:u,y:d,rowWidth:y,size:E}}function ele({value:t,length:e,stride:r,offset:n,startIndices:i,characterSet:o}){const s=t.BYTES_PER_ELEMENT,u=r?r/s:1,d=n?n/s:0,y=i[e]||Math.ceil((t.length-d)/u),x=o&&new Set,E=new Array(e);let S=t;if(u>1||d>0){const O=t.constructor;S=new O(y);for(let k=0;k<y;k++)S[k]=t[k*u+d]}for(let O=0;O<e;O++){const k=i[O],U=i[O+1]||y,J=S.subarray(k,U);E[O]=String.fromCodePoint.apply(null,J),x&&J.forEach(x.add,x)}if(x)for(const O of x)o.add(String.fromCodePoint(O));return{texts:E,characterCount:y}}class B6{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}}function tle(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const rA={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:tle(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},_M=1024,yM=.9,vM=1.2,S6=3;let h_=new B6(S6);function rle(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);const n=h_.get(t);if(!n)return r;for(const i in n.mapping)r.has(i)&&r.delete(i);return r}function nle(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function bM(t,e,r,n){t.font=`${n} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function ile(t){Wr.assert(Number.isFinite(t)&&t>=S6,"Invalid cache limit"),h_=new B6(t)}class sle{constructor(){this.props={...rA}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:r}=this.props;return(e*vM+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const r=rle(this._key,this.props.characterSet),n=h_.get(this._key);if(n&&r.size===0){this._atlas!==n&&(this._atlas=n);return}const i=this._generateFontAtlas(r,n);this._atlas=i,h_.set(this._key,i)}_generateFontAtlas(e,r){const{fontFamily:n,fontWeight:i,fontSize:o,buffer:s,sdf:u,radius:d,cutoff:y}=this.props;let x=r&&r.data;x||(x=document.createElement("canvas"),x.width=_M);const E=x.getContext("2d",{willReadFrequently:!0});bM(E,n,o,i);const{mapping:S,canvasHeight:O,xOffset:k,yOffset:U}=Kce({getFontWidth:J=>E.measureText(J).width,fontHeight:o*vM,buffer:s,characterSet:e,maxCanvasWidth:_M,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(x.height!==O){const J=E.getImageData(0,0,x.width,x.height);x.height=O,E.putImageData(J,0,0)}if(bM(E,n,o,i),u){const J=new $ce({fontSize:o,buffer:s,radius:d,cutoff:y,fontFamily:n,fontWeight:`${i}`});for(const G of e){const{data:H,width:K,height:he,glyphTop:Y}=J.draw(G);S[G].width=K,S[G].layoutOffsetY=o*yM-Y;const oe=E.createImageData(K,he);nle(H,oe),E.putImageData(oe,S[G].x,S[G].y)}}else for(const J of e)E.fillText(J,S[J].x,S[J].y+s+o*yM);return{xOffset:k,yOffset:U,mapping:S,data:x,width:x.width,height:x.height}}_getKey(){const{fontFamily:e,fontWeight:r,fontSize:n,buffer:i,sdf:o,radius:s,cutoff:u}=this.props;return o?`${e} ${r} ${n} ${i} ${s} ${u}`:`${e} ${r} ${n} ${i}`}}const xM=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,ole={name:"textBackground",vs:xM,fs:xM,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},ale=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,cle=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,lle={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class xg extends ps{getShaders(){return super.getShaders({vs:ale,fs:cle,modules:[Ts,na,ole]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:r,sizeScale:n,sizeUnits:i,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:u}=this.props;let{padding:d,borderRadius:y}=this.props;d.length<4&&(d=[d[0],d[1],d[0],d[1]]),Array.isArray(y)||(y=[y,y,y,y]);const x=this.state.model,E={billboard:r,stroked:!!u,borderRadius:y,padding:d,sizeUnits:mo[i],sizeScale:n,sizeMinPixels:o,sizeMaxPixels:s};x.shaderInputs.setProps({textBackground:E}),x.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}xg.defaultProps=lle;xg.layerName="TextBackgroundLayer";const wM={start:1,middle:0,end:-1},CM={top:1,center:0,bottom:-1},Ab=[0,0,0,255],ule=1,fle={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ab},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:rA.characterSet},fontFamily:rA.fontFamily,fontWeight:rA.fontWeight,lineHeight:ule,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ab},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Ab},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class ih extends gs{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[n,i]}=this.transformParagraph(e,r);const{fontSize:o}=this.state.fontAtlasManager.props;n/=o,i/=o;const{getTextAnchor:s,getAlignmentBaseline:u}=this.props,d=wM[typeof s=="function"?s(e,r):s],y=CM[typeof u=="function"?u(e,r):u];return[(d-1)*n/2,(y-1)*i/2,n,i]},this.getIconOffsets=(e,r)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:o,y:s,rowWidth:u,size:[d,y]}=this.transformParagraph(e,r),x=wM[typeof n=="function"?n(e,r):n],E=CM[typeof i=="function"?i(e,r):i],S=o.length,O=new Array(S*2);let k=0;for(let U=0;U<S;U++){const J=(1-x)*(d-u[U])/2;O[k++]=(x-1)*d/2+J+o[U],O[k++]=(E-1)*y/2+s[U]}return O}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new sle},this.props.maxWidth>0&&Wr.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:r,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==n.lineHeight||r.wordBreak!==n.wordBreak||r.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:r,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:o}=this.state,s={...e,characterSet:o,fontFamily:r,fontWeight:n};if(!i.mapping)return i.setProps(s),!0;for(const u in s)if(s[u]!==i.props[u])return i.setProps(s),!0;return!1}_updateText(){const{data:e,characterSet:r}=this.props,n=e.attributes?.getText;let{getText:i}=this.props,o=e.startIndices,s;const u=r==="auto"&&new Set;if(n&&o){const{texts:d,characterCount:y}=ele({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:u});s=y,i=(x,{index:E})=>d[E]}else{const{iterable:d,objectInfo:y}=qc(e);o=[0],s=0;for(const x of d){y.index++;const E=Array.from(i(x,y)||"");u&&E.forEach(u.add,u),s+=E.length,o.push(s)}}this.setState({getText:i,startIndices:o,numInstances:s,characterSet:u||r})}transformParagraph(e,r){const{fontAtlasManager:n}=this.state,i=n.mapping,o=this.state.getText,{wordBreak:s,lineHeight:u,maxWidth:d}=this.props,y=o(e,r)||"";return Qce(y,u,s,d*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:r,getText:n,fontAtlasManager:{scale:i,atlas:o,mapping:s},styleVersion:u}=this.state,{data:d,_dataDiff:y,getPosition:x,getColor:E,getSize:S,getAngle:O,getPixelOffset:k,getBackgroundColor:U,getBorderColor:J,getBorderWidth:G,backgroundBorderRadius:H,backgroundPadding:K,background:he,billboard:Y,fontSettings:oe,outlineWidth:Ee,outlineColor:ze,sizeScale:de,sizeUnits:ve,sizeMinPixels:Ae,sizeMaxPixels:$,transitions:re,updateTriggers:Te}=this.props,Qe=this.getSubLayerClass("characters",Q_),me=this.getSubLayerClass("background",xg);return[he&&new me({getFillColor:U,getLineColor:J,getLineWidth:G,borderRadius:H,padding:K,getPosition:x,getSize:S,getAngle:O,getPixelOffset:k,billboard:Y,sizeScale:de,sizeUnits:ve,sizeMinPixels:Ae,sizeMaxPixels:$,transitions:re&&{getPosition:re.getPosition,getAngle:re.getAngle,getSize:re.getSize,getFillColor:re.getBackgroundColor,getLineColor:re.getBorderColor,getLineWidth:re.getBorderWidth,getPixelOffset:re.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Te.getPosition,getAngle:Te.getAngle,getSize:Te.getSize,getFillColor:Te.getBackgroundColor,getLineColor:Te.getBorderColor,getLineWidth:Te.getBorderWidth,getPixelOffset:Te.getPixelOffset,getBoundingRect:{getText:Te.getText,getTextAnchor:Te.getTextAnchor,getAlignmentBaseline:Te.getAlignmentBaseline,styleVersion:u}}}),{data:d.attributes&&d.attributes.background?{length:d.length,attributes:d.attributes.background}:d,_dataDiff:y,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Qe({sdf:oe.sdf,smoothing:Number.isFinite(oe.smoothing)?oe.smoothing:rA.smoothing,outlineWidth:Ee/(oe.radius||rA.radius),outlineColor:ze,iconAtlas:o,iconMapping:s,getPosition:x,getColor:E,getSize:S,getAngle:O,getPixelOffset:k,billboard:Y,sizeScale:de*i,sizeUnits:ve,sizeMinPixels:Ae*i,sizeMaxPixels:$*i,transitions:re&&{getPosition:re.getPosition,getAngle:re.getAngle,getColor:re.getColor,getSize:re.getSize,getPixelOffset:re.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Te.getText,getPosition:Te.getPosition,getAngle:Te.getAngle,getColor:Te.getColor,getSize:Te.getSize,getPixelOffset:Te.getPixelOffset,getIconOffsets:{getTextAnchor:Te.getTextAnchor,getAlignmentBaseline:Te.getAlignmentBaseline,styleVersion:u}}}),{data:d,_dataDiff:y,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){ile(e)}}ih.defaultProps=fle;ih.layerName="TextLayer";const wm={circle:{type:bg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:TA,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:ih,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Cm={type:zu,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},R2={type:Gu,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function dp({type:t,props:e}){const r={};for(const n in e)r[n]=t.defaultProps[e[n]];return r}function pb(t,e){const{transitions:r,updateTriggers:n}=t.props,i={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(const o in e){const s=e[o];let u=t.props[o];o.startsWith("get")&&(u=t.getSubLayerAccessor(u),i.updateTriggers[s]=n[o],r&&(i.transitions[s]=r[o])),i[s]=u}return i}function hle(t){if(Array.isArray(t))return t;switch(Wr.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Wr.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function TM(t,e,r={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:o=t.length}=r;for(let s=i;s<o;s++){const u=t[s],{geometry:d}=u;if(d)if(d.type==="GeometryCollection"){Wr.assert(Array.isArray(d.geometries),"GeoJSON does not have geometries array");const{geometries:y}=d;for(let x=0;x<y.length;x++){const E=y[x];EM(E,n,e,u,s)}}else EM(d,n,e,u,s)}return n}function EM(t,e,r,n,i){const{type:o,coordinates:s}=t,{pointFeatures:u,lineFeatures:d,polygonFeatures:y,polygonOutlineFeatures:x}=e;if(!Ale(o,s)){Wr.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":u.push(r({geometry:t},n,i));break;case"MultiPoint":s.forEach(E=>{u.push(r({geometry:{type:"Point",coordinates:E}},n,i))});break;case"LineString":d.push(r({geometry:t},n,i));break;case"MultiLineString":s.forEach(E=>{d.push(r({geometry:{type:"LineString",coordinates:E}},n,i))});break;case"Polygon":y.push(r({geometry:t},n,i)),s.forEach(E=>{x.push(r({geometry:{type:"LineString",coordinates:E}},n,i))});break;case"MultiPolygon":s.forEach(E=>{y.push(r({geometry:{type:"Polygon",coordinates:E}},n,i)),E.forEach(S=>{x.push(r({geometry:{type:"LineString",coordinates:S}},n,i))})});break}}const dle={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Ale(t,e){let r=dle[t];for(Wr.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function I6(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function U0(t){return t.geometry.coordinates}function ple(t,e){const r=I6(),{pointFeatures:n,lineFeatures:i,polygonFeatures:o,polygonOutlineFeatures:s}=t;return r.points.data=n,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=U0,r.lines.data=i,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=U0,r.polygons.data=o,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=U0,r.polygonsOutline.data=s,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=U0,r}function gle(t,e){const r=I6(),{points:n,lines:i,polygons:o}=t,s=Gce(t,e);return r.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:s.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:s.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines._pathType="open",r.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygons._normalize=!1,o.triangles&&(r.polygons.data.attributes.indices=o.triangles.value),r.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygonsOutline._pathType="open",r}const mle=["points","linestrings","polygons"],_le={...dp(wm.circle),...dp(wm.icon),...dp(wm.text),...dp(Cm),...dp(R2),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Nl extends gs{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){const n=gle(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:r}){const n=hle(e.data),i=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(r.dataChanged)){const d=this.state.features;for(const y in d)o[y]=d[y].slice(),s[y]=[];for(const y of r.dataChanged){const x=TM(n,i,y);for(const E in d)s[E].push(w6({data:o[E],getIndex:S=>S.__source.index,dataRange:y,replace:x[E]}))}}else o=TM(n,i);const u=ple(o,s);this.setState({features:o,featuresDiff:s,layerProps:u})}getPickingInfo(e){const r=super.getPickingInfo(e),{index:n,sourceLayer:i}=r;return r.featureType=mle.find(o=>i.id.startsWith(`${this.id}-${o}-`)),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}_updateAutoHighlight(e){const r=`${this.id}-points-`,n=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(r)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:r}=this.props,{layerProps:n}=this.state,i="polygons-fill",o=this.shouldRenderSubLayer(i,n.polygons?.data)&&this.getSubLayerClass(i,R2.type);if(o){const s=pb(this,R2.props),u=e&&r;return u||delete s.getLineColor,s.updateTriggers.lineColors=u,new o(s,this.getSubLayerProps({id:i,updateTriggers:s.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:r}=this.props,{layerProps:n}=this.state,i="polygons-stroke",o="linestrings",s=!e&&r&&this.shouldRenderSubLayer(i,n.polygonsOutline?.data)&&this.getSubLayerClass(i,Cm.type),u=this.shouldRenderSubLayer(o,n.lines?.data)&&this.getSubLayerClass(o,Cm.type);if(s||u){const d=pb(this,Cm.props);return[s&&new s(d,this.getSubLayerProps({id:i,updateTriggers:d.updateTriggers}),n.polygonsOutline),u&&new u(d,this.getSubLayerProps({id:o,updateTriggers:d.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:r,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=r.points.data.findIndex(u=>u.__source.index===i));const o=new Set(e.split("+")),s=[];for(const u of o){const d=`points-${u}`,y=wm[u],x=y&&this.shouldRenderSubLayer(d,r.points?.data)&&this.getSubLayerClass(d,y.type);if(x){const E=pb(this,y.props);let S=r.points;if(u==="text"&&n){const{instancePickingColors:O,...k}=S.data.attributes;S={...S,data:{...S.data,attributes:k}}}s.push(new x(E,this.getSubLayerProps({id:d,updateTriggers:E.updateTriggers,highlightedObjectIndex:i}),S))}}return s}renderLayers(){const{extruded:e}=this.props,r=this._renderPolygonLayer(),n=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&r,n,i,e&&r]}getSubLayerAccessor(e){const{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(n,i)=>{const{data:o,index:s}=i,u=Uce(o,s);return e(u,i)}}}Nl.layerName="GeoJsonLayer";Nl.defaultProps=_le;const yle=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:yg,BitmapLayer:Y_,ColumnLayer:Yc,GeoJsonLayer:Nl,GridCellLayer:Pw,IconLayer:TA,LineLayer:Z_,PathLayer:zu,PointCloudLayer:vg,PolygonLayer:Vu,ScatterplotLayer:bg,SolidPolygonLayer:Gu,TextLayer:ih,_MultiIconLayer:Q_,_TextBackgroundLayer:xg},Symbol.toStringTag,{value:"Module"}));function vle(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function F2(t){if(Array.isArray(t))return t.map(e=>F2(e));if(t&&typeof t=="object"){const e={};for(const[r,n]of Object.entries(t))e[vle(r)]=F2(n);return e}return t}var gb={},mb={},BM;function Rw(){return BM||(BM=1,function(t){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+e+"]["+r+"]*",i=new RegExp("^"+n+"$"),o=function(u,d){const y=[];let x=d.exec(u);for(;x;){const E=[];E.startIndex=d.lastIndex-x[0].length;const S=x.length;for(let O=0;O<S;O++)E.push(x[O]);y.push(E),x=d.exec(u)}return y},s=function(u){const d=i.exec(u);return!(d===null||typeof d>"u")};t.isExist=function(u){return typeof u<"u"},t.isEmptyObject=function(u){return Object.keys(u).length===0},t.merge=function(u,d,y){if(d){const x=Object.keys(d),E=x.length;for(let S=0;S<E;S++)y==="strict"?u[x[S]]=[d[x[S]]]:u[x[S]]=d[x[S]]}},t.getValue=function(u){return t.isExist(u)?u:""},t.isName=s,t.getAllMatches=o,t.nameRegexp=n}(mb)),mb}var SM;function M6(){if(SM)return gb;SM=1;const t=Rw(),e={allowBooleanAttributes:!1,unpairedTags:[]};gb.validate=function(G,H){H=Object.assign({},e,H);const K=[];let he=!1,Y=!1;G[0]==="\uFEFF"&&(G=G.substr(1));for(let oe=0;oe<G.length;oe++)if(G[oe]==="<"&&G[oe+1]==="?"){if(oe+=2,oe=n(G,oe),oe.err)return oe}else if(G[oe]==="<"){let Ee=oe;if(oe++,G[oe]==="!"){oe=i(G,oe);continue}else{let ze=!1;G[oe]==="/"&&(ze=!0,oe++);let de="";for(;oe<G.length&&G[oe]!==">"&&G[oe]!==" "&&G[oe]!=="	"&&G[oe]!==`
`&&G[oe]!=="\r";oe++)de+=G[oe];if(de=de.trim(),de[de.length-1]==="/"&&(de=de.substring(0,de.length-1),oe--),!k(de)){let $;return de.trim().length===0?$="Invalid space after '<'.":$="Tag '"+de+"' is an invalid name.",S("InvalidTag",$,U(G,oe))}const ve=u(G,oe);if(ve===!1)return S("InvalidAttr","Attributes for '"+de+"' have open quote.",U(G,oe));let Ae=ve.value;if(oe=ve.index,Ae[Ae.length-1]==="/"){const $=oe-Ae.length;Ae=Ae.substring(0,Ae.length-1);const re=y(Ae,H);if(re===!0)he=!0;else return S(re.err.code,re.err.msg,U(G,$+re.err.line))}else if(ze)if(ve.tagClosed){if(Ae.trim().length>0)return S("InvalidTag","Closing tag '"+de+"' can't have attributes or invalid starting.",U(G,Ee));if(K.length===0)return S("InvalidTag","Closing tag '"+de+"' has not been opened.",U(G,Ee));{const $=K.pop();if(de!==$.tagName){let re=U(G,$.tagStartPos);return S("InvalidTag","Expected closing tag '"+$.tagName+"' (opened in line "+re.line+", col "+re.col+") instead of closing tag '"+de+"'.",U(G,Ee))}K.length==0&&(Y=!0)}}else return S("InvalidTag","Closing tag '"+de+"' doesn't have proper closing.",U(G,oe));else{const $=y(Ae,H);if($!==!0)return S($.err.code,$.err.msg,U(G,oe-Ae.length+$.err.line));if(Y===!0)return S("InvalidXml","Multiple possible root nodes found.",U(G,oe));H.unpairedTags.indexOf(de)!==-1||K.push({tagName:de,tagStartPos:Ee}),he=!0}for(oe++;oe<G.length;oe++)if(G[oe]==="<")if(G[oe+1]==="!"){oe++,oe=i(G,oe);continue}else if(G[oe+1]==="?"){if(oe=n(G,++oe),oe.err)return oe}else break;else if(G[oe]==="&"){const $=E(G,oe);if($==-1)return S("InvalidChar","char '&' is not expected.",U(G,oe));oe=$}else if(Y===!0&&!r(G[oe]))return S("InvalidXml","Extra text at the end",U(G,oe));G[oe]==="<"&&oe--}}else{if(r(G[oe]))continue;return S("InvalidChar","char '"+G[oe]+"' is not expected.",U(G,oe))}if(he){if(K.length==1)return S("InvalidTag","Unclosed tag '"+K[0].tagName+"'.",U(G,K[0].tagStartPos));if(K.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(K.map(oe=>oe.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function r(G){return G===" "||G==="	"||G===`
`||G==="\r"}function n(G,H){const K=H;for(;H<G.length;H++)if(G[H]=="?"||G[H]==" "){const he=G.substr(K,H-K);if(H>5&&he==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",U(G,H));if(G[H]=="?"&&G[H+1]==">"){H++;break}else continue}return H}function i(G,H){if(G.length>H+5&&G[H+1]==="-"&&G[H+2]==="-"){for(H+=3;H<G.length;H++)if(G[H]==="-"&&G[H+1]==="-"&&G[H+2]===">"){H+=2;break}}else if(G.length>H+8&&G[H+1]==="D"&&G[H+2]==="O"&&G[H+3]==="C"&&G[H+4]==="T"&&G[H+5]==="Y"&&G[H+6]==="P"&&G[H+7]==="E"){let K=1;for(H+=8;H<G.length;H++)if(G[H]==="<")K++;else if(G[H]===">"&&(K--,K===0))break}else if(G.length>H+9&&G[H+1]==="["&&G[H+2]==="C"&&G[H+3]==="D"&&G[H+4]==="A"&&G[H+5]==="T"&&G[H+6]==="A"&&G[H+7]==="["){for(H+=8;H<G.length;H++)if(G[H]==="]"&&G[H+1]==="]"&&G[H+2]===">"){H+=2;break}}return H}const o='"',s="'";function u(G,H){let K="",he="",Y=!1;for(;H<G.length;H++){if(G[H]===o||G[H]===s)he===""?he=G[H]:he!==G[H]||(he="");else if(G[H]===">"&&he===""){Y=!0;break}K+=G[H]}return he!==""?!1:{value:K,index:H,tagClosed:Y}}const d=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function y(G,H){const K=t.getAllMatches(G,d),he={};for(let Y=0;Y<K.length;Y++){if(K[Y][1].length===0)return S("InvalidAttr","Attribute '"+K[Y][2]+"' has no space in starting.",J(K[Y]));if(K[Y][3]!==void 0&&K[Y][4]===void 0)return S("InvalidAttr","Attribute '"+K[Y][2]+"' is without value.",J(K[Y]));if(K[Y][3]===void 0&&!H.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+K[Y][2]+"' is not allowed.",J(K[Y]));const oe=K[Y][2];if(!O(oe))return S("InvalidAttr","Attribute '"+oe+"' is an invalid name.",J(K[Y]));if(!he.hasOwnProperty(oe))he[oe]=1;else return S("InvalidAttr","Attribute '"+oe+"' is repeated.",J(K[Y]))}return!0}function x(G,H){let K=/\d/;for(G[H]==="x"&&(H++,K=/[\da-fA-F]/);H<G.length;H++){if(G[H]===";")return H;if(!G[H].match(K))break}return-1}function E(G,H){if(H++,G[H]===";")return-1;if(G[H]==="#")return H++,x(G,H);let K=0;for(;H<G.length;H++,K++)if(!(G[H].match(/\w/)&&K<20)){if(G[H]===";")break;return-1}return H}function S(G,H,K){return{err:{code:G,msg:H,line:K.line||K,col:K.col}}}function O(G){return t.isName(G)}function k(G){return t.isName(G)}function U(G,H){const K=G.substring(0,H).split(/\r?\n/);return{line:K.length,col:K[K.length-1].length+1}}function J(G){return G.startIndex+G[1].length}return gb}var z0={},IM;function ble(){if(IM)return z0;IM=1;const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,n){return n},attributeValueProcessor:function(r,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(r,n,i){return r}},e=function(r){return Object.assign({},t,r)};return z0.buildOptions=e,z0.defaultOptions=t,z0}var _b,MM;function xle(){if(MM)return _b;MM=1;class t{constructor(r){this.tagname=r,this.child=[],this[":@"]={}}add(r,n){r==="__proto__"&&(r="#__proto__"),this.child.push({[r]:n})}addChild(r){r.tagname==="__proto__"&&(r.tagname="#__proto__"),r[":@"]&&Object.keys(r[":@"]).length>0?this.child.push({[r.tagname]:r.child,":@":r[":@"]}):this.child.push({[r.tagname]:r.child})}}return _b=t,_b}var yb,PM;function wle(){if(PM)return yb;PM=1;const t=Rw();function e(y,x){const E={};if(y[x+3]==="O"&&y[x+4]==="C"&&y[x+5]==="T"&&y[x+6]==="Y"&&y[x+7]==="P"&&y[x+8]==="E"){x=x+9;let S=1,O=!1,k=!1,U="";for(;x<y.length;x++)if(y[x]==="<"&&!k){if(O&&i(y,x))x+=7,[entityName,val,x]=r(y,x+1),val.indexOf("&")===-1&&(E[d(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(O&&o(y,x))x+=8;else if(O&&s(y,x))x+=8;else if(O&&u(y,x))x+=9;else if(n)k=!0;else throw new Error("Invalid DOCTYPE");S++,U=""}else if(y[x]===">"){if(k?y[x-1]==="-"&&y[x-2]==="-"&&(k=!1,S--):S--,S===0)break}else y[x]==="["?O=!0:U+=y[x];if(S!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:E,i:x}}function r(y,x){let E="";for(;x<y.length&&y[x]!=="'"&&y[x]!=='"';x++)E+=y[x];if(E=E.trim(),E.indexOf(" ")!==-1)throw new Error("External entites are not supported");const S=y[x++];let O="";for(;x<y.length&&y[x]!==S;x++)O+=y[x];return[E,O,x]}function n(y,x){return y[x+1]==="!"&&y[x+2]==="-"&&y[x+3]==="-"}function i(y,x){return y[x+1]==="!"&&y[x+2]==="E"&&y[x+3]==="N"&&y[x+4]==="T"&&y[x+5]==="I"&&y[x+6]==="T"&&y[x+7]==="Y"}function o(y,x){return y[x+1]==="!"&&y[x+2]==="E"&&y[x+3]==="L"&&y[x+4]==="E"&&y[x+5]==="M"&&y[x+6]==="E"&&y[x+7]==="N"&&y[x+8]==="T"}function s(y,x){return y[x+1]==="!"&&y[x+2]==="A"&&y[x+3]==="T"&&y[x+4]==="T"&&y[x+5]==="L"&&y[x+6]==="I"&&y[x+7]==="S"&&y[x+8]==="T"}function u(y,x){return y[x+1]==="!"&&y[x+2]==="N"&&y[x+3]==="O"&&y[x+4]==="T"&&y[x+5]==="A"&&y[x+6]==="T"&&y[x+7]==="I"&&y[x+8]==="O"&&y[x+9]==="N"}function d(y){if(t.isName(y))return y;throw new Error(`Invalid entity name ${y}`)}return yb=e,yb}var vb,RM;function Cle(){if(RM)return vb;RM=1;const t=/^[-+]?0x[a-fA-F0-9]+$/,e=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const r={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(o,s={}){if(s=Object.assign({},r,s),!o||typeof o!="string")return o;let u=o.trim();if(s.skipLike!==void 0&&s.skipLike.test(u))return o;if(s.hex&&t.test(u))return Number.parseInt(u,16);{const d=e.exec(u);if(d){const y=d[1],x=d[2];let E=i(d[3]);const S=d[4]||d[6];if(!s.leadingZeros&&x.length>0&&y&&u[2]!==".")return o;if(!s.leadingZeros&&x.length>0&&!y&&u[1]!==".")return o;{const O=Number(u),k=""+O;return k.search(/[eE]/)!==-1||S?s.eNotation?O:o:u.indexOf(".")!==-1?k==="0"&&E===""||k===E||y&&k==="-"+E?O:o:x?E===k||y+E===k?O:o:u===k||u===y+k?O:o}}else return o}}function i(o){return o&&o.indexOf(".")!==-1&&(o=o.replace(/0+$/,""),o==="."?o="0":o[0]==="."?o="0"+o:o[o.length-1]==="."&&(o=o.substr(0,o.length-1))),o}return vb=n,vb}var bb,FM;function P6(){if(FM)return bb;FM=1;function t(e){return typeof e=="function"?e:Array.isArray(e)?r=>{for(const n of e)if(typeof n=="string"&&r===n||n instanceof RegExp&&n.test(r))return!0}:()=>!1}return bb=t,bb}var xb,DM;function Tle(){if(DM)return xb;DM=1;const t=Rw(),e=xle(),r=wle(),n=Cle(),i=P6();class o{constructor(oe){this.options=oe,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(Ee,ze)=>String.fromCharCode(Number.parseInt(ze,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(Ee,ze)=>String.fromCharCode(Number.parseInt(ze,16))}},this.addExternalEntities=s,this.parseXml=E,this.parseTextData=u,this.resolveNameSpace=d,this.buildAttributesMap=x,this.isItStopNode=U,this.replaceEntitiesValue=O,this.readStopNodeData=K,this.saveTextToParentTag=k,this.addChild=S,this.ignoreAttributesFn=i(this.options.ignoreAttributes)}}function s(Y){const oe=Object.keys(Y);for(let Ee=0;Ee<oe.length;Ee++){const ze=oe[Ee];this.lastEntities[ze]={regex:new RegExp("&"+ze+";","g"),val:Y[ze]}}}function u(Y,oe,Ee,ze,de,ve,Ae){if(Y!==void 0&&(this.options.trimValues&&!ze&&(Y=Y.trim()),Y.length>0)){Ae||(Y=this.replaceEntitiesValue(Y));const $=this.options.tagValueProcessor(oe,Y,Ee,de,ve);return $==null?Y:typeof $!=typeof Y||$!==Y?$:this.options.trimValues?he(Y,this.options.parseTagValue,this.options.numberParseOptions):Y.trim()===Y?he(Y,this.options.parseTagValue,this.options.numberParseOptions):Y}}function d(Y){if(this.options.removeNSPrefix){const oe=Y.split(":"),Ee=Y.charAt(0)==="/"?"/":"";if(oe[0]==="xmlns")return"";oe.length===2&&(Y=Ee+oe[1])}return Y}const y=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function x(Y,oe,Ee){if(this.options.ignoreAttributes!==!0&&typeof Y=="string"){const ze=t.getAllMatches(Y,y),de=ze.length,ve={};for(let Ae=0;Ae<de;Ae++){const $=this.resolveNameSpace(ze[Ae][1]);if(this.ignoreAttributesFn($,oe))continue;let re=ze[Ae][4],Te=this.options.attributeNamePrefix+$;if($.length)if(this.options.transformAttributeName&&(Te=this.options.transformAttributeName(Te)),Te==="__proto__"&&(Te="#__proto__"),re!==void 0){this.options.trimValues&&(re=re.trim()),re=this.replaceEntitiesValue(re);const Qe=this.options.attributeValueProcessor($,re,oe);Qe==null?ve[Te]=re:typeof Qe!=typeof re||Qe!==re?ve[Te]=Qe:ve[Te]=he(re,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(ve[Te]=!0)}if(!Object.keys(ve).length)return;if(this.options.attributesGroupName){const Ae={};return Ae[this.options.attributesGroupName]=ve,Ae}return ve}}const E=function(Y){Y=Y.replace(/\r\n?/g,`
`);const oe=new e("!xml");let Ee=oe,ze="",de="";for(let ve=0;ve<Y.length;ve++)if(Y[ve]==="<")if(Y[ve+1]==="/"){const $=G(Y,">",ve,"Closing Tag is not closed.");let re=Y.substring(ve+2,$).trim();if(this.options.removeNSPrefix){const me=re.indexOf(":");me!==-1&&(re=re.substr(me+1))}this.options.transformTagName&&(re=this.options.transformTagName(re)),Ee&&(ze=this.saveTextToParentTag(ze,Ee,de));const Te=de.substring(de.lastIndexOf(".")+1);if(re&&this.options.unpairedTags.indexOf(re)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${re}>`);let Qe=0;Te&&this.options.unpairedTags.indexOf(Te)!==-1?(Qe=de.lastIndexOf(".",de.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Qe=de.lastIndexOf("."),de=de.substring(0,Qe),Ee=this.tagsNodeStack.pop(),ze="",ve=$}else if(Y[ve+1]==="?"){let $=H(Y,ve,!1,"?>");if(!$)throw new Error("Pi Tag is not closed.");if(ze=this.saveTextToParentTag(ze,Ee,de),!(this.options.ignoreDeclaration&&$.tagName==="?xml"||this.options.ignorePiTags)){const re=new e($.tagName);re.add(this.options.textNodeName,""),$.tagName!==$.tagExp&&$.attrExpPresent&&(re[":@"]=this.buildAttributesMap($.tagExp,de,$.tagName)),this.addChild(Ee,re,de)}ve=$.closeIndex+1}else if(Y.substr(ve+1,3)==="!--"){const $=G(Y,"-->",ve+4,"Comment is not closed.");if(this.options.commentPropName){const re=Y.substring(ve+4,$-2);ze=this.saveTextToParentTag(ze,Ee,de),Ee.add(this.options.commentPropName,[{[this.options.textNodeName]:re}])}ve=$}else if(Y.substr(ve+1,2)==="!D"){const $=r(Y,ve);this.docTypeEntities=$.entities,ve=$.i}else if(Y.substr(ve+1,2)==="!["){const $=G(Y,"]]>",ve,"CDATA is not closed.")-2,re=Y.substring(ve+9,$);ze=this.saveTextToParentTag(ze,Ee,de);let Te=this.parseTextData(re,Ee.tagname,de,!0,!1,!0,!0);Te==null&&(Te=""),this.options.cdataPropName?Ee.add(this.options.cdataPropName,[{[this.options.textNodeName]:re}]):Ee.add(this.options.textNodeName,Te),ve=$+2}else{let $=H(Y,ve,this.options.removeNSPrefix),re=$.tagName;const Te=$.rawTagName;let Qe=$.tagExp,me=$.attrExpPresent,Le=$.closeIndex;this.options.transformTagName&&(re=this.options.transformTagName(re)),Ee&&ze&&Ee.tagname!=="!xml"&&(ze=this.saveTextToParentTag(ze,Ee,de,!1));const Ue=Ee;if(Ue&&this.options.unpairedTags.indexOf(Ue.tagname)!==-1&&(Ee=this.tagsNodeStack.pop(),de=de.substring(0,de.lastIndexOf("."))),re!==oe.tagname&&(de+=de?"."+re:re),this.isItStopNode(this.options.stopNodes,de,re)){let Ye="";if(Qe.length>0&&Qe.lastIndexOf("/")===Qe.length-1)re[re.length-1]==="/"?(re=re.substr(0,re.length-1),de=de.substr(0,de.length-1),Qe=re):Qe=Qe.substr(0,Qe.length-1),ve=$.closeIndex;else if(this.options.unpairedTags.indexOf(re)!==-1)ve=$.closeIndex;else{const tt=this.readStopNodeData(Y,Te,Le+1);if(!tt)throw new Error(`Unexpected end of ${Te}`);ve=tt.i,Ye=tt.tagContent}const et=new e(re);re!==Qe&&me&&(et[":@"]=this.buildAttributesMap(Qe,de,re)),Ye&&(Ye=this.parseTextData(Ye,re,de,!0,me,!0,!0)),de=de.substr(0,de.lastIndexOf(".")),et.add(this.options.textNodeName,Ye),this.addChild(Ee,et,de)}else{if(Qe.length>0&&Qe.lastIndexOf("/")===Qe.length-1){re[re.length-1]==="/"?(re=re.substr(0,re.length-1),de=de.substr(0,de.length-1),Qe=re):Qe=Qe.substr(0,Qe.length-1),this.options.transformTagName&&(re=this.options.transformTagName(re));const Ye=new e(re);re!==Qe&&me&&(Ye[":@"]=this.buildAttributesMap(Qe,de,re)),this.addChild(Ee,Ye,de),de=de.substr(0,de.lastIndexOf("."))}else{const Ye=new e(re);this.tagsNodeStack.push(Ee),re!==Qe&&me&&(Ye[":@"]=this.buildAttributesMap(Qe,de,re)),this.addChild(Ee,Ye,de),Ee=Ye}ze="",ve=Le}}else ze+=Y[ve];return oe.child};function S(Y,oe,Ee){const ze=this.options.updateTag(oe.tagname,Ee,oe[":@"]);ze===!1||(typeof ze=="string"&&(oe.tagname=ze),Y.addChild(oe))}const O=function(Y){if(this.options.processEntities){for(let oe in this.docTypeEntities){const Ee=this.docTypeEntities[oe];Y=Y.replace(Ee.regx,Ee.val)}for(let oe in this.lastEntities){const Ee=this.lastEntities[oe];Y=Y.replace(Ee.regex,Ee.val)}if(this.options.htmlEntities)for(let oe in this.htmlEntities){const Ee=this.htmlEntities[oe];Y=Y.replace(Ee.regex,Ee.val)}Y=Y.replace(this.ampEntity.regex,this.ampEntity.val)}return Y};function k(Y,oe,Ee,ze){return Y&&(ze===void 0&&(ze=Object.keys(oe.child).length===0),Y=this.parseTextData(Y,oe.tagname,Ee,!1,oe[":@"]?Object.keys(oe[":@"]).length!==0:!1,ze),Y!==void 0&&Y!==""&&oe.add(this.options.textNodeName,Y),Y=""),Y}function U(Y,oe,Ee){const ze="*."+Ee;for(const de in Y){const ve=Y[de];if(ze===ve||oe===ve)return!0}return!1}function J(Y,oe,Ee=">"){let ze,de="";for(let ve=oe;ve<Y.length;ve++){let Ae=Y[ve];if(ze)Ae===ze&&(ze="");else if(Ae==='"'||Ae==="'")ze=Ae;else if(Ae===Ee[0])if(Ee[1]){if(Y[ve+1]===Ee[1])return{data:de,index:ve}}else return{data:de,index:ve};else Ae==="	"&&(Ae=" ");de+=Ae}}function G(Y,oe,Ee,ze){const de=Y.indexOf(oe,Ee);if(de===-1)throw new Error(ze);return de+oe.length-1}function H(Y,oe,Ee,ze=">"){const de=J(Y,oe+1,ze);if(!de)return;let ve=de.data;const Ae=de.index,$=ve.search(/\s/);let re=ve,Te=!0;$!==-1&&(re=ve.substring(0,$),ve=ve.substring($+1).trimStart());const Qe=re;if(Ee){const me=re.indexOf(":");me!==-1&&(re=re.substr(me+1),Te=re!==de.data.substr(me+1))}return{tagName:re,tagExp:ve,closeIndex:Ae,attrExpPresent:Te,rawTagName:Qe}}function K(Y,oe,Ee){const ze=Ee;let de=1;for(;Ee<Y.length;Ee++)if(Y[Ee]==="<")if(Y[Ee+1]==="/"){const ve=G(Y,">",Ee,`${oe} is not closed`);if(Y.substring(Ee+2,ve).trim()===oe&&(de--,de===0))return{tagContent:Y.substring(ze,Ee),i:ve};Ee=ve}else if(Y[Ee+1]==="?")Ee=G(Y,"?>",Ee+1,"StopNode is not closed.");else if(Y.substr(Ee+1,3)==="!--")Ee=G(Y,"-->",Ee+3,"StopNode is not closed.");else if(Y.substr(Ee+1,2)==="![")Ee=G(Y,"]]>",Ee,"StopNode is not closed.")-2;else{const ve=H(Y,Ee,">");ve&&((ve&&ve.tagName)===oe&&ve.tagExp[ve.tagExp.length-1]!=="/"&&de++,Ee=ve.closeIndex)}}function he(Y,oe,Ee){if(oe&&typeof Y=="string"){const ze=Y.trim();return ze==="true"?!0:ze==="false"?!1:n(Y,Ee)}else return t.isExist(Y)?Y:""}return xb=o,xb}var wb={},OM;function Ele(){if(OM)return wb;OM=1;function t(o,s){return e(o,s)}function e(o,s,u){let d;const y={};for(let x=0;x<o.length;x++){const E=o[x],S=r(E);let O="";if(u===void 0?O=S:O=u+"."+S,S===s.textNodeName)d===void 0?d=E[S]:d+=""+E[S];else{if(S===void 0)continue;if(E[S]){let k=e(E[S],s,O);const U=i(k,s);E[":@"]?n(k,E[":@"],O,s):Object.keys(k).length===1&&k[s.textNodeName]!==void 0&&!s.alwaysCreateTextNode?k=k[s.textNodeName]:Object.keys(k).length===0&&(s.alwaysCreateTextNode?k[s.textNodeName]="":k=""),y[S]!==void 0&&y.hasOwnProperty(S)?(Array.isArray(y[S])||(y[S]=[y[S]]),y[S].push(k)):s.isArray(S,O,U)?y[S]=[k]:y[S]=k}}}return typeof d=="string"?d.length>0&&(y[s.textNodeName]=d):d!==void 0&&(y[s.textNodeName]=d),y}function r(o){const s=Object.keys(o);for(let u=0;u<s.length;u++){const d=s[u];if(d!==":@")return d}}function n(o,s,u,d){if(s){const y=Object.keys(s),x=y.length;for(let E=0;E<x;E++){const S=y[E];d.isArray(S,u+"."+S,!0,!0)?o[S]=[s[S]]:o[S]=s[S]}}}function i(o,s){const{textNodeName:u}=s,d=Object.keys(o).length;return!!(d===0||d===1&&(o[u]||typeof o[u]=="boolean"||o[u]===0))}return wb.prettify=t,wb}var Cb,LM;function Ble(){if(LM)return Cb;LM=1;const{buildOptions:t}=ble(),e=Tle(),{prettify:r}=Ele(),n=M6();class i{constructor(s){this.externalEntities={},this.options=t(s)}parse(s,u){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(u){u===!0&&(u={});const x=n.validate(s,u);if(x!==!0)throw Error(`${x.err.msg}:${x.err.line}:${x.err.col}`)}const d=new e(this.options);d.addExternalEntities(this.externalEntities);const y=d.parseXml(s);return this.options.preserveOrder||y===void 0?y:r(y,this.options)}addEntity(s,u){if(u.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(u==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=u}}return Cb=i,Cb}var Tb,NM;function Sle(){if(NM)return Tb;NM=1;const t=`
`;function e(u,d){let y="";return d.format&&d.indentBy.length>0&&(y=t),r(u,d,"",y)}function r(u,d,y,x){let E="",S=!1;for(let O=0;O<u.length;O++){const k=u[O],U=n(k);if(U===void 0)continue;let J="";if(y.length===0?J=U:J=`${y}.${U}`,U===d.textNodeName){let Y=k[U];o(J,d)||(Y=d.tagValueProcessor(U,Y),Y=s(Y,d)),S&&(E+=x),E+=Y,S=!1;continue}else if(U===d.cdataPropName){S&&(E+=x),E+=`<![CDATA[${k[U][0][d.textNodeName]}]]>`,S=!1;continue}else if(U===d.commentPropName){E+=x+`<!--${k[U][0][d.textNodeName]}-->`,S=!0;continue}else if(U[0]==="?"){const Y=i(k[":@"],d),oe=U==="?xml"?"":x;let Ee=k[U][0][d.textNodeName];Ee=Ee.length!==0?" "+Ee:"",E+=oe+`<${U}${Ee}${Y}?>`,S=!0;continue}let G=x;G!==""&&(G+=d.indentBy);const H=i(k[":@"],d),K=x+`<${U}${H}`,he=r(k[U],d,J,G);d.unpairedTags.indexOf(U)!==-1?d.suppressUnpairedNode?E+=K+">":E+=K+"/>":(!he||he.length===0)&&d.suppressEmptyNode?E+=K+"/>":he&&he.endsWith(">")?E+=K+`>${he}${x}</${U}>`:(E+=K+">",he&&x!==""&&(he.includes("/>")||he.includes("</"))?E+=x+d.indentBy+he+x:E+=he,E+=`</${U}>`),S=!0}return E}function n(u){const d=Object.keys(u);for(let y=0;y<d.length;y++){const x=d[y];if(u.hasOwnProperty(x)&&x!==":@")return x}}function i(u,d){let y="";if(u&&!d.ignoreAttributes)for(let x in u){if(!u.hasOwnProperty(x))continue;let E=d.attributeValueProcessor(x,u[x]);E=s(E,d),E===!0&&d.suppressBooleanAttributes?y+=` ${x.substr(d.attributeNamePrefix.length)}`:y+=` ${x.substr(d.attributeNamePrefix.length)}="${E}"`}return y}function o(u,d){u=u.substr(0,u.length-d.textNodeName.length-1);let y=u.substr(u.lastIndexOf(".")+1);for(let x in d.stopNodes)if(d.stopNodes[x]===u||d.stopNodes[x]==="*."+y)return!0;return!1}function s(u,d){if(u&&u.length>0&&d.processEntities)for(let y=0;y<d.entities.length;y++){const x=d.entities[y];u=u.replace(x.regex,x.val)}return u}return Tb=e,Tb}var Eb,kM;function Ile(){if(kM)return Eb;kM=1;const t=Sle(),e=P6(),r={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(u,d){return d},attributeValueProcessor:function(u,d){return d},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function n(u){this.options=Object.assign({},r,u),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=e(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=i,this.options.format?(this.indentate=o,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}n.prototype.build=function(u){return this.options.preserveOrder?t(u,this.options):(Array.isArray(u)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(u={[this.options.arrayNodeName]:u}),this.j2x(u,0,[]).val)},n.prototype.j2x=function(u,d,y){let x="",E="";const S=y.join(".");for(let O in u)if(Object.prototype.hasOwnProperty.call(u,O))if(typeof u[O]>"u")this.isAttribute(O)&&(E+="");else if(u[O]===null)this.isAttribute(O)?E+="":O[0]==="?"?E+=this.indentate(d)+"<"+O+"?"+this.tagEndChar:E+=this.indentate(d)+"<"+O+"/"+this.tagEndChar;else if(u[O]instanceof Date)E+=this.buildTextValNode(u[O],O,"",d);else if(typeof u[O]!="object"){const k=this.isAttribute(O);if(k&&!this.ignoreAttributesFn(k,S))x+=this.buildAttrPairStr(k,""+u[O]);else if(!k)if(O===this.options.textNodeName){let U=this.options.tagValueProcessor(O,""+u[O]);E+=this.replaceEntitiesValue(U)}else E+=this.buildTextValNode(u[O],O,"",d)}else if(Array.isArray(u[O])){const k=u[O].length;let U="",J="";for(let G=0;G<k;G++){const H=u[O][G];if(!(typeof H>"u"))if(H===null)O[0]==="?"?E+=this.indentate(d)+"<"+O+"?"+this.tagEndChar:E+=this.indentate(d)+"<"+O+"/"+this.tagEndChar;else if(typeof H=="object")if(this.options.oneListGroup){const K=this.j2x(H,d+1,y.concat(O));U+=K.val,this.options.attributesGroupName&&H.hasOwnProperty(this.options.attributesGroupName)&&(J+=K.attrStr)}else U+=this.processTextOrObjNode(H,O,d,y);else if(this.options.oneListGroup){let K=this.options.tagValueProcessor(O,H);K=this.replaceEntitiesValue(K),U+=K}else U+=this.buildTextValNode(H,O,"",d)}this.options.oneListGroup&&(U=this.buildObjectNode(U,O,J,d)),E+=U}else if(this.options.attributesGroupName&&O===this.options.attributesGroupName){const k=Object.keys(u[O]),U=k.length;for(let J=0;J<U;J++)x+=this.buildAttrPairStr(k[J],""+u[O][k[J]])}else E+=this.processTextOrObjNode(u[O],O,d,y);return{attrStr:x,val:E}},n.prototype.buildAttrPairStr=function(u,d){return d=this.options.attributeValueProcessor(u,""+d),d=this.replaceEntitiesValue(d),this.options.suppressBooleanAttributes&&d==="true"?" "+u:" "+u+'="'+d+'"'};function i(u,d,y,x){const E=this.j2x(u,y+1,x.concat(d));return u[this.options.textNodeName]!==void 0&&Object.keys(u).length===1?this.buildTextValNode(u[this.options.textNodeName],d,E.attrStr,y):this.buildObjectNode(E.val,d,E.attrStr,y)}n.prototype.buildObjectNode=function(u,d,y,x){if(u==="")return d[0]==="?"?this.indentate(x)+"<"+d+y+"?"+this.tagEndChar:this.indentate(x)+"<"+d+y+this.closeTag(d)+this.tagEndChar;{let E="</"+d+this.tagEndChar,S="";return d[0]==="?"&&(S="?",E=""),(y||y==="")&&u.indexOf("<")===-1?this.indentate(x)+"<"+d+y+S+">"+u+E:this.options.commentPropName!==!1&&d===this.options.commentPropName&&S.length===0?this.indentate(x)+`<!--${u}-->`+this.newLine:this.indentate(x)+"<"+d+y+S+this.tagEndChar+u+this.indentate(x)+E}},n.prototype.closeTag=function(u){let d="";return this.options.unpairedTags.indexOf(u)!==-1?this.options.suppressUnpairedNode||(d="/"):this.options.suppressEmptyNode?d="/":d=`></${u}`,d},n.prototype.buildTextValNode=function(u,d,y,x){if(this.options.cdataPropName!==!1&&d===this.options.cdataPropName)return this.indentate(x)+`<![CDATA[${u}]]>`+this.newLine;if(this.options.commentPropName!==!1&&d===this.options.commentPropName)return this.indentate(x)+`<!--${u}-->`+this.newLine;if(d[0]==="?")return this.indentate(x)+"<"+d+y+"?"+this.tagEndChar;{let E=this.options.tagValueProcessor(d,u);return E=this.replaceEntitiesValue(E),E===""?this.indentate(x)+"<"+d+y+this.closeTag(d)+this.tagEndChar:this.indentate(x)+"<"+d+y+">"+E+"</"+d+this.tagEndChar}},n.prototype.replaceEntitiesValue=function(u){if(u&&u.length>0&&this.options.processEntities)for(let d=0;d<this.options.entities.length;d++){const y=this.options.entities[d];u=u.replace(y.regex,y.val)}return u};function o(u){return this.options.indentBy.repeat(u)}function s(u){return u.startsWith(this.options.attributeNamePrefix)&&u!==this.options.textNodeName?u.substr(this.attrPrefixLen):!1}return Eb=n,Eb}var Bb,UM;function Mle(){if(UM)return Bb;UM=1;const t=M6(),e=Ble(),r=Ile();return Bb={XMLParser:e,XMLValidator:t,XMLBuilder:r},Bb}var Ple=Mle();function zM(t,e){if(e?._parser&&e._parser!=="fast-xml-parser")throw new Error(e?._parser);const r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e?.removeNSPrefix,textNodeName:e?.textNodeName,isArray:(i,o,s,u)=>!!e?.arrayPaths?.some(y=>o===y),...e?._fastXML},n=Rle(t,r);return e?.uncapitalizeKeys?F2(n):n}function Rle(t,e){return new Ple.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}const Fle="4.2.4",pA={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Fle,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Dle,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>zM(new TextDecoder().decode(t),{...pA.options.xml,...e?.xml}),parseTextSync:(t,e)=>zM(t,{...pA.options.xml,...e?.xml})};function Dle(t){return t.startsWith("<?xml")}async function sh(t,e,r,n){return n._parse(t,e,r,n)}function ai(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const R6=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),GM=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);GM&&parseFloat(GM[1]);function Ole(t,e){return F6(t||{},e)}function F6(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=F6(n[i]||{},e[i],r+1):n[i]=e[i];return n}function Lle(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function Nle(t){return globalThis.loaders?.modules?.[t]||null}function kle(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.4"),globalThis._loadersgl_.version}const Ule=kle();function zle(t,e){if(!t)throw new Error("loaders.gl assertion failed.")}const wg=typeof process!="object"||String(process)!=="[object process]"||process.browser,Fw=typeof importScripts=="function",VM=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);VM&&parseFloat(VM[1]);const Sb={};async function Gf(t,e=null,r={},n=null){return e&&(t=Gle(t,e,r,n)),Sb[t]=Sb[t]||Vle(t),await Sb[t]}function Gle(t,e,r={},n=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const i=r.modules||{};return i[n]?i[n]:wg?r.CDN?(zle(r.CDN.startsWith("http")),`${r.CDN}/${e}@${Ule}/dist/libs/${n}`):Fw?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function Vle(t){if(t.endsWith("wasm"))return await jle(t);if(!wg)try{const{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(Fw)return importScripts(t);const e=await $le(t);return Hle(e,t)}function Hle(t,e){if(!wg){const{requireFromString:n}=globalThis.loaders||{};return n?.(t,e)}if(Fw)return eval.call(globalThis,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function jle(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return wg||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function $le(t){const{readFileAsText:e}=globalThis.loaders||{};return wg||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function Wle(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?HM(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?HM(t,0,e):""}function HM(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function D6(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${Wle(t)}"`)}}function Cg(t,e,r){const n=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function kl(t,e){return ai(t>=0),ai(e>0),t+(e-1)&-4}function O6(t,e,r){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const i=t.byteOffset,o=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,i,o)}return e.set(n,r),r+kl(n.byteLength,4)}const Jle="Queued Requests",Xle="Active Requests",Kle="Cancelled Requests",qle="Queued Requests Ever",Yle="Active Requests Ever",Zle={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class L6{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...Zle,...e},this.stats=new ZL({id:this.props.id}),this.stats.get(Jle),this.stats.get(Xle),this.stats.get(Kle),this.stats.get(qle),this.stats.get(Yle)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:r},i=new Promise(o=>(n.resolve=o,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:r,resolve:n}=e;let i=!1;const o=()=>{i||(i=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let r=0;r<e.length;++r){const n=e[r];this._updateRequest(n)||(e.splice(r,1),this.requestMap.delete(n.handle),r--)}e.sort((r,n)=>r.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}function Qle(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function N6(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function eue(...t){const e=[];for(let o=0;o<t.length;o++)e[o]=t[o];let r="",n=!1,i;for(let o=e.length-1;o>=-1&&!n;o--){let s;o>=0?s=e[o]:(i===void 0&&(i=Qle()),s=i),s.length!==0&&(r=`${s}/${r}`,n=s.charCodeAt(0)===Bp)}return r=tue(r,!n),n?`/${r}`:r.length>0?r:"."}const Bp=47,Ib=46;function tue(t,e){let r="",n=-1,i=0,o,s=!1;for(let u=0;u<=t.length;++u){if(u<t.length)o=t.charCodeAt(u);else{if(o===Bp)break;o=Bp}if(o===Bp){if(!(n===u-1||i===1))if(n!==u-1&&i===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==Ib||r.charCodeAt(r.length-2)!==Ib){if(r.length>2){const d=r.length-1;let y=d;for(;y>=0&&r.charCodeAt(y)!==Bp;--y);if(y!==d){r=y===-1?"":r.slice(0,y),n=u,i=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",n=u,i=0,s=!1;continue}}e&&(r.length>0?r+="/..":r="..",s=!0)}else{const d=t.slice(n+1,u);r.length>0?r+=`/${d}`:r=d,s=!1}n=u,i=0}else o===Ib&&i!==-1?++i:i=-1}return r}class rue{fetch;loadOptions;_needsRefresh=!0;props;constructor(e){this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=nue(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){const r=this._needsRefresh;return e&&(this._needsRefresh=!1),r}}function nue(t){const e=t?.fetch;if(e&&typeof e=="function")return(n,i)=>e(n,i);const r=t?.fetch;return r&&typeof r!="function"?n=>fetch(n,r):n=>fetch(n)}class Dw extends rue{static type="template";static testURL=e=>!1}function iue(t,e){const r=pA.parseTextSync?.(t,e),n=r?.ServiceExceptionReport?.ServiceException||r?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof n=="string"?n:n.value||n.code||"Unknown error"}const sue="4.2.4",Tm={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:sue,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:oue,options:{wms:{throwOnError:!1}},parse:async(t,e)=>Mb(new TextDecoder().decode(t),e),parseSync:(t,e)=>Mb(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>Mb(t,e)};function oue(t){return t.startsWith("<?xml")}function Mb(t,e){const r={...Tm.options.wms,...e?.wms},n=iue(t,r),i=r.minimalErrors?n:`WMS Service error: ${n}`;if(r.throwOnError)throw new Error(i);return i}function gA(t){return Array.isArray(t)?t:t?[t]:[]}function ey(t){const e=gA(t);return e.length>0&&e.every(r=>typeof r=="string")?e:[]}function G0(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function Pb(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function nA(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function jM(t,e){const r=pA.parseTextSync?.(t,e),n=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,i=aue(n);if(e?.inheritedLayerProps)for(const o of i.layers)U6(o,null);return e?.includeRawJSON&&(i.json=n),e?.includeXMLText&&(i.xml=t),i}function aue(t){const e={version:String(t.version||""),name:String(t.Service?.Name||"unnamed"),title:t.Service?.Title?String(t.Service?.Title):void 0,abstract:t.Service?.Abstract?String(t.Service?.Abstract):void 0,keywords:ey(t.Service?.KeywordList?.Keyword),fees:t.Service?.Fees?JSON.stringify(t.Service?.Fees):void 0,accessConstraints:t.Service?.AccessConstraints?JSON.stringify(t.Service?.AccessConstraints):void 0,layerLimit:Pb(t.Service?.LayerLimit),maxWidth:Pb(t.Service?.maxWidth),maxHeight:Pb(t.Service?.maxHeight),layers:[],requests:cue(t.Capability?.Request),exceptions:lue(t.Exception)},r=gA(t.Capability?.Layer);for(const n of r)e.layers.push(k6(n));for(const[n,i]of Object.entries(e))i===void 0&&delete e[n];return e}function cue(t){const e={};for(const[r,n]of Object.entries(t||{})){const i=ey(n?.Format);e[r]={mimeTypes:i}}return e}function lue(t){if(gA(t?.Format).length>0)return{mimeTypes:ey(t)}}function k6(t){const e={title:String(t?.Title||""),name:t?.Name&&String(t?.Name),abstract:t?.Name&&String(t?.Abstract),keywords:ey(t.KeywordList?.Keyword)},r=t?.CRS||t?.SRS;r&&Array.isArray(r)&&r.every(y=>typeof y=="string")&&(e.crs=r);let n=t?.EX_GeographicBoundingBox&&uue(t?.EX_GeographicBoundingBox);n&&(e.geographicBoundingBox=n),n=t?.LatLonBoundingBox&&fue(t?.LatLonBoundingBox),n&&(e.geographicBoundingBox=n);const i=t?.BoundingBox&&hue(t?.BoundingBox);i&&i.length>0&&(e.boundingBoxes=i);const s=gA(t?.Dimension).map(y=>Aue(y));s.length&&(e.dimensions=s),t?.opaque&&(e.opaque=nA(t?.opaque)),t?.cascaded&&(e.cascaded=nA(t?.cascaded)),t?.queryable&&(e.queryable=nA(t?.queryable));const u=gA(t?.Layer),d=[];for(const y of u)d.push(k6(y));d.length>0&&(e.layers=d);for(const[y,x]of Object.entries(e))x===void 0&&delete e[y];return e}function uue(t){const{westBoundLongitude:e,northBoundLatitude:r,eastBoundLongitude:n,southBoundLatitude:i}=t;return[[e,i],[n,r]]}function fue(t){const{minx:e,miny:r,maxx:n,maxy:i}=t;return[[e,r],[n,i]]}function hue(t){return gA(t).map(r=>due(r))}function due(t){const{CRS:e,SRS:r,minx:n,miny:i,maxx:o,maxy:s,resx:u,resy:d}=t,y={crs:e||r,boundingBox:[[G0(n),G0(i)],[G0(o),G0(s)]]};return u&&(y.xResolution=u),d&&(y.yResolution=d),y}function Aue(t){const{name:e,units:r,value:n}=t,i={name:e,units:r,extent:n};return t.unitSymbol&&(i.unitSymbol=t.unitSymbol),t.default&&(i.defaultValue=t.default),t.multipleValues&&(i.multipleValues=nA(t.multipleValues)),t.nearestValue&&(i.nearestValue=nA(t.nearestValue)),t.current&&(i.current=nA(t.current)),i}function U6(t,e){e?.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e?.crs&&!t.crs&&(t.crs=[...e.crs]),e?.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e?.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(const r of t.layers||[])U6(r,t)}const pue="4.2.4",Ow={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:pue,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:gue,options:{wms:{}},parse:async(t,e)=>jM(new TextDecoder().decode(t),e?.wms),parseTextSync:(t,e)=>jM(t,e?.wms)};function gue(t){return t.startsWith("<?xml")}function $M(t,e){const n=(pA.parseTextSync?.(t,e)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(n)?n:[n]).map(o=>mue(o))}}function mue(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const _ue={...Ow,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>$M(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>$M(t,e)};function WM(t,e){return pA.parseTextSync?.(t,e)}const yue={...Ow,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>WM(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>WM(t,e)};function vue(t,e){const{type:r="auto"}=t,n=r==="auto"?xue(t.url,e):bue(r,e);if(!n)throw new Error("Not a valid image source type");return n.create(t)}function bue(t,e){for(const r of e)if(r.type===t)return r;return null}function xue(t,e){for(const r of e)if(r.testURL&&r.testURL(t))return r;return null}const wue="4.2.4",Cue=globalThis.loaders?.parseImageNode,D2=typeof Image<"u",O2=typeof ImageBitmap<"u",Tue=!!Cue,L2=R6?!0:Tue;function Eue(t){switch(t){case"auto":return O2||D2||L2;case"imagebitmap":return O2;case"image":return D2;case"data":return L2;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Bue(){if(O2)return"imagebitmap";if(D2)return"image";if(L2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Sue(t){const e=Iue(t);if(!e)throw new Error("Not an image");return e}function Lw(t){switch(Sue(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Iue(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Mue=/^data:image\/svg\+xml/,Pue=/\.svg((\?|#).*)?$/;function Nw(t){return t&&(Mue.test(t)||Pue.test(t))}function Rue(t,e){if(Nw(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return z6(t,e)}function z6(t,e){if(Nw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function G6(t,e,r){const n=Rue(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await Fue(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function Fue(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const s=o instanceof Error?o.message:"error";i(new Error(s))}}catch(o){i(o)}})}const Due={};let JM=!0;async function Oue(t,e,r){let n;Nw(r)?n=await G6(t,e,r):n=z6(t,r);const i=e&&e.imagebitmap;return await Lue(n,i)}async function Lue(t,e=null){if((Nue(e)||!JM)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),JM=!1}return await createImageBitmap(t)}function Nue(t){for(const e in t||Due)return!1;return!0}function kue(t){return!Vue(t,"ftyp",4)||(t[8]&96)===0?null:Uue(t)}function Uue(t){switch(zue(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function zue(t,e,r){return String.fromCharCode(...t.slice(e,r))}function Gue(t){return[...t].map(e=>e.charCodeAt(0))}function Vue(t,e,r=0){const n=Gue(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const Gc=!1,Hp=!0;function ty(t){const e=Tg(t);return jue(e)||Jue(e)||$ue(e)||Wue(e)||Hue(e)}function Hue(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=kue(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function jue(t){const e=Tg(t);return e.byteLength>=24&&e.getUint32(0,Gc)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Gc),height:e.getUint32(20,Gc)}:null}function $ue(t){const e=Tg(t);return e.byteLength>=10&&e.getUint32(0,Gc)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Hp),height:e.getUint16(8,Hp)}:null}function Wue(t){const e=Tg(t);return e.byteLength>=14&&e.getUint16(0,Gc)===16973&&e.getUint32(2,Hp)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Hp),height:e.getUint32(22,Hp)}:null}function Jue(t){const e=Tg(t);if(!(e.byteLength>=3&&e.getUint16(0,Gc)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=Xue();let o=2;for(;o+9<e.byteLength;){const s=e.getUint16(o,Gc);if(i.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Gc),width:e.getUint16(o+7,Gc)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,Gc)}return null}function Xue(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Tg(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Kue(t,e){const{mimeType:r}=ty(t)||{},n=globalThis.loaders?.parseImageNode;return ai(n),await n(t,r)}async function que(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=r||{},s=Yue(i);let u;switch(s){case"imagebitmap":u=await Oue(t,e,o);break;case"image":u=await G6(t,e,o);break;case"data":u=await Kue(t);break;default:ai(!1)}return i==="data"&&(u=Lw(u)),u}function Yue(t){switch(t){case"auto":case"data":return Bue();default:return Eue(t),t}}const Zue=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Que=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],efe={image:{type:"auto",decode:!0}},og={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:wue,mimeTypes:Que,extensions:Zue,parse:que,tests:[t=>!!ty(new DataView(t))],options:efe},Rb={};function V6(t){if(Rb[t]===void 0){const e=R6?rfe(t):tfe(t);Rb[t]=e}return Rb[t]}function tfe(t){const e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function rfe(t){switch(t){case"image/avif":case"image/webp":return nfe(t);default:return!0}}function nfe(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const ife={type:"wms",testURL:t=>t.toLowerCase().includes("wms"),create:t=>new sfe(t)};class sfe extends Dw{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e){super(e),this.url=e.url,this.data=e.url,this.substituteCRS84=e.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...e.wmsParameters},this.vendorParameters=e.vendorParameters||{}}async getMetadata(){const e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){const{boundingBox:r,bbox:n,...i}=e,o={bbox:r?[...r[0],...r[1]]:n,...i};return await this.getMap(o)}normalizeMetadata(e){return e}async getCapabilities(e,r){const n=this.getCapabilitiesURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();this._checkResponse(i,o);const s=await Ow.parse(o,this.loadOptions);return this.capabilities=s,s}async getMap(e,r){const n=this.getMapURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();this._checkResponse(i,o);try{return await og.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}async getFeatureInfo(e,r){const n=this.getFeatureInfoURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();return this._checkResponse(i,o),await _ue.parse(o,this.loadOptions)}async getFeatureInfoText(e,r){const n=this.getFeatureInfoURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();return this._checkResponse(i,o),new TextDecoder().decode(o)}async describeLayer(e,r){const n=this.describeLayerURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();return this._checkResponse(i,o),await yue.parse(o,this.loadOptions)}async getLegendGraphic(e,r){const n=this.getLegendGraphicURL(e,r),i=await this.fetch(n),o=await i.arrayBuffer();this._checkResponse(i,o);try{return await og.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}getCapabilitiesURL(e,r){const n={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",n,r)}getMapURL(e,r){e=this._getWMS130Parameters(e);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",n,r)}getFeatureInfoURL(e,r){e=this._getWMS130Parameters(e);const{boundingBox:n,bbox:i}=e;e.bbox=n?[...n[0],...n[1]]:i;const o={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",o,r)}describeLayerURL(e,r){const n={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",n,r)}getLegendGraphicURL(e,r){const n={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",n,r)}_parseWMSUrl(e){const[r,n]=e.split("?"),i=n.split("&"),o={};for(const s of i){const[u,d]=s.split("=");o[u]=d}return{url:r,parameters:o}}_getWMSUrl(e,r,n){let i=this.url,o=!0;const s={service:"WMS",version:r.version,request:e,...r,...this.vendorParameters,...n},u=["transparent","time","elevation"];for(const[d,y]of Object.entries(s))(!u.includes(d)||y)&&(i+=o?"?":"&",o=!1,i+=this._getURLParameter(d,y,r));return encodeURI(i)}_getWMS130Parameters(e){const r={...e};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(e,r,n){switch(e){case"crs":n.version!=="1.3.0"?e="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":n.version==="1.3.0"&&(e="crs");break;case"bbox":const i=this._flipBoundingBox(r,n);i&&(r=i);break;case"x":n.version==="1.3.0"&&(e="i");break;case"y":n.version==="1.3.0"&&(e="j");break}return e=e.toUpperCase(),Array.isArray(r)?`${e}=${r.join(",")}`:`${e}=${r?String(r):""}`}_flipBoundingBox(e,r){if(!Array.isArray(e)||e.length!==4)return null;const n=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),i=e;return n?[i[1],i[0],i[3],i[2]]:i}async _fetchArrayBuffer(e){const r=await this.fetch(e),n=await r.arrayBuffer();return this._checkResponse(r,n),n}_checkResponse(e,r){const n=e.headers["content-type"];if(!e.ok||Tm.mimeTypes.includes(n)){const i=Ole(this.loadOptions,{wms:{throwOnError:!0}}),o=Tm.parseSync?.(r,i);throw new Error(o)}}_parseError(e){const r=Tm.parseSync?.(e,this.loadOptions);return new Error(r)}}class ofe extends Dw{static type="template";static testURL=e=>e.toLowerCase().includes("{");constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){const r=this.getGranularParameters(e),n=this.getURLFromTemplate(r),o=await(await this.fetch(n)).arrayBuffer();return await og.parse(o)}getGranularParameters(e){const[[r,n],[i,o]]=e.boundingBox;return{...e,east:r,north:n,south:o,west:i}}getURLFromTemplate(e){let r=this.props.url;for(const[n,i]of Object.entries(e))r=r.replace(`\${${n}}`,String(i)),r=r.replace(`{${n}}`,String(i));return r}}class afe extends ofe{data;constructor(e){super(e),this.data=e.url}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.props.url}?f=pjson`}exportImageURL(e){const r=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,n=`size=${e.width},${e.height}`,i={...e,bbox:r,size:n};return delete i.width,delete i.height,this.getUrl("exportImage",i)}getUrl(e,r,n){let i=`${this.props.url}/${e}`,o=!0;for(const[s,u]of Object.entries(r))i+=o?"?":"&",o=!1,Array.isArray(u)?i+=`${s.toUpperCase()}=${u.join(",")}`:i+=`${s.toUpperCase()}=${u?String(u):""}`;return i}async checkResponse(e){if(!e.ok)throw new Error("error")}}const cfe={type:"arcgis-image-server",testURL:t=>t.toLowerCase().includes("ImageServer"),create:t=>new afe(t)},lfe=[ife,cfe];function ufe(t){return vue(t,lfe)}const XM=6378137*Math.PI;function KM(t){const e=Rl(t);return e[0]=(e[0]/256-1)*XM,e[1]=(e[1]/256-1)*XM,e}const ffe={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}};class kw extends gs{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:r,oldProps:n}){const{viewport:i}=this.context;e.dataChanged||r.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(i,"image source changed"),0)):Ji(r.layers,n.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(i,"viewport changed")):this.debounce(()=>this.loadImage(i,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:e,image:r,lastRequestParameters:n}=this.state;return r&&new Y_({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?Xr.LNGLAT:Xr.CARTESIAN,bounds:e,image:r})}async getFeatureInfoText(e,r){const{lastRequestParameters:n}=this.state;return n?await this.state.imageSource.getFeatureInfoText?.({...n,query_layers:n.layers,x:e,y:r,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(e){if(e.data instanceof Dw)return e.data;if(typeof e.data=="string")return ufe({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:e}=this.state;try{this.state.loadCounter++;const r=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(r)}catch(r){this.getCurrentLayer()?.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(e,r){const{layers:n,serviceType:i}=this.props;if(i==="wms"&&n.length===0)return;const o=e.getBounds(),{width:s,height:u}=e,d=this.getRequestId();let{srs:y}=this.props;y==="auto"&&(y=e.resolution?"EPSG:4326":"EPSG:3857");const x={width:s,height:u,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:n,crs:y};if(y==="EPSG:3857"){const E=KM([o[0],o[1]]),S=KM([o[2],o[3]]);x.boundingBox=[E,S]}try{this.state.loadCounter++,this.props.onImageLoadStart(d);const E=await this.state.imageSource.getImage(x);this.state.lastRequestId<d&&(this.getCurrentLayer()?.props.onImageLoad(d),this.setState({image:E,bounds:o,lastRequestParameters:x,lastRequestId:d}))}catch(E){this.raiseError(E,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(d,E)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),r)}}kw.layerName="WMSLayer";kw.defaultProps=ffe;const hfe={getHeight:{type:"accessor",value:0},greatCircle:!0};class Uw extends yg{}Uw.layerName="GreatCircleLayer";Uw.defaultProps=hfe;const dfe={...Vu.defaultProps};class Hu extends gs{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:r,wireframe:n,filled:i,stroked:o,lineWidthUnits:s,lineWidthScale:u,lineWidthMinPixels:d,lineWidthMaxPixels:y,lineJointRounded:x,lineMiterLimit:E,lineDashJustified:S,getElevation:O,getFillColor:k,getLineColor:U,getLineWidth:J}=this.props,{updateTriggers:G,material:H,transitions:K}=this.props,he=this.getSubLayerClass("cell",Vu),{updateTriggers:Y,...oe}=this.indexToBounds()||{};return new he({filled:i,wireframe:n,extruded:r,elevationScale:e,stroked:o,lineWidthUnits:s,lineWidthScale:u,lineWidthMinPixels:d,lineWidthMaxPixels:y,lineJointRounded:x,lineMiterLimit:E,lineDashJustified:S,material:H,transitions:K,getElevation:O,getFillColor:k,getLineColor:U,getLineWidth:J},this.getSubLayerProps({id:"cell",updateTriggers:G&&{...Y,getElevation:G.getElevation,getFillColor:G.getFillColor,getLineColor:G.getLineColor,getLineWidth:G.getLineWidth}}),oe)}}Hu.layerName="GeoCellLayer";Hu.defaultProps=dfe;function Afe(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Em={exports:{}},pfe=Em.exports,qM;function gfe(){return qM||(qM=1,function(t){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(e,r){typeof Afe=="function"&&t&&t.exports?t.exports=r():(e.dcodeIO=e.dcodeIO||{}).Long=r()})(pfe,function(){function e(ve,Ae,$){this.low=ve|0,this.high=Ae|0,this.unsigned=!!$}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function r(ve){return(ve&&ve.__isLong__)===!0}e.isLong=r;var n={},i={};function o(ve,Ae){var $,re,Te;return Ae?(ve>>>=0,(Te=0<=ve&&ve<256)&&(re=i[ve],re)?re:($=u(ve,(ve|0)<0?-1:0,!0),Te&&(i[ve]=$),$)):(ve|=0,(Te=-128<=ve&&ve<128)&&(re=n[ve],re)?re:($=u(ve,ve<0?-1:0,!1),Te&&(n[ve]=$),$))}e.fromInt=o;function s(ve,Ae){if(isNaN(ve)||!isFinite(ve))return Ae?H:G;if(Ae){if(ve<0)return H;if(ve>=k)return Ee}else{if(ve<=-U)return ze;if(ve+1>=U)return oe}return ve<0?s(-ve,Ae).neg():u(ve%O|0,ve/O|0,Ae)}e.fromNumber=s;function u(ve,Ae,$){return new e(ve,Ae,$)}e.fromBits=u;var d=Math.pow;function y(ve,Ae,$){if(ve.length===0)throw Error("empty string");if(ve==="NaN"||ve==="Infinity"||ve==="+Infinity"||ve==="-Infinity")return G;if(typeof Ae=="number"?($=Ae,Ae=!1):Ae=!!Ae,$=$||10,$<2||36<$)throw RangeError("radix");var re;if((re=ve.indexOf("-"))>0)throw Error("interior hyphen");if(re===0)return y(ve.substring(1),Ae,$).neg();for(var Te=s(d($,8)),Qe=G,me=0;me<ve.length;me+=8){var Le=Math.min(8,ve.length-me),Ue=parseInt(ve.substring(me,me+Le),$);if(Le<8){var Ye=s(d($,Le));Qe=Qe.mul(Ye).add(s(Ue))}else Qe=Qe.mul(Te),Qe=Qe.add(s(Ue))}return Qe.unsigned=Ae,Qe}e.fromString=y;function x(ve){return ve instanceof e?ve:typeof ve=="number"?s(ve):typeof ve=="string"?y(ve):u(ve.low,ve.high,ve.unsigned)}e.fromValue=x;var E=65536,S=1<<24,O=E*E,k=O*O,U=k/2,J=o(S),G=o(0);e.ZERO=G;var H=o(0,!0);e.UZERO=H;var K=o(1);e.ONE=K;var he=o(1,!0);e.UONE=he;var Y=o(-1);e.NEG_ONE=Y;var oe=u(-1,2147483647,!1);e.MAX_VALUE=oe;var Ee=u(-1,-1,!0);e.MAX_UNSIGNED_VALUE=Ee;var ze=u(0,-2147483648,!1);e.MIN_VALUE=ze;var de=e.prototype;return de.toInt=function(){return this.unsigned?this.low>>>0:this.low},de.toNumber=function(){return this.unsigned?(this.high>>>0)*O+(this.low>>>0):this.high*O+(this.low>>>0)},de.toString=function(Ae){if(Ae=Ae||10,Ae<2||36<Ae)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ze)){var $=s(Ae),re=this.div($),Te=re.mul($).sub(this);return re.toString(Ae)+Te.toInt().toString(Ae)}else return"-"+this.neg().toString(Ae);for(var Qe=s(d(Ae,6),this.unsigned),me=this,Le="";;){var Ue=me.div(Qe),Ye=me.sub(Ue.mul(Qe)).toInt()>>>0,et=Ye.toString(Ae);if(me=Ue,me.isZero())return et+Le;for(;et.length<6;)et="0"+et;Le=""+et+Le}},de.getHighBits=function(){return this.high},de.getHighBitsUnsigned=function(){return this.high>>>0},de.getLowBits=function(){return this.low},de.getLowBitsUnsigned=function(){return this.low>>>0},de.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ze)?64:this.neg().getNumBitsAbs();for(var Ae=this.high!=0?this.high:this.low,$=31;$>0&&(Ae&1<<$)==0;$--);return this.high!=0?$+33:$+1},de.isZero=function(){return this.high===0&&this.low===0},de.isNegative=function(){return!this.unsigned&&this.high<0},de.isPositive=function(){return this.unsigned||this.high>=0},de.isOdd=function(){return(this.low&1)===1},de.isEven=function(){return(this.low&1)===0},de.equals=function(Ae){return r(Ae)||(Ae=x(Ae)),this.unsigned!==Ae.unsigned&&this.high>>>31===1&&Ae.high>>>31===1?!1:this.high===Ae.high&&this.low===Ae.low},de.eq=de.equals,de.notEquals=function(Ae){return!this.eq(Ae)},de.neq=de.notEquals,de.lessThan=function(Ae){return this.comp(Ae)<0},de.lt=de.lessThan,de.lessThanOrEqual=function(Ae){return this.comp(Ae)<=0},de.lte=de.lessThanOrEqual,de.greaterThan=function(Ae){return this.comp(Ae)>0},de.gt=de.greaterThan,de.greaterThanOrEqual=function(Ae){return this.comp(Ae)>=0},de.gte=de.greaterThanOrEqual,de.compare=function(Ae){if(r(Ae)||(Ae=x(Ae)),this.eq(Ae))return 0;var $=this.isNegative(),re=Ae.isNegative();return $&&!re?-1:!$&&re?1:this.unsigned?Ae.high>>>0>this.high>>>0||Ae.high===this.high&&Ae.low>>>0>this.low>>>0?-1:1:this.sub(Ae).isNegative()?-1:1},de.comp=de.compare,de.negate=function(){return!this.unsigned&&this.eq(ze)?ze:this.not().add(K)},de.neg=de.negate,de.add=function(Ae){r(Ae)||(Ae=x(Ae));var $=this.high>>>16,re=this.high&65535,Te=this.low>>>16,Qe=this.low&65535,me=Ae.high>>>16,Le=Ae.high&65535,Ue=Ae.low>>>16,Ye=Ae.low&65535,et=0,tt=0,ct=0,mt=0;return mt+=Qe+Ye,ct+=mt>>>16,mt&=65535,ct+=Te+Ue,tt+=ct>>>16,ct&=65535,tt+=re+Le,et+=tt>>>16,tt&=65535,et+=$+me,et&=65535,u(ct<<16|mt,et<<16|tt,this.unsigned)},de.subtract=function(Ae){return r(Ae)||(Ae=x(Ae)),this.add(Ae.neg())},de.sub=de.subtract,de.multiply=function(Ae){if(this.isZero()||(r(Ae)||(Ae=x(Ae)),Ae.isZero()))return G;if(this.eq(ze))return Ae.isOdd()?ze:G;if(Ae.eq(ze))return this.isOdd()?ze:G;if(this.isNegative())return Ae.isNegative()?this.neg().mul(Ae.neg()):this.neg().mul(Ae).neg();if(Ae.isNegative())return this.mul(Ae.neg()).neg();if(this.lt(J)&&Ae.lt(J))return s(this.toNumber()*Ae.toNumber(),this.unsigned);var $=this.high>>>16,re=this.high&65535,Te=this.low>>>16,Qe=this.low&65535,me=Ae.high>>>16,Le=Ae.high&65535,Ue=Ae.low>>>16,Ye=Ae.low&65535,et=0,tt=0,ct=0,mt=0;return mt+=Qe*Ye,ct+=mt>>>16,mt&=65535,ct+=Te*Ye,tt+=ct>>>16,ct&=65535,ct+=Qe*Ue,tt+=ct>>>16,ct&=65535,tt+=re*Ye,et+=tt>>>16,tt&=65535,tt+=Te*Ue,et+=tt>>>16,tt&=65535,tt+=Qe*Le,et+=tt>>>16,tt&=65535,et+=$*Ye+re*Ue+Te*Le+Qe*me,et&=65535,u(ct<<16|mt,et<<16|tt,this.unsigned)},de.mul=de.multiply,de.divide=function(Ae){if(r(Ae)||(Ae=x(Ae)),Ae.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?H:G;var $,re,Te;if(this.unsigned){if(Ae.unsigned||(Ae=Ae.toUnsigned()),Ae.gt(this))return H;if(Ae.gt(this.shru(1)))return he;Te=H}else{if(this.eq(ze)){if(Ae.eq(K)||Ae.eq(Y))return ze;if(Ae.eq(ze))return K;var Qe=this.shr(1);return $=Qe.div(Ae).shl(1),$.eq(G)?Ae.isNegative()?K:Y:(re=this.sub(Ae.mul($)),Te=$.add(re.div(Ae)),Te)}else if(Ae.eq(ze))return this.unsigned?H:G;if(this.isNegative())return Ae.isNegative()?this.neg().div(Ae.neg()):this.neg().div(Ae).neg();if(Ae.isNegative())return this.div(Ae.neg()).neg();Te=G}for(re=this;re.gte(Ae);){$=Math.max(1,Math.floor(re.toNumber()/Ae.toNumber()));for(var me=Math.ceil(Math.log($)/Math.LN2),Le=me<=48?1:d(2,me-48),Ue=s($),Ye=Ue.mul(Ae);Ye.isNegative()||Ye.gt(re);)$-=Le,Ue=s($,this.unsigned),Ye=Ue.mul(Ae);Ue.isZero()&&(Ue=K),Te=Te.add(Ue),re=re.sub(Ye)}return Te},de.div=de.divide,de.modulo=function(Ae){return r(Ae)||(Ae=x(Ae)),this.sub(this.div(Ae).mul(Ae))},de.mod=de.modulo,de.not=function(){return u(~this.low,~this.high,this.unsigned)},de.and=function(Ae){return r(Ae)||(Ae=x(Ae)),u(this.low&Ae.low,this.high&Ae.high,this.unsigned)},de.or=function(Ae){return r(Ae)||(Ae=x(Ae)),u(this.low|Ae.low,this.high|Ae.high,this.unsigned)},de.xor=function(Ae){return r(Ae)||(Ae=x(Ae)),u(this.low^Ae.low,this.high^Ae.high,this.unsigned)},de.shiftLeft=function(Ae){return r(Ae)&&(Ae=Ae.toInt()),(Ae&=63)===0?this:Ae<32?u(this.low<<Ae,this.high<<Ae|this.low>>>32-Ae,this.unsigned):u(0,this.low<<Ae-32,this.unsigned)},de.shl=de.shiftLeft,de.shiftRight=function(Ae){return r(Ae)&&(Ae=Ae.toInt()),(Ae&=63)===0?this:Ae<32?u(this.low>>>Ae|this.high<<32-Ae,this.high>>Ae,this.unsigned):u(this.high>>Ae-32,this.high>=0?0:-1,this.unsigned)},de.shr=de.shiftRight,de.shiftRightUnsigned=function(Ae){if(r(Ae)&&(Ae=Ae.toInt()),Ae&=63,Ae===0)return this;var $=this.high;if(Ae<32){var re=this.low;return u(re>>>Ae|$<<32-Ae,$>>>Ae,this.unsigned)}else return Ae===32?u($,0,this.unsigned):u($>>>Ae-32,0,this.unsigned)},de.shru=de.shiftRightUnsigned,de.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},de.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},de.toBytes=function(ve){return ve?this.toBytesLE():this.toBytesBE()},de.toBytesLE=function(){var ve=this.high,Ae=this.low;return[Ae&255,Ae>>>8&255,Ae>>>16&255,Ae>>>24&255,ve&255,ve>>>8&255,ve>>>16&255,ve>>>24&255]},de.toBytesBE=function(){var ve=this.high,Ae=this.low;return[ve>>>24&255,ve>>>16&255,ve>>>8&255,ve&255,Ae>>>24&255,Ae>>>16&255,Ae>>>8&255,Ae&255]},e})}(Em)),Em.exports}var mfe=gfe();const Bm=Kf(mfe),_fe=3,yfe=30,vfe=2*yfe+1,YM=180/Math.PI;function bfe(t,e,r){const n=1<<e;return[(t[0]+r[0])/n,(t[1]+r[1])/n]}function ZM(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function xfe(t){return[ZM(t[0]),ZM(t[1])]}function wfe(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function Cfe([t,e,r]){const n=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*YM,n*YM]}function Tfe(t){let e=Bm.fromString(t,!0,10).toString(2);for(;e.length<_fe+vfe;)e="0"+e;const r=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,r),o=i.length/2,s=Bm.fromString(n,!0,2).toString(10);let u=Bm.fromString(i,!0,2).toString(4);for(;u.length<o;)u="0"+u;return`${s}/${u}`}function Efe(t,e,r,n){if(n===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function Bfe(t){const e=t.split("/"),r=parseInt(e[0],10),n=e[1],i=n.length,o=[0,0];let s;for(let u=i-1;u>=0;u--){s=i-u;const d=n[u];let y=0,x=0;d==="1"?x=1:d==="2"?(y=1,x=1):d==="3"&&(y=1);const E=Math.pow(2,s-1);Efe(E,o,y,x),o[0]+=E*y,o[1]+=E*x}if(r%2===1){const u=o[0];o[0]=o[1],o[1]=u}return{face:r,ij:o,level:s}}function Sfe(t){const e=t.padEnd(16,"0");return Bm.fromString(e,16)}const Ife=100;function Mfe({face:t,ij:e,level:r}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(Ife*Math.pow(2,-r))),o=new Float64Array(4*i*2+2);let s=0,u=0;for(let d=0;d<4;d++){const y=n[d].slice(0),x=n[d+1],E=(x[0]-y[0])/i,S=(x[1]-y[1])/i;for(let O=0;O<i;O++){y[0]+=E,y[1]+=S;const k=bfe(e,r,y),U=xfe(k),J=wfe(t,U),G=Cfe(J);Math.abs(G[1])>89.999&&(G[0]=u);const H=G[0]-u;G[0]+=H>180?-360:H<-180?360:0,o[s++]=G[0],o[s++]=G[1],u=G[0]}}return o[s++]=o[0],o[s++]=o[1],o}function Pfe(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=Sfe(t)}return Tfe(t.toString())}function Rfe(t){const e=Pfe(t),r=Bfe(e);return Mfe(r)}const Ffe={getS2Token:{type:"accessor",value:t=>t.token}};class ry extends Hu{indexToBounds(){const{data:e,getS2Token:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>Rfe(r(n,i))}}}ry.layerName="S2Layer";ry.defaultProps=Ffe;const Fb=512;function Dfe(t,e){let r=0,n=0,i=1<<t.length;const o=i/Fb;for(let s=0;s<t.length;s++){i>>=1;const u=parseInt(t[s]);u%2&&(r|=i),u>1&&(n|=i)}return[[r/o,Fb-n/o],[(r+e)/o,Fb-(n+e)/o]]}function Ofe(t,e=1){const[r,n]=Dfe(t,e),[i,o]=Wc(r),[s,u]=Wc(n);return[s,o,s,u,i,u,i,o,s,o]}const Lfe={getQuadkey:{type:"accessor",value:t=>t.quadkey}};class ny extends Hu{indexToBounds(){const{data:e,extruded:r,getQuadkey:n}=this.props,i=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>Ofe(n(o,s),i),updateTriggers:{getPolygon:i}}}}ny.layerName="QuadkeyLayer";ny.defaultProps=Lfe;class H6{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:r,onLoad:n,onError:i}){const{index:o,id:s,bbox:u,userData:d,zoom:y}=this,x=this._loaderId;this._abortController=new AbortController;const{signal:E}=this._abortController,S=await r.scheduleRequest(this,U=>U.isSelected?1:-1);if(!S){this._isCancelled=!0;return}if(this._isCancelled){S.done();return}let O=null,k;try{O=await e({index:o,id:s,bbox:u,userData:d,zoom:y,signal:E})}catch(U){k=U||!0}finally{S.done()}if(x===this._loaderId){if(this._loader=void 0,this.content=O,this._isCancelled&&!O){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,k?i(k,this):n(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const ro={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},QM=new ut,Nfe=new ut;class zw{constructor(e=[0,0,0],r=[0,0,0],n){n=n||QM.copy(e).add(r).scale(.5),this.center=new ut(n),this.halfDiagonal=new ut(r).subtract(this.center),this.minimum=new ut(e),this.maximum=new ut(r)}clone(){return new zw(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:r}=this,n=Nfe.from(e.normal),i=r.x*Math.abs(n.x)+r.y*Math.abs(n.y)+r.z*Math.abs(n.z),o=this.center.dot(n)+e.distance;return o-i>0?ro.INSIDE:o+i<0?ro.OUTSIDE:ro.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=QM.from(e).subtract(this.center),{halfDiagonal:n}=this;let i=0,o;return o=Math.abs(r.x)-n.x,o>0&&(i+=o*o),o=Math.abs(r.y)-n.y,o>0&&(i+=o*o),o=Math.abs(r.z)-n.z,o>0&&(i+=o*o),i}}const Ap=new ut,eP=new ut;class Eg{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new ut,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=Ap.from(r),this.center=new ut().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Eg(this.center,this.radius)}union(e){const r=this.center,n=this.radius,i=e.center,o=e.radius,s=Ap.copy(i).subtract(r),u=s.magnitude();if(n>=u+o)return this.clone();if(o>=u+n)return e.clone();const d=(n+u+o)*.5;return eP.copy(s).scale((-n+d)/u).add(r),this.center.copy(eP),this.radius=d,this}expand(e){const n=Ap.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const r=aH(Ap,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){const r=this.distanceTo(e);return r*r}distanceTo(e){const n=Ap.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const r=this.center,n=this.radius,o=e.normal.dot(r)+e.distance;return o<-n?ro.OUTSIDE:o<n?ro.INTERSECTING:ro.INSIDE}}const kfe=new ut,Ufe=new ut,V0=new ut,H0=new ut,j0=new ut,zfe=new ut,Gfe=new ut,wl={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Bg{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new ut().from(e),this.halfAxes=new ci(r)}get halfSize(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new ut(e).len(),new ut(r).len(),new ut(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new ut(e).normalize(),o=new ut(r).normalize(),s=new ut(n).normalize();return new Kp().fromMatrix3(new ci([...i,...o,...s]))}fromCenterHalfSizeQuaternion(e,r,n){const i=new Kp(n),o=new ci().fromQuaternion(i);return o[0]=o[0]*r[0],o[1]=o[1]*r[0],o[2]=o[2]*r[0],o[3]=o[3]*r[1],o[4]=o[4]*r[1],o[5]=o[5]*r[1],o[6]=o[6]*r[2],o[7]=o[7]*r[2],o[8]=o[8]*r[2],this.center=new ut().from(e),this.halfAxes=o,this}clone(){return new Bg(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Eg){const r=this.halfAxes,n=r.getColumn(0,V0),i=r.getColumn(1,H0),o=r.getColumn(2,j0),s=kfe.copy(n).add(i).add(o);return e.center.copy(this.center),e.radius=s.magnitude(),e}intersectPlane(e){const r=this.center,n=e.normal,i=this.halfAxes,o=n.x,s=n.y,u=n.z,d=Math.abs(o*i[wl.COLUMN0ROW0]+s*i[wl.COLUMN0ROW1]+u*i[wl.COLUMN0ROW2])+Math.abs(o*i[wl.COLUMN1ROW0]+s*i[wl.COLUMN1ROW1]+u*i[wl.COLUMN1ROW2])+Math.abs(o*i[wl.COLUMN2ROW0]+s*i[wl.COLUMN2ROW1]+u*i[wl.COLUMN2ROW2]),y=n.dot(r)+e.distance;return y<=-d?ro.OUTSIDE:y>=d?ro.INSIDE:ro.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const r=Ufe.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,V0),o=n.getColumn(1,H0),s=n.getColumn(2,j0),u=i.magnitude(),d=o.magnitude(),y=s.magnitude();i.normalize(),o.normalize(),s.normalize();let x=0,E;return E=Math.abs(r.dot(i))-u,E>0&&(x+=E*E),E=Math.abs(r.dot(o))-d,E>0&&(x+=E*E),E=Math.abs(r.dot(s))-y,E>0&&(x+=E*E),x}computePlaneDistances(e,r,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const s=this.center,u=this.halfAxes,d=u.getColumn(0,V0),y=u.getColumn(1,H0),x=u.getColumn(2,j0),E=zfe.copy(d).add(y).add(x).add(s),S=Gfe.copy(E).subtract(e);let O=r.dot(S);return i=Math.min(O,i),o=Math.max(O,o),E.copy(s).add(d).add(y).subtract(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),E.copy(s).add(d).subtract(y).add(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),E.copy(s).add(d).subtract(y).subtract(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),s.copy(E).subtract(d).add(y).add(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),s.copy(E).subtract(d).add(y).subtract(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),s.copy(E).subtract(d).subtract(y).add(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),s.copy(E).subtract(d).subtract(y).subtract(x),S.copy(E).subtract(e),O=r.dot(S),i=Math.min(O,i),o=Math.max(O,o),n[0]=i,n[1]=o,n}transform(e){this.center.transformAsPoint(e);const r=this.halfAxes.getColumn(0,V0);r.transformAsPoint(e);const n=this.halfAxes.getColumn(1,H0);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,j0);return i.transformAsPoint(e),this.halfAxes=new ci([...r,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const tP=new ut,rP=new ut;class Ya{constructor(e=[0,0,1],r=0){this.normal=new ut,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return Za(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=tP.from(e),this.normal.from(r).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,r,n,i){return this.normal.set(e,r,n),Za(ra(this.normal.len(),1)),this.distance=i,this}clone(){return new Ya(this.normal,this.distance)}equals(e){return ra(this.distance,e.distance)&&ra(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const r=rP.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,r)}projectPointOntoPlane(e,r=[0,0,0]){const n=tP.from(e),i=this.getPointDistance(n),o=rP.copy(this.normal).scale(i);return n.subtract(o).to(r)}}const nP=[new ut([1,0,0]),new ut([0,1,0]),new ut([0,0,1])],iP=new ut,Vfe=new ut;class Qo{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*nP.length;const r=e.center,n=e.radius;let i=0;for(const o of nP){let s=this.planes[i],u=this.planes[i+1];s||(s=this.planes[i]=new Ya),u||(u=this.planes[i+1]=new Ya);const d=iP.copy(o).scale(-n).add(r);s.fromPointNormal(d,o);const y=iP.copy(o).scale(n).add(r),x=Vfe.copy(o).negate();u.fromPointNormal(y,x),i+=2}return this}computeVisibility(e){let r=ro.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case ro.OUTSIDE:return ro.OUTSIDE;case ro.INTERSECTING:r=ro.INTERSECTING;break}return r}computeVisibilityWithPlaneMask(e,r){if(Za(Number.isFinite(r),"parentPlaneMask is required."),r===Qo.MASK_OUTSIDE||r===Qo.MASK_INSIDE)return r;let n=Qo.MASK_INSIDE;const i=this.planes;for(let o=0;o<this.planes.length;++o){const s=o<31?1<<o:0;if(o<31&&(r&s)===0)continue;const u=i[o],d=e.intersectPlane(u);if(d===ro.OUTSIDE)return Qo.MASK_OUTSIDE;d===ro.INTERSECTING&&(n|=s)}return n}}Qo.MASK_OUTSIDE=4294967295;Qo.MASK_INSIDE=0;Qo.MASK_INDETERMINATE=2147483647;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;new ut;const kc=new ci,Hfe=new ci,jfe=new ci,$0=new ci,sP=new ci;function $fe(t,e={}){const r=WH,n=10;let i=0,o=0;const s=Hfe,u=jfe;s.identity(),u.copy(t);const d=r*Wfe(u);for(;o<n&&Jfe(u)>d;)Xfe(u,$0),sP.copy($0).transpose(),u.multiplyRight($0),u.multiplyLeft(sP),s.multiplyRight($0),++i>2&&(++o,i=0);return e.unitary=s.toTarget(e.unitary),e.diagonal=u.toTarget(e.diagonal),e}function Wfe(t){let e=0;for(let r=0;r<9;++r){const n=t[r];e+=n*n}return Math.sqrt(e)}const N2=[1,0,0],k2=[2,2,1];function Jfe(t){let e=0;for(let r=0;r<3;++r){const n=t[kc.getElementIndex(k2[r],N2[r])];e+=2*n*n}return Math.sqrt(e)}function Xfe(t,e){const r=RO;let n=0,i=1;for(let y=0;y<3;++y){const x=Math.abs(t[kc.getElementIndex(k2[y],N2[y])]);x>n&&(i=y,n=x)}const o=N2[i],s=k2[i];let u=1,d=0;if(Math.abs(t[kc.getElementIndex(s,o)])>r){const y=t[kc.getElementIndex(s,s)],x=t[kc.getElementIndex(o,o)],E=t[kc.getElementIndex(s,o)],S=(y-x)/2/E;let O;S<0?O=-1/(-S+Math.sqrt(1+S*S)):O=1/(S+Math.sqrt(1+S*S)),u=1/Math.sqrt(1+O*O),d=O*u}return ci.IDENTITY.to(e),e[kc.getElementIndex(o,o)]=e[kc.getElementIndex(s,s)]=u,e[kc.getElementIndex(s,o)]=d,e[kc.getElementIndex(o,s)]=-d,e}const mu=new ut,Kfe=new ut,qfe=new ut,Yfe=new ut,Zfe=new ut,Qfe=new ci,ehe={diagonal:new ci,unitary:new ci};function j6(t,e=new Bg){if(!t||t.length===0)return e.halfAxes=new ci([0,0,0,0,0,0,0,0,0]),e.center=new ut,e;const r=t.length,n=new ut(0,0,0);for(const de of t)n.add(de);const i=1/r;n.multiplyByScalar(i);let o=0,s=0,u=0,d=0,y=0,x=0;for(const de of t){const ve=mu.copy(de).subtract(n);o+=ve.x*ve.x,s+=ve.x*ve.y,u+=ve.x*ve.z,d+=ve.y*ve.y,y+=ve.y*ve.z,x+=ve.z*ve.z}o*=i,s*=i,u*=i,d*=i,y*=i,x*=i;const E=Qfe;E[0]=o,E[1]=s,E[2]=u,E[3]=s,E[4]=d,E[5]=y,E[6]=u,E[7]=y,E[8]=x;const{unitary:S}=$fe(E,ehe),O=e.halfAxes.copy(S);let k=O.getColumn(0,qfe),U=O.getColumn(1,Yfe),J=O.getColumn(2,Zfe),G=-Number.MAX_VALUE,H=-Number.MAX_VALUE,K=-Number.MAX_VALUE,he=Number.MAX_VALUE,Y=Number.MAX_VALUE,oe=Number.MAX_VALUE;for(const de of t)mu.copy(de),G=Math.max(mu.dot(k),G),H=Math.max(mu.dot(U),H),K=Math.max(mu.dot(J),K),he=Math.min(mu.dot(k),he),Y=Math.min(mu.dot(U),Y),oe=Math.min(mu.dot(J),oe);k=k.multiplyByScalar(.5*(he+G)),U=U.multiplyByScalar(.5*(Y+H)),J=J.multiplyByScalar(.5*(oe+K)),e.center.copy(k).add(U).add(J);const Ee=Kfe.set(G-he,H-Y,K-oe).multiplyByScalar(.5),ze=new ci([Ee[0],0,0,0,Ee[1],0,0,0,Ee[2]]);return e.halfAxes.multiplyRight(ze),e}const Hd=512,oP=3,$6=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],W6=$6.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),the=W6.concat([[.25,.5],[.75,.5]]);class jd{constructor(e,r,n){this.x=e,this.y=r,this.z=n}get children(){if(!this._children){const e=this.x*2,r=this.y*2,n=this.z+1;this._children=[new jd(e,r,n),new jd(e,r+1,n),new jd(e+1,r,n),new jd(e+1,r+1,n)]}return this._children}update(e){const{viewport:r,cullingVolume:n,elevationBounds:i,minZ:o,maxZ:s,bounds:u,offset:d,project:y}=e,x=this.getBoundingVolume(i,d,y);if(u&&!this.insideBounds(u)||n.computeVisibility(x)<0)return!1;if(!this.childVisible){let{z:S}=this;if(S<s&&S>=o){const O=x.distanceTo(r.cameraPosition)*r.scale/r.height;S+=Math.floor(Math.log2(O))}if(S>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const S of this.children)S.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const r of this._children)r.getSelected(e);return e}insideBounds([e,r,n,i]){const o=Math.pow(2,this.z),s=Hd/o;return this.x*s<n&&this.y*s<i&&(this.x+1)*s>e&&(this.y+1)*s>r}getBoundingVolume(e,r,n){if(n){const d=this.z<1?the:this.z<2?W6:$6,y=[];for(const x of d){const E=z2(this.x+x[0],this.y+x[1],this.z);E[2]=e[0],y.push(n(E)),e[0]!==e[1]&&(E[2]=e[1],y.push(n(E)))}return j6(y)}const i=Math.pow(2,this.z),o=Hd/i,s=this.x*o+r*Hd,u=Hd-(this.y+1)*o;return new zw([s,u,e[0]],[s+o,u+o,e[1]])}}function rhe(t,e,r,n){const i=t instanceof vY&&t.resolution?t.projectPosition:null,o=Object.values(t.getFrustumPlanes()).map(({normal:O,distance:k})=>new Ya(O.clone().negate(),k)),s=new Qo(o),u=t.distanceScales.unitsPerMeter[2],d=r&&r[0]*u||0,y=r&&r[1]*u||0,x=t instanceof Zp&&t.pitch<=60?e:0;if(n){const[O,k,U,J]=n,G=Rl([O,J]),H=Rl([U,k]);n=[G[0],Hd-G[1],H[0],Hd-H[1]]}const E=new jd(0,0,0),S={viewport:t,project:i,cullingVolume:s,elevationBounds:[d,y],minZ:x,maxZ:e,bounds:n,offset:0};if(E.update(S),t instanceof Zp&&t.subViewports&&t.subViewports.length>1){for(S.offset=-1;E.update(S)&&!(--S.offset<-oP););for(S.offset=1;E.update(S)&&!(++S.offset>oP););}return E.getSelected()}const Fl=512,nhe=[-1/0,-1/0,1/0,1/0],d_={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(r=>typeof r=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}};function J6(t,e){const r=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...r.map(i=>i[0])),Math.min(...r.map(i=>i[1])),Math.max(...r.map(i=>i[0])),Math.max(...r.map(i=>i[1]))]}function ihe(t){return Math.abs(t.split("").reduce((e,r)=>(e<<5)-e+r.charCodeAt(0)|0,0))}function $f(t,e){if(!t||!t.length)return null;const{index:r,id:n}=e;if(Array.isArray(t)){const o=ihe(n)%t.length;t=t[o]}let i=t;for(const o of Object.keys(r)){const s=new RegExp(`{${o}}`,"g");i=i.replace(s,String(r[o]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),i}function she(t,e,r){let n;return n=t.getBounds(),t.isGeospatial?[Math.max(n[0],r[0]),Math.max(n[1],r[1]),Math.min(n[2],r[2]),Math.min(n[3],r[3])]:[Math.max(Math.min(n[0],r[2]),r[0]),Math.max(Math.min(n[1],r[3]),r[1]),Math.min(Math.max(n[2],r[0]),r[2]),Math.min(Math.max(n[3],r[1]),r[3])]}function ohe({viewport:t,z:e,cullRect:r}){return(t.subViewports||[t]).map(i=>U2(i,e||0,r))}function U2(t,e,r){if(!Array.isArray(e)){const o=r.x-t.x,s=r.y-t.y,{width:u,height:d}=r,y={targetZ:e},x=t.unproject([o,s],y),E=t.unproject([o+u,s],y),S=t.unproject([o,s+d],y),O=t.unproject([o+u,s+d],y);return[Math.min(x[0],E[0],S[0],O[0]),Math.min(x[1],E[1],S[1],O[1]),Math.max(x[0],E[0],S[0],O[0]),Math.max(x[1],E[1],S[1],O[1])]}const n=U2(t,e[0],r),i=U2(t,e[1],r);return[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[2],i[2]),Math.max(n[3],i[3])]}function ahe(t,e,r){return r?J6(t,r).map(i=>i*e/Fl):t.map(n=>n*e/Fl)}function Gw(t,e){return Math.pow(2,t)*Fl/e}function z2(t,e,r){const n=Gw(r,Fl),i=t/n*360-180,o=Math.PI-2*Math.PI*e/n,s=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[i,s]}function aP(t,e,r,n){const i=Gw(r,n);return[t/i*Fl,e/i*Fl]}function che(t,e,r,n,i=Fl){if(t.isGeospatial){const[y,x]=z2(e,r,n),[E,S]=z2(e+1,r+1,n);return{west:y,north:x,east:E,south:S}}const[o,s]=aP(e,r,n,i),[u,d]=aP(e+1,r+1,n,i);return{left:o,top:s,right:u,bottom:d}}function lhe(t,e,r,n,i){const o=she(t,null,n),s=Gw(e,r),[u,d,y,x]=ahe(o,s,i),E=[];for(let S=Math.floor(u);S<y;S++)for(let O=Math.floor(d);O<x;O++)E.push({x:S,y:O,z:e});return E}function uhe({viewport:t,maxZoom:e,minZoom:r,zRange:n,extent:i,tileSize:o=Fl,modelMatrix:s,modelMatrixInverse:u,zoomOffset:d=0}){let y=t.isGeospatial?Math.round(t.zoom+Math.log2(Fl/o))+d:Math.ceil(t.zoom)+d;if(typeof r=="number"&&Number.isFinite(r)&&y<r){if(!i)return[];y=r}typeof e=="number"&&Number.isFinite(e)&&y>e&&(y=e);let x=i;return s&&u&&i&&!t.isGeospatial&&(x=J6(i,s)),t.isGeospatial?rhe(t,y,n,i):lhe(t,y,o,x||nhe,u)}function fhe(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function hhe(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function dhe(t){let e={},r;return n=>{for(const i in n)if(!Ahe(n[i],e[i])){r=t(n),e=n;break}return r}}function Ahe(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}const cP=1,iy=2,phe="never",ghe="no-overlap",Vw="best-available",mhe=5,_he={[Vw]:vhe,[ghe]:bhe,[phe]:()=>{}},yhe={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class sy{constructor(e){this._getCullBounds=dhe(ohe),this.opts={...yhe,...e},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new L6({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new An,this._modelMatrixInverse=new An}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const r=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(e):r.setNeedsReload()}}update(e,{zRange:r,modelMatrix:n}={zRange:null,modelMatrix:null}){const i=n?new An(n):new An,o=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!ra(this._zRange,r)||o){o&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=r;const u=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=u.map(d=>this._getTile(d,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(u=>this._getTile(u.index,!0)));const s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(e,r){if(!e.isVisible)return!1;if(r&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:i}=e;for(const[o,s,u,d]of n){let y;if("west"in i)y=i.west<u&&i.east>o&&i.south<d&&i.north>s;else{const x=Math.min(i.top,i.bottom),E=Math.max(i.top,i.bottom);y=i.left<u&&i.right>o&&x<d&&E>s}if(y)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:r,minZoom:n,zRange:i,modelMatrix:o,modelMatrixInverse:s}){const{tileSize:u,extent:d,zoomOffset:y}=this.opts;return uhe({viewport:e,maxZoom:r,minZoom:n,zRange:i,tileSize:u,extent:d,modelMatrix:o,modelMatrixInverse:s,zoomOffset:y})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:r}=this.opts;return{bbox:che(this._viewport,e.x,e.y,e.z,r)}}getParentIndex(e){const r=Math.floor(e.x/2),n=Math.floor(e.y/2),i=e.z-1;return{x:r,y:n,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||Vw,r=new Array(this._cache.size);let n=0;for(const i of this._cache.values())r[n++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:_he[e])(Array.from(this._cache.values())),n=0;for(const i of this._cache.values())if(r[n++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,r=[];let n=0;for(const i of this._cache.values())i.isLoading&&(n++,!i.isSelected&&!i.isVisible&&r.push(i));for(;e>0&&n>e&&r.length>0;)r.shift().abort(),n--}_rebuildTree(){const{_cache:e}=this;for(const r of e.values())r.parent=null,r.children&&(r.children.length=0);for(const r of e.values()){const n=this._getNearestAncestor(r);r.parent=n,n?.children&&n.children.push(r)}}_resizeCache(){const{_cache:e,opts:r}=this,n=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:mhe*this.selectedTiles.length),i=r.maxCacheByteSize??1/0;if(e.size>n||this._cacheByteSize>i){for(const[s,u]of e)if(!u.isVisible&&!u.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?u.byteLength:0,e.delete(s),this.opts.onTileUnload?.(u)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((s,u)=>s.zoom-u.zoom),this._dirty=!1)}_getTile(e,r){const n=this.getTileId(e);let i=this._cache.get(n),o=!1;return!i&&r?(i=new H6(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:n,zoom:this.getTileZoom(i.index)}),o=!0,this._cache.set(n,i),this._dirty=!0):i&&i.needsReload&&(o=!0),i&&o&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:r=0}=this;let n=e.index;for(;this.getTileZoom(n)>r;){n=this.getParentIndex(n);const i=this._getTile(n);if(i)return i}return null}}function vhe(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!X6(e)&&Hw(e);for(const e of t)e.isVisible=!!(e.state&iy)}function bhe(t){for(const r of t)r.state=0;for(const r of t)r.isSelected&&X6(r);const e=Array.from(t).sort((r,n)=>r.zoom-n.zoom);for(const r of e)if(r.isVisible=!!(r.state&iy),r.children&&(r.isVisible||r.state&cP))for(const n of r.children)n.state=cP;else r.isSelected&&Hw(r)}function X6(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=iy,!0;e=e.parent}return!1}function Hw(t){for(const e of t.children)e.isLoaded||e.content?e.state|=iy:Hw(e)}const xhe={TilesetClass:sy,data:{type:"data",value:[]},dataComparator:d_.equal,renderSubLayers:{type:"function",value:t=>new Nl(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Vw,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class Ul extends gs{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:r}=this.state;const n=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);r?n&&(r.setOptions(this._getTilesetOptions()),i?r.reloadAll():r.tiles.forEach(o=>{o.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:r,maxCacheByteSize:n,refinementStrategy:i,extent:o,maxZoom:s,minZoom:u,maxRequests:d,debounceTime:y,zoomOffset:x}=this.props;return{maxCacheSize:r,maxCacheByteSize:n,maxZoom:s,minZoom:u,tileSize:e,refinementStrategy:i,extent:o,maxRequests:d,debounceTime:y,zoomOffset:x,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:r,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:r,modelMatrix:n}),{isLoaded:o}=e,s=this.state.isLoaded!==o,u=this.state.frameNumber!==i;o&&(s||u)&&this._onViewportLoad(),u&&this.setState({frameNumber:i}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:r}=this.props;r&&r(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,r){this.props.onTileError(e),r.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:r,getTileData:n,fetch:i}=this.props,{signal:o}=e;return e.url=typeof r=="string"||Array.isArray(r)?$f(r,e):null,n?n(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const r=e.sourceLayer,n=r.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i.sourceTileSubLayer=r,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const r=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)r&&e.layers[0]&&Object.keys(r).some(n=>e.layers[0].props[n]!==r[n])&&(e.layers=e.layers.map(n=>n.clone(r)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=k_(n,Boolean).map(i=>i.clone({tile:e,...r}))}return e.layers})}filterSubLayer({layer:e,cullRect:r}){const{tile:n}=e.props;return this.state.tileset.isTileVisible(n,r)}}Ul.defaultProps=xhe;Ul.layerName="TileLayer";const lP=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,whe={name:"trips",vs:lP,fs:lP,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},Che={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class oy extends zu{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,whe],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:r,trailLength:n,currentTime:i}=this.props,o={fadeTrail:r,trailLength:n,currentTime:i};this.state.model.shaderInputs.setProps({trips:o}),super.draw(e)}}oy.layerName="TripsLayer";oy.defaultProps=Che;var Fr=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},n;for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);var i="";function o(fe){return e.locateFile?e.locateFile(fe,i):i+fe}var s;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",s=function(be,ae,Be){var p=new XMLHttpRequest;p.open("GET",be,!0),p.responseType="arraybuffer",p.onload=function(){if(p.status==200||p.status==0&&p.response){ae(p.response);return}var yt=It(be);if(yt){ae(yt.buffer);return}Be()},p.onerror=Be,p.send(null)};var u=e.print||console.log.bind(console),d=e.printErr||console.warn.bind(console);for(n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);r=null,e.arguments&&e.arguments;var y=0,x=function(fe){y=fe},E=function(){return y},S=8;function O(fe,be,ae,Be){switch(ae=ae||"i8",ae.charAt(ae.length-1)==="*"&&(ae="i32"),ae){case"i1":$[fe>>0]=be;break;case"i8":$[fe>>0]=be;break;case"i16":Te[fe>>1]=be;break;case"i32":Qe[fe>>2]=be;break;case"i64":$n=[be>>>0,(bn=be,+mr(bn)>=1?bn>0?(Ar(+dr(bn/4294967296),4294967295)|0)>>>0:~~+Ln((bn-+(~~bn>>>0))/4294967296)>>>0:0)],Qe[fe>>2]=$n[0],Qe[fe+4>>2]=$n[1];break;case"float":me[fe>>2]=be;break;case"double":Le[fe>>3]=be;break;default:De("invalid type for setValue: "+ae)}}function k(fe,be,ae){switch(be=be||"i8",be.charAt(be.length-1)==="*"&&(be="i32"),be){case"i1":return $[fe>>0];case"i8":return $[fe>>0];case"i16":return Te[fe>>1];case"i32":return Qe[fe>>2];case"i64":return Qe[fe>>2];case"float":return me[fe>>2];case"double":return Le[fe>>3];default:De("invalid type for getValue: "+be)}return null}var U=!1;function J(fe,be){fe||De("Assertion failed: "+be)}function G(fe){var be=e["_"+fe];return J(be,"Cannot call unknown function "+fe+", make sure it is exported"),be}function H(fe,be,ae,Be,p){var ce={string:function(Bt){var Ut=0;if(Bt!=null&&Bt!==0){var Dr=(Bt.length<<2)+1;Ut=_t(Dr),ze(Bt,Ut,Dr)}return Ut},array:function(Bt){var Ut=_t(Bt.length);return de(Bt,Ut),Ut}};function yt(Bt){return be==="string"?oe(Bt):be==="boolean"?!!Bt:Bt}var Xe=G(fe),wt=[],St=0;if(Be)for(var Rt=0;Rt<Be.length;Rt++){var lt=ce[ae[Rt]];lt?(St===0&&(St=Ce()),wt[Rt]=lt(Be[Rt])):wt[Rt]=Be[Rt]}var Ft=Xe.apply(null,wt);return Ft=yt(Ft),St!==0&&Ct(St),Ft}function K(fe,be,ae,Be){ae=ae||[];var p=ae.every(function(yt){return yt==="number"}),ce=be!=="string";return ce&&p&&!Be?G(fe):function(){return H(fe,be,ae,arguments)}}var he=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Y(fe,be,ae){for(var Be=be+ae,p=be;fe[p]&&!(p>=Be);)++p;if(p-be>16&&fe.subarray&&he)return he.decode(fe.subarray(be,p));for(var ce="";be<p;){var yt=fe[be++];if(!(yt&128)){ce+=String.fromCharCode(yt);continue}var Xe=fe[be++]&63;if((yt&224)==192){ce+=String.fromCharCode((yt&31)<<6|Xe);continue}var wt=fe[be++]&63;if((yt&240)==224?yt=(yt&15)<<12|Xe<<6|wt:yt=(yt&7)<<18|Xe<<12|wt<<6|fe[be++]&63,yt<65536)ce+=String.fromCharCode(yt);else{var St=yt-65536;ce+=String.fromCharCode(55296|St>>10,56320|St&1023)}}return ce}function oe(fe,be){return fe?Y(re,fe,be):""}function Ee(fe,be,ae,Be){if(!(Be>0))return 0;for(var p=ae,ce=ae+Be-1,yt=0;yt<fe.length;++yt){var Xe=fe.charCodeAt(yt);if(Xe>=55296&&Xe<=57343){var wt=fe.charCodeAt(++yt);Xe=65536+((Xe&1023)<<10)|wt&1023}if(Xe<=127){if(ae>=ce)break;be[ae++]=Xe}else if(Xe<=2047){if(ae+1>=ce)break;be[ae++]=192|Xe>>6,be[ae++]=128|Xe&63}else if(Xe<=65535){if(ae+2>=ce)break;be[ae++]=224|Xe>>12,be[ae++]=128|Xe>>6&63,be[ae++]=128|Xe&63}else{if(ae+3>=ce)break;be[ae++]=240|Xe>>18,be[ae++]=128|Xe>>12&63,be[ae++]=128|Xe>>6&63,be[ae++]=128|Xe&63}}return be[ae]=0,ae-p}function ze(fe,be,ae){return Ee(fe,re,be,ae)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function de(fe,be){$.set(fe,be)}function ve(fe,be){return fe%be>0&&(fe+=be-fe%be),fe}var Ae,$,re,Te,Qe,me,Le;function Ue(fe){Ae=fe,e.HEAP8=$=new Int8Array(fe),e.HEAP16=Te=new Int16Array(fe),e.HEAP32=Qe=new Int32Array(fe),e.HEAPU8=re=new Uint8Array(fe),e.HEAPU16=new Uint16Array(fe),e.HEAPU32=new Uint32Array(fe),e.HEAPF32=me=new Float32Array(fe),e.HEAPF64=Le=new Float64Array(fe)}var Ye=5267040,et=24128,tt=e.TOTAL_MEMORY||33554432;e.buffer?Ae=e.buffer:Ae=new ArrayBuffer(tt),tt=Ae.byteLength,Ue(Ae),Qe[et>>2]=Ye;function ct(fe){for(;fe.length>0;){var be=fe.shift();if(typeof be=="function"){be();continue}var ae=be.func;typeof ae=="number"?be.arg===void 0?e.dynCall_v(ae):e.dynCall_vi(ae,be.arg):ae(be.arg===void 0?null:be.arg)}}var mt=[],Tt=[],nt=[],lr=[];function qt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)rn(e.preRun.shift());ct(mt)}function $t(){ct(Tt)}function Ot(){ct(nt)}function fr(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Er(e.postRun.shift());ct(lr)}function rn(fe){mt.unshift(fe)}function Er(fe){lr.unshift(fe)}var mr=Math.abs,Ln=Math.ceil,dr=Math.floor,Ar=Math.min,nn=0,Ir=null;function ei(fe){nn++,e.monitorRunDependencies&&e.monitorRunDependencies(nn)}function jn(fe){if(nn--,e.monitorRunDependencies&&e.monitorRunDependencies(nn),nn==0&&Ir){var be=Ir;Ir=null,be()}}e.preloadedImages={},e.preloadedAudios={};var fn=null,Jn="data:application/octet-stream;base64,";function Nn(fe){return String.prototype.startsWith?fe.startsWith(Jn):fe.indexOf(Jn)===0}var bn,$n;fn="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var kt=24144;function hr(fe,be,ae,Be){De("Assertion failed: "+oe(fe)+", at: "+[be?oe(be):"unknown filename",ae,Be?oe(Be):"unknown function"])}function Br(){return $.length}function Zr(fe,be,ae){re.set(re.subarray(be,be+ae),fe)}function ui(fe){return e.___errno_location&&(Qe[e.___errno_location()>>2]=fe),fe}function Me(fe){De("OOM")}function Dt(fe){try{var be=new ArrayBuffer(fe);return be.byteLength!=fe?void 0:(new Int8Array(be).set($),j(be),Ue(be),1)}catch{}}function Gt(fe){var be=Br(),ae=16777216,Be=2147483648-ae;if(fe>Be)return!1;for(var p=16777216,ce=Math.max(be,p);ce<fe;)ce<=536870912?ce=ve(2*ce,ae):ce=Math.min(ve((3*ce+2147483648)/4,ae),Be);var yt=Dt(ce);return!!yt}var sr=typeof atob=="function"?atob:function(fe){var be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ae="",Be,p,ce,yt,Xe,wt,St,Rt=0;fe=fe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do yt=be.indexOf(fe.charAt(Rt++)),Xe=be.indexOf(fe.charAt(Rt++)),wt=be.indexOf(fe.charAt(Rt++)),St=be.indexOf(fe.charAt(Rt++)),Be=yt<<2|Xe>>4,p=(Xe&15)<<4|wt>>2,ce=(wt&3)<<6|St,ae=ae+String.fromCharCode(Be),wt!==64&&(ae=ae+String.fromCharCode(p)),St!==64&&(ae=ae+String.fromCharCode(ce));while(Rt<fe.length);return ae};function qe(fe){try{for(var be=sr(fe),ae=new Uint8Array(be.length),Be=0;Be<be.length;++Be)ae[Be]=be.charCodeAt(Be);return ae}catch{throw new Error("Converting base64 string to bytes failed.")}}function It(fe){if(Nn(fe))return qe(fe.slice(Jn.length))}var pe={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Nt={b:x,c:E,d:hr,e:ui,f:Br,g:Zr,h:Gt,i:Me,o:kt,p:et},xt=function(fe,be,ae){"almost asm";var Be=new fe.Int8Array(ae),p=new fe.Int32Array(ae);new fe.Uint8Array(ae),new fe.Float32Array(ae);var ce=new fe.Float64Array(ae),yt=be.o|0,Xe=be.p|0,wt=fe.Math.floor,St=fe.Math.abs,Rt=fe.Math.sqrt,lt=fe.Math.pow,Ft=fe.Math.cos,Bt=fe.Math.sin,Ut=fe.Math.tan,Dr=fe.Math.acos,Kt=fe.Math.asin,Kr=fe.Math.atan,tn=fe.Math.atan2,Gr=fe.Math.ceil,Vr=fe.Math.imul,Nr=fe.Math.min,fi=fe.Math.max,Hr=fe.Math.clz32,ur=be.b,Ie=be.c,jt=be.d,qr=be.e,Ni=be.f,ia=be.g,ti=be.h,kn=be.i,Se=24160;function Po(_){return Be=new Int8Array(_),p=new Int32Array(_),ce=new Float64Array(_),ae=_,!0}function Un(_){_=_|0;var m=0;return m=Se,Se=Se+_|0,Se=Se+15&-16,m|0}function Ro(){return Se|0}function Bi(_){_=_|0,Se=_}function ri(_,m){_=_|0,Se=_}function bi(_,m){_=_|0,m=m|0;var v=0,w=0,B=0;return(_|0)<0?(m=2,m|0):(_|0)>13780509?(m=Uo(15,m)|0,m|0):(v=((_|0)<0)<<31>>31,B=si(_|0,v|0,3,0)|0,w=Ie()|0,v=ln(_|0,v|0,1,0)|0,v=si(B|0,w|0,v|0,Ie()|0)|0,v=ln(v|0,Ie()|0,1,0)|0,_=Ie()|0,p[m>>2]=v,p[m+4>>2]=_,m=0,m|0)}function En(_,m,v,w){return _=_|0,m=m|0,v=v|0,w=w|0,as(_,m,v,w,0)|0}function as(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0;if(h=Se,Se=Se+16|0,D=h,!(ki(_,m,v,w,B)|0))return w=0,Se=h,w|0;do if((v|0)>=0){if((v|0)>13780509){if(M=Uo(15,D)|0,M|0)break;c=D,D=p[c>>2]|0,c=p[c+4>>2]|0}else M=((v|0)<0)<<31>>31,f=si(v|0,M|0,3,0)|0,c=Ie()|0,M=ln(v|0,M|0,1,0)|0,M=si(f|0,c|0,M|0,Ie()|0)|0,M=ln(M|0,Ie()|0,1,0)|0,c=Ie()|0,p[D>>2]=M,p[D+4>>2]=c,D=M;if(jo(w|0,0,D<<3|0)|0,B|0){jo(B|0,0,D<<2|0)|0,M=Bs(_,m,v,w,B,D,c,0)|0;break}M=Ks(D,4)|0,M?(f=Bs(_,m,v,w,M,D,c,0)|0,Or(M),M=f):M=13}else M=2;while(!1);return f=M,Se=h,f|0}function ki(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0;if(z=Se,Se=Se+16|0,R=z,L=z+8|0,P=R,p[P>>2]=_,p[P+4>>2]=m,(v|0)<0)return L=2,Se=z,L|0;if(M=w,p[M>>2]=_,p[M+4>>2]=m,M=(B|0)!=0,M&&(p[B>>2]=0),Bn(_,m)|0)return L=9,Se=z,L|0;p[L>>2]=0;e:do if((v|0)>=1)if(M)for(g=1,f=0,C=0,P=1,M=_;;){if(!(f|C)){if(M=xn(M,m,4,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,Bn(M,m)|0){M=9;break e}}if(M=xn(M,m,p[22384+(C<<2)>>2]|0,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,_=w+(g<<3)|0,p[_>>2]=M,p[_+4>>2]=m,p[B+(g<<2)>>2]=P,_=f+1|0,D=(_|0)==(P|0),c=C+1|0,h=(c|0)==6,Bn(M,m)|0){M=9;break e}if(P=P+(h&D&1)|0,(P|0)>(v|0)){M=0;break}else g=g+1|0,f=D?0:_,C=D?h?0:c:C}else for(g=1,f=0,C=0,P=1,M=_;;){if(!(f|C)){if(M=xn(M,m,4,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,Bn(M,m)|0){M=9;break e}}if(M=xn(M,m,p[22384+(C<<2)>>2]|0,L,R)|0,M|0)break e;if(m=R,M=p[m>>2]|0,m=p[m+4>>2]|0,_=w+(g<<3)|0,p[_>>2]=M,p[_+4>>2]=m,_=f+1|0,D=(_|0)==(P|0),c=C+1|0,h=(c|0)==6,Bn(M,m)|0){M=9;break e}if(P=P+(h&D&1)|0,(P|0)>(v|0)){M=0;break}else g=g+1|0,f=D?0:_,C=D?h?0:c:C}else M=0;while(!1);return L=M,Se=z,L|0}function Bs(_,m,v,w,B,M,D,c){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0,D=D|0,c=c|0;var h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0;if(z=Se,Se=Se+16|0,R=z+8|0,L=z,h=fo(_|0,m|0,M|0,D|0)|0,g=Ie()|0,C=w+(h<<3)|0,W=C,ee=p[W>>2]|0,W=p[W+4>>2]|0,f=(ee|0)==(_|0)&(W|0)==(m|0),!((ee|0)==0&(W|0)==0|f))do h=ln(h|0,g|0,1,0)|0,h=Yi(h|0,Ie()|0,M|0,D|0)|0,g=Ie()|0,C=w+(h<<3)|0,ee=C,W=p[ee>>2]|0,ee=p[ee+4>>2]|0,f=(W|0)==(_|0)&(ee|0)==(m|0);while(!((W|0)==0&(ee|0)==0|f));if(h=B+(h<<2)|0,f&&(p[h>>2]|0)<=(c|0)||(ee=C,p[ee>>2]=_,p[ee+4>>2]=m,p[h>>2]=c,(c|0)>=(v|0)))return ee=0,Se=z,ee|0;switch(f=c+1|0,p[R>>2]=0,h=xn(_,m,2,R,L)|0,h|0){case 9:{P=9;break}case 0:{h=L,h=Bs(p[h>>2]|0,p[h+4>>2]|0,v,w,B,M,D,f)|0,h||(P=9);break}}e:do if((P|0)==9){switch(p[R>>2]=0,h=xn(_,m,3,R,L)|0,h|0){case 9:break;case 0:{if(h=L,h=Bs(p[h>>2]|0,p[h+4>>2]|0,v,w,B,M,D,f)|0,h|0)break e;break}default:break e}switch(p[R>>2]=0,h=xn(_,m,1,R,L)|0,h|0){case 9:break;case 0:{if(h=L,h=Bs(p[h>>2]|0,p[h+4>>2]|0,v,w,B,M,D,f)|0,h|0)break e;break}default:break e}switch(p[R>>2]=0,h=xn(_,m,5,R,L)|0,h|0){case 9:break;case 0:{if(h=L,h=Bs(p[h>>2]|0,p[h+4>>2]|0,v,w,B,M,D,f)|0,h|0)break e;break}default:break e}switch(p[R>>2]=0,h=xn(_,m,4,R,L)|0,h|0){case 9:break;case 0:{if(h=L,h=Bs(p[h>>2]|0,p[h+4>>2]|0,v,w,B,M,D,f)|0,h|0)break e;break}default:break e}switch(p[R>>2]=0,h=xn(_,m,6,R,L)|0,h|0){case 9:break;case 0:{if(h=L,h=Bs(p[h>>2]|0,p[h+4>>2]|0,v,w,B,M,D,f)|0,h|0)break e;break}default:break e}return ee=0,Se=z,ee|0}while(!1);return ee=h,Se=z,ee|0}function xn(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0;if(v>>>0>6)return B=1,B|0;if(C=(p[w>>2]|0)%6|0,p[w>>2]=C,(C|0)>0){M=0;do v=co(v)|0,M=M+1|0;while((M|0)<(p[w>>2]|0))}if(C=Ht(_|0,m|0,45)|0,Ie()|0,g=C&127,g>>>0>121)return B=5,B|0;h=Xi(_,m)|0,M=Ht(_|0,m|0,52)|0,Ie()|0,M=M&15;e:do if(!M)f=8;else{for(;;){if(D=(15-M|0)*3|0,c=Ht(_|0,m|0,D|0)|0,Ie()|0,c=c&7,(c|0)==7){m=5;break}if(L=(Is(M)|0)==0,M=M+-1|0,P=Yt(7,0,D|0)|0,m=m&~(Ie()|0),R=Yt(p[(L?432:16)+(c*28|0)+(v<<2)>>2]|0,0,D|0)|0,D=Ie()|0,v=p[(L?640:224)+(c*28|0)+(v<<2)>>2]|0,_=R|_&~P,m=D|m,!v){v=0;break e}if(!M){f=8;break e}}return m|0}while(!1);(f|0)==8&&(L=p[848+(g*28|0)+(v<<2)>>2]|0,R=Yt(L|0,0,45)|0,_=R|_,m=Ie()|0|m&-1040385,v=p[4272+(g*28|0)+(v<<2)>>2]|0,(L&127|0)==127&&(L=Yt(p[848+(g*28|0)+20>>2]|0,0,45)|0,m=Ie()|0|m&-1040385,v=p[4272+(g*28|0)+20>>2]|0,_=lo(L|_,m)|0,m=Ie()|0,p[w>>2]=(p[w>>2]|0)+1)),c=Ht(_|0,m|0,45)|0,Ie()|0,c=c&127;e:do if(Cr(c)|0){t:do if((Xi(_,m)|0)==1){if((g|0)!=(c|0))if($u(c,p[7696+(g*28|0)>>2]|0)|0){_=Da(_,m)|0,D=1,m=Ie()|0;break}else jt(23313,22416,436,22424);switch(h|0){case 3:{_=lo(_,m)|0,m=Ie()|0,p[w>>2]=(p[w>>2]|0)+1,D=0;break t}case 5:{_=Da(_,m)|0,m=Ie()|0,p[w>>2]=(p[w>>2]|0)+5,D=0;break t}case 0:return L=9,L|0;default:return L=1,L|0}}else D=0;while(!1);if((v|0)>0){M=0;do _=da(_,m)|0,m=Ie()|0,M=M+1|0;while((M|0)!=(v|0))}if((g|0)!=(c|0)){if(!(ni(c)|0)){if((D|0)!=0|(Xi(_,m)|0)!=5)break;p[w>>2]=(p[w>>2]|0)+1;break}switch(C&127){case 8:case 118:break e}(Xi(_,m)|0)!=3&&(p[w>>2]=(p[w>>2]|0)+1)}}else if((v|0)>0){M=0;do _=lo(_,m)|0,m=Ie()|0,M=M+1|0;while((M|0)!=(v|0))}while(!1);return p[w>>2]=((p[w>>2]|0)+v|0)%6|0,L=B,p[L>>2]=_,p[L+4>>2]=m,L=0,L|0}function Qc(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0;for(c=Se,Se=Se+16|0,M=c,D=c+8|0,B=(Bn(_,m)|0)==0,B=B?1:2;;){if(p[D>>2]=0,f=(xn(_,m,B,D,M)|0)==0,h=M,f&((p[h>>2]|0)==(v|0)?(p[h+4>>2]|0)==(w|0):0)){_=4;break}if(B=B+1|0,B>>>0>=7){B=7,_=4;break}}return(_|0)==4?(Se=c,B|0):0}function xe(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0;if(L=Se,Se=Se+16|0,P=L,R=L+8|0,C=P,p[C>>2]=_,p[C+4>>2]=m,!v)return R=w,p[R>>2]=_,p[R+4>>2]=m,R=0,Se=L,R|0;p[R>>2]=0;e:do if(Bn(_,m)|0)_=9;else{if(M=(v|0)>0,M){B=0,C=_;do{if(_=xn(C,m,4,R,P)|0,_|0)break e;if(m=P,C=p[m>>2]|0,m=p[m+4>>2]|0,B=B+1|0,Bn(C,m)|0){_=9;break e}}while((B|0)<(v|0));if(g=w,p[g>>2]=C,p[g+4>>2]=m,g=v+-1|0,M){f=0,_=1;do{if(B=22384+(f<<2)|0,(f|0)==5)for(D=p[B>>2]|0,M=0,B=_;;){if(_=P,_=xn(p[_>>2]|0,p[_+4>>2]|0,D,R,P)|0,_|0)break e;if((M|0)!=(g|0))if(h=P,c=p[h>>2]|0,h=p[h+4>>2]|0,_=w+(B<<3)|0,p[_>>2]=c,p[_+4>>2]=h,!(Bn(c,h)|0))_=B+1|0;else{_=9;break e}else _=B;if(M=M+1|0,(M|0)>=(v|0))break;B=_}else for(D=P,h=p[B>>2]|0,c=0,B=_,M=p[D>>2]|0,D=p[D+4>>2]|0;;){if(_=xn(M,D,h,R,P)|0,_|0)break e;if(D=P,M=p[D>>2]|0,D=p[D+4>>2]|0,_=w+(B<<3)|0,p[_>>2]=M,p[_+4>>2]=D,_=B+1|0,Bn(M,D)|0){_=9;break e}if(c=c+1|0,(c|0)>=(v|0))break;B=_}f=f+1|0}while(f>>>0<6);_=P,D=C,B=p[_>>2]|0,M=m,_=p[_+4>>2]|0}else D=C,B=C,M=m,_=m}else D=w,p[D>>2]=_,p[D+4>>2]=m,D=_,B=_,M=m,_=m;_=(D|0)==(B|0)&(M|0)==(_|0)?0:9}while(!1);return R=_,Se=L,R|0}function Pe(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0;if(c=Se,Se=Se+48|0,B=c+16|0,M=c+8|0,D=c,v|0)return D=15,Se=c,D|0;if(f=_,h=p[f+4>>2]|0,v=M,p[v>>2]=p[f>>2],p[v+4>>2]=h,cs(M,B),m=Fo(B,m,D)|0,!m){if(v=p[M>>2]|0,M=p[_+8>>2]|0,(M|0)>0){B=p[_+12>>2]|0,m=0;do v=(p[B+(m<<3)>>2]|0)+v|0,m=m+1|0;while((m|0)<(M|0))}m=D,B=p[m>>2]|0,m=p[m+4>>2]|0,M=((v|0)<0)<<31>>31,(m|0)<(M|0)|(m|0)==(M|0)&B>>>0<v>>>0?(m=D,p[m>>2]=v,p[m+4>>2]=M,m=M):v=B,h=ln(v|0,m|0,12,0)|0,f=Ie()|0,m=D,p[m>>2]=h,p[m+4>>2]=f,m=w,p[m>>2]=h,p[m+4>>2]=f,m=0}return f=m,Se=c,f|0}function je(_,m,v,w,B,M,D){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0,D=D|0;var c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0,Ve=0,$e=0,rt=0,Je=0,Ze=0,ft=0,Pt=0,bt=0,Lt=0,tr=0,br=0;if(Pt=Se,Se=Se+64|0,rt=Pt+48|0,Je=Pt+32|0,Ze=Pt+24|0,we=Pt+8|0,Fe=Pt,h=p[_>>2]|0,(h|0)<=0)return ft=0,Se=Pt,ft|0;for(ge=_+4|0,Re=rt+8|0,Ve=Je+8|0,$e=we+8|0,c=0,te=0;;){f=p[ge>>2]|0,Z=f+(te<<4)|0,p[rt>>2]=p[Z>>2],p[rt+4>>2]=p[Z+4>>2],p[rt+8>>2]=p[Z+8>>2],p[rt+12>>2]=p[Z+12>>2],(te|0)==(h+-1|0)?(p[Je>>2]=p[f>>2],p[Je+4>>2]=p[f+4>>2],p[Je+8>>2]=p[f+8>>2],p[Je+12>>2]=p[f+12>>2]):(Z=f+(te+1<<4)|0,p[Je>>2]=p[Z>>2],p[Je+4>>2]=p[Z+4>>2],p[Je+8>>2]=p[Z+8>>2],p[Je+12>>2]=p[Z+12>>2]),h=oa(rt,Je,w,Ze)|0;e:do if(h)f=0,c=h;else if(f=Ze,h=p[f>>2]|0,f=p[f+4>>2]|0,(f|0)>0|(f|0)==0&h>>>0>0){ee=0,Z=0;t:for(;;){if(br=+ce[rt>>3],W=jr(h|0,f|0,ee|0,Z|0)|0,tr=+(W>>>0)+4294967296*+(Ie()|0),bt=+(h>>>0)+4294967296*+(f|0),Lt=+(ee>>>0)+4294967296*+(Z|0),ce[we>>3]=br*tr/bt+ +ce[Je>>3]*Lt/bt,ce[$e>>3]=+ce[Re>>3]*tr/bt+ +ce[Ve>>3]*Lt/bt,h=Oa(we,w,Fe)|0,h|0){c=h;break}W=Fe,z=p[W>>2]|0,W=p[W+4>>2]|0,P=fo(z|0,W|0,m|0,v|0)|0,g=Ie()|0,h=D+(P<<3)|0,C=h,f=p[C>>2]|0,C=p[C+4>>2]|0;r:do if((f|0)==0&(C|0)==0)se=h,ft=16;else for(R=0,L=0;;){if((R|0)>(v|0)|(R|0)==(v|0)&L>>>0>m>>>0){c=1;break t}if((f|0)==(z|0)&(C|0)==(W|0))break r;if(h=ln(P|0,g|0,1,0)|0,P=Yi(h|0,Ie()|0,m|0,v|0)|0,g=Ie()|0,L=ln(L|0,R|0,1,0)|0,R=Ie()|0,h=D+(P<<3)|0,C=h,f=p[C>>2]|0,C=p[C+4>>2]|0,(f|0)==0&(C|0)==0){se=h,ft=16;break}}while(!1);if((ft|0)==16&&(ft=0,!((z|0)==0&(W|0)==0))&&(L=se,p[L>>2]=z,p[L+4>>2]=W,L=M+(p[B>>2]<<3)|0,p[L>>2]=z,p[L+4>>2]=W,L=B,L=ln(p[L>>2]|0,p[L+4>>2]|0,1,0)|0,z=Ie()|0,W=B,p[W>>2]=L,p[W+4>>2]=z),ee=ln(ee|0,Z|0,1,0)|0,Z=Ie()|0,f=Ze,h=p[f>>2]|0,f=p[f+4>>2]|0,!((f|0)>(Z|0)|(f|0)==(Z|0)&h>>>0>ee>>>0)){f=1;break e}}f=0}else f=1;while(!1);if(te=te+1|0,!f){ft=21;break}if(h=p[_>>2]|0,(te|0)>=(h|0)){c=0,ft=21;break}}return(ft|0)==21?(Se=Pt,c|0):0}function dt(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0,Ve=0,$e=0,rt=0,Je=0,Ze=0,ft=0,Pt=0,bt=0,Lt=0,tr=0;if(tr=Se,Se=Se+112|0,ft=tr+80|0,h=tr+72|0,Pt=tr,bt=tr+56|0,v|0)return Lt=15,Se=tr,Lt|0;if(f=_+8|0,Lt=Gn((p[f>>2]<<5)+32|0)|0,!Lt)return Lt=13,Se=tr,Lt|0;if(Qu(_,Lt),Je=_,Ze=p[Je+4>>2]|0,v=h,p[v>>2]=p[Je>>2],p[v+4>>2]=Ze,cs(h,ft),v=Fo(ft,m,Pt)|0,v)Je=0,Ze=0;else{if(v=p[h>>2]|0,M=p[f>>2]|0,(M|0)>0){D=p[_+12>>2]|0,B=0;do v=(p[D+(B<<3)>>2]|0)+v|0,B=B+1|0;while((B|0)!=(M|0));B=v}else B=v;v=Pt,M=p[v>>2]|0,v=p[v+4>>2]|0,D=((B|0)<0)<<31>>31,(v|0)<(D|0)|(v|0)==(D|0)&M>>>0<B>>>0?(v=Pt,p[v>>2]=B,p[v+4>>2]=D,v=D):B=M,Je=ln(B|0,v|0,12,0)|0,Ze=Ie()|0,v=Pt,p[v>>2]=Je,p[v+4>>2]=Ze,v=0}if(v|0)return Or(Lt),Lt=v,Se=tr,Lt|0;if(B=Ks(Je,8)|0,!B)return Or(Lt),Lt=13,Se=tr,Lt|0;if(c=Ks(Je,8)|0,!c)return Or(Lt),Or(B),Lt=13,Se=tr,Lt|0;$e=ft,p[$e>>2]=0,p[$e+4>>2]=0,$e=_,rt=p[$e+4>>2]|0,v=h,p[v>>2]=p[$e>>2],p[v+4>>2]=rt,v=je(h,Je,Ze,m,ft,B,c)|0;e:do if(v)Or(B),Or(c),Or(Lt);else{t:do if((p[f>>2]|0)>0){for(D=_+12|0,M=0;v=je((p[D>>2]|0)+(M<<3)|0,Je,Ze,m,ft,B,c)|0,M=M+1|0,!(v|0);)if((M|0)>=(p[f>>2]|0))break t;Or(B),Or(c),Or(Lt);break e}while(!1);(Ze|0)>0|(Ze|0)==0&Je>>>0>0&&jo(c|0,0,Je<<3|0)|0,rt=ft,$e=p[rt+4>>2]|0;t:do if(($e|0)>0|($e|0)==0&(p[rt>>2]|0)>>>0>0){ge=B,Re=c,Ve=B,$e=c,rt=B,v=B,se=B,we=c,Fe=c,B=c;r:for(;;){for(W=0,ee=0,Z=0,te=0,M=0,D=0;;){c=Pt,h=c+56|0;do p[c>>2]=0,c=c+4|0;while((c|0)<(h|0));if(m=ge+(W<<3)|0,f=p[m>>2]|0,m=p[m+4>>2]|0,ki(f,m,1,Pt,0)|0){c=Pt,h=c+56|0;do p[c>>2]=0,c=c+4|0;while((c|0)<(h|0));c=Ks(7,4)|0,c|0&&(Bs(f,m,1,Pt,c,7,0,0)|0,Or(c))}for(z=0;;){L=Pt+(z<<3)|0,R=p[L>>2]|0,L=p[L+4>>2]|0;n:do if((R|0)==0&(L|0)==0)c=M,h=D;else{if(g=fo(R|0,L|0,Je|0,Ze|0)|0,f=Ie()|0,c=w+(g<<3)|0,m=c,h=p[m>>2]|0,m=p[m+4>>2]|0,!((h|0)==0&(m|0)==0)){C=0,P=0;do{if((C|0)>(Ze|0)|(C|0)==(Ze|0)&P>>>0>Je>>>0)break r;if((h|0)==(R|0)&(m|0)==(L|0)){c=M,h=D;break n}c=ln(g|0,f|0,1,0)|0,g=Yi(c|0,Ie()|0,Je|0,Ze|0)|0,f=Ie()|0,P=ln(P|0,C|0,1,0)|0,C=Ie()|0,c=w+(g<<3)|0,m=c,h=p[m>>2]|0,m=p[m+4>>2]|0}while(!((h|0)==0&(m|0)==0))}(R|0)==0&(L|0)==0?(c=M,h=D):(gc(R,L,bt)|0,Jt(_,Lt,bt)|0&&(P=ln(M|0,D|0,1,0)|0,D=Ie()|0,C=c,p[C>>2]=R,p[C+4>>2]=L,M=Re+(M<<3)|0,p[M>>2]=R,p[M+4>>2]=L,M=P),c=M,h=D)}while(!1);if(z=z+1|0,z>>>0>=7)break;M=c,D=h}if(W=ln(W|0,ee|0,1,0)|0,ee=Ie()|0,Z=ln(Z|0,te|0,1,0)|0,te=Ie()|0,D=ft,M=p[D>>2]|0,D=p[D+4>>2]|0,(te|0)<(D|0)|(te|0)==(D|0)&Z>>>0<M>>>0)M=c,D=h;else break}if((D|0)>0|(D|0)==0&M>>>0>0){M=0,D=0;do te=ge+(M<<3)|0,p[te>>2]=0,p[te+4>>2]=0,M=ln(M|0,D|0,1,0)|0,D=Ie()|0,te=ft,Z=p[te+4>>2]|0;while((D|0)<(Z|0)|((D|0)==(Z|0)?M>>>0<(p[te>>2]|0)>>>0:0))}if(te=ft,p[te>>2]=c,p[te+4>>2]=h,(h|0)>0|(h|0)==0&c>>>0>0)z=B,W=Fe,ee=rt,Z=we,te=Re,B=se,Fe=v,we=Ve,se=z,v=W,rt=$e,$e=ee,Ve=Z,Re=ge,ge=te;else break t}Or(Ve),Or($e),Or(Lt),v=1;break e}else v=c;while(!1);Or(Lt),Or(B),Or(v),v=0}while(!1);return Lt=v,Se=tr,Lt|0}function Vt(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(g=Se,Se=Se+176|0,h=g,(m|0)<1)return Aa(v,0,0),f=0,Se=g,f|0;for(c=_,c=Ht(p[c>>2]|0,p[c+4>>2]|0,52)|0,Ie()|0,Aa(v,(m|0)>6?m:6,c&15),c=0;w=_+(c<<3)|0,w=mc(p[w>>2]|0,p[w+4>>2]|0,h)|0,!(w|0);){if(w=p[h>>2]|0,(w|0)>0){D=0;do M=h+8+(D<<4)|0,D=D+1|0,w=h+8+(((D|0)%(w|0)|0)<<4)|0,B=_r(v,w,M)|0,B?qi(v,B)|0:hl(v,M,w)|0,w=p[h>>2]|0;while((D|0)<(w|0))}if(c=c+1|0,(c|0)>=(m|0)){w=0,f=13;break}}return(f|0)==13?(Se=g,w|0):(Vo(v),f=w,Se=g,f|0)}function pr(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0;if(M=Se,Se=Se+32|0,w=M,B=M+16|0,_=Vt(_,m,B)|0,_|0)return v=_,Se=M,v|0;if(p[v>>2]=0,p[v+4>>2]=0,p[v+8>>2]=0,_=Xs(B)|0,_|0)do{m=LA(v)|0;do NA(m,_)|0,D=_+16|0,p[w>>2]=p[D>>2],p[w+4>>2]=p[D+4>>2],p[w+8>>2]=p[D+8>>2],p[w+12>>2]=p[D+12>>2],qi(B,_)|0,_=or(B,w)|0;while((_|0)!=0);_=Xs(B)|0}while((_|0)!=0);return Vo(B),_=fl(v)|0,_?(bc(v),D=_,Se=M,D|0):(D=0,Se=M,D|0)}function Cr(_){return _=_|0,_>>>0>121?(_=0,_|0):(_=p[7696+(_*28|0)+16>>2]|0,_|0)}function ni(_){return _=_|0,(_|0)==4|(_|0)==117|0}function Si(_){return _=_|0,p[11120+((p[_>>2]|0)*216|0)+((p[_+4>>2]|0)*72|0)+((p[_+8>>2]|0)*24|0)+(p[_+12>>2]<<3)>>2]|0}function Ui(_){return _=_|0,p[11120+((p[_>>2]|0)*216|0)+((p[_+4>>2]|0)*72|0)+((p[_+8>>2]|0)*24|0)+(p[_+12>>2]<<3)+4>>2]|0}function Vs(_,m){_=_|0,m=m|0,_=7696+(_*28|0)|0,p[m>>2]=p[_>>2],p[m+4>>2]=p[_+4>>2],p[m+8>>2]=p[_+8>>2],p[m+12>>2]=p[_+12>>2]}function lh(_,m){_=_|0,m=m|0;var v=0,w=0;if(m>>>0>20)return m=-1,m|0;do if((p[11120+(m*216|0)>>2]|0)!=(_|0))if((p[11120+(m*216|0)+8>>2]|0)!=(_|0))if((p[11120+(m*216|0)+16>>2]|0)!=(_|0))if((p[11120+(m*216|0)+24>>2]|0)!=(_|0))if((p[11120+(m*216|0)+32>>2]|0)!=(_|0))if((p[11120+(m*216|0)+40>>2]|0)!=(_|0))if((p[11120+(m*216|0)+48>>2]|0)!=(_|0))if((p[11120+(m*216|0)+56>>2]|0)!=(_|0))if((p[11120+(m*216|0)+64>>2]|0)!=(_|0))if((p[11120+(m*216|0)+72>>2]|0)!=(_|0))if((p[11120+(m*216|0)+80>>2]|0)!=(_|0))if((p[11120+(m*216|0)+88>>2]|0)!=(_|0))if((p[11120+(m*216|0)+96>>2]|0)!=(_|0))if((p[11120+(m*216|0)+104>>2]|0)!=(_|0))if((p[11120+(m*216|0)+112>>2]|0)!=(_|0))if((p[11120+(m*216|0)+120>>2]|0)!=(_|0))if((p[11120+(m*216|0)+128>>2]|0)!=(_|0))if((p[11120+(m*216|0)+136>>2]|0)==(_|0))_=2,v=1,w=2;else{if((p[11120+(m*216|0)+144>>2]|0)==(_|0)){_=0,v=2,w=0;break}if((p[11120+(m*216|0)+152>>2]|0)==(_|0)){_=0,v=2,w=1;break}if((p[11120+(m*216|0)+160>>2]|0)==(_|0)){_=0,v=2,w=2;break}if((p[11120+(m*216|0)+168>>2]|0)==(_|0)){_=1,v=2,w=0;break}if((p[11120+(m*216|0)+176>>2]|0)==(_|0)){_=1,v=2,w=1;break}if((p[11120+(m*216|0)+184>>2]|0)==(_|0)){_=1,v=2,w=2;break}if((p[11120+(m*216|0)+192>>2]|0)==(_|0)){_=2,v=2,w=0;break}if((p[11120+(m*216|0)+200>>2]|0)==(_|0)){_=2,v=2,w=1;break}if((p[11120+(m*216|0)+208>>2]|0)==(_|0)){_=2,v=2,w=2;break}else _=-1;return _|0}else _=2,v=1,w=1;else _=2,v=1,w=0;else _=1,v=1,w=2;else _=1,v=1,w=1;else _=1,v=1,w=0;else _=0,v=1,w=2;else _=0,v=1,w=1;else _=0,v=1,w=0;else _=2,v=0,w=2;else _=2,v=0,w=1;else _=2,v=0,w=0;else _=1,v=0,w=2;else _=1,v=0,w=1;else _=1,v=0,w=0;else _=0,v=0,w=2;else _=0,v=0,w=1;else _=0,v=0,w=0;while(!1);return m=p[11120+(m*216|0)+(v*72|0)+(_*24|0)+(w<<3)+4>>2]|0,m|0}function $u(_,m){return _=_|0,m=m|0,(p[7696+(_*28|0)+20>>2]|0)==(m|0)?(m=1,m|0):(m=(p[7696+(_*28|0)+24>>2]|0)==(m|0),m|0)}function sa(_,m){return _=_|0,m=m|0,p[848+(_*28|0)+(m<<2)>>2]|0}function el(_,m){return _=_|0,m=m|0,(p[848+(_*28|0)>>2]|0)==(m|0)?(m=0,m|0):(p[848+(_*28|0)+4>>2]|0)==(m|0)?(m=1,m|0):(p[848+(_*28|0)+8>>2]|0)==(m|0)?(m=2,m|0):(p[848+(_*28|0)+12>>2]|0)==(m|0)?(m=3,m|0):(p[848+(_*28|0)+16>>2]|0)==(m|0)?(m=4,m|0):(p[848+(_*28|0)+20>>2]|0)==(m|0)?(m=5,m|0):((p[848+(_*28|0)+24>>2]|0)==(m|0)?6:7)|0}function tl(){return 122}function uh(_){_=_|0;var m=0,v=0,w=0;m=0;do Yt(m|0,0,45)|0,w=Ie()|0|134225919,v=_+(m<<3)|0,p[v>>2]=-1,p[v+4>>2]=w,m=m+1|0;while((m|0)!=122);return 0}function rl(_){return _=_|0,+ce[_+16>>3]<+ce[_+24>>3]|0}function Ss(_,m){_=_|0,m=m|0;var v=0,w=0,B=0;return v=+ce[m>>3],!(v>=+ce[_+8>>3])||!(v<=+ce[_>>3])?(m=0,m|0):(w=+ce[_+16>>3],v=+ce[_+24>>3],B=+ce[m+8>>3],m=B>=v,_=B<=w&1,w<v?m&&(_=1):m||(_=0),m=(_|0)!=0,m|0)}function Fo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0;L=Se,Se=Se+288|0,g=L+264|0,C=L+96|0,f=L,c=f,h=c+96|0;do p[c>>2]=0,c=c+4|0;while((c|0)<(h|0));return m=ol(m,f)|0,m|0?(R=m,Se=L,R|0):(h=f,f=p[h>>2]|0,h=p[h+4>>2]|0,gc(f,h,g)|0,mc(f,h,C)|0,D=+Ua(g,C+8|0),ce[g>>3]=+ce[_>>3],h=g+8|0,ce[h>>3]=+ce[_+16>>3],ce[C>>3]=+ce[_+8>>3],f=C+8|0,ce[f>>3]=+ce[_+24>>3],B=+Ua(g,C),W=+ce[h>>3]-+ce[f>>3],M=+St(+W),z=+ce[g>>3]-+ce[C>>3],w=+St(+z),!(W==0|z==0)&&(W=+Cc(+M,+w),W=+Gr(+(B*B/+dl(+(W/+dl(+M,+w)),3)/(D*(D*2.59807621135)*.8))),ce[yt>>3]=W,P=~~W>>>0,R=+St(W)>=1?W>0?~~+Nr(+wt(W/4294967296),4294967295)>>>0:~~+Gr((W-+(~~W>>>0))/4294967296)>>>0:0,(p[yt+4>>2]&2146435072|0)!=2146435072)?(C=(P|0)==0&(R|0)==0,m=v,p[m>>2]=C?1:P,p[m+4>>2]=C?0:R,m=0):m=1,R=m,Se=L,R|0)}function oa(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0;f=Se,Se=Se+288|0,D=f+264|0,c=f+96|0,h=f,B=h,M=B+96|0;do p[B>>2]=0,B=B+4|0;while((B|0)<(M|0));return v=ol(v,h)|0,v|0?(w=v,Se=f,w|0):(v=h,B=p[v>>2]|0,v=p[v+4>>2]|0,gc(B,v,D)|0,mc(B,v,c)|0,g=+Ua(D,c+8|0),g=+Gr(+(+Ua(_,m)/(g*2))),ce[yt>>3]=g,v=~~g>>>0,B=+St(g)>=1?g>0?~~+Nr(+wt(g/4294967296),4294967295)>>>0:~~+Gr((g-+(~~g>>>0))/4294967296)>>>0:0,(p[yt+4>>2]&2146435072|0)==2146435072?(w=1,Se=f,w|0):(h=(v|0)==0&(B|0)==0,p[w>>2]=h?1:v,p[w+4>>2]=h?0:B,w=0,Se=f,w|0))}function Sa(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0,p[_>>2]=m,p[_+4>>2]=v,p[_+8>>2]=w}function aa(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0;C=m+8|0,p[C>>2]=0,h=+ce[_>>3],D=+St(+h),f=+ce[_+8>>3],c=+St(+f)/.8660254037844386,D=D+c*.5,v=~~D,_=~~c,D=D-+(v|0),c=c-+(_|0);do if(D<.5)if(D<.3333333333333333)if(p[m>>2]=v,c<(D+1)*.5){p[m+4>>2]=_;break}else{_=_+1|0,p[m+4>>2]=_;break}else if(P=1-D,_=(!(c<P)&1)+_|0,p[m+4>>2]=_,P<=c&c<D*2){v=v+1|0,p[m>>2]=v;break}else{p[m>>2]=v;break}else{if(!(D<.6666666666666666))if(v=v+1|0,p[m>>2]=v,c<D*.5){p[m+4>>2]=_;break}else{_=_+1|0,p[m+4>>2]=_;break}if(c<1-D){if(p[m+4>>2]=_,D*2+-1<c){p[m>>2]=v;break}}else _=_+1|0,p[m+4>>2]=_;v=v+1|0,p[m>>2]=v}while(!1);do if(h<0)if(_&1){g=(_+1|0)/2|0,g=jr(v|0,((v|0)<0)<<31>>31|0,g|0,((g|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-((+(g>>>0)+4294967296*+(Ie()|0))*2+1)),p[m>>2]=v;break}else{g=(_|0)/2|0,g=jr(v|0,((v|0)<0)<<31>>31|0,g|0,((g|0)<0)<<31>>31|0)|0,v=~~(+(v|0)-(+(g>>>0)+4294967296*+(Ie()|0))*2),p[m>>2]=v;break}while(!1);g=m+4|0,f<0&&(v=v-((_<<1|1|0)/2|0)|0,p[m>>2]=v,_=0-_|0,p[g>>2]=_),w=_-v|0,(v|0)<0?(B=0-v|0,p[g>>2]=w,p[C>>2]=B,p[m>>2]=0,_=w,v=0):B=0,(_|0)<0&&(v=v-_|0,p[m>>2]=v,B=B-_|0,p[C>>2]=B,p[g>>2]=0,_=0),M=v-B|0,w=_-B|0,(B|0)<0&&(p[m>>2]=M,p[g>>2]=w,p[C>>2]=0,_=w,v=M,B=0),w=(_|0)<(v|0)?_:v,w=(B|0)<(w|0)?B:w,!((w|0)<=0)&&(p[m>>2]=v-w,p[g>>2]=_-w,p[C>>2]=B-w)}function hi(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0;m=p[_>>2]|0,D=_+4|0,v=p[D>>2]|0,(m|0)<0&&(v=v-m|0,p[D>>2]=v,M=_+8|0,p[M>>2]=(p[M>>2]|0)-m,p[_>>2]=0,m=0),(v|0)<0?(m=m-v|0,p[_>>2]=m,M=_+8|0,B=(p[M>>2]|0)-v|0,p[M>>2]=B,p[D>>2]=0,v=0):(B=_+8|0,M=B,B=p[B>>2]|0),(B|0)<0&&(m=m-B|0,p[_>>2]=m,v=v-B|0,p[D>>2]=v,p[M>>2]=0,B=0),w=(v|0)<(m|0)?v:m,w=(B|0)<(w|0)?B:w,!((w|0)<=0)&&(p[_>>2]=m-w,p[D>>2]=v-w,p[M>>2]=B-w)}function _o(_,m){_=_|0,m=m|0;var v=0,w=0;w=p[_+8>>2]|0,v=+((p[_+4>>2]|0)-w|0),ce[m>>3]=+((p[_>>2]|0)-w|0)-v*.5,ce[m+8>>3]=v*.8660254037844386}function Dn(_,m,v){_=_|0,m=m|0,v=v|0,p[v>>2]=(p[m>>2]|0)+(p[_>>2]|0),p[v+4>>2]=(p[m+4>>2]|0)+(p[_+4>>2]|0),p[v+8>>2]=(p[m+8>>2]|0)+(p[_+8>>2]|0)}function ii(_,m,v){_=_|0,m=m|0,v=v|0,p[v>>2]=(p[_>>2]|0)-(p[m>>2]|0),p[v+4>>2]=(p[_+4>>2]|0)-(p[m+4>>2]|0),p[v+8>>2]=(p[_+8>>2]|0)-(p[m+8>>2]|0)}function Ia(_,m){_=_|0,m=m|0;var v=0,w=0;v=Vr(p[_>>2]|0,m)|0,p[_>>2]=v,v=_+4|0,w=Vr(p[v>>2]|0,m)|0,p[v>>2]=w,_=_+8|0,m=Vr(p[_>>2]|0,m)|0,p[_>>2]=m}function nl(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;D=p[_>>2]|0,c=(D|0)<0,w=(p[_+4>>2]|0)-(c?D:0)|0,M=(w|0)<0,B=(M?0-w|0:0)+((p[_+8>>2]|0)-(c?D:0))|0,v=(B|0)<0,_=v?0:B,m=(M?0:w)-(v?B:0)|0,B=(c?0:D)-(M?w:0)-(v?B:0)|0,v=(m|0)<(B|0)?m:B,v=(_|0)<(v|0)?_:v,w=(v|0)>0,_=_-(w?v:0)|0,m=m-(w?v:0)|0;e:do switch(B-(w?v:0)|0){case 0:switch(m|0){case 0:return c=(_|0)==0?0:(_|0)==1?1:7,c|0;case 1:return c=(_|0)==0?2:(_|0)==1?3:7,c|0;default:break e}case 1:switch(m|0){case 0:return c=(_|0)==0?4:(_|0)==1?5:7,c|0;case 1:{if(!_)_=6;else break e;return _|0}default:break e}}while(!1);return c=7,c|0}function PA(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;D=_+8|0,B=p[D>>2]|0,M=(p[_>>2]|0)-B|0,c=_+4|0,B=(p[c>>2]|0)-B|0;do if(M>>>0>715827881|B>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return c=1,c|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return c=1,c|0;if(m=M*3|0,(B|0)>0){if((2147483647-B|0)<(B|0))return c=1,c|0}else if((-2147483648-B|0)>(B|0))return c=1,c|0;if(w=B<<1,(M|0)>-1){if((m|-2147483648|0)>=(B|0))return c=1,c|0}else if((m^-2147483648|0)<(B|0))return c=1,c|0;if(v){if((2147483647-M|0)<(w|0))m=1;else{v=w;break}return m|0}else{if((-2147483648-M|0)>(w|0))m=1;else{v=w;break}return m|0}}else v=B<<1,m=M*3|0;while(!1);w=Gi(+(m-B|0)/7)|0,p[_>>2]=w,B=Gi(+(v+M|0)/7)|0,p[c>>2]=B,p[D>>2]=0,v=(B|0)<(w|0),m=v?w:B,v=v?B:w;do if((v|0)<0){if((m|0)>0){if((m|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-m|0)>=(v|0)))break;jt(23313,22444,355,22455)}if((v|0)==-2147483648|(-2147483648-m|0)>(v|0)&&jt(23313,22444,355,22455),(m|0)>-1){if((m|-2147483648|0)<(v|0))break;jt(23313,22444,355,22455)}else{if((m^-2147483648|0)>=(v|0))break;jt(23313,22444,355,22455)}}while(!1);return m=B-w|0,(w|0)<0?(v=0-w|0,p[c>>2]=m,p[D>>2]=v,p[_>>2]=0,w=0):(m=B,v=0),(m|0)<0&&(w=w-m|0,p[_>>2]=w,v=v-m|0,p[D>>2]=v,p[c>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[_>>2]=M,p[c>>2]=B,p[D>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(c=0,c|0):(p[_>>2]=B-w,p[c>>2]=m-w,p[D>>2]=v-w,c=0,c|0)}function RA(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;D=_+8|0,B=p[D>>2]|0,M=(p[_>>2]|0)-B|0,c=_+4|0,B=(p[c>>2]|0)-B|0;do if(M>>>0>715827881|B>>>0>715827881){if(v=(M|0)>0,v){if((2147483647-M|0)<(M|0))return c=1,c|0}else if((-2147483648-M|0)>(M|0))return c=1,c|0;if(m=M<<1,(B|0)>0){if((2147483647-B|0)<(B|0)||(2147483647-(B<<1)|0)<(B|0))return c=1,c|0}else if((-2147483648-B|0)>(B|0)||(-2147483648-(B<<1)|0)>(B|0))return c=1,c|0;if(w=B*3|0,v){if((2147483647-m|0)<(B|0))return c=1,c|0}else if((-2147483648-m|0)>(B|0))return c=1,c|0;if((B|0)>-1){if((w|-2147483648|0)<(M|0)){v=w;break}else m=1;return m|0}else{if((w^-2147483648|0)<(M|0))m=1;else{v=w;break}return m|0}}else v=B*3|0,m=M<<1;while(!1);w=Gi(+(m+B|0)/7)|0,p[_>>2]=w,B=Gi(+(v-M|0)/7)|0,p[c>>2]=B,p[D>>2]=0,v=(B|0)<(w|0),m=v?w:B,v=v?B:w;do if((v|0)<0){if((m|0)>0){if((m|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-m|0)>=(v|0)))break;jt(23313,22444,404,22469)}if((v|0)==-2147483648|(-2147483648-m|0)>(v|0)&&jt(23313,22444,404,22469),(m|0)>-1){if((m|-2147483648|0)<(v|0))break;jt(23313,22444,404,22469)}else{if((m^-2147483648|0)>=(v|0))break;jt(23313,22444,404,22469)}}while(!1);return m=B-w|0,(w|0)<0?(v=0-w|0,p[c>>2]=m,p[D>>2]=v,p[_>>2]=0,w=0):(m=B,v=0),(m|0)<0&&(w=w-m|0,p[_>>2]=w,v=v-m|0,p[D>>2]=v,p[c>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[_>>2]=M,p[c>>2]=B,p[D>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(c=0,c|0):(p[_>>2]=B-w,p[c>>2]=m-w,p[D>>2]=v-w,c=0,c|0)}function Wu(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;D=_+8|0,v=p[D>>2]|0,m=(p[_>>2]|0)-v|0,c=_+4|0,v=(p[c>>2]|0)-v|0,w=Gi(+((m*3|0)-v|0)/7)|0,p[_>>2]=w,m=Gi(+((v<<1)+m|0)/7)|0,p[c>>2]=m,p[D>>2]=0,v=m-w|0,(w|0)<0?(M=0-w|0,p[c>>2]=v,p[D>>2]=M,p[_>>2]=0,m=v,w=0,v=M):v=0,(m|0)<0&&(w=w-m|0,p[_>>2]=w,v=v-m|0,p[D>>2]=v,p[c>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[_>>2]=M,p[c>>2]=B,p[D>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(p[_>>2]=B-w,p[c>>2]=m-w,p[D>>2]=v-w)}function zl(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;D=_+8|0,v=p[D>>2]|0,m=(p[_>>2]|0)-v|0,c=_+4|0,v=(p[c>>2]|0)-v|0,w=Gi(+((m<<1)+v|0)/7)|0,p[_>>2]=w,m=Gi(+((v*3|0)-m|0)/7)|0,p[c>>2]=m,p[D>>2]=0,v=m-w|0,(w|0)<0?(M=0-w|0,p[c>>2]=v,p[D>>2]=M,p[_>>2]=0,m=v,w=0,v=M):v=0,(m|0)<0&&(w=w-m|0,p[_>>2]=w,v=v-m|0,p[D>>2]=v,p[c>>2]=0,m=0),M=w-v|0,B=m-v|0,(v|0)<0?(p[_>>2]=M,p[c>>2]=B,p[D>>2]=0,m=B,B=M,v=0):B=w,w=(m|0)<(B|0)?m:B,w=(v|0)<(w|0)?v:w,!((w|0)<=0)&&(p[_>>2]=B-w,p[c>>2]=m-w,p[D>>2]=v-w)}function hc(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;m=p[_>>2]|0,D=_+4|0,v=p[D>>2]|0,c=_+8|0,w=p[c>>2]|0,B=v+(m*3|0)|0,p[_>>2]=B,v=w+(v*3|0)|0,p[D>>2]=v,m=(w*3|0)+m|0,p[c>>2]=m,w=v-B|0,(B|0)<0?(m=m-B|0,p[D>>2]=w,p[c>>2]=m,p[_>>2]=0,v=w,w=0):w=B,(v|0)<0&&(w=w-v|0,p[_>>2]=w,m=m-v|0,p[c>>2]=m,p[D>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[_>>2]=M,p[D>>2]=B,p[c>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=w-v,p[D>>2]=B-v,p[c>>2]=m-v)}function Do(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;B=p[_>>2]|0,D=_+4|0,m=p[D>>2]|0,c=_+8|0,v=p[c>>2]|0,w=(m*3|0)+B|0,B=v+(B*3|0)|0,p[_>>2]=B,p[D>>2]=w,m=(v*3|0)+m|0,p[c>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[D>>2]=v,p[c>>2]=m,p[_>>2]=0,B=0):v=w,(v|0)<0&&(B=B-v|0,p[_>>2]=B,m=m-v|0,p[c>>2]=m,p[D>>2]=0,v=0),M=B-m|0,w=v-m|0,(m|0)<0?(p[_>>2]=M,p[D>>2]=w,p[c>>2]=0,B=M,m=0):w=v,v=(w|0)<(B|0)?w:B,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=B-v,p[D>>2]=w-v,p[c>>2]=m-v)}function Ju(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0;(m+-1|0)>>>0>=6||(B=(p[15440+(m*12|0)>>2]|0)+(p[_>>2]|0)|0,p[_>>2]=B,c=_+4|0,w=(p[15440+(m*12|0)+4>>2]|0)+(p[c>>2]|0)|0,p[c>>2]=w,D=_+8|0,m=(p[15440+(m*12|0)+8>>2]|0)+(p[D>>2]|0)|0,p[D>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[c>>2]=v,p[D>>2]=m,p[_>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[_>>2]=w,m=m-v|0,p[D>>2]=m,p[c>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[_>>2]=M,p[c>>2]=B,p[D>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=w-v,p[c>>2]=B-v,p[D>>2]=m-v))}function Xu(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;B=p[_>>2]|0,D=_+4|0,m=p[D>>2]|0,c=_+8|0,v=p[c>>2]|0,w=m+B|0,B=v+B|0,p[_>>2]=B,p[D>>2]=w,m=v+m|0,p[c>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[D>>2]=v,p[c>>2]=m,p[_>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[_>>2]=w,m=m-v|0,p[c>>2]=m,p[D>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[_>>2]=M,p[D>>2]=B,p[c>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=w-v,p[D>>2]=B-v,p[c>>2]=m-v)}function Gl(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;m=p[_>>2]|0,D=_+4|0,w=p[D>>2]|0,c=_+8|0,v=p[c>>2]|0,B=w+m|0,p[_>>2]=B,w=v+w|0,p[D>>2]=w,m=v+m|0,p[c>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[D>>2]=v,p[c>>2]=m,p[_>>2]=0,w=0):(v=w,w=B),(v|0)<0&&(w=w-v|0,p[_>>2]=w,m=m-v|0,p[c>>2]=m,p[D>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[_>>2]=M,p[D>>2]=B,p[c>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=w-v,p[D>>2]=B-v,p[c>>2]=m-v)}function co(_){switch(_=_|0,_|0){case 1:{_=5;break}case 5:{_=4;break}case 4:{_=6;break}case 6:{_=2;break}case 2:{_=3;break}case 3:{_=1;break}}return _|0}function Hs(_){switch(_=_|0,_|0){case 1:{_=3;break}case 3:{_=2;break}case 2:{_=6;break}case 6:{_=4;break}case 4:{_=5;break}case 5:{_=1;break}}return _|0}function Ku(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;m=p[_>>2]|0,D=_+4|0,v=p[D>>2]|0,c=_+8|0,w=p[c>>2]|0,B=v+(m<<1)|0,p[_>>2]=B,v=w+(v<<1)|0,p[D>>2]=v,m=(w<<1)+m|0,p[c>>2]=m,w=v-B|0,(B|0)<0?(m=m-B|0,p[D>>2]=w,p[c>>2]=m,p[_>>2]=0,v=w,w=0):w=B,(v|0)<0&&(w=w-v|0,p[_>>2]=w,m=m-v|0,p[c>>2]=m,p[D>>2]=0,v=0),M=w-m|0,B=v-m|0,(m|0)<0?(p[_>>2]=M,p[D>>2]=B,p[c>>2]=0,w=M,m=0):B=v,v=(B|0)<(w|0)?B:w,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=w-v,p[D>>2]=B-v,p[c>>2]=m-v)}function Ri(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;B=p[_>>2]|0,D=_+4|0,m=p[D>>2]|0,c=_+8|0,v=p[c>>2]|0,w=(m<<1)+B|0,B=v+(B<<1)|0,p[_>>2]=B,p[D>>2]=w,m=(v<<1)+m|0,p[c>>2]=m,v=w-B|0,(B|0)<0?(m=m-B|0,p[D>>2]=v,p[c>>2]=m,p[_>>2]=0,B=0):v=w,(v|0)<0&&(B=B-v|0,p[_>>2]=B,m=m-v|0,p[c>>2]=m,p[D>>2]=0,v=0),M=B-m|0,w=v-m|0,(m|0)<0?(p[_>>2]=M,p[D>>2]=w,p[c>>2]=0,B=M,m=0):w=v,v=(w|0)<(B|0)?w:B,v=(m|0)<(v|0)?m:v,!((v|0)<=0)&&(p[_>>2]=B-v,p[D>>2]=w-v,p[c>>2]=m-v)}function il(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0;return D=(p[_>>2]|0)-(p[m>>2]|0)|0,c=(D|0)<0,w=(p[_+4>>2]|0)-(p[m+4>>2]|0)-(c?D:0)|0,M=(w|0)<0,B=(c?0-D|0:0)+(p[_+8>>2]|0)-(p[m+8>>2]|0)+(M?0-w|0:0)|0,_=(B|0)<0,m=_?0:B,v=(M?0:w)-(_?B:0)|0,B=(c?0:D)-(M?w:0)-(_?B:0)|0,_=(v|0)<(B|0)?v:B,_=(m|0)<(_|0)?m:_,w=(_|0)>0,m=m-(w?_:0)|0,v=v-(w?_:0)|0,_=B-(w?_:0)|0,_=(_|0)>-1?_:0-_|0,v=(v|0)>-1?v:0-v|0,m=(m|0)>-1?m:0-m|0,m=(v|0)>(m|0)?v:m,((_|0)>(m|0)?_:m)|0}function ca(_,m){_=_|0,m=m|0;var v=0;v=p[_+8>>2]|0,p[m>>2]=(p[_>>2]|0)-v,p[m+4>>2]=(p[_+4>>2]|0)-v}function la(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0;w=p[_>>2]|0,p[m>>2]=w,B=p[_+4>>2]|0,D=m+4|0,p[D>>2]=B,c=m+8|0,p[c>>2]=0,v=(B|0)<(w|0),_=v?w:B,v=v?B:w;do if((v|0)<0){if((_|0)>0){if((_|-2147483648|0)<(v|0)&((v|0)!=-2147483648&(2147483647-_|0)>=(v|0)))break;return _=1,_|0}if((v|0)==-2147483648|(-2147483648-_|0)>(v|0))return m=1,m|0;if((_|0)>-1){if((_|-2147483648|0)<(v|0))break;return _=1,_|0}else{if((_^-2147483648|0)<(v|0))_=1;else break;return _|0}}while(!1);return _=B-w|0,(w|0)<0?(v=0-w|0,p[D>>2]=_,p[c>>2]=v,p[m>>2]=0,w=0):(_=B,v=0),(_|0)<0&&(w=w-_|0,p[m>>2]=w,v=v-_|0,p[c>>2]=v,p[D>>2]=0,_=0),M=w-v|0,B=_-v|0,(v|0)<0?(p[m>>2]=M,p[D>>2]=B,p[c>>2]=0,_=B,B=M,v=0):B=w,w=(_|0)<(B|0)?_:B,w=(v|0)<(w|0)?v:w,(w|0)<=0?(m=0,m|0):(p[m>>2]=B-w,p[D>>2]=_-w,p[c>>2]=v-w,m=0,m|0)}function ua(_){_=_|0;var m=0,v=0,w=0,B=0;m=_+8|0,B=p[m>>2]|0,v=B-(p[_>>2]|0)|0,p[_>>2]=v,w=_+4|0,_=(p[w>>2]|0)-B|0,p[w>>2]=_,p[m>>2]=0-(_+v)}function Ma(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;v=p[_>>2]|0,m=0-v|0,p[_>>2]=m,D=_+8|0,p[D>>2]=0,c=_+4|0,w=p[c>>2]|0,B=w+v|0,(v|0)>0?(p[c>>2]=B,p[D>>2]=v,p[_>>2]=0,m=0,w=B):v=0,(w|0)<0?(M=m-w|0,p[_>>2]=M,v=v-w|0,p[D>>2]=v,p[c>>2]=0,B=M-v|0,m=0-v|0,(v|0)<0?(p[_>>2]=B,p[c>>2]=m,p[D>>2]=0,w=m,v=0):(w=0,B=M)):B=m,m=(w|0)<(B|0)?w:B,m=(v|0)<(m|0)?v:m,!((m|0)<=0)&&(p[_>>2]=B-m,p[c>>2]=w-m,p[D>>2]=v-m)}function fa(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0;if(C=Se,Se=Se+64|0,g=C,c=C+56|0,!(!0&(m&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return B=5,Se=C,B|0;if((_|0)==(v|0)&(m|0)==(w|0))return p[B>>2]=0,B=0,Se=C,B|0;if(D=Ht(_|0,m|0,52)|0,Ie()|0,D=D&15,f=Ht(v|0,w|0,52)|0,Ie()|0,(D|0)!=(f&15|0))return B=12,Se=C,B|0;if(M=D+-1|0,D>>>0>1){ko(_,m,M,g)|0,ko(v,w,M,c)|0,f=g,h=p[f>>2]|0,f=p[f+4>>2]|0;e:do if((h|0)==(p[c>>2]|0)&&(f|0)==(p[c+4>>2]|0)){D=(D^15)*3|0,M=Ht(_|0,m|0,D|0)|0,Ie()|0,M=M&7,D=Ht(v|0,w|0,D|0)|0,Ie()|0,D=D&7;do if((M|0)==0|(D|0)==0)p[B>>2]=1,M=0;else if((M|0)==7)M=5;else{if((M|0)==1|(D|0)==1&&Bn(h,f)|0){M=5;break}if((p[15536+(M<<2)>>2]|0)!=(D|0)&&(p[15568+(M<<2)>>2]|0)!=(D|0))break e;p[B>>2]=1,M=0}while(!1);return B=M,Se=C,B|0}while(!1)}M=g,D=M+56|0;do p[M>>2]=0,M=M+4|0;while((M|0)<(D|0));return En(_,m,1,g)|0,m=g,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0))&&(m=g+8|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+16|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+24|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+32|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))&&(m=g+40|0,!((p[m>>2]|0)==(v|0)&&(p[m+4>>2]|0)==(w|0)))?(M=g+48|0,M=((p[M>>2]|0)==(v|0)?(p[M+4>>2]|0)==(w|0):0)&1):M=1,p[B>>2]=M,B=0,Se=C,B|0}function Pa(_,m,v,w,B){return _=_|0,m=m|0,v=v|0,w=w|0,B=B|0,v=Qc(_,m,v,w)|0,(v|0)==7?(B=11,B|0):(w=Yt(v|0,0,56)|0,m=m&-2130706433|(Ie()|0)|268435456,p[B>>2]=_|w,p[B+4>>2]=m,B=0,B|0)}function Ra(_,m,v){return _=_|0,m=m|0,v=v|0,!0&(m&2013265920|0)==268435456?(p[v>>2]=_,p[v+4>>2]=m&-2130706433|134217728,v=0,v|0):(v=6,v|0)}function ha(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;return B=Se,Se=Se+16|0,w=B,p[w>>2]=0,!0&(m&2013265920|0)==268435456?(M=Ht(_|0,m|0,56)|0,Ie()|0,w=xn(_,m&-2130706433|134217728,M&7,w,v)|0,Se=B,w|0):(w=6,Se=B,w|0)}function fh(_,m){_=_|0,m=m|0;var v=0;switch(v=Ht(_|0,m|0,56)|0,Ie()|0,v&7){case 0:case 7:return v=0,v|0}return v=m&-2130706433|134217728,!(!0&(m&2013265920|0)==268435456)||!0&(m&117440512|0)==16777216&(Bn(_,v)|0)!=0?(v=0,v|0):(v=No(_,v)|0,v|0)}function hh(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0;return B=Se,Se=Se+16|0,w=B,!0&(m&2013265920|0)==268435456?(M=m&-2130706433|134217728,D=v,p[D>>2]=_,p[D+4>>2]=M,p[w>>2]=0,m=Ht(_|0,m|0,56)|0,Ie()|0,w=xn(_,M,m&7,w,v+8|0)|0,Se=B,w|0):(w=6,Se=B,w|0)}function wn(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0;return B=(Bn(_,m)|0)==0,m=m&-2130706433,w=v,p[w>>2]=B?_:0,p[w+4>>2]=B?m|285212672:0,w=v+8|0,p[w>>2]=_,p[w+4>>2]=m|301989888,w=v+16|0,p[w>>2]=_,p[w+4>>2]=m|318767104,w=v+24|0,p[w>>2]=_,p[w+4>>2]=m|335544320,w=v+32|0,p[w>>2]=_,p[w+4>>2]=m|352321536,v=v+40|0,p[v>>2]=_,p[v+4>>2]=m|369098752,0}function Vl(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0;return D=Se,Se=Se+16|0,B=D,M=m&-2130706433|134217728,!0&(m&2013265920|0)==268435456?(w=Ht(_|0,m|0,56)|0,Ie()|0,w=uo(_,M,w&7)|0,(w|0)==-1?(p[v>>2]=0,M=6,Se=D,M|0):(La(_,M,B)|0&&jt(23313,22484,282,22499),m=Ht(_|0,m|0,52)|0,Ie()|0,m=m&15,Bn(_,M)|0?Oo(B,m,w,2,v):jl(B,m,w,2,v),M=0,Se=D,M|0)):(M=6,Se=D,M|0)}function Hl(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0;w=Se,Se=Se+16|0,B=w,dh(_,m,v,B),aa(B,v+4|0),Se=w}function dh(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0;if(c=Se,Se=Se+16|0,h=c,Ah(_,v,h),M=+Dr(+(1-+ce[h>>3]*.5)),M<1e-16){p[w>>2]=0,p[w+4>>2]=0,p[w+8>>2]=0,p[w+12>>2]=0,Se=c;return}if(h=p[v>>2]|0,B=+ce[15920+(h*24|0)>>3],B=+yc(B-+yc(+Zu(15600+(h<<4)|0,_))),Is(m)|0?D=+yc(B+-.3334731722518321):D=B,B=+Ut(+M)/.381966011250105,(m|0)>0){_=0;do B=B*2.6457513110645907,_=_+1|0;while((_|0)!=(m|0))}M=+Ft(+D)*B,ce[w>>3]=M,D=+Bt(+D)*B,ce[w+8>>3]=D,Se=c}function Ah(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(M=Se,Se=Se+32|0,B=M,nf(_,B),p[m>>2]=0,ce[v>>3]=5,w=+mi(16400,B),w<+ce[v>>3]&&(p[m>>2]=0,ce[v>>3]=w),w=+mi(16424,B),w<+ce[v>>3]&&(p[m>>2]=1,ce[v>>3]=w),w=+mi(16448,B),w<+ce[v>>3]&&(p[m>>2]=2,ce[v>>3]=w),w=+mi(16472,B),w<+ce[v>>3]&&(p[m>>2]=3,ce[v>>3]=w),w=+mi(16496,B),w<+ce[v>>3]&&(p[m>>2]=4,ce[v>>3]=w),w=+mi(16520,B),w<+ce[v>>3]&&(p[m>>2]=5,ce[v>>3]=w),w=+mi(16544,B),w<+ce[v>>3]&&(p[m>>2]=6,ce[v>>3]=w),w=+mi(16568,B),w<+ce[v>>3]&&(p[m>>2]=7,ce[v>>3]=w),w=+mi(16592,B),w<+ce[v>>3]&&(p[m>>2]=8,ce[v>>3]=w),w=+mi(16616,B),w<+ce[v>>3]&&(p[m>>2]=9,ce[v>>3]=w),w=+mi(16640,B),w<+ce[v>>3]&&(p[m>>2]=10,ce[v>>3]=w),w=+mi(16664,B),w<+ce[v>>3]&&(p[m>>2]=11,ce[v>>3]=w),w=+mi(16688,B),w<+ce[v>>3]&&(p[m>>2]=12,ce[v>>3]=w),w=+mi(16712,B),w<+ce[v>>3]&&(p[m>>2]=13,ce[v>>3]=w),w=+mi(16736,B),w<+ce[v>>3]&&(p[m>>2]=14,ce[v>>3]=w),w=+mi(16760,B),w<+ce[v>>3]&&(p[m>>2]=15,ce[v>>3]=w),w=+mi(16784,B),w<+ce[v>>3]&&(p[m>>2]=16,ce[v>>3]=w),w=+mi(16808,B),w<+ce[v>>3]&&(p[m>>2]=17,ce[v>>3]=w),w=+mi(16832,B),w<+ce[v>>3]&&(p[m>>2]=18,ce[v>>3]=w),w=+mi(16856,B),!(w<+ce[v>>3])){Se=M;return}p[m>>2]=19,ce[v>>3]=w,Se=M}function dc(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0;if(M=+Go(_),M<1e-16){m=15600+(m<<4)|0,p[B>>2]=p[m>>2],p[B+4>>2]=p[m+4>>2],p[B+8>>2]=p[m+8>>2],p[B+12>>2]=p[m+12>>2];return}if(D=+tn(+ +ce[_+8>>3],+ +ce[_>>3]),(v|0)>0){_=0;do M=M/2.6457513110645907,_=_+1|0;while((_|0)!=(v|0))}w?(M=M/3,v=(Is(v)|0)==0,M=+Kr(+((v?M:M/2.6457513110645907)*.381966011250105))):(M=+Kr(+(M*.381966011250105)),Is(v)|0&&(D=+yc(D+.3334731722518321))),cl(15600+(m<<4)|0,+yc(+ce[15920+(m*24|0)>>3]-D),M,B)}function ph(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0;w=Se,Se=Se+16|0,B=w,_o(_+4|0,B),dc(B,p[_>>2]|0,m,0,v),Se=w}function Oo(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0,Ve=0,$e=0,rt=0,Je=0,Ze=0,ft=0,Pt=0,bt=0;if(ft=Se,Se=Se+272|0,M=ft+256|0,Z=ft+240|0,rt=ft,Je=ft+224|0,Ze=ft+208|0,te=ft+176|0,se=ft+160|0,we=ft+192|0,Fe=ft+144|0,ge=ft+128|0,Re=ft+112|0,Ve=ft+96|0,$e=ft+80|0,p[M>>2]=m,p[Z>>2]=p[_>>2],p[Z+4>>2]=p[_+4>>2],p[Z+8>>2]=p[_+8>>2],p[Z+12>>2]=p[_+12>>2],Lo(Z,M,rt),p[B>>2]=0,Z=w+v+((w|0)==5&1)|0,(Z|0)<=(v|0)){Se=ft;return}h=p[M>>2]|0,f=Je+4|0,g=te+4|0,C=v+5|0,P=16880+(h<<2)|0,R=16960+(h<<2)|0,L=ge+8|0,z=Re+8|0,W=Ve+8|0,ee=Ze+4|0,c=v;e:for(;;){D=rt+(((c|0)%5|0)<<4)|0,p[Ze>>2]=p[D>>2],p[Ze+4>>2]=p[D+4>>2],p[Ze+8>>2]=p[D+8>>2],p[Ze+12>>2]=p[D+12>>2];do;while((js(Ze,h,0,1)|0)==2);if((c|0)>(v|0)&(Is(m)|0)!=0){if(p[te>>2]=p[Ze>>2],p[te+4>>2]=p[Ze+4>>2],p[te+8>>2]=p[Ze+8>>2],p[te+12>>2]=p[Ze+12>>2],_o(f,se),w=p[te>>2]|0,M=p[17040+(w*80|0)+(p[Je>>2]<<2)>>2]|0,p[te>>2]=p[18640+(w*80|0)+(M*20|0)>>2],D=p[18640+(w*80|0)+(M*20|0)+16>>2]|0,(D|0)>0){_=0;do Xu(g),_=_+1|0;while((_|0)<(D|0))}switch(D=18640+(w*80|0)+(M*20|0)+4|0,p[we>>2]=p[D>>2],p[we+4>>2]=p[D+4>>2],p[we+8>>2]=p[D+8>>2],Ia(we,(p[P>>2]|0)*3|0),Dn(g,we,g),hi(g),_o(g,Fe),Pt=+(p[R>>2]|0),ce[ge>>3]=Pt*3,ce[L>>3]=0,bt=Pt*-1.5,ce[Re>>3]=bt,ce[z>>3]=Pt*2.598076211353316,ce[Ve>>3]=bt,ce[W>>3]=Pt*-2.598076211353316,p[17040+((p[te>>2]|0)*80|0)+(p[Ze>>2]<<2)>>2]|0){case 1:{_=Re,w=ge;break}case 3:{_=Ve,w=Re;break}case 2:{_=ge,w=Ve;break}default:{_=12;break e}}rf(se,Fe,w,_,$e),dc($e,p[te>>2]|0,h,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1}if((c|0)<(C|0)&&(_o(ee,te),dc(te,p[Ze>>2]|0,h,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1),p[Je>>2]=p[Ze>>2],p[Je+4>>2]=p[Ze+4>>2],p[Je+8>>2]=p[Ze+8>>2],p[Je+12>>2]=p[Ze+12>>2],c=c+1|0,(c|0)>=(Z|0)){_=3;break}}if((_|0)==3){Se=ft;return}else(_|0)==12&&jt(22522,22569,571,22579)}function Lo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0;h=Se,Se=Se+128|0,w=h+64|0,B=h,M=w,D=20240,c=M+60|0;do p[M>>2]=p[D>>2],M=M+4|0,D=D+4|0;while((M|0)<(c|0));M=B,D=20304,c=M+60|0;do p[M>>2]=p[D>>2],M=M+4|0,D=D+4|0;while((M|0)<(c|0));c=(Is(p[m>>2]|0)|0)==0,w=c?w:B,B=_+4|0,Ku(B),Ri(B),Is(p[m>>2]|0)|0&&(Do(B),p[m>>2]=(p[m>>2]|0)+1),p[v>>2]=p[_>>2],m=v+4|0,Dn(B,w,m),hi(m),p[v+16>>2]=p[_>>2],m=v+20|0,Dn(B,w+12|0,m),hi(m),p[v+32>>2]=p[_>>2],m=v+36|0,Dn(B,w+24|0,m),hi(m),p[v+48>>2]=p[_>>2],m=v+52|0,Dn(B,w+36|0,m),hi(m),p[v+64>>2]=p[_>>2],v=v+68|0,Dn(B,w+48|0,v),hi(v),Se=h}function js(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0;if(L=Se,Se=Se+32|0,P=L+12|0,c=L,R=_+4|0,C=p[16960+(m<<2)>>2]|0,g=(w|0)!=0,C=g?C*3|0:C,B=p[R>>2]|0,f=_+8|0,D=p[f>>2]|0,g){if(M=_+12|0,w=p[M>>2]|0,B=D+B+w|0,(B|0)==(C|0))return R=1,Se=L,R|0;h=M}else h=_+12|0,w=p[h>>2]|0,B=D+B+w|0;if((B|0)<=(C|0))return R=0,Se=L,R|0;do if((w|0)>0){if(w=p[_>>2]|0,(D|0)>0){M=18640+(w*80|0)+60|0,w=_;break}w=18640+(w*80|0)+40|0,v?(Sa(P,C,0,0),ii(R,P,c),Gl(c),Dn(c,P,R),M=w,w=_):(M=w,w=_)}else M=18640+((p[_>>2]|0)*80|0)+20|0,w=_;while(!1);if(p[w>>2]=p[M>>2],B=M+16|0,(p[B>>2]|0)>0){w=0;do Xu(R),w=w+1|0;while((w|0)<(p[B>>2]|0))}return _=M+4|0,p[P>>2]=p[_>>2],p[P+4>>2]=p[_+4>>2],p[P+8>>2]=p[_+8>>2],m=p[16880+(m<<2)>>2]|0,Ia(P,g?m*3|0:m),Dn(R,P,R),hi(R),g?w=((p[f>>2]|0)+(p[R>>2]|0)+(p[h>>2]|0)|0)==(C|0)?1:2:w=2,R=w,Se=L,R|0}function gh(_,m){_=_|0,m=m|0;var v=0;do v=js(_,m,0,1)|0;while((v|0)==2);return v|0}function jl(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0,Ve=0,$e=0,rt=0;if(Ve=Se,Se=Se+240|0,M=Ve+224|0,we=Ve+208|0,Fe=Ve,ge=Ve+192|0,Re=Ve+176|0,W=Ve+160|0,ee=Ve+144|0,Z=Ve+128|0,te=Ve+112|0,se=Ve+96|0,p[M>>2]=m,p[we>>2]=p[_>>2],p[we+4>>2]=p[_+4>>2],p[we+8>>2]=p[_+8>>2],p[we+12>>2]=p[_+12>>2],$l(we,M,Fe),p[B>>2]=0,z=w+v+((w|0)==6&1)|0,(z|0)<=(v|0)){Se=Ve;return}h=p[M>>2]|0,f=v+6|0,g=16960+(h<<2)|0,C=ee+8|0,P=Z+8|0,R=te+8|0,L=ge+4|0,D=0,c=v,w=-1;e:for(;;){if(M=(c|0)%6|0,_=Fe+(M<<4)|0,p[ge>>2]=p[_>>2],p[ge+4>>2]=p[_+4>>2],p[ge+8>>2]=p[_+8>>2],p[ge+12>>2]=p[_+12>>2],_=D,D=js(ge,h,0,1)|0,(c|0)>(v|0)&(Is(m)|0)!=0&&(_|0)!=1&&(p[ge>>2]|0)!=(w|0)){switch(_o(Fe+(((M+5|0)%6|0)<<4)+4|0,Re),_o(Fe+(M<<4)+4|0,W),$e=+(p[g>>2]|0),ce[ee>>3]=$e*3,ce[C>>3]=0,rt=$e*-1.5,ce[Z>>3]=rt,ce[P>>3]=$e*2.598076211353316,ce[te>>3]=rt,ce[R>>3]=$e*-2.598076211353316,M=p[we>>2]|0,p[17040+(M*80|0)+(((w|0)==(M|0)?p[ge>>2]|0:w)<<2)>>2]|0){case 1:{_=Z,w=ee;break}case 3:{_=te,w=Z;break}case 2:{_=ee,w=te;break}default:{_=8;break e}}rf(Re,W,w,_,se),!(wc(Re,se)|0)&&!(wc(W,se)|0)&&(dc(se,p[we>>2]|0,h,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1)}if((c|0)<(f|0)&&(_o(L,Re),dc(Re,p[ge>>2]|0,h,1,B+8+(p[B>>2]<<4)|0),p[B>>2]=(p[B>>2]|0)+1),c=c+1|0,(c|0)>=(z|0)){_=3;break}else w=p[ge>>2]|0}if((_|0)==3){Se=Ve;return}else(_|0)==8&&jt(22606,22569,736,22651)}function $l(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0;h=Se,Se=Se+160|0,w=h+80|0,B=h,M=w,D=20368,c=M+72|0;do p[M>>2]=p[D>>2],M=M+4|0,D=D+4|0;while((M|0)<(c|0));M=B,D=20448,c=M+72|0;do p[M>>2]=p[D>>2],M=M+4|0,D=D+4|0;while((M|0)<(c|0));c=(Is(p[m>>2]|0)|0)==0,w=c?w:B,B=_+4|0,Ku(B),Ri(B),Is(p[m>>2]|0)|0&&(Do(B),p[m>>2]=(p[m>>2]|0)+1),p[v>>2]=p[_>>2],m=v+4|0,Dn(B,w,m),hi(m),p[v+16>>2]=p[_>>2],m=v+20|0,Dn(B,w+12|0,m),hi(m),p[v+32>>2]=p[_>>2],m=v+36|0,Dn(B,w+24|0,m),hi(m),p[v+48>>2]=p[_>>2],m=v+52|0,Dn(B,w+36|0,m),hi(m),p[v+64>>2]=p[_>>2],m=v+68|0,Dn(B,w+48|0,m),hi(m),p[v+80>>2]=p[_>>2],v=v+84|0,Dn(B,w+60|0,v),hi(v),Se=h}function Fa(_,m){return _=_|0,m=m|0,m=Ht(_|0,m|0,52)|0,Ie()|0,m&15|0}function qu(_,m){return _=_|0,m=m|0,m=Ht(_|0,m|0,45)|0,Ie()|0,m&127|0}function No(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0;if(!(!0&(m&-16777216|0)==134217728)||(D=Ht(_|0,m|0,45)|0,Ie()|0,D=D&127,D>>>0>121))return m=0,m|0;v=Ht(_|0,m|0,52)|0,Ie()|0,v=v&15;do if(v|0){for(B=1,w=0;;){if(M=Ht(_|0,m|0,(15-B|0)*3|0)|0,Ie()|0,M=M&7,(M|0)!=0&(w^1))if((M|0)==1&(Cr(D)|0)!=0){c=0,w=13;break}else w=1;if((M|0)==7){c=0,w=13;break}if(B>>>0<v>>>0)B=B+1|0;else{w=9;break}}if((w|0)==9){if((v|0)==15)c=1;else break;return c|0}else if((w|0)==13)return c|0}while(!1);for(;;){if(c=Ht(_|0,m|0,(14-v|0)*3|0)|0,Ie()|0,!((c&7|0)==7&!0)){c=0,w=13;break}if(v>>>0<14)v=v+1|0;else{c=1,w=13;break}}return(w|0)==13?c|0:0}function ko(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;if(M=Ht(_|0,m|0,52)|0,Ie()|0,M=M&15,v>>>0>15)return w=4,w|0;if((M|0)<(v|0))return w=12,w|0;if((M|0)==(v|0))return p[w>>2]=_,p[w+4>>2]=m,w=0,w|0;if(B=Yt(v|0,0,52)|0,B=B|_,_=Ie()|0|m&-15728641,(M|0)>(v|0))do m=Yt(7,0,(14-v|0)*3|0)|0,v=v+1|0,B=m|B,_=Ie()|0|_;while((v|0)<(M|0));return p[w>>2]=B,p[w+4>>2]=_,w=0,w|0}function sl(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0;if(M=Ht(_|0,m|0,52)|0,Ie()|0,M=M&15,!((v|0)<16&(M|0)<=(v|0)))return w=4,w|0;B=v-M|0,v=Ht(_|0,m|0,45)|0,Ie()|0;e:do if(!(Cr(v&127)|0))v=Rs(7,0,B,((B|0)<0)<<31>>31)|0,B=Ie()|0;else{t:do if(M|0){for(v=1;D=Yt(7,0,(15-v|0)*3|0)|0,!!((D&_|0)==0&((Ie()|0)&m|0)==0);)if(v>>>0<M>>>0)v=v+1|0;else break t;v=Rs(7,0,B,((B|0)<0)<<31>>31)|0,B=Ie()|0;break e}while(!1);v=Rs(7,0,B,((B|0)<0)<<31>>31)|0,v=si(v|0,Ie()|0,5,0)|0,v=ln(v|0,Ie()|0,-5,-1)|0,v=Fs(v|0,Ie()|0,6,0)|0,v=ln(v|0,Ie()|0,1,0)|0,B=Ie()|0}while(!1);return D=w,p[D>>2]=v,p[D+4>>2]=B,D=0,D|0}function Bn(_,m){_=_|0,m=m|0;var v=0,w=0,B=0;if(B=Ht(_|0,m|0,45)|0,Ie()|0,!(Cr(B&127)|0))return B=0,B|0;B=Ht(_|0,m|0,52)|0,Ie()|0,B=B&15;e:do if(!B)v=0;else for(w=1;;){if(v=Ht(_|0,m|0,(15-w|0)*3|0)|0,Ie()|0,v=v&7,v|0)break e;if(w>>>0<B>>>0)w=w+1|0;else{v=0;break}}while(!1);return B=(v|0)==0&1,B|0}function In(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0;if(D=Se,Se=Se+16|0,M=D,al(M,_,m,v),m=M,_=p[m>>2]|0,m=p[m+4>>2]|0,(_|0)==0&(m|0)==0)return Se=D,0;B=0,v=0;do c=w+(B<<3)|0,p[c>>2]=_,p[c+4>>2]=m,B=ln(B|0,v|0,1,0)|0,v=Ie()|0,ql(M),c=M,_=p[c>>2]|0,m=p[c+4>>2]|0;while(!((_|0)==0&(m|0)==0));return Se=D,0}function Wl(_,m,v,w){return _=_|0,m=m|0,v=v|0,w=w|0,(w|0)<(v|0)?(v=m,w=_,ur(v|0),w|0):(v=Yt(-1,-1,((w-v|0)*3|0)+3|0)|0,w=Yt(~v|0,~(Ie()|0)|0,(15-w|0)*3|0)|0,v=~(Ie()|0)&m,w=~w&_,ur(v|0),w|0)}function FA(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0;return B=Ht(_|0,m|0,52)|0,Ie()|0,B=B&15,(v|0)<16&(B|0)<=(v|0)?((B|0)<(v|0)&&(B=Yt(-1,-1,((v+-1-B|0)*3|0)+3|0)|0,B=Yt(~B|0,~(Ie()|0)|0,(15-v|0)*3|0)|0,m=~(Ie()|0)&m,_=~B&_),B=Yt(v|0,0,52)|0,v=m&-15728641|(Ie()|0),p[w>>2]=_|B,p[w+4>>2]=v,w=0,w|0):(w=4,w|0)}function Ac(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0;if((v|0)==0&(w|0)==0)return ge=0,ge|0;if(B=_,M=p[B>>2]|0,B=p[B+4>>2]|0,!0&(B&15728640|0)==0){if(!((w|0)>0|(w|0)==0&v>>>0>0)||(ge=m,p[ge>>2]=M,p[ge+4>>2]=B,(v|0)==1&(w|0)==0))return ge=0,ge|0;B=1;do we=_+(B<<3)|0,Fe=p[we+4>>2]|0,ge=m+(B<<3)|0,p[ge>>2]=p[we>>2],p[ge+4>>2]=Fe,B=B+1|0;while(0<(w|0)|(w|0)==0&B>>>0<v>>>0);return B=0,B|0}if(se=v<<3,Fe=Gn(se)|0,!Fe)return ge=13,ge|0;if(bo(Fe|0,_|0,se|0)|0,we=Ks(v,8)|0,!we)return Or(Fe),ge=13,ge|0;e:do if(v|0){t:for(;;){B=Fe,ee=p[B>>2]|0,B=p[B+4>>2]|0,Z=Ht(ee|0,B|0,52)|0,Ie()|0,Z=Z&15,te=Z+-1|0,W=(v|0)>0;r:do if((Z|0)!=0&W){if(R=((v|0)<0)<<31>>31,L=Yt(te|0,0,52)|0,z=Ie()|0,te>>>0>15){if(!((ee|0)==0&(B|0)==0)){ge=17;break t}for(M=0;;){if(M=M+1|0,(M|0)>=(v|0))break r;if(w=Fe+(M<<3)|0,z=p[w>>2]|0,w=p[w+4>>2]|0,!((z|0)==0&(w|0)==0)){B=w,ge=17;break t}}}for(M=0,_=ee,w=B;;){if(!((_|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){ge=22;break t}if(c=Ht(_|0,w|0,52)|0,Ie()|0,c=c&15,(c|0)<(te|0)){B=12,ge=28;break t}if((c|0)!=(te|0)&&(_=_|L,w=w&-15728641|z,c>>>0>=Z>>>0)){D=te;do P=Yt(7,0,(14-D|0)*3|0)|0,D=D+1|0,_=P|_,w=Ie()|0|w;while(D>>>0<c>>>0)}if(D=fo(_|0,w|0,v|0,R|0)|0,Ie()|0,f=we+(D<<3)|0,c=f,h=p[c>>2]|0,c=p[c+4>>2]|0,(h|0)==0&(c|0)==0)D=f;else for(P=0;;){if((P|0)>(v|0)){ge=32;break t}if((h|0)==(_|0)&(c&-117440513|0)==(w|0)){g=Ht(h|0,c|0,56)|0,Ie()|0,g=g&7,C=g+1|0,Re=Ht(h|0,c|0,45)|0,Ie()|0;n:do if(!(Cr(Re&127)|0))c=7;else{if(h=Ht(h|0,c|0,52)|0,Ie()|0,h=h&15,!h){c=6;break}for(c=1;;){if(Re=Yt(7,0,(15-c|0)*3|0)|0,!((Re&_|0)==0&((Ie()|0)&w|0)==0)){c=7;break n}if(c>>>0<h>>>0)c=c+1|0;else{c=6;break}}}while(!1);if((g+2|0)>>>0>c>>>0){ge=42;break t}Re=Yt(C|0,0,56)|0,w=Ie()|0|w&-117440513,C=f,p[C>>2]=0,p[C+4>>2]=0,_=Re|_}else D=(D+1|0)%(v|0)|0;if(f=we+(D<<3)|0,c=f,h=p[c>>2]|0,c=p[c+4>>2]|0,(h|0)==0&(c|0)==0){D=f;break}else P=P+1|0}Re=D,p[Re>>2]=_,p[Re+4>>2]=w}if(M=M+1|0,(M|0)>=(v|0))break r;w=Fe+(M<<3)|0,_=p[w>>2]|0,w=p[w+4>>2]|0}}while(!1);if((v+5|0)>>>0<11){ge=85;break}if(z=Ks((v|0)/6|0,8)|0,!z){ge=49;break}r:do if(W){P=0,C=0;do{if(c=we+(P<<3)|0,w=c,M=p[w>>2]|0,w=p[w+4>>2]|0,!((M|0)==0&(w|0)==0)){h=Ht(M|0,w|0,56)|0,Ie()|0,h=h&7,_=h+1|0,f=w&-117440513,Re=Ht(M|0,w|0,45)|0,Ie()|0;n:do if(Cr(Re&127)|0){if(g=Ht(M|0,w|0,52)|0,Ie()|0,g=g&15,g|0)for(D=1;;){if(Re=Yt(7,0,(15-D|0)*3|0)|0,!((M&Re|0)==0&(f&(Ie()|0)|0)==0))break n;if(D>>>0<g>>>0)D=D+1|0;else break}w=Yt(_|0,0,56)|0,M=w|M,w=Ie()|0|f,_=c,p[_>>2]=M,p[_+4>>2]=w,_=h+2|0}while(!1);(_|0)==7&&(Re=z+(C<<3)|0,p[Re>>2]=M,p[Re+4>>2]=w&-117440513,C=C+1|0)}P=P+1|0}while((P|0)!=(v|0));if(W){if(P=((v|0)<0)<<31>>31,R=Yt(te|0,0,52)|0,L=Ie()|0,te>>>0>15){if(!((ee|0)==0&(B|0)==0)){B=4,ge=84;break t}for(B=0;;){if(B=B+1|0,(B|0)>=(v|0)){M=0,B=C;break r}if(Re=Fe+(B<<3)|0,!((p[Re>>2]|0)==0&(p[Re+4>>2]|0)==0)){B=4,ge=84;break t}}}for(g=0,M=0,f=ee;;){do if(!((f|0)==0&(B|0)==0)){if(c=Ht(f|0,B|0,52)|0,Ie()|0,c=c&15,(c|0)<(te|0)){B=12,ge=84;break t}do if((c|0)==(te|0))w=f,c=B;else{if(w=f|R,_=B&-15728641|L,c>>>0<Z>>>0){c=_;break}D=te;do Re=Yt(7,0,(14-D|0)*3|0)|0,D=D+1|0,w=Re|w,_=Ie()|0|_;while(D>>>0<c>>>0);c=_}while(!1);for(D=fo(w|0,c|0,v|0,P|0)|0,Ie()|0,_=0;;){if((_|0)>(v|0)){ge=77;break t}if(Re=we+(D<<3)|0,h=p[Re+4>>2]|0,(h&-117440513|0)==(c|0)&&(p[Re>>2]|0)==(w|0)){ge=79;break}if(D=(D+1|0)%(v|0)|0,Re=we+(D<<3)|0,(p[Re>>2]|0)==(w|0)&&(p[Re+4>>2]|0)==(c|0))break;_=_+1|0}if((ge|0)==79&&(ge=0,!0&(h&117440512|0)==100663296))break;Re=m+(M<<3)|0,p[Re>>2]=f,p[Re+4>>2]=B,M=M+1|0}while(!1);if(B=g+1|0,(B|0)>=(v|0)){B=C;break r}Re=Fe+(B<<3)|0,g=B,f=p[Re>>2]|0,B=p[Re+4>>2]|0}}else M=0,B=C}else M=0,B=0;while(!1);if(jo(we|0,0,se|0)|0,bo(Fe|0,z|0,B<<3|0)|0,Or(z),B)m=m+(M<<3)|0,v=B;else break e}if((ge|0)==17)!0&(B&117440512|0)==0?(B=4,ge=28):ge=22;else if((ge|0)==32)jt(23313,22674,362,22684);else{if((ge|0)==42)return Or(Fe),Or(we),Re=10,Re|0;if((ge|0)==49)return Or(Fe),Or(we),Re=13,Re|0;if((ge|0)==77)jt(23313,22674,462,22684);else{if((ge|0)==84)return Or(z),Or(Fe),Or(we),Re=B,Re|0;if((ge|0)==85){bo(m|0,Fe|0,v<<3|0)|0;break}}}if((ge|0)==22)return Or(Fe),Or(we),Re=5,Re|0;if((ge|0)==28)return Or(Fe),Or(we),Re=B,Re|0}while(!1);return Or(Fe),Or(we),Re=0,Re|0}function mh(_,m,v,w,B,M,D){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0,D=D|0;var c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0;if(z=Se,Se=Se+16|0,L=z,!((v|0)>0|(v|0)==0&m>>>0>0))return L=0,Se=z,L|0;if((D|0)>=16)return L=12,Se=z,L|0;P=0,R=0,C=0,c=0;e:for(;;){if(f=_+(P<<3)|0,h=p[f>>2]|0,f=p[f+4>>2]|0,g=Ht(h|0,f|0,52)|0,Ie()|0,(g&15|0)>(D|0)){c=12,h=11;break}if(al(L,h,f,D),g=L,f=p[g>>2]|0,g=p[g+4>>2]|0,(f|0)==0&(g|0)==0)h=C;else{h=C;do{if(!((c|0)<(M|0)|(c|0)==(M|0)&h>>>0<B>>>0)){h=10;break e}C=w+(h<<3)|0,p[C>>2]=f,p[C+4>>2]=g,h=ln(h|0,c|0,1,0)|0,c=Ie()|0,ql(L),C=L,f=p[C>>2]|0,g=p[C+4>>2]|0}while(!((f|0)==0&(g|0)==0))}if(P=ln(P|0,R|0,1,0)|0,R=Ie()|0,(R|0)<(v|0)|(R|0)==(v|0)&P>>>0<m>>>0)C=h;else{c=0,h=11;break}}return(h|0)==10?(L=14,Se=z,L|0):(h|0)==11?(Se=z,c|0):0}function DA(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0;P=Se,Se=Se+16|0,C=P;e:do if((v|0)>0|(v|0)==0&m>>>0>0){for(f=0,D=0,M=0,g=0;;){if(h=_+(f<<3)|0,c=p[h>>2]|0,h=p[h+4>>2]|0,!((c|0)==0&(h|0)==0)&&(h=(sl(c,h,w,C)|0)==0,c=C,D=ln(p[c>>2]|0,p[c+4>>2]|0,D|0,M|0)|0,M=Ie()|0,!h)){M=12;break}if(f=ln(f|0,g|0,1,0)|0,g=Ie()|0,!((g|0)<(v|0)|(g|0)==(v|0)&f>>>0<m>>>0))break e}return Se=P,M|0}else D=0,M=0;while(!1);return p[B>>2]=D,p[B+4>>2]=M,B=0,Se=P,B|0}function _h(_,m){return _=_|0,m=m|0,m=Ht(_|0,m|0,52)|0,Ie()|0,m&1|0}function Xi(_,m){_=_|0,m=m|0;var v=0,w=0,B=0;if(B=Ht(_|0,m|0,52)|0,Ie()|0,B=B&15,!B)return B=0,B|0;for(w=1;;){if(v=Ht(_|0,m|0,(15-w|0)*3|0)|0,Ie()|0,v=v&7,v|0){w=5;break}if(w>>>0<B>>>0)w=w+1|0;else{v=0,w=5;break}}return(w|0)==5?v|0:0}function da(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0;if(h=Ht(_|0,m|0,52)|0,Ie()|0,h=h&15,!h)return c=m,h=_,ur(c|0),h|0;for(c=1,v=0;;){M=(15-c|0)*3|0,w=Yt(7,0,M|0)|0,B=Ie()|0,D=Ht(_|0,m|0,M|0)|0,Ie()|0,M=Yt(co(D&7)|0,0,M|0)|0,D=Ie()|0,_=M|_&~w,m=D|m&~B;e:do if(!v)if((M&w|0)==0&(D&B|0)==0)v=0;else if(w=Ht(_|0,m|0,52)|0,Ie()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(D=Ht(_|0,m|0,(15-v|0)*3|0)|0,Ie()|0,D&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(D=(15-v|0)*3|0,B=Ht(_|0,m|0,D|0)|0,Ie()|0,M=Yt(7,0,D|0)|0,m=m&~(Ie()|0),D=Yt(co(B&7)|0,0,D|0)|0,_=_&~M|D,m=m|(Ie()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(c>>>0<h>>>0)c=c+1|0;else break}return ur(m|0),_|0}function lo(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0;if(w=Ht(_|0,m|0,52)|0,Ie()|0,w=w&15,!w)return v=m,w=_,ur(v|0),w|0;for(v=1;M=(15-v|0)*3|0,D=Ht(_|0,m|0,M|0)|0,Ie()|0,B=Yt(7,0,M|0)|0,m=m&~(Ie()|0),M=Yt(co(D&7)|0,0,M|0)|0,_=M|_&~B,m=Ie()|0|m,v>>>0<w>>>0;)v=v+1|0;return ur(m|0),_|0}function Jl(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0;if(h=Ht(_|0,m|0,52)|0,Ie()|0,h=h&15,!h)return c=m,h=_,ur(c|0),h|0;for(c=1,v=0;;){M=(15-c|0)*3|0,w=Yt(7,0,M|0)|0,B=Ie()|0,D=Ht(_|0,m|0,M|0)|0,Ie()|0,M=Yt(Hs(D&7)|0,0,M|0)|0,D=Ie()|0,_=M|_&~w,m=D|m&~B;e:do if(!v)if((M&w|0)==0&(D&B|0)==0)v=0;else if(w=Ht(_|0,m|0,52)|0,Ie()|0,w=w&15,!w)v=1;else{v=1;t:for(;;){switch(D=Ht(_|0,m|0,(15-v|0)*3|0)|0,Ie()|0,D&7){case 1:break t;case 0:break;default:{v=1;break e}}if(v>>>0<w>>>0)v=v+1|0;else{v=1;break e}}for(v=1;;)if(B=(15-v|0)*3|0,M=Yt(7,0,B|0)|0,D=m&~(Ie()|0),m=Ht(_|0,m|0,B|0)|0,Ie()|0,m=Yt(Hs(m&7)|0,0,B|0)|0,_=_&~M|m,m=D|(Ie()|0),v>>>0<w>>>0)v=v+1|0;else{v=1;break}}while(!1);if(c>>>0<h>>>0)c=c+1|0;else break}return ur(m|0),_|0}function Da(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0;if(w=Ht(_|0,m|0,52)|0,Ie()|0,w=w&15,!w)return v=m,w=_,ur(v|0),w|0;for(v=1;D=(15-v|0)*3|0,M=Yt(7,0,D|0)|0,B=m&~(Ie()|0),m=Ht(_|0,m|0,D|0)|0,Ie()|0,m=Yt(Hs(m&7)|0,0,D|0)|0,_=m|_&~M,m=Ie()|0|B,v>>>0<w>>>0;)v=v+1|0;return ur(m|0),_|0}function pc(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(h=Se,Se=Se+64|0,c=h+40|0,w=h+24|0,B=h+12|0,M=h,Yt(m|0,0,52)|0,v=Ie()|0|134225919,!m)return(p[_+4>>2]|0)>2||(p[_+8>>2]|0)>2||(p[_+12>>2]|0)>2?(D=0,c=0,ur(D|0),Se=h,c|0):(Yt(Si(_)|0,0,45)|0,D=Ie()|0|v,c=-1,ur(D|0),Se=h,c|0);if(p[c>>2]=p[_>>2],p[c+4>>2]=p[_+4>>2],p[c+8>>2]=p[_+8>>2],p[c+12>>2]=p[_+12>>2],D=c+4|0,(m|0)>0)for(_=-1;p[w>>2]=p[D>>2],p[w+4>>2]=p[D+4>>2],p[w+8>>2]=p[D+8>>2],m&1?(Wu(D),p[B>>2]=p[D>>2],p[B+4>>2]=p[D+4>>2],p[B+8>>2]=p[D+8>>2],hc(B)):(zl(D),p[B>>2]=p[D>>2],p[B+4>>2]=p[D+4>>2],p[B+8>>2]=p[D+8>>2],Do(B)),ii(w,B,M),hi(M),g=(15-m|0)*3|0,f=Yt(7,0,g|0)|0,v=v&~(Ie()|0),g=Yt(nl(M)|0,0,g|0)|0,_=g|_&~f,v=Ie()|0|v,(m|0)>1;)m=m+-1|0;else _=-1;e:do if((p[D>>2]|0)<=2&&(p[c+8>>2]|0)<=2&&(p[c+12>>2]|0)<=2){if(w=Si(c)|0,m=Yt(w|0,0,45)|0,m=m|_,_=Ie()|0|v&-1040385,M=Ui(c)|0,!(Cr(w)|0)){if((M|0)<=0)break;for(B=0;;){if(w=Ht(m|0,_|0,52)|0,Ie()|0,w=w&15,w)for(v=1;g=(15-v|0)*3|0,c=Ht(m|0,_|0,g|0)|0,Ie()|0,f=Yt(7,0,g|0)|0,_=_&~(Ie()|0),g=Yt(co(c&7)|0,0,g|0)|0,m=m&~f|g,_=_|(Ie()|0),v>>>0<w>>>0;)v=v+1|0;if(B=B+1|0,(B|0)==(M|0))break e}}B=Ht(m|0,_|0,52)|0,Ie()|0,B=B&15;t:do if(B){v=1;r:for(;;){switch(g=Ht(m|0,_|0,(15-v|0)*3|0)|0,Ie()|0,g&7){case 1:break r;case 0:break;default:break t}if(v>>>0<B>>>0)v=v+1|0;else break t}if($u(w,p[c>>2]|0)|0)for(v=1;c=(15-v|0)*3|0,f=Yt(7,0,c|0)|0,g=_&~(Ie()|0),_=Ht(m|0,_|0,c|0)|0,Ie()|0,_=Yt(Hs(_&7)|0,0,c|0)|0,m=m&~f|_,_=g|(Ie()|0),v>>>0<B>>>0;)v=v+1|0;else for(v=1;g=(15-v|0)*3|0,c=Ht(m|0,_|0,g|0)|0,Ie()|0,f=Yt(7,0,g|0)|0,_=_&~(Ie()|0),g=Yt(co(c&7)|0,0,g|0)|0,m=m&~f|g,_=_|(Ie()|0),v>>>0<B>>>0;)v=v+1|0}while(!1);if((M|0)>0){v=0;do m=da(m,_)|0,_=Ie()|0,v=v+1|0;while((v|0)!=(M|0))}}else m=0,_=0;while(!1);return f=_,g=m,ur(f|0),Se=h,g|0}function Is(_){return _=_|0,(_|0)%2|0|0}function Oa(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0;return B=Se,Se=Se+16|0,w=B,m>>>0>15?(w=4,Se=B,w|0):(p[_+4>>2]&2146435072|0)==2146435072||(p[_+8+4>>2]&2146435072|0)==2146435072?(w=3,Se=B,w|0):(Hl(_,m,w),m=pc(w,m)|0,w=Ie()|0,p[v>>2]=m,p[v+4>>2]=w,(m|0)==0&(w|0)==0&&jt(23313,22674,786,22697),w=0,Se=B,w|0)}function Ms(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0;if(B=v+4|0,M=Ht(_|0,m|0,52)|0,Ie()|0,M=M&15,D=Ht(_|0,m|0,45)|0,Ie()|0,w=(M|0)==0,Cr(D&127)|0){if(w)return D=1,D|0;w=1}else{if(w)return D=0,D|0;(p[B>>2]|0)==0&&(p[v+8>>2]|0)==0?w=(p[v+12>>2]|0)!=0&1:w=1}for(v=1;v&1?hc(B):Do(B),D=Ht(_|0,m|0,(15-v|0)*3|0)|0,Ie()|0,Ju(B,D&7),v>>>0<M>>>0;)v=v+1|0;return w|0}function La(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(g=Se,Se=Se+16|0,h=g,f=Ht(_|0,m|0,45)|0,Ie()|0,f=f&127,f>>>0>121)return p[v>>2]=0,p[v+4>>2]=0,p[v+8>>2]=0,p[v+12>>2]=0,f=5,Se=g,f|0;e:do if((Cr(f)|0)!=0&&(M=Ht(_|0,m|0,52)|0,Ie()|0,M=M&15,(M|0)!=0)){w=1;t:for(;;){switch(c=Ht(_|0,m|0,(15-w|0)*3|0)|0,Ie()|0,c&7){case 5:break t;case 0:break;default:{w=m;break e}}if(w>>>0<M>>>0)w=w+1|0;else{w=m;break e}}for(B=1,w=m;m=(15-B|0)*3|0,D=Yt(7,0,m|0)|0,c=w&~(Ie()|0),w=Ht(_|0,w|0,m|0)|0,Ie()|0,w=Yt(Hs(w&7)|0,0,m|0)|0,_=_&~D|w,w=c|(Ie()|0),B>>>0<M>>>0;)B=B+1|0}else w=m;while(!1);if(c=7696+(f*28|0)|0,p[v>>2]=p[c>>2],p[v+4>>2]=p[c+4>>2],p[v+8>>2]=p[c+8>>2],p[v+12>>2]=p[c+12>>2],!(Ms(_,w,v)|0))return f=0,Se=g,f|0;if(D=v+4|0,p[h>>2]=p[D>>2],p[h+4>>2]=p[D+4>>2],p[h+8>>2]=p[D+8>>2],M=Ht(_|0,w|0,52)|0,Ie()|0,c=M&15,M&1?(Do(D),M=c+1|0):M=c,!(Cr(f)|0))w=0;else{e:do if(!c)w=0;else for(m=1;;){if(B=Ht(_|0,w|0,(15-m|0)*3|0)|0,Ie()|0,B=B&7,B|0){w=B;break e}if(m>>>0<c>>>0)m=m+1|0;else{w=0;break}}while(!1);w=(w|0)==4&1}if(!(js(v,M,w,0)|0))(M|0)!=(c|0)&&(p[D>>2]=p[h>>2],p[D+4>>2]=p[h+4>>2],p[D+8>>2]=p[h+8>>2]);else{if(Cr(f)|0)do;while((js(v,M,0,0)|0)!=0);(M|0)!=(c|0)&&zl(D)}return f=0,Se=g,f|0}function gc(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;return M=Se,Se=Se+16|0,w=M,B=La(_,m,w)|0,B|0?(Se=M,B|0):(B=Ht(_|0,m|0,52)|0,Ie()|0,ph(w,B&15,v),B=0,Se=M,B|0)}function mc(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0;if(D=Se,Se=Se+16|0,M=D,w=La(_,m,M)|0,w|0)return M=w,Se=D,M|0;w=Ht(_|0,m|0,45)|0,Ie()|0,w=(Cr(w&127)|0)==0,B=Ht(_|0,m|0,52)|0,Ie()|0,B=B&15;e:do if(!w){if(B|0)for(w=1;;){if(c=Yt(7,0,(15-w|0)*3|0)|0,!((c&_|0)==0&((Ie()|0)&m|0)==0))break e;if(w>>>0<B>>>0)w=w+1|0;else break}return Oo(M,B,0,5,v),c=0,Se=D,c|0}while(!1);return jl(M,B,0,6,v),c=0,Se=D,c|0}function Na(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(B=Ht(_|0,m|0,45)|0,Ie()|0,!(Cr(B&127)|0))return B=2,p[v>>2]=B,0;if(B=Ht(_|0,m|0,52)|0,Ie()|0,B=B&15,!B)return B=5,p[v>>2]=B,0;for(w=1;;){if(M=Yt(7,0,(15-w|0)*3|0)|0,!((M&_|0)==0&((Ie()|0)&m|0)==0)){w=2,_=6;break}if(w>>>0<B>>>0)w=w+1|0;else{w=5,_=6;break}}return(_|0)==6&&(p[v>>2]=w),0}function _c(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0;C=Se,Se=Se+128|0,f=C+112|0,M=C+96|0,g=C,B=Ht(_|0,m|0,52)|0,Ie()|0,c=B&15,p[f>>2]=c,D=Ht(_|0,m|0,45)|0,Ie()|0,D=D&127;e:do if(Cr(D)|0){if(c|0)for(w=1;;){if(h=Yt(7,0,(15-w|0)*3|0)|0,!((h&_|0)==0&((Ie()|0)&m|0)==0)){B=0;break e}if(w>>>0<c>>>0)w=w+1|0;else break}if(B&1)B=1;else return h=Yt(c+1|0,0,52)|0,g=Ie()|0|m&-15728641,f=Yt(7,0,(14-c|0)*3|0)|0,g=_c((h|_)&~f,g&~(Ie()|0),v)|0,Se=C,g|0}else B=0;while(!1);if(w=La(_,m,M)|0,!w){B?(Lo(M,f,g),h=5):($l(M,f,g),h=6);e:do if(Cr(D)|0)if(!c)_=5;else for(w=1;;){if(D=Yt(7,0,(15-w|0)*3|0)|0,!((D&_|0)==0&((Ie()|0)&m|0)==0)){_=2;break e}if(w>>>0<c>>>0)w=w+1|0;else{_=5;break}}else _=2;while(!1);jo(v|0,-1,_<<2|0)|0;e:do if(B)for(M=0;;){if(D=g+(M<<4)|0,gh(D,p[f>>2]|0)|0,D=p[D>>2]|0,c=p[v>>2]|0,(c|0)==-1|(c|0)==(D|0))w=v;else{B=0;do{if(B=B+1|0,B>>>0>=_>>>0){w=1;break e}w=v+(B<<2)|0,c=p[w>>2]|0}while(!((c|0)==-1|(c|0)==(D|0)))}if(p[w>>2]=D,M=M+1|0,M>>>0>=h>>>0){w=0;break}}else for(M=0;;){if(D=g+(M<<4)|0,js(D,p[f>>2]|0,0,1)|0,D=p[D>>2]|0,c=p[v>>2]|0,(c|0)==-1|(c|0)==(D|0))w=v;else{B=0;do{if(B=B+1|0,B>>>0>=_>>>0){w=1;break e}w=v+(B<<2)|0,c=p[w>>2]|0}while(!((c|0)==-1|(c|0)==(D|0)))}if(p[w>>2]=D,M=M+1|0,M>>>0>=h>>>0){w=0;break}}while(!1)}return g=w,Se=C,g|0}function Xl(){return 12}function ol(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0;if(_>>>0>15)return c=4,c|0;if(Yt(_|0,0,52)|0,c=Ie()|0|134225919,!_){v=0,w=0;do Cr(w)|0&&(Yt(w|0,0,45)|0,D=c|(Ie()|0),_=m+(v<<3)|0,p[_>>2]=-1,p[_+4>>2]=D,v=v+1|0),w=w+1|0;while((w|0)!=122);return v=0,v|0}v=0,D=0;do{if(Cr(D)|0){for(Yt(D|0,0,45)|0,w=1,B=-1,M=c|(Ie()|0);h=Yt(7,0,(15-w|0)*3|0)|0,B=B&~h,M=M&~(Ie()|0),(w|0)!=(_|0);)w=w+1|0;h=m+(v<<3)|0,p[h>>2]=B,p[h+4>>2]=M,v=v+1|0}D=D+1|0}while((D|0)!=122);return v=0,v|0}function Kl(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0;if(Z=Se,Se=Se+16|0,W=Z,ee=Ht(_|0,m|0,52)|0,Ie()|0,ee=ee&15,v>>>0>15)return ee=4,Se=Z,ee|0;if((ee|0)<(v|0))return ee=12,Se=Z,ee|0;if((ee|0)!=(v|0))if(M=Yt(v|0,0,52)|0,M=M|_,c=Ie()|0|m&-15728641,(ee|0)>(v|0)){h=v;do z=Yt(7,0,(14-h|0)*3|0)|0,h=h+1|0,M=z|M,c=Ie()|0|c;while((h|0)<(ee|0));z=M}else z=M;else z=_,c=m;L=Ht(z|0,c|0,45)|0,Ie()|0;e:do if(Cr(L&127)|0){if(h=Ht(z|0,c|0,52)|0,Ie()|0,h=h&15,h|0)for(M=1;;){if(L=Yt(7,0,(15-M|0)*3|0)|0,!((L&z|0)==0&((Ie()|0)&c|0)==0)){f=33;break e}if(M>>>0<h>>>0)M=M+1|0;else break}if(L=w,p[L>>2]=0,p[L+4>>2]=0,(ee|0)>(v|0)){for(L=m&-15728641,R=ee;;){if(P=R,R=R+-1|0,R>>>0>15|(ee|0)<(R|0)){f=19;break}if((ee|0)!=(R|0))if(M=Yt(R|0,0,52)|0,M=M|_,h=Ie()|0|L,(ee|0)<(P|0))C=M;else{f=R;do C=Yt(7,0,(14-f|0)*3|0)|0,f=f+1|0,M=C|M,h=Ie()|0|h;while((f|0)<(ee|0));C=M}else C=_,h=m;if(g=Ht(C|0,h|0,45)|0,Ie()|0,!(Cr(g&127)|0))M=0;else{g=Ht(C|0,h|0,52)|0,Ie()|0,g=g&15;t:do if(!g)M=0;else for(f=1;;){if(M=Ht(C|0,h|0,(15-f|0)*3|0)|0,Ie()|0,M=M&7,M|0)break t;if(f>>>0<g>>>0)f=f+1|0;else{M=0;break}}while(!1);M=(M|0)==0&1}if(h=Ht(_|0,m|0,(15-P|0)*3|0)|0,Ie()|0,h=h&7,(h|0)==7){B=5,f=42;break}if(M=(M|0)!=0,(h|0)==1&M){B=5,f=42;break}if(C=h+(((h|0)!=0&M)<<31>>31)|0,C|0&&(f=ee-P|0,f=Rs(7,0,f,((f|0)<0)<<31>>31)|0,g=Ie()|0,M?(M=si(f|0,g|0,5,0)|0,M=ln(M|0,Ie()|0,-5,-1)|0,M=Fs(M|0,Ie()|0,6,0)|0,M=ln(M|0,Ie()|0,1,0)|0,h=Ie()|0):(M=f,h=g),P=C+-1|0,P=si(f|0,g|0,P|0,((P|0)<0)<<31>>31|0)|0,P=ln(M|0,h|0,P|0,Ie()|0)|0,C=Ie()|0,g=w,g=ln(P|0,C|0,p[g>>2]|0,p[g+4>>2]|0)|0,C=Ie()|0,P=w,p[P>>2]=g,p[P+4>>2]=C),(R|0)<=(v|0)){f=37;break}}if((f|0)==19)jt(23313,22674,1099,22710);else if((f|0)==37){D=w,B=p[D+4>>2]|0,D=p[D>>2]|0;break}else if((f|0)==42)return Se=Z,B|0}else B=0,D=0}else f=33;while(!1);e:do if((f|0)==33)if(L=w,p[L>>2]=0,p[L+4>>2]=0,(ee|0)>(v|0)){for(M=ee;;){if(B=Ht(_|0,m|0,(15-M|0)*3|0)|0,Ie()|0,B=B&7,(B|0)==7){B=5;break}if(D=ee-M|0,D=Rs(7,0,D,((D|0)<0)<<31>>31)|0,B=si(D|0,Ie()|0,B|0,0)|0,D=Ie()|0,L=w,D=ln(p[L>>2]|0,p[L+4>>2]|0,B|0,D|0)|0,B=Ie()|0,L=w,p[L>>2]=D,p[L+4>>2]=B,M=M+-1|0,(M|0)<=(v|0))break e}return Se=Z,B|0}else B=0,D=0;while(!1);return sl(z,c,ee,W)|0&&jt(23313,22674,1063,22725),ee=W,W=p[ee+4>>2]|0,((B|0)>-1|(B|0)==-1&D>>>0>4294967295)&((W|0)>(B|0)|((W|0)==(B|0)?(p[ee>>2]|0)>>>0>D>>>0:0))?(ee=0,Se=Z,ee|0):(jt(23313,22674,1139,22710),0)}function OA(_,m,v,w,B,M){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0;var D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0;if(C=Se,Se=Se+16|0,D=C,B>>>0>15)return M=4,Se=C,M|0;if(c=Ht(v|0,w|0,52)|0,Ie()|0,c=c&15,(c|0)>(B|0))return M=12,Se=C,M|0;if(sl(v,w,B,D)|0&&jt(23313,22674,1063,22725),g=D,f=p[g+4>>2]|0,!(((m|0)>-1|(m|0)==-1&_>>>0>4294967295)&((f|0)>(m|0)|((f|0)==(m|0)?(p[g>>2]|0)>>>0>_>>>0:0))))return M=2,Se=C,M|0;g=B-c|0,B=Yt(B|0,0,52)|0,h=Ie()|0|w&-15728641,f=M,p[f>>2]=B|v,p[f+4>>2]=h,f=Ht(v|0,w|0,45)|0,Ie()|0;e:do if(Cr(f&127)|0){if(c|0)for(D=1;;){if(f=Yt(7,0,(15-D|0)*3|0)|0,!((f&v|0)==0&((Ie()|0)&w|0)==0))break e;if(D>>>0<c>>>0)D=D+1|0;else break}if((g|0)<1)return M=0,Se=C,M|0;for(f=c^15,w=-1,h=1,D=1;;){c=g-h|0,c=Rs(7,0,c,((c|0)<0)<<31>>31)|0,v=Ie()|0;do if(D)if(D=si(c|0,v|0,5,0)|0,D=ln(D|0,Ie()|0,-5,-1)|0,D=Fs(D|0,Ie()|0,6,0)|0,B=Ie()|0,(m|0)>(B|0)|(m|0)==(B|0)&_>>>0>D>>>0){m=ln(_|0,m|0,-1,-1)|0,m=jr(m|0,Ie()|0,D|0,B|0)|0,D=Ie()|0,P=M,L=p[P>>2]|0,P=p[P+4>>2]|0,z=(f+w|0)*3|0,R=Yt(7,0,z|0)|0,P=P&~(Ie()|0),w=Fs(m|0,D|0,c|0,v|0)|0,_=Ie()|0,B=ln(w|0,_|0,2,0)|0,z=Yt(B|0,Ie()|0,z|0)|0,P=Ie()|0|P,B=M,p[B>>2]=z|L&~R,p[B+4>>2]=P,_=si(w|0,_|0,c|0,v|0)|0,_=jr(m|0,D|0,_|0,Ie()|0)|0,D=0,m=Ie()|0;break}else{z=M,R=p[z>>2]|0,z=p[z+4>>2]|0,L=Yt(7,0,(f+w|0)*3|0)|0,z=z&~(Ie()|0),D=M,p[D>>2]=R&~L,p[D+4>>2]=z,D=1;break}else R=M,B=p[R>>2]|0,R=p[R+4>>2]|0,w=(f+w|0)*3|0,P=Yt(7,0,w|0)|0,R=R&~(Ie()|0),z=Fs(_|0,m|0,c|0,v|0)|0,D=Ie()|0,w=Yt(z|0,D|0,w|0)|0,R=Ie()|0|R,L=M,p[L>>2]=w|B&~P,p[L+4>>2]=R,D=si(z|0,D|0,c|0,v|0)|0,_=jr(_|0,m|0,D|0,Ie()|0)|0,D=0,m=Ie()|0;while(!1);if((g|0)>(h|0))w=~h,h=h+1|0;else{m=0;break}}return Se=C,m|0}while(!1);if((g|0)<1)return z=0,Se=C,z|0;for(B=c^15,D=1;;)if(L=g-D|0,L=Rs(7,0,L,((L|0)<0)<<31>>31)|0,z=Ie()|0,h=M,v=p[h>>2]|0,h=p[h+4>>2]|0,c=(B-D|0)*3|0,w=Yt(7,0,c|0)|0,h=h&~(Ie()|0),P=Fs(_|0,m|0,L|0,z|0)|0,R=Ie()|0,c=Yt(P|0,R|0,c|0)|0,h=Ie()|0|h,f=M,p[f>>2]=c|v&~w,p[f+4>>2]=h,z=si(P|0,R|0,L|0,z|0)|0,_=jr(_|0,m|0,z|0,Ie()|0)|0,m=Ie()|0,(g|0)<=(D|0)){m=0;break}else D=D+1|0;return Se=C,m|0}function al(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;B=Ht(m|0,v|0,52)|0,Ie()|0,B=B&15,(m|0)==0&(v|0)==0|((w|0)>15|(B|0)>(w|0))?(w=-1,B=-1,m=0,v=0):(M=Wl(m,v,B+1|0,w)|0,v=(Ie()|0)&-15728641,m=Yt(w|0,0,52)|0,m=M|m,v=v|(Ie()|0),M=(Bn(m,v)|0)==0,w=M?-1:w),M=_,p[M>>2]=m,p[M+4>>2]=v,p[_+8>>2]=B,p[_+12>>2]=w}function ql(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0;if(v=_,m=p[v>>2]|0,v=p[v+4>>2]|0,!((m|0)==0&(v|0)==0)&&(w=Ht(m|0,v|0,52)|0,Ie()|0,w=w&15,c=Yt(1,0,(w^15)*3|0)|0,m=ln(c|0,Ie()|0,m|0,v|0)|0,v=Ie()|0,c=_,p[c>>2]=m,p[c+4>>2]=v,c=_+8|0,D=p[c>>2]|0,!((w|0)<(D|0)))){for(h=_+12|0,M=w;;){if((M|0)==(D|0)){w=5;break}if(f=(M|0)==(p[h>>2]|0),B=(15-M|0)*3|0,w=Ht(m|0,v|0,B|0)|0,Ie()|0,w=w&7,f&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(f=Yt(1,0,B|0)|0,m=ln(m|0,v|0,f|0,Ie()|0)|0,v=Ie()|0,f=_,p[f>>2]=m,p[f+4>>2]=v,(M|0)>(D|0))M=M+-1|0;else{w=10;break}}if((w|0)==5){f=_,p[f>>2]=0,p[f+4>>2]=0,p[c>>2]=-1,p[h>>2]=-1;return}else if((w|0)==7){D=Yt(1,0,B|0)|0,D=ln(m|0,v|0,D|0,Ie()|0)|0,c=Ie()|0,f=_,p[f>>2]=D,p[f+4>>2]=c,p[h>>2]=M+-1;return}else if((w|0)==10)return}}function yc(_){_=+_;var m=0;return m=_<0?_+6.283185307179586:_,+(_>=6.283185307179586?m+-6.283185307179586:m)}function ka(_,m){return _=_|0,m=m|0,+St(+(+ce[_>>3]-+ce[m>>3]))<17453292519943298e-27?(m=+St(+(+ce[_+8>>3]-+ce[m+8>>3]))<17453292519943298e-27,m|0):(m=0,m|0)}function Yl(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0;return B=+ce[m>>3],w=+ce[_>>3],M=+Bt(+((B-w)*.5)),v=+Bt(+((+ce[m+8>>3]-+ce[_+8>>3])*.5)),v=M*M+v*(+Ft(+B)*+Ft(+w)*v),+(+tn(+ +Rt(+v),+ +Rt(+(1-v)))*2)}function Ua(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0;return B=+ce[m>>3],w=+ce[_>>3],M=+Bt(+((B-w)*.5)),v=+Bt(+((+ce[m+8>>3]-+ce[_+8>>3])*.5)),v=M*M+v*(+Ft(+B)*+Ft(+w)*v),+(+tn(+ +Rt(+v),+ +Rt(+(1-v)))*2*6371.007180918475)}function Yu(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0;return B=+ce[m>>3],w=+ce[_>>3],M=+Bt(+((B-w)*.5)),v=+Bt(+((+ce[m+8>>3]-+ce[_+8>>3])*.5)),v=M*M+v*(+Ft(+B)*+Ft(+w)*v),+(+tn(+ +Rt(+v),+ +Rt(+(1-v)))*2*6371.007180918475*1e3)}function Zu(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0;return M=+ce[m>>3],w=+Ft(+M),B=+ce[m+8>>3]-+ce[_+8>>3],D=w*+Bt(+B),v=+ce[_>>3],+ +tn(+D,+(+Bt(+M)*+Ft(+v)-+Ft(+B)*(w*+Bt(+v))))}function cl(_,m,v,w){_=_|0,m=+m,v=+v,w=w|0;var B=0,M=0,D=0,c=0;if(v<1e-16){p[w>>2]=p[_>>2],p[w+4>>2]=p[_+4>>2],p[w+8>>2]=p[_+8>>2],p[w+12>>2]=p[_+12>>2];return}M=m<0?m+6.283185307179586:m,M=m>=6.283185307179586?M+-6.283185307179586:M;do if(M<1e-16)m=+ce[_>>3]+v,ce[w>>3]=m,B=w;else{if(B=+St(+(M+-3.141592653589793))<1e-16,m=+ce[_>>3],B){m=m-v,ce[w>>3]=m,B=w;break}if(D=+Ft(+v),v=+Bt(+v),m=D*+Bt(+m)+ +Ft(+M)*(v*+Ft(+m)),m=m>1?1:m,m=+Kt(+(m<-1?-1:m)),ce[w>>3]=m,+St(+(m+-1.5707963267948966))<1e-16){ce[w>>3]=1.5707963267948966,ce[w+8>>3]=0;return}if(+St(+(m+1.5707963267948966))<1e-16){ce[w>>3]=-1.5707963267948966,ce[w+8>>3]=0;return}if(c=+Ft(+m),M=v*+Bt(+M)/c,v=+ce[_>>3],m=(D-+Bt(+m)*+Bt(+v))/+Ft(+v)/c,D=M>1?1:M,m=m>1?1:m,m=+ce[_+8>>3]+ +tn(+(D<-1?-1:D),+(m<-1?-1:m)),m>3.141592653589793)do m=m+-6.283185307179586;while(m>3.141592653589793);if(m<-3.141592653589793)do m=m+6.283185307179586;while(m<-3.141592653589793);ce[w+8>>3]=m;return}while(!1);if(+St(+(m+-1.5707963267948966))<1e-16){ce[B>>3]=1.5707963267948966,ce[w+8>>3]=0;return}if(+St(+(m+1.5707963267948966))<1e-16){ce[B>>3]=-1.5707963267948966,ce[w+8>>3]=0;return}if(m=+ce[_+8>>3],m>3.141592653589793)do m=m+-6.283185307179586;while(m>3.141592653589793);if(m<-3.141592653589793)do m=m+6.283185307179586;while(m<-3.141592653589793);ce[w+8>>3]=m}function yh(_,m){return _=_|0,m=m|0,_>>>0>15?(m=4,m|0):(ce[m>>3]=+ce[20528+(_<<3)>>3],m=0,m|0)}function za(_,m){return _=_|0,m=m|0,_>>>0>15?(m=4,m|0):(ce[m>>3]=+ce[20656+(_<<3)>>3],m=0,m|0)}function zn(_,m){return _=_|0,m=m|0,_>>>0>15?(m=4,m|0):(ce[m>>3]=+ce[20784+(_<<3)>>3],m=0,m|0)}function Zl(_,m){return _=_|0,m=m|0,_>>>0>15?(m=4,m|0):(ce[m>>3]=+ce[20912+(_<<3)>>3],m=0,m|0)}function Uo(_,m){_=_|0,m=m|0;var v=0;return _>>>0>15?(m=4,m|0):(v=Rs(7,0,_,((_|0)<0)<<31>>31)|0,v=si(v|0,Ie()|0,120,0)|0,_=Ie()|0,p[m>>2]=v|2,p[m+4>>2]=_,m=0,m|0)}function zo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0;return P=+ce[m>>3],g=+ce[_>>3],h=+Bt(+((P-g)*.5)),M=+ce[m+8>>3],f=+ce[_+8>>3],D=+Bt(+((M-f)*.5)),c=+Ft(+g),C=+Ft(+P),D=h*h+D*(C*c*D),D=+tn(+ +Rt(+D),+ +Rt(+(1-D)))*2,h=+ce[v>>3],P=+Bt(+((h-P)*.5)),w=+ce[v+8>>3],M=+Bt(+((w-M)*.5)),B=+Ft(+h),M=P*P+M*(C*B*M),M=+tn(+ +Rt(+M),+ +Rt(+(1-M)))*2,h=+Bt(+((g-h)*.5)),w=+Bt(+((f-w)*.5)),w=h*h+w*(c*B*w),w=+tn(+ +Rt(+w),+ +Rt(+(1-w)))*2,B=(D+M+w)*.5,+(+Kr(+ +Rt(+(+Ut(+(B*.5))*+Ut(+((B-D)*.5))*+Ut(+((B-M)*.5))*+Ut(+((B-w)*.5)))))*4)}function sn(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0;if(c=Se,Se=Se+192|0,M=c+168|0,D=c,B=gc(_,m,M)|0,B|0)return v=B,Se=c,v|0;if(mc(_,m,D)|0&&jt(23313,22742,386,22751),m=p[D>>2]|0,(m|0)>0){if(w=+zo(D+8|0,D+8+(((m|0)!=1&1)<<4)|0,M)+0,(m|0)!=1){_=1;do B=_,_=_+1|0,w=w+ +zo(D+8+(B<<4)|0,D+8+(((_|0)%(m|0)|0)<<4)|0,M);while((_|0)<(m|0))}}else w=0;return ce[v>>3]=w,v=0,Se=c,v|0}function Mn(_,m,v){return _=_|0,m=m|0,v=v|0,_=sn(_,m,v)|0,_|0||(ce[v>>3]=+ce[v>>3]*6371.007180918475*6371.007180918475),_|0}function Ps(_,m,v){return _=_|0,m=m|0,v=v|0,_=sn(_,m,v)|0,_|0||(ce[v>>3]=+ce[v>>3]*6371.007180918475*6371.007180918475*1e3*1e3),_|0}function ll(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(c=Se,Se=Se+176|0,D=c,_=Vl(_,m,D)|0,_|0)return D=_,Se=c,D|0;if(ce[v>>3]=0,_=p[D>>2]|0,(_|0)<=1)return D=0,Se=c,D|0;m=_+-1|0,_=0,w=+ce[D+8>>3],B=+ce[D+16>>3],M=0;do _=_+1|0,f=w,w=+ce[D+8+(_<<4)>>3],g=+Bt(+((w-f)*.5)),h=B,B=+ce[D+8+(_<<4)+8>>3],h=+Bt(+((B-h)*.5)),h=g*g+h*(+Ft(+w)*+Ft(+f)*h),M=M+ +tn(+ +Rt(+h),+ +Rt(+(1-h)))*2;while((_|0)<(m|0));return ce[v>>3]=M,D=0,Se=c,D|0}function vc(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(c=Se,Se=Se+176|0,D=c,_=Vl(_,m,D)|0,_|0)return D=_,M=+ce[v>>3],M=M*6371.007180918475,ce[v>>3]=M,Se=c,D|0;if(ce[v>>3]=0,_=p[D>>2]|0,(_|0)<=1)return D=0,M=0,M=M*6371.007180918475,ce[v>>3]=M,Se=c,D|0;m=_+-1|0,_=0,w=+ce[D+8>>3],B=+ce[D+16>>3],M=0;do _=_+1|0,f=w,w=+ce[D+8+(_<<4)>>3],g=+Bt(+((w-f)*.5)),h=B,B=+ce[D+8+(_<<4)+8>>3],h=+Bt(+((B-h)*.5)),h=g*g+h*(+Ft(+f)*+Ft(+w)*h),M=M+ +tn(+ +Rt(+h),+ +Rt(+(1-h)))*2;while((_|0)!=(m|0));return ce[v>>3]=M,D=0,g=M,g=g*6371.007180918475,ce[v>>3]=g,Se=c,D|0}function ul(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(c=Se,Se=Se+176|0,D=c,_=Vl(_,m,D)|0,_|0)return D=_,M=+ce[v>>3],M=M*6371.007180918475,M=M*1e3,ce[v>>3]=M,Se=c,D|0;if(ce[v>>3]=0,_=p[D>>2]|0,(_|0)<=1)return D=0,M=0,M=M*6371.007180918475,M=M*1e3,ce[v>>3]=M,Se=c,D|0;m=_+-1|0,_=0,w=+ce[D+8>>3],B=+ce[D+16>>3],M=0;do _=_+1|0,f=w,w=+ce[D+8+(_<<4)>>3],g=+Bt(+((w-f)*.5)),h=B,B=+ce[D+8+(_<<4)+8>>3],h=+Bt(+((B-h)*.5)),h=g*g+h*(+Ft(+f)*+Ft(+w)*h),M=M+ +tn(+ +Rt(+h),+ +Rt(+(1-h)))*2;while((_|0)!=(m|0));return ce[v>>3]=M,D=0,g=M,g=g*6371.007180918475,g=g*1e3,ce[v>>3]=g,Se=c,D|0}function LA(_){_=_|0;var m=0,v=0,w=0;return m=Ks(1,12)|0,m||jt(22832,22787,49,22845),v=_+4|0,w=p[v>>2]|0,w|0?(w=w+8|0,p[w>>2]=m,p[v>>2]=m,m|0):(p[_>>2]|0&&jt(22862,22787,61,22885),w=_,p[w>>2]=m,p[v>>2]=m,m|0)}function NA(_,m){_=_|0,m=m|0;var v=0,w=0;return w=Gn(24)|0,w||jt(22899,22787,78,22913),p[w>>2]=p[m>>2],p[w+4>>2]=p[m+4>>2],p[w+8>>2]=p[m+8>>2],p[w+12>>2]=p[m+12>>2],p[w+16>>2]=0,m=_+4|0,v=p[m>>2]|0,v|0?(p[v+16>>2]=w,p[m>>2]=w,w|0):(p[_>>2]|0&&jt(22928,22787,82,22913),p[_>>2]=w,p[m>>2]=w,w|0)}function bc(_){_=_|0;var m=0,v=0,w=0,B=0;if(_)for(w=1;;){if(m=p[_>>2]|0,m|0)do{if(v=p[m>>2]|0,v|0)do B=v,v=p[v+16>>2]|0,Or(B);while((v|0)!=0);B=m,m=p[m+8>>2]|0,Or(B)}while((m|0)!=0);if(m=_,_=p[_+8>>2]|0,w||Or(m),_)w=0;else break}}function fl(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0,Ve=0,$e=0,rt=0,Je=0,Ze=0,ft=0,Pt=0,bt=0;if(B=_+8|0,p[B>>2]|0)return bt=1,bt|0;if(w=p[_>>2]|0,!w)return bt=0,bt|0;m=w,v=0;do v=v+1|0,m=p[m+8>>2]|0;while((m|0)!=0);if(v>>>0<2)return bt=0,bt|0;ft=Gn(v<<2)|0,ft||jt(22948,22787,317,22967),Ze=Gn(v<<5)|0,Ze||jt(22989,22787,321,22967),p[_>>2]=0,Fe=_+4|0,p[Fe>>2]=0,p[B>>2]=0,v=0,Je=0,we=0,C=0;e:for(;;){if(g=p[w>>2]|0,g){M=0,D=g;do{if(h=+ce[D+8>>3],m=D,D=p[D+16>>2]|0,f=(D|0)==0,B=f?g:D,c=+ce[B+8>>3],+St(+(h-c))>3.141592653589793){bt=14;break}M=M+(c-h)*(+ce[m>>3]+ +ce[B>>3])}while(!f);if((bt|0)==14){bt=0,M=0,m=g;do se=+ce[m+8>>3],rt=m+16|0,$e=p[rt>>2]|0,$e=($e|0)==0?g:$e,te=+ce[$e+8>>3],M=M+(+ce[m>>3]+ +ce[$e>>3])*((te<0?te+6.283185307179586:te)-(se<0?se+6.283185307179586:se)),m=p[((m|0)==0?w:rt)>>2]|0;while((m|0)!=0)}M>0?(p[ft+(Je<<2)>>2]=w,Je=Je+1|0,B=we,m=C):bt=19}else bt=19;if((bt|0)==19){bt=0;do if(v){if(m=v+8|0,p[m>>2]|0){bt=21;break e}if(v=Ks(1,12)|0,!v){bt=23;break e}p[m>>2]=v,B=v+4|0,D=v,m=C}else if(C){B=Fe,D=C+8|0,m=w,v=_;break}else if(p[_>>2]|0){bt=27;break e}else{B=Fe,D=_,m=w,v=_;break}while(!1);if(p[D>>2]=w,p[B>>2]=w,D=Ze+(we<<5)|0,f=p[w>>2]|0,f){for(g=Ze+(we<<5)+8|0,ce[g>>3]=17976931348623157e292,C=Ze+(we<<5)+24|0,ce[C>>3]=17976931348623157e292,ce[D>>3]=-17976931348623157e292,P=Ze+(we<<5)+16|0,ce[P>>3]=-17976931348623157e292,ee=17976931348623157e292,Z=-17976931348623157e292,B=0,R=f,h=17976931348623157e292,z=17976931348623157e292,W=-17976931348623157e292,c=-17976931348623157e292;M=+ce[R>>3],se=+ce[R+8>>3],R=p[R+16>>2]|0,L=(R|0)==0,te=+ce[(L?f:R)+8>>3],M<h&&(ce[g>>3]=M,h=M),se<z&&(ce[C>>3]=se,z=se),M>W?ce[D>>3]=M:M=W,se>c&&(ce[P>>3]=se,c=se),ee=se>0&se<ee?se:ee,Z=se<0&se>Z?se:Z,B=B|+St(+(se-te))>3.141592653589793,!L;)W=M;B&&(ce[P>>3]=Z,ce[C>>3]=ee)}else p[D>>2]=0,p[D+4>>2]=0,p[D+8>>2]=0,p[D+12>>2]=0,p[D+16>>2]=0,p[D+20>>2]=0,p[D+24>>2]=0,p[D+28>>2]=0;B=we+1|0}if(rt=w+8|0,w=p[rt>>2]|0,p[rt>>2]=0,w)we=B,C=m;else{bt=45;break}}if((bt|0)==21)jt(22765,22787,35,22799);else if((bt|0)==23)jt(22819,22787,37,22799);else if((bt|0)==27)jt(22862,22787,61,22885);else if((bt|0)==45){e:do if((Je|0)>0){for(rt=(B|0)==0,Ve=B<<2,$e=(_|0)==0,Re=0,m=0;;){if(ge=p[ft+(Re<<2)>>2]|0,rt)bt=73;else{if(we=Gn(Ve)|0,!we){bt=50;break}if(Fe=Gn(Ve)|0,!Fe){bt=52;break}t:do if($e)v=0;else{for(B=0,v=0,D=_;w=Ze+(B<<5)|0,yo(p[D>>2]|0,w,p[ge>>2]|0)|0?(p[we+(v<<2)>>2]=D,p[Fe+(v<<2)>>2]=w,L=v+1|0):L=v,D=p[D+8>>2]|0,D;)B=B+1|0,v=L;if((L|0)>0)if(w=p[we>>2]|0,(L|0)==1)v=w;else for(P=0,R=-1,v=w,C=w;;){for(f=p[C>>2]|0,w=0,D=0;B=p[p[we+(D<<2)>>2]>>2]|0,(B|0)==(f|0)?g=w:g=w+((yo(B,p[Fe+(D<<2)>>2]|0,p[f>>2]|0)|0)&1)|0,D=D+1|0,(D|0)!=(L|0);)w=g;if(B=(g|0)>(R|0),v=B?C:v,w=P+1|0,(w|0)==(L|0))break t;P=w,R=B?g:R,C=p[we+(w<<2)>>2]|0}else v=0}while(!1);if(Or(we),Or(Fe),v){if(B=v+4|0,w=p[B>>2]|0,w)v=w+8|0;else if(p[v>>2]|0){bt=70;break}p[v>>2]=ge,p[B>>2]=ge}else bt=73}if((bt|0)==73){if(bt=0,m=p[ge>>2]|0,m|0)do Fe=m,m=p[m+16>>2]|0,Or(Fe);while((m|0)!=0);Or(ge),m=1}if(Re=Re+1|0,(Re|0)>=(Je|0)){Pt=m;break e}}(bt|0)==50?jt(23004,22787,249,23023):(bt|0)==52?jt(23042,22787,252,23023):(bt|0)==70&&jt(22862,22787,61,22885)}else Pt=0;while(!1);return Or(ft),Or(Ze),bt=Pt,bt|0}return 0}function yo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0;if(!(Ss(m,v)|0)||(m=rl(m)|0,w=+ce[v>>3],B=+ce[v+8>>3],B=m&B<0?B+6.283185307179586:B,_=p[_>>2]|0,!_))return _=0,_|0;if(m){m=0,f=B,v=_;e:for(;;){for(;D=+ce[v>>3],B=+ce[v+8>>3],v=v+16|0,g=p[v>>2]|0,g=(g|0)==0?_:g,M=+ce[g>>3],c=+ce[g+8>>3],D>M?(h=D,D=c):(h=M,M=D,D=B,B=c),w=w==M|w==h?w+2220446049250313e-31:w,!!(w<M|w>h);)if(v=p[v>>2]|0,!v){v=22;break e}if(c=D<0?D+6.283185307179586:D,D=B<0?B+6.283185307179586:B,f=c==f|D==f?f+-2220446049250313e-31:f,h=c+(D-c)*((w-M)/(h-M)),(h<0?h+6.283185307179586:h)>f&&(m=m^1),v=p[v>>2]|0,!v){v=22;break}}if((v|0)==22)return m|0}else{m=0,f=B,v=_;e:for(;;){for(;D=+ce[v>>3],B=+ce[v+8>>3],v=v+16|0,g=p[v>>2]|0,g=(g|0)==0?_:g,M=+ce[g>>3],c=+ce[g+8>>3],D>M?(h=D,D=c):(h=M,M=D,D=B,B=c),w=w==M|w==h?w+2220446049250313e-31:w,!!(w<M|w>h);)if(v=p[v>>2]|0,!v){v=22;break e}if(f=D==f|B==f?f+-2220446049250313e-31:f,D+(B-D)*((w-M)/(h-M))>f&&(m=m^1),v=p[v>>2]|0,!v){v=22;break}}if((v|0)==22)return m|0}return 0}function Pn(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0;if(Z=Se,Se=Se+32|0,ee=Z+16|0,W=Z,M=Ht(_|0,m|0,52)|0,Ie()|0,M=M&15,R=Ht(v|0,w|0,52)|0,Ie()|0,(M|0)!=(R&15|0))return ee=12,Se=Z,ee|0;if(f=Ht(_|0,m|0,45)|0,Ie()|0,f=f&127,g=Ht(v|0,w|0,45)|0,Ie()|0,g=g&127,f>>>0>121|g>>>0>121)return ee=5,Se=Z,ee|0;if(R=(f|0)!=(g|0),R){if(c=el(f,g)|0,(c|0)==7)return ee=1,Se=Z,ee|0;h=el(g,f)|0,(h|0)==7?jt(23066,23090,161,23100):(L=c,D=h)}else L=0,D=0;C=Cr(f)|0,P=Cr(g)|0,p[ee>>2]=0,p[ee+4>>2]=0,p[ee+8>>2]=0,p[ee+12>>2]=0;do if(L){if(g=p[4272+(f*28|0)+(L<<2)>>2]|0,c=(g|0)>0,P)if(c){f=0,h=v,c=w;do h=Jl(h,c)|0,c=Ie()|0,D=Hs(D)|0,(D|0)==1&&(D=Hs(1)|0),f=f+1|0;while((f|0)!=(g|0));g=D,f=h,h=c}else g=D,f=v,h=w;else if(c){f=0,h=v,c=w;do h=Da(h,c)|0,c=Ie()|0,D=Hs(D)|0,f=f+1|0;while((f|0)!=(g|0));g=D,f=h,h=c}else g=D,f=v,h=w;if(Ms(f,h,ee)|0,R||jt(23115,23090,191,23100),c=(C|0)!=0,D=(P|0)!=0,c&D&&jt(23142,23090,192,23100),c){if(D=Xi(_,m)|0,(D|0)==7){M=5;break}if(Be[21872+(D*7|0)+L>>0]|0){M=1;break}h=p[21040+(D*28|0)+(L<<2)>>2]|0,f=h}else if(D){if(D=Xi(f,h)|0,(D|0)==7){M=5;break}if(Be[21872+(D*7|0)+g>>0]|0){M=1;break}f=0,h=p[21040+(g*28|0)+(D<<2)>>2]|0}else f=0,h=0;if((f|h|0)<0)M=5;else{if((h|0)>0){c=ee+4|0,D=0;do Gl(c),D=D+1|0;while((D|0)!=(h|0))}if(p[W>>2]=0,p[W+4>>2]=0,p[W+8>>2]=0,Ju(W,L),M|0)for(;Is(M)|0?hc(W):Do(W),(M|0)>1;)M=M+-1|0;if((f|0)>0){M=0;do Gl(W),M=M+1|0;while((M|0)!=(f|0))}z=ee+4|0,Dn(z,W,z),hi(z),z=51}}else if(Ms(v,w,ee)|0,(C|0)!=0&(P|0)!=0)if((g|0)!=(f|0)&&jt(23173,23090,261,23100),D=Xi(_,m)|0,M=Xi(v,w)|0,(D|0)==7|(M|0)==7)M=5;else if(Be[21872+(D*7|0)+M>>0]|0)M=1;else if(D=p[21040+(D*28|0)+(M<<2)>>2]|0,(D|0)>0){c=ee+4|0,M=0;do Gl(c),M=M+1|0;while((M|0)!=(D|0));z=51}else z=51;else z=51;while(!1);return(z|0)==51&&(M=ee+4|0,p[B>>2]=p[M>>2],p[B+4>>2]=p[M+4>>2],p[B+8>>2]=p[M+8>>2],M=0),ee=M,Se=Z,ee|0}function xc(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0;if(z=Se,Se=Se+48|0,f=z+36|0,D=z+24|0,c=z+12|0,h=z,B=Ht(_|0,m|0,52)|0,Ie()|0,B=B&15,P=Ht(_|0,m|0,45)|0,Ie()|0,P=P&127,P>>>0>121)return w=5,Se=z,w|0;if(g=Cr(P)|0,Yt(B|0,0,52)|0,W=Ie()|0|134225919,M=w,p[M>>2]=-1,p[M+4>>2]=W,!B)return B=nl(v)|0,(B|0)==7||(B=sa(P,B)|0,(B|0)==127)?(W=1,Se=z,W|0):(R=Yt(B|0,0,45)|0,L=Ie()|0,P=w,L=p[P+4>>2]&-1040385|L,W=w,p[W>>2]=p[P>>2]|R,p[W+4>>2]=L,W=0,Se=z,W|0);for(p[f>>2]=p[v>>2],p[f+4>>2]=p[v+4>>2],p[f+8>>2]=p[v+8>>2],v=B;;){if(M=v,v=v+-1|0,p[D>>2]=p[f>>2],p[D+4>>2]=p[f+4>>2],p[D+8>>2]=p[f+8>>2],Is(M)|0){if(B=PA(f)|0,B|0){v=13;break}p[c>>2]=p[f>>2],p[c+4>>2]=p[f+4>>2],p[c+8>>2]=p[f+8>>2],hc(c)}else{if(B=RA(f)|0,B|0){v=13;break}p[c>>2]=p[f>>2],p[c+4>>2]=p[f+4>>2],p[c+8>>2]=p[f+8>>2],Do(c)}if(ii(D,c,h),hi(h),B=w,Z=p[B>>2]|0,B=p[B+4>>2]|0,te=(15-M|0)*3|0,ee=Yt(7,0,te|0)|0,B=B&~(Ie()|0),te=Yt(nl(h)|0,0,te|0)|0,B=Ie()|0|B,W=w,p[W>>2]=te|Z&~ee,p[W+4>>2]=B,(M|0)<=1){v=14;break}}e:do if((v|0)!=13&&(v|0)==14)if((p[f>>2]|0)<=1&&(p[f+4>>2]|0)<=1&&(p[f+8>>2]|0)<=1){v=nl(f)|0,B=sa(P,v)|0,(B|0)==127?h=0:h=Cr(B)|0;t:do if(v){if(g){if(B=Xi(_,m)|0,(B|0)==7){B=5;break e}if(M=p[21248+(B*28|0)+(v<<2)>>2]|0,(M|0)>0){B=v,v=0;do B=co(B)|0,v=v+1|0;while((v|0)!=(M|0))}else B=v;if((B|0)==1){B=9;break e}v=sa(P,B)|0,(v|0)==127&&jt(23200,23090,411,23230),Cr(v)|0?jt(23245,23090,412,23230):(L=v,R=M,C=B)}else L=B,R=0,C=v;if(c=p[4272+(P*28|0)+(C<<2)>>2]|0,(c|0)<=-1&&jt(23276,23090,419,23230),!h){if((R|0)<0){B=5;break e}if(R|0){M=w,B=0,v=p[M>>2]|0,M=p[M+4>>2]|0;do v=lo(v,M)|0,M=Ie()|0,te=w,p[te>>2]=v,p[te+4>>2]=M,B=B+1|0;while((B|0)<(R|0))}if((c|0)<=0){B=L,v=58;break}for(M=w,B=0,v=p[M>>2]|0,M=p[M+4>>2]|0;;)if(v=lo(v,M)|0,M=Ie()|0,te=w,p[te>>2]=v,p[te+4>>2]=M,B=B+1|0,(B|0)==(c|0)){B=L,v=58;break t}}if(D=el(L,P)|0,(D|0)==7&&jt(23066,23090,428,23230),B=w,v=p[B>>2]|0,B=p[B+4>>2]|0,(c|0)>0){M=0;do v=lo(v,B)|0,B=Ie()|0,te=w,p[te>>2]=v,p[te+4>>2]=B,M=M+1|0;while((M|0)!=(c|0))}if(B=Xi(v,B)|0,(B|0)==7&&jt(23313,23090,440,23230),v=ni(L)|0,v=p[(v?21664:21456)+(D*28|0)+(B<<2)>>2]|0,(v|0)<0&&jt(23313,23090,454,23230),!v)B=L,v=58;else{D=w,B=0,M=p[D>>2]|0,D=p[D+4>>2]|0;do M=da(M,D)|0,D=Ie()|0,te=w,p[te>>2]=M,p[te+4>>2]=D,B=B+1|0;while((B|0)<(v|0));B=L,v=58}}else if((g|0)!=0&(h|0)!=0){if(v=Xi(_,m)|0,M=w,M=Xi(p[M>>2]|0,p[M+4>>2]|0)|0,(v|0)==7|(M|0)==7){B=5;break e}if(M=p[21248+(v*28|0)+(M<<2)>>2]|0,(M|0)<0){B=5;break e}if(!M)v=59;else{c=w,v=0,D=p[c>>2]|0,c=p[c+4>>2]|0;do D=lo(D,c)|0,c=Ie()|0,te=w,p[te>>2]=D,p[te+4>>2]=c,v=v+1|0;while((v|0)<(M|0));v=58}}else v=58;while(!1);if((v|0)==58&&h&&(v=59),(v|0)==59&&(te=w,(Xi(p[te>>2]|0,p[te+4>>2]|0)|0)==1)){B=9;break}te=w,ee=p[te>>2]|0,te=p[te+4>>2]&-1040385,Z=Yt(B|0,0,45)|0,te=te|(Ie()|0),B=w,p[B>>2]=ee|Z,p[B+4>>2]=te,B=0}else B=1;while(!1);return te=B,Se=z,te|0}function vh(_,m,v,w,B,M){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0,M=M|0;var D=0,c=0;return c=Se,Se=Se+16|0,D=c,B?_=15:(_=Pn(_,m,v,w,D)|0,_||(ca(D,M),_=0)),Se=c,_|0}function gi(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0;return D=Se,Se=Se+16|0,M=D,w?v=15:(v=la(v,M)|0,v||(v=xc(_,m,M,B)|0)),Se=D,v|0}function rr(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0;return h=Se,Se=Se+32|0,D=h+12|0,c=h,M=Pn(_,m,_,m,D)|0,M|0?(c=M,Se=h,c|0):(_=Pn(_,m,v,w,c)|0,_|0?(c=_,Se=h,c|0):(D=il(D,c)|0,c=B,p[c>>2]=D,p[c+4>>2]=((D|0)<0)<<31>>31,c=0,Se=h,c|0))}function ms(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0;return h=Se,Se=Se+32|0,D=h+12|0,c=h,M=Pn(_,m,_,m,D)|0,!M&&(M=Pn(_,m,v,w,c)|0,!M)?(w=il(D,c)|0,w=ln(w|0,((w|0)<0)<<31>>31|0,1,0)|0,D=Ie()|0,c=B,p[c>>2]=w,p[c+4>>2]=D,c=0,Se=h,c|0):(c=M,Se=h,c|0)}function Ql(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0,Re=0;if(ge=Se,Se=Se+48|0,D=ge+24|0,c=ge+12|0,Fe=ge,M=Pn(_,m,_,m,D)|0,!M&&(M=Pn(_,m,v,w,c)|0,!M)){se=il(D,c)|0,we=((se|0)<0)<<31>>31,p[D>>2]=0,p[D+4>>2]=0,p[D+8>>2]=0,p[c>>2]=0,p[c+4>>2]=0,p[c+8>>2]=0,Pn(_,m,_,m,D)|0&&jt(23313,23090,691,23299),Pn(_,m,v,w,c)|0&&jt(23313,23090,696,23299),ua(D),ua(c),se?(C=p[D>>2]|0,L=+(se|0),ee=D+4|0,P=p[ee>>2]|0,Z=D+8|0,R=p[Z>>2]|0,te=D,w=C,M=P,v=R,z=+((p[c>>2]|0)-C|0)/L,W=+((p[c+4>>2]|0)-P|0)/L,L=+((p[c+8>>2]|0)-R|0)/L):(M=D+4|0,v=D+8|0,ee=M,Z=v,te=D,w=p[D>>2]|0,M=p[M>>2]|0,v=p[v>>2]|0,z=0,W=0,L=0),p[Fe>>2]=w,R=Fe+4|0,p[R>>2]=M,P=Fe+8|0,p[P>>2]=v;e:do if((se|0)<0)M=0;else for(g=0,C=0,M=w;;){f=+(C>>>0)+4294967296*+(g|0),Re=z*f+ +(M|0),h=W*f+ +(p[ee>>2]|0),f=L*f+ +(p[Z>>2]|0),v=~~+Ho(+Re),D=~~+Ho(+h),M=~~+Ho(+f),Re=+St(+(+(v|0)-Re)),h=+St(+(+(D|0)-h)),f=+St(+(+(M|0)-f));do if(Re>h&Re>f)v=0-(D+M)|0,w=D;else if(c=0-v|0,h>f){w=c-M|0;break}else{w=D,M=c-D|0;break}while(!1);if(p[Fe>>2]=v,p[R>>2]=w,p[P>>2]=M,Ma(Fe),M=xc(_,m,Fe,B+(C<<3)|0)|0,M|0)break e;if(!((g|0)<(we|0)|(g|0)==(we|0)&C>>>0<se>>>0)){M=0;break e}M=ln(C|0,g|0,1,0)|0,c=Ie()|0,g=c,C=M,M=p[te>>2]|0}while(!1);return Fe=M,Se=ge,Fe|0}return Fe=M,Se=ge,Fe|0}function Rs(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0;if((v|0)==0&(w|0)==0)return B=0,M=1,ur(B|0),M|0;M=_,B=m,_=1,m=0;do D=(v&1|0)==0&!0,_=si((D?1:M)|0,(D?0:B)|0,_|0,m|0)|0,m=Ie()|0,v=ho(v|0,w|0,1)|0,w=Ie()|0,M=si(M|0,B|0,M|0,B|0)|0,B=Ie()|0;while(!((v|0)==0&(w|0)==0));return ur(m|0),_|0}function $s(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0;if(!(Ss(m,v)|0)||(m=rl(m)|0,w=+ce[v>>3],B=+ce[v+8>>3],B=m&B<0?B+6.283185307179586:B,P=p[_>>2]|0,(P|0)<=0))return P=0,P|0;if(C=p[_+4>>2]|0,m){m=0,g=B,v=-1,_=0;e:for(;;){for(f=_;D=+ce[C+(f<<4)>>3],B=+ce[C+(f<<4)+8>>3],_=(v+2|0)%(P|0)|0,M=+ce[C+(_<<4)>>3],c=+ce[C+(_<<4)+8>>3],D>M?(h=D,D=c):(h=M,M=D,D=B,B=c),w=w==M|w==h?w+2220446049250313e-31:w,!!(w<M|w>h);)if(v=f+1|0,(v|0)>=(P|0)){v=22;break e}else _=f,f=v,v=_;if(c=D<0?D+6.283185307179586:D,D=B<0?B+6.283185307179586:B,g=c==g|D==g?g+-2220446049250313e-31:g,h=c+(D-c)*((w-M)/(h-M)),(h<0?h+6.283185307179586:h)>g&&(m=m^1),_=f+1|0,(_|0)>=(P|0)){v=22;break}else v=f}if((v|0)==22)return m|0}else{m=0,g=B,v=-1,_=0;e:for(;;){for(f=_;D=+ce[C+(f<<4)>>3],B=+ce[C+(f<<4)+8>>3],_=(v+2|0)%(P|0)|0,M=+ce[C+(_<<4)>>3],c=+ce[C+(_<<4)+8>>3],D>M?(h=D,D=c):(h=M,M=D,D=B,B=c),w=w==M|w==h?w+2220446049250313e-31:w,!!(w<M|w>h);)if(v=f+1|0,(v|0)>=(P|0)){v=22;break e}else _=f,f=v,v=_;if(g=D==g|B==g?g+-2220446049250313e-31:g,D+(B-D)*((w-M)/(h-M))>g&&(m=m^1),_=f+1|0,(_|0)>=(P|0)){v=22;break}else v=f}if((v|0)==22)return m|0}return 0}function cs(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0;if(L=p[_>>2]|0,!L){p[m>>2]=0,p[m+4>>2]=0,p[m+8>>2]=0,p[m+12>>2]=0,p[m+16>>2]=0,p[m+20>>2]=0,p[m+24>>2]=0,p[m+28>>2]=0;return}if(z=m+8|0,ce[z>>3]=17976931348623157e292,W=m+24|0,ce[W>>3]=17976931348623157e292,ce[m>>3]=-17976931348623157e292,ee=m+16|0,ce[ee>>3]=-17976931348623157e292,!((L|0)<=0)){for(P=p[_+4>>2]|0,f=17976931348623157e292,g=-17976931348623157e292,C=0,_=-1,M=17976931348623157e292,D=17976931348623157e292,h=-17976931348623157e292,w=-17976931348623157e292,R=0;v=+ce[P+(R<<4)>>3],c=+ce[P+(R<<4)+8>>3],_=_+2|0,B=+ce[P+(((_|0)==(L|0)?0:_)<<4)+8>>3],v<M&&(ce[z>>3]=v,M=v),c<D&&(ce[W>>3]=c,D=c),v>h?ce[m>>3]=v:v=h,c>w&&(ce[ee>>3]=c,w=c),f=c>0&c<f?c:f,g=c<0&c>g?c:g,C=C|+St(+(c-B))>3.141592653589793,_=R+1|0,(_|0)!=(L|0);)Z=R,h=v,R=_,_=Z;C&&(ce[ee>>3]=g,ce[W>>3]=f)}}function Qu(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0,Fe=0,ge=0;if(L=p[_>>2]|0,L){if(z=m+8|0,ce[z>>3]=17976931348623157e292,W=m+24|0,ce[W>>3]=17976931348623157e292,ce[m>>3]=-17976931348623157e292,ee=m+16|0,ce[ee>>3]=-17976931348623157e292,(L|0)>0){for(B=p[_+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,w=0,v=-1,h=17976931348623157e292,f=17976931348623157e292,C=-17976931348623157e292,D=-17976931348623157e292,Z=0;M=+ce[B+(Z<<4)>>3],g=+ce[B+(Z<<4)+8>>3],Fe=v+2|0,c=+ce[B+(((Fe|0)==(L|0)?0:Fe)<<4)+8>>3],M<h&&(ce[z>>3]=M,h=M),g<f&&(ce[W>>3]=g,f=g),M>C?ce[m>>3]=M:M=C,g>D&&(ce[ee>>3]=g,D=g),P=g>0&g<P?g:P,R=g<0&g>R?g:R,w=w|+St(+(g-c))>3.141592653589793,v=Z+1|0,(v|0)!=(L|0);)Fe=Z,C=M,Z=v,v=Fe;w&&(ce[ee>>3]=R,ce[W>>3]=P)}}else p[m>>2]=0,p[m+4>>2]=0,p[m+8>>2]=0,p[m+12>>2]=0,p[m+16>>2]=0,p[m+20>>2]=0,p[m+24>>2]=0,p[m+28>>2]=0;if(Fe=_+8|0,v=p[Fe>>2]|0,!((v|0)<=0)){we=_+12|0,se=0;do if(B=p[we>>2]|0,w=se,se=se+1|0,W=m+(se<<5)|0,ee=p[B+(w<<3)>>2]|0,ee){if(Z=m+(se<<5)+8|0,ce[Z>>3]=17976931348623157e292,_=m+(se<<5)+24|0,ce[_>>3]=17976931348623157e292,ce[W>>3]=-17976931348623157e292,te=m+(se<<5)+16|0,ce[te>>3]=-17976931348623157e292,(ee|0)>0){for(L=p[B+(w<<3)+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,B=0,w=-1,z=0,h=17976931348623157e292,f=17976931348623157e292,g=-17976931348623157e292,D=-17976931348623157e292;M=+ce[L+(z<<4)>>3],C=+ce[L+(z<<4)+8>>3],w=w+2|0,c=+ce[L+(((w|0)==(ee|0)?0:w)<<4)+8>>3],M<h&&(ce[Z>>3]=M,h=M),C<f&&(ce[_>>3]=C,f=C),M>g?ce[W>>3]=M:M=g,C>D&&(ce[te>>3]=C,D=C),P=C>0&C<P?C:P,R=C<0&C>R?C:R,B=B|+St(+(C-c))>3.141592653589793,w=z+1|0,(w|0)!=(ee|0);)ge=z,z=w,g=M,w=ge;B&&(ce[te>>3]=R,ce[_>>3]=P)}}else p[W>>2]=0,p[W+4>>2]=0,p[W+8>>2]=0,p[W+12>>2]=0,p[W+16>>2]=0,p[W+20>>2]=0,p[W+24>>2]=0,p[W+28>>2]=0,v=p[Fe>>2]|0;while((se|0)<(v|0))}}function Jt(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(!($s(_,m,v)|0))return B=0,B|0;if(B=_+8|0,(p[B>>2]|0)<=0)return B=1,B|0;for(w=_+12|0,_=0;;){if(M=_,_=_+1|0,$s((p[w>>2]|0)+(M<<3)|0,m+(_<<5)|0,v)|0){_=0,w=6;break}if((_|0)>=(p[B>>2]|0)){_=1,w=6;break}}return(w|0)==6?_|0:0}function ef(){return 8}function eu(){return 16}function tf(){return 168}function Ws(){return 8}function _s(){return 16}function tu(){return 12}function ru(){return 8}function ys(_){return _=_|0,+(+((p[_>>2]|0)>>>0)+4294967296*+(p[_+4>>2]|0))}function Go(_){_=_|0;var m=0,v=0;return v=+ce[_>>3],m=+ce[_+8>>3],+ +Rt(+(v*v+m*m))}function rf(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0;f=+ce[_>>3],h=+ce[m>>3]-f,c=+ce[_+8>>3],D=+ce[m+8>>3]-c,C=+ce[v>>3],M=+ce[w>>3]-C,P=+ce[v+8>>3],g=+ce[w+8>>3]-P,M=(M*(c-P)-(f-C)*g)/(h*g-D*M),ce[B>>3]=f+h*M,ce[B+8>>3]=c+D*M}function wc(_,m){return _=_|0,m=m|0,+St(+(+ce[_>>3]-+ce[m>>3]))<11920928955078125e-23?(m=+St(+(+ce[_+8>>3]-+ce[m+8>>3]))<11920928955078125e-23,m|0):(m=0,m|0)}function mi(_,m){_=_|0,m=m|0;var v=0,w=0,B=0;return B=+ce[_>>3]-+ce[m>>3],w=+ce[_+8>>3]-+ce[m+8>>3],v=+ce[_+16>>3]-+ce[m+16>>3],+(B*B+w*w+v*v)}function nf(_,m){_=_|0,m=m|0;var v=0,w=0,B=0;v=+ce[_>>3],w=+Ft(+v),v=+Bt(+v),ce[m+16>>3]=v,v=+ce[_+8>>3],B=w*+Ft(+v),ce[m>>3]=B,v=w*+Bt(+v),ce[m+8>>3]=v}function uo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;if(M=Se,Se=Se+16|0,B=M,w=Bn(_,m)|0,(v+-1|0)>>>0>5||(w=(w|0)!=0,(v|0)==1&w))return B=-1,Se=M,B|0;do if(Ki(_,m,B)|0)w=-1;else if(w){w=((p[21936+(v<<2)>>2]|0)+5-(p[B>>2]|0)|0)%5|0;break}else{w=((p[21968+(v<<2)>>2]|0)+6-(p[B>>2]|0)|0)%6|0;break}while(!1);return B=w,Se=M,B|0}function Ki(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0,f=0;if(f=Se,Se=Se+32|0,D=f+16|0,c=f,w=La(_,m,D)|0,w|0)return v=w,Se=f,v|0;M=qu(_,m)|0,h=Xi(_,m)|0,Vs(M,c),w=lh(M,p[D>>2]|0)|0;e:do if(Cr(M)|0){do switch(M|0){case 4:{_=0;break}case 14:{_=1;break}case 24:{_=2;break}case 38:{_=3;break}case 49:{_=4;break}case 58:{_=5;break}case 63:{_=6;break}case 72:{_=7;break}case 83:{_=8;break}case 97:{_=9;break}case 107:{_=10;break}case 117:{_=11;break}default:{w=1;break e}}while(!1);if(B=p[22e3+(_*24|0)+8>>2]|0,m=p[22e3+(_*24|0)+16>>2]|0,_=p[D>>2]|0,(_|0)!=(p[c>>2]|0)&&(c=ni(M)|0,_=p[D>>2]|0,c|(_|0)==(m|0)&&(w=(w+1|0)%6|0)),(h|0)==3&(_|0)==(m|0)){w=(w+5|0)%6|0,B=22;break}(h|0)==5&(_|0)==(B|0)&&(w=(w+1|0)%6|0),B=22}else B=22;while(!1);return(B|0)==22&&(p[v>>2]=w,w=0),v=w,Se=f,v|0}function kr(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0;if(te=Se,Se=Se+32|0,Z=te+24|0,W=te+20|0,L=te+8|0,R=te+16|0,P=te,h=(Bn(_,m)|0)==0,h=h?6:5,g=Ht(_|0,m|0,52)|0,Ie()|0,g=g&15,h>>>0<=v>>>0)return w=2,Se=te,w|0;C=(g|0)==0,!C&&(z=Yt(7,0,(g^15)*3|0)|0,(z&_|0)==0&((Ie()|0)&m|0)==0)?B=v:M=4;e:do if((M|0)==4){if(B=(Bn(_,m)|0)!=0,((B?4:5)|0)<(v|0)||Ki(_,m,Z)|0||(M=(p[Z>>2]|0)+v|0,B?B=22288+(((M|0)%5|0)<<2)|0:B=22320+(((M|0)%6|0)<<2)|0,z=p[B>>2]|0,(z|0)==7))return w=1,Se=te,w|0;p[W>>2]=0,B=xn(_,m,z,W,L)|0;do if(!B){if(c=L,f=p[c>>2]|0,c=p[c+4>>2]|0,D=c>>>0<m>>>0|(c|0)==(m|0)&f>>>0<_>>>0,M=D?f:_,D=D?c:m,!C&&(C=Yt(7,0,(g^15)*3|0)|0,(f&C|0)==0&(c&(Ie()|0)|0)==0))B=v;else{if(c=(v+-1+h|0)%(h|0)|0,B=Bn(_,m)|0,(c|0)<0&&jt(23313,23315,245,23324),h=(B|0)!=0,((h?4:5)|0)<(c|0)&&jt(23313,23315,245,23324),Ki(_,m,Z)|0&&jt(23313,23315,245,23324),B=(p[Z>>2]|0)+c|0,h?B=22288+(((B|0)%5|0)<<2)|0:B=22320+(((B|0)%6|0)<<2)|0,c=p[B>>2]|0,(c|0)==7&&jt(23313,23315,245,23324),p[R>>2]=0,B=xn(_,m,c,R,P)|0,B|0)break;f=P,h=p[f>>2]|0,f=p[f+4>>2]|0;do if(f>>>0<D>>>0|(f|0)==(D|0)&h>>>0<M>>>0){if(Bn(h,f)|0?M=Qc(h,f,_,m)|0:M=p[22384+((((p[R>>2]|0)+(p[22352+(c<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,B=Bn(h,f)|0,(M+-1|0)>>>0>5){B=-1,M=h,D=f;break}if(B=(B|0)!=0,(M|0)==1&B){B=-1,M=h,D=f;break}do if(Ki(h,f,Z)|0)B=-1;else if(B){B=((p[21936+(M<<2)>>2]|0)+5-(p[Z>>2]|0)|0)%5|0;break}else{B=((p[21968+(M<<2)>>2]|0)+6-(p[Z>>2]|0)|0)%6|0;break}while(!1);M=h,D=f}else B=v;while(!1);c=L,f=p[c>>2]|0,c=p[c+4>>2]|0}if((M|0)==(f|0)&(D|0)==(c|0)){if(h=(Bn(f,c)|0)!=0,h?_=Qc(f,c,_,m)|0:_=p[22384+((((p[W>>2]|0)+(p[22352+(z<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,B=Bn(f,c)|0,(_+-1|0)>>>0<=5&&(ee=(B|0)!=0,!((_|0)==1&ee)))do if(Ki(f,c,Z)|0)B=-1;else if(ee){B=((p[21936+(_<<2)>>2]|0)+5-(p[Z>>2]|0)|0)%5|0;break}else{B=((p[21968+(_<<2)>>2]|0)+6-(p[Z>>2]|0)|0)%6|0;break}while(!1);else B=-1;B=B+1|0,B=(B|0)==6|h&(B|0)==5?0:B}m=D,_=M;break e}while(!1);return w=B,Se=te,w|0}while(!1);return ee=Yt(B|0,0,56)|0,Z=Ie()|0|m&-2130706433|536870912,p[w>>2]=ee|_,p[w+4>>2]=Z,w=0,Se=te,w|0}function vo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;return M=(Bn(_,m)|0)==0,w=kr(_,m,0,v)|0,B=(w|0)==0,M?!B||(w=kr(_,m,1,v+8|0)|0,w|0)||(w=kr(_,m,2,v+16|0)|0,w|0)||(w=kr(_,m,3,v+24|0)|0,w|0)||(w=kr(_,m,4,v+32|0)|0,w)?(M=w,M|0):kr(_,m,5,v+40|0)|0:!B||(w=kr(_,m,1,v+8|0)|0,w|0)||(w=kr(_,m,2,v+16|0)|0,w|0)||(w=kr(_,m,3,v+24|0)|0,w|0)||(w=kr(_,m,4,v+32|0)|0,w|0)?(M=w,M|0):(M=v+40|0,p[M>>2]=0,p[M+4>>2]=0,M=0,M|0)}function Js(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0,c=0,h=0;return h=Se,Se=Se+192|0,B=h,M=h+168|0,D=Ht(_|0,m|0,56)|0,Ie()|0,D=D&7,c=m&-2130706433|134217728,w=La(_,c,M)|0,w|0?(c=w,Se=h,c|0):(m=Ht(_|0,m|0,52)|0,Ie()|0,m=m&15,Bn(_,c)|0?Oo(M,m,D,1,B):jl(M,m,D,1,B),c=B+8|0,p[v>>2]=p[c>>2],p[v+4>>2]=p[c+4>>2],p[v+8>>2]=p[c+8>>2],p[v+12>>2]=p[c+12>>2],c=0,Se=h,c|0)}function zi(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0;return B=Se,Se=Se+16|0,v=B,!(!0&(m&2013265920|0)==536870912)||(w=m&-2130706433|134217728,!(No(_,w)|0))?(w=0,Se=B,w|0):(M=Ht(_|0,m|0,56)|0,Ie()|0,M=(kr(_,w,M&7,v)|0)==0,w=v,w=M&((p[w>>2]|0)==(_|0)?(p[w+4>>2]|0)==(m|0):0)&1,Se=B,w|0)}function Aa(_,m,v){_=_|0,m=m|0,v=v|0;var w=0;(m|0)>0?(w=Ks(m,4)|0,p[_>>2]=w,w||jt(23337,23360,40,23374)):p[_>>2]=0,p[_+4>>2]=m,p[_+8>>2]=0,p[_+12>>2]=v}function Vo(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0;B=_+4|0,M=_+12|0,D=_+8|0;e:for(;;){for(v=p[B>>2]|0,m=0;;){if((m|0)>=(v|0))break e;if(w=p[_>>2]|0,c=p[w+(m<<2)>>2]|0,!c)m=m+1|0;else break}m=w+(~~(+St(+(+lt(10,+ +(15-(p[M>>2]|0)|0))*(+ce[c>>3]+ +ce[c+8>>3])))%+(v|0))>>>0<<2)|0,v=p[m>>2]|0;t:do if(v|0){if(w=c+32|0,(v|0)==(c|0))p[m>>2]=p[w>>2];else{if(v=v+32|0,m=p[v>>2]|0,!m)break;for(;(m|0)!=(c|0);)if(v=m+32|0,m=p[v>>2]|0,!m)break t;p[v>>2]=p[w>>2]}Or(c),p[D>>2]=(p[D>>2]|0)+-1}while(!1)}Or(p[_>>2]|0)}function Xs(_){_=_|0;var m=0,v=0,w=0;for(w=p[_+4>>2]|0,v=0;;){if((v|0)>=(w|0)){m=0,v=4;break}if(m=p[(p[_>>2]|0)+(v<<2)>>2]|0,!m)v=v+1|0;else{v=4;break}}return(v|0)==4?m|0:0}function qi(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0;if(v=~~(+St(+(+lt(10,+ +(15-(p[_+12>>2]|0)|0))*(+ce[m>>3]+ +ce[m+8>>3])))%+(p[_+4>>2]|0))>>>0,v=(p[_>>2]|0)+(v<<2)|0,w=p[v>>2]|0,!w)return M=1,M|0;M=m+32|0;do if((w|0)!=(m|0)){if(v=p[w+32>>2]|0,!v)return M=1,M|0;for(B=v;;){if((B|0)==(m|0)){B=8;break}if(v=p[B+32>>2]|0,v)w=B,B=v;else{v=1,B=10;break}}if((B|0)==8){p[w+32>>2]=p[M>>2];break}else if((B|0)==10)return v|0}else p[v>>2]=p[M>>2];while(!1);return Or(m),M=_+8|0,p[M>>2]=(p[M>>2]|0)+-1,M=0,M|0}function hl(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0;M=Gn(40)|0,M||jt(23390,23360,98,23403),p[M>>2]=p[m>>2],p[M+4>>2]=p[m+4>>2],p[M+8>>2]=p[m+8>>2],p[M+12>>2]=p[m+12>>2],B=M+16|0,p[B>>2]=p[v>>2],p[B+4>>2]=p[v+4>>2],p[B+8>>2]=p[v+8>>2],p[B+12>>2]=p[v+12>>2],p[M+32>>2]=0,B=~~(+St(+(+lt(10,+ +(15-(p[_+12>>2]|0)|0))*(+ce[m>>3]+ +ce[m+8>>3])))%+(p[_+4>>2]|0))>>>0,B=(p[_>>2]|0)+(B<<2)|0,w=p[B>>2]|0;do if(!w)p[B>>2]=M;else{for(;!(ka(w,m)|0&&ka(w+16|0,v)|0);)if(B=p[w+32>>2]|0,w=(B|0)==0?w:B,!(p[w+32>>2]|0)){D=10;break}if((D|0)==10){p[w+32>>2]=M;break}return Or(M),D=w,D|0}while(!1);return D=_+8|0,p[D>>2]=(p[D>>2]|0)+1,D=M,D|0}function _r(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0;if(B=~~(+St(+(+lt(10,+ +(15-(p[_+12>>2]|0)|0))*(+ce[m>>3]+ +ce[m+8>>3])))%+(p[_+4>>2]|0))>>>0,B=p[(p[_>>2]|0)+(B<<2)>>2]|0,!B)return v=0,v|0;if(!v){for(_=B;;){if(ka(_,m)|0){w=10;break}if(_=p[_+32>>2]|0,!_){_=0,w=10;break}}if((w|0)==10)return _|0}for(_=B;;){if(ka(_,m)|0&&ka(_+16|0,v)|0){w=10;break}if(_=p[_+32>>2]|0,!_){_=0,w=10;break}}return(w|0)==10?_|0:0}function or(_,m){_=_|0,m=m|0;var v=0;if(v=~~(+St(+(+lt(10,+ +(15-(p[_+12>>2]|0)|0))*(+ce[m>>3]+ +ce[m+8>>3])))%+(p[_+4>>2]|0))>>>0,_=p[(p[_>>2]|0)+(v<<2)>>2]|0,!_)return v=0,v|0;for(;;){if(ka(_,m)|0){m=5;break}if(_=p[_+32>>2]|0,!_){_=0,m=5;break}}return(m|0)==5?_|0:0}function nu(){return 23424}function rs(_){return _=+_,+ +$o(+_)}function Gi(_){return _=+_,~~+rs(_)|0}function Gn(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0,z=0,W=0,ee=0,Z=0,te=0,se=0,we=0;we=Se,Se=Se+16|0,P=we;do if(_>>>0<245){if(f=_>>>0<11?16:_+11&-8,_=f>>>3,C=p[5857]|0,v=C>>>_,v&3|0)return m=(v&1^1)+_|0,_=23468+(m<<1<<2)|0,v=_+8|0,w=p[v>>2]|0,B=w+8|0,M=p[B>>2]|0,(M|0)==(_|0)?p[5857]=C&~(1<<m):(p[M+12>>2]=_,p[v>>2]=M),se=m<<3,p[w+4>>2]=se|3,se=w+se+4|0,p[se>>2]=p[se>>2]|1,se=B,Se=we,se|0;if(g=p[5859]|0,f>>>0>g>>>0){if(v|0)return m=2<<_,m=v<<_&(m|0-m),m=(m&0-m)+-1|0,c=m>>>12&16,m=m>>>c,v=m>>>5&8,m=m>>>v,M=m>>>2&4,m=m>>>M,_=m>>>1&2,m=m>>>_,w=m>>>1&1,w=(v|c|M|_|w)+(m>>>w)|0,m=23468+(w<<1<<2)|0,_=m+8|0,M=p[_>>2]|0,c=M+8|0,v=p[c>>2]|0,(v|0)==(m|0)?(_=C&~(1<<w),p[5857]=_):(p[v+12>>2]=m,p[_>>2]=v,_=C),se=w<<3,D=se-f|0,p[M+4>>2]=f|3,B=M+f|0,p[B+4>>2]=D|1,p[M+se>>2]=D,g|0&&(w=p[5862]|0,m=g>>>3,v=23468+(m<<1<<2)|0,m=1<<m,_&m?(_=v+8|0,m=p[_>>2]|0):(p[5857]=_|m,m=v,_=v+8|0),p[_>>2]=w,p[m+12>>2]=w,p[w+8>>2]=m,p[w+12>>2]=v),p[5859]=D,p[5862]=B,se=c,Se=we,se|0;if(M=p[5858]|0,M){for(v=(M&0-M)+-1|0,B=v>>>12&16,v=v>>>B,w=v>>>5&8,v=v>>>w,D=v>>>2&4,v=v>>>D,c=v>>>1&2,v=v>>>c,h=v>>>1&1,h=p[23732+((w|B|D|c|h)+(v>>>h)<<2)>>2]|0,v=h,c=h,h=(p[h+4>>2]&-8)-f|0;_=p[v+16>>2]|0,!(!_&&(_=p[v+20>>2]|0,!_));)D=(p[_+4>>2]&-8)-f|0,B=D>>>0<h>>>0,v=_,c=B?_:c,h=B?D:h;if(D=c+f|0,D>>>0>c>>>0){B=p[c+24>>2]|0,m=p[c+12>>2]|0;do if((m|0)==(c|0)){if(_=c+20|0,m=p[_>>2]|0,!m&&(_=c+16|0,m=p[_>>2]|0,!m)){v=0;break}for(;;)if(w=m+20|0,v=p[w>>2]|0,v)m=v,_=w;else if(w=m+16|0,v=p[w>>2]|0,v)m=v,_=w;else break;p[_>>2]=0,v=m}else v=p[c+8>>2]|0,p[v+12>>2]=m,p[m+8>>2]=v,v=m;while(!1);do if(B|0){if(m=p[c+28>>2]|0,_=23732+(m<<2)|0,(c|0)==(p[_>>2]|0)){if(p[_>>2]=v,!v){p[5858]=M&~(1<<m);break}}else if(se=B+16|0,p[((p[se>>2]|0)==(c|0)?se:B+20|0)>>2]=v,!v)break;p[v+24>>2]=B,m=p[c+16>>2]|0,m|0&&(p[v+16>>2]=m,p[m+24>>2]=v),m=p[c+20>>2]|0,m|0&&(p[v+20>>2]=m,p[m+24>>2]=v)}while(!1);return h>>>0<16?(se=h+f|0,p[c+4>>2]=se|3,se=c+se+4|0,p[se>>2]=p[se>>2]|1):(p[c+4>>2]=f|3,p[D+4>>2]=h|1,p[D+h>>2]=h,g|0&&(w=p[5862]|0,m=g>>>3,v=23468+(m<<1<<2)|0,m=1<<m,m&C?(_=v+8|0,m=p[_>>2]|0):(p[5857]=m|C,m=v,_=v+8|0),p[_>>2]=w,p[m+12>>2]=w,p[w+8>>2]=m,p[w+12>>2]=v),p[5859]=h,p[5862]=D),se=c+8|0,Se=we,se|0}else C=f}else C=f}else C=f}else if(_>>>0<=4294967231)if(_=_+11|0,f=_&-8,w=p[5858]|0,w){B=0-f|0,_=_>>>8,_?f>>>0>16777215?h=31:(C=(_+1048320|0)>>>16&8,z=_<<C,c=(z+520192|0)>>>16&4,z=z<<c,h=(z+245760|0)>>>16&2,h=14-(c|C|h)+(z<<h>>>15)|0,h=f>>>(h+7|0)&1|h<<1):h=0,v=p[23732+(h<<2)>>2]|0;e:do if(!v)v=0,_=0,z=61;else for(_=0,c=f<<((h|0)==31?0:25-(h>>>1)|0),M=0;;){if(D=(p[v+4>>2]&-8)-f|0,D>>>0<B>>>0)if(D)_=v,B=D;else{_=v,B=0,z=65;break e}if(z=p[v+20>>2]|0,v=p[v+16+(c>>>31<<2)>>2]|0,M=(z|0)==0|(z|0)==(v|0)?M:z,v)c=c<<1;else{v=M,z=61;break}}while(!1);if((z|0)==61){if((v|0)==0&(_|0)==0){if(_=2<<h,_=(_|0-_)&w,!_){C=f;break}C=(_&0-_)+-1|0,D=C>>>12&16,C=C>>>D,M=C>>>5&8,C=C>>>M,c=C>>>2&4,C=C>>>c,h=C>>>1&2,C=C>>>h,v=C>>>1&1,_=0,v=p[23732+((M|D|c|h|v)+(C>>>v)<<2)>>2]|0}v?z=65:(c=_,D=B)}if((z|0)==65)for(M=v;;)if(C=(p[M+4>>2]&-8)-f|0,v=C>>>0<B>>>0,B=v?C:B,_=v?M:_,v=p[M+16>>2]|0,v||(v=p[M+20>>2]|0),v)M=v;else{c=_,D=B;break}if((c|0)!=0&&D>>>0<((p[5859]|0)-f|0)>>>0&&(g=c+f|0,g>>>0>c>>>0)){M=p[c+24>>2]|0,m=p[c+12>>2]|0;do if((m|0)==(c|0)){if(_=c+20|0,m=p[_>>2]|0,!m&&(_=c+16|0,m=p[_>>2]|0,!m)){m=0;break}for(;;)if(B=m+20|0,v=p[B>>2]|0,v)m=v,_=B;else if(B=m+16|0,v=p[B>>2]|0,v)m=v,_=B;else break;p[_>>2]=0}else se=p[c+8>>2]|0,p[se+12>>2]=m,p[m+8>>2]=se;while(!1);do if(M){if(_=p[c+28>>2]|0,v=23732+(_<<2)|0,(c|0)==(p[v>>2]|0)){if(p[v>>2]=m,!m){w=w&~(1<<_),p[5858]=w;break}}else if(se=M+16|0,p[((p[se>>2]|0)==(c|0)?se:M+20|0)>>2]=m,!m)break;p[m+24>>2]=M,_=p[c+16>>2]|0,_|0&&(p[m+16>>2]=_,p[_+24>>2]=m),_=p[c+20>>2]|0,_&&(p[m+20>>2]=_,p[_+24>>2]=m)}while(!1);e:do if(D>>>0<16)se=D+f|0,p[c+4>>2]=se|3,se=c+se+4|0,p[se>>2]=p[se>>2]|1;else{if(p[c+4>>2]=f|3,p[g+4>>2]=D|1,p[g+D>>2]=D,m=D>>>3,D>>>0<256){v=23468+(m<<1<<2)|0,_=p[5857]|0,m=1<<m,_&m?(_=v+8|0,m=p[_>>2]|0):(p[5857]=_|m,m=v,_=v+8|0),p[_>>2]=g,p[m+12>>2]=g,p[g+8>>2]=m,p[g+12>>2]=v;break}if(m=D>>>8,m?D>>>0>16777215?v=31:(te=(m+1048320|0)>>>16&8,se=m<<te,Z=(se+520192|0)>>>16&4,se=se<<Z,v=(se+245760|0)>>>16&2,v=14-(Z|te|v)+(se<<v>>>15)|0,v=D>>>(v+7|0)&1|v<<1):v=0,m=23732+(v<<2)|0,p[g+28>>2]=v,_=g+16|0,p[_+4>>2]=0,p[_>>2]=0,_=1<<v,!(w&_)){p[5858]=w|_,p[m>>2]=g,p[g+24>>2]=m,p[g+12>>2]=g,p[g+8>>2]=g;break}m=p[m>>2]|0;t:do if((p[m+4>>2]&-8|0)!=(D|0)){for(w=D<<((v|0)==31?0:25-(v>>>1)|0);v=m+16+(w>>>31<<2)|0,_=p[v>>2]|0,!!_;)if((p[_+4>>2]&-8|0)==(D|0)){m=_;break t}else w=w<<1,m=_;p[v>>2]=g,p[g+24>>2]=m,p[g+12>>2]=g,p[g+8>>2]=g;break e}while(!1);te=m+8|0,se=p[te>>2]|0,p[se+12>>2]=g,p[te>>2]=g,p[g+8>>2]=se,p[g+12>>2]=m,p[g+24>>2]=0}while(!1);return se=c+8|0,Se=we,se|0}else C=f}else C=f;else C=-1;while(!1);if(v=p[5859]|0,v>>>0>=C>>>0)return m=v-C|0,_=p[5862]|0,m>>>0>15?(se=_+C|0,p[5862]=se,p[5859]=m,p[se+4>>2]=m|1,p[_+v>>2]=m,p[_+4>>2]=C|3):(p[5859]=0,p[5862]=0,p[_+4>>2]=v|3,se=_+v+4|0,p[se>>2]=p[se>>2]|1),se=_+8|0,Se=we,se|0;if(D=p[5860]|0,D>>>0>C>>>0)return Z=D-C|0,p[5860]=Z,se=p[5863]|0,te=se+C|0,p[5863]=te,p[te+4>>2]=Z|1,p[se+4>>2]=C|3,se=se+8|0,Se=we,se|0;if(p[5975]|0?_=p[5977]|0:(p[5977]=4096,p[5976]=4096,p[5978]=-1,p[5979]=-1,p[5980]=0,p[5968]=0,p[5975]=P&-16^1431655768,_=4096),c=C+48|0,h=C+47|0,M=_+h|0,B=0-_|0,f=M&B,f>>>0<=C>>>0||(_=p[5967]|0,_|0&&(g=p[5965]|0,P=g+f|0,P>>>0<=g>>>0|P>>>0>_>>>0)))return se=0,Se=we,se|0;e:do if(p[5968]&4)m=0,z=143;else{v=p[5863]|0;t:do if(v){for(w=23876;P=p[w>>2]|0,!(P>>>0<=v>>>0&&(P+(p[w+4>>2]|0)|0)>>>0>v>>>0);)if(_=p[w+8>>2]|0,_)w=_;else{z=128;break t}if(m=M-D&B,m>>>0<2147483647)if(_=ls(m|0)|0,(_|0)==((p[w>>2]|0)+(p[w+4>>2]|0)|0)){if((_|0)!=-1){D=m,M=_,z=145;break e}}else w=_,z=136;else m=0}else z=128;while(!1);do if((z|0)==128)if(v=ls(0)|0,(v|0)!=-1&&(m=v,R=p[5976]|0,L=R+-1|0,m=((L&m|0)==0?0:(L+m&0-R)-m|0)+f|0,R=p[5965]|0,L=m+R|0,m>>>0>C>>>0&m>>>0<2147483647)){if(P=p[5967]|0,P|0&&L>>>0<=R>>>0|L>>>0>P>>>0){m=0;break}if(_=ls(m|0)|0,(_|0)==(v|0)){D=m,M=v,z=145;break e}else w=_,z=136}else m=0;while(!1);do if((z|0)==136){if(v=0-m|0,!(c>>>0>m>>>0&(m>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){m=0;break}else{D=m,M=w,z=145;break e}if(_=p[5977]|0,_=h-m+_&0-_,_>>>0>=2147483647){D=m,M=w,z=145;break e}if((ls(_|0)|0)==-1){ls(v|0)|0,m=0;break}else{D=_+m|0,M=w,z=145;break e}}while(!1);p[5968]=p[5968]|4,z=143}while(!1);if((z|0)==143&&f>>>0<2147483647&&(Z=ls(f|0)|0,L=ls(0)|0,W=L-Z|0,ee=W>>>0>(C+40|0)>>>0,!((Z|0)==-1|ee^1|Z>>>0<L>>>0&((Z|0)!=-1&(L|0)!=-1)^1))&&(D=ee?W:m,M=Z,z=145),(z|0)==145){m=(p[5965]|0)+D|0,p[5965]=m,m>>>0>(p[5966]|0)>>>0&&(p[5966]=m),h=p[5863]|0;e:do if(h){for(m=23876;;){if(_=p[m>>2]|0,v=p[m+4>>2]|0,(M|0)==(_+v|0)){z=154;break}if(w=p[m+8>>2]|0,w)m=w;else break}if((z|0)==154&&(te=m+4|0,(p[m+12>>2]&8|0)==0)&&M>>>0>h>>>0&_>>>0<=h>>>0){p[te>>2]=v+D,se=(p[5860]|0)+D|0,Z=h+8|0,Z=(Z&7|0)==0?0:0-Z&7,te=h+Z|0,Z=se-Z|0,p[5863]=te,p[5860]=Z,p[te+4>>2]=Z|1,p[h+se+4>>2]=40,p[5864]=p[5979];break}for(M>>>0<(p[5861]|0)>>>0&&(p[5861]=M),v=M+D|0,m=23876;;){if((p[m>>2]|0)==(v|0)){z=162;break}if(_=p[m+8>>2]|0,_)m=_;else break}if((z|0)==162&&(p[m+12>>2]&8|0)==0){p[m>>2]=M,g=m+4|0,p[g>>2]=(p[g>>2]|0)+D,g=M+8|0,g=M+((g&7|0)==0?0:0-g&7)|0,m=v+8|0,m=v+((m&7|0)==0?0:0-m&7)|0,f=g+C|0,c=m-g-C|0,p[g+4>>2]=C|3;t:do if((h|0)==(m|0))se=(p[5860]|0)+c|0,p[5860]=se,p[5863]=f,p[f+4>>2]=se|1;else{if((p[5862]|0)==(m|0)){se=(p[5859]|0)+c|0,p[5859]=se,p[5862]=f,p[f+4>>2]=se|1,p[f+se>>2]=se;break}if(_=p[m+4>>2]|0,(_&3|0)==1){D=_&-8,w=_>>>3;r:do if(_>>>0<256)if(_=p[m+8>>2]|0,v=p[m+12>>2]|0,(v|0)==(_|0)){p[5857]=p[5857]&~(1<<w);break}else{p[_+12>>2]=v,p[v+8>>2]=_;break}else{M=p[m+24>>2]|0,_=p[m+12>>2]|0;do if((_|0)==(m|0)){if(v=m+16|0,w=v+4|0,_=p[w>>2]|0,_)v=w;else if(_=p[v>>2]|0,!_){_=0;break}for(;;)if(B=_+20|0,w=p[B>>2]|0,w)_=w,v=B;else if(B=_+16|0,w=p[B>>2]|0,w)_=w,v=B;else break;p[v>>2]=0}else se=p[m+8>>2]|0,p[se+12>>2]=_,p[_+8>>2]=se;while(!1);if(!M)break;v=p[m+28>>2]|0,w=23732+(v<<2)|0;do if((p[w>>2]|0)!=(m|0)){if(se=M+16|0,p[((p[se>>2]|0)==(m|0)?se:M+20|0)>>2]=_,!_)break r}else{if(p[w>>2]=_,_|0)break;p[5858]=p[5858]&~(1<<v);break r}while(!1);if(p[_+24>>2]=M,v=m+16|0,w=p[v>>2]|0,w|0&&(p[_+16>>2]=w,p[w+24>>2]=_),v=p[v+4>>2]|0,!v)break;p[_+20>>2]=v,p[v+24>>2]=_}while(!1);m=m+D|0,B=D+c|0}else B=c;if(m=m+4|0,p[m>>2]=p[m>>2]&-2,p[f+4>>2]=B|1,p[f+B>>2]=B,m=B>>>3,B>>>0<256){v=23468+(m<<1<<2)|0,_=p[5857]|0,m=1<<m,_&m?(_=v+8|0,m=p[_>>2]|0):(p[5857]=_|m,m=v,_=v+8|0),p[_>>2]=f,p[m+12>>2]=f,p[f+8>>2]=m,p[f+12>>2]=v;break}m=B>>>8;do if(!m)w=0;else{if(B>>>0>16777215){w=31;break}te=(m+1048320|0)>>>16&8,se=m<<te,Z=(se+520192|0)>>>16&4,se=se<<Z,w=(se+245760|0)>>>16&2,w=14-(Z|te|w)+(se<<w>>>15)|0,w=B>>>(w+7|0)&1|w<<1}while(!1);if(m=23732+(w<<2)|0,p[f+28>>2]=w,_=f+16|0,p[_+4>>2]=0,p[_>>2]=0,_=p[5858]|0,v=1<<w,!(_&v)){p[5858]=_|v,p[m>>2]=f,p[f+24>>2]=m,p[f+12>>2]=f,p[f+8>>2]=f;break}m=p[m>>2]|0;r:do if((p[m+4>>2]&-8|0)!=(B|0)){for(w=B<<((w|0)==31?0:25-(w>>>1)|0);v=m+16+(w>>>31<<2)|0,_=p[v>>2]|0,!!_;)if((p[_+4>>2]&-8|0)==(B|0)){m=_;break r}else w=w<<1,m=_;p[v>>2]=f,p[f+24>>2]=m,p[f+12>>2]=f,p[f+8>>2]=f;break t}while(!1);te=m+8|0,se=p[te>>2]|0,p[se+12>>2]=f,p[te>>2]=f,p[f+8>>2]=se,p[f+12>>2]=m,p[f+24>>2]=0}while(!1);return se=g+8|0,Se=we,se|0}for(m=23876;_=p[m>>2]|0,!(_>>>0<=h>>>0&&(se=_+(p[m+4>>2]|0)|0,se>>>0>h>>>0));)m=p[m+8>>2]|0;B=se+-47|0,_=B+8|0,_=B+((_&7|0)==0?0:0-_&7)|0,B=h+16|0,_=_>>>0<B>>>0?h:_,m=_+8|0,v=D+-40|0,Z=M+8|0,Z=(Z&7|0)==0?0:0-Z&7,te=M+Z|0,Z=v-Z|0,p[5863]=te,p[5860]=Z,p[te+4>>2]=Z|1,p[M+v+4>>2]=40,p[5864]=p[5979],v=_+4|0,p[v>>2]=27,p[m>>2]=p[5969],p[m+4>>2]=p[5970],p[m+8>>2]=p[5971],p[m+12>>2]=p[5972],p[5969]=M,p[5970]=D,p[5972]=0,p[5971]=m,m=_+24|0;do te=m,m=m+4|0,p[m>>2]=7;while((te+8|0)>>>0<se>>>0);if((_|0)!=(h|0)){if(M=_-h|0,p[v>>2]=p[v>>2]&-2,p[h+4>>2]=M|1,p[_>>2]=M,m=M>>>3,M>>>0<256){v=23468+(m<<1<<2)|0,_=p[5857]|0,m=1<<m,_&m?(_=v+8|0,m=p[_>>2]|0):(p[5857]=_|m,m=v,_=v+8|0),p[_>>2]=h,p[m+12>>2]=h,p[h+8>>2]=m,p[h+12>>2]=v;break}if(m=M>>>8,m?M>>>0>16777215?w=31:(te=(m+1048320|0)>>>16&8,se=m<<te,Z=(se+520192|0)>>>16&4,se=se<<Z,w=(se+245760|0)>>>16&2,w=14-(Z|te|w)+(se<<w>>>15)|0,w=M>>>(w+7|0)&1|w<<1):w=0,v=23732+(w<<2)|0,p[h+28>>2]=w,p[h+20>>2]=0,p[B>>2]=0,m=p[5858]|0,_=1<<w,!(m&_)){p[5858]=m|_,p[v>>2]=h,p[h+24>>2]=v,p[h+12>>2]=h,p[h+8>>2]=h;break}m=p[v>>2]|0;t:do if((p[m+4>>2]&-8|0)!=(M|0)){for(w=M<<((w|0)==31?0:25-(w>>>1)|0);v=m+16+(w>>>31<<2)|0,_=p[v>>2]|0,!!_;)if((p[_+4>>2]&-8|0)==(M|0)){m=_;break t}else w=w<<1,m=_;p[v>>2]=h,p[h+24>>2]=m,p[h+12>>2]=h,p[h+8>>2]=h;break e}while(!1);te=m+8|0,se=p[te>>2]|0,p[se+12>>2]=h,p[te>>2]=h,p[h+8>>2]=se,p[h+12>>2]=m,p[h+24>>2]=0}}else se=p[5861]|0,(se|0)==0|M>>>0<se>>>0&&(p[5861]=M),p[5969]=M,p[5970]=D,p[5972]=0,p[5866]=p[5975],p[5865]=-1,p[5870]=23468,p[5869]=23468,p[5872]=23476,p[5871]=23476,p[5874]=23484,p[5873]=23484,p[5876]=23492,p[5875]=23492,p[5878]=23500,p[5877]=23500,p[5880]=23508,p[5879]=23508,p[5882]=23516,p[5881]=23516,p[5884]=23524,p[5883]=23524,p[5886]=23532,p[5885]=23532,p[5888]=23540,p[5887]=23540,p[5890]=23548,p[5889]=23548,p[5892]=23556,p[5891]=23556,p[5894]=23564,p[5893]=23564,p[5896]=23572,p[5895]=23572,p[5898]=23580,p[5897]=23580,p[5900]=23588,p[5899]=23588,p[5902]=23596,p[5901]=23596,p[5904]=23604,p[5903]=23604,p[5906]=23612,p[5905]=23612,p[5908]=23620,p[5907]=23620,p[5910]=23628,p[5909]=23628,p[5912]=23636,p[5911]=23636,p[5914]=23644,p[5913]=23644,p[5916]=23652,p[5915]=23652,p[5918]=23660,p[5917]=23660,p[5920]=23668,p[5919]=23668,p[5922]=23676,p[5921]=23676,p[5924]=23684,p[5923]=23684,p[5926]=23692,p[5925]=23692,p[5928]=23700,p[5927]=23700,p[5930]=23708,p[5929]=23708,p[5932]=23716,p[5931]=23716,se=D+-40|0,Z=M+8|0,Z=(Z&7|0)==0?0:0-Z&7,te=M+Z|0,Z=se-Z|0,p[5863]=te,p[5860]=Z,p[te+4>>2]=Z|1,p[M+se+4>>2]=40,p[5864]=p[5979];while(!1);if(m=p[5860]|0,m>>>0>C>>>0)return Z=m-C|0,p[5860]=Z,se=p[5863]|0,te=se+C|0,p[5863]=te,p[te+4>>2]=Z|1,p[se+4>>2]=C|3,se=se+8|0,Se=we,se|0}return se=nu()|0,p[se>>2]=12,se=0,Se=we,se|0}function Or(_){_=_|0;var m=0,v=0,w=0,B=0,M=0,D=0,c=0,h=0;if(_){v=_+-8|0,B=p[5861]|0,_=p[_+-4>>2]|0,m=_&-8,h=v+m|0;do if(_&1)c=v,D=v;else{if(w=p[v>>2]|0,!(_&3)||(D=v+(0-w)|0,M=w+m|0,D>>>0<B>>>0))return;if((p[5862]|0)==(D|0)){if(_=h+4|0,m=p[_>>2]|0,(m&3|0)!=3){c=D,m=M;break}p[5859]=M,p[_>>2]=m&-2,p[D+4>>2]=M|1,p[D+M>>2]=M;return}if(v=w>>>3,w>>>0<256)if(_=p[D+8>>2]|0,m=p[D+12>>2]|0,(m|0)==(_|0)){p[5857]=p[5857]&~(1<<v),c=D,m=M;break}else{p[_+12>>2]=m,p[m+8>>2]=_,c=D,m=M;break}B=p[D+24>>2]|0,_=p[D+12>>2]|0;do if((_|0)==(D|0)){if(m=D+16|0,v=m+4|0,_=p[v>>2]|0,_)m=v;else if(_=p[m>>2]|0,!_){_=0;break}for(;;)if(w=_+20|0,v=p[w>>2]|0,v)_=v,m=w;else if(w=_+16|0,v=p[w>>2]|0,v)_=v,m=w;else break;p[m>>2]=0}else c=p[D+8>>2]|0,p[c+12>>2]=_,p[_+8>>2]=c;while(!1);if(B){if(m=p[D+28>>2]|0,v=23732+(m<<2)|0,(p[v>>2]|0)==(D|0)){if(p[v>>2]=_,!_){p[5858]=p[5858]&~(1<<m),c=D,m=M;break}}else if(c=B+16|0,p[((p[c>>2]|0)==(D|0)?c:B+20|0)>>2]=_,!_){c=D,m=M;break}p[_+24>>2]=B,m=D+16|0,v=p[m>>2]|0,v|0&&(p[_+16>>2]=v,p[v+24>>2]=_),m=p[m+4>>2]|0,m?(p[_+20>>2]=m,p[m+24>>2]=_,c=D,m=M):(c=D,m=M)}else c=D,m=M}while(!1);if(!(D>>>0>=h>>>0)&&(_=h+4|0,w=p[_>>2]|0,!!(w&1))){if(w&2)p[_>>2]=w&-2,p[c+4>>2]=m|1,p[D+m>>2]=m,B=m;else{if((p[5863]|0)==(h|0)){if(h=(p[5860]|0)+m|0,p[5860]=h,p[5863]=c,p[c+4>>2]=h|1,(c|0)!=(p[5862]|0))return;p[5862]=0,p[5859]=0;return}if((p[5862]|0)==(h|0)){h=(p[5859]|0)+m|0,p[5859]=h,p[5862]=D,p[c+4>>2]=h|1,p[D+h>>2]=h;return}B=(w&-8)+m|0,v=w>>>3;do if(w>>>0<256)if(m=p[h+8>>2]|0,_=p[h+12>>2]|0,(_|0)==(m|0)){p[5857]=p[5857]&~(1<<v);break}else{p[m+12>>2]=_,p[_+8>>2]=m;break}else{M=p[h+24>>2]|0,_=p[h+12>>2]|0;do if((_|0)==(h|0)){if(m=h+16|0,v=m+4|0,_=p[v>>2]|0,_)m=v;else if(_=p[m>>2]|0,!_){v=0;break}for(;;)if(w=_+20|0,v=p[w>>2]|0,v)_=v,m=w;else if(w=_+16|0,v=p[w>>2]|0,v)_=v,m=w;else break;p[m>>2]=0,v=_}else v=p[h+8>>2]|0,p[v+12>>2]=_,p[_+8>>2]=v,v=_;while(!1);if(M|0){if(_=p[h+28>>2]|0,m=23732+(_<<2)|0,(p[m>>2]|0)==(h|0)){if(p[m>>2]=v,!v){p[5858]=p[5858]&~(1<<_);break}}else if(w=M+16|0,p[((p[w>>2]|0)==(h|0)?w:M+20|0)>>2]=v,!v)break;p[v+24>>2]=M,_=h+16|0,m=p[_>>2]|0,m|0&&(p[v+16>>2]=m,p[m+24>>2]=v),_=p[_+4>>2]|0,_|0&&(p[v+20>>2]=_,p[_+24>>2]=v)}}while(!1);if(p[c+4>>2]=B|1,p[D+B>>2]=B,(c|0)==(p[5862]|0)){p[5859]=B;return}}if(_=B>>>3,B>>>0<256){v=23468+(_<<1<<2)|0,m=p[5857]|0,_=1<<_,m&_?(m=v+8|0,_=p[m>>2]|0):(p[5857]=m|_,_=v,m=v+8|0),p[m>>2]=c,p[_+12>>2]=c,p[c+8>>2]=_,p[c+12>>2]=v;return}_=B>>>8,_?B>>>0>16777215?w=31:(D=(_+1048320|0)>>>16&8,h=_<<D,M=(h+520192|0)>>>16&4,h=h<<M,w=(h+245760|0)>>>16&2,w=14-(M|D|w)+(h<<w>>>15)|0,w=B>>>(w+7|0)&1|w<<1):w=0,_=23732+(w<<2)|0,p[c+28>>2]=w,p[c+20>>2]=0,p[c+16>>2]=0,m=p[5858]|0,v=1<<w;e:do if(!(m&v))p[5858]=m|v,p[_>>2]=c,p[c+24>>2]=_,p[c+12>>2]=c,p[c+8>>2]=c;else{_=p[_>>2]|0;t:do if((p[_+4>>2]&-8|0)!=(B|0)){for(w=B<<((w|0)==31?0:25-(w>>>1)|0);v=_+16+(w>>>31<<2)|0,m=p[v>>2]|0,!!m;)if((p[m+4>>2]&-8|0)==(B|0)){_=m;break t}else w=w<<1,_=m;p[v>>2]=c,p[c+24>>2]=_,p[c+12>>2]=c,p[c+8>>2]=c;break e}while(!1);D=_+8|0,h=p[D>>2]|0,p[h+12>>2]=c,p[D>>2]=c,p[c+8>>2]=h,p[c+12>>2]=_,p[c+24>>2]=0}while(!1);if(h=(p[5865]|0)+-1|0,p[5865]=h,!(h|0)){for(_=23884;_=p[_>>2]|0,_;)_=_+8|0;p[5865]=-1}}}}function Ks(_,m){_=_|0,m=m|0;var v=0;return _?(v=Vr(m,_)|0,(m|_)>>>0>65535&&(v=((v>>>0)/(_>>>0)|0|0)==(m|0)?v:-1)):v=0,_=Gn(v)|0,!_||!(p[_+-4>>2]&3)||jo(_|0,0,v|0)|0,_|0}function ln(_,m,v,w){return _=_|0,m=m|0,v=v|0,w=w|0,v=_+v>>>0,ur(m+w+(v>>>0<_>>>0|0)>>>0|0),v|0|0}function jr(_,m,v,w){return _=_|0,m=m|0,v=v|0,w=w|0,w=m-w-(v>>>0>_>>>0|0)>>>0,ur(w|0),_-v>>>0|0|0}function Ii(_){return _=_|0,(_?31-(Hr(_^_-1)|0)|0:32)|0}function iu(_,m,v,w,B){_=_|0,m=m|0,v=v|0,w=w|0,B=B|0;var M=0,D=0,c=0,h=0,f=0,g=0,C=0,P=0,R=0,L=0;if(g=_,h=m,f=h,D=v,P=w,c=P,!f)return M=(B|0)!=0,c?M?(p[B>>2]=_|0,p[B+4>>2]=m&0,P=0,B=0,ur(P|0),B|0):(P=0,B=0,ur(P|0),B|0):(M&&(p[B>>2]=(g>>>0)%(D>>>0),p[B+4>>2]=0),P=0,B=(g>>>0)/(D>>>0)>>>0,ur(P|0),B|0);M=(c|0)==0;do if(D){if(!M){if(M=(Hr(c|0)|0)-(Hr(f|0)|0)|0,M>>>0<=31){C=M+1|0,c=31-M|0,m=M-31>>31,D=C,_=g>>>(C>>>0)&m|f<<c,m=f>>>(C>>>0)&m,M=0,c=g<<c;break}return B?(p[B>>2]=_|0,p[B+4>>2]=h|m&0,P=0,B=0,ur(P|0),B|0):(P=0,B=0,ur(P|0),B|0)}if(M=D-1|0,M&D|0){c=(Hr(D|0)|0)+33-(Hr(f|0)|0)|0,L=64-c|0,C=32-c|0,h=C>>31,R=c-32|0,m=R>>31,D=c,_=C-1>>31&f>>>(R>>>0)|(f<<C|g>>>(c>>>0))&m,m=m&f>>>(c>>>0),M=g<<L&h,c=(f<<L|g>>>(R>>>0))&h|g<<C&c-33>>31;break}return B|0&&(p[B>>2]=M&g,p[B+4>>2]=0),(D|0)==1?(R=h|m&0,L=_|0|0,ur(R|0),L|0):(L=Ii(D|0)|0,R=f>>>(L>>>0)|0,L=f<<32-L|g>>>(L>>>0)|0,ur(R|0),L|0)}else{if(M)return B|0&&(p[B>>2]=(f>>>0)%(D>>>0),p[B+4>>2]=0),R=0,L=(f>>>0)/(D>>>0)>>>0,ur(R|0),L|0;if(!g)return B|0&&(p[B>>2]=0,p[B+4>>2]=(f>>>0)%(c>>>0)),R=0,L=(f>>>0)/(c>>>0)>>>0,ur(R|0),L|0;if(M=c-1|0,!(M&c))return B|0&&(p[B>>2]=_|0,p[B+4>>2]=M&f|m&0),R=0,L=f>>>((Ii(c|0)|0)>>>0),ur(R|0),L|0;if(M=(Hr(c|0)|0)-(Hr(f|0)|0)|0,M>>>0<=30){m=M+1|0,c=31-M|0,D=m,_=f<<c|g>>>(m>>>0),m=f>>>(m>>>0),M=0,c=g<<c;break}return B?(p[B>>2]=_|0,p[B+4>>2]=h|m&0,R=0,L=0,ur(R|0),L|0):(R=0,L=0,ur(R|0),L|0)}while(!1);if(!D)f=c,h=0,c=0;else{C=v|0|0,g=P|w&0,f=ln(C|0,g|0,-1,-1)|0,v=Ie()|0,h=c,c=0;do w=h,h=M>>>31|h<<1,M=c|M<<1,w=_<<1|w>>>31|0,P=_>>>31|m<<1|0,jr(f|0,v|0,w|0,P|0)|0,L=Ie()|0,R=L>>31|((L|0)<0?-1:0)<<1,c=R&1,_=jr(w|0,P|0,R&C|0,(((L|0)<0?-1:0)>>31|((L|0)<0?-1:0)<<1)&g|0)|0,m=Ie()|0,D=D-1|0;while((D|0)!=0);f=h,h=0}return D=0,B|0&&(p[B>>2]=_,p[B+4>>2]=m),R=(M|0)>>>31|(f|D)<<1|(D<<1|M>>>31)&0|h,L=(M<<1|0)&-2|c,ur(R|0),L|0}function Fs(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0;return f=m>>31|((m|0)<0?-1:0)<<1,h=((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1,M=w>>31|((w|0)<0?-1:0)<<1,B=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,c=jr(f^_|0,h^m|0,f|0,h|0)|0,D=Ie()|0,_=M^f,m=B^h,jr((iu(c,D,jr(M^v|0,B^w|0,M|0,B|0)|0,Ie()|0,0)|0)^_|0,(Ie()|0)^m|0,_|0,m|0)|0}function sf(_,m){_=_|0,m=m|0;var v=0,w=0,B=0,M=0;return M=_&65535,B=m&65535,v=Vr(B,M)|0,w=_>>>16,_=(v>>>16)+(Vr(B,w)|0)|0,B=m>>>16,m=Vr(B,M)|0,ur((_>>>16)+(Vr(B,w)|0)+(((_&65535)+m|0)>>>16)|0),_+m<<16|v&65535|0|0}function si(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;return B=_,M=v,v=sf(B,M)|0,_=Ie()|0,ur((Vr(m,M)|0)+(Vr(w,B)|0)+_|_&0|0),v|0|0|0}function Yi(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0,D=0,c=0,h=0,f=0;return B=Se,Se=Se+16|0,c=B|0,D=m>>31|((m|0)<0?-1:0)<<1,M=((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1,f=w>>31|((w|0)<0?-1:0)<<1,h=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,_=jr(D^_|0,M^m|0,D|0,M|0)|0,m=Ie()|0,iu(_,m,jr(f^v|0,h^w|0,f|0,h|0)|0,Ie()|0,c)|0,w=jr(p[c>>2]^D|0,p[c+4>>2]^M|0,D|0,M|0)|0,v=Ie()|0,Se=B,ur(v|0),w|0}function fo(_,m,v,w){_=_|0,m=m|0,v=v|0,w=w|0;var B=0,M=0;return M=Se,Se=Se+16|0,B=M|0,iu(_,m,v,w,B)|0,Se=M,ur(p[B+4>>2]|0),p[B>>2]|0|0}function ho(_,m,v){return _=_|0,m=m|0,v=v|0,(v|0)<32?(ur(m>>v|0),_>>>v|(m&(1<<v)-1)<<32-v):(ur(((m|0)<0?-1:0)|0),m>>v-32|0)}function Ht(_,m,v){return _=_|0,m=m|0,v=v|0,(v|0)<32?(ur(m>>>v|0),_>>>v|(m&(1<<v)-1)<<32-v):(ur(0),m>>>v-32|0)}function Yt(_,m,v){return _=_|0,m=m|0,v=v|0,(v|0)<32?(ur(m<<v|(_&(1<<v)-1<<32-v)>>>32-v|0),_<<v):(ur(_<<v-32|0),0)}function Cc(_,m){return _=+_,m=+m,_!=_?+m:m!=m?+_:+fi(+_,+m)}function dl(_,m){return _=+_,m=+m,_!=_?+m:m!=m?+_:+Nr(+_,+m)}function Ho(_){return _=+_,_>=0?+wt(_+.5):+Gr(_-.5)}function bo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0;if((v|0)>=8192)return ia(_|0,m|0,v|0)|0,_|0;if(M=_|0,B=_+v|0,(_&3)==(m&3)){for(;_&3;){if(!v)return M|0;Be[_>>0]=Be[m>>0]|0,_=_+1|0,m=m+1|0,v=v-1|0}for(v=B&-4|0,w=v-64|0;(_|0)<=(w|0);)p[_>>2]=p[m>>2],p[_+4>>2]=p[m+4>>2],p[_+8>>2]=p[m+8>>2],p[_+12>>2]=p[m+12>>2],p[_+16>>2]=p[m+16>>2],p[_+20>>2]=p[m+20>>2],p[_+24>>2]=p[m+24>>2],p[_+28>>2]=p[m+28>>2],p[_+32>>2]=p[m+32>>2],p[_+36>>2]=p[m+36>>2],p[_+40>>2]=p[m+40>>2],p[_+44>>2]=p[m+44>>2],p[_+48>>2]=p[m+48>>2],p[_+52>>2]=p[m+52>>2],p[_+56>>2]=p[m+56>>2],p[_+60>>2]=p[m+60>>2],_=_+64|0,m=m+64|0;for(;(_|0)<(v|0);)p[_>>2]=p[m>>2],_=_+4|0,m=m+4|0}else for(v=B-4|0;(_|0)<(v|0);)Be[_>>0]=Be[m>>0]|0,Be[_+1>>0]=Be[m+1>>0]|0,Be[_+2>>0]=Be[m+2>>0]|0,Be[_+3>>0]=Be[m+3>>0]|0,_=_+4|0,m=m+4|0;for(;(_|0)<(B|0);)Be[_>>0]=Be[m>>0]|0,_=_+1|0,m=m+1|0;return M|0}function jo(_,m,v){_=_|0,m=m|0,v=v|0;var w=0,B=0,M=0,D=0;if(M=_+v|0,m=m&255,(v|0)>=67){for(;_&3;)Be[_>>0]=m,_=_+1|0;for(w=M&-4|0,D=m|m<<8|m<<16|m<<24,B=w-64|0;(_|0)<=(B|0);)p[_>>2]=D,p[_+4>>2]=D,p[_+8>>2]=D,p[_+12>>2]=D,p[_+16>>2]=D,p[_+20>>2]=D,p[_+24>>2]=D,p[_+28>>2]=D,p[_+32>>2]=D,p[_+36>>2]=D,p[_+40>>2]=D,p[_+44>>2]=D,p[_+48>>2]=D,p[_+52>>2]=D,p[_+56>>2]=D,p[_+60>>2]=D,_=_+64|0;for(;(_|0)<(w|0);)p[_>>2]=D,_=_+4|0}for(;(_|0)<(M|0);)Be[_>>0]=m,_=_+1|0;return M-v|0}function $o(_){return _=+_,_>=0?+wt(_+.5):+Gr(_-.5)}function ls(_){_=_|0;var m=0,v=0,w=0;return w=Ni()|0,v=p[Xe>>2]|0,m=v+_|0,(_|0)>0&(m|0)<(v|0)|(m|0)<0?(kn(m|0)|0,qr(12),-1):(m|0)>(w|0)&&!(ti(m|0)|0)?(qr(12),-1):(p[Xe>>2]=m,v|0)}return{___divdi3:Fs,___muldi3:si,___remdi3:Yi,___uremdi3:fo,_areNeighborCells:fa,_bitshift64Ashr:ho,_bitshift64Lshr:Ht,_bitshift64Shl:Yt,_calloc:Ks,_cellAreaKm2:Mn,_cellAreaM2:Ps,_cellAreaRads2:sn,_cellToBoundary:mc,_cellToCenterChild:FA,_cellToChildPos:Kl,_cellToChildren:In,_cellToChildrenSize:sl,_cellToLatLng:gc,_cellToLocalIj:vh,_cellToParent:ko,_cellToVertex:kr,_cellToVertexes:vo,_cellsToDirectedEdge:Pa,_cellsToLinkedMultiPolygon:pr,_childPosToCell:OA,_compactCells:Ac,_destroyLinkedMultiPolygon:bc,_directedEdgeToBoundary:Vl,_directedEdgeToCells:hh,_edgeLengthKm:vc,_edgeLengthM:ul,_edgeLengthRads:ll,_emscripten_replace_memory:Po,_free:Or,_getBaseCellNumber:qu,_getDirectedEdgeDestination:ha,_getDirectedEdgeOrigin:Ra,_getHexagonAreaAvgKm2:yh,_getHexagonAreaAvgM2:za,_getHexagonEdgeLengthAvgKm:zn,_getHexagonEdgeLengthAvgM:Zl,_getIcosahedronFaces:_c,_getNumCells:Uo,_getPentagons:ol,_getRes0Cells:uh,_getResolution:Fa,_greatCircleDistanceKm:Ua,_greatCircleDistanceM:Yu,_greatCircleDistanceRads:Yl,_gridDisk:En,_gridDiskDistances:as,_gridDistance:rr,_gridPathCells:Ql,_gridPathCellsSize:ms,_gridRingUnsafe:xe,_i64Add:ln,_i64Subtract:jr,_isPentagon:Bn,_isResClassIII:_h,_isValidCell:No,_isValidDirectedEdge:fh,_isValidVertex:zi,_latLngToCell:Oa,_llvm_maxnum_f64:Cc,_llvm_minnum_f64:dl,_llvm_round_f64:Ho,_localIjToCell:gi,_malloc:Gn,_maxFaceCount:Na,_maxGridDiskSize:bi,_maxPolygonToCellsSize:Pe,_memcpy:bo,_memset:jo,_originToDirectedEdges:wn,_pentagonCount:Xl,_polygonToCells:dt,_readInt64AsDoubleFromPointer:ys,_res0CellCount:tl,_round:$o,_sbrk:ls,_sizeOfCellBoundary:tf,_sizeOfCoordIJ:ru,_sizeOfGeoLoop:Ws,_sizeOfGeoPolygon:_s,_sizeOfH3Index:ef,_sizeOfLatLng:eu,_sizeOfLinkedGeoPolygon:tu,_uncompactCells:mh,_uncompactCellsSize:DA,_vertexToLatLng:Js,establishStackSpace:ri,stackAlloc:Un,stackRestore:Bi,stackSave:Ro}}(pe,Nt,Ae);e.___divdi3=xt.___divdi3,e.___muldi3=xt.___muldi3,e.___remdi3=xt.___remdi3,e.___uremdi3=xt.___uremdi3,e._areNeighborCells=xt._areNeighborCells,e._bitshift64Ashr=xt._bitshift64Ashr,e._bitshift64Lshr=xt._bitshift64Lshr,e._bitshift64Shl=xt._bitshift64Shl,e._calloc=xt._calloc,e._cellAreaKm2=xt._cellAreaKm2,e._cellAreaM2=xt._cellAreaM2,e._cellAreaRads2=xt._cellAreaRads2,e._cellToBoundary=xt._cellToBoundary,e._cellToCenterChild=xt._cellToCenterChild,e._cellToChildPos=xt._cellToChildPos,e._cellToChildren=xt._cellToChildren,e._cellToChildrenSize=xt._cellToChildrenSize,e._cellToLatLng=xt._cellToLatLng,e._cellToLocalIj=xt._cellToLocalIj,e._cellToParent=xt._cellToParent,e._cellToVertex=xt._cellToVertex,e._cellToVertexes=xt._cellToVertexes,e._cellsToDirectedEdge=xt._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=xt._cellsToLinkedMultiPolygon,e._childPosToCell=xt._childPosToCell,e._compactCells=xt._compactCells,e._destroyLinkedMultiPolygon=xt._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=xt._directedEdgeToBoundary,e._directedEdgeToCells=xt._directedEdgeToCells,e._edgeLengthKm=xt._edgeLengthKm,e._edgeLengthM=xt._edgeLengthM,e._edgeLengthRads=xt._edgeLengthRads;var j=e._emscripten_replace_memory=xt._emscripten_replace_memory;e._free=xt._free,e._getBaseCellNumber=xt._getBaseCellNumber,e._getDirectedEdgeDestination=xt._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=xt._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=xt._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=xt._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=xt._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=xt._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=xt._getIcosahedronFaces,e._getNumCells=xt._getNumCells,e._getPentagons=xt._getPentagons,e._getRes0Cells=xt._getRes0Cells,e._getResolution=xt._getResolution,e._greatCircleDistanceKm=xt._greatCircleDistanceKm,e._greatCircleDistanceM=xt._greatCircleDistanceM,e._greatCircleDistanceRads=xt._greatCircleDistanceRads,e._gridDisk=xt._gridDisk,e._gridDiskDistances=xt._gridDiskDistances,e._gridDistance=xt._gridDistance,e._gridPathCells=xt._gridPathCells,e._gridPathCellsSize=xt._gridPathCellsSize,e._gridRingUnsafe=xt._gridRingUnsafe,e._i64Add=xt._i64Add,e._i64Subtract=xt._i64Subtract,e._isPentagon=xt._isPentagon,e._isResClassIII=xt._isResClassIII,e._isValidCell=xt._isValidCell,e._isValidDirectedEdge=xt._isValidDirectedEdge,e._isValidVertex=xt._isValidVertex,e._latLngToCell=xt._latLngToCell,e._llvm_maxnum_f64=xt._llvm_maxnum_f64,e._llvm_minnum_f64=xt._llvm_minnum_f64,e._llvm_round_f64=xt._llvm_round_f64,e._localIjToCell=xt._localIjToCell,e._malloc=xt._malloc,e._maxFaceCount=xt._maxFaceCount,e._maxGridDiskSize=xt._maxGridDiskSize,e._maxPolygonToCellsSize=xt._maxPolygonToCellsSize,e._memcpy=xt._memcpy,e._memset=xt._memset,e._originToDirectedEdges=xt._originToDirectedEdges,e._pentagonCount=xt._pentagonCount,e._polygonToCells=xt._polygonToCells,e._readInt64AsDoubleFromPointer=xt._readInt64AsDoubleFromPointer,e._res0CellCount=xt._res0CellCount,e._round=xt._round,e._sbrk=xt._sbrk,e._sizeOfCellBoundary=xt._sizeOfCellBoundary,e._sizeOfCoordIJ=xt._sizeOfCoordIJ,e._sizeOfGeoLoop=xt._sizeOfGeoLoop,e._sizeOfGeoPolygon=xt._sizeOfGeoPolygon,e._sizeOfH3Index=xt._sizeOfH3Index,e._sizeOfLatLng=xt._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=xt._sizeOfLinkedGeoPolygon,e._uncompactCells=xt._uncompactCells,e._uncompactCellsSize=xt._uncompactCellsSize,e._vertexToLatLng=xt._vertexToLatLng,e.establishStackSpace=xt.establishStackSpace;var _t=e.stackAlloc=xt.stackAlloc,Ct=e.stackRestore=xt.stackRestore,Ce=e.stackSave=xt.stackSave;if(e.asm=xt,e.cwrap=K,e.setValue=O,e.getValue=k,fn){Nn(fn)||(fn=o(fn));{ei();var We=function(fe){fe.byteLength&&(fe=new Uint8Array(fe)),re.set(fe,S),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,jn()},at=function(){s(fn,We,function(){throw"could not load memory initializer "+fn})},q=It(fn);if(q)We(q.buffer);else if(e.memoryInitializerRequest){var ne=function(){var fe=e.memoryInitializerRequest,be=fe.response;if(fe.status!==200&&fe.status!==0){var ae=It(e.memoryInitializerRequestURL);if(ae)be=ae.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+fe.status+", retrying "+fn),at();return}}We(be)};e.memoryInitializerRequest.response?setTimeout(ne,0):e.memoryInitializerRequest.addEventListener("load",ne)}else at()}}var le;Ir=function fe(){le||ye(),le||(Ir=fe)};function ye(fe){if(nn>0||(qt(),nn>0))return;function be(){le||(le=!0,!U&&($t(),Ot(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),fr()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),be()},1)):be()}e.run=ye;function De(fe){throw e.onAbort&&e.onAbort(fe),fe+="",u(fe),d(fe),U=!0,"abort("+fe+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=De,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ye(),t}(typeof Fr=="object"?Fr:{}),hn="number",en=hn,pp=hn,an=hn,cn=hn,eo=hn,Sr=hn,The=[["sizeOfH3Index",hn],["sizeOfLatLng",hn],["sizeOfCellBoundary",hn],["sizeOfGeoLoop",hn],["sizeOfGeoPolygon",hn],["sizeOfLinkedGeoPolygon",hn],["sizeOfCoordIJ",hn],["readInt64AsDoubleFromPointer",hn],["isValidCell",pp,[an,cn]],["latLngToCell",en,[hn,hn,eo,Sr]],["cellToLatLng",en,[an,cn,Sr]],["cellToBoundary",en,[an,cn,Sr]],["maxGridDiskSize",en,[hn,Sr]],["gridDisk",en,[an,cn,hn,Sr]],["gridDiskDistances",en,[an,cn,hn,Sr,Sr]],["gridRingUnsafe",en,[an,cn,hn,Sr]],["maxPolygonToCellsSize",en,[Sr,eo,hn,Sr]],["polygonToCells",en,[Sr,eo,hn,Sr]],["cellsToLinkedMultiPolygon",en,[Sr,hn,Sr]],["destroyLinkedMultiPolygon",null,[Sr]],["compactCells",en,[Sr,Sr,hn,hn]],["uncompactCells",en,[Sr,hn,hn,Sr,hn,eo]],["uncompactCellsSize",en,[Sr,hn,hn,eo,Sr]],["isPentagon",pp,[an,cn]],["isResClassIII",pp,[an,cn]],["getBaseCellNumber",hn,[an,cn]],["getResolution",hn,[an,cn]],["maxFaceCount",en,[an,cn,Sr]],["getIcosahedronFaces",en,[an,cn,Sr]],["cellToParent",en,[an,cn,eo,Sr]],["cellToChildren",en,[an,cn,eo,Sr]],["cellToCenterChild",en,[an,cn,eo,Sr]],["cellToChildrenSize",en,[an,cn,eo,Sr]],["cellToChildPos",en,[an,cn,eo,Sr]],["childPosToCell",en,[hn,hn,an,cn,eo,Sr]],["areNeighborCells",en,[an,cn,an,cn,Sr]],["cellsToDirectedEdge",en,[an,cn,an,cn,Sr]],["getDirectedEdgeOrigin",en,[an,cn,Sr]],["getDirectedEdgeDestination",en,[an,cn,Sr]],["isValidDirectedEdge",pp,[an,cn]],["directedEdgeToCells",en,[an,cn,Sr]],["originToDirectedEdges",en,[an,cn,Sr]],["directedEdgeToBoundary",en,[an,cn,Sr]],["gridDistance",en,[an,cn,an,cn,Sr]],["gridPathCells",en,[an,cn,an,cn,Sr]],["gridPathCellsSize",en,[an,cn,an,cn,Sr]],["cellToLocalIj",en,[an,cn,an,cn,hn,Sr]],["localIjToCell",en,[an,cn,Sr,hn,Sr]],["getHexagonAreaAvgM2",en,[eo,Sr]],["getHexagonAreaAvgKm2",en,[eo,Sr]],["getHexagonEdgeLengthAvgM",en,[eo,Sr]],["getHexagonEdgeLengthAvgKm",en,[eo,Sr]],["greatCircleDistanceM",hn,[Sr,Sr]],["greatCircleDistanceKm",hn,[Sr,Sr]],["greatCircleDistanceRads",hn,[Sr,Sr]],["cellAreaM2",en,[an,cn,Sr]],["cellAreaKm2",en,[an,cn,Sr]],["cellAreaRads2",en,[an,cn,Sr]],["edgeLengthM",en,[an,cn,Sr]],["edgeLengthKm",en,[an,cn,Sr]],["edgeLengthRads",en,[an,cn,Sr]],["getNumCells",en,[eo,Sr]],["getRes0Cells",en,[Sr]],["res0CellCount",hn],["getPentagons",en,[hn,Sr]],["pentagonCount",hn],["cellToVertex",en,[an,cn,hn,Sr]],["cellToVertexes",en,[an,cn,Sr]],["vertexToLatLng",en,[an,cn,Sr]],["isValidVertex",pp,[an,cn]]],Ehe=0,Bhe=1,She=2,Ihe=3,K6=4,Mhe=5,Phe=6,Rhe=7,Fhe=8,Dhe=9,Ohe=10,Lhe=11,Nhe=12,khe=13,Uhe=14,zhe=15,Gs={};Gs[Ehe]="Success";Gs[Bhe]="The operation failed but a more specific error is not available";Gs[She]="Argument was outside of acceptable range";Gs[Ihe]="Latitude or longitude arguments were outside of acceptable range";Gs[K6]="Resolution argument was outside of acceptable range";Gs[Mhe]="Cell argument was not valid";Gs[Phe]="Directed edge argument was not valid";Gs[Rhe]="Undirected edge argument was not valid";Gs[Fhe]="Vertex argument was not valid";Gs[Dhe]="Pentagon distortion was encountered";Gs[Ohe]="Duplicate input";Gs[Lhe]="Cell arguments were not neighbors";Gs[Nhe]="Cell arguments had incompatible resolutions";Gs[khe]="Memory allocation failed";Gs[Uhe]="Bounds of provided memory were insufficient";Gs[zhe]="Mode or flags argument was not valid";var jw=1e3,q6=1001,Y6=1002,ay={};ay[jw]="Unknown unit";ay[q6]="Array length out of bounds";ay[Y6]="Got unexpected null value for H3 index";var Ghe="Unknown error";function Z6(t,e,r){var n=r&&"value"in r,i=new Error((t[e]||Ghe)+" (code: "+e+(n?", value: "+r.value:"")+")");return i.code=e,i}function Q6(t,e){var r=arguments.length===2?{value:e}:{};return Z6(Gs,t,r)}function cy(t,e){var r=arguments.length===2?{value:e}:{};return Z6(ay,t,r)}function io(t){if(t!==0)throw Q6(t)}var Zn={};The.forEach(function(e){Zn[e[0]]=Fr.cwrap.apply(Fr,e)});var $d=16,mA=4,uP=4,Xc=8,$w=8,Fu=Zn.sizeOfH3Index(),Ww=Zn.sizeOfLatLng(),Vhe=Zn.sizeOfCellBoundary(),Hhe=Zn.sizeOfGeoPolygon(),jp=Zn.sizeOfGeoLoop(),jhe=Zn.sizeOfLinkedGeoPolygon();Zn.sizeOfCoordIJ();var iA={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function eN(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw Q6(K6,t);return t}function tN(t){if(!t)throw cy(Y6);return t}var $he=Math.pow(2,32)-1;function rN(t){if(t>$he)throw cy(q6,t);return t}var Whe=/[^0-9a-fA-F]/;function cc(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||Whe.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),$d),r=parseInt(t.substring(t.length-8),$d);return[r,e]}function fP(t){if(t>=0)return t.toString($d);t=t&2147483647;var e=nN(8,t.toString($d)),r=(parseInt(e[0],$d)+8).toString($d);return e=r+e.substring(1),e}function Jhe(t,e){return fP(e)+nN(8,fP(t))}function nN(t,e){for(var r=t-e.length,n="",i=0;i<r;i++)n+="0";return n=n+e,n}function hP(t,e,r){for(var n=t.length,i=Fr._calloc(n,Ww),o=r?1:0,s=r?0:1,u=0;u<n*2;u+=2)Fr.HEAPF64.set([t[u/2][o],t[u/2][s]].map(cN),i/Xc+u);return Fr.HEAPU32.set([n,i],e/mA),e}function Xhe(t,e){var r=t.length-1,n=Fr._calloc(Hhe),i=0,o=i+jp,s=o+mA;hP(t[0],n+i,e);var u;if(r>0){u=Fr._calloc(r,jp);for(var d=0;d<r;d++)hP(t[d+1],u+jp*d,e)}return Fr.setValue(n+o,r,"i32"),Fr.setValue(n+s,u,"i32"),n}function Khe(t){var e=0,r=e+jp,n=r+mA,i=mA;Fr._free(Fr.getValue(t+e+i,"i8*"));var o=Fr.getValue(t+r,"i32");if(o>0){for(var s=Fr.getValue(t+n,"i32"),u=0;u<o;u++)Fr._free(Fr.getValue(s+jp*u+i,"i8*"));Fr._free(s)}Fr._free(t)}function Jw(t,e){e===void 0&&(e=0);var r=Fr.getValue(t+Fu*e,"i32"),n=Fr.getValue(t+Fu*e+mA,"i32");return n?Jhe(r,n):null}function iN(t,e){return e===void 0&&(e=0),Fr.getValue(t+Xc*e,"double")}function Xw(t){return Zn.readInt64AsDoubleFromPointer(t)}function qhe(t,e,r){Fr.HEAPU32.set(cc(t),e/mA+2*r)}function Kw(t,e){for(var r=[],n=0;n<e;n++){var i=Jw(t,n);i!==null&&r.push(i)}return r}function Yhe(t,e){for(var r=e.length,n=0;n<r;n++)qhe(e[n],t,n)}function A_(t){return lde(Fr.getValue(t,"double"))}function sN(t){return[A_(t),A_(t+Xc)]}function oN(t){return[A_(t+Xc),A_(t)]}function Zhe(t,e,r){for(var n=Fr.getValue(t,"i32"),i=t+Xc,o=[],s=e?oN:sN,u=0;u<n*2;u+=2)o.push(s(i+Xc*u));return r&&o.push(o[0]),o}function Qhe(t,e){for(var r=[],n=oN,i,o,s,u;t;){for(r.push(i=[]),o=Fr.getValue(t,"i8*");o;){for(i.push(s=[]),u=Fr.getValue(o,"i8*");u;)s.push(n(u)),u=Fr.getValue(u+Xc*2,"i8*");s.push(s[0]),o=Fr.getValue(o+uP*2,"i8*")}t=Fr.getValue(t+uP*2,"i8*")}return r}function ede(t){var e=cc(t),r=e[0],n=e[1];return!!Zn.isPentagon(r,n)}function p_(t){var e=cc(t),r=e[0],n=e[1];return Zn.isValidCell(r,n)?Zn.getResolution(r,n):-1}function qw(t,e,r){var n=Fr._malloc(Ww);Fr.HEAPF64.set([t,e].map(cN),n/Xc);var i=Fr._malloc(Fu);try{return io(Zn.latLngToCell(n,r,i)),tN(Jw(i))}finally{Fr._free(i),Fr._free(n)}}function Yw(t){var e=Fr._malloc(Ww),r=cc(t),n=r[0],i=r[1];try{return io(Zn.cellToLatLng(n,i,e)),sN(e)}finally{Fr._free(e)}}function aN(t,e){var r=Fr._malloc(Vhe),n=cc(t),i=n[0],o=n[1];try{return io(Zn.cellToBoundary(i,o,r)),Zhe(r,e,e)}finally{Fr._free(r)}}function tde(t,e){var r=cc(t),n=r[0],i=r[1],o=Fr._malloc(Fu);try{return io(Zn.cellToParent(n,i,e,o)),tN(Jw(o))}finally{Fr._free(o)}}function rde(t,e){var r=cc(t),n=r[0],i=r[1],o=Fr._malloc($w);try{io(Zn.maxGridDiskSize(e,o));var s=rN(Xw(o)),u=Fr._calloc(s,Fu);try{return io(Zn.gridDisk(n,i,e,u)),Kw(u,s)}finally{Fr._free(u)}}finally{Fr._free(o)}}function nde(t,e,r){if(eN(e),r=!!r,t.length===0||t[0].length===0)return[];var n=typeof t[0][0]=="number"?[t]:t,i=Xhe(n,r),o=Fr._malloc($w);try{io(Zn.maxPolygonToCellsSize(i,e,0,o));var s=rN(Xw(o)),u=Fr._calloc(s,Fu);try{return io(Zn.polygonToCells(i,e,0,u)),Kw(u,s)}finally{Fr._free(u)}}finally{Fr._free(o),Khe(i)}}function ide(t,e){if(!t||!t.length)return[];var r=t.length,n=Fr._calloc(r,Fu);Yhe(n,t);var i=Fr._calloc(jhe);try{return io(Zn.cellsToLinkedMultiPolygon(n,r,i)),Qhe(i,e)}finally{Zn.destroyLinkedMultiPolygon(i),Fr._free(i),Fr._free(n)}}function sde(t){var e=cc(t),r=e[0],n=e[1],i=6,o=Fr._calloc(i,Fu);try{return io(Zn.originToDirectedEdges(r,n,o)),Kw(o,i)}finally{Fr._free(o)}}function ode(t,e){var r=cc(t),n=r[0],i=r[1],o=cc(e),s=o[0],u=o[1],d=Fr._malloc($w);try{return io(Zn.gridDistance(n,i,s,u,d)),Xw(d)}finally{Fr._free(d)}}function ade(t,e){var r=cc(t),n=r[0],i=r[1],o=Fr._malloc(Xc);try{switch(e){case iA.m:io(Zn.edgeLengthM(n,i,o));break;case iA.km:io(Zn.edgeLengthKm(n,i,o));break;case iA.rads:io(Zn.edgeLengthRads(n,i,o));break;default:throw cy(jw,e)}return iN(o)}finally{Fr._free(o)}}function cde(t,e){eN(t);var r=Fr._malloc(Xc);try{switch(e){case iA.m:io(Zn.getHexagonEdgeLengthAvgM(t,r));break;case iA.km:io(Zn.getHexagonEdgeLengthAvgKm(t,r));break;default:throw cy(jw,e)}return iN(r)}finally{Fr._free(r)}}function cN(t){return t*Math.PI/180}function lde(t){return t*180/Math.PI}function Zw(t,e){e=e===void 0?t[0][0]:e;for(const r of t){const n=r[0]-e;n>180?r[0]-=360:n<-180&&(r[0]+=360)}}function ude(t,e,r){const[n,i]=Yw(t),o=e.length;Zw(e,i);const s=e[0]===e[o-1]?o-1:o;for(let u=0;u<s;u++)e[u][0]=sc(i,e[u][0],r),e[u][1]=sc(n,e[u][1],r)}function fde(t,e,r){const n=t(e,r),[i,o]=Yw(n);return[o,i]}function dP(t,e=1){const r=aN(t,!0);return e!==1?ude(t,r,e):Zw(r),r}function hde(t){const e=new Float64Array(t.length*2);let r=0;for(const n of t)e[r++]=n[0],e[r++]=n[1];return e}const dde=10;function Ade(t,e){let r;return t==null?r=e:typeof t=="object"?r={...t,coverage:e}:r={getHexagon:t,coverage:e},r}const pde={...Vu.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class Zc extends gs{initializeState(){Zc._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:r}){if(e.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,r=!1,n=!1;const{iterable:i,objectInfo:o}=qc(this.props.data);for(const s of i){o.index++;const u=this.props.getHexagon(s,o),d=p_(u);if(e<0){if(e=d,!this.props.highPrecision)break}else if(e!==d){n=!0;break}if(ede(u)){r=!0;break}}return{resolution:e,edgeLengthKM:e>=0?cde(e,"km"):0,hasMultipleRes:n,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:r,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return!!i?.resolution||n||r||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:r,edgeLengthKM:n,centerHex:i}=this.state;if(r<0)return;const o=this.props.centerHexagon||qw(e.latitude,e.longitude,r);if(i===o)return;if(i)try{if(ode(i,o)*n<dde)return}catch{}const{unitsPerMeter:s}=e.distanceScales;let u=dP(o);const[d,y]=Yw(o),[x,E]=e.projectFlat([y,d]);u=u.map(S=>{const O=e.projectFlat(S);return[(O[0]-x)/s[0],(O[1]-E)/s[1]]}),this.setState({centerHex:o,vertices:u})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:r,coverage:n,extruded:i,wireframe:o,stroked:s,filled:u,lineWidthUnits:d,lineWidthScale:y,lineWidthMinPixels:x,lineWidthMaxPixels:E,getFillColor:S,getElevation:O,getLineColor:k,getLineWidth:U,transitions:J,updateTriggers:G}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:o,stroked:s,filled:u,lineWidthUnits:d,lineWidthScale:y,lineWidthMinPixels:x,lineWidthMaxPixels:E,material:r,getElevation:O,getFillColor:S,getLineColor:k,getLineWidth:U,transitions:J,updateTriggers:{getFillColor:G.getFillColor,getElevation:G.getElevation,getLineColor:G.getLineColor,getLineWidth:G.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:r,updateTriggers:n,coverage:i}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",Vu),s=this._getForwardProps();return s.updateTriggers.getPolygon=Ade(n.getHexagon,i),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(u,d)=>{const y=r(u,d);return hde(dP(y,i))}})}_renderColumnLayer(){const{data:e,getHexagon:r,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",Yc),o=this._getForwardProps();return o.updateTriggers.getPosition=n.getHexagon,new i(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:fde.bind(null,r)})}}Zc.defaultProps=pde;Zc.layerName="H3HexagonLayer";Zc._checkH3Lib=()=>{};const gde={getHexagons:{type:"accessor",value:t=>t.hexagons}};class ly extends Hu{initializeState(){Zc._checkH3Lib()}updateState({props:e,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){const{data:n,getHexagons:i}=e,o=[],{iterable:s,objectInfo:u}=qc(n);for(const d of s){u.index++;const y=i(d,u),x=ide(y,!0);for(const E of x){for(const S of E)Zw(S);o.push(this.getSubLayerRow({polygon:E},d,u.index))}}this.setState({polygons:o})}}indexToBounds(){const{getElevation:e,getFillColor:r,getLineColor:n,getLineWidth:i}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(i)}}}ly.layerName="H3ClusterLayer";ly.defaultProps=gde;const Db=Math.PI/180,W0=new Float32Array(16),AP=new Float32Array(12);function pP(t,e,r){const n=e[0]*Db,i=e[1]*Db,o=e[2]*Db,s=Math.sin(o),u=Math.sin(n),d=Math.sin(i),y=Math.cos(o),x=Math.cos(n),E=Math.cos(i),S=r[0],O=r[1],k=r[2];t[0]=S*E*x,t[1]=S*d*x,t[2]=S*-u,t[3]=O*(-d*y+E*u*s),t[4]=O*(E*y+d*u*s),t[5]=O*x*s,t[6]=k*(d*s+E*u*y),t[7]=k*(-E*s+d*u*y),t[8]=k*x*y}function gP(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const lN={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){const{data:n,getOrientation:i,getScale:o,getTranslation:s,getTransformMatrix:u}=this.props,d=Array.isArray(u),y=d&&u.length===16,x=Array.isArray(o),E=Array.isArray(i),S=Array.isArray(s),O=y||!d&&!!u(n[0]);O?t.constant=y:t.constant=E&&x&&S;const k=t.value;if(t.constant){let U;O?(W0.set(u),U=gP(W0)):(U=AP,pP(U,i,o),U.set(s,9)),t.value=new Float32Array(U)}else{let U=e*t.size;const{iterable:J,objectInfo:G}=qc(n,e,r);for(const H of J){G.index++;let K;if(O)W0.set(y?u:u(H,G)),K=gP(W0);else{K=AP;const he=E?i:i(H,G),Y=x?o:o(H,G);pP(K,he,Y),K.set(S?s:s(H,G),9)}k[U++]=K[0],k[U++]=K[1],k[U++]=K[2],k[U++]=K[3],k[U++]=K[4],k[U++]=K[5],k[U++]=K[6],k[U++]=K[7],k[U++]=K[8],k[U++]=K[9],k[U++]=K[10],k[U++]=K[11]}}}};function uN(t,e){return e===Xr.CARTESIAN||e===Xr.METER_OFFSETS||e===Xr.DEFAULT&&!t.isGeospatial}const mP=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,mde={name:"simpleMesh",vs:mP,fs:mP,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},_de=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yde=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function vde(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function fN(t){let e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,s=-1/0;const u=t.POSITION?t.POSITION.value:[],d=u&&u.length;for(let y=0;y<d;y+=3){const x=u[y],E=u[y+1],S=u[y+2];e=x<e?x:e,r=E<r?E:r,n=S<n?S:n,i=x>i?x:i,o=E>o?E:o,s=S>s?S:s}return[[e,r,n],[i,o,s]]}function bde(t,e,r){const n=vde(e.value),i=r||xde(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function xde(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}function Ob(t){const e=t.positions||t.POSITION;Wr.assert(e,'no "postions" or "POSITION" attribute in mesh');const r=e.value.length/e.size;let n=t.COLOR_0||t.colors;n||(n={size:3,value:new Float32Array(r*3).fill(1)});let i=t.NORMAL||t.normals;i||(i={size:3,value:new Float32Array(r*3).fill(0)});let o=t.TEXCOORD_0||t.texCoords;return o||(o={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:o}}function _P(t){return t instanceof zs?(t.attributes=Ob(t.attributes),t):t.attributes?new zs({...t,topology:"triangle-list",attributes:Ob(t.attributes)}):new zs({topology:"triangle-list",attributes:Ob(t)})}const wde=[0,0,0,255],Cde={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:wde},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class Wf extends ps{getShaders(){return super.getShaders({vs:_de,fs:yde,modules:[Ts,Ux,na,mde]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){const{attributes:n}=_P(r);n.POSITION=n.POSITION||n.positions,e=fN(n)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:lN}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e;if(r.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);const o=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==n.texture&&r.texture instanceof Yn&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:r}=this.state;if(!r)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:o,coordinateSystem:s,_instanced:u}=this.props,d={sizeScale:o,composeModelMatrix:!u||uN(n,s),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:d}),r.draw(i)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){const r=new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:_P(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,o={sampler:n||i,hasTexture:!!n};return r.shaderInputs.setProps({simpleMesh:o}),r}setTexture(e){const{emptyTexture:r,model:n}=this.state;if(n){const i={sampler:e||r,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}Wf.defaultProps=Cde;Wf.layerName="SimpleMeshLayer";var Qa;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Qa||(Qa={}));function hN(t,e,r,n){const i={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:o}=n;return o&&(i.bindings.pbr_diffuseEnvSampler=o.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=o.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=o.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n?.pbrDebug&&(i.defines.PBR_DEBUG=1,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(i.defines.HAS_NORMALS=1),r.TANGENT&&n?.useTangents&&(i.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(i.defines.HAS_UV=1),n?.imageBasedLightingEnvironment&&(i.defines.USE_IBL=1),n?.lights&&(i.defines.USE_LIGHTS=1),e&&Tde(t,e,i),i}function Tde(t,e,r){if(r.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&Ede(t,e.pbrMetallicRoughness,r),e.normalTexture){$p(t,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);const{scale:n=1}=e.normalTexture;r.uniforms.normalScale=n}if(e.occlusionTexture){$p(t,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);const{strength:n=1}=e.occlusionTexture;r.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&($p(t,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=n;break;case"BLEND":Xt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=Qa.FUNC_ADD,r.glParameters.blendFunc=[Qa.SRC_ALPHA,Qa.ONE_MINUS_SRC_ALPHA,Qa.ONE,Qa.ONE_MINUS_SRC_ALPHA];break}}function Ede(t,e,r){e.baseColorTexture&&$p(t,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&$p(t,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);const{metallicFactor:n=1,roughnessFactor:i=1}=e;r.uniforms.metallicRoughnessValues=[n,i]}function $p(t,e,r,n=null,i){const o=e?.texture?.sampler?.parameters||{},s=e.texture.source.image;let u,d={};s.compressed?(u=s,d={[Qa.TEXTURE_MIN_FILTER]:s.data.length>1?Qa.LINEAR_MIPMAP_NEAREST:Qa.LINEAR}):u={data:s};const y=t.createTexture({id:e.uniformName||e.id,parameters:{...o,...d},pixelStore:{[Qa.UNPACK_FLIP_Y_WEBGL]:!1},...u});i.bindings[r]=y,n&&(i.defines[n]=1),i.generatedTextures.push(y)}var yP,vP,bP,xP,wP,CP,TP,EP;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(yP||(yP={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(vP||(vP={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(bP||(bP={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(xP||(xP={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(wP||(wP={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(CP||(CP={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(TP||(TP={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(EP||(EP={}));const Bde={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sde={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Ide{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:i,target:o,path:s})=>{Lde(n,i,o,s),Rde(o,o._node)})}}class Mde{animations;constructor(e){this.animations=e.animations.map((r,n)=>{const i=r.name||`Animation-${n}`,o=r.samplers.map(({input:u,interpolation:d="LINEAR",output:y})=>({input:BP(e.accessors[u]),interpolation:d,output:BP(e.accessors[y])})),s=r.channels.map(({sampler:u,target:d})=>({sampler:o[u],target:e.nodes[d.node],path:d.path}));return new Ide({name:i,channels:s})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}}function BP(t){if(!t._animation){const e=Sde[t.componentType],r=Bde[t.type],n=r*t.count,{buffer:i,byteOffset:o}=t.bufferView.data,s=new e(i,o+(t.byteOffset||0),n);if(r===1)t._animation=Array.from(s);else{const u=[];for(let d=0;d<s.length;d+=r)u.push(Array.from(s.slice(d,d+r)));t._animation=u}}return t._animation}const Pde=new An;function Rde(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const r=Pde.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}const Lb=new Kp;function Fde(t,e,r,n,i){if(e==="rotation"){Lb.slerp({start:r,target:n,ratio:i});for(let o=0;o<Lb.length;o++)t[e][o]=Lb[o]}else for(let o=0;o<r.length;o++)t[e][o]=i*n[o]+(1-i)*r[o]}function Dde(t,e,{p0:r,outTangent0:n,inTangent1:i,p1:o,tDiff:s,ratio:u}){for(let d=0;d<t[e].length;d++){const y=n[d]*s,x=i[d]*s;t[e][d]=(2*Math.pow(u,3)-3*Math.pow(u,2)+1)*r[d]+(Math.pow(u,3)-2*Math.pow(u,2)+u)*y+(-2*Math.pow(u,3)+3*Math.pow(u,2))*o[d]+(Math.pow(u,3)-Math.pow(u,2))*x}}function Ode(t,e,r){for(let n=0;n<r.length;n++)t[e][n]=r[n]}function Lde(t,{input:e,interpolation:r,output:n},i,o){const s=e[e.length-1],u=t%s,d=e.findIndex(S=>S>=u),y=Math.max(0,d-1);if(!Array.isArray(i[o]))switch(o){case"translation":i[o]=[0,0,0];break;case"rotation":i[o]=[0,0,0,1];break;case"scale":i[o]=[1,1,1];break;default:Xt.warn(`Bad animation path ${o}`)()}const x=e[y],E=e[d];switch(r){case"STEP":Ode(i,o,n[y]);break;case"LINEAR":if(E>x){const S=(u-x)/(E-x);Fde(i,o,n[y],n[d],S)}break;case"CUBICSPLINE":if(E>x){const S=(u-x)/(E-x),O=E-x,k=n[3*y+1],U=n[3*y+2],J=n[3*d+0],G=n[3*d+1];Dde(i,o,{p0:k,outTangent0:U,inTangent1:J,p1:G,tDiff:O,ratio:S})}break;default:Xt.warn(`Interpolation ${r} not supported`)();break}}const Nde=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,kde=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,Ude=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function zde(t,e){const{id:r,geometry:n,material:i,vertexCount:o,materialOptions:s,modelOptions:u}=e,d=hN(t,i,n.attributes,s);Xt.info(4,"createGLTFModel defines: ",d.defines)();const y=[],x={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},E={id:r,source:Nde,vs:kde,fs:Ude,geometry:n,topology:n.topology,vertexCount:o,modules:[zx],...u,defines:{...d.defines,...u.defines},parameters:{...x,...d.parameters,...u.parameters}},S=new Ei(t,E),{camera:O,...k}={...d.uniforms,...u.uniforms,...d.bindings,...u.bindings};return S.shaderInputs.setProps({pbrMaterial:k,pbrProjection:{camera:O}}),new Z1({managedResources:y,model:S})}var Sf;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Sf||(Sf={}));function Gde(t){switch(t){case Sf.POINTS:return"point-list";case Sf.LINES:return"line-list";case Sf.LINE_STRIP:return"line-strip";case Sf.TRIANGLES:return"triangle-list";case Sf.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(t))}}const Vde={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Hde{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...Vde,...r}}instantiate(e){return this.gltf=G2(e),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new Mde(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(o=>this.createNode(o));return new Yd({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const i=(e.children||[]).map(s=>this.createNode(s));e.mesh&&i.push(this.createMesh(e.mesh));const o=new Yd({id:e.name||e.id,children:i});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){const s=new An().fromQuaternion(e.rotation);o.matrix.multiplyRight(s)}e.scale&&o.matrix.scale(e.scale)}e._node=o}const r=this.gltf.nodes.find(n=>n.id===e.id);return r._node=e._node,e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((o,s)=>this.createPrimitive(o,s,e)),i=new Yd({id:e.name||e.id,children:n});e._mesh=i}return e._mesh}createPrimitive(e,r,n){const i=e.name||`${n.name||n.id}-primitive-${r}`,o=Gde(e.mode||4),s=e.indices?e.indices.count:this.getVertexCount(e.attributes),u=zde(this.device,{id:i,geometry:this.createGeometry(i,e,o),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:s});return u.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],u}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,n){const i={};for(const[o,s]of Object.entries(r.attributes)){const{components:u,size:d,value:y}=s;i[o]={size:d??u,value:y}}return new zs({id:e,topology:n,indices:r.indices.value,attributes:i})}createBuffer(e,r){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[r]||(n.lumaBuffers[r]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}}function G2(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof ImageBitmap)return t;if(Array.isArray(t))return t.map(G2);if(t&&typeof t=="object"){const e={};for(const r in t)e[r]=G2(t[r]);return e}return t}function jde(t,e,r){const n=new Hde(t,r),i=n.instantiate(e),o=n.createAnimator();return{scenes:i,animator:o}}function ea(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const dN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},AN={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},SP=["SCALAR","VEC2","VEC3","VEC4"],$de=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Wde=new Map($de),Jde={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xde={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Kde={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function pN(t){return SP[t-1]||SP[0]}function Qw(t){const e=Wde.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function eC(t,e){const r=Kde[t.componentType],n=Jde[t.type],i=Xde[t.componentType],o=t.count*n,s=t.count*n*i;ea(s>=0&&s<=e.byteLength);const u=AN[t.componentType],d=dN[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:u,numberOfComponentsInElement:d}}function qde(t,e,r){const n=t.bufferViews[r];ea(n);const i=n.buffer,o=e[i];ea(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function Yde(t,e,r){const n=typeof r=="number"?t.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const i=t.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],u=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:d,length:y,componentByteSize:x,numberOfComponentsInElement:E}=eC(n,i),S=x*E,O=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new d(o,u,y);const k=new d(y);for(let U=0;U<n.count;U++){const J=new d(o,u+U*O,E);k.set(J,U*E)}return k}function Zde(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let so=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Zde(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof r=="string"||typeof n=="string"}getExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return r?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const n=this.json[e]&&this.json[e][r];if(!n)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,n=this.gltf.buffers[r];ea(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return Yde(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),i=this.getBuffer(r.buffer).data,o=r.byteOffset||0;return new Uint8Array(i,o,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,n){return e.extensions=e.extensions||{},e.extensions[r]=n,this.registerUsedExtension(r),this}setObjectExtension(e,r,n){const i=e.extensions||{};i[r]=n}removeObjectExtension(e,r){const n=e?.extensions||{};if(n[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(r)||i.push(r)}delete n[r]}addExtension(e,r={}){return ea(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return ea(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:r};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:n,material:i,mode:o=4}=e,u={primitives:[{attributes:this._addAttributes(r),mode:o}]};if(n){const d=this._addIndices(n);u.primitives[0].indices=d}return Number.isFinite(i)&&(u.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(u),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,r){const n=ty(e),i=r||n?.mimeType,s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,r=0,n=this.byteLength){const i=e.byteLength;ea(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:r,byteOffset:n,byteLength:i};return this.byteLength+=kl(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,r){const n={bufferView:e,type:pN(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const n=this.addBufferView(e);let i={min:r.min,max:r.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,r.size));const o={size:r.size,componentType:Qw(e),count:Math.round(e.length/r.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,r))}addTexture(e){const{imageIndex:r}=e,n={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const e=this.byteLength,r=new ArrayBuffer(e),n=new Uint8Array(r);let i=0;for(const o of this.sourceBuffers||[])i=O6(o,n,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,r){let n=!0;for(;n;){const i=e.indexOf(r);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const r={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);r[o]=s}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const n={min:null,max:null};if(e.length<r)return n;n.min=[],n.max=[];const i=e.subarray(0,r);for(const o of i)n.min.push(o),n.max.push(o);for(let o=r;o<e.length;o+=r)for(let s=0;s<r;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}};function IP(t){return(t%1+1)%1}const gN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Qde={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},mN={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function tC(t,e){return mN[e]*gN[t]}function uy(t,e,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const i=t.getTypedArrayForBufferView(e),o=fy(i,"SCALAR",r,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function fy(t,e,r,n=1){const i=gN[e],o=Qde[r],s=mN[r],u=n*i,d=u*s;let y=t.buffer,x=t.byteOffset;return x%s!==0&&(y=new Uint8Array(y).slice(x,x+d).buffer,x=0),new o(y,x,u)}function rC(t,e,r){const n=`TEXCOORD_${e.texCoord||0}`,i=r.attributes[n],o=t.getTypedArrayForAccessor(i),s=t.gltf.json,u=e.index,d=s.textures?.[u]?.source;if(typeof d<"u"){const y=s.images?.[d]?.mimeType,x=t.gltf.images?.[d];if(x&&typeof x.width<"u"){const E=[];for(let S=0;S<o.length;S+=2){const O=eAe(x,y,o,S,e.channels);E.push(O)}return E}}return[]}function _N(t,e,r,n,i){if(!r?.length)return;const o=[];for(const x of r){let E=n.findIndex(S=>S===x);E===-1&&(E=n.push(x)-1),o.push(E)}const s=new Uint32Array(o),u=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,d=t.addBufferView(s,u,0),y=t.addAccessor(d,{size:1,componentType:Qw(s),count:s.length});i.attributes[e]=y}function eAe(t,e,r,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[n],u=r[n+1];let d=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(d=4);const y=tAe(s,u,t,d);let x=0;for(const E of i){const S=typeof E=="number"?Object.values(o)[E]:o[E],O=y+S.offset,k=Lw(t);if(k.data.length<=O)throw new Error(`${k.data.length} <= ${O}`);const U=k.data[O];x|=U<<S.shift}return x}function tAe(t,e,r,n=1){const i=r.width,o=IP(t)*(i-1),s=Math.round(o),u=r.height,d=IP(e)*(u-1),y=Math.round(d),x=r.components?r.components:n;return(y*i+s)*x}function yN(t,e,r,n,i){const o=[];for(let s=0;s<e;s++){const u=r[s],d=r[s+1]-r[s];if(d+u>n)break;const y=u/i,x=d/i;o.push(t.slice(y,y+x))}return o}function vN(t,e,r){const n=[];for(let i=0;i<e;i++){const o=i*r;n.push(t.slice(o,o+r))}return n}function bN(t,e,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let u=0;u<t;u++){const d=n[u+1]-n[u];if(d+s<=e.length){const y=e.subarray(s,d+s),x=o.decode(y);i.push(x),s+=d}}return i}return[]}const xN="EXT_mesh_features",rAe=xN;async function nAe(t,e){const r=new so(t);iAe(r,e)}function iAe(t,e){const r=t.gltf.json;if(r.meshes)for(const n of r.meshes)for(const i of n.primitives)sAe(t,i,e)}function sAe(t,e,r){if(!r?.gltf?.loadBuffers)return;const i=e.extensions?.[xN]?.featureIds;if(i)for(const o of i){let s;if(typeof o.attribute<"u"){const u=`_FEATURE_ID_${o.attribute}`,d=e.attributes[u];s=t.getTypedArrayForAccessor(d)}else typeof o.texture<"u"&&r?.gltf?.loadImages?s=rC(t,o.texture,e):s=[];o.data=s}}const oAe=Object.freeze(Object.defineProperty({__proto__:null,decode:nAe,name:rAe},Symbol.toStringTag,{value:"Module"})),nC="EXT_structural_metadata",aAe=nC;async function cAe(t,e){const r=new so(t);lAe(r,e)}function lAe(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(nC);r&&(e.gltf?.loadImages&&uAe(t,r),fAe(t,r))}function uAe(t,e){const r=e.propertyTextures,n=t.gltf.json;if(r&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)dAe(t,r,o,e)}function fAe(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=hAe(i,o);s&&pAe(t,r,s)}}function hAe(t,e){for(const r of t)if(r.class===e)return r;return null}function dAe(t,e,r,n){if(!e)return;const o=r.extensions?.[nC]?.propertyTextures;if(o)for(const s of o){const u=e[s];AAe(t,u,r,n)}}function AAe(t,e,r,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const o in e.properties){const s=`${i}_${o}`,u=e.properties?.[o];if(!u)continue;u.data||(u.data=[]);const d=u.data,y=rC(t,u,r);y!==null&&(_N(t,s,y,d,r),u.data=d,n.dataAttributeNames.push(s))}}function pAe(t,e,r){const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],u=r.properties?.[o];if(u){const d=gAe(t,e,s,i,u);u.data=d}}}function gAe(t,e,r,n,i){let o=[];const s=i.values,u=t.getTypedArrayForBufferView(s),d=mAe(t,r,i,n),y=_Ae(t,i,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=yAe(r,n,u,d);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=bN(n,u,d,y);break}case"ENUM":{o=vAe(e,r,n,u,d);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function mAe(t,e,r,n){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?uy(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function _Ae(t,e,r){return typeof e.stringOffsets<"u"?uy(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function yAe(t,e,r,n){const i=t.array,o=t.count,s=tC(t.type,t.componentType),u=r.byteLength/s;let d;return t.componentType?d=fy(r,t.type,t.componentType,u):d=r,i?n?yN(d,e,n,r.length,s):o?vN(d,e,o):[]:d}function vAe(t,e,r,n,i){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=t.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const u=s.valueType||"UINT16",d=tC(e.type,u),y=n.byteLength/d;let x=fy(n,e.type,u,y);if(x||(x=n),e.array){if(i)return bAe({valuesData:x,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:d,enumEntry:s});const E=e.count;return E?xAe(x,r,E,s):[]}return iC(x,0,r,s)}function bAe(t){const{valuesData:e,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=t,u=[];for(let d=0;d<r;d++){const y=n[d],x=n[d+1]-n[d];if(x+y>i)break;const E=y/o,S=x/o,O=iC(e,E,S,s);u.push(O)}return u}function xAe(t,e,r,n){const i=[];for(let o=0;o<e;o++){const s=r*o,u=iC(t,s,r,n);i.push(u)}return i}function iC(t,e,r,n){const i=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)i.push("");else{const s=t[e+o],u=wAe(n,s);u?i.push(u.name):i.push("")}return i}function wAe(t,e){for(const r of t.values)if(r.value===e)return r;return null}const CAe=Object.freeze(Object.defineProperty({__proto__:null,decode:cAe,name:aAe},Symbol.toStringTag,{value:"Module"})),wN="EXT_feature_metadata",TAe=wN;async function EAe(t,e){const r=new so(t);BAe(r,e)}function BAe(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(wN);r&&(e.gltf?.loadImages&&SAe(t,r),IAe(t,r))}function SAe(t,e){const r=e.schema;if(!r)return;const n=r.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],u=PAe(i,o);u&&FAe(t,u,s)}}function IAe(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=MAe(i,o);s&&RAe(t,r,s)}}function MAe(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function PAe(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function RAe(t,e,r){if(!r.class)return;const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],u=r.properties?.[o];if(u){const d=DAe(t,e,s,i,u);u.data=d}}}function FAe(t,e,r){const n=e.class;for(const i in r.properties){const o=e?.properties?.[i];if(o){const s=UAe(t,o,n);o.data=s}}}function DAe(t,e,r,n,i){let o=[];const s=i.bufferView,u=t.getTypedArrayForBufferView(s),d=OAe(t,r,i,n),y=LAe(t,r,i,n);return r.type==="STRING"||r.componentType==="STRING"?o=bN(n,u,d,y):NAe(r)&&(o=kAe(r,n,u,d)),o}function OAe(t,e,r,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?uy(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function LAe(t,e,r,n){return typeof r.stringOffsetBufferView<"u"?uy(t,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function NAe(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function kAe(t,e,r,n){const i=t.type==="ARRAY",o=t.componentCount,s="SCALAR",u=t.componentType||t.type,d=tC(s,u),y=r.byteLength/d,x=fy(r,s,u,y);return i?n?yN(x,e,n,r.length,d):o?vN(x,e,o):[]:x}function UAe(t,e,r){const n=t.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)zAe(t,r,e,i,s);return i}function zAe(t,e,r,n,i){const o={channels:r.channels,...r.texture},s=rC(t,o,i);s&&_N(t,e,s,n,i)}const GAe=Object.freeze(Object.defineProperty({__proto__:null,decode:EAe,name:TAe},Symbol.toStringTag,{value:"Module"})),VAe="4.2.4",HAe="4.2.4",g_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let MP;async function PP(t){Lle(t.modules);const e=Nle("basis");return e||(MP||=jAe(t),await MP)}async function jAe(t){let e=null,r=null;return[e,r]=await Promise.all([await Gf(g_.TRANSCODER,"textures",t),await Gf(g_.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await $Ae(e,r)}function $Ae(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,initializeBasis:s}=i;s(),n({BasisFile:o})})})}let Nb;async function RP(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Nb=Nb||WAe(t),await Nb)}async function WAe(t){let e=null,r=null;return[e,r]=await Promise.all([await Gf(g_.ENCODER,"textures",t),await Gf(g_.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await JAe(e,r)}function JAe(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t(r).then(i=>{const{BasisFile:o,KTX2File:s,initializeBasis:u,BasisEncoder:d}=i;u(),n({BasisFile:o,KTX2File:s,BasisEncoder:d})})})}const hd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},XAe=["","WEBKIT_","MOZ_"],FP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let J0=null;function KAe(t){if(!J0){t=t||qAe()||void 0,J0=new Set;for(const e of XAe)for(const r in FP)if(t&&t.getExtension(`${e}${r}`)){const n=FP[r];J0.add(n)}}return J0}function qAe(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const qo=[171,75,84,88,32,50,48,187,13,10,26,10];function YAe(t){const e=new Uint8Array(t);return!(e.byteLength<qo.length||e[0]!==qo[0]||e[1]!==qo[1]||e[2]!==qo[2]||e[3]!==qo[3]||e[4]!==qo[4]||e[5]!==qo[5]||e[6]!==qo[6]||e[7]!==qo[7]||e[8]!==qo[8]||e[9]!==qo[9]||e[10]!==qo[10]||e[11]!==qo[11])}const ZAe={etc1:{basisFormat:0,compressed:!0,format:hd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:hd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:hd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:hd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:hd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:hd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function QAe(t,e){if(e.basis.containerFormat==="auto"){if(YAe(t)){const n=await RP(e);return DP(n.KTX2File,t,e)}const{BasisFile:r}=await PP(e);return kb(r,t,e)}switch(e.basis.module){case"encoder":const r=await RP(e);switch(e.basis.containerFormat){case"ktx2":return DP(r.KTX2File,t,e);case"basis":default:return kb(r.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await PP(e);return kb(n,t,e)}}function kb(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),o=[];for(let s=0;s<i;s++){const u=n.getNumLevels(s),d=[];for(let y=0;y<u;y++)d.push(epe(n,s,y,r));o.push(d)}return o}finally{n.close(),n.delete()}}function epe(t,e,r,n){const i=t.getImageWidth(e,r),o=t.getImageHeight(e,r),s=t.getHasAlpha(),{compressed:u,format:d,basisFormat:y}=CN(n,s),x=t.getImageTranscodedSizeInBytes(e,r,y),E=new Uint8Array(x);if(!t.transcodeImage(E,e,r,y,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:o,data:E,compressed:u,format:d,hasAlpha:s}}function DP(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),o=[];for(let s=0;s<i;s++){o.push(tpe(n,s,r));break}return[o]}finally{n.close(),n.delete()}}function tpe(t,e,r){const{alphaFlag:n,height:i,width:o}=t.getImageLevelInfo(e,0,0),{compressed:s,format:u,basisFormat:d}=CN(r,n),y=t.getImageTranscodedSizeInBytes(e,0,0,d),x=new Uint8Array(y);if(!t.transcodeImage(x,e,0,0,d,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:i,data:x,compressed:s,levelSize:y,hasAlpha:n,format:u}}function CN(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=sC()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),ZAe[r]}function sC(){const t=KAe();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const rpe={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:HAe,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},TN={...rpe,parse:QAe},_A=!0,OP=1735152710,oC=12,m_=8,npe=1313821514,ipe=5130562,spe=0,ope=0,ape=1;function cpe(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function lpe(t,e=0,r={}){const n=new DataView(t),{magic:i=OP}=r,o=n.getUint32(e,!1);return o===i||o===OP}function upe(t,e,r=0,n={}){const i=new DataView(e),o=cpe(i,r+0),s=i.getUint32(r+4,_A),u=i.getUint32(r+8,_A);switch(Object.assign(t,{header:{byteOffset:r,byteLength:u,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=oC,t.version){case 1:return fpe(t,i,r);case 2:return hpe(t,i,r,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function fpe(t,e,r){ai(t.header.byteLength>oC+m_);const n=e.getUint32(r+0,_A),i=e.getUint32(r+4,_A);return r+=m_,ai(i===spe),V2(t,e,r,n),r+=n,r+=H2(t,e,r,t.header.byteLength),r}function hpe(t,e,r,n){return ai(t.header.byteLength>oC+m_),dpe(t,e,r,n),r+t.header.byteLength}function dpe(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,_A),o=e.getUint32(r+4,_A);switch(r+=m_,o){case npe:V2(t,e,r,i);break;case ipe:H2(t,e,r,i);break;case ope:n.strict||V2(t,e,r,i);break;case ape:n.strict||H2(t,e,r,i);break}r+=kl(i,4)}return r}function V2(t,e,r,n){const i=new Uint8Array(e.buffer,r,n),s=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(s),kl(n,4)}function H2(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),kl(n,4)}function EN(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return n.substr(0,n.lastIndexOf("/")+1)+t}const Ape="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",ppe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",gpe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),mpe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),_pe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ype={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function vpe(t,e,r,n,i,o="NONE"){const s=await bpe();Cpe(s,s.exports[ype[i]],t,e,r,n,s.exports[_pe[o||"NONE"]])}let Ub;async function bpe(){return Ub||(Ub=xpe()),Ub}async function xpe(){let t=Ape;WebAssembly.validate(gpe)&&(t=ppe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(wpe(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function wpe(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?mpe[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,r)}function Cpe(t,e,r,n,i,o,s){const u=t.exports.sbrk,d=n+3&-4,y=u(d*i),x=u(o.length),E=new Uint8Array(t.exports.memory.buffer);E.set(o,x);const S=e(y,n,i,x,o.length);if(S===0&&s&&s(y,d,i),r.set(E.subarray(y,y+n*i)),u(y-u(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const __="EXT_meshopt_compression",Tpe=__;async function Epe(t,e){const r=new so(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of t.json.bufferViews||[])n.push(Bpe(r,i));await Promise.all(n),r.removeExtension(__)}async function Bpe(t,e){const r=t.getObjectExtension(e,__);if(r){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:u,filter:d="NONE",buffer:y}=r,x=t.gltf.buffers[y],E=new Uint8Array(x.arrayBuffer,x.byteOffset+n,i),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await vpe(S,s,o,E,u,d),t.removeObjectExtension(e,__)}}const Spe=Object.freeze(Object.defineProperty({__proto__:null,decode:Epe,name:Tpe},Symbol.toStringTag,{value:"Module"})),Pd="EXT_texture_webp",Ipe=Pd;function Mpe(t,e){const r=new so(t);if(!V6("image/webp")){if(r.getRequiredExtensions().includes(Pd))throw new Error(`gltf: Required extension ${Pd} not supported by browser`);return}const{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,Pd);o&&(i.source=o.source),r.removeObjectExtension(i,Pd)}r.removeExtension(Pd)}const Ppe=Object.freeze(Object.defineProperty({__proto__:null,name:Ipe,preprocess:Mpe},Symbol.toStringTag,{value:"Module"})),Sm="KHR_texture_basisu",Rpe=Sm;function Fpe(t,e){const r=new so(t),{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,Sm);o&&(i.source=o.source,r.removeObjectExtension(i,Sm))}r.removeExtension(Sm)}const Dpe=Object.freeze(Object.defineProperty({__proto__:null,name:Rpe,preprocess:Fpe},Symbol.toStringTag,{value:"Module"})),Ope="4.2.4",Lpe={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Ope,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Npe(t,e,r){const n=BN(e.metadata),i=[],o=kpe(e.attributes);for(const s in t){const u=t[s],d=LP(s,u,o[s]);i.push(d)}if(r){const s=LP("indices",r);i.push(s)}return{fields:i,metadata:n}}function kpe(t){const e={};for(const r in t){const n=t[r];e[n.name||"undefined"]=n}return e}function LP(t,e,r){const n=r?BN(r.metadata):void 0;return bde(t,e,n)}function BN(t){Object.entries(t);const e={};for(const r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}const NP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Upe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},zpe=4;class Gpe{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);const i=this.decoder.GetEncodedGeometryType(n),o=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(i){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,o);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!o.ptr){const S=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(S)}const u=this._getDracoLoaderData(o,i,r),d=this._getMeshData(o,u,r),y=fN(d.attributes),x=Npe(d.attributes,u,d.indices);return{loader:"draco",loaderData:u,header:{vertexCount:o.num_points(),boundingBox:y},...d,schema:x}}finally{this.draco.destroy(n),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,r,n){const i=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,n);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:o}}_getDracoAttributes(e,r){const n={};for(let i=0;i<e.num_attributes();i++){const o=this.decoder.GetAttribute(e,i),s=this._getAttributeMetadata(e,i);n[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:i,metadata:s};const u=this._getQuantizationTransform(o,r);u&&(n[o.unique_id()].quantization_transform=u);const d=this._getOctahedronTransform(o,r);d&&(n[o.unique_id()].octahedron_transform=d)}return n}_getMeshData(e,r,n){const i=this._getMeshAttributes(r,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,r,n){const i={};for(const o of Object.values(e.attributes)){const s=this._deduceAttributeName(o,n);o.name=s;const u=this._getAttributeValues(r,o);if(u){const{value:d,size:y}=u;i[s]={value:d,size:y,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*zpe,o=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,o),new Uint32Array(this.draco.HEAPF32.buffer,o,n).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),jpe(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){const n=Upe[r.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;const i=r.num_components,s=e.num_points()*i,u=s*n.BYTES_PER_ELEMENT,d=Vpe(this.draco,n);let y;const x=this.draco._malloc(u);try{const E=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,E,d,u,x),y=new n(this.draco.HEAPF32.buffer,x,s).slice()}finally{this.draco._free(x)}return{value:y,size:i}}_deduceAttributeName(e,r){const n=e.unique_id;for(const[s,u]of Object.entries(r.extraAttributes||{}))if(u===n)return s;const i=e.attribute_type;for(const s in NP)if(this.draco[s]===i)return NP[s];const o=r.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){const n=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const r={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const o=this.metadataQuerier.GetEntryName(e,i);r[o]=this._getDracoMetadataField(e,o)}return r}_getDracoMetadataField(e,r){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,n);const i=Hpe(n);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:r=[],octahedronAttributes:n=[]}=e,i=[...r,...n];for(const o of i)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,r){const{quantizedAttributes:n=[]}=r,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(u=>s.min_value(u))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(e,r){const{octahedronAttributes:n=[]}=r,i=e.attribute_type();if(n.map(s=>this.decoder[s]).includes(i)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(e))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function Vpe(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function Hpe(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}function jpe(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}const $pe="1.5.6",Wpe="1.4.1",zb=`https://www.gstatic.com/draco/versioned/decoders/${$pe}`,Io={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Gb={[Io.DECODER]:`${zb}/${Io.DECODER}`,[Io.DECODER_WASM]:`${zb}/${Io.DECODER_WASM}`,[Io.FALLBACK_DECODER]:`${zb}/${Io.FALLBACK_DECODER}`,[Io.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Wpe}/javascript/${Io.ENCODER}`};let Vb;async function Jpe(t){const e=t.modules||{};return e.draco3d?Vb||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):Vb||=Xpe(t),await Vb}async function Xpe(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await Gf(Gb[Io.FALLBACK_DECODER],"draco",t,Io.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await Gf(Gb[Io.DECODER],"draco",t,Io.DECODER),await Gf(Gb[Io.DECODER_WASM],"draco",t,Io.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Kpe(e,r)}function Kpe(t,e){const r={};return e&&(r.wasmBinary=e),new Promise(n=>{t({...r,onModuleLoaded:i=>n({draco:i})})})}const aC={...Lpe,parse:qpe};async function qpe(t,e){const{draco:r}=await Jpe(e),n=new Gpe(r);try{return n.parseSync(t,e?.draco)}finally{n.destroy()}}function Ype(t){const e={};for(const r in t){const n=t[r];if(r!=="indices"){const i=SN(n);e[r]=i}}return e}function SN(t){const{buffer:e,size:r,count:n}=Zpe(t);return{value:e,size:r,byteOffset:0,count:n,type:pN(r),componentType:Qw(e)}}function Zpe(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=Qpe(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}function Qpe(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const Du="KHR_draco_mesh_compression",ege=Du;function tge(t,e,r){const n=new so(t);for(const i of IN(n))n.getObjectExtension(i,Du)}async function rge(t,e,r){if(!e?.gltf?.decompressMeshes)return;const n=new so(t),i=[];for(const o of IN(n))n.getObjectExtension(o,Du)&&i.push(ige(n,o,e,r));await Promise.all(i),n.removeExtension(Du)}function nge(t,e={}){const r=new so(t);for(const n of r.json.meshes||[])sge(n),r.addRequiredExtension(Du)}async function ige(t,e,r,n){const i=t.getObjectExtension(e,Du);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),s=Cg(o.buffer,o.byteOffset),u={...r};delete u["3d-tiles"];const d=await sh(s,aC,u,n),y=Ype(d.attributes);for(const[x,E]of Object.entries(y))if(x in e.attributes){const S=e.attributes[x],O=t.getAccessor(S);O?.min&&O?.max&&(E.min=O.min,E.max=O.max)}e.attributes=y,d.indices&&(e.indices=SN(d.indices)),t.removeObjectExtension(e,Du),oge(e)}function sge(t,e,r=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),s=i?.parseSync?.({attributes:t}),u=n._addFauxAttributes(s.attributes),d=n.addBufferView(o);return{primitives:[{attributes:u,mode:r,extensions:{[Du]:{bufferView:d,attributes:u}}}]}}function oge(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*IN(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const age=Object.freeze(Object.defineProperty({__proto__:null,decode:rge,encode:nge,name:ege,preprocess:tge},Symbol.toStringTag,{value:"Module"})),hy="KHR_texture_transform",cge=hy,X0=new ut,lge=new ci,uge=new ci;async function fge(t,e){if(!new so(t).hasExtension(hy)||!e.gltf?.loadBuffers)return;const i=t.json.materials||[];for(let o=0;o<i.length;o++)hge(o,t)}function hge(t,e){const r=e.json.materials?.[t],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const o of n)o&&o?.extensions?.[hy]&&dge(e,t,o,i)}function dge(t,e,r,n){const i=Age(r,n);if(!i)return;const o=t.json.meshes||[];for(const s of o)for(const u of s.primitives){const d=u.material;Number.isFinite(d)&&e===d&&pge(t,u,i)}}function Age(t,e){const r=t.extensions?.[hy],{texCoord:n=0}=t,{texCoord:i=n}=r;if(!(e.findIndex(([s,u])=>s===n&&u===i)!==-1)){const s=_ge(r);return n!==i&&(t.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:s}}return null}function pge(t,e,r){const{originalTexCoord:n,texCoord:i,matrix:o}=r,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const u=t.json.accessors?.[s];if(u&&u.bufferView){const d=t.json.bufferViews?.[u.bufferView];if(d){const{arrayBuffer:y,byteOffset:x}=t.buffers[d.buffer],E=(x||0)+(u.byteOffset||0)+(d.byteOffset||0),{ArrayType:S,length:O}=eC(u,d),k=AN[u.componentType],U=dN[u.type],J=d.byteStride||k*U,G=new Float32Array(O);for(let H=0;H<u.count;H++){const K=new S(y,E+H*J,2);X0.set(K[0],K[1],1),X0.transformByMatrix3(o),G.set([X0[0],X0[1]],H*U)}n===i?gge(u,d,t.buffers,G):mge(i,u,e,t,G)}}}}function gge(t,e,r,n){t.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function mge(t,e,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function _ge(t){const{offset:e=[0,0],rotation:r=0,scale:n=[1,1]}=t,i=new ci().set(1,0,0,0,1,0,e[0],e[1],1),o=lge.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=uge.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const yge=Object.freeze(Object.defineProperty({__proto__:null,decode:fge,name:cge},Symbol.toStringTag,{value:"Module"})),Ff="KHR_lights_punctual",vge=Ff;async function bge(t){const e=new so(t),{json:r}=e,n=e.getExtension(Ff);n&&(e.json.lights=n.lights,e.removeExtension(Ff));for(const i of r.nodes||[]){const o=e.getObjectExtension(i,Ff);o&&(i.light=o.light),e.removeObjectExtension(i,Ff)}}async function xge(t){const e=new so(t),{json:r}=e;if(r.lights){const n=e.addExtension(Ff);ea(!n.lights),n.lights=r.lights,delete r.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Ff,n)}delete e.json.lights}}const wge=Object.freeze(Object.defineProperty({__proto__:null,decode:bge,encode:xge,name:vge},Symbol.toStringTag,{value:"Module"})),ag="KHR_materials_unlit",Cge=ag;async function Tge(t){const e=new so(t),{json:r}=e;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,ag);e.removeExtension(ag)}function Ege(t){const e=new so(t),{json:r}=e;if(e.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,ag,{}),e.addExtension(ag))}const Bge=Object.freeze(Object.defineProperty({__proto__:null,decode:Tge,encode:Ege,name:Cge},Symbol.toStringTag,{value:"Module"})),Sp="KHR_techniques_webgl",Sge=Sp;async function Ige(t){const e=new so(t),{json:r}=e,n=e.getExtension(Sp);if(n){const i=Pge(n,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,Sp);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Rge(o.technique,e)),e.removeObjectExtension(o,Sp)}e.removeExtension(Sp)}}async function Mge(t,e){}function Pge(t,e){const{programs:r=[],shaders:n=[],techniques:i=[]}=t,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=r[s.program]}),i}function Rge(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in r)&&(r[n]=t.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=e.getTexture(r[n].index))}),r}const Fge=Object.freeze(Object.defineProperty({__proto__:null,decode:Ige,encode:Mge,name:Sge},Symbol.toStringTag,{value:"Module"})),MN=[CAe,oAe,Spe,Ppe,Dpe,age,wge,Bge,Fge,yge,GAe];function Dge(t,e={},r){const n=MN.filter(i=>PN(i.name,e));for(const i of n)i.preprocess?.(t,e,r)}async function Oge(t,e={},r){const n=MN.filter(i=>PN(i.name,e));for(const i of n)await i.decode?.(t,e,r)}function PN(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const Hb="KHR_binary_glTF";function Lge(t){const e=new so(t),{json:r}=e;for(const n of r.images||[]){const i=e.getObjectExtension(n,Hb);i&&Object.assign(n,i),e.removeObjectExtension(n,Hb)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(Hb)}const kP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Nge={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let kge=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Lge(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in kP)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const n=e[r];if(!(!n||Array.isArray(n))){e[r]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[r].length;e[r].push(o),this.idToIndexMap[r][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const r in kP)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:n,indices:i,material:o}=r;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(r.indices=this._convertIdToIndex(i,"accessor")),o&&(r.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const n of e[r])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,r){const n=Nge[r];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return i}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,i=e.textures.findIndex(o=>o.id===n);i!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:i})}}};function Uge(t,e={}){return new kge().normalize(t,e)}async function zge(t,e,r=0,n,i){return Gge(t,e,r,n),Uge(t,{normalize:n?.gltf?.normalize}),Dge(t,n,i),n?.gltf?.loadBuffers&&t.json.buffers&&await Vge(t,n,i),n?.gltf?.loadImages&&await Hge(t,n,i),await Oge(t,n,i),t}function Gge(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!lpe(e,r,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=D6(e);else if(e instanceof ArrayBuffer){const s={};r=upe(s,e,r,n.glb),ea(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else ea(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function Vge(t,e,r){const n=t.json.buffers||[];for(let i=0;i<n.length;++i){const o=n[i];if(o.uri){const{fetch:s}=r;ea(s);const u=EN(o.uri,e),y=await(await r?.fetch?.(u))?.arrayBuffer?.();t.buffers[i]={arrayBuffer:y,byteOffset:0,byteLength:y.byteLength},delete o.uri}else t.buffers[i]===null&&(t.buffers[i]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Hge(t,e,r){const n=jge(t),i=t.json.images||[],o=[];for(const s of n)o.push($ge(t,i[s],s,e,r));return await Promise.all(o)}function jge(t){const e=new Set,r=t.json.textures||[];for(const n of r)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function $ge(t,e,r,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const u=EN(e.uri,n),{fetch:d}=i;o=await(await d(u)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const u=qde(t.json,t.buffers,e.bufferView);o=Cg(u.buffer,u.byteOffset,u.byteLength)}ea(o,"glTF image has no data");let s=await sh(o,[og,TN],{...n,mimeType:e.mimeType,basis:n.basis||{format:sC()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const j2={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:VAe,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Wge,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Wge(t,e={},r){e={...j2.options,...e},e.gltf={...j2.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await zge({},t,n,e,r)}const Jge={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xge={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ya={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Kge={magFilter:ya.TEXTURE_MAG_FILTER,minFilter:ya.TEXTURE_MIN_FILTER,wrapS:ya.TEXTURE_WRAP_S,wrapT:ya.TEXTURE_WRAP_T},qge={[ya.TEXTURE_MAG_FILTER]:ya.LINEAR,[ya.TEXTURE_MIN_FILTER]:ya.NEAREST_MIPMAP_LINEAR,[ya.TEXTURE_WRAP_S]:ya.REPEAT,[ya.TEXTURE_WRAP_T]:ya.REPEAT};function Yge(){return{id:"default-sampler",parameters:qge}}function Zge(t){return Xge[t]}function Qge(t){return Jge[t]}let e0e=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return ea(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;const n=e&&e[r];return n||console.warn(`glTF file error: Could not find ${e}[${r}]`),n}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,r){const n={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:n}}_resolveMesh(e,r){const n={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const u in s)o.attributes[u]=this.getAccessor(s[u]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,r){const n={...e,id:e.id||`material-${r}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,r){const n=Zge(e.componentType),i=Qge(e.type),o=n*i,s={...e,id:e.id||`accessor-${r}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const u=s.bufferView.buffer,{ArrayType:d,byteLength:y}=eC(s,s.bufferView),x=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+u.byteOffset;let E=u.arrayBuffer.slice(x,x+y);s.bufferView.byteStride&&(E=this._getValueFromInterleavedBuffer(u,x,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new d(E)}return s}_getValueFromInterleavedBuffer(e,r,n,i,o){const s=new Uint8Array(o*i);for(let u=0;u<o;u++){const d=r+u*n;s.set(new Uint8Array(e.arrayBuffer.slice(d,d+i)),u*i)}return s.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Yge(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){const n={id:e.id||`sampler-${r}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return Kge[e]}_resolveImage(e,r){const n={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[r];return i&&(n.image=i),n}_resolveBufferView(e,r){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,r){const n={...e,id:e.id||`camera-${r}`};return n.perspective,n.orthographic,n}};function t0e(t,e){return new e0e().postProcess(t,e)}async function r0e(t){const e=[];return t.scenes.forEach(r=>{r.traverse(n=>{Object.values(n.model.uniforms).forEach(i=>{i.loaded===!1&&e.push(i)})})}),await n0e(()=>e.some(r=>!r.loaded))}async function n0e(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const UP=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,i0e={name:"scenegraph",vs:UP,fs:UP,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},s0e=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,o0e=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,RN=[255,255,255,255],a0e={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:RN},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[j2]};class Sg extends ps{getShaders(){const e={};let r;this.props._lighting==="pbr"?(r=zx,e.LIGHTING_PBR=1):r={name:"pbrMaterial"};const n=[Ts,na,i0e,r];return super.getShaders({defines:e,vs:s0e,fs:o0e,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:RN,transition:!0},instanceModelMatrix:lN})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;r.scenegraph!==n.scenegraph?this._updateScenegraph():r._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const e=this.props,{device:r}=this.context;let n=null;if(e.scenegraph instanceof Km)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const u=e.scenegraph,d=u.json?t0e(u):u,y=jde(r,d,this._getModelOptions());n={gltf:d,...y},r0e(y).then(()=>{this.setNeedsRedraw()}).catch(x=>{this.raiseError(x,"loading glTF")})}const i={layer:this,device:this.context.device},o=e.getScene(n,i),s=e.getAnimator(n,i);if(o instanceof Yd){this.state.scenegraph?.destroy(),this._applyAnimationsProp(s,e._animations);const u=[];o.traverse(d=>{d instanceof Z1&&u.push(d.model)}),this.setState({scenegraph:o,animator:s,models:u}),this.getAttributeManager().invalidateAll()}else o!==null&&Wr.warn("invalid scenegraph:",o)()}_applyAnimationsProp(e,r){if(!e||!r)return;const n=e.getAnimations();Object.keys(r).sort().forEach(i=>{const o=r[i];if(i==="*")n.forEach(s=>{Object.assign(s,o)});else if(Number.isFinite(Number(i))){const s=Number(i);s>=0&&s<n.length?Object.assign(n[s],o):Wr.warn(`animation ${i} not found`)()}else{const s=n.find(({name:u})=>u===i);s?Object.assign(s,o):Wr.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:r,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,coordinateSystem:u}=this.props,d=this.getNumInstances();this.state.scenegraph.traverse((y,{worldMatrix:x})=>{if(y instanceof Z1){const{model:E}=y;E.setInstanceCount(d);const S={camera:E.uniforms.cameraPosition},O={sizeScale:i,sizeMinPixels:o,sizeMaxPixels:s,composeModelMatrix:uN(r,u),sceneModelMatrix:x};E.shaderInputs.setProps({pbrProjection:S,scenegraph:O}),E.draw(n)}})}}Sg.defaultProps=a0e;Sg.layerName="ScenegraphLayer";const c0e=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:Sg,SimpleMeshLayer:Wf},Symbol.toStringTag,{value:"Module"})),zP=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,l0e={name:"mesh",vs:zP,fs:zP,uniformTypes:{pickFeatureIds:"f32"}},u0e=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,f0e=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function h0e(t){const e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}const d0e={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class cC extends Wf{getShaders(){const e=super.getShaders();return e.modules.push(zx,l0e),{...e,vs:u0e,fs:f0e}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e;r.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){const{featureIds:r}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!r},o={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:o,mesh:i}),super.draw(e)}getModel(e){const{id:r}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return h0e(e.attributes),new Ei(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:r}=this.state;if(r){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:o}=i.bindings,{emptyTexture:s}=this.state,u={sampler:o||s,hasTexture:!!o},{camera:d,...y}={...i.bindings,...i.uniforms};r.shaderInputs.setProps({simpleMesh:u,pbrMaterial:y})}}parseMaterial(e,r){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return hN(this.context.device,{unlit:n,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const r=this.props.featureIds,n=new Uint8ClampedArray(r.length*e.size),i=[];for(let o=0;o<r.length;o++)this.encodePickingColor(r[o],i),n[o*3]=i[0],n[o*3+1]=i[1],n[o*3+2]=i[2];e.value=n}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}}cC.layerName="MeshLayer";cC.defaultProps=d0e;const A0e=6378137,p0e=6378137,g0e=6356752314245179e-9;function dy(t){return t}new ut;function m0e(t,e=[],r=dy){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function _0e(t,e=[]){return m0e(t,e,As._cartographicRadians?dy:TV)}function y0e(t,e,r=dy){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function v0e(t,e){return y0e(t,e,As._cartographicRadians?dy:EV)}const GP=1e-14,b0e=new ut,VP={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},jb={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},gp={east:new ut,north:new ut,up:new ut,west:new ut,south:new ut,down:new ut},x0e=new ut,w0e=new ut,C0e=new ut;function HP(t,e,r,n,i,o){const s=VP[e]&&VP[e][r];Za(s&&(!n||n===s));let u,d,y;const x=b0e.copy(i);if(ra(x.x,0,GP)&&ra(x.y,0,GP)){const S=Math.sign(x.z);u=x0e.fromArray(jb[e]),e!=="east"&&e!=="west"&&u.scale(S),d=w0e.fromArray(jb[r]),r!=="east"&&r!=="west"&&d.scale(S),y=C0e.fromArray(jb[n]),n!=="east"&&n!=="west"&&y.scale(S)}else{const{up:S,east:O,north:k}=gp;O.set(-x.y,x.x,0).normalize(),t.geodeticSurfaceNormal(x,S),k.copy(S).cross(O);const{down:U,west:J,south:G}=gp;U.copy(S).scale(-1),J.copy(O).scale(-1),G.copy(k).scale(-1),u=gp[e],d=gp[r],y=gp[n]}return o[0]=u.x,o[1]=u.y,o[2]=u.z,o[3]=0,o[4]=d.x,o[5]=d.y,o[6]=d.z,o[7]=0,o[8]=y.x,o[9]=y.y,o[10]=y.z,o[11]=0,o[12]=x.x,o[13]=x.y,o[14]=x.z,o[15]=1,o}const dd=new ut,T0e=new ut,E0e=new ut;function B0e(t,e,r=[]){const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:o}=e;dd.from(t);const s=dd.x,u=dd.y,d=dd.z,y=n.x,x=n.y,E=n.z,S=s*s*y*y,O=u*u*x*x,k=d*d*E*E,U=S+O+k,J=Math.sqrt(1/U);if(!Number.isFinite(J))return;const G=T0e;if(G.copy(t).scale(J),U<o)return G.to(r);const H=i.x,K=i.y,he=i.z,Y=E0e;Y.set(G.x*H*2,G.y*K*2,G.z*he*2);let oe=(1-J)*dd.len()/(.5*Y.len()),Ee=0,ze,de,ve,Ae;do{oe-=Ee,ze=1/(1+oe*H),de=1/(1+oe*K),ve=1/(1+oe*he);const $=ze*ze,re=de*de,Te=ve*ve,Qe=$*ze,me=re*de,Le=Te*ve;Ae=S*$+O*re+k*Te-1;const Ye=-2*(S*Qe*H+O*me*K+k*Le*he);Ee=Ae/Ye}while(Math.abs(Ae)>$H);return dd.scale([ze,de,ve]).to(r)}const K0=new ut,jP=new ut,S0e=new ut,Wa=new ut,I0e=new ut,q0=new ut;class pi{constructor(e=0,r=0,n=0){this.centerToleranceSquared=jH,Za(e>=0),Za(r>=0),Za(n>=0),this.radii=new ut(e,r,n),this.radiiSquared=new ut(e*e,r*r,n*n),this.radiiToTheFourth=new ut(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new ut(e===0?0:1/e,r===0?0:1/r,n===0?0:1/n),this.oneOverRadiiSquared=new ut(e===0?0:1/(e*e),r===0?0:1/(r*r),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){const n=jP,i=S0e,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const s=Math.sqrt(n.dot(i));return i.scale(1/s),n.scale(o),i.add(n),i.to(r)}cartesianToCartographic(e,r=[0,0,0]){q0.from(e);const n=this.scaleToGeodeticSurface(q0,Wa);if(!n)return;const i=this.geodeticSurfaceNormal(n,jP),o=I0e;o.copy(q0).subtract(n);const s=Math.atan2(i.y,i.x),u=Math.asin(i.z),d=Math.sign(Dx(o,q0))*bO(o);return v0e([s,u,d],r)}eastNorthUpToFixedFrame(e,r=new An){return HP(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,n,i,o=new An){return HP(this,e,r,n,i,o)}geocentricSurfaceNormal(e,r=[0,0,0]){return K0.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){const n=_0e(e),i=n[0],o=n[1],s=Math.cos(o);return K0.set(s*Math.cos(i),s*Math.sin(i),Math.sin(o)).normalize(),K0.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return K0.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return B0e(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){Wa.from(e);const n=Wa.x,i=Wa.y,o=Wa.z,s=this.oneOverRadiiSquared,u=1/Math.sqrt(n*n*s.x+i*i*s.y+o*o*s.z);return Wa.multiplyScalar(u).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return Wa.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return Wa.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,n=[0,0,0]){Za(ra(this.radii.x,this.radii.y,RO)),Za(this.radii.z>0),Wa.from(e);const i=Wa.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-r))return Wa.set(0,0,i).to(n)}}pi.WGS84=new pi(A0e,p0e,g0e);class M0e{item;previous;next;constructor(e,r,n){this.item=e,this.previous=r,this.next=n}}class P0e{head=null;tail=null;_length=0;get length(){return this._length}add(e){const r=new M0e(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){const n=e.next;e.next=r,this.tail===e?this.tail=r:n.previous=r,r.next=n,r.previous=e,++this._length}}class R0e{_list;_sentinel;_trimTiles;constructor(){this._list=new P0e,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,n){r._cacheNode||(r._cacheNode=this._list.add(r),n&&n(e,r))}unloadTile(e,r,n){const i=r._cacheNode;i&&(this._list.remove(i),r._cacheNode=null,n&&n(e,r))}unloadTiles(e,r){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,o=e.maximumMemoryUsage*1024*1024,s=this._sentinel;let u=i.head;for(;u!==s&&(e.gpuMemoryUsageInBytes>o||n);){const d=u.item;u=u.next,this.unloadTile(e,d,r)}}trim(){this._trimTiles=!0}}function F0e(t,e){ai(t),ai(e);const{rtcCenter:r,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:o}}=t;let s=new An(i);switch(r&&s.translate(r),n){case"Z":break;case"Y":const E=new An().rotateX(Math.PI/2);s=s.multiplyRight(E);break;case"X":const S=new An().rotateY(-Math.PI/2);s=s.multiplyRight(S);break}e.isQuantized&&s.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const u=new ut(o);e.cartesianModelMatrix=s,e.cartesianOrigin=u;const d=pi.WGS84.cartesianToCartographic(u,new ut),x=pi.WGS84.eastNorthUpToFixedFrame(u).invert();e.cartographicModelMatrix=x.multiplyRight(s),e.cartographicOrigin=d,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const $P=new ut,$b=new ut,$2=new Qo([new Ya,new Ya,new Ya,new Ya,new Ya,new Ya]);function D0e(t,e){const{cameraDirection:r,cameraUp:n,height:i}=t,{metersPerUnit:o}=t.distanceScales,s=Im(t,t.center),u=pi.WGS84.eastNorthUpToFixedFrame(s),d=t.unprojectPosition(t.cameraPosition),y=pi.WGS84.cartographicToCartesian(d,new ut),x=new ut(u.transformAsVector(new ut(r).scale(o))).normalize(),E=new ut(u.transformAsVector(new ut(n).scale(o))).normalize();L0e(t);const S=t.constructor,{longitude:O,latitude:k,width:U,bearing:J,zoom:G}=t,H=new S({longitude:O,latitude:k,height:i,width:U,bearing:J,zoom:G,pitch:0});return{camera:{position:y,direction:x,up:E},viewport:t,topDownViewport:H,height:i,cullingVolume:$2,frameNumber:e,sseDenominator:1.15}}function O0e(t,e,r){if(r===0||t.length<=r)return[t,[]];const n=[],{longitude:i,latitude:o}=e.viewport;for(const[y,x]of t.entries()){const[E,S]=x.header.mbs,O=Math.abs(i-E),k=Math.abs(o-S),U=Math.sqrt(k*k+O*O);n.push([y,U])}const s=n.sort((y,x)=>y[1]-x[1]),u=[];for(let y=0;y<r;y++)u.push(t[s[y][0]]);const d=[];for(let y=r;y<s.length;y++)d.push(t[s[y][0]]);return[u,d]}function L0e(t){const e=t.getFrustumPlanes(),r=WP(e.near,t.cameraPosition),n=Im(t,r),i=Im(t,t.cameraPosition,$b);let o=0;$2.planes[o++].fromPointNormal(n,$P.copy(n).subtract(i));for(const s in e){if(s==="near")continue;const u=e[s],d=WP(u,r,$b),y=Im(t,d,$b);$2.planes[o++].fromPointNormal(y,$P.copy(n).subtract(y))}}function WP(t,e,r=new ut){const n=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-n).add(e),r}function Im(t,e,r=new ut){const n=t.unprojectPosition(e);return pi.WGS84.cartographicToCartesian(n,r)}const N0e=6378137,k0e=6378137,W2=6356752314245179e-9,Wd=new ut;function U0e(t,e){if(t instanceof Bg){const{halfAxes:r}=t,n=G0e(r);return Math.log2(W2/(n+e[2]))}else if(t instanceof Eg){const{radius:r}=t;return Math.log2(W2/(r+e[2]))}else if(t.width&&t.height){const{width:r,height:n}=t,i=Math.log2(N0e/r),o=Math.log2(k0e/n);return(i+o)/2}return 1}function FN(t,e,r){pi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],Wd);const n=Math.sqrt(Math.pow(Wd[0]-r[0],2)+Math.pow(Wd[1]-r[1],2)+Math.pow(Wd[2]-r[2],2));return Math.log2(W2/(n+e[2]))}function z0e(t,e,r){const[n,i,o,s]=t;return FN({xmax:o,ymax:s,zmax:0},e,r)}function G0e(t){t.getColumn(0,Wd);const e=t.getColumn(1),r=t.getColumn(2);return Wd.add(e).add(r).len()}const Yo={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var oc;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(oc||(oc={}));var Il;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Il||(Il={}));var Bo;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(Bo||(Bo={}));var yA;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(yA||(yA={}));const V0e={USE_OPTIMIZATION:1};function DN(t){return t!=null}const no=new ut,Mm=new ut,H0e=new ut,j0e=new ut,vf=new ut,JP=new ut,XP=new ut,KP=new ut;function Wb(t,e,r){if(ai(t,"3D Tile: boundingVolume must be defined"),t.box)return ON(t.box,e,r);if(t.region)return J0e(t.region);if(t.sphere)return W0e(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function $0e(t,e){if(t.box)return X0e(e);if(t.region){const[r,n,i,o,s,u]=t.region;return[[qa(r),qa(n),s],[qa(i),qa(o),u]]}if(t.sphere)return K0e(e);throw new Error("Unkown boundingVolume type")}function ON(t,e,r){const n=new ut(t[0],t[1],t[2]);e.transform(n,n);let i=[];if(t.length===10){const y=t.slice(3,6),x=new Kp;x.fromArray(t,6);const E=new ut([1,0,0]),S=new ut([0,1,0]),O=new ut([0,0,1]);E.transformByQuaternion(x),E.scale(y[0]),S.transformByQuaternion(x),S.scale(y[1]),O.transformByQuaternion(x),O.scale(y[2]),i=[...E.toArray(),...S.toArray(),...O.toArray()]}else i=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const o=e.transformAsVector(i.slice(0,3)),s=e.transformAsVector(i.slice(3,6)),u=e.transformAsVector(i.slice(6,9)),d=new ci([o[0],o[1],o[2],s[0],s[1],s[2],u[0],u[1],u[2]]);return DN(r)?(r.center=n,r.halfAxes=d,r):new Bg(n,d)}function W0e(t,e,r){const n=new ut(t[0],t[1],t[2]);e.transform(n,n);const i=e.getScale(Mm),o=Math.max(Math.max(i[0],i[1]),i[2]),s=t[3]*o;return DN(r)?(r.center=n,r.radius=s,r):new Eg(n,s)}function J0e(t){const[e,r,n,i,o,s]=t,u=pi.WGS84.cartographicToCartesian([qa(e),qa(i),o],H0e),d=pi.WGS84.cartographicToCartesian([qa(n),qa(r),s],j0e),y=new ut().addVectors(u,d).multiplyByScalar(.5);return pi.WGS84.cartesianToCartographic(y,vf),pi.WGS84.cartographicToCartesian([qa(n),vf[1],vf[2]],JP),pi.WGS84.cartographicToCartesian([vf[0],qa(i),vf[2]],XP),pi.WGS84.cartographicToCartesian([vf[0],vf[1],s],KP),ON([...y,...JP.subtract(y),...XP.subtract(y),...KP.subtract(y)],new An)}function X0e(t){const e=LN(),{halfAxes:r}=t,n=new ut(r.getColumn(0)),i=new ut(r.getColumn(1)),o=new ut(r.getColumn(2));for(let s=0;s<2;s++){for(let u=0;u<2;u++){for(let d=0;d<2;d++)no.copy(t.center),no.add(n),no.add(i),no.add(o),NN(e,no),o.negate();i.negate()}n.negate()}return e}function K0e(t){const e=LN(),{center:r,radius:n}=t,i=pi.WGS84.scaleToGeodeticSurface(r,no);let o;i?o=pi.WGS84.geodeticSurfaceNormal(i):o=new ut(0,0,1);let s=new ut(o[2],-o[1],0);s.len()>0?s.normalize():s=new ut(0,1,0);const u=s.clone().cross(o);for(const d of[s,u,o]){Mm.copy(d).scale(n);for(let y=0;y<2;y++)no.copy(r),no.add(Mm),NN(e,no),Mm.negate()}return e}function LN(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function NN(t,e){pi.WGS84.cartesianToCartographic(e,no),t[0][0]=Math.min(t[0][0],no[0]),t[0][1]=Math.min(t[0][1],no[1]),t[0][2]=Math.min(t[0][2],no[2]),t[1][0]=Math.max(t[1][0],no[0]),t[1][1]=Math.max(t[1][1],no[1]),t[1][2]=Math.max(t[1][2],no[2])}new ut;new ut;new An;new ut;new ut;new ut;function q0e(t,e){const r=t*e;return 1-Math.exp(-(r*r))}function Y0e(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor;return q0e(e,r)*n}return 0}function Z0e(t,e,r){const n=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=r?i:t.lodMetricValue;if(o===0)return 0;const s=Math.max(t._distanceToCamera,1e-7),{height:u,sseDenominator:d}=e,{viewDistanceScale:y}=n.options;let x=o*u*(y||1)/(s*d);return x-=Y0e(n,s),x}const Jb=new ut,qP=new ut,_u=new ut,YP=new ut,Q0e=new ut,Xb=new An,ZP=new An;function eme(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const r=2*kN(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function kN(t,e){const{topDownViewport:r}=e,n=t.header.mbs[1],i=t.header.mbs[0],o=t.header.mbs[2],s=t.header.mbs[3],u=[...t.boundingVolume.center],d=r.unprojectPosition(r.cameraPosition);pi.WGS84.cartographicToCartesian(d,Jb),qP.copy(Jb).subtract(u).normalize(),pi.WGS84.eastNorthUpToFixedFrame(u,Xb),ZP.copy(Xb).invert(),_u.copy(Jb).transform(ZP);const y=Math.sqrt(_u[0]*_u[0]+_u[1]*_u[1]),x=y*y/_u[2];YP.copy([_u[0],_u[1],x]);const S=YP.transform(Xb).subtract(u).normalize(),k=qP.cross(S).normalize().scale(s).add(u),U=pi.WGS84.cartesianToCartographic(k),J=r.project([i,n,o]),G=r.project(U);return Q0e.copy(J).subtract(G).magnitude()}function tme(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class QP{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return ai(e<this._array.length),this._array[e]}set(e,r){ai(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){const r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){ai(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){ai(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const rme={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Ay{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new QP;_emptyTraversalStack=new QP;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...rme,...e}}traverse(e,r,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const o=n.pop();let s=!1;this.canTraverse(o,r)&&(this.updateChildTiles(o,r),s=this.updateAndPushChildren(o,r,n,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const u=o.parent,d=!!(!u||u._shouldRefine),y=!s;o.hasRenderContent?o.refine===oc.ADD?(this.loadTile(o,r),this.selectTile(o,r)):o.refine===oc.REPLACE&&(this.loadTile(o,r),y&&this.selectTile(o,r)):(this.emptyTiles[o.id]=o,this.loadTile(o,r),y&&this.selectTile(o,r)),this.touchTile(o,r),o._shouldRefine=s&&d}const i=new Date().getTime();(this.traversalFinished(r)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(r))}updateChildTiles(e,r){const n=e.children;for(const i of n)this.updateTile(i,r)}updateAndPushChildren(e,r,n,i){const{loadSiblings:o,skipLevelOfDetail:s}=this.options,u=e.children;u.sort(this.compareDistanceToCamera.bind(this));const d=e.refine===oc.REPLACE&&e.hasRenderContent&&!s;let y=!1,x=!0;for(const E of u)if(E._selectionDepth=i,E.isVisibleAndInRequestVolume?(n.find(E)&&n.delete(E),n.push(E),y=!0):(d||o)&&(this.loadTile(E,r),this.touchTile(E,r)),d){let S;if(E._inRequestVolume?E.hasRenderContent?S=E.contentAvailable:S=this.executeEmptyTraversal(E,r):S=!1,x=x&&S,!x)return!1}return y||(x=!1),x}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r,n=!1,i=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!i&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,r,n):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(r,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===r.viewport.id&&n.push(i);else n.push(r.viewport.id);e.updateVisibility(r,n)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let n=!1;for(const i of e.children)i.updateVisibility(r),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,r){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const o=i.pop(),s=!o.hasRenderContent&&this.canTraverse(o,r,!1,!1),u=!o.hasRenderContent&&o.children.length===0;if(!s&&!o.contentAvailable&&!u&&(n=!1),this.updateTile(o,r),o.isVisibleAndInRequestVolume||(this.loadTile(o,r),this.touchTile(o,r)),s){const d=o.children;for(const y of d)i.push(y)}}return n}}const eR=new ut;function nme(t){return t!=null}class J2{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Yo.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new An;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new Ay({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new An;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,n,i=""){this.header=r,this.tileset=e,this.id=i||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Yo.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Yo.UNLOADED}get contentExpired(){return this.contentState===Yo.EXPIRED}get contentFailed(){return this.contentState===Yo.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=$0e(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case Bo.I3S:return kN(this,e);case Bo.TILES3D:return Z0e(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,n=this.refine===oc.ADD||r;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Yo.UNLOADED)return-1;const i=this.parent,s=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,u=e.root?e.root._screenSpaceError:0;return Math.max(u-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Yo.LOADING;const r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=Yo.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,o={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await CA(n,i,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Yo.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Yo.FAILED,n}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Yo.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:Qo.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Qo.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,r)}contentVisibility(){return!0}distanceToTile(e){const r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const r=this.boundingVolume;return eR.subVectors(r.center,e.position),e.direction.dot(eR)}insideViewerRequestVolume(e){const r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(nme(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Yo.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new An(e.transform):new An;const r=this.parent,n=this.tileset,i=r&&r.computedTransform?r.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new An(i).multiplyRight(this.transform);const o=r&&r._initialTransform?r._initialTransform.clone():new An;this._initialTransform=new An(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Yo.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Qo.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||oc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=Wb(e.boundingVolume,this.computedTransform,this.boundingVolume);const r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=Wb(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Wb(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new An){const r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return tme(this.tileset.tileset)}}}class ime extends Ay{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const s=e.children[0];this.updateTileVisibility(s,r),e._visible=s._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}const i=e.refine===oc.REPLACE,o=e._optimChildrenWithinParent===V0e.USE_OPTIMIZATION;if(i&&o&&n&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==oc.ADD?!1:!this.shouldRefine(e,r,!0)}}class sme{frameNumberMap=new Map;register(e,r){const n=this.frameNumberMap.get(e)||new Map,i=n.get(r)||0;n.set(r,i+1),this.frameNumberMap.set(e,n)}deregister(e,r){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(r)||1;n.set(r,i-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}}const Kb={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class ome{_statusMap;pendingTilesRegister=new sme;constructor(){this._statusMap={}}add(e,r,n,i){if(!this._statusMap[r]){const{frameNumber:o,viewport:{id:s}}=i;this._statusMap[r]={request:e,callback:n,key:r,frameState:i,status:Kb.REQUESTED},this.pendingTilesRegister.register(s,o),e().then(u=>{this._statusMap[r].status=Kb.COMPLETED;const{frameNumber:d,viewport:{id:y}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(y,d),this._statusMap[r].callback(u,i)}).catch(u=>{this._statusMap[r].status=Kb.ERROR;const{frameNumber:d,viewport:{id:y}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(y,d),n(u)})}}update(e,r){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:o,viewport:{id:s}}=r;this.pendingTilesRegister.register(s,o),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}}class ame extends Ay{_tileManager;constructor(e){super(e),this._tileManager=new ome}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=eme(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){const n=e.header.children||[],i=e.children,o=e.tileset;for(const s of n){const u=`${s.id}-${r.viewport.id}`,d=i&&i.find(y=>y.id===u);if(d)d&&this.updateTile(d,r);else{let y=()=>this._loadTile(s.id,o);this._tileManager.find(u)?this._tileManager.update(u,r):(o.tileset.nodePages&&(y=()=>o.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(y,u,E=>this._onTileLoad(E,e,u),r))}}return!1}async _loadTile(e,r){const{loader:n}=r,i=r.getTileUrl(`${r.url}/nodes/${e}`),o={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await CA(i,n,o)}_onTileLoad(e,r,n){const i=new J2(r.tileset,e,r,n);r.children.push(i);const o=this._tileManager.find(i.id).frameState;this.updateTile(i,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,o)}}const cme={description:"",ellipsoid:pi.WGS84,modelMatrix:new An,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Y0="Tiles In Tileset(s)",qb="Tiles In Memory",tR="Tiles In View",rR="Tiles To Render",nR="Tiles Loaded",Yb="Tiles Loading",iR="Tiles Unloaded",sR="Failed Tile Loads",oR="Points/Vertices",Zb="Tile Memory Use",aR="Maximum Screen Space Error";class lme{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new R0e;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...cme,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||N6(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new L6({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new ZL({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;const n=[];for(const i of r){const o=i.id;this._needTraverse(o)?n.push(o):this.traverseCounter--}for(const i of r){const o=i.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!n.includes(o))continue;const s=D0e(i,this._frameNumber);this._traverser.traverse(this.roots[o],s,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){const r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[r],i=Object.values(this._traverser.selectedTiles),[o,s]=O0e(i,e,this.options.maximumTilesSelected);n.selectedTiles=o;for(const u of s)u.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;const n=new Set(e.map(s=>s.id)),i=new Set(r.map(s=>s.id));let o=e.filter(s=>!i.has(s.id)).length>0;return o=o||r.filter(s=>!n.has(s.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?r+=n.content.pointCount:r+=n.content.vertexCount);this.stats.get(tR).count=this.selectedTiles.length,this.stats.get(rR).count=e,this.stats.get(oR).count=r,this.stats.get(aR).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Bo.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Bo.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Bo.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:n,xmax:i,ymin:o,ymax:s,zmin:u,zmax:d}=e;this.cartographicCenter=new ut(n+(i-n)/2,o+(s-o)/2,u+(d-u)/2),this.cartesianCenter=new ut,pi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=FN(e,this.cartographicCenter,this.cartesianCenter);return}const r=this.tileset.store?.extent;if(r){const[n,i,o,s]=r;this.cartographicCenter=new ut(n+(o-n)/2,i+(s-i)/2,0),this.cartesianCenter=new ut,pi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=z0e(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ut,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ut,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new ut,pi.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new ut(0,0,-pi.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=U0e(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Y0),this.stats.get(Yb),this.stats.get(qb),this.stats.get(tR),this.stats.get(rR),this.stats.get(nR),this.stats.get(iR),this.stats.get(sR),this.stats.get(oR),this.stats.get(Zb,"memory"),this.stats.get(aR)}_initializeTileHeaders(e,r){const n=new J2(this,e.root,r);if(r&&(r.children.push(n),n.depth=r.depth+1),this.type===Bo.TILES3D){const i=[];for(i.push(n);i.length>0;){const o=i.pop();this.stats.get(Y0).incrementCount();const s=o.header.children||[];for(const u of s){const d=new J2(this,u,o);if(d.contentUrl?.includes("?session=")){const x=new URL(d.contentUrl).searchParams.get("session");x&&(this._queryParams.session=x)}o.children.push(d),d.depth=o.depth+1,i.push(d)}}}return n}_initializeTraverser(){let e;switch(this.type){case Bo.TILES3D:e=ime;break;case Bo.I3S:e=ame;break;default:e=Ay}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(sR).incrementCount();const n=r.message||r.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,r){if(r){if(this.type===Bo.I3S){const n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(Y0).reset(),this.stats.get(Y0).addCount(n)}e&&e.content&&F0e(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Bo.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Bo.TILES3D){const{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Yb).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Yb).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(nR).incrementCount(),this.stats.get(qb).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(Zb).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(qb).decrementCount(),this.stats.get(iR).incrementCount(),this.stats.get(Zb).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const r=e.pop();for(const n of r.children)e.push(n);this._destroyTile(r)}this.root=null}_destroySubtree(e){const r=e,n=[];for(n.push(r);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const r=new URLSearchParams(e.queryString),n=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const UN="4.2.4",mp={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function zN(t,e,r){ai(t instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return n.decode(i)}function ume(t,e=0){const r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}const fme={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},is={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Fn={...fme,...is},Qb={[is.DOUBLE]:Float64Array,[is.FLOAT]:Float32Array,[is.UNSIGNED_SHORT]:Uint16Array,[is.UNSIGNED_INT]:Uint32Array,[is.UNSIGNED_BYTE]:Uint8Array,[is.BYTE]:Int8Array,[is.SHORT]:Int16Array,[is.INT]:Int32Array},hme={DOUBLE:is.DOUBLE,FLOAT:is.FLOAT,UNSIGNED_SHORT:is.UNSIGNED_SHORT,UNSIGNED_INT:is.UNSIGNED_INT,UNSIGNED_BYTE:is.UNSIGNED_BYTE,BYTE:is.BYTE,SHORT:is.SHORT,INT:is.INT},e1="Failed to convert GL type";class Hc{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const r in Qb)if(Qb[r]===e)return r;throw new Error(e1)}static fromName(e){const r=hme[e];if(!r)throw new Error(e1);return r}static getArrayType(e){switch(e){case is.UNSIGNED_SHORT_5_6_5:case is.UNSIGNED_SHORT_4_4_4_4:case is.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const r=Qb[e];if(!r)throw new Error(e1);return r}}static getByteSize(e){return Hc.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Hc.getArrayType(e)}static createTypedArray(e,r,n=0,i){i===void 0&&(i=(r.byteLength-n)/Hc.getByteSize(e));const o=Hc.getArrayType(e);return new o(r,n,i)}}function dme(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Ame(t,e=[0,0,0]){const r=t>>11&31,n=t>>5&63,i=t&31;return e[0]=r<<3,e[1]=n<<2,e[2]=i<<3,e}new Fx;new ut;new Fx;new Fx;function cR(t,e=255){return Bl(t,0,e)/e*2-1}function lR(t){return t<0?-1:1}function pme(t,e,r,n){if(dme(n),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(n.x=cR(t,r),n.y=cR(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*lR(i),n.y=(1-Math.abs(i))*lR(n.y)}return n.normalize()}function gme(t,e,r){return pme(t,e,255,r)}class lC{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=Fn.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,r,n,1,i.byteOffset):i}getPropertyArray(e,r,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(r=Hc.fromName(i.componentType)),this._getTypedArrayFromBinary(e,r,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,r,i)}getProperty(e,r,n,i,o){const s=this.json[e];if(!s)return s;const u=this.getPropertyArray(e,r,n);if(n===1)return u[i];for(let d=0;d<n;++d)o[d]=u[n*i+d];return o}_getTypedArrayFromBinary(e,r,n,i,o){const s=this._cachedTypedArrays;let u=s[e];return u||(u=Hc.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+o,i*n),s[e]=u),u}_getTypedArrayFromArray(e,r,n){const i=this._cachedTypedArrays;let o=i[e];return o||(o=Hc.createTypedArray(r,n),i[e]=o),o}}const mme={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_me={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},yme={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function vme(t,e,r,n){const{componentType:i}=t;ai(t.componentType);const o=typeof i=="string"?Hc.fromName(i):i,s=mme[t.type],u=_me[t.type],d=yme[t.type];return r+=t.byteOffset,{values:Hc.createTypedArray(o,e,r,s*n),type:o,size:s,unpacker:u,packer:d}}const Vc=t=>t!==void 0;function bme(t,e,r){if(!e)return null;let n=t.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?xme(n,r):null}function xme(t,e){let r,n,i;const o=t.instancesLength,s=t.classes;let u=t.classIds,d=t.parentCounts,y=t.parentIds,x=o;Vc(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,o));let E;if(Vc(d))for(Vc(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,i=getBinaryAccessor(d),d=i.createArrayBufferView(e.buffer,e.byteOffset+d.byteOffset,o)),E=new Uint16Array(o),x=0,r=0;r<o;++r)E[r]=x,x+=d[r];Vc(y)&&Vc(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,i=getBinaryAccessor(y),y=i.createArrayBufferView(e.buffer,e.byteOffset+y.byteOffset,x));const S=s.length;for(r=0;r<S;++r){const J=s[r].length,G=s[r].instances,H=getBinaryProperties(J,G,e);s[r].instances=combine(H,G)}const O=new Array(S).fill(0),k=new Uint16Array(o);for(r=0;r<o;++r)n=u[r],k[r]=O[n],++O[n];const U={classes:s,classIds:u,classIndexes:k,parentCounts:d,parentIndexes:E,parentIds:y};return Tme(U),U}function _p(t,e,r){if(!t)return;const n=t.parentCounts;return t.parentIds?r(t,e):n>0?wme(t,e,r):Cme(t,e,r)}function wme(t,e,r){const n=t.classIds,i=t.parentCounts,o=t.parentIds,s=t.parentIndexes,u=n.length,d=scratchVisited;d.length=Math.max(d.length,u);const y=++marker,x=scratchStack;for(x.length=0,x.push(e);x.length>0;){if(e=x.pop(),d[e]===y)continue;d[e]=y;const E=r(t,e);if(Vc(E))return E;const S=i[e],O=s[e];for(let k=0;k<S;++k){const U=o[O+k];U!==e&&x.push(U)}}return null}function Cme(t,e,r){let n=!0;for(;n;){const i=r(t,e);if(Vc(i))return i;const o=t.parentIds[e];n=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function Tme(t){const r=t.classIds.length;for(let n=0;n<r;++n)GN(t,n,stack)}function GN(t,e,r){const n=t.parentCounts,i=t.parentIds,o=t.parentIndexes,u=t.classIds.length;if(!Vc(i))return;assert(e<u,`Parent index ${e} exceeds the total number of instances: ${u}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);const d=Vc(n)?n[e]:1,y=Vc(n)?o[e]:e;for(let x=0;x<d;++x){const E=i[y+x];E!==e&&GN(t,E,r)}r.pop(e)}function Eo(t){return t!=null}const Z0=(t,e)=>t,Eme={HIERARCHY:!0,extensions:!0,extras:!0};class VN{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,n,i={}){ai(n>=0),this.json=e||{},this.binary=r,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(const o in this.json)Eme[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=bme(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),ai(typeof r=="string",r),this._hierarchy){const n=_p(this._hierarchy,e,(i,o)=>{const s=i.classIds[o];return i.classes[s].name===r});return Eo(n)}return!1}isExactClass(e,r){return ai(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),ai(typeof r=="string",r),Eo(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=Eo(r)?r:[],r.length=0;const n=Object.keys(this._properties);return r.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),ai(typeof r=="string",r),this._binaryProperties){const i=this._binaryProperties[r];if(Eo(i))return this._getBinaryProperty(i,e)}const n=this._properties[r];if(Eo(n))return Z0(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,r);if(Eo(i))return i}}setProperty(e,r,n){const i=this.featureCount;if(this._checkBatchId(e),ai(typeof r=="string",r),this._binaryProperties){const s=this._binaryProperties[r];if(s){this._setBinaryProperty(s,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,n))return;let o=this._properties[r];Eo(o)||(this._properties[r]=new Array(i),o=this._properties[r]),o[e]=Z0(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,n){e.pack(n,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(const r in this._properties){const n=this._properties[r],i=this._initializeBinaryProperty(r,n);i&&(e=e||{},e[r]=i)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){const n=r;ai(this.binary,`Property ${e} requires a batch table binary.`),ai(n.type,`Property ${e} requires a type.`);const i=vme(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;const n=_p(this._hierarchy,e,(i,o)=>{const s=i.classIds[o],u=i.classes[s].instances;return Eo(u[r])});return Eo(n)}_getPropertyNamesInHierarchy(e,r){_p(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o].instances;for(const u in s)s.hasOwnProperty(u)&&r.indexOf(u)===-1&&r.push(u)})}_getHierarchyProperty(e,r){return _p(this._hierarchy,e,(n,i)=>{const o=n.classIds[i],s=n.classes[o],u=n.classIndexes[i],d=s.instances[r];return Eo(d)?Eo(d.typedArray)?this._getBinaryProperty(d,u):Z0(d[u]):null})}_setHierarchyProperty(e,r,n,i){const o=_p(this._hierarchy,r,(s,u)=>{const d=s.classIds[u],y=s.classes[d],x=s.classIndexes[u],E=y.instances[n];return Eo(E)?(ai(u===r,`Inherited property "${n}" is read-only.`),Eo(E.typedArray)?this._setBinaryProperty(E,x,i):E[x]=Z0(i),!0):!1});return Eo(o)}}const t1=4;function py(t,e,r=0){const n=new DataView(e);if(t.magic=n.getUint32(r,!0),r+=t1,t.version=n.getUint32(r,!0),r+=t1,t.byteLength=n.getUint32(r,!0),r+=t1,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}const Ad=4,uR="b3dm tile in legacy format.";function uC(t,e,r){const n=new DataView(e);let i;t.header=t.header||{};let o=n.getUint32(r,!0);r+=Ad;let s=n.getUint32(r,!0);r+=Ad;let u=n.getUint32(r,!0);r+=Ad;let d=n.getUint32(r,!0);return r+=Ad,u>=570425344?(r-=Ad*2,i=o,u=s,d=0,o=0,s=0,console.warn(uR)):d>=570425344&&(r-=Ad,i=u,u=o,d=s,o=0,s=0,console.warn(uR)),t.header.featureTableJsonByteLength=o,t.header.featureTableBinaryByteLength=s,t.header.batchTableJsonByteLength=u,t.header.batchTableBinaryByteLength=d,t.header.batchLength=i,r}function fC(t,e,r,n){return r=Bme(t,e,r),r=Sme(t,e,r),r}function Bme(t,e,r,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:o,batchLength:s}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:s||0},i&&i>0){const u=zN(e,r,i);t.featureTableJson=JSON.parse(u)}return r+=i||0,t.featureTableBinary=new Uint8Array(e,r,o),r+=o||0,r}function Sme(t,e,r,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:o}=t.header||{};if(i&&i>0){const s=zN(e,r,i);t.batchTableJson=JSON.parse(s),r+=i,o&&o>0&&(t.batchTableBinary=new Uint8Array(e,r,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=o)}return r}function HN(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;const{batchIds:n,isRGB565:i,pointCount:o=0}=t;if(n&&r){const s=new Uint8ClampedArray(o*3);for(let u=0;u<o;u++){const d=n[u],x=r.getProperty(d,"dimensions").map(E=>E*255);s[u*3]=x[0],s[u*3+1]=x[1],s[u*3+2]=x[2]}return{type:Fn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}if(e&&i){const s=new Uint8ClampedArray(o*3);for(let u=0;u<o;u++){const d=Ame(e[u]);s[u*3]=d[0],s[u*3+1]=d[1],s[u*3+2]=d[2]}return{type:Fn.UNSIGNED_BYTE,value:s,size:3,normalized:!0}}return e&&e.length===o*3?{type:Fn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Fn.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const fR=new ut;function Ime(t,e){if(!e)return null;if(t.isOctEncoded16P){const r=new Float32Array((t.pointsLength||0)*3);for(let n=0;n<(t.pointsLength||0);n++)gme(e[n*2],e[n*2+1],fR),fR.toArray(r,n*3);return{type:Fn.FLOAT,size:2,value:r}}return{type:Fn.FLOAT,size:2,value:e}}function Mme(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,Pme(t,e)):{type:Fn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Pme(t,e){const r=new ut,n=new Float32Array(t.pointCount*3);for(let i=0;i<t.pointCount;i++)r.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,i*3);return n}async function Rme(t,e,r,n,i){r=py(t,e,r),r=uC(t,e,r),r=fC(t,e,r),Fme(t);const{featureTable:o,batchTable:s}=Dme(t);return await Ume(t,o,s,n,i),Ome(t,o,n),Lme(t,o,s),Nme(t,o),r}function Fme(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function Dme(t){const e=new lC(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",Fn.FLOAT,3);const n=kme(t,e);return{featureTable:e,batchTable:n}}function Ome(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",Fn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Fn.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Fn.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Fn.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=Mme(t,n,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Lme(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Fn.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Fn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Fn.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=HN(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Fn.UNSIGNED_BYTE,4))}function Nme(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",Fn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",Fn.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=Ime(t,r)}}function kme(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",Fn.UNSIGNED_SHORT,1),t.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:o}=t;r=new VN(i,o,n)}return r}async function Ume(t,e,r,n,i){let o,s,u;const d=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];d&&(u=d.properties);const y=e.getExtension("3DTILES_draco_point_compression");if(y){s=y.properties;const E=y.byteOffset,S=y.byteLength;if(!s||!Number.isFinite(E)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(t.featureTableBinary||[]).slice(E,E+S),t.hasPositions=Number.isFinite(s.POSITION),t.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),t.hasNormals=Number.isFinite(s.NORMAL),t.hasBatchIds=Number.isFinite(s.BATCH_ID),t.isTranslucent=Number.isFinite(s.RGBA)}if(!o)return!0;const x={buffer:o,properties:{...s,...u},batchTableProperties:u};return await zme(t,x,n,i)}async function zme(t,e,r,n){if(!n)return;const i={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const o=await sh(e.buffer,aC,i,n),s=o.attributes.POSITION&&o.attributes.POSITION.value,u=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,d=o.attributes.NORMAL&&o.attributes.NORMAL.value,y=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,x=s&&o.attributes.POSITION.value.quantization,E=d&&o.attributes.NORMAL.value.quantization;if(x){const O=o.POSITION.data.quantization,k=O.range;t.quantizedVolumeScale=new ut(k,k,k),t.quantizedVolumeOffset=new ut(O.minValues),t.quantizedRange=(1<<O.quantizationBits)-1,t.isQuantizedDraco=!0}E&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const S={};if(e.batchTableProperties)for(const O of Object.keys(e.batchTableProperties))o.attributes[O]&&o.attributes[O].value&&(S[O.toLowerCase()]=o.attributes[O].value);t.attributes={positions:s,colors:HN(t,u,void 0),normals:d,batchIds:y,...S}}function ta(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const jN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$N={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Gme=1.33,hR=["SCALAR","VEC2","VEC3","VEC4"],Vme=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Hme=new Map(Vme),jme={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$me={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wme={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function WN(t){return hR[t-1]||hR[0]}function hC(t){const e=Hme.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function dC(t,e){const r=Wme[t.componentType],n=jme[t.type],i=$me[t.componentType],o=t.count*n,s=t.count*n*i;ta(s>=0&&s<=e.byteLength);const u=$N[t.componentType],d=jN[t.type];return{ArrayType:r,length:o,byteLength:s,componentByteSize:u,numberOfComponentsInElement:d}}function JN(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];const n=e.map(s=>s.bufferView);r=r.filter(s=>!n.includes(s));const i=r.reduce((s,u)=>s+u.byteLength,0),o=e.reduce((s,u)=>{const{width:d,height:y}=u.image;return s+d*y},0);return i+Math.ceil(4*o*Gme)}function Jme(t,e,r){const n=t.bufferViews[r];ta(n);const i=n.buffer,o=e[i];ta(o);const s=(n.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,s,n.byteLength)}function Xme(t,e,r){const n=typeof r=="number"?t.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const i=t.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:o,byteOffset:s}=e[i.buffer],u=(s||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:d,length:y,componentByteSize:x,numberOfComponentsInElement:E}=dC(n,i),S=x*E,O=i.byteStride||S;if(typeof i.byteStride>"u"||i.byteStride===S)return new d(o,u,y);const k=new d(y);for(let U=0;U<n.count;U++){const J=new d(o,u+U*O,E);k.set(J,U*E)}return k}function Kme(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class oo{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Kme(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof r=="string"||typeof n=="string"}getExtension(e){const r=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return r?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;const n=this.json[e]&&this.json[e][r];if(!n)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const r=e.buffer,n=this.gltf.buffers[r];ta(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const r=this.getAccessor(e);return Xme(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const r=this.getBufferView(e.bufferView),i=this.getBuffer(r.buffer).data,o=r.byteOffset||0;return new Uint8Array(i,o,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,n){return e.extensions=e.extensions||{},e.extensions[r]=n,this.registerUsedExtension(r),this}setObjectExtension(e,r,n){const i=e.extensions||{};i[r]=n}removeObjectExtension(e,r){const n=e?.extensions||{};if(n[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(r)||i.push(r)}delete n[r]}addExtension(e,r={}){return ta(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return ta(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){const{meshIndex:r,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:r};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:r,indices:n,material:i,mode:o=4}=e,u={primitives:[{attributes:this._addAttributes(r),mode:o}]};if(n){const d=this._addIndices(n);u.primitives[0].indices=d}return Number.isFinite(i)&&(u.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(u),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,r){const n=ty(e),i=r||n?.mimeType,s={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,r=0,n=this.byteLength){const i=e.byteLength;ta(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:r,byteOffset:n,byteLength:i};return this.byteLength+=kl(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,r){const n={bufferView:e,type:WN(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){const n=this.addBufferView(e);let i={min:r.min,max:r.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,r.size));const o={size:r.size,componentType:hC(e),count:Math.round(e.length/r.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(o,r))}addTexture(e){const{imageIndex:r}=e,n={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const e=this.byteLength,r=new ArrayBuffer(e),n=new Uint8Array(r);let i=0;for(const o of this.sourceBuffers||[])i=O6(o,n,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,r){let n=!0;for(;n;){const i=e.indexOf(r);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const r={};for(const n in e){const i=e[n],o=this._getGltfAttributeName(n),s=this.addBinaryBuffer(i.value,i);r[o]=s}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){const n={min:null,max:null};if(e.length<r)return n;n.min=[],n.max=[];const i=e.subarray(0,r);for(const o of i)n.min.push(o),n.max.push(o);for(let o=r;o<e.length;o+=r)for(let s=0;s<r;s++)n.min[0+s]=Math.min(n.min[0+s],e[o+s]),n.max[0+s]=Math.max(n.max[0+s],e[o+s]);return n}}function dR(t){return(t%1+1)%1}const XN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},qme={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},KN={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function AC(t,e){return KN[e]*XN[t]}function gy(t,e,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;const i=t.getTypedArrayForBufferView(e),o=my(i,"SCALAR",r,n+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function my(t,e,r,n=1){const i=XN[e],o=qme[r],s=KN[r],u=n*i,d=u*s;let y=t.buffer,x=t.byteOffset;return x%s!==0&&(y=new Uint8Array(y).slice(x,x+d).buffer,x=0),new o(y,x,u)}function pC(t,e,r){const n=`TEXCOORD_${e.texCoord||0}`,i=r.attributes[n],o=t.getTypedArrayForAccessor(i),s=t.gltf.json,u=e.index,d=s.textures?.[u]?.source;if(typeof d<"u"){const y=s.images?.[d]?.mimeType,x=t.gltf.images?.[d];if(x&&typeof x.width<"u"){const E=[];for(let S=0;S<o.length;S+=2){const O=Yme(x,y,o,S,e.channels);E.push(O)}return E}}return[]}function qN(t,e,r,n,i){if(!r?.length)return;const o=[];for(const x of r){let E=n.findIndex(S=>S===x);E===-1&&(E=n.push(x)-1),o.push(E)}const s=new Uint32Array(o),u=t.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength})-1,d=t.addBufferView(s,u,0),y=t.addAccessor(d,{size:1,componentType:hC(s),count:s.length});i.attributes[e]=y}function Yme(t,e,r,n,i=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},s=r[n],u=r[n+1];let d=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(d=4);const y=Zme(s,u,t,d);let x=0;for(const E of i){const S=typeof E=="number"?Object.values(o)[E]:o[E],O=y+S.offset,k=Lw(t);if(k.data.length<=O)throw new Error(`${k.data.length} <= ${O}`);const U=k.data[O];x|=U<<S.shift}return x}function Zme(t,e,r,n=1){const i=r.width,o=dR(t)*(i-1),s=Math.round(o),u=r.height,d=dR(e)*(u-1),y=Math.round(d),x=r.components?r.components:n;return(y*i+s)*x}function YN(t,e,r,n,i){const o=[];for(let s=0;s<e;s++){const u=r[s],d=r[s+1]-r[s];if(d+u>n)break;const y=u/i,x=d/i;o.push(t.slice(y,y+x))}return o}function ZN(t,e,r){const n=[];for(let i=0;i<e;i++){const o=i*r;n.push(t.slice(o,o+r))}return n}function QN(t,e,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],o=new TextDecoder("utf8");let s=0;for(let u=0;u<t;u++){const d=n[u+1]-n[u];if(d+s<=e.length){const y=e.subarray(s,d+s),x=o.decode(y);i.push(x),s+=d}}return i}return[]}const e8="EXT_mesh_features",Qme=e8;async function e_e(t,e){const r=new oo(t);t_e(r,e)}function t_e(t,e){const r=t.gltf.json;if(r.meshes)for(const n of r.meshes)for(const i of n.primitives)r_e(t,i,e)}function r_e(t,e,r){if(!r?.gltf?.loadBuffers)return;const i=e.extensions?.[e8]?.featureIds;if(i)for(const o of i){let s;if(typeof o.attribute<"u"){const u=`_FEATURE_ID_${o.attribute}`,d=e.attributes[u];s=t.getTypedArrayForAccessor(d)}else typeof o.texture<"u"&&r?.gltf?.loadImages?s=pC(t,o.texture,e):s=[];o.data=s}}const n_e=Object.freeze(Object.defineProperty({__proto__:null,decode:e_e,name:Qme},Symbol.toStringTag,{value:"Module"})),gC="EXT_structural_metadata",i_e=gC;async function s_e(t,e){const r=new oo(t);o_e(r,e)}function o_e(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(gC);r&&(e.gltf?.loadImages&&a_e(t,r),c_e(t,r))}function a_e(t,e){const r=e.propertyTextures,n=t.gltf.json;if(r&&n.meshes)for(const i of n.meshes)for(const o of i.primitives)u_e(t,r,o,e)}function c_e(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.propertyTables;if(n&&i)for(const o in n){const s=l_e(i,o);s&&h_e(t,r,s)}}function l_e(t,e){for(const r of t)if(r.class===e)return r;return null}function u_e(t,e,r,n){if(!e)return;const o=r.extensions?.[gC]?.propertyTextures;if(o)for(const s of o){const u=e[s];f_e(t,u,r,n)}}function f_e(t,e,r,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const o in e.properties){const s=`${i}_${o}`,u=e.properties?.[o];if(!u)continue;u.data||(u.data=[]);const d=u.data,y=pC(t,u,r);y!==null&&(qN(t,s,y,d,r),u.data=d,n.dataAttributeNames.push(s))}}function h_e(t,e,r){const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],u=r.properties?.[o];if(u){const d=d_e(t,e,s,i,u);u.data=d}}}function d_e(t,e,r,n,i){let o=[];const s=i.values,u=t.getTypedArrayForBufferView(s),d=A_e(t,r,i,n),y=p_e(t,i,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=g_e(r,n,u,d);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=QN(n,u,d,y);break}case"ENUM":{o=m_e(e,r,n,u,d);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function A_e(t,e,r,n){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?gy(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function p_e(t,e,r){return typeof e.stringOffsets<"u"?gy(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function g_e(t,e,r,n){const i=t.array,o=t.count,s=AC(t.type,t.componentType),u=r.byteLength/s;let d;return t.componentType?d=my(r,t.type,t.componentType,u):d=r,i?n?YN(d,e,n,r.length,s):o?ZN(d,e,o):[]:d}function m_e(t,e,r,n,i){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const s=t.enums?.[o];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const u=s.valueType||"UINT16",d=AC(e.type,u),y=n.byteLength/d;let x=my(n,e.type,u,y);if(x||(x=n),e.array){if(i)return __e({valuesData:x,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:d,enumEntry:s});const E=e.count;return E?y_e(x,r,E,s):[]}return mC(x,0,r,s)}function __e(t){const{valuesData:e,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i,elementSize:o,enumEntry:s}=t,u=[];for(let d=0;d<r;d++){const y=n[d],x=n[d+1]-n[d];if(x+y>i)break;const E=y/o,S=x/o,O=mC(e,E,S,s);u.push(O)}return u}function y_e(t,e,r,n){const i=[];for(let o=0;o<e;o++){const s=r*o,u=mC(t,s,r,n);i.push(u)}return i}function mC(t,e,r,n){const i=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)i.push("");else{const s=t[e+o],u=v_e(n,s);u?i.push(u.name):i.push("")}return i}function v_e(t,e){for(const r of t.values)if(r.value===e)return r;return null}const b_e=Object.freeze(Object.defineProperty({__proto__:null,decode:s_e,name:i_e},Symbol.toStringTag,{value:"Module"})),t8="EXT_feature_metadata",x_e=t8;async function w_e(t,e){const r=new oo(t);C_e(r,e)}function C_e(t,e){if(!e.gltf?.loadBuffers)return;const r=t.getExtension(t8);r&&(e.gltf?.loadImages&&T_e(t,r),E_e(t,r))}function T_e(t,e){const r=e.schema;if(!r)return;const n=r.classes,{featureTextures:i}=e;if(n&&i)for(const o in n){const s=n[o],u=S_e(i,o);u&&M_e(t,u,s)}}function E_e(t,e){const r=e.schema;if(!r)return;const n=r.classes,i=e.featureTables;if(n&&i)for(const o in n){const s=B_e(i,o);s&&I_e(t,r,s)}}function B_e(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function S_e(t,e){for(const r in t){const n=t[r];if(n.class===e)return n}return null}function I_e(t,e,r){if(!r.class)return;const n=e.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const i=r.count;for(const o in n.properties){const s=n.properties[o],u=r.properties?.[o];if(u){const d=P_e(t,e,s,i,u);u.data=d}}}function M_e(t,e,r){const n=e.class;for(const i in r.properties){const o=e?.properties?.[i];if(o){const s=L_e(t,o,n);o.data=s}}}function P_e(t,e,r,n,i){let o=[];const s=i.bufferView,u=t.getTypedArrayForBufferView(s),d=R_e(t,r,i,n),y=F_e(t,r,i,n);return r.type==="STRING"||r.componentType==="STRING"?o=QN(n,u,d,y):D_e(r)&&(o=O_e(r,n,u,d)),o}function R_e(t,e,r,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?gy(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function F_e(t,e,r,n){return typeof r.stringOffsetBufferView<"u"?gy(t,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function D_e(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function O_e(t,e,r,n){const i=t.type==="ARRAY",o=t.componentCount,s="SCALAR",u=t.componentType||t.type,d=AC(s,u),y=r.byteLength/d,x=my(r,s,u,y);return i?n?YN(x,e,n,r.length,d):o?ZN(x,e,o):[]:x}function L_e(t,e,r){const n=t.gltf.json;if(!n.meshes)return[];const i=[];for(const o of n.meshes)for(const s of o.primitives)N_e(t,r,e,i,s);return i}function N_e(t,e,r,n,i){const o={channels:r.channels,...r.texture},s=pC(t,o,i);s&&qN(t,e,s,n,i)}const k_e=Object.freeze(Object.defineProperty({__proto__:null,decode:w_e,name:x_e},Symbol.toStringTag,{value:"Module"})),U_e="4.2.4",vA=!0,AR=1735152710,_C=12,y_=8,z_e=1313821514,G_e=5130562,V_e=0,H_e=0,j_e=1;function $_e(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function W_e(t,e=0,r={}){const n=new DataView(t),{magic:i=AR}=r,o=n.getUint32(e,!1);return o===i||o===AR}function J_e(t,e,r=0,n={}){const i=new DataView(e),o=$_e(i,r+0),s=i.getUint32(r+4,vA),u=i.getUint32(r+8,vA);switch(Object.assign(t,{header:{byteOffset:r,byteLength:u,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),r+=_C,t.version){case 1:return X_e(t,i,r);case 2:return K_e(t,i,r,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function X_e(t,e,r){ai(t.header.byteLength>_C+y_);const n=e.getUint32(r+0,vA),i=e.getUint32(r+4,vA);return r+=y_,ai(i===V_e),X2(t,e,r,n),r+=n,r+=K2(t,e,r,t.header.byteLength),r}function K_e(t,e,r,n){return ai(t.header.byteLength>_C+y_),q_e(t,e,r,n),r+t.header.byteLength}function q_e(t,e,r,n){for(;r+8<=t.header.byteLength;){const i=e.getUint32(r+0,vA),o=e.getUint32(r+4,vA);switch(r+=y_,o){case z_e:X2(t,e,r,i);break;case G_e:K2(t,e,r,i);break;case H_e:n.strict||X2(t,e,r,i);break;case j_e:n.strict||K2(t,e,r,i);break}r+=kl(i,4)}return r}function X2(t,e,r,n){const i=new Uint8Array(e.buffer,r,n),s=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(s),kl(n,4)}function K2(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),kl(n,4)}function r8(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return n.substr(0,n.lastIndexOf("/")+1)+t}const Y_e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Z_e="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Q_e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),eye=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),tye={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},rye={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function nye(t,e,r,n,i,o="NONE"){const s=await iye();aye(s,s.exports[rye[i]],t,e,r,n,s.exports[tye[o||"NONE"]])}let r1;async function iye(){return r1||(r1=sye()),r1}async function sye(){let t=Y_e;WebAssembly.validate(Q_e)&&(t=Z_e,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(oye(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function oye(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const i=t.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?eye[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,r)}function aye(t,e,r,n,i,o,s){const u=t.exports.sbrk,d=n+3&-4,y=u(d*i),x=u(o.length),E=new Uint8Array(t.exports.memory.buffer);E.set(o,x);const S=e(y,n,i,x,o.length);if(S===0&&s&&s(y,d,i),r.set(E.subarray(y,y+n*i)),u(y-u(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const v_="EXT_meshopt_compression",cye=v_;async function lye(t,e){const r=new oo(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of t.json.bufferViews||[])n.push(uye(r,i));await Promise.all(n),r.removeExtension(v_)}async function uye(t,e){const r=t.getObjectExtension(e,v_);if(r){const{byteOffset:n=0,byteLength:i=0,byteStride:o,count:s,mode:u,filter:d="NONE",buffer:y}=r,x=t.gltf.buffers[y],E=new Uint8Array(x.arrayBuffer,x.byteOffset+n,i),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await nye(S,s,o,E,u,d),t.removeObjectExtension(e,v_)}}const fye=Object.freeze(Object.defineProperty({__proto__:null,decode:lye,name:cye},Symbol.toStringTag,{value:"Module"})),Rd="EXT_texture_webp",hye=Rd;function dye(t,e){const r=new oo(t);if(!V6("image/webp")){if(r.getRequiredExtensions().includes(Rd))throw new Error(`gltf: Required extension ${Rd} not supported by browser`);return}const{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,Rd);o&&(i.source=o.source),r.removeObjectExtension(i,Rd)}r.removeExtension(Rd)}const Aye=Object.freeze(Object.defineProperty({__proto__:null,name:hye,preprocess:dye},Symbol.toStringTag,{value:"Module"})),Pm="KHR_texture_basisu",pye=Pm;function gye(t,e){const r=new oo(t),{json:n}=r;for(const i of n.textures||[]){const o=r.getObjectExtension(i,Pm);o&&(i.source=o.source,r.removeObjectExtension(i,Pm))}r.removeExtension(Pm)}const mye=Object.freeze(Object.defineProperty({__proto__:null,name:pye,preprocess:gye},Symbol.toStringTag,{value:"Module"}));function _ye(t){const e={};for(const r in t){const n=t[r];if(r!=="indices"){const i=n8(n);e[r]=i}}return e}function n8(t){const{buffer:e,size:r,count:n}=yye(t);return{value:e,size:r,byteOffset:0,count:n,type:WN(r),componentType:hC(e)}}function yye(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=vye(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}function vye(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}const Ou="KHR_draco_mesh_compression",bye=Ou;function xye(t,e,r){const n=new oo(t);for(const i of i8(n))n.getObjectExtension(i,Ou)}async function wye(t,e,r){if(!e?.gltf?.decompressMeshes)return;const n=new oo(t),i=[];for(const o of i8(n))n.getObjectExtension(o,Ou)&&i.push(Tye(n,o,e,r));await Promise.all(i),n.removeExtension(Ou)}function Cye(t,e={}){const r=new oo(t);for(const n of r.json.meshes||[])Eye(n),r.addRequiredExtension(Ou)}async function Tye(t,e,r,n){const i=t.getObjectExtension(e,Ou);if(!i)return;const o=t.getTypedArrayForBufferView(i.bufferView),s=Cg(o.buffer,o.byteOffset),u={...r};delete u["3d-tiles"];const d=await sh(s,aC,u,n),y=_ye(d.attributes);for(const[x,E]of Object.entries(y))if(x in e.attributes){const S=e.attributes[x],O=t.getAccessor(S);O?.min&&O?.max&&(E.min=O.min,E.max=O.max)}e.attributes=y,d.indices&&(e.indices=n8(d.indices)),t.removeObjectExtension(e,Ou),Bye(e)}function Eye(t,e,r=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),s=i?.parseSync?.({attributes:t}),u=n._addFauxAttributes(s.attributes),d=n.addBufferView(o);return{primitives:[{attributes:u,mode:r,extensions:{[Ou]:{bufferView:d,attributes:u}}}]}}function Bye(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*i8(t){for(const e of t.json.meshes||[])for(const r of e.primitives)yield r}const Sye=Object.freeze(Object.defineProperty({__proto__:null,decode:wye,encode:Cye,name:bye,preprocess:xye},Symbol.toStringTag,{value:"Module"})),_y="KHR_texture_transform",Iye=_y,Q0=new ut,Mye=new ci,Pye=new ci;async function Rye(t,e){if(!new oo(t).hasExtension(_y)||!e.gltf?.loadBuffers)return;const i=t.json.materials||[];for(let o=0;o<i.length;o++)Fye(o,t)}function Fye(t,e){const r=e.json.materials?.[t],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const o of n)o&&o?.extensions?.[_y]&&Dye(e,t,o,i)}function Dye(t,e,r,n){const i=Oye(r,n);if(!i)return;const o=t.json.meshes||[];for(const s of o)for(const u of s.primitives){const d=u.material;Number.isFinite(d)&&e===d&&Lye(t,u,i)}}function Oye(t,e){const r=t.extensions?.[_y],{texCoord:n=0}=t,{texCoord:i=n}=r;if(!(e.findIndex(([s,u])=>s===n&&u===i)!==-1)){const s=Uye(r);return n!==i&&(t.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:s}}return null}function Lye(t,e,r){const{originalTexCoord:n,texCoord:i,matrix:o}=r,s=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(s)){const u=t.json.accessors?.[s];if(u&&u.bufferView){const d=t.json.bufferViews?.[u.bufferView];if(d){const{arrayBuffer:y,byteOffset:x}=t.buffers[d.buffer],E=(x||0)+(u.byteOffset||0)+(d.byteOffset||0),{ArrayType:S,length:O}=dC(u,d),k=$N[u.componentType],U=jN[u.type],J=d.byteStride||k*U,G=new Float32Array(O);for(let H=0;H<u.count;H++){const K=new S(y,E+H*J,2);Q0.set(K[0],K[1],1),Q0.transformByMatrix3(o),G.set([Q0[0],Q0[1]],H*U)}n===i?Nye(u,d,t.buffers,G):kye(i,u,e,t,G)}}}}function Nye(t,e,r,n){t.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function kye(t,e,r,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const o=n.json.bufferViews;if(!o)return;o.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const s=n.json.accessors;s&&(s.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=s.length-1)}function Uye(t){const{offset:e=[0,0],rotation:r=0,scale:n=[1,1]}=t,i=new ci().set(1,0,0,0,1,0,e[0],e[1],1),o=Mye.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),s=Pye.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(o).multiplyRight(s)}const zye=Object.freeze(Object.defineProperty({__proto__:null,decode:Rye,name:Iye},Symbol.toStringTag,{value:"Module"})),Df="KHR_lights_punctual",Gye=Df;async function Vye(t){const e=new oo(t),{json:r}=e,n=e.getExtension(Df);n&&(e.json.lights=n.lights,e.removeExtension(Df));for(const i of r.nodes||[]){const o=e.getObjectExtension(i,Df);o&&(i.light=o.light),e.removeObjectExtension(i,Df)}}async function Hye(t){const e=new oo(t),{json:r}=e;if(r.lights){const n=e.addExtension(Df);ta(!n.lights),n.lights=r.lights,delete r.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,Df,n)}delete e.json.lights}}const jye=Object.freeze(Object.defineProperty({__proto__:null,decode:Vye,encode:Hye,name:Gye},Symbol.toStringTag,{value:"Module"})),cg="KHR_materials_unlit",$ye=cg;async function Wye(t){const e=new oo(t),{json:r}=e;for(const n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,cg);e.removeExtension(cg)}function Jye(t){const e=new oo(t),{json:r}=e;if(e.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,cg,{}),e.addExtension(cg))}const Xye=Object.freeze(Object.defineProperty({__proto__:null,decode:Wye,encode:Jye,name:$ye},Symbol.toStringTag,{value:"Module"})),Ip="KHR_techniques_webgl",Kye=Ip;async function qye(t){const e=new oo(t),{json:r}=e,n=e.getExtension(Ip);if(n){const i=Zye(n,e);for(const o of r.materials||[]){const s=e.getObjectExtension(o,Ip);s&&(o.technique=Object.assign({},s,i[s.technique]),o.technique.values=Qye(o.technique,e)),e.removeObjectExtension(o,Ip)}e.removeExtension(Ip)}}async function Yye(t,e){}function Zye(t,e){const{programs:r=[],shaders:n=[],techniques:i=[]}=t,o=new TextDecoder;return n.forEach(s=>{if(Number.isFinite(s.bufferView))s.code=o.decode(e.getTypedArrayForBufferView(s.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(s=>{s.fragmentShader=n[s.fragmentShader],s.vertexShader=n[s.vertexShader]}),i.forEach(s=>{s.program=r[s.program]}),i}function Qye(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in r)&&(r[n]=t.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=e.getTexture(r[n].index))}),r}const eve=Object.freeze(Object.defineProperty({__proto__:null,decode:qye,encode:Yye,name:Kye},Symbol.toStringTag,{value:"Module"})),s8=[b_e,n_e,fye,Aye,mye,Sye,jye,Xye,eve,zye,k_e];function tve(t,e={},r){const n=s8.filter(i=>o8(i.name,e));for(const i of n)i.preprocess?.(t,e,r)}async function rve(t,e={},r){const n=s8.filter(i=>o8(i.name,e));for(const i of n)await i.decode?.(t,e,r)}function o8(t,e){const r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}const n1="KHR_binary_glTF";function nve(t){const e=new oo(t),{json:r}=e;for(const n of r.images||[]){const i=e.getObjectExtension(n,n1);i&&Object.assign(n,i),e.removeObjectExtension(n,n1)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(n1)}const pR={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},ive={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class sve{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),nve(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const r in pR)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){const n=e[r];if(!(!n||Array.isArray(n))){e[r]=[];for(const i in n){const o=n[i];o.id=o.id||i;const s=e[r].length;e[r].push(o),this.idToIndexMap[r][i]=s}}}_convertObjectIdsToArrayIndices(e){for(const r in pR)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const r of e.textures)this._convertTextureIds(r);for(const r of e.meshes)this._convertMeshIds(r);for(const r of e.nodes)this._convertNodeIds(r);for(const r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const r of e.primitives){const{attributes:n,indices:i,material:o}=r;for(const s in n)n[s]=this._convertIdToIndex(n[s],"accessor");i&&(r.indices=this._convertIdToIndex(i,"accessor")),o&&(r.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(const n of e[r])for(const i in n){const o=n[i],s=this._convertIdToIndex(o,i);n[i]=s}}_convertIdToIndex(e,r){const n=ive[r];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return i}return e}_updateObjects(e){for(const r of this.json.buffers)delete r.type}_updateMaterial(e){for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,i=e.textures.findIndex(o=>o.id===n);i!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:i})}}}function ove(t,e={}){return new sve().normalize(t,e)}async function ave(t,e,r=0,n,i){return cve(t,e,r,n),ove(t,{normalize:n?.gltf?.normalize}),tve(t,n,i),n?.gltf?.loadBuffers&&t.json.buffers&&await lve(t,n,i),n?.gltf?.loadImages&&await uve(t,n,i),await rve(t,n,i),t}function cve(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!W_e(e,r,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=D6(e);else if(e instanceof ArrayBuffer){const s={};r=J_e(s,e,r,n.glb),ta(s.type==="glTF",`Invalid GLB magic string ${s.type}`),t._glb=s,t.json=s.json}else ta(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:s}=t._glb;t.buffers[0]={arrayBuffer:s[0].arrayBuffer,byteOffset:s[0].byteOffset,byteLength:s[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function lve(t,e,r){const n=t.json.buffers||[];for(let i=0;i<n.length;++i){const o=n[i];if(o.uri){const{fetch:s}=r;ta(s);const u=r8(o.uri,e),y=await(await r?.fetch?.(u))?.arrayBuffer?.();t.buffers[i]={arrayBuffer:y,byteOffset:0,byteLength:y.byteLength},delete o.uri}else t.buffers[i]===null&&(t.buffers[i]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function uve(t,e,r){const n=fve(t),i=t.json.images||[],o=[];for(const s of n)o.push(hve(t,i[s],s,e,r));return await Promise.all(o)}function fve(t){const e=new Set,r=t.json.textures||[];for(const n of r)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function hve(t,e,r,n,i){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const u=r8(e.uri,n),{fetch:d}=i;o=await(await d(u)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const u=Jme(t.json,t.buffers,e.bufferView);o=Cg(u.buffer,u.byteOffset,u.byteLength)}ta(o,"glTF image has no data");let s=await sh(o,[og,TN],{...n,mimeType:e.mimeType,basis:n.basis||{format:sC()}},i);s&&s[0]&&(s={compressed:!0,mipmaps:!1,width:s[0].width,height:s[0].height,data:s[0]}),t.images=t.images||[],t.images[r]=s}const b_={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:U_e,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:dve,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function dve(t,e={},r){e={...b_.options,...e},e.gltf={...b_.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await ave({},t,n,e,r)}const Ave={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pve={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},va={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},gve={magFilter:va.TEXTURE_MAG_FILTER,minFilter:va.TEXTURE_MIN_FILTER,wrapS:va.TEXTURE_WRAP_S,wrapT:va.TEXTURE_WRAP_T},mve={[va.TEXTURE_MAG_FILTER]:va.LINEAR,[va.TEXTURE_MIN_FILTER]:va.NEAREST_MIPMAP_LINEAR,[va.TEXTURE_WRAP_S]:va.REPEAT,[va.TEXTURE_WRAP_T]:va.REPEAT};function _ve(){return{id:"default-sampler",parameters:mve}}function yve(t){return pve[t]}function vve(t){return Ave[t]}class bve{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){const{json:n,buffers:i=[],images:o=[]}=e,{baseUri:s=""}=e;return ta(n),this.baseUri=s,this.buffers=i,this.images=o,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,o)=>this._resolveBufferView(i,o))),e.images&&(n.images=e.images.map((i,o)=>this._resolveImage(i,o))),e.samplers&&(n.samplers=e.samplers.map((i,o)=>this._resolveSampler(i,o))),e.textures&&(n.textures=e.textures.map((i,o)=>this._resolveTexture(i,o))),e.accessors&&(n.accessors=e.accessors.map((i,o)=>this._resolveAccessor(i,o))),e.materials&&(n.materials=e.materials.map((i,o)=>this._resolveMaterial(i,o))),e.meshes&&(n.meshes=e.meshes.map((i,o)=>this._resolveMesh(i,o))),e.nodes&&(n.nodes=e.nodes.map((i,o)=>this._resolveNode(i,o)),n.nodes=n.nodes.map((i,o)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,o)=>this._resolveSkin(i,o))),e.scenes&&(n.scenes=e.scenes.map((i,o)=>this._resolveScene(i,o))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;const n=e&&e[r];return n||console.warn(`glTF file error: Could not find ${e}[${r}]`),n}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,r){const n={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,o)=>{const s=this.getMesh(o);return i.id=s.id,i.primitives=i.primitives.concat(s.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:n}}_resolveMesh(e,r){const n={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const o={...i,attributes:{},indices:void 0,material:void 0},s=i.attributes;for(const u in s)o.attributes[u]=this.getAccessor(s[u]);return i.indices!==void 0&&(o.indices=this.getAccessor(i.indices)),i.material!==void 0&&(o.material=this.getMaterial(i.material)),o})),n}_resolveMaterial(e,r){const n={...e,id:e.id||`material-${r}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,r){const n=yve(e.componentType),i=vve(e.type),o=n*i,s={...e,id:e.id||`accessor-${r}`,bytesPerComponent:n,components:i,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const u=s.bufferView.buffer,{ArrayType:d,byteLength:y}=dC(s,s.bufferView),x=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+u.byteOffset;let E=u.arrayBuffer.slice(x,x+y);s.bufferView.byteStride&&(E=this._getValueFromInterleavedBuffer(u,x,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new d(E)}return s}_getValueFromInterleavedBuffer(e,r,n,i,o){const s=new Uint8Array(o*i);for(let u=0;u<o;u++){const d=r+u*n;s.set(new Uint8Array(e.arrayBuffer.slice(d,d+i)),u*i)}return s.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):_ve(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){const n={id:e.id||`sampler-${r}`,...e,parameters:{}};for(const i in n){const o=this._enumSamplerParameter(i);o!==void 0&&(n.parameters[o]=n[i])}return n}_enumSamplerParameter(e){return gve[e]}_resolveImage(e,r){const n={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[r];return i&&(n.image=i),n}_resolveBufferView(e,r){const n=e.buffer,i=this.buffers[n].arrayBuffer;let o=this.buffers[n].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,o,e.byteLength)}}_resolveCamera(e,r){const n={...e,id:e.id||`camera-${r}`};return n.perspective,n.orthographic,n}}function a8(t,e){return new bve().postProcess(t,e)}const q2={URI:0,EMBEDDED:1};function c8(t,e,r,n){t.rotateYtoZ=!0;const i=(t.byteOffset||0)+(t.byteLength||0)-r;if(i===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Cg(e,r,i),t.gltfByteOffset=0,t.gltfByteLength=i,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function l8(t,e,r,n){const i=r?.["3d-tiles"]||{};if(xve(t,e),i.loadGLTF){if(!n)return;if(t.gltfUrl){const{fetch:o}=n,s=await o(t.gltfUrl,r);t.gltfArrayBuffer=await s.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const o=await sh(t.gltfArrayBuffer,b_,r,n);t.gltf=a8(o),t.gpuMemoryUsageInBytes=JN(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function xve(t,e,r){switch(e){case q2.URI:if(t.gltfArrayBuffer){const n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),o=new TextDecoder().decode(n);t.gltfUrl=o.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case q2.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function wve(t,e,r,n,i){r=Cve(t,e,r,n),await l8(t,q2.EMBEDDED,n,i);const o=t?.gltf?.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),r}function Cve(t,e,r,n,i){r=py(t,e,r),r=uC(t,e,r),r=fC(t,e,r),r=c8(t,e,r,n);const o=new lC(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=o.getGlobalProperty("RTC_CENTER",Fn.FLOAT,3),r}async function Tve(t,e,r,n,i){return r=Eve(t,e,r,n),await l8(t,t.gltfFormat||0,n,i),r}function Eve(t,e,r,n,i){if(r=py(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=uC(t,e,r);const o=new DataView(e);if(t.gltfFormat=o.getUint32(r,!0),r+=4,r=fC(t,e,r),r=c8(t,e,r,n),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new lC(t.featureTableJson,t.featureTableBinary),u=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=u,!Number.isFinite(u))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=s.getGlobalProperty("RTC_CENTER",Fn.FLOAT,3);const d=new VN(t.batchTableJson,t.batchTableBinary,u);return Bve(t,s,d,u),r}function Bve(t,e,r,n){const i=new Array(n),o=new ut;new ut,new ut,new ut;const s=new ci,u=new Kp,d=new ut,y={},x=new An,E=[],S=[],O=[],k=[];for(let U=0;U<n;U++){let J;if(e.hasProperty("POSITION"))J=e.getProperty("POSITION",Fn.FLOAT,3,U,o);else if(e.hasProperty("POSITION_QUANTIZED")){J=e.getProperty("POSITION_QUANTIZED",Fn.UNSIGNED_SHORT,3,U,o);const oe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Fn.FLOAT,3);if(!oe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ee=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Fn.FLOAT,3);if(!Ee)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ze=65535;for(let de=0;de<3;de++)J[de]=J[de]/ze*Ee[de]+oe[de]}if(!J)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(J),y.translation=o,t.normalUp=e.getProperty("NORMAL_UP",Fn.FLOAT,3,U,E),t.normalRight=e.getProperty("NORMAL_RIGHT",Fn.FLOAT,3,U,S),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Fn.UNSIGNED_SHORT,2,U,E),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Fn.UNSIGNED_SHORT,2,U,S),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(pi.WGS84.eastNorthUpToFixedFrame(o,x),x.getRotationMatrix3(s)):s.identity()}u.fromMatrix3(s),y.rotation=u,d.set(1,1,1);const G=e.getProperty("SCALE",Fn.FLOAT,1,U,O);Number.isFinite(G)&&d.multiplyByScalar(G);const H=e.getProperty("SCALE_NON_UNIFORM",Fn.FLOAT,3,U,E);H&&d.scale(H),y.scale=d;let K=e.getProperty("BATCH_ID",Fn.UNSIGNED_SHORT,1,U,k);K===void 0&&(K=U);const he=new An().fromQuaternion(y.rotation);x.identity(),x.translate(y.translation),x.multiplyRight(he),x.scale(y.scale);const Y=x.clone();i[U]={modelMatrix:Y,batchId:K}}t.instances=i}async function Sve(t,e,r,n,i,o){r=py(t,e,r);const s=new DataView(e);for(t.tilesLength=s.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){const u={shape:"tile3d"};t.tiles.push(u),r=await o(e,r,n,i,u)}return r}async function Ive(t,e,r,n){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!n)return e.byteLength;const i=await sh(e,b_,r,n);t.gltf=a8(i),t.gpuMemoryUsageInBytes=JN(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function u8(t,e=0,r,n,i={shape:"tile3d"}){switch(i.byteOffset=e,i.type=ume(t,e),i.type){case mp.COMPOSITE:return await Sve(i,t,e,r,n,u8);case mp.BATCHED_3D_MODEL:return await wve(i,t,e,r,n);case mp.GLTF:return await Ive(i,t,r,n);case mp.INSTANCED_3D_MODEL:return await Tve(i,t,e,r,n);case mp.POINT_CLOUD:return await Rme(i,t,e,r,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const Mve=1952609651,Pve=1;async function Rve(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==Mve)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==Pve)throw new Error("Wrong subtree file verson, must be 1");const o=gR(t.slice(8,16)),s=new Uint8Array(t,24,o),d=new TextDecoder("utf8").decode(s),y=JSON.parse(d),x=gR(t.slice(16,24));let E=new ArrayBuffer(0);if(x&&(E=t.slice(24+o)),await em(y,y.tileAvailability,E,r),Array.isArray(y.contentAvailability))for(const S of y.contentAvailability)await em(y,S,E,r);else await em(y,y.contentAvailability,E,r);return await em(y,y.childSubtreeAvailability,E,r),y}async function em(t,e,r,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const o=t.bufferViews[i],s=t.buffers[o.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(s.uri){const d=`${n?.baseUrl||""}/${s.uri}`,x=await(await n.fetch(d)).arrayBuffer();e.explicitBitstream=new Uint8Array(x,o.byteOffset,o.byteLength);return}const u=t.buffers.slice(0,o.buffer).reduce((d,y)=>d+y.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(u,u+s.byteLength),o.byteOffset,o.byteLength)}function gR(t){const e=new DataView(t),r=e.getUint32(0,!0),n=e.getUint32(4,!0);return r+2**32*n}const f8={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:UN,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Rve,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ca=null;try{Ca=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Qn(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}Qn.prototype.__isLong__;Object.defineProperty(Qn.prototype,"__isLong__",{value:!0});function ao(t){return(t&&t.__isLong__)===!0}function mR(t){var e=Math.clz32(t&-t);return t?31-e:e}Qn.isLong=ao;var _R={},yR={};function oh(t,e){var r,n,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(n=yR[t],n)?n:(r=On(t,0,!0),i&&(yR[t]=r),r)):(t|=0,(i=-128<=t&&t<128)&&(n=_R[t],n)?n:(r=On(t,t<0?-1:0,!1),i&&(_R[t]=r),r))}Qn.fromInt=oh;function Ta(t,e){if(isNaN(t))return e?Ml:ic;if(e){if(t<0)return Ml;if(t>=h8)return p8}else{if(t<=-bR)return Mo;if(t+1>=bR)return A8}return t<0?Ta(-t,e).neg():On(t%bA|0,t/bA|0,e)}Qn.fromNumber=Ta;function On(t,e,r){return new Qn(t,e,r)}Qn.fromBits=On;var x_=Math.pow;function yC(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Ml:ic;if(r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return yC(t.substring(1),e,r).neg();for(var i=Ta(x_(r,8)),o=ic,s=0;s<t.length;s+=8){var u=Math.min(8,t.length-s),d=parseInt(t.substring(s,s+u),r);if(u<8){var y=Ta(x_(r,u));o=o.mul(y).add(Ta(d))}else o=o.mul(i),o=o.add(Ta(d))}return o.unsigned=e,o}Qn.fromString=yC;function fc(t,e){return typeof t=="number"?Ta(t,e):typeof t=="string"?yC(t,e):On(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Qn.fromValue=fc;var vR=65536,Fve=1<<24,bA=vR*vR,h8=bA*bA,bR=h8/2,xR=oh(Fve),ic=oh(0);Qn.ZERO=ic;var Ml=oh(0,!0);Qn.UZERO=Ml;var Jd=oh(1);Qn.ONE=Jd;var d8=oh(1,!0);Qn.UONE=d8;var Y2=oh(-1);Qn.NEG_ONE=Y2;var A8=On(-1,2147483647,!1);Qn.MAX_VALUE=A8;var p8=On(-1,-1,!0);Qn.MAX_UNSIGNED_VALUE=p8;var Mo=On(0,-2147483648,!1);Qn.MIN_VALUE=Mo;var Zt=Qn.prototype;Zt.toInt=function(){return this.unsigned?this.low>>>0:this.low};Zt.toNumber=function(){return this.unsigned?(this.high>>>0)*bA+(this.low>>>0):this.high*bA+(this.low>>>0)};Zt.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Mo)){var r=Ta(e),n=this.div(r),i=n.mul(r).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Ta(x_(e,6),this.unsigned),s=this,u="";;){var d=s.div(o),y=s.sub(d.mul(o)).toInt()>>>0,x=y.toString(e);if(s=d,s.isZero())return x+u;for(;x.length<6;)x="0"+x;u=""+x+u}};Zt.getHighBits=function(){return this.high};Zt.getHighBitsUnsigned=function(){return this.high>>>0};Zt.getLowBits=function(){return this.low};Zt.getLowBitsUnsigned=function(){return this.low>>>0};Zt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Mo)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&(e&1<<r)==0;r--);return this.high!=0?r+33:r+1};Zt.isZero=function(){return this.high===0&&this.low===0};Zt.eqz=Zt.isZero;Zt.isNegative=function(){return!this.unsigned&&this.high<0};Zt.isPositive=function(){return this.unsigned||this.high>=0};Zt.isOdd=function(){return(this.low&1)===1};Zt.isEven=function(){return(this.low&1)===0};Zt.equals=function(e){return ao(e)||(e=fc(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Zt.eq=Zt.equals;Zt.notEquals=function(e){return!this.eq(e)};Zt.neq=Zt.notEquals;Zt.ne=Zt.notEquals;Zt.lessThan=function(e){return this.comp(e)<0};Zt.lt=Zt.lessThan;Zt.lessThanOrEqual=function(e){return this.comp(e)<=0};Zt.lte=Zt.lessThanOrEqual;Zt.le=Zt.lessThanOrEqual;Zt.greaterThan=function(e){return this.comp(e)>0};Zt.gt=Zt.greaterThan;Zt.greaterThanOrEqual=function(e){return this.comp(e)>=0};Zt.gte=Zt.greaterThanOrEqual;Zt.ge=Zt.greaterThanOrEqual;Zt.compare=function(e){if(ao(e)||(e=fc(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Zt.comp=Zt.compare;Zt.negate=function(){return!this.unsigned&&this.eq(Mo)?Mo:this.not().add(Jd)};Zt.neg=Zt.negate;Zt.add=function(e){ao(e)||(e=fc(e));var r=this.high>>>16,n=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,d=e.low>>>16,y=e.low&65535,x=0,E=0,S=0,O=0;return O+=o+y,S+=O>>>16,O&=65535,S+=i+d,E+=S>>>16,S&=65535,E+=n+u,x+=E>>>16,E&=65535,x+=r+s,x&=65535,On(S<<16|O,x<<16|E,this.unsigned)};Zt.subtract=function(e){return ao(e)||(e=fc(e)),this.add(e.neg())};Zt.sub=Zt.subtract;Zt.multiply=function(e){if(this.isZero())return this;if(ao(e)||(e=fc(e)),Ca){var r=Ca.mul(this.low,this.high,e.low,e.high);return On(r,Ca.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ml:ic;if(this.eq(Mo))return e.isOdd()?Mo:ic;if(e.eq(Mo))return this.isOdd()?Mo:ic;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(xR)&&e.lt(xR))return Ta(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,o=this.low>>>16,s=this.low&65535,u=e.high>>>16,d=e.high&65535,y=e.low>>>16,x=e.low&65535,E=0,S=0,O=0,k=0;return k+=s*x,O+=k>>>16,k&=65535,O+=o*x,S+=O>>>16,O&=65535,O+=s*y,S+=O>>>16,O&=65535,S+=i*x,E+=S>>>16,S&=65535,S+=o*y,E+=S>>>16,S&=65535,S+=s*d,E+=S>>>16,S&=65535,E+=n*x+i*y+o*d+s*u,E&=65535,On(O<<16|k,E<<16|S,this.unsigned)};Zt.mul=Zt.multiply;Zt.divide=function(e){if(ao(e)||(e=fc(e)),e.isZero())throw Error("division by zero");if(Ca){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?Ca.div_u:Ca.div_s)(this.low,this.high,e.low,e.high);return On(r,Ca.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ml:ic;var n,i,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ml;if(e.gt(this.shru(1)))return d8;o=Ml}else{if(this.eq(Mo)){if(e.eq(Jd)||e.eq(Y2))return Mo;if(e.eq(Mo))return Jd;var s=this.shr(1);return n=s.div(e).shl(1),n.eq(ic)?e.isNegative()?Jd:Y2:(i=this.sub(e.mul(n)),o=n.add(i.div(e)),o)}else if(e.eq(Mo))return this.unsigned?Ml:ic;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=ic}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var u=Math.ceil(Math.log(n)/Math.LN2),d=u<=48?1:x_(2,u-48),y=Ta(n),x=y.mul(e);x.isNegative()||x.gt(i);)n-=d,y=Ta(n,this.unsigned),x=y.mul(e);y.isZero()&&(y=Jd),o=o.add(y),i=i.sub(x)}return o};Zt.div=Zt.divide;Zt.modulo=function(e){if(ao(e)||(e=fc(e)),Ca){var r=(this.unsigned?Ca.rem_u:Ca.rem_s)(this.low,this.high,e.low,e.high);return On(r,Ca.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Zt.mod=Zt.modulo;Zt.rem=Zt.modulo;Zt.not=function(){return On(~this.low,~this.high,this.unsigned)};Zt.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Zt.clz=Zt.countLeadingZeros;Zt.countTrailingZeros=function(){return this.low?mR(this.low):mR(this.high)+32};Zt.ctz=Zt.countTrailingZeros;Zt.and=function(e){return ao(e)||(e=fc(e)),On(this.low&e.low,this.high&e.high,this.unsigned)};Zt.or=function(e){return ao(e)||(e=fc(e)),On(this.low|e.low,this.high|e.high,this.unsigned)};Zt.xor=function(e){return ao(e)||(e=fc(e)),On(this.low^e.low,this.high^e.high,this.unsigned)};Zt.shiftLeft=function(e){return ao(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?On(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):On(0,this.low<<e-32,this.unsigned)};Zt.shl=Zt.shiftLeft;Zt.shiftRight=function(e){return ao(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?On(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):On(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Zt.shr=Zt.shiftRight;Zt.shiftRightUnsigned=function(e){return ao(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?On(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?On(this.high,0,this.unsigned):On(this.high>>>e-32,0,this.unsigned)};Zt.shru=Zt.shiftRightUnsigned;Zt.shr_u=Zt.shiftRightUnsigned;Zt.rotateLeft=function(e){var r;return ao(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?On(this.high,this.low,this.unsigned):e<32?(r=32-e,On(this.low<<e|this.high>>>r,this.high<<e|this.low>>>r,this.unsigned)):(e-=32,r=32-e,On(this.high<<e|this.low>>>r,this.low<<e|this.high>>>r,this.unsigned))};Zt.rotl=Zt.rotateLeft;Zt.rotateRight=function(e){var r;return ao(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?On(this.high,this.low,this.unsigned):e<32?(r=32-e,On(this.high<<r|this.low>>>e,this.low<<r|this.high>>>e,this.unsigned)):(e-=32,r=32-e,On(this.low<<r|this.high>>>e,this.high<<r|this.low>>>e,this.unsigned))};Zt.rotr=Zt.rotateRight;Zt.toSigned=function(){return this.unsigned?On(this.low,this.high,!1):this};Zt.toUnsigned=function(){return this.unsigned?this:On(this.low,this.high,!0)};Zt.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Zt.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Zt.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};Qn.fromBytes=function(e,r,n){return n?Qn.fromBytesLE(e,r):Qn.fromBytesBE(e,r)};Qn.fromBytesLE=function(e,r){return new Qn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};Qn.fromBytesBE=function(e,r){return new Qn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};const Dve=16;function g8(t){t==="X"&&(t="");const e=t.padEnd(Dve,"0");return Qn.fromString(e,!0,16)}function Ove(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const r=e%4;e=(e-r)/4;const n=e;e*=4;const o=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-o.length).join("0")+o}function Lve(t,e){const r=Nve(t).shiftRightUnsigned(2);return t.add(Qn.fromNumber(2*e+1-4).multiply(r))}function Nve(t){return t.and(t.not().add(1))}const kve=3,Uve=30,zve=2*Uve+1,wR=180/Math.PI;function Gve(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),r=parseInt(e[0],10),n=e[1],i=n.length;let o=0;const s=[0,0];for(let u=i-1;u>=0;u--){o=i-u;const d=n[u];let y=0,x=0;d==="1"?x=1:d==="2"?(y=1,x=1):d==="3"&&(y=1);const E=Math.pow(2,o-1);Hve(E,s,y,x),s[0]+=E*y,s[1]+=E*x}if(r%2===1){const u=s[0];s[0]=s[1],s[1]=u}return{face:r,ij:s,level:o}}function Vve(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<kve+zve;)e="0"+e;const r=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,r),o=i.length/2,s=Qn.fromString(n,!0,2).toString(10);let u="";if(o!==0)for(u=Qn.fromString(i,!0,2).toString(4);u.length<o;)u="0"+u;return`${s}/${u}`}function m8(t,e,r){const n=1<<e;return[(t[0]+r[0])/n,(t[1]+r[1])/n]}function CR(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function _8(t){return[CR(t[0]),CR(t[1])]}function y8(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function v8([t,e,r]){const n=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*wR,n*wR]}function Hve(t,e,r,n){if(n===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function jve(t){const e=m8(t.ij,t.level,[.5,.5]),r=_8(e),n=y8(t.face,r);return v8(n)}const $ve=100;function TR(t){const{face:e,ij:r,level:n}=t,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil($ve*Math.pow(2,-n))),s=new Float64Array(4*o*2+2);let u=0,d=0;for(let y=0;y<4;y++){const x=i[y].slice(0),E=i[y+1],S=(E[0]-x[0])/o,O=(E[1]-x[1])/o;for(let k=0;k<o;k++){x[0]+=S,x[1]+=O;const U=m8(r,n,x),J=_8(U),G=y8(e,J),H=v8(G);Math.abs(H[1])>89.999&&(H[0]=d);const K=H[0]-d;H[0]+=K>180?-360:K<-180?360:0,s[u++]=H[0],s[u++]=H[1],d=H[0]}}return s[u++]=s[0],s[u++]=s[1],s}function vC(t){const e=Wve(t);return Gve(e)}function Wve(t){if(t.indexOf("/")>0)return t;const e=g8(t);return Vve(e)}function Jve(t){const e=vC(t);return jve(e)}function Xve(t){let e;if(t.face===2||t.face===5){let r=null,n=0;for(let i=0;i<4;i++){const o=`${t.face}/${i}`,s=vC(o),u=TR(s);(typeof r>"u"||r===null)&&(r=new Float64Array(4*u.length)),r.set(u,n),n+=u.length}e=ER(r)}else{const r=TR(t);e=ER(r)}return e}function ER(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],r=[];for(let n=0;n<t.length;n+=2)e.push(t[n]),r.push(t[n+1]);return e.sort((n,i)=>n-i),r.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function Kve(t,e){const r=e?.minimumHeight||0,n=e?.maximumHeight||0,i=vC(t),o=Xve(i),s=o.west,u=o.south,d=o.east,y=o.north,x=[];return x.push(new ut(s,y,r)),x.push(new ut(d,y,r)),x.push(new ut(d,u,r)),x.push(new ut(s,u,r)),x.push(new ut(s,y,n)),x.push(new ut(d,y,n)),x.push(new ut(d,u,n)),x.push(new ut(s,u,n)),x}function b8(t){const e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},n=Kve(e,r),i=Jve(e),o=i[0],s=i[1],u=pi.WGS84.cartographicToCartesian([o,s,r.maximumHeight]),d=new ut(u[0],u[1],u[2]);n.push(d);const y=j6(n);return[...y.center,...y.halfAxes]}const qve=4,Yve=8,Zve={QUADTREE:qve,OCTREE:Yve};function Qve(t,e,r){if(t?.box){const n=g8(t.s2VolumeInfo.token),i=Lve(n,e),o=Ove(i),s={...t.s2VolumeInfo};switch(s.token=o,r){case"OCTREE":const y=t.s2VolumeInfo,x=y.maximumHeight-y.minimumHeight,E=x/2,S=y.minimumHeight+x/2;y.minimumHeight=S-E,y.maximumHeight=S+E;break}return{box:b8(s),s2VolumeInfo:s}}}async function x8(t){const{implicitOptions:e,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,s2VolumeBox:i,loaderOptions:o}=t;let{subtree:s,level:u=0,globalData:d={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;const{subdivisionScheme:y,subtreeLevels:x,maximumLevel:E,contentUrlTemplate:S,subtreesUriTemplate:O,basePath:k}=e,U={children:[],lodMetricValue:0,contentUrl:""};if(!E)return XL.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${S} won't be loaded...`),U;const J=u+d.level;if(J>E)return U;const G=Zve[y],H=Math.log2(G),K=n&1,he=n>>1&1,Y=n>>2&1,oe=(G**u-1)/(G-1);let Ee=bf(r.mortonIndex,n,H),ze=oe+Ee,de=bf(r.x,K,1),ve=bf(r.y,he,1),Ae=bf(r.z,Y,1),$=!1;u>=x&&($=i1(s.childSubtreeAvailability,Ee));const re=bf(d.x,de,u),Te=bf(d.y,ve,u),Qe=bf(d.z,Ae,u);if($){const et=`${k}/${O}`,tt=Z2(et,J,re,Te,Qe);s=await CA(tt,f8,o),d={mortonIndex:Ee,x:de,y:ve,z:Ae,level:u},Ee=0,ze=0,de=0,ve=0,Ae=0,u=0}if(!i1(s.tileAvailability,ze))return U;i1(s.contentAvailability,ze)&&(U.contentUrl=Z2(S,J,re,Te,Qe));const Ue=u+1,Ye={mortonIndex:Ee,x:de,y:ve,z:Ae};for(let et=0;et<G;et++){const tt=Qve(i,et,y),ct=await x8({subtree:s,implicitOptions:e,loaderOptions:o,parentData:Ye,childIndex:et,level:Ue,globalData:{...d},s2VolumeBox:tt});if(ct.contentUrl||ct.children.length){const mt=J+1,nt=ebe(ct,mt,{childTileX:de,childTileY:ve,childTileZ:Ae},e,i);U.children.push(nt)}}return U}function i1(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&XL.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?nbe(e,r.explicitBitstream):!1}function ebe(t,e,r,n,i){const{basePath:o,refine:s,getRefine:u,lodMetricType:d,getTileType:y,rootLodMetricValue:x,rootBoundingVolume:E}=n,S=t.contentUrl&&t.contentUrl.replace(`${o}/`,""),O=x/2**e,k=i?.box?{box:i.box}:E,U=tbe(e,k,r);return{children:t.children,contentUrl:t.contentUrl,content:{uri:S},id:t.contentUrl,refine:u(s),type:y(t),lodMetricType:d,lodMetricValue:O,geometricError:O,transform:t.transform,boundingVolume:U}}function tbe(t,e,r){if(e.region){const{childTileX:n,childTileY:i,childTileZ:o}=r,[s,u,d,y,x,E]=e.region,S=2**t,O=(d-s)/S,k=(y-u)/S,U=(E-x)/S,[J,G]=[s+O*n,s+O*(n+1)],[H,K]=[u+k*i,u+k*(i+1)],[he,Y]=[x+U*o,x+U*(o+1)];return{region:[J,H,G,K,he,Y]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function bf(t,e,r){return(t<<r)+e}function Z2(t,e,r,n,i){const o=rbe({level:e,x:r,y:n,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,s=>o[s])}function rbe(t){const e={};for(const r in t)e[`{${r}}`]=t[r];return e}function nbe(t,e){const r=Math.floor(t/8),n=t%8;return(e[r]>>n&1)===1}function bC(t,e=""){if(!e)return Il.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return Il.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Il.SCENEGRAPH;default:return n||Il.EMPTY}}function xC(t){switch(t){case"REPLACE":case"replace":return oc.REPLACE;case"ADD":case"add":return oc.ADD;default:return t}}function Q2(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(t,`${e}/`);return decodeURI(n.toString())}else if(t.startsWith("/"))return t;return eue(e,t)}function BR(t,e){if(!t)return null;let r;if(t.content){const i=t.content.uri||t.content?.url;typeof i<"u"&&(r=Q2(i,e))}return{...t,id:r,contentUrl:r,lodMetricType:yA.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:bC(t,r),refine:xC(t.refine)}}async function ibe(t,e,r){let n=null;const i=IR(t.root);i&&t.root?n=await SR(t.root,t,e,i,r):n=BR(t.root,e);const o=[];for(o.push(n);o.length>0;){const s=o.pop()||{},u=s.children||[],d=[];for(const y of u){const x=IR(y);let E;x?E=await SR(y,t,e,x,r):E=BR(y,e),E&&(d.push(E),o.push(E))}s.children=d}return n}async function SR(t,e,r,n,i){const{subdivisionScheme:o,maximumLevel:s,availableLevels:u,subtreeLevels:d,subtrees:{uri:y}}=n,x=Z2(y,0,0,0,0),E=Q2(x,r),S=await CA(E,f8,i),O=t.content?.uri,k=O?Q2(O,r):"",U=e?.root?.refine,J=t.geometricError,G=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(G){const Y={box:b8(G),s2VolumeInfo:G};t.boundingVolume=Y}const H=t.boundingVolume,K={contentUrlTemplate:k,subtreesUriTemplate:y,subdivisionScheme:o,subtreeLevels:d,maximumLevel:Number.isFinite(u)?u-1:s,refine:U,basePath:r,lodMetricType:yA.GEOMETRIC_ERROR,rootLodMetricValue:J,rootBoundingVolume:H,getTileType:bC,getRefine:xC};return await sbe(t,r,S,K,i)}async function sbe(t,e,r,n,i){if(!t)return null;const{children:o,contentUrl:s}=await x8({subtree:r,implicitOptions:n,loaderOptions:i});let u,d=null;return s&&(u=s,d={uri:s.replace(`${e}/`,"")}),{...t,id:u,contentUrl:u,lodMetricType:yA.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:bC(t,u),refine:xC(t.refine),content:d||t.content,children:o}}function IR(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}const w8={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:UN,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:obe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function obe(t,e={},r){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=r?.url&&r.url.indexOf(".json")!==-1:i=n.isTileset,i?abe(t,e,r):cbe(t,e,r)}async function abe(t,e,r){const n=JSON.parse(new TextDecoder().decode(t)),i=r?.url||"",o=lbe(i),s=await ibe(n,o,e||{});return{...n,shape:"tileset3d",loader:w8,url:i,queryString:r?.queryString||"",basePath:o,root:s||n.root,type:Bo.TILES3D,lodMetricType:yA.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function cbe(t,e,r){const n={content:{shape:"tile3d",featureIds:null}};return await u8(t,0,e,r,n.content),n.content}function lbe(t){return N6(t)}var s1={},MR;function ju(){return MR||(MR=1,function(t){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function r(o,s){return Object.prototype.hasOwnProperty.call(o,s)}t.assign=function(o){for(var s=Array.prototype.slice.call(arguments,1);s.length;){var u=s.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)r(u,d)&&(o[d]=u[d])}}return o},t.shrinkBuf=function(o,s){return o.length===s?o:o.subarray?o.subarray(0,s):(o.length=s,o)};var n={arraySet:function(o,s,u,d,y){if(s.subarray&&o.subarray){o.set(s.subarray(u,u+d),y);return}for(var x=0;x<d;x++)o[y+x]=s[u+x]},flattenChunks:function(o){var s,u,d,y,x,E;for(d=0,s=0,u=o.length;s<u;s++)d+=o[s].length;for(E=new Uint8Array(d),y=0,s=0,u=o.length;s<u;s++)x=o[s],E.set(x,y),y+=x.length;return E}},i={arraySet:function(o,s,u,d,y){for(var x=0;x<d;x++)o[y+x]=s[u+x]},flattenChunks:function(o){return[].concat.apply([],o)}};t.setTyped=function(o){o?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(e)}(s1)),s1}var pd={},Ja={},xf={},PR;function ube(){if(PR)return xf;PR=1;var t=ju(),e=4,r=0,n=1,i=2;function o(Me){for(var Dt=Me.length;--Dt>=0;)Me[Dt]=0}var s=0,u=1,d=2,y=3,x=258,E=29,S=256,O=S+1+E,k=30,U=19,J=2*O+1,G=15,H=16,K=7,he=256,Y=16,oe=17,Ee=18,ze=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],de=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ve=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=512,re=new Array((O+2)*2);o(re);var Te=new Array(k*2);o(Te);var Qe=new Array($);o(Qe);var me=new Array(x-y+1);o(me);var Le=new Array(E);o(Le);var Ue=new Array(k);o(Ue);function Ye(Me,Dt,Gt,sr,qe){this.static_tree=Me,this.extra_bits=Dt,this.extra_base=Gt,this.elems=sr,this.max_length=qe,this.has_stree=Me&&Me.length}var et,tt,ct;function mt(Me,Dt){this.dyn_tree=Me,this.max_code=0,this.stat_desc=Dt}function Tt(Me){return Me<256?Qe[Me]:Qe[256+(Me>>>7)]}function nt(Me,Dt){Me.pending_buf[Me.pending++]=Dt&255,Me.pending_buf[Me.pending++]=Dt>>>8&255}function lr(Me,Dt,Gt){Me.bi_valid>H-Gt?(Me.bi_buf|=Dt<<Me.bi_valid&65535,nt(Me,Me.bi_buf),Me.bi_buf=Dt>>H-Me.bi_valid,Me.bi_valid+=Gt-H):(Me.bi_buf|=Dt<<Me.bi_valid&65535,Me.bi_valid+=Gt)}function qt(Me,Dt,Gt){lr(Me,Gt[Dt*2],Gt[Dt*2+1])}function $t(Me,Dt){var Gt=0;do Gt|=Me&1,Me>>>=1,Gt<<=1;while(--Dt>0);return Gt>>>1}function Ot(Me){Me.bi_valid===16?(nt(Me,Me.bi_buf),Me.bi_buf=0,Me.bi_valid=0):Me.bi_valid>=8&&(Me.pending_buf[Me.pending++]=Me.bi_buf&255,Me.bi_buf>>=8,Me.bi_valid-=8)}function fr(Me,Dt){var Gt=Dt.dyn_tree,sr=Dt.max_code,qe=Dt.stat_desc.static_tree,It=Dt.stat_desc.has_stree,pe=Dt.stat_desc.extra_bits,Nt=Dt.stat_desc.extra_base,xt=Dt.stat_desc.max_length,j,_t,Ct,Ce,We,at,q=0;for(Ce=0;Ce<=G;Ce++)Me.bl_count[Ce]=0;for(Gt[Me.heap[Me.heap_max]*2+1]=0,j=Me.heap_max+1;j<J;j++)_t=Me.heap[j],Ce=Gt[Gt[_t*2+1]*2+1]+1,Ce>xt&&(Ce=xt,q++),Gt[_t*2+1]=Ce,!(_t>sr)&&(Me.bl_count[Ce]++,We=0,_t>=Nt&&(We=pe[_t-Nt]),at=Gt[_t*2],Me.opt_len+=at*(Ce+We),It&&(Me.static_len+=at*(qe[_t*2+1]+We)));if(q!==0){do{for(Ce=xt-1;Me.bl_count[Ce]===0;)Ce--;Me.bl_count[Ce]--,Me.bl_count[Ce+1]+=2,Me.bl_count[xt]--,q-=2}while(q>0);for(Ce=xt;Ce!==0;Ce--)for(_t=Me.bl_count[Ce];_t!==0;)Ct=Me.heap[--j],!(Ct>sr)&&(Gt[Ct*2+1]!==Ce&&(Me.opt_len+=(Ce-Gt[Ct*2+1])*Gt[Ct*2],Gt[Ct*2+1]=Ce),_t--)}}function rn(Me,Dt,Gt){var sr=new Array(G+1),qe=0,It,pe;for(It=1;It<=G;It++)sr[It]=qe=qe+Gt[It-1]<<1;for(pe=0;pe<=Dt;pe++){var Nt=Me[pe*2+1];Nt!==0&&(Me[pe*2]=$t(sr[Nt]++,Nt))}}function Er(){var Me,Dt,Gt,sr,qe,It=new Array(G+1);for(Gt=0,sr=0;sr<E-1;sr++)for(Le[sr]=Gt,Me=0;Me<1<<ze[sr];Me++)me[Gt++]=sr;for(me[Gt-1]=sr,qe=0,sr=0;sr<16;sr++)for(Ue[sr]=qe,Me=0;Me<1<<de[sr];Me++)Qe[qe++]=sr;for(qe>>=7;sr<k;sr++)for(Ue[sr]=qe<<7,Me=0;Me<1<<de[sr]-7;Me++)Qe[256+qe++]=sr;for(Dt=0;Dt<=G;Dt++)It[Dt]=0;for(Me=0;Me<=143;)re[Me*2+1]=8,Me++,It[8]++;for(;Me<=255;)re[Me*2+1]=9,Me++,It[9]++;for(;Me<=279;)re[Me*2+1]=7,Me++,It[7]++;for(;Me<=287;)re[Me*2+1]=8,Me++,It[8]++;for(rn(re,O+1,It),Me=0;Me<k;Me++)Te[Me*2+1]=5,Te[Me*2]=$t(Me,5);et=new Ye(re,ze,S+1,O,G),tt=new Ye(Te,de,0,k,G),ct=new Ye(new Array(0),ve,0,U,K)}function mr(Me){var Dt;for(Dt=0;Dt<O;Dt++)Me.dyn_ltree[Dt*2]=0;for(Dt=0;Dt<k;Dt++)Me.dyn_dtree[Dt*2]=0;for(Dt=0;Dt<U;Dt++)Me.bl_tree[Dt*2]=0;Me.dyn_ltree[he*2]=1,Me.opt_len=Me.static_len=0,Me.last_lit=Me.matches=0}function Ln(Me){Me.bi_valid>8?nt(Me,Me.bi_buf):Me.bi_valid>0&&(Me.pending_buf[Me.pending++]=Me.bi_buf),Me.bi_buf=0,Me.bi_valid=0}function dr(Me,Dt,Gt,sr){Ln(Me),nt(Me,Gt),nt(Me,~Gt),t.arraySet(Me.pending_buf,Me.window,Dt,Gt,Me.pending),Me.pending+=Gt}function Ar(Me,Dt,Gt,sr){var qe=Dt*2,It=Gt*2;return Me[qe]<Me[It]||Me[qe]===Me[It]&&sr[Dt]<=sr[Gt]}function nn(Me,Dt,Gt){for(var sr=Me.heap[Gt],qe=Gt<<1;qe<=Me.heap_len&&(qe<Me.heap_len&&Ar(Dt,Me.heap[qe+1],Me.heap[qe],Me.depth)&&qe++,!Ar(Dt,sr,Me.heap[qe],Me.depth));)Me.heap[Gt]=Me.heap[qe],Gt=qe,qe<<=1;Me.heap[Gt]=sr}function Ir(Me,Dt,Gt){var sr,qe,It=0,pe,Nt;if(Me.last_lit!==0)do sr=Me.pending_buf[Me.d_buf+It*2]<<8|Me.pending_buf[Me.d_buf+It*2+1],qe=Me.pending_buf[Me.l_buf+It],It++,sr===0?qt(Me,qe,Dt):(pe=me[qe],qt(Me,pe+S+1,Dt),Nt=ze[pe],Nt!==0&&(qe-=Le[pe],lr(Me,qe,Nt)),sr--,pe=Tt(sr),qt(Me,pe,Gt),Nt=de[pe],Nt!==0&&(sr-=Ue[pe],lr(Me,sr,Nt)));while(It<Me.last_lit);qt(Me,he,Dt)}function ei(Me,Dt){var Gt=Dt.dyn_tree,sr=Dt.stat_desc.static_tree,qe=Dt.stat_desc.has_stree,It=Dt.stat_desc.elems,pe,Nt,xt=-1,j;for(Me.heap_len=0,Me.heap_max=J,pe=0;pe<It;pe++)Gt[pe*2]!==0?(Me.heap[++Me.heap_len]=xt=pe,Me.depth[pe]=0):Gt[pe*2+1]=0;for(;Me.heap_len<2;)j=Me.heap[++Me.heap_len]=xt<2?++xt:0,Gt[j*2]=1,Me.depth[j]=0,Me.opt_len--,qe&&(Me.static_len-=sr[j*2+1]);for(Dt.max_code=xt,pe=Me.heap_len>>1;pe>=1;pe--)nn(Me,Gt,pe);j=It;do pe=Me.heap[1],Me.heap[1]=Me.heap[Me.heap_len--],nn(Me,Gt,1),Nt=Me.heap[1],Me.heap[--Me.heap_max]=pe,Me.heap[--Me.heap_max]=Nt,Gt[j*2]=Gt[pe*2]+Gt[Nt*2],Me.depth[j]=(Me.depth[pe]>=Me.depth[Nt]?Me.depth[pe]:Me.depth[Nt])+1,Gt[pe*2+1]=Gt[Nt*2+1]=j,Me.heap[1]=j++,nn(Me,Gt,1);while(Me.heap_len>=2);Me.heap[--Me.heap_max]=Me.heap[1],fr(Me,Dt),rn(Gt,xt,Me.bl_count)}function jn(Me,Dt,Gt){var sr,qe=-1,It,pe=Dt[0*2+1],Nt=0,xt=7,j=4;for(pe===0&&(xt=138,j=3),Dt[(Gt+1)*2+1]=65535,sr=0;sr<=Gt;sr++)It=pe,pe=Dt[(sr+1)*2+1],!(++Nt<xt&&It===pe)&&(Nt<j?Me.bl_tree[It*2]+=Nt:It!==0?(It!==qe&&Me.bl_tree[It*2]++,Me.bl_tree[Y*2]++):Nt<=10?Me.bl_tree[oe*2]++:Me.bl_tree[Ee*2]++,Nt=0,qe=It,pe===0?(xt=138,j=3):It===pe?(xt=6,j=3):(xt=7,j=4))}function fn(Me,Dt,Gt){var sr,qe=-1,It,pe=Dt[0*2+1],Nt=0,xt=7,j=4;for(pe===0&&(xt=138,j=3),sr=0;sr<=Gt;sr++)if(It=pe,pe=Dt[(sr+1)*2+1],!(++Nt<xt&&It===pe)){if(Nt<j)do qt(Me,It,Me.bl_tree);while(--Nt!==0);else It!==0?(It!==qe&&(qt(Me,It,Me.bl_tree),Nt--),qt(Me,Y,Me.bl_tree),lr(Me,Nt-3,2)):Nt<=10?(qt(Me,oe,Me.bl_tree),lr(Me,Nt-3,3)):(qt(Me,Ee,Me.bl_tree),lr(Me,Nt-11,7));Nt=0,qe=It,pe===0?(xt=138,j=3):It===pe?(xt=6,j=3):(xt=7,j=4)}}function Jn(Me){var Dt;for(jn(Me,Me.dyn_ltree,Me.l_desc.max_code),jn(Me,Me.dyn_dtree,Me.d_desc.max_code),ei(Me,Me.bl_desc),Dt=U-1;Dt>=3&&Me.bl_tree[Ae[Dt]*2+1]===0;Dt--);return Me.opt_len+=3*(Dt+1)+5+5+4,Dt}function Nn(Me,Dt,Gt,sr){var qe;for(lr(Me,Dt-257,5),lr(Me,Gt-1,5),lr(Me,sr-4,4),qe=0;qe<sr;qe++)lr(Me,Me.bl_tree[Ae[qe]*2+1],3);fn(Me,Me.dyn_ltree,Dt-1),fn(Me,Me.dyn_dtree,Gt-1)}function bn(Me){var Dt=4093624447,Gt;for(Gt=0;Gt<=31;Gt++,Dt>>>=1)if(Dt&1&&Me.dyn_ltree[Gt*2]!==0)return r;if(Me.dyn_ltree[9*2]!==0||Me.dyn_ltree[10*2]!==0||Me.dyn_ltree[13*2]!==0)return n;for(Gt=32;Gt<S;Gt++)if(Me.dyn_ltree[Gt*2]!==0)return n;return r}var $n=!1;function kt(Me){$n||(Er(),$n=!0),Me.l_desc=new mt(Me.dyn_ltree,et),Me.d_desc=new mt(Me.dyn_dtree,tt),Me.bl_desc=new mt(Me.bl_tree,ct),Me.bi_buf=0,Me.bi_valid=0,mr(Me)}function hr(Me,Dt,Gt,sr){lr(Me,(s<<1)+(sr?1:0),3),dr(Me,Dt,Gt)}function Br(Me){lr(Me,u<<1,3),qt(Me,he,re),Ot(Me)}function Zr(Me,Dt,Gt,sr){var qe,It,pe=0;Me.level>0?(Me.strm.data_type===i&&(Me.strm.data_type=bn(Me)),ei(Me,Me.l_desc),ei(Me,Me.d_desc),pe=Jn(Me),qe=Me.opt_len+3+7>>>3,It=Me.static_len+3+7>>>3,It<=qe&&(qe=It)):qe=It=Gt+5,Gt+4<=qe&&Dt!==-1?hr(Me,Dt,Gt,sr):Me.strategy===e||It===qe?(lr(Me,(u<<1)+(sr?1:0),3),Ir(Me,re,Te)):(lr(Me,(d<<1)+(sr?1:0),3),Nn(Me,Me.l_desc.max_code+1,Me.d_desc.max_code+1,pe+1),Ir(Me,Me.dyn_ltree,Me.dyn_dtree)),mr(Me),sr&&Ln(Me)}function ui(Me,Dt,Gt){return Me.pending_buf[Me.d_buf+Me.last_lit*2]=Dt>>>8&255,Me.pending_buf[Me.d_buf+Me.last_lit*2+1]=Dt&255,Me.pending_buf[Me.l_buf+Me.last_lit]=Gt&255,Me.last_lit++,Dt===0?Me.dyn_ltree[Gt*2]++:(Me.matches++,Dt--,Me.dyn_ltree[(me[Gt]+S+1)*2]++,Me.dyn_dtree[Tt(Dt)*2]++),Me.last_lit===Me.lit_bufsize-1}return xf._tr_init=kt,xf._tr_stored_block=hr,xf._tr_flush_block=Zr,xf._tr_tally=ui,xf._tr_align=Br,xf}var o1,RR;function C8(){if(RR)return o1;RR=1;function t(e,r,n,i){for(var o=e&65535|0,s=e>>>16&65535|0,u=0;n!==0;){u=n>2e3?2e3:n,n-=u;do o=o+r[i++]|0,s=s+o|0;while(--u);o%=65521,s%=65521}return o|s<<16|0}return o1=t,o1}var a1,FR;function T8(){if(FR)return a1;FR=1;function t(){for(var n,i=[],o=0;o<256;o++){n=o;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;i[o]=n}return i}var e=t();function r(n,i,o,s){var u=e,d=s+o;n^=-1;for(var y=s;y<d;y++)n=n>>>8^u[(n^i[y])&255];return n^-1}return a1=r,a1}var c1,DR;function wC(){return DR||(DR=1,c1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),c1}var OR;function fbe(){if(OR)return Ja;OR=1;var t=ju(),e=ube(),r=C8(),n=T8(),i=wC(),o=0,s=1,u=3,d=4,y=5,x=0,E=1,S=-2,O=-3,k=-5,U=-1,J=1,G=2,H=3,K=4,he=0,Y=2,oe=8,Ee=9,ze=15,de=8,ve=29,Ae=256,$=Ae+1+ve,re=30,Te=19,Qe=2*$+1,me=15,Le=3,Ue=258,Ye=Ue+Le+1,et=32,tt=42,ct=69,mt=73,Tt=91,nt=103,lr=113,qt=666,$t=1,Ot=2,fr=3,rn=4,Er=3;function mr(j,_t){return j.msg=i[_t],_t}function Ln(j){return(j<<1)-(j>4?9:0)}function dr(j){for(var _t=j.length;--_t>=0;)j[_t]=0}function Ar(j){var _t=j.state,Ct=_t.pending;Ct>j.avail_out&&(Ct=j.avail_out),Ct!==0&&(t.arraySet(j.output,_t.pending_buf,_t.pending_out,Ct,j.next_out),j.next_out+=Ct,_t.pending_out+=Ct,j.total_out+=Ct,j.avail_out-=Ct,_t.pending-=Ct,_t.pending===0&&(_t.pending_out=0))}function nn(j,_t){e._tr_flush_block(j,j.block_start>=0?j.block_start:-1,j.strstart-j.block_start,_t),j.block_start=j.strstart,Ar(j.strm)}function Ir(j,_t){j.pending_buf[j.pending++]=_t}function ei(j,_t){j.pending_buf[j.pending++]=_t>>>8&255,j.pending_buf[j.pending++]=_t&255}function jn(j,_t,Ct,Ce){var We=j.avail_in;return We>Ce&&(We=Ce),We===0?0:(j.avail_in-=We,t.arraySet(_t,j.input,j.next_in,We,Ct),j.state.wrap===1?j.adler=r(j.adler,_t,We,Ct):j.state.wrap===2&&(j.adler=n(j.adler,_t,We,Ct)),j.next_in+=We,j.total_in+=We,We)}function fn(j,_t){var Ct=j.max_chain_length,Ce=j.strstart,We,at,q=j.prev_length,ne=j.nice_match,le=j.strstart>j.w_size-Ye?j.strstart-(j.w_size-Ye):0,ye=j.window,De=j.w_mask,fe=j.prev,be=j.strstart+Ue,ae=ye[Ce+q-1],Be=ye[Ce+q];j.prev_length>=j.good_match&&(Ct>>=2),ne>j.lookahead&&(ne=j.lookahead);do if(We=_t,!(ye[We+q]!==Be||ye[We+q-1]!==ae||ye[We]!==ye[Ce]||ye[++We]!==ye[Ce+1])){Ce+=2,We++;do;while(ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&ye[++Ce]===ye[++We]&&Ce<be);if(at=Ue-(be-Ce),Ce=be-Ue,at>q){if(j.match_start=_t,q=at,at>=ne)break;ae=ye[Ce+q-1],Be=ye[Ce+q]}}while((_t=fe[_t&De])>le&&--Ct!==0);return q<=j.lookahead?q:j.lookahead}function Jn(j){var _t=j.w_size,Ct,Ce,We,at,q;do{if(at=j.window_size-j.lookahead-j.strstart,j.strstart>=_t+(_t-Ye)){t.arraySet(j.window,j.window,_t,_t,0),j.match_start-=_t,j.strstart-=_t,j.block_start-=_t,Ce=j.hash_size,Ct=Ce;do We=j.head[--Ct],j.head[Ct]=We>=_t?We-_t:0;while(--Ce);Ce=_t,Ct=Ce;do We=j.prev[--Ct],j.prev[Ct]=We>=_t?We-_t:0;while(--Ce);at+=_t}if(j.strm.avail_in===0)break;if(Ce=jn(j.strm,j.window,j.strstart+j.lookahead,at),j.lookahead+=Ce,j.lookahead+j.insert>=Le)for(q=j.strstart-j.insert,j.ins_h=j.window[q],j.ins_h=(j.ins_h<<j.hash_shift^j.window[q+1])&j.hash_mask;j.insert&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[q+Le-1])&j.hash_mask,j.prev[q&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=q,q++,j.insert--,!(j.lookahead+j.insert<Le)););}while(j.lookahead<Ye&&j.strm.avail_in!==0)}function Nn(j,_t){var Ct=65535;for(Ct>j.pending_buf_size-5&&(Ct=j.pending_buf_size-5);;){if(j.lookahead<=1){if(Jn(j),j.lookahead===0&&_t===o)return $t;if(j.lookahead===0)break}j.strstart+=j.lookahead,j.lookahead=0;var Ce=j.block_start+Ct;if((j.strstart===0||j.strstart>=Ce)&&(j.lookahead=j.strstart-Ce,j.strstart=Ce,nn(j,!1),j.strm.avail_out===0)||j.strstart-j.block_start>=j.w_size-Ye&&(nn(j,!1),j.strm.avail_out===0))return $t}return j.insert=0,_t===d?(nn(j,!0),j.strm.avail_out===0?fr:rn):(j.strstart>j.block_start&&(nn(j,!1),j.strm.avail_out===0),$t)}function bn(j,_t){for(var Ct,Ce;;){if(j.lookahead<Ye){if(Jn(j),j.lookahead<Ye&&_t===o)return $t;if(j.lookahead===0)break}if(Ct=0,j.lookahead>=Le&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+Le-1])&j.hash_mask,Ct=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),Ct!==0&&j.strstart-Ct<=j.w_size-Ye&&(j.match_length=fn(j,Ct)),j.match_length>=Le)if(Ce=e._tr_tally(j,j.strstart-j.match_start,j.match_length-Le),j.lookahead-=j.match_length,j.match_length<=j.max_lazy_match&&j.lookahead>=Le){j.match_length--;do j.strstart++,j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+Le-1])&j.hash_mask,Ct=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart;while(--j.match_length!==0);j.strstart++}else j.strstart+=j.match_length,j.match_length=0,j.ins_h=j.window[j.strstart],j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+1])&j.hash_mask;else Ce=e._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++;if(Ce&&(nn(j,!1),j.strm.avail_out===0))return $t}return j.insert=j.strstart<Le-1?j.strstart:Le-1,_t===d?(nn(j,!0),j.strm.avail_out===0?fr:rn):j.last_lit&&(nn(j,!1),j.strm.avail_out===0)?$t:Ot}function $n(j,_t){for(var Ct,Ce,We;;){if(j.lookahead<Ye){if(Jn(j),j.lookahead<Ye&&_t===o)return $t;if(j.lookahead===0)break}if(Ct=0,j.lookahead>=Le&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+Le-1])&j.hash_mask,Ct=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),j.prev_length=j.match_length,j.prev_match=j.match_start,j.match_length=Le-1,Ct!==0&&j.prev_length<j.max_lazy_match&&j.strstart-Ct<=j.w_size-Ye&&(j.match_length=fn(j,Ct),j.match_length<=5&&(j.strategy===J||j.match_length===Le&&j.strstart-j.match_start>4096)&&(j.match_length=Le-1)),j.prev_length>=Le&&j.match_length<=j.prev_length){We=j.strstart+j.lookahead-Le,Ce=e._tr_tally(j,j.strstart-1-j.prev_match,j.prev_length-Le),j.lookahead-=j.prev_length-1,j.prev_length-=2;do++j.strstart<=We&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+Le-1])&j.hash_mask,Ct=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart);while(--j.prev_length!==0);if(j.match_available=0,j.match_length=Le-1,j.strstart++,Ce&&(nn(j,!1),j.strm.avail_out===0))return $t}else if(j.match_available){if(Ce=e._tr_tally(j,0,j.window[j.strstart-1]),Ce&&nn(j,!1),j.strstart++,j.lookahead--,j.strm.avail_out===0)return $t}else j.match_available=1,j.strstart++,j.lookahead--}return j.match_available&&(Ce=e._tr_tally(j,0,j.window[j.strstart-1]),j.match_available=0),j.insert=j.strstart<Le-1?j.strstart:Le-1,_t===d?(nn(j,!0),j.strm.avail_out===0?fr:rn):j.last_lit&&(nn(j,!1),j.strm.avail_out===0)?$t:Ot}function kt(j,_t){for(var Ct,Ce,We,at,q=j.window;;){if(j.lookahead<=Ue){if(Jn(j),j.lookahead<=Ue&&_t===o)return $t;if(j.lookahead===0)break}if(j.match_length=0,j.lookahead>=Le&&j.strstart>0&&(We=j.strstart-1,Ce=q[We],Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We])){at=j.strstart+Ue;do;while(Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We]&&Ce===q[++We]&&We<at);j.match_length=Ue-(at-We),j.match_length>j.lookahead&&(j.match_length=j.lookahead)}if(j.match_length>=Le?(Ct=e._tr_tally(j,1,j.match_length-Le),j.lookahead-=j.match_length,j.strstart+=j.match_length,j.match_length=0):(Ct=e._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++),Ct&&(nn(j,!1),j.strm.avail_out===0))return $t}return j.insert=0,_t===d?(nn(j,!0),j.strm.avail_out===0?fr:rn):j.last_lit&&(nn(j,!1),j.strm.avail_out===0)?$t:Ot}function hr(j,_t){for(var Ct;;){if(j.lookahead===0&&(Jn(j),j.lookahead===0)){if(_t===o)return $t;break}if(j.match_length=0,Ct=e._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++,Ct&&(nn(j,!1),j.strm.avail_out===0))return $t}return j.insert=0,_t===d?(nn(j,!0),j.strm.avail_out===0?fr:rn):j.last_lit&&(nn(j,!1),j.strm.avail_out===0)?$t:Ot}function Br(j,_t,Ct,Ce,We){this.good_length=j,this.max_lazy=_t,this.nice_length=Ct,this.max_chain=Ce,this.func=We}var Zr;Zr=[new Br(0,0,0,0,Nn),new Br(4,4,8,4,bn),new Br(4,5,16,8,bn),new Br(4,6,32,32,bn),new Br(4,4,16,16,$n),new Br(8,16,32,32,$n),new Br(8,16,128,128,$n),new Br(8,32,128,256,$n),new Br(32,128,258,1024,$n),new Br(32,258,258,4096,$n)];function ui(j){j.window_size=2*j.w_size,dr(j.head),j.max_lazy_match=Zr[j.level].max_lazy,j.good_match=Zr[j.level].good_length,j.nice_match=Zr[j.level].nice_length,j.max_chain_length=Zr[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=Le-1,j.match_available=0,j.ins_h=0}function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=oe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(Qe*2),this.dyn_dtree=new t.Buf16((2*re+1)*2),this.bl_tree=new t.Buf16((2*Te+1)*2),dr(this.dyn_ltree),dr(this.dyn_dtree),dr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(me+1),this.heap=new t.Buf16(2*$+1),dr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*$+1),dr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(j){var _t;return!j||!j.state?mr(j,S):(j.total_in=j.total_out=0,j.data_type=Y,_t=j.state,_t.pending=0,_t.pending_out=0,_t.wrap<0&&(_t.wrap=-_t.wrap),_t.status=_t.wrap?tt:lr,j.adler=_t.wrap===2?0:1,_t.last_flush=o,e._tr_init(_t),x)}function Gt(j){var _t=Dt(j);return _t===x&&ui(j.state),_t}function sr(j,_t){return!j||!j.state||j.state.wrap!==2?S:(j.state.gzhead=_t,x)}function qe(j,_t,Ct,Ce,We,at){if(!j)return S;var q=1;if(_t===U&&(_t=6),Ce<0?(q=0,Ce=-Ce):Ce>15&&(q=2,Ce-=16),We<1||We>Ee||Ct!==oe||Ce<8||Ce>15||_t<0||_t>9||at<0||at>K)return mr(j,S);Ce===8&&(Ce=9);var ne=new Me;return j.state=ne,ne.strm=j,ne.wrap=q,ne.gzhead=null,ne.w_bits=Ce,ne.w_size=1<<ne.w_bits,ne.w_mask=ne.w_size-1,ne.hash_bits=We+7,ne.hash_size=1<<ne.hash_bits,ne.hash_mask=ne.hash_size-1,ne.hash_shift=~~((ne.hash_bits+Le-1)/Le),ne.window=new t.Buf8(ne.w_size*2),ne.head=new t.Buf16(ne.hash_size),ne.prev=new t.Buf16(ne.w_size),ne.lit_bufsize=1<<We+6,ne.pending_buf_size=ne.lit_bufsize*4,ne.pending_buf=new t.Buf8(ne.pending_buf_size),ne.d_buf=1*ne.lit_bufsize,ne.l_buf=3*ne.lit_bufsize,ne.level=_t,ne.strategy=at,ne.method=Ct,Gt(j)}function It(j,_t){return qe(j,_t,oe,ze,de,he)}function pe(j,_t){var Ct,Ce,We,at;if(!j||!j.state||_t>y||_t<0)return j?mr(j,S):S;if(Ce=j.state,!j.output||!j.input&&j.avail_in!==0||Ce.status===qt&&_t!==d)return mr(j,j.avail_out===0?k:S);if(Ce.strm=j,Ct=Ce.last_flush,Ce.last_flush=_t,Ce.status===tt)if(Ce.wrap===2)j.adler=0,Ir(Ce,31),Ir(Ce,139),Ir(Ce,8),Ce.gzhead?(Ir(Ce,(Ce.gzhead.text?1:0)+(Ce.gzhead.hcrc?2:0)+(Ce.gzhead.extra?4:0)+(Ce.gzhead.name?8:0)+(Ce.gzhead.comment?16:0)),Ir(Ce,Ce.gzhead.time&255),Ir(Ce,Ce.gzhead.time>>8&255),Ir(Ce,Ce.gzhead.time>>16&255),Ir(Ce,Ce.gzhead.time>>24&255),Ir(Ce,Ce.level===9?2:Ce.strategy>=G||Ce.level<2?4:0),Ir(Ce,Ce.gzhead.os&255),Ce.gzhead.extra&&Ce.gzhead.extra.length&&(Ir(Ce,Ce.gzhead.extra.length&255),Ir(Ce,Ce.gzhead.extra.length>>8&255)),Ce.gzhead.hcrc&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending,0)),Ce.gzindex=0,Ce.status=ct):(Ir(Ce,0),Ir(Ce,0),Ir(Ce,0),Ir(Ce,0),Ir(Ce,0),Ir(Ce,Ce.level===9?2:Ce.strategy>=G||Ce.level<2?4:0),Ir(Ce,Er),Ce.status=lr);else{var q=oe+(Ce.w_bits-8<<4)<<8,ne=-1;Ce.strategy>=G||Ce.level<2?ne=0:Ce.level<6?ne=1:Ce.level===6?ne=2:ne=3,q|=ne<<6,Ce.strstart!==0&&(q|=et),q+=31-q%31,Ce.status=lr,ei(Ce,q),Ce.strstart!==0&&(ei(Ce,j.adler>>>16),ei(Ce,j.adler&65535)),j.adler=1}if(Ce.status===ct)if(Ce.gzhead.extra){for(We=Ce.pending;Ce.gzindex<(Ce.gzhead.extra.length&65535)&&!(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>We&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending-We,We)),Ar(j),We=Ce.pending,Ce.pending===Ce.pending_buf_size));)Ir(Ce,Ce.gzhead.extra[Ce.gzindex]&255),Ce.gzindex++;Ce.gzhead.hcrc&&Ce.pending>We&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending-We,We)),Ce.gzindex===Ce.gzhead.extra.length&&(Ce.gzindex=0,Ce.status=mt)}else Ce.status=mt;if(Ce.status===mt)if(Ce.gzhead.name){We=Ce.pending;do{if(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>We&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending-We,We)),Ar(j),We=Ce.pending,Ce.pending===Ce.pending_buf_size)){at=1;break}Ce.gzindex<Ce.gzhead.name.length?at=Ce.gzhead.name.charCodeAt(Ce.gzindex++)&255:at=0,Ir(Ce,at)}while(at!==0);Ce.gzhead.hcrc&&Ce.pending>We&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending-We,We)),at===0&&(Ce.gzindex=0,Ce.status=Tt)}else Ce.status=Tt;if(Ce.status===Tt)if(Ce.gzhead.comment){We=Ce.pending;do{if(Ce.pending===Ce.pending_buf_size&&(Ce.gzhead.hcrc&&Ce.pending>We&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending-We,We)),Ar(j),We=Ce.pending,Ce.pending===Ce.pending_buf_size)){at=1;break}Ce.gzindex<Ce.gzhead.comment.length?at=Ce.gzhead.comment.charCodeAt(Ce.gzindex++)&255:at=0,Ir(Ce,at)}while(at!==0);Ce.gzhead.hcrc&&Ce.pending>We&&(j.adler=n(j.adler,Ce.pending_buf,Ce.pending-We,We)),at===0&&(Ce.status=nt)}else Ce.status=nt;if(Ce.status===nt&&(Ce.gzhead.hcrc?(Ce.pending+2>Ce.pending_buf_size&&Ar(j),Ce.pending+2<=Ce.pending_buf_size&&(Ir(Ce,j.adler&255),Ir(Ce,j.adler>>8&255),j.adler=0,Ce.status=lr)):Ce.status=lr),Ce.pending!==0){if(Ar(j),j.avail_out===0)return Ce.last_flush=-1,x}else if(j.avail_in===0&&Ln(_t)<=Ln(Ct)&&_t!==d)return mr(j,k);if(Ce.status===qt&&j.avail_in!==0)return mr(j,k);if(j.avail_in!==0||Ce.lookahead!==0||_t!==o&&Ce.status!==qt){var le=Ce.strategy===G?hr(Ce,_t):Ce.strategy===H?kt(Ce,_t):Zr[Ce.level].func(Ce,_t);if((le===fr||le===rn)&&(Ce.status=qt),le===$t||le===fr)return j.avail_out===0&&(Ce.last_flush=-1),x;if(le===Ot&&(_t===s?e._tr_align(Ce):_t!==y&&(e._tr_stored_block(Ce,0,0,!1),_t===u&&(dr(Ce.head),Ce.lookahead===0&&(Ce.strstart=0,Ce.block_start=0,Ce.insert=0))),Ar(j),j.avail_out===0))return Ce.last_flush=-1,x}return _t!==d?x:Ce.wrap<=0?E:(Ce.wrap===2?(Ir(Ce,j.adler&255),Ir(Ce,j.adler>>8&255),Ir(Ce,j.adler>>16&255),Ir(Ce,j.adler>>24&255),Ir(Ce,j.total_in&255),Ir(Ce,j.total_in>>8&255),Ir(Ce,j.total_in>>16&255),Ir(Ce,j.total_in>>24&255)):(ei(Ce,j.adler>>>16),ei(Ce,j.adler&65535)),Ar(j),Ce.wrap>0&&(Ce.wrap=-Ce.wrap),Ce.pending!==0?x:E)}function Nt(j){var _t;return!j||!j.state?S:(_t=j.state.status,_t!==tt&&_t!==ct&&_t!==mt&&_t!==Tt&&_t!==nt&&_t!==lr&&_t!==qt?mr(j,S):(j.state=null,_t===lr?mr(j,O):x))}function xt(j,_t){var Ct=_t.length,Ce,We,at,q,ne,le,ye,De;if(!j||!j.state||(Ce=j.state,q=Ce.wrap,q===2||q===1&&Ce.status!==tt||Ce.lookahead))return S;for(q===1&&(j.adler=r(j.adler,_t,Ct,0)),Ce.wrap=0,Ct>=Ce.w_size&&(q===0&&(dr(Ce.head),Ce.strstart=0,Ce.block_start=0,Ce.insert=0),De=new t.Buf8(Ce.w_size),t.arraySet(De,_t,Ct-Ce.w_size,Ce.w_size,0),_t=De,Ct=Ce.w_size),ne=j.avail_in,le=j.next_in,ye=j.input,j.avail_in=Ct,j.next_in=0,j.input=_t,Jn(Ce);Ce.lookahead>=Le;){We=Ce.strstart,at=Ce.lookahead-(Le-1);do Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[We+Le-1])&Ce.hash_mask,Ce.prev[We&Ce.w_mask]=Ce.head[Ce.ins_h],Ce.head[Ce.ins_h]=We,We++;while(--at);Ce.strstart=We,Ce.lookahead=Le-1,Jn(Ce)}return Ce.strstart+=Ce.lookahead,Ce.block_start=Ce.strstart,Ce.insert=Ce.lookahead,Ce.lookahead=0,Ce.match_length=Ce.prev_length=Le-1,Ce.match_available=0,j.next_in=le,j.input=ye,j.avail_in=ne,Ce.wrap=q,x}return Ja.deflateInit=It,Ja.deflateInit2=qe,Ja.deflateReset=Gt,Ja.deflateResetKeep=Dt,Ja.deflateSetHeader=sr,Ja.deflate=pe,Ja.deflateEnd=Nt,Ja.deflateSetDictionary=xt,Ja.deflateInfo="pako deflate (from Nodeca project)",Ja}var wf={},LR;function E8(){if(LR)return wf;LR=1;var t=ju(),e=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{e=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var n=new t.Buf8(256),i=0;i<256;i++)n[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;n[254]=n[254]=1,wf.string2buf=function(s){var u,d,y,x,E,S=s.length,O=0;for(x=0;x<S;x++)d=s.charCodeAt(x),(d&64512)===55296&&x+1<S&&(y=s.charCodeAt(x+1),(y&64512)===56320&&(d=65536+(d-55296<<10)+(y-56320),x++)),O+=d<128?1:d<2048?2:d<65536?3:4;for(u=new t.Buf8(O),E=0,x=0;E<O;x++)d=s.charCodeAt(x),(d&64512)===55296&&x+1<S&&(y=s.charCodeAt(x+1),(y&64512)===56320&&(d=65536+(d-55296<<10)+(y-56320),x++)),d<128?u[E++]=d:d<2048?(u[E++]=192|d>>>6,u[E++]=128|d&63):d<65536?(u[E++]=224|d>>>12,u[E++]=128|d>>>6&63,u[E++]=128|d&63):(u[E++]=240|d>>>18,u[E++]=128|d>>>12&63,u[E++]=128|d>>>6&63,u[E++]=128|d&63);return u};function o(s,u){if(u<65534&&(s.subarray&&r||!s.subarray&&e))return String.fromCharCode.apply(null,t.shrinkBuf(s,u));for(var d="",y=0;y<u;y++)d+=String.fromCharCode(s[y]);return d}return wf.buf2binstring=function(s){return o(s,s.length)},wf.binstring2buf=function(s){for(var u=new t.Buf8(s.length),d=0,y=u.length;d<y;d++)u[d]=s.charCodeAt(d);return u},wf.buf2string=function(s,u){var d,y,x,E,S=u||s.length,O=new Array(S*2);for(y=0,d=0;d<S;){if(x=s[d++],x<128){O[y++]=x;continue}if(E=n[x],E>4){O[y++]=65533,d+=E-1;continue}for(x&=E===2?31:E===3?15:7;E>1&&d<S;)x=x<<6|s[d++]&63,E--;if(E>1){O[y++]=65533;continue}x<65536?O[y++]=x:(x-=65536,O[y++]=55296|x>>10&1023,O[y++]=56320|x&1023)}return o(O,y)},wf.utf8border=function(s,u){var d;for(u=u||s.length,u>s.length&&(u=s.length),d=u-1;d>=0&&(s[d]&192)===128;)d--;return d<0||d===0?u:d+n[s[d]]>u?d:u},wf}var l1,NR;function B8(){if(NR)return l1;NR=1;function t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return l1=t,l1}var kR;function hbe(){if(kR)return pd;kR=1;var t=fbe(),e=ju(),r=E8(),n=wC(),i=B8(),o=Object.prototype.toString,s=0,u=4,d=0,y=1,x=2,E=-1,S=0,O=8;function k(H){if(!(this instanceof k))return new k(H);this.options=e.assign({level:E,method:O,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},H||{});var K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var he=t.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(he!==d)throw new Error(n[he]);if(K.header&&t.deflateSetHeader(this.strm,K.header),K.dictionary){var Y;if(typeof K.dictionary=="string"?Y=r.string2buf(K.dictionary):o.call(K.dictionary)==="[object ArrayBuffer]"?Y=new Uint8Array(K.dictionary):Y=K.dictionary,he=t.deflateSetDictionary(this.strm,Y),he!==d)throw new Error(n[he]);this._dict_set=!0}}k.prototype.push=function(H,K){var he=this.strm,Y=this.options.chunkSize,oe,Ee;if(this.ended)return!1;Ee=K===~~K?K:K===!0?u:s,typeof H=="string"?he.input=r.string2buf(H):o.call(H)==="[object ArrayBuffer]"?he.input=new Uint8Array(H):he.input=H,he.next_in=0,he.avail_in=he.input.length;do{if(he.avail_out===0&&(he.output=new e.Buf8(Y),he.next_out=0,he.avail_out=Y),oe=t.deflate(he,Ee),oe!==y&&oe!==d)return this.onEnd(oe),this.ended=!0,!1;(he.avail_out===0||he.avail_in===0&&(Ee===u||Ee===x))&&(this.options.to==="string"?this.onData(r.buf2binstring(e.shrinkBuf(he.output,he.next_out))):this.onData(e.shrinkBuf(he.output,he.next_out)))}while((he.avail_in>0||he.avail_out===0)&&oe!==y);return Ee===u?(oe=t.deflateEnd(this.strm),this.onEnd(oe),this.ended=!0,oe===d):(Ee===x&&(this.onEnd(d),he.avail_out=0),!0)},k.prototype.onData=function(H){this.chunks.push(H)},k.prototype.onEnd=function(H){H===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg};function U(H,K){var he=new k(K);if(he.push(H,!0),he.err)throw he.msg||n[he.err];return he.result}function J(H,K){return K=K||{},K.raw=!0,U(H,K)}function G(H,K){return K=K||{},K.gzip=!0,U(H,K)}return pd.Deflate=k,pd.deflate=U,pd.deflateRaw=J,pd.gzip=G,pd}var gd={},_a={},u1,UR;function dbe(){if(UR)return u1;UR=1;var t=30,e=12;return u1=function(n,i){var o,s,u,d,y,x,E,S,O,k,U,J,G,H,K,he,Y,oe,Ee,ze,de,ve,Ae,$,re;o=n.state,s=n.next_in,$=n.input,u=s+(n.avail_in-5),d=n.next_out,re=n.output,y=d-(i-n.avail_out),x=d+(n.avail_out-257),E=o.dmax,S=o.wsize,O=o.whave,k=o.wnext,U=o.window,J=o.hold,G=o.bits,H=o.lencode,K=o.distcode,he=(1<<o.lenbits)-1,Y=(1<<o.distbits)-1;e:do{G<15&&(J+=$[s++]<<G,G+=8,J+=$[s++]<<G,G+=8),oe=H[J&he];t:for(;;){if(Ee=oe>>>24,J>>>=Ee,G-=Ee,Ee=oe>>>16&255,Ee===0)re[d++]=oe&65535;else if(Ee&16){ze=oe&65535,Ee&=15,Ee&&(G<Ee&&(J+=$[s++]<<G,G+=8),ze+=J&(1<<Ee)-1,J>>>=Ee,G-=Ee),G<15&&(J+=$[s++]<<G,G+=8,J+=$[s++]<<G,G+=8),oe=K[J&Y];r:for(;;){if(Ee=oe>>>24,J>>>=Ee,G-=Ee,Ee=oe>>>16&255,Ee&16){if(de=oe&65535,Ee&=15,G<Ee&&(J+=$[s++]<<G,G+=8,G<Ee&&(J+=$[s++]<<G,G+=8)),de+=J&(1<<Ee)-1,de>E){n.msg="invalid distance too far back",o.mode=t;break e}if(J>>>=Ee,G-=Ee,Ee=d-y,de>Ee){if(Ee=de-Ee,Ee>O&&o.sane){n.msg="invalid distance too far back",o.mode=t;break e}if(ve=0,Ae=U,k===0){if(ve+=S-Ee,Ee<ze){ze-=Ee;do re[d++]=U[ve++];while(--Ee);ve=d-de,Ae=re}}else if(k<Ee){if(ve+=S+k-Ee,Ee-=k,Ee<ze){ze-=Ee;do re[d++]=U[ve++];while(--Ee);if(ve=0,k<ze){Ee=k,ze-=Ee;do re[d++]=U[ve++];while(--Ee);ve=d-de,Ae=re}}}else if(ve+=k-Ee,Ee<ze){ze-=Ee;do re[d++]=U[ve++];while(--Ee);ve=d-de,Ae=re}for(;ze>2;)re[d++]=Ae[ve++],re[d++]=Ae[ve++],re[d++]=Ae[ve++],ze-=3;ze&&(re[d++]=Ae[ve++],ze>1&&(re[d++]=Ae[ve++]))}else{ve=d-de;do re[d++]=re[ve++],re[d++]=re[ve++],re[d++]=re[ve++],ze-=3;while(ze>2);ze&&(re[d++]=re[ve++],ze>1&&(re[d++]=re[ve++]))}}else if((Ee&64)===0){oe=K[(oe&65535)+(J&(1<<Ee)-1)];continue r}else{n.msg="invalid distance code",o.mode=t;break e}break}}else if((Ee&64)===0){oe=H[(oe&65535)+(J&(1<<Ee)-1)];continue t}else if(Ee&32){o.mode=e;break e}else{n.msg="invalid literal/length code",o.mode=t;break e}break}}while(s<u&&d<x);ze=G>>3,s-=ze,G-=ze<<3,J&=(1<<G)-1,n.next_in=s,n.next_out=d,n.avail_in=s<u?5+(u-s):5-(s-u),n.avail_out=d<x?257+(x-d):257-(d-x),o.hold=J,o.bits=G},u1}var f1,zR;function Abe(){if(zR)return f1;zR=1;var t=ju(),e=15,r=852,n=592,i=0,o=1,s=2,u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],x=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return f1=function(S,O,k,U,J,G,H,K){var he=K.bits,Y=0,oe=0,Ee=0,ze=0,de=0,ve=0,Ae=0,$=0,re=0,Te=0,Qe,me,Le,Ue,Ye,et=null,tt=0,ct,mt=new t.Buf16(e+1),Tt=new t.Buf16(e+1),nt=null,lr=0,qt,$t,Ot;for(Y=0;Y<=e;Y++)mt[Y]=0;for(oe=0;oe<U;oe++)mt[O[k+oe]]++;for(de=he,ze=e;ze>=1&&mt[ze]===0;ze--);if(de>ze&&(de=ze),ze===0)return J[G++]=1<<24|64<<16|0,J[G++]=1<<24|64<<16|0,K.bits=1,0;for(Ee=1;Ee<ze&&mt[Ee]===0;Ee++);for(de<Ee&&(de=Ee),$=1,Y=1;Y<=e;Y++)if($<<=1,$-=mt[Y],$<0)return-1;if($>0&&(S===i||ze!==1))return-1;for(Tt[1]=0,Y=1;Y<e;Y++)Tt[Y+1]=Tt[Y]+mt[Y];for(oe=0;oe<U;oe++)O[k+oe]!==0&&(H[Tt[O[k+oe]]++]=oe);if(S===i?(et=nt=H,ct=19):S===o?(et=u,tt-=257,nt=d,lr-=257,ct=256):(et=y,nt=x,ct=-1),Te=0,oe=0,Y=Ee,Ye=G,ve=de,Ae=0,Le=-1,re=1<<de,Ue=re-1,S===o&&re>r||S===s&&re>n)return 1;for(;;){qt=Y-Ae,H[oe]<ct?($t=0,Ot=H[oe]):H[oe]>ct?($t=nt[lr+H[oe]],Ot=et[tt+H[oe]]):($t=96,Ot=0),Qe=1<<Y-Ae,me=1<<ve,Ee=me;do me-=Qe,J[Ye+(Te>>Ae)+me]=qt<<24|$t<<16|Ot|0;while(me!==0);for(Qe=1<<Y-1;Te&Qe;)Qe>>=1;if(Qe!==0?(Te&=Qe-1,Te+=Qe):Te=0,oe++,--mt[Y]===0){if(Y===ze)break;Y=O[k+H[oe]]}if(Y>de&&(Te&Ue)!==Le){for(Ae===0&&(Ae=de),Ye+=Ee,ve=Y-Ae,$=1<<ve;ve+Ae<ze&&($-=mt[ve+Ae],!($<=0));)ve++,$<<=1;if(re+=1<<ve,S===o&&re>r||S===s&&re>n)return 1;Le=Te&Ue,J[Le]=de<<24|ve<<16|Ye-G|0}}return Te!==0&&(J[Ye+Te]=Y-Ae<<24|64<<16|0),K.bits=de,0},f1}var GR;function pbe(){if(GR)return _a;GR=1;var t=ju(),e=C8(),r=T8(),n=dbe(),i=Abe(),o=0,s=1,u=2,d=4,y=5,x=6,E=0,S=1,O=2,k=-2,U=-3,J=-4,G=-5,H=8,K=1,he=2,Y=3,oe=4,Ee=5,ze=6,de=7,ve=8,Ae=9,$=10,re=11,Te=12,Qe=13,me=14,Le=15,Ue=16,Ye=17,et=18,tt=19,ct=20,mt=21,Tt=22,nt=23,lr=24,qt=25,$t=26,Ot=27,fr=28,rn=29,Er=30,mr=31,Ln=32,dr=852,Ar=592,nn=15,Ir=nn;function ei(qe){return(qe>>>24&255)+(qe>>>8&65280)+((qe&65280)<<8)+((qe&255)<<24)}function jn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function fn(qe){var It;return!qe||!qe.state?k:(It=qe.state,qe.total_in=qe.total_out=It.total=0,qe.msg="",It.wrap&&(qe.adler=It.wrap&1),It.mode=K,It.last=0,It.havedict=0,It.dmax=32768,It.head=null,It.hold=0,It.bits=0,It.lencode=It.lendyn=new t.Buf32(dr),It.distcode=It.distdyn=new t.Buf32(Ar),It.sane=1,It.back=-1,E)}function Jn(qe){var It;return!qe||!qe.state?k:(It=qe.state,It.wsize=0,It.whave=0,It.wnext=0,fn(qe))}function Nn(qe,It){var pe,Nt;return!qe||!qe.state||(Nt=qe.state,It<0?(pe=0,It=-It):(pe=(It>>4)+1,It<48&&(It&=15)),It&&(It<8||It>15))?k:(Nt.window!==null&&Nt.wbits!==It&&(Nt.window=null),Nt.wrap=pe,Nt.wbits=It,Jn(qe))}function bn(qe,It){var pe,Nt;return qe?(Nt=new jn,qe.state=Nt,Nt.window=null,pe=Nn(qe,It),pe!==E&&(qe.state=null),pe):k}function $n(qe){return bn(qe,Ir)}var kt=!0,hr,Br;function Zr(qe){if(kt){var It;for(hr=new t.Buf32(512),Br=new t.Buf32(32),It=0;It<144;)qe.lens[It++]=8;for(;It<256;)qe.lens[It++]=9;for(;It<280;)qe.lens[It++]=7;for(;It<288;)qe.lens[It++]=8;for(i(s,qe.lens,0,288,hr,0,qe.work,{bits:9}),It=0;It<32;)qe.lens[It++]=5;i(u,qe.lens,0,32,Br,0,qe.work,{bits:5}),kt=!1}qe.lencode=hr,qe.lenbits=9,qe.distcode=Br,qe.distbits=5}function ui(qe,It,pe,Nt){var xt,j=qe.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new t.Buf8(j.wsize)),Nt>=j.wsize?(t.arraySet(j.window,It,pe-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(xt=j.wsize-j.wnext,xt>Nt&&(xt=Nt),t.arraySet(j.window,It,pe-Nt,xt,j.wnext),Nt-=xt,Nt?(t.arraySet(j.window,It,pe-Nt,Nt,0),j.wnext=Nt,j.whave=j.wsize):(j.wnext+=xt,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=xt))),0}function Me(qe,It){var pe,Nt,xt,j,_t,Ct,Ce,We,at,q,ne,le,ye,De,fe=0,be,ae,Be,p,ce,yt,Xe,wt,St=new t.Buf8(4),Rt,lt,Ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!qe||!qe.state||!qe.output||!qe.input&&qe.avail_in!==0)return k;pe=qe.state,pe.mode===Te&&(pe.mode=Qe),_t=qe.next_out,xt=qe.output,Ce=qe.avail_out,j=qe.next_in,Nt=qe.input,Ct=qe.avail_in,We=pe.hold,at=pe.bits,q=Ct,ne=Ce,wt=E;e:for(;;)switch(pe.mode){case K:if(pe.wrap===0){pe.mode=Qe;break}for(;at<16;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(pe.wrap&2&&We===35615){pe.check=0,St[0]=We&255,St[1]=We>>>8&255,pe.check=r(pe.check,St,2,0),We=0,at=0,pe.mode=he;break}if(pe.flags=0,pe.head&&(pe.head.done=!1),!(pe.wrap&1)||(((We&255)<<8)+(We>>8))%31){qe.msg="incorrect header check",pe.mode=Er;break}if((We&15)!==H){qe.msg="unknown compression method",pe.mode=Er;break}if(We>>>=4,at-=4,Xe=(We&15)+8,pe.wbits===0)pe.wbits=Xe;else if(Xe>pe.wbits){qe.msg="invalid window size",pe.mode=Er;break}pe.dmax=1<<Xe,qe.adler=pe.check=1,pe.mode=We&512?$:Te,We=0,at=0;break;case he:for(;at<16;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(pe.flags=We,(pe.flags&255)!==H){qe.msg="unknown compression method",pe.mode=Er;break}if(pe.flags&57344){qe.msg="unknown header flags set",pe.mode=Er;break}pe.head&&(pe.head.text=We>>8&1),pe.flags&512&&(St[0]=We&255,St[1]=We>>>8&255,pe.check=r(pe.check,St,2,0)),We=0,at=0,pe.mode=Y;case Y:for(;at<32;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}pe.head&&(pe.head.time=We),pe.flags&512&&(St[0]=We&255,St[1]=We>>>8&255,St[2]=We>>>16&255,St[3]=We>>>24&255,pe.check=r(pe.check,St,4,0)),We=0,at=0,pe.mode=oe;case oe:for(;at<16;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}pe.head&&(pe.head.xflags=We&255,pe.head.os=We>>8),pe.flags&512&&(St[0]=We&255,St[1]=We>>>8&255,pe.check=r(pe.check,St,2,0)),We=0,at=0,pe.mode=Ee;case Ee:if(pe.flags&1024){for(;at<16;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}pe.length=We,pe.head&&(pe.head.extra_len=We),pe.flags&512&&(St[0]=We&255,St[1]=We>>>8&255,pe.check=r(pe.check,St,2,0)),We=0,at=0}else pe.head&&(pe.head.extra=null);pe.mode=ze;case ze:if(pe.flags&1024&&(le=pe.length,le>Ct&&(le=Ct),le&&(pe.head&&(Xe=pe.head.extra_len-pe.length,pe.head.extra||(pe.head.extra=new Array(pe.head.extra_len)),t.arraySet(pe.head.extra,Nt,j,le,Xe)),pe.flags&512&&(pe.check=r(pe.check,Nt,le,j)),Ct-=le,j+=le,pe.length-=le),pe.length))break e;pe.length=0,pe.mode=de;case de:if(pe.flags&2048){if(Ct===0)break e;le=0;do Xe=Nt[j+le++],pe.head&&Xe&&pe.length<65536&&(pe.head.name+=String.fromCharCode(Xe));while(Xe&&le<Ct);if(pe.flags&512&&(pe.check=r(pe.check,Nt,le,j)),Ct-=le,j+=le,Xe)break e}else pe.head&&(pe.head.name=null);pe.length=0,pe.mode=ve;case ve:if(pe.flags&4096){if(Ct===0)break e;le=0;do Xe=Nt[j+le++],pe.head&&Xe&&pe.length<65536&&(pe.head.comment+=String.fromCharCode(Xe));while(Xe&&le<Ct);if(pe.flags&512&&(pe.check=r(pe.check,Nt,le,j)),Ct-=le,j+=le,Xe)break e}else pe.head&&(pe.head.comment=null);pe.mode=Ae;case Ae:if(pe.flags&512){for(;at<16;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(We!==(pe.check&65535)){qe.msg="header crc mismatch",pe.mode=Er;break}We=0,at=0}pe.head&&(pe.head.hcrc=pe.flags>>9&1,pe.head.done=!0),qe.adler=pe.check=0,pe.mode=Te;break;case $:for(;at<32;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}qe.adler=pe.check=ei(We),We=0,at=0,pe.mode=re;case re:if(pe.havedict===0)return qe.next_out=_t,qe.avail_out=Ce,qe.next_in=j,qe.avail_in=Ct,pe.hold=We,pe.bits=at,O;qe.adler=pe.check=1,pe.mode=Te;case Te:if(It===y||It===x)break e;case Qe:if(pe.last){We>>>=at&7,at-=at&7,pe.mode=Ot;break}for(;at<3;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}switch(pe.last=We&1,We>>>=1,at-=1,We&3){case 0:pe.mode=me;break;case 1:if(Zr(pe),pe.mode=ct,It===x){We>>>=2,at-=2;break e}break;case 2:pe.mode=Ye;break;case 3:qe.msg="invalid block type",pe.mode=Er}We>>>=2,at-=2;break;case me:for(We>>>=at&7,at-=at&7;at<32;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if((We&65535)!==(We>>>16^65535)){qe.msg="invalid stored block lengths",pe.mode=Er;break}if(pe.length=We&65535,We=0,at=0,pe.mode=Le,It===x)break e;case Le:pe.mode=Ue;case Ue:if(le=pe.length,le){if(le>Ct&&(le=Ct),le>Ce&&(le=Ce),le===0)break e;t.arraySet(xt,Nt,j,le,_t),Ct-=le,j+=le,Ce-=le,_t+=le,pe.length-=le;break}pe.mode=Te;break;case Ye:for(;at<14;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(pe.nlen=(We&31)+257,We>>>=5,at-=5,pe.ndist=(We&31)+1,We>>>=5,at-=5,pe.ncode=(We&15)+4,We>>>=4,at-=4,pe.nlen>286||pe.ndist>30){qe.msg="too many length or distance symbols",pe.mode=Er;break}pe.have=0,pe.mode=et;case et:for(;pe.have<pe.ncode;){for(;at<3;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}pe.lens[Ft[pe.have++]]=We&7,We>>>=3,at-=3}for(;pe.have<19;)pe.lens[Ft[pe.have++]]=0;if(pe.lencode=pe.lendyn,pe.lenbits=7,Rt={bits:pe.lenbits},wt=i(o,pe.lens,0,19,pe.lencode,0,pe.work,Rt),pe.lenbits=Rt.bits,wt){qe.msg="invalid code lengths set",pe.mode=Er;break}pe.have=0,pe.mode=tt;case tt:for(;pe.have<pe.nlen+pe.ndist;){for(;fe=pe.lencode[We&(1<<pe.lenbits)-1],be=fe>>>24,ae=fe>>>16&255,Be=fe&65535,!(be<=at);){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(Be<16)We>>>=be,at-=be,pe.lens[pe.have++]=Be;else{if(Be===16){for(lt=be+2;at<lt;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(We>>>=be,at-=be,pe.have===0){qe.msg="invalid bit length repeat",pe.mode=Er;break}Xe=pe.lens[pe.have-1],le=3+(We&3),We>>>=2,at-=2}else if(Be===17){for(lt=be+3;at<lt;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}We>>>=be,at-=be,Xe=0,le=3+(We&7),We>>>=3,at-=3}else{for(lt=be+7;at<lt;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}We>>>=be,at-=be,Xe=0,le=11+(We&127),We>>>=7,at-=7}if(pe.have+le>pe.nlen+pe.ndist){qe.msg="invalid bit length repeat",pe.mode=Er;break}for(;le--;)pe.lens[pe.have++]=Xe}}if(pe.mode===Er)break;if(pe.lens[256]===0){qe.msg="invalid code -- missing end-of-block",pe.mode=Er;break}if(pe.lenbits=9,Rt={bits:pe.lenbits},wt=i(s,pe.lens,0,pe.nlen,pe.lencode,0,pe.work,Rt),pe.lenbits=Rt.bits,wt){qe.msg="invalid literal/lengths set",pe.mode=Er;break}if(pe.distbits=6,pe.distcode=pe.distdyn,Rt={bits:pe.distbits},wt=i(u,pe.lens,pe.nlen,pe.ndist,pe.distcode,0,pe.work,Rt),pe.distbits=Rt.bits,wt){qe.msg="invalid distances set",pe.mode=Er;break}if(pe.mode=ct,It===x)break e;case ct:pe.mode=mt;case mt:if(Ct>=6&&Ce>=258){qe.next_out=_t,qe.avail_out=Ce,qe.next_in=j,qe.avail_in=Ct,pe.hold=We,pe.bits=at,n(qe,ne),_t=qe.next_out,xt=qe.output,Ce=qe.avail_out,j=qe.next_in,Nt=qe.input,Ct=qe.avail_in,We=pe.hold,at=pe.bits,pe.mode===Te&&(pe.back=-1);break}for(pe.back=0;fe=pe.lencode[We&(1<<pe.lenbits)-1],be=fe>>>24,ae=fe>>>16&255,Be=fe&65535,!(be<=at);){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(ae&&(ae&240)===0){for(p=be,ce=ae,yt=Be;fe=pe.lencode[yt+((We&(1<<p+ce)-1)>>p)],be=fe>>>24,ae=fe>>>16&255,Be=fe&65535,!(p+be<=at);){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}We>>>=p,at-=p,pe.back+=p}if(We>>>=be,at-=be,pe.back+=be,pe.length=Be,ae===0){pe.mode=$t;break}if(ae&32){pe.back=-1,pe.mode=Te;break}if(ae&64){qe.msg="invalid literal/length code",pe.mode=Er;break}pe.extra=ae&15,pe.mode=Tt;case Tt:if(pe.extra){for(lt=pe.extra;at<lt;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}pe.length+=We&(1<<pe.extra)-1,We>>>=pe.extra,at-=pe.extra,pe.back+=pe.extra}pe.was=pe.length,pe.mode=nt;case nt:for(;fe=pe.distcode[We&(1<<pe.distbits)-1],be=fe>>>24,ae=fe>>>16&255,Be=fe&65535,!(be<=at);){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if((ae&240)===0){for(p=be,ce=ae,yt=Be;fe=pe.distcode[yt+((We&(1<<p+ce)-1)>>p)],be=fe>>>24,ae=fe>>>16&255,Be=fe&65535,!(p+be<=at);){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}We>>>=p,at-=p,pe.back+=p}if(We>>>=be,at-=be,pe.back+=be,ae&64){qe.msg="invalid distance code",pe.mode=Er;break}pe.offset=Be,pe.extra=ae&15,pe.mode=lr;case lr:if(pe.extra){for(lt=pe.extra;at<lt;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}pe.offset+=We&(1<<pe.extra)-1,We>>>=pe.extra,at-=pe.extra,pe.back+=pe.extra}if(pe.offset>pe.dmax){qe.msg="invalid distance too far back",pe.mode=Er;break}pe.mode=qt;case qt:if(Ce===0)break e;if(le=ne-Ce,pe.offset>le){if(le=pe.offset-le,le>pe.whave&&pe.sane){qe.msg="invalid distance too far back",pe.mode=Er;break}le>pe.wnext?(le-=pe.wnext,ye=pe.wsize-le):ye=pe.wnext-le,le>pe.length&&(le=pe.length),De=pe.window}else De=xt,ye=_t-pe.offset,le=pe.length;le>Ce&&(le=Ce),Ce-=le,pe.length-=le;do xt[_t++]=De[ye++];while(--le);pe.length===0&&(pe.mode=mt);break;case $t:if(Ce===0)break e;xt[_t++]=pe.length,Ce--,pe.mode=mt;break;case Ot:if(pe.wrap){for(;at<32;){if(Ct===0)break e;Ct--,We|=Nt[j++]<<at,at+=8}if(ne-=Ce,qe.total_out+=ne,pe.total+=ne,ne&&(qe.adler=pe.check=pe.flags?r(pe.check,xt,ne,_t-ne):e(pe.check,xt,ne,_t-ne)),ne=Ce,(pe.flags?We:ei(We))!==pe.check){qe.msg="incorrect data check",pe.mode=Er;break}We=0,at=0}pe.mode=fr;case fr:if(pe.wrap&&pe.flags){for(;at<32;){if(Ct===0)break e;Ct--,We+=Nt[j++]<<at,at+=8}if(We!==(pe.total&4294967295)){qe.msg="incorrect length check",pe.mode=Er;break}We=0,at=0}pe.mode=rn;case rn:wt=S;break e;case Er:wt=U;break e;case mr:return J;case Ln:default:return k}return qe.next_out=_t,qe.avail_out=Ce,qe.next_in=j,qe.avail_in=Ct,pe.hold=We,pe.bits=at,(pe.wsize||ne!==qe.avail_out&&pe.mode<Er&&(pe.mode<Ot||It!==d))&&ui(qe,qe.output,qe.next_out,ne-qe.avail_out),q-=qe.avail_in,ne-=qe.avail_out,qe.total_in+=q,qe.total_out+=ne,pe.total+=ne,pe.wrap&&ne&&(qe.adler=pe.check=pe.flags?r(pe.check,xt,ne,qe.next_out-ne):e(pe.check,xt,ne,qe.next_out-ne)),qe.data_type=pe.bits+(pe.last?64:0)+(pe.mode===Te?128:0)+(pe.mode===ct||pe.mode===Le?256:0),(q===0&&ne===0||It===d)&&wt===E&&(wt=G),wt}function Dt(qe){if(!qe||!qe.state)return k;var It=qe.state;return It.window&&(It.window=null),qe.state=null,E}function Gt(qe,It){var pe;return!qe||!qe.state||(pe=qe.state,(pe.wrap&2)===0)?k:(pe.head=It,It.done=!1,E)}function sr(qe,It){var pe=It.length,Nt,xt,j;return!qe||!qe.state||(Nt=qe.state,Nt.wrap!==0&&Nt.mode!==re)?k:Nt.mode===re&&(xt=1,xt=e(xt,It,pe,0),xt!==Nt.check)?U:(j=ui(qe,It,pe,pe),j?(Nt.mode=mr,J):(Nt.havedict=1,E))}return _a.inflateReset=Jn,_a.inflateReset2=Nn,_a.inflateResetKeep=fn,_a.inflateInit=$n,_a.inflateInit2=bn,_a.inflate=Me,_a.inflateEnd=Dt,_a.inflateGetHeader=Gt,_a.inflateSetDictionary=sr,_a.inflateInfo="pako inflate (from Nodeca project)",_a}var h1,VR;function S8(){return VR||(VR=1,h1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),h1}var d1,HR;function gbe(){if(HR)return d1;HR=1;function t(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return d1=t,d1}var jR;function mbe(){if(jR)return gd;jR=1;var t=pbe(),e=ju(),r=E8(),n=S8(),i=wC(),o=B8(),s=gbe(),u=Object.prototype.toString;function d(E){if(!(this instanceof d))return new d(E);this.options=e.assign({chunkSize:16384,windowBits:0,to:""},E||{});var S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),S.windowBits>=0&&S.windowBits<16&&!(E&&E.windowBits)&&(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&(S.windowBits&15)===0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var O=t.inflateInit2(this.strm,S.windowBits);if(O!==n.Z_OK)throw new Error(i[O]);if(this.header=new s,t.inflateGetHeader(this.strm,this.header),S.dictionary&&(typeof S.dictionary=="string"?S.dictionary=r.string2buf(S.dictionary):u.call(S.dictionary)==="[object ArrayBuffer]"&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(O=t.inflateSetDictionary(this.strm,S.dictionary),O!==n.Z_OK)))throw new Error(i[O])}d.prototype.push=function(E,S){var O=this.strm,k=this.options.chunkSize,U=this.options.dictionary,J,G,H,K,he,Y=!1;if(this.ended)return!1;G=S===~~S?S:S===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof E=="string"?O.input=r.binstring2buf(E):u.call(E)==="[object ArrayBuffer]"?O.input=new Uint8Array(E):O.input=E,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new e.Buf8(k),O.next_out=0,O.avail_out=k),J=t.inflate(O,n.Z_NO_FLUSH),J===n.Z_NEED_DICT&&U&&(J=t.inflateSetDictionary(this.strm,U)),J===n.Z_BUF_ERROR&&Y===!0&&(J=n.Z_OK,Y=!1),J!==n.Z_STREAM_END&&J!==n.Z_OK)return this.onEnd(J),this.ended=!0,!1;O.next_out&&(O.avail_out===0||J===n.Z_STREAM_END||O.avail_in===0&&(G===n.Z_FINISH||G===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(H=r.utf8border(O.output,O.next_out),K=O.next_out-H,he=r.buf2string(O.output,H),O.next_out=K,O.avail_out=k-K,K&&e.arraySet(O.output,O.output,H,K,0),this.onData(he)):this.onData(e.shrinkBuf(O.output,O.next_out))),O.avail_in===0&&O.avail_out===0&&(Y=!0)}while((O.avail_in>0||O.avail_out===0)&&J!==n.Z_STREAM_END);return J===n.Z_STREAM_END&&(G=n.Z_FINISH),G===n.Z_FINISH?(J=t.inflateEnd(this.strm),this.onEnd(J),this.ended=!0,J===n.Z_OK):(G===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),O.avail_out=0),!0)},d.prototype.onData=function(E){this.chunks.push(E)},d.prototype.onEnd=function(E){E===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=e.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg};function y(E,S){var O=new d(S);if(O.push(E,!0),O.err)throw O.msg||i[O.err];return O.result}function x(E,S){return S=S||{},S.raw=!0,y(E,S)}return gd.Inflate=d,gd.inflate=y,gd.inflateRaw=x,gd.ungzip=y,gd}var A1,$R;function _be(){if($R)return A1;$R=1;var t=ju().assign,e=hbe(),r=mbe(),n=S8(),i={};return t(i,e,r,n),A1=i,A1}var ybe=_be();const md=Kf(ybe),WR=[0],vbe={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:w8,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class CC extends gs{initializeState(){"onTileLoadFail"in this.props&&Wr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:n}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:i}=this.state;for(const o in i)i[o].needsUpdate=!0}}activateViewport(e){const{activeViewports:r,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,r[e.id]=e;const i=n?.[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){const n=r&&r.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:r}){const{tile:n}=e.props,{id:i}=r;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const r=e.sourceTile,n=this.state.layerMap[r?.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:r={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,o={loadOptions:{...r}};let s=e;if(i.preload){const y=await i.preload(e,r);y.url&&(s=y.url),y.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:y.headers}),Object.assign(o,y)}const u=await CA(s,i,o.loadOptions),d=new lme(u,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:d,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(d)}_onTileLoad(e){const{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:r}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!r||r.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Il.POINTCLOUD:return this._makePointCloudLayer(e,r);case Il.SCENEGRAPH:return this._make3DModelLayer(e);case Il.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){const{attributes:n,pointCount:i,constantRGBA:o,cartographicOrigin:s,modelMatrix:u}=e.content,{positions:d,normals:y,colors:x}=n;if(!d)return null;const E=r&&r.props.data||{header:{vertexCount:i},attributes:{POSITION:d,NORMAL:y,COLOR_0:x}},{pointSize:S,getPointColor:O}=this.props,k=this.getSubLayerClass("pointcloud",vg);return new k({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:E,coordinateSystem:Xr.METER_OFFSETS,coordinateOrigin:s,modelMatrix:u,getColor:o||O,_offset:0})}_make3DModelLayer(e){const{gltf:r,instances:n,cartographicOrigin:i,modelMatrix:o}=e.content,s=this.getSubLayerClass("scenegraph",Sg);return new s({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||WR,scenegraph:r,coordinateSystem:Xr.METER_OFFSETS,coordinateOrigin:i,modelMatrix:o,getTransformMatrix:u=>u.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){const n=e.content,{attributes:i,indices:o,modelMatrix:s,cartographicOrigin:u,coordinateSystem:d=Xr.METER_OFFSETS,material:y,featureIds:x}=n,{_getMeshColor:E}=this.props,S=r&&r.props.mesh||new zs({topology:"triangle-list",attributes:bbe(i),indices:o}),O=this.getSubLayerClass("mesh",cC);return new O(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:S,data:WR,getColor:E(e),pbrMaterial:y,modelMatrix:s,coordinateOrigin:u,coordinateSystem:d,featureIds:x,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(n=>{const i=r[n.id]=r[n.id]||{tile:n};let{layer:o}=i;return n.selected&&(o?i.needsUpdate&&(o=this._getSubLayer(n,o),i.needsUpdate=!1):o=this._getSubLayer(n)),i.layer=o,o}).filter(Boolean):null}}CC.defaultProps=vbe;CC.layerName="Tile3DLayer";function bbe(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const xbe="4.2.4",I8={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:xbe,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...I8});const JR=[1],wbe={...Ul.defaultProps,elevationData:d_,texture:{...d_,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[I8]};function XR(t){return Array.isArray(t)?t.join(";"):t||""}class TC extends gs{updateState({props:e,oldProps:r}){const n=e.elevationData!==r.elevationData;if(n){const{elevationData:o}=e,s=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:s})}const i=n||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&i){const o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&Wr.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:n,meshMaxError:i,signal:o}){if(!e)return null;let s=this.getLoadOptions();s={...s,terrain:{skirtHeight:this.state.isTiled?i*2:0,...s?.terrain,bounds:r,meshMaxError:i,elevationDecoder:n}};const{fetch:u}=this.props;return u(e,{propName:"elevationData",layer:this,loadOptions:s,signal:o})}getTiledTerrainData(e){const{elevationData:r,fetch:n,texture:i,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:u}=this.context,d=$f(r,e),y=i&&$f(i,e),{signal:x}=e;let E=[0,0],S=[0,0];if(u.isGeospatial){const J=e.bbox;E=u.projectFlat([J.west,J.south]),S=u.projectFlat([J.east,J.north])}else{const J=e.bbox;E=[J.left,J.bottom],S=[J.right,J.top]}const O=[E[0],E[1],S[0],S[1]],k=this.loadTerrain({elevationData:d,bounds:O,elevationDecoder:o,meshMaxError:s,signal:x}),U=y?n(y,{propName:"texture",layer:this,loaders:[],signal:x}).catch(J=>null):Promise.resolve(null);return Promise.all([k,U])}renderSubLayers(e){const r=this.getSubLayerClass("mesh",Wf),{color:n,wireframe:i,material:o}=this.props,{data:s}=e;if(!s)return null;const[u,d]=s;return new r(e,{data:JR,mesh:u,texture:d,_instanced:!1,coordinateSystem:Xr.CARTESIAN,getPosition:y=>[0,0,0],getColor:n,wireframe:i,material:o})}onViewportLoad(e){if(!e)return;const{zRange:r}=this.state,n=e.map(s=>s.content).filter(Boolean).map(s=>s[0].header.boundingBox.map(d=>d[2]));if(n.length===0)return;const i=Math.min(...n.map(s=>s[0])),o=Math.max(...n.map(s=>s[1]));(!r||i<r[0]||o>r[1])&&this.setState({zRange:[i,o]})}renderLayers(){const{color:e,material:r,elevationData:n,texture:i,wireframe:o,meshMaxError:s,elevationDecoder:u,tileSize:d,maxZoom:y,minZoom:x,extent:E,maxRequests:S,onTileLoad:O,onTileUnload:k,onTileError:U,maxCacheSize:J,maxCacheByteSize:G,refinementStrategy:H}=this.props;if(this.state.isTiled)return new Ul(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:XR(n),texture:XR(i),meshMaxError:s,elevationDecoder:u}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:d,maxZoom:y,minZoom:x,extent:E,maxRequests:S,onTileLoad:O,onTileUnload:k,onTileError:U,maxCacheSize:J,maxCacheByteSize:G,refinementStrategy:H});if(!n)return null;const K=this.getSubLayerClass("mesh",Wf);return new K(this.getSubLayerProps({id:"mesh"}),{data:JR,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:he=>[0,0,0],getColor:e,material:r,wireframe:o})}}TC.defaultProps=wbe;TC.layerName="TerrainLayer";const Cbe={clipBounds:[0,0,1,1],clipByInstance:void 0},M8=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,Tbe={name:"clip",vs:M8,uniformTypes:{bounds:"vec4<f32>"}},Ebe={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},Bbe={name:"clip",fs:M8,uniformTypes:{bounds:"vec4<f32>"}},Sbe={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class yy extends V_{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[Tbe],inject:Ebe}:{modules:[Bbe],inject:Sbe}}draw(){const{clipBounds:e}=this.props,r={};if(this.state.clipByInstance)r.bounds=e;else{const n=this.projectPosition([e[0],e[1],0]),i=this.projectPosition([e[2],e[3],0]);r.bounds=[Math.min(n[0],i[0]),Math.min(n[1],i[1]),Math.max(n[0],i[0]),Math.max(n[1],i[1])]}this.setShaderModuleProps({clip:r})}}yy.defaultProps=Cbe;yy.extensionName="ClipExtension";const Ibe=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,Mbe={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},Pbe=t=>{if(!t||!("dummyCollisionMap"in t))return{};const{enabled:e,collisionFBO:r,drawToCollisionMap:n,dummyCollisionMap:i}=t;return{enabled:e&&!n,sort:!!n,collision_texture:!n&&r?r.colorAttachments[0]:i}},Rbe={name:"collision",dependencies:[L_],vs:Ibe,inject:Mbe,getUniforms:Pbe,uniformTypes:{sort:"i32",enabled:"i32"}};class Fbe extends N_{renderCollisionMap(e,r){const i=[0,0,0,0],o=[1,1,e.width-2*1,e.height-2*1];this.render({...r,clearColor:i,scissorRect:o,target:e,pass:"collision"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}const p1=2;class Dbe{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:r}=e;this.dummyCollisionMap=r.createTexture({width:1,height:1}),this.collisionFilterPass=new Fbe(r,{id:"default-collision-filter"})}preRender({effects:e,layers:r,layerFilter:n,viewports:i,onViewportActive:o,views:s,isPicking:u,preRenderStats:d={}}){const{device:y}=this.context;if(u)return;const x=r.filter(({props:{visible:J,collisionEnabled:G}})=>J&&G);if(x.length===0){this.channels={};return}const E=e?.filter(J=>J.useInPicking&&d[J.id]),S=d["mask-effect"]?.didRender,O=this._groupByCollisionGroup(y,x),k=i[0],U=!this.lastViewport||!this.lastViewport.equals(k)||S;for(const J in O){const G=this.collisionFBOs[J],H=O[J],[K,he]=y.canvasContext.getPixelSize();G.resize({width:K/p1,height:he/p1}),this._render(H,{effects:E,layerFilter:n,onViewportActive:o,views:s,viewport:k,viewportChanged:U})}}_render(e,{effects:r,layerFilter:n,onViewportActive:i,views:o,viewport:s,viewportChanged:u}){const{collisionGroup:d}=e,y=this.channels[d];if(!y)return;const x=u||e===y||!Ji(y.layers,e.layers,1)||e.layerBounds.some((E,S)=>!ra(E,y.layerBounds[S]))||e.allLayersLoaded!==y.allLayersLoaded||e.layers.some(E=>E.props.transitions);if(this.channels[d]=e,x){this.lastViewport=s;const E=this.collisionFBOs[d];this.collisionFilterPass.renderCollisionMap(E,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:r,layerFilter:n,viewports:s?[s]:[],onViewportActive:i,views:o,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:E.device.canvasContext.getDevicePixelRatio()/p1}}})}}_groupByCollisionGroup(e,r){const n={};for(const i of r){const o=i.props.collisionGroup;let s=n[o];s||(s={collisionGroup:o,layers:[],layerBounds:[],allLayersLoaded:!0},n[o]=s),s.layers.push(i),s.layerBounds.push(i.getBounds()),i.isLoaded||(s.allLayersLoaded=!1)}for(const i of Object.keys(n))this.collisionFBOs[i]||this.createFBO(e,i),this.channels[i]||(this.channels[i]=n[i]);for(const i of Object.keys(this.collisionFBOs))n[i]||this.destroyFBO(i);return n}getShaderModuleProps(e){const{collisionGroup:r,collisionEnabled:n}=e.props,{collisionFBOs:i,dummyCollisionMap:o}=this,s=i[r];return{collision:{enabled:n&&!!s,collisionFBO:s,dummyCollisionMap:o}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,r){const{width:n,height:i}=e.gl.canvas,o=e.createTexture({format:"rgba8unorm",width:n,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:n,height:i,mipmaps:!1});this.collisionFBOs[r]=e.createFramebuffer({id:`collision-${r}`,width:n,height:i,colorAttachments:[o],depthStencilAttachment:s})}destroyFBO(e){const r=this.collisionFBOs[e];r.colorAttachments[0]?.destroy(),r.depthStencilAttachment?.destroy(),r.destroy(),delete this.collisionFBOs[e]}}const Obe={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class EC extends V_{getShaders(){return{modules:[Rbe]}}draw({shaderModuleProps:e}){e.collision?.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,r){if(this.getAttributeManager()===null)return;this.context.deck?._addDefaultEffect(new Dbe),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}})}getNeedsPickingBuffer(){return this.props.collisionEnabled}}EC.defaultProps=Obe;EC.extensionName="CollisionFilterExtension";function ex(t,e){const r=e?.globalFeatureId;return r!==void 0?Lbe(t,r):Nbe(t,e?.type)}function Lbe(t,e){const r=P8(t);for(const n of r){let i=0,o=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const u=n.featureIds.value[s];if(u!==o){if(e===n.globalFeatureIds.value[i])return w_(n,i,s);i=s,o=u}}if(e===n.globalFeatureIds.value[i])return w_(n,i,n.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function Nbe(t,e){const r=P8(t);return Ube(r)}function kbe(t,e,r){switch(t.type){case"Point":return Hbe(t,e,r);case"LineString":return Vbe(t,e,r);case"Polygon":return R8(t,e,r);default:const n=t;throw new Error(`Unsupported geometry type: ${n?.type}`)}}function P8(t,e){const r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function Ube(t){const e=[];for(const r of t){if(r.featureIds.value.length===0)continue;let n=0,i=r.featureIds.value[0];for(let o=0;o<r.featureIds.value.length;o++){const s=r.featureIds.value[o];s!==i&&(e.push(w_(r,n,o)),n=o,i=s)}e.push(w_(r,n,r.featureIds.value.length))}return e}function w_(t,e,r){const n=kbe(t,e,r),i=Gbe(t,e),o=zbe(t,e);return{type:"Feature",geometry:n,properties:i,...o}}function zbe(t,e=0,r){return t.fields&&t.fields[t.featureIds.value[e]]}function Gbe(t,e=0,r){const n=Object.assign({},t.properties[t.featureIds.value[e]]);for(const i in t.numericProps)n[i]=t.numericProps[i].value[e];return n}function R8(t,e=-1/0,r=1/0){const{positions:n}=t,i=t.polygonIndices.value.filter(d=>d>=e&&d<=r),o=t.primitivePolygonIndices.value.filter(d=>d>=e&&d<=r);if(!(i.length>2)){const d=[];for(let y=0;y<o.length-1;y++){const x=o[y],E=o[y+1],S=C_(n,x,E);d.push(S)}return{type:"Polygon",coordinates:d}}const u=[];for(let d=0;d<i.length-1;d++){const y=i[d],x=i[d+1],E=R8(t,y,x).coordinates;u.push(E)}return{type:"MultiPolygon",coordinates:u}}function Vbe(t,e=-1/0,r=1/0){const{positions:n}=t,i=t.pathIndices.value.filter(u=>u>=e&&u<=r);if(!(i.length>2))return{type:"LineString",coordinates:C_(n,i[0],i[1])};const s=[];for(let u=0;u<i.length-1;u++){const d=C_(n,i[u],i[u+1]);s.push(d)}return{type:"MultiLineString",coordinates:s}}function Hbe(t,e,r){const{positions:n}=t,i=C_(n,e,r);return i.length>1?{type:"MultiPoint",coordinates:i}:{type:"Point",coordinates:i[0]}}function C_(t,e,r){e=e||0,r=r||t.value.length/t.size;const n=[];for(let i=e;i<r;i++){const o=Array();for(let s=i*t.size;s<(i+1)*t.size;s++)o.push(Number(t.value[s]));n.push(o)}return n}var tm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var KR;function jbe(){return KR||(KR=1,tm.read=function(t,e,r,n,i){var o,s,u=i*8-n-1,d=(1<<u)-1,y=d>>1,x=-7,E=r?i-1:0,S=r?-1:1,O=t[e+E];for(E+=S,o=O&(1<<-x)-1,O>>=-x,x+=u;x>0;o=o*256+t[e+E],E+=S,x-=8);for(s=o&(1<<-x)-1,o>>=-x,x+=n;x>0;s=s*256+t[e+E],E+=S,x-=8);if(o===0)o=1-y;else{if(o===d)return s?NaN:(O?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-y}return(O?-1:1)*s*Math.pow(2,o-n)},tm.write=function(t,e,r,n,i,o){var s,u,d,y=o*8-i-1,x=(1<<y)-1,E=x>>1,S=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=n?0:o-1,k=n?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=x):(s=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-s))<1&&(s--,d*=2),s+E>=1?e+=S/d:e+=S*Math.pow(2,1-E),e*d>=2&&(s++,d/=2),s+E>=x?(u=0,s=x):s+E>=1?(u=(e*d-1)*Math.pow(2,i),s=s+E):(u=e*Math.pow(2,E-1)*Math.pow(2,i),s=0));i>=8;t[r+O]=u&255,O+=k,u/=256,i-=8);for(s=s<<i|u,y+=i;y>0;t[r+O]=s&255,O+=k,s/=256,y-=8);t[r+O-k]|=U*128}),tm}var g1,qR;function $be(){if(qR)return g1;qR=1,g1=e;var t=jbe();function e($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=65536*65536,n=1/r,i=12,o=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");e.prototype={destroy:function(){this.buf=null},readFields:function($,re,Te){for(Te=Te||this.length;this.pos<Te;){var Qe=this.readVarint(),me=Qe>>3,Le=this.pos;this.type=Qe&7,$(me,re,this),this.pos===Le&&this.skip(Qe)}return re},readMessage:function($,re){return this.readFields($,re,this.readVarint()+this.pos)},readFixed32:function(){var $=oe(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=ze(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=oe(this.buf,this.pos)+oe(this.buf,this.pos+4)*r;return this.pos+=8,$},readSFixed64:function(){var $=oe(this.buf,this.pos)+ze(this.buf,this.pos+4)*r;return this.pos+=8,$},readFloat:function(){var $=t.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=t.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var re=this.buf,Te,Qe;return Qe=re[this.pos++],Te=Qe&127,Qe<128||(Qe=re[this.pos++],Te|=(Qe&127)<<7,Qe<128)||(Qe=re[this.pos++],Te|=(Qe&127)<<14,Qe<128)||(Qe=re[this.pos++],Te|=(Qe&127)<<21,Qe<128)?Te:(Qe=re[this.pos],Te|=(Qe&15)<<28,s(Te,$,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2===1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,re=this.pos;return this.pos=$,$-re>=i&&o?ve(this.buf,re,$):de(this.buf,re,$)},readBytes:function(){var $=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,$);return this.pos=$,re},readPackedVarint:function($,re){if(this.type!==e.Bytes)return $.push(this.readVarint(re));var Te=u(this);for($=$||[];this.pos<Te;)$.push(this.readVarint(re));return $},readPackedSVarint:function($){if(this.type!==e.Bytes)return $.push(this.readSVarint());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==e.Bytes)return $.push(this.readBoolean());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==e.Bytes)return $.push(this.readFloat());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==e.Bytes)return $.push(this.readDouble());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==e.Bytes)return $.push(this.readFixed32());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==e.Bytes)return $.push(this.readSFixed32());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==e.Bytes)return $.push(this.readFixed64());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==e.Bytes)return $.push(this.readSFixed64());var re=u(this);for($=$||[];this.pos<re;)$.push(this.readSFixed64());return $},skip:function($){var re=$&7;if(re===e.Varint)for(;this.buf[this.pos++]>127;);else if(re===e.Bytes)this.pos=this.readVarint()+this.pos;else if(re===e.Fixed32)this.pos+=4;else if(re===e.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+re)},writeTag:function($,re){this.writeVarint($<<3|re)},realloc:function($){for(var re=this.length||16;re<this.pos+$;)re*=2;if(re!==this.length){var Te=new Uint8Array(re);Te.set(this.buf),this.buf=Te,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),Ee(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),Ee(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),Ee(this.buf,$&-1,this.pos),Ee(this.buf,Math.floor($*n),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),Ee(this.buf,$&-1,this.pos),Ee(this.buf,Math.floor($*n),this.pos+4),this.pos+=8},writeVarint:function($){if($=+$||0,$>268435455||$<0){y($,this);return}this.realloc(4),this.buf[this.pos++]=$&127|($>127?128:0),!($<=127)&&(this.buf[this.pos++]=($>>>=7)&127|($>127?128:0),!($<=127)&&(this.buf[this.pos++]=($>>>=7)&127|($>127?128:0),!($<=127)&&(this.buf[this.pos++]=$>>>7&127)))},writeSVarint:function($){this.writeVarint($<0?-$*2-1:$*2)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc($.length*4),this.pos++;var re=this.pos;this.pos=Ae(this.buf,$,this.pos);var Te=this.pos-re;Te>=128&&S(re,Te,this),this.pos=re-1,this.writeVarint(Te),this.pos+=Te},writeFloat:function($){this.realloc(4),t.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),t.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var re=$.length;this.writeVarint(re),this.realloc(re);for(var Te=0;Te<re;Te++)this.buf[this.pos++]=$[Te]},writeRawMessage:function($,re){this.pos++;var Te=this.pos;$(re,this);var Qe=this.pos-Te;Qe>=128&&S(Te,Qe,this),this.pos=Te-1,this.writeVarint(Qe),this.pos+=Qe},writeMessage:function($,re,Te){this.writeTag($,e.Bytes),this.writeRawMessage(re,Te)},writePackedVarint:function($,re){re.length&&this.writeMessage($,O,re)},writePackedSVarint:function($,re){re.length&&this.writeMessage($,k,re)},writePackedBoolean:function($,re){re.length&&this.writeMessage($,G,re)},writePackedFloat:function($,re){re.length&&this.writeMessage($,U,re)},writePackedDouble:function($,re){re.length&&this.writeMessage($,J,re)},writePackedFixed32:function($,re){re.length&&this.writeMessage($,H,re)},writePackedSFixed32:function($,re){re.length&&this.writeMessage($,K,re)},writePackedFixed64:function($,re){re.length&&this.writeMessage($,he,re)},writePackedSFixed64:function($,re){re.length&&this.writeMessage($,Y,re)},writeBytesField:function($,re){this.writeTag($,e.Bytes),this.writeBytes(re)},writeFixed32Field:function($,re){this.writeTag($,e.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function($,re){this.writeTag($,e.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function($,re){this.writeTag($,e.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function($,re){this.writeTag($,e.Fixed64),this.writeSFixed64(re)},writeVarintField:function($,re){this.writeTag($,e.Varint),this.writeVarint(re)},writeSVarintField:function($,re){this.writeTag($,e.Varint),this.writeSVarint(re)},writeStringField:function($,re){this.writeTag($,e.Bytes),this.writeString(re)},writeFloatField:function($,re){this.writeTag($,e.Fixed32),this.writeFloat(re)},writeDoubleField:function($,re){this.writeTag($,e.Fixed64),this.writeDouble(re)},writeBooleanField:function($,re){this.writeVarintField($,!!re)}};function s($,re,Te){var Qe=Te.buf,me,Le;if(Le=Qe[Te.pos++],me=(Le&112)>>4,Le<128||(Le=Qe[Te.pos++],me|=(Le&127)<<3,Le<128)||(Le=Qe[Te.pos++],me|=(Le&127)<<10,Le<128)||(Le=Qe[Te.pos++],me|=(Le&127)<<17,Le<128)||(Le=Qe[Te.pos++],me|=(Le&127)<<24,Le<128)||(Le=Qe[Te.pos++],me|=(Le&1)<<31,Le<128))return d($,me,re);throw new Error("Expected varint not more than 10 bytes")}function u($){return $.type===e.Bytes?$.readVarint()+$.pos:$.pos+1}function d($,re,Te){return Te?re*4294967296+($>>>0):(re>>>0)*4294967296+($>>>0)}function y($,re){var Te,Qe;if($>=0?(Te=$%4294967296|0,Qe=$/4294967296|0):(Te=~(-$%4294967296),Qe=~(-$/4294967296),Te^4294967295?Te=Te+1|0:(Te=0,Qe=Qe+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");re.realloc(10),x(Te,Qe,re),E(Qe,re)}function x($,re,Te){Te.buf[Te.pos++]=$&127|128,$>>>=7,Te.buf[Te.pos++]=$&127|128,$>>>=7,Te.buf[Te.pos++]=$&127|128,$>>>=7,Te.buf[Te.pos++]=$&127|128,$>>>=7,Te.buf[Te.pos]=$&127}function E($,re){var Te=($&7)<<4;re.buf[re.pos++]|=Te|(($>>>=3)?128:0),$&&(re.buf[re.pos++]=$&127|(($>>>=7)?128:0),$&&(re.buf[re.pos++]=$&127|(($>>>=7)?128:0),$&&(re.buf[re.pos++]=$&127|(($>>>=7)?128:0),$&&(re.buf[re.pos++]=$&127|(($>>>=7)?128:0),$&&(re.buf[re.pos++]=$&127)))))}function S($,re,Te){var Qe=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(Math.LN2*7));Te.realloc(Qe);for(var me=Te.pos-1;me>=$;me--)Te.buf[me+Qe]=Te.buf[me]}function O($,re){for(var Te=0;Te<$.length;Te++)re.writeVarint($[Te])}function k($,re){for(var Te=0;Te<$.length;Te++)re.writeSVarint($[Te])}function U($,re){for(var Te=0;Te<$.length;Te++)re.writeFloat($[Te])}function J($,re){for(var Te=0;Te<$.length;Te++)re.writeDouble($[Te])}function G($,re){for(var Te=0;Te<$.length;Te++)re.writeBoolean($[Te])}function H($,re){for(var Te=0;Te<$.length;Te++)re.writeFixed32($[Te])}function K($,re){for(var Te=0;Te<$.length;Te++)re.writeSFixed32($[Te])}function he($,re){for(var Te=0;Te<$.length;Te++)re.writeFixed64($[Te])}function Y($,re){for(var Te=0;Te<$.length;Te++)re.writeSFixed64($[Te])}function oe($,re){return($[re]|$[re+1]<<8|$[re+2]<<16)+$[re+3]*16777216}function Ee($,re,Te){$[Te]=re,$[Te+1]=re>>>8,$[Te+2]=re>>>16,$[Te+3]=re>>>24}function ze($,re){return($[re]|$[re+1]<<8|$[re+2]<<16)+($[re+3]<<24)}function de($,re,Te){for(var Qe="",me=re;me<Te;){var Le=$[me],Ue=null,Ye=Le>239?4:Le>223?3:Le>191?2:1;if(me+Ye>Te)break;var et,tt,ct;Ye===1?Le<128&&(Ue=Le):Ye===2?(et=$[me+1],(et&192)===128&&(Ue=(Le&31)<<6|et&63,Ue<=127&&(Ue=null))):Ye===3?(et=$[me+1],tt=$[me+2],(et&192)===128&&(tt&192)===128&&(Ue=(Le&15)<<12|(et&63)<<6|tt&63,(Ue<=2047||Ue>=55296&&Ue<=57343)&&(Ue=null))):Ye===4&&(et=$[me+1],tt=$[me+2],ct=$[me+3],(et&192)===128&&(tt&192)===128&&(ct&192)===128&&(Ue=(Le&15)<<18|(et&63)<<12|(tt&63)<<6|ct&63,(Ue<=65535||Ue>=1114112)&&(Ue=null))),Ue===null?(Ue=65533,Ye=1):Ue>65535&&(Ue-=65536,Qe+=String.fromCharCode(Ue>>>10&1023|55296),Ue=56320|Ue&1023),Qe+=String.fromCharCode(Ue),me+=Ye}return Qe}function ve($,re,Te){return o.decode($.subarray(re,Te))}function Ae($,re,Te){for(var Qe=0,me,Le;Qe<re.length;Qe++){if(me=re.charCodeAt(Qe),me>55295&&me<57344)if(Le)if(me<56320){$[Te++]=239,$[Te++]=191,$[Te++]=189,Le=me;continue}else me=Le-55296<<10|me-56320|65536,Le=null;else{me>56319||Qe+1===re.length?($[Te++]=239,$[Te++]=191,$[Te++]=189):Le=me;continue}else Le&&($[Te++]=239,$[Te++]=191,$[Te++]=189,Le=null);me<128?$[Te++]=me:(me<2048?$[Te++]=me>>6|192:(me<65536?$[Te++]=me>>12|224:($[Te++]=me>>18|240,$[Te++]=me>>12&63|128),$[Te++]=me>>6&63|128),$[Te++]=me&63|128)}return Te}return g1}var Wbe=$be();const Jbe=Kf(Wbe),Xbe="4.2.4",F8={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:Xbe,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}};({...F8});const Kbe={Point:D8,MultiPoint:qbe,LineString:O8,MultiLineString:Ybe,Polygon:L8,MultiPolygon:Zbe};function D8([t,e],[r,n],i){const o=sc(r[0],n[0],t),s=sc(r[1],n[1],e);return i.unprojectFlat([o,s])}function BC(t,e,r){return t.map(n=>D8(n,e,r))}function qbe(t,e,r){return BC(t,e,r)}function O8(t,e,r){return BC(t,e,r)}function Ybe(t,e,r){return t.map(n=>O8(n,e,r))}function L8(t,e,r){return t.map(n=>BC(n,e,r))}function Zbe(t,e,r){return t.map(n=>L8(n,e,r))}function Qbe(t,e,r){const n=r.projectFlat([e.west,e.north]),i=r.projectFlat([e.east,e.south]),o=[n,i];return{...t,coordinates:Kbe[t.type](t.coordinates,o,r)}}const e1e=["points","lines","polygons"];function t1e(t,e,r,n){for(const i of e1e){const o=t[i]&&r1e(t[i],e,r,n);if(o>=0)return o}return-1}function r1e(t,e,r,n){const i=t.featureIds.value;if(!i.length)return-1;let o=0,s=i[i.length-1]+1;if(n){const d=n1e(t,n);if(d)o=d[0],s=d[1]+1;else return-1}let u=-1;if(e in t.numericProps){const d=t.numericProps[e].value.findIndex((y,x)=>y===r&&i[x]>=o&&i[x]<s);return d>=0?t.globalFeatureIds.value[d]:-1}else e?u=YR(t.properties,d=>d[e]===r,o,s):t.fields&&(u=YR(t.fields,d=>d.id===r,o,s));return u>=0?i1e(t,u):-1}function n1e(t,e){if(!t.__layers){const r={},{properties:n}=t;for(let i=0;i<n.length;i++){const{layerName:o}=n[i];o&&(r[o]?r[o][1]=i:r[o]=[i,i])}t.__layers=r}return t.__layers[e]}function i1e(t,e){if(!t.__ids){const r=[],n=t.featureIds.value,i=t.globalFeatureIds.value;for(let o=0;o<n.length;o++)r[n[o]]=i[o];t.__ids=r}return t.__ids[e]}function YR(t,e,r,n){for(let i=r;i<n;i++)if(e(t[i],i))return i;return-1}const m1=512,s1e={...Nl.defaultProps,data:d_,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[F8],binary:!0};class EA extends Ul{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:r,context:n,changeFlags:i}){i.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:r,context:n,changeFlags:i}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==r.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,r=null;if(typeof e=="string"&&!fhe(e)){const{onDataLoad:n,fetch:i}=this.props;this.setState({data:null,tileJSON:null});try{r=await i(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}n&&n(r,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(r=e);r&&(e=r.tiles),this.setState({data:e,tileJSON:r})}_getTilesetOptions(){const e=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:n,maxZoom:i}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>n&&(e.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(i)||r.maxzoom<i)&&(e.maxZoom=r.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){const{data:r,binary:n}=this.state,{index:i,signal:o}=e,s=$f(r,e);if(!s)return Promise.reject("Invalid URL");let u=this.getLoadOptions();const{fetch:d}=this.props;return u={...u,mimeType:"application/x-protobuf",mvt:{...u?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:i},gis:n?{format:"binary"}:{}},d(s,{propName:"data",layer:this,loadOptions:u,signal:o})}renderSubLayers(e){const{x:r,y:n,z:i}=e.tile.index,o=Math.pow(2,i),s=m1/o,u=-s,d=m1*r/o,y=m1*(1-n/o),x=new An().scale([s,u,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=x,e.coordinateOrigin=[d,y,0],e.coordinateSystem=Xr.CARTESIAN,e.extensions=[...e.extensions||[],new yy]);const E=super.renderSubLayers(e);return this.state.binary&&!(E instanceof Nl)&&Wr.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),E}_updateAutoHighlight(e){const{uniqueIdProperty:r}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:i}=this.state,o=e.object;let s=null,u=null;o&&(s=_1(o,r),u=ZR(o));let{highlightColor:d}=this.props;typeof d=="function"&&(d=d(e)),(n!==s||i!==u)&&this.setState({highlightColor:d,hoveredFeatureId:s,hoveredFeatureLayerName:u})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){const r=super.getPickingInfo(e);if(this.state.binary&&r.index!==-1){const{data:n}=e.sourceLayer.props;r.object=ex(n,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=eF(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:r,hoveredFeatureLayerName:n,binary:i}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,u=e.content,d=QR(s);if(!(QR(r)||d))return-1;const x=d?s:r;return Array.isArray(u)?u.findIndex(E=>{const S=_1(E,o)===x,O=d||ZR(E)===n;return S&&O}):u&&i?t1e(u,o,x,d?"":n):-1}_pickObjects(e){const{deck:r,viewport:n}=this.context,i=n.width,o=n.height,s=n.x,u=n.y,d=[this.id];return r.pickObjects({x:s,y:u,width:i,height:o,layerIds:d,maxObjects:e})}getRenderedFeatures(e=null){const r=this._pickObjects(e),n=new Set,i=[];for(const o of r){const s=_1(o.object,this.props.uniqueIdProperty);s===void 0?i.push(o.object):n.has(s)||(n.add(s),i.push(o.object))}return i}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(n=>{n.hasOwnProperty(e)||Object.defineProperty(n,e,{get:()=>{if(!n.content)return null;if(this.state.binary&&Array.isArray(n.content)&&!n.content.length)return[];const{bbox:i}=n;if(n._contentWGS84===void 0&&hhe(i)){const o=this.state.binary?ex(n.content):n.content;n._contentWGS84=o.map(s=>eF(s,i,this.context.viewport))}return n._contentWGS84}})})}}EA.layerName="MVTLayer";EA.defaultProps=s1e;function _1(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function ZR(t){return t.properties?.layerName||null}function QR(t){return t!=null&&t!==""}function eF(t,e,r){const n={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>Qbe(t.geometry,e,r).coordinates}),n}const tF="0123456789bcdefghjkmnpqrstuvwxyz",N8={};for(let t=0;t<tF.length;t++)N8[tF.charAt(t)]=t;const o1e=-90,a1e=90,c1e=-180,l1e=180;function u1e(t){let e=!0,r=a1e,n=o1e,i=l1e,o=c1e,s,u=0;for(let d=0,y=t.length;d<y;d++){const x=t[d].toLowerCase();u=N8[x];for(let E=4;E>=0;E--){const S=u>>E&1;e?(s=(i+o)/2,S===1?o=s:i=s):(s=(r+n)/2,S===1?n=s:r=s),e=!e}}return[n,o,r,i]}function f1e(t){const[e,r,n,i]=u1e(t);return[i,n,i,e,r,e,r,n,i,n]}const h1e={getGeohash:{type:"accessor",value:t=>t.geohash}};class vy extends Hu{indexToBounds(){const{data:e,getGeohash:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(n,i)=>f1e(r(n,i))}}}vy.layerName="GeohashLayer";vy.defaultProps=h1e;const d1e=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:vy,GreatCircleLayer:Uw,H3ClusterLayer:ly,H3HexagonLayer:Zc,MVTLayer:EA,QuadkeyLayer:ny,S2Layer:ry,TerrainLayer:TC,Tile3DLayer:CC,TileLayer:Ul,TripsLayer:oy,_GeoCellLayer:Hu,_Tile2DHeader:H6,_Tileset2D:sy,_WMSLayer:kw,_getURLFromTemplate:$f},Symbol.toStringTag,{value:"Module"}));function A1e({pointCount:t,getBinId:e}){const r=new Map;for(let n=0;n<t;n++){const i=e(n);if(i===null)continue;let o=r.get(String(i));o?o.points.push(n):(o={id:i,index:r.size,points:[n]},r.set(String(i),o))}return Array.from(r.values())}function p1e({bins:t,dimensions:e,target:r}){const n=t.length*e;(!r||r.length<n)&&(r=new Float32Array(n));for(let i=0;i<t.length;i++){const{id:o}=t[i];Array.isArray(o)?r.set(o,i*e):r[i]=o}return r}const g1e=t=>t.length,k8=(t,e)=>{let r=0;for(const n of t)r+=e(n);return r},m1e=(t,e)=>t.length===0?NaN:k8(t,e)/t.length,_1e=(t,e)=>{let r=1/0;for(const n of t){const i=e(n);i<r&&(r=i)}return r},y1e=(t,e)=>{let r=-1/0;for(const n of t){const i=e(n);i>r&&(r=i)}return r},v1e={COUNT:g1e,SUM:k8,MEAN:m1e,MIN:_1e,MAX:y1e};function b1e({bins:t,getValue:e,operation:r,target:n}){(!n||n.length<t.length)&&(n=new Float32Array(t.length));let i=1/0,o=-1/0;for(let s=0;s<t.length;s++){const{points:u}=t[s];n[s]=r(u,e),n[s]<i&&(i=n[s]),n[s]>o&&(o=n[s])}return{value:n,domain:[i,o]}}function rF(t,e,r){const n={};for(const o of t.sources||[]){const s=e[o];if(s)n[o]=x1e(s);else throw new Error(`Cannot find attribute ${o}`)}const i={};return o=>{for(const s in n)i[s]=n[s](o);return t.getValue(i,o,r)}}function x1e(t){const e=t.value,{offset:r=0,stride:n,size:i}=t.getAccessor(),o=e.BYTES_PER_ELEMENT,s=r/o,u=n?n/o:i;if(i===1)return t.isConstant?()=>e[0]:y=>{const x=s+u*y;return e[x]};let d;return t.isConstant?(d=Array.from(e),()=>d):(d=new Array(i),y=>{const x=s+u*y;for(let E=0;E<i;E++)d[E]=e[x+E];return d})}class BA{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const r=this.props;if(e.binOptions&&(Ji(e.binOptions,r.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(e.customOperations)for(let n=0;n<this.channelCount;n++)!!e.customOperations[n]!=!!r.customOperations[n]&&this.setNeedsUpdate(n);e.pointCount!==void 0&&e.pointCount!==r.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...r.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(this.needsUpdate===!0){this.bins=A1e({pointCount:this.props.pointCount,getBinId:rF(this.props.getBin,this.props.attributes,this.props.binOptions)});const e=p1e({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(this.needsUpdate===!0||this.needsUpdate[e]){const r=this.props.customOperations[e]||v1e[this.props.operations[e]],{value:n,domain:i}=b1e({bins:this.bins,getValue:rF(this.props.getValue[e],this.props.attributes,void 0),operation:r,target:this.results[e]?.value});this.results[e]={value:n,domain:i,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){const r=this.bins[e];if(!r)return null;const n=new Array(this.channelCount);for(let i=0;i<n.length;i++){const o=this.results[i];n[i]=o?.value[e]}return{id:r.id,value:n,count:r.points.length,pointIndices:r.points}}}function U8(t,e,r){return t.createFramebuffer({width:e,height:r,colorAttachments:[t.createTexture({width:e,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const w1e=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,C1e={name:"binSorter",vs:w1e,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},z8=[1,2,4,8],nF=3e38,T1e={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Rm=1024;class E1e{constructor(e,r){this.binsFBO=null,this.device=e,this.model=S1e(e,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;const r=e%Rm,n=Math.floor(e/Rm),i=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(i)}setDimensions(e,r){const n=Rm,i=Math.ceil(e/n);this.binsFBO?this.binsFBO.height<i&&this.binsFBO.resize({width:n,height:i}):this.binsFBO=U8(this.device,n,i);const o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(e){const r=this.model;e.attributes&&r.setAttributes(e.attributes),e.constantAttributes&&r.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&r.setVertexCount(e.vertexCount),e.shaderModuleProps&&r.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const r=B1e(e);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(e,r){if(r===0)return;r|=z8[3];const n=this.model,i=this.binsFBO,o=e==="MAX"?-nF:e==="MIN"?nF:0,s=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:i,parameters:{viewport:[0,0,i.width,i.height],colorMask:r},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(s),s.end()}}function B1e(t){const e={...T1e};for(let r=0;r<t.length;r++){const n=t[r];n&&(e[n]+=z8[r])}return e}function S1e(t,e){let r=e.vs;e.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Ei(t,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],C1e],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:n,fs:i,topology:"point-list",disableWarnings:!0})}const I1e=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,M1e={name:"aggregatorTransform",vs:I1e,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class P1e{constructor(e,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=r.channelCount,this.transform=R1e(e,r),this.domainFBO=U8(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(e);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,r){const{model:n,transformFeedback:i}=this.transform;n.setVertexCount(e);const o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:o});const s=e*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<s)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:s}),i.setBuffer("binIds",this.binBuffer));const u=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<u)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:u}),i.setBuffer("values",this.valueBuffer))}update(e,r){if(!e)return;const n=this.transform,i=this.domainFBO,o=[0,1,2].map(d=>r[d]==="COUNT"?1:0),s=[0,1,2].map(d=>r[d]==="MEAN"?1:0),u={isCount:o,isMean:s,bins:e};n.model.shaderInputs.setProps({aggregatorTransform:u}),n.run({id:"gpu-aggregation-domain",framebuffer:i,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function R1e(t,e){const r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Vf(t,{vs:r,fs:n,topology:"point-list",modules:[M1e],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:Rm},varyings:["binIds","values"],disableWarnings:!0})}class Ea{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,r){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new E1e(e,r),this.aggregationTransform=new P1e(e,r),this.setProps(r)}getBins(){const e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){const r=this.aggregationTransform.valueBuffer;return!r||e>=this.channelCount?null:(this.results[e]?.buffer!==r&&(this.results[e]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:r}=this.props;let n;if(this.dimensions===1)n=[e+r[0][0]];else{const[[u,d],[y]]=r,x=d-u;n=[e%x+u,Math.floor(e/x)+y]}const i=this.binSorter.getBinValues(e);if(!i)return null;const o=i[3],s=[];for(let u=0;u<this.channelCount;u++){const d=this.props.operations[u];d==="COUNT"?s[u]=o:o===0?s[u]=NaN:s[u]=d==="MEAN"?i[u]/o:i[u]}return{id:n,value:s,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const r=this.props;if("binIdRange"in e&&!Ji(e.binIdRange,r.binIdRange,2)){const n=e.binIdRange;if(Wr.assert(n.length===this.dimensions),this.dimensions===1){const[[i,o]]=n;this.binCount=o-i}else{const[[i,o],[s,u]]=n;this.binCount=(o-i)*(u-s)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(e.pointCount!==void 0&&e.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(Ji(e.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const n={},i={};for(const o of Object.values(e.attributes))for(const[s,u]of Object.entries(o.getValue()))ArrayBuffer.isView(u)?i[s]=u:u&&(n[s]=u);this.binSorter.setModelProps({attributes:n,constantAttributes:i})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,r=this.needsUpdate.map((n,i)=>n?e[i]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,e);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}}let SA=class extends gs{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);const r=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();const n=this.createAggregator(r);return n.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:n,aggregatorType:r}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:r}=this.state;r.setProps({attributes:e});for(const n in e)this.onAttributeChange(n);r.update()}draw({shaderModuleProps:e}){const{aggregator:r}=this.state;r.setProps({shaderModuleProps:e}),r.preDraw()}_getAttributeManager(){return new z_(this.context.device,{id:this.props.id,stats:this.context.stats})}};SA.layerName="AggregationLayer";const by=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function G8(t,e=!1,r=Float32Array){let n;if(Number.isFinite(t[0]))n=new r(t);else{n=new r(t.length*4);let i=0;for(let o=0;o<t.length;o++){const s=t[o];n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],n[i++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let i=0;i<n.length;i++)n[i]/=255;return n}const T_={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function SC(t,e){t.setSampler({minFilter:T_[e],magFilter:T_[e]})}function IC(t,e,r="linear"){const n=G8(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:T_[r],magFilter:T_[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const F1e=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,D1e=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,O1e=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,L1e={name:"screenGrid",vs:O1e,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class V8 extends ps{getShaders(){return super.getShaders({vs:F1e,fs:D1e,modules:[na,L1e]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);const{props:r,oldProps:n,changeFlags:i}=e,o=this.state.model;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=IC(this.context.device,r.colorRange,r.colorScaleType);const s={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:s})}else n.colorScaleType!==r.colorScaleType&&SC(this.state.colorTexture,r.colorScaleType);if(n.cellMarginPixels!==r.cellMarginPixels||n.cellSizePixels!==r.cellSizePixels||i.viewportChanged){const{width:s,height:u}=this.context.viewport,{cellSizePixels:d,cellMarginPixels:y}=this.props,x=Math.max(d-y,0),E={gridSizeClipspace:[d/s*2,d/u*2],cellSizeClipspace:[x/s*2,x/u*2]};o.shaderInputs.setProps({screenGrid:E})}}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){const r=this.props.colorDomain(),n=this.state.model,i={colorDomain:r};n.shaderInputs.setProps({screenGrid:i}),n.draw(this.context.renderPass)}_getModel(){return new Ei(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new zs({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}V8.layerName="ScreenGridCellLayer";const N1e=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,k1e={name:"binOptions",vs:N1e,uniformTypes:{cellSizePixels:"f32"}},U1e={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:by,colorScaleType:"linear",getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class MC extends SA{getAggregatorType(){return this.props.gpuAggregation&&Ea.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!Ea.isSupported(this.context.device)?new BA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,i)=>{const o=this.context.viewport,s=o.project(r),u=i.cellSizePixels;return s[0]<0||s[0]>=o.width||s[1]<0||s[1]>=o.height?null:[Math.floor(s[0]/u),Math.floor(s[1]/u)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new Ea(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Ts,k1e],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{cellSizePixels:s,aggregation:u}=n;if(r||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||u!==i.aggregation||s!==i.cellSizePixels){const{width:d,height:y}=this.context.viewport,{aggregator:x}=this.state;x instanceof Ea&&x.setProps({binIdRange:[[0,Math.ceil(d/s)],[0,Math.ceil(y/s)]]}),x.setProps({pointCount:this.getNumInstances(),operations:[u],binOptions:{cellSizePixels:s}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:e}=this.state,r=this.getSubLayerClass("cells",V8),n=e.getBins(),i=e.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:n,getWeight:i}},dataComparator:(o,s)=>o.length===s.length,updateTriggers:{getBin:[n],getWeight:[i]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){const r=e.info,{index:n}=r;if(n>=0){const i=this.state.aggregator.getBin(n);let o;i&&(o={col:i.id[0],row:i.id[1],value:i.value[0],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}}MC.layerName="ScreenGridLayer";MC.defaultProps=U1e;class E_{constructor(e,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=r,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=iF(this.input,this.inputLength);this._percentile=G1e(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=iF(this.input,this.inputLength);this._ordinal=z1e(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:r,upperPercentile:n}){if(e==="quantile")return[r,n-1];if(r>0||n<100){const{domain:i}=this.getScalePercentile();let o=i[Math.floor(r)-1]??-1/0,s=i[Math.floor(n)-1]??1/0;if(e==="ordinal"){const{domain:u}=this.getScaleOrdinal();o=u.findIndex(d=>d>=o),s=u.findIndex(d=>d>s)-1,s===-2&&(s=u.length-1)}return[o,s]}return null}update(e){const r=this.props;if(e.scaleType!==r.scaleType)switch(e.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:i}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,i.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==r.scaleType||e.lowerPercentile!==r.lowerPercentile||e.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function z1e(t){const e=new Set;for(const i of t)Number.isFinite(i)&&e.add(i);const r=Array.from(e).sort(),n=new Map;for(let i=0;i<r.length;i++)n.set(r[i],i);return{attribute:{value:t.map(i=>Number.isFinite(i)?n.get(i):NaN),type:"float32",size:1},domain:r}}function G1e(t,e=100){const r=Array.from(t).filter(Number.isFinite).sort(V1e);let n=0;const i=Math.max(1,e),o=new Array(i-1);for(;++n<i;)o[n-1]=H1e(r,n/i);return{attribute:{value:t.map(s=>Number.isFinite(s)?j1e(o,s):NaN),type:"float32",size:1},domain:o}}function iF(t,e){const r=(t.stride??4)/4,n=(t.offset??0)/4;let i=t.value;if(!i){const s=t.buffer?.readSyncWebGL(0,r*4*e);s&&(i=new Float32Array(s.buffer),t.value=i)}if(r===1)return i.subarray(0,e);const o=new Float32Array(e);for(let s=0;s<e;s++)o[s]=i[s*r+n];return o}function V1e(t,e){return t-e}function H1e(t,e){const r=t.length;if(e<=0||r<2)return t[0];if(e>=1)return t[r-1];const n=(r-1)*e,i=Math.floor(n),o=t[i],s=t[i+1];return o+(s-o)*(n-i)}function j1e(t,e){let r=0,n=t.length;for(;r<n;){const i=r+n>>>1;t[i]>e?n=i:r=i+1}return r}function PC({dataBounds:t,getBinId:e,padding:r=0}){const n=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(d=>e(d)),i=Math.min(...n.map(d=>d[0]))-r,o=Math.min(...n.map(d=>d[1]))-r,s=Math.max(...n.map(d=>d[0]))+r+1,u=Math.max(...n.map(d=>d[1]))+r+1;return[[i,s],[o,u]]}const H8=Math.PI/3,xy=2*Math.sin(H8),wy=1.5,$1e=Array.from({length:6},(t,e)=>{const r=e*H8;return[Math.sin(r),-Math.cos(r)]});function y1([t,e],r){let n=Math.round(e=e/r/wy),i=Math.round(t=t/r/xy-(n&1)/2);const o=e-n;if(Math.abs(o)*3>1){const s=t-i,u=i+(t<i?-1:1)/2,d=n+(e<n?-1:1),y=t-u,x=e-d;s*s+o*o>y*y+x*x&&(i=u+(n&1?1:-1)/2,n=d)}return[i,n]}const W1e=`
const vec2 DIST = vec2(${xy}, ${wy});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function sF([t,e],r){return[(t+(e&1)/2)*r*xy,e*r*wy]}const J1e=`
const vec2 DIST = vec2(${xy}, ${wy});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,X1e=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${J1e}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,K1e=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,q1e={name:"hexagon",vs:K1e,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class j8 extends Yc{getShaders(){const e=super.getShaders();return e.modules.push(q1e),{...e,vs:X1e}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=IC(this.context.device,r.colorRange,r.colorScaleType);const o={colorRange:this.state.colorTexture};i.shaderInputs.setProps({hexagon:o})}else n.colorScaleType!==r.colorScaleType&&SC(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){const{radius:r,hexOriginCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:u,colorDomain:d,elevationDomain:y}=this.props,x=this.props.colorCutoff||[-1/0,1/0],E=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel;S.vertexArray.indexBuffer&&S.setIndexBuffer(null),S.setVertexCount(this.state.fillVertexCount);const O={colorDomain:[Math.max(d[0],x[0]),Math.min(d[1],x[1]),Math.max(d[0]-1,x[0]),Math.min(d[1]+1,x[1])],elevationDomain:[Math.max(y[0],E[0]),Math.min(y[1],E[1]),Math.max(y[0]-1,E[0]),Math.min(y[1]+1,E[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:n};S.shaderInputs.setProps({column:{extruded:s,coverage:u,radius:r},hexagon:O}),S.draw(this.context.renderPass)}}j8.layerName="HexagonCellLayer";const Y1e=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,Z1e={name:"binOptions",vs:Y1e,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function oF(){}const Q1e={gpuAggregation:!0,colorDomain:null,colorRange:by,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:oF,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:oF,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class RC extends SA{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:r,getColorValue:n,getElevationValue:i}=this.props;return e&&(r||n||i)?(Wr.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Ea.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:r,radius:n}=this.props;return new BA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(r)return r(i,n);const d=this.state.aggregatorViewport.projectPosition(i),{radiusCommon:y,hexOriginCommon:x}=s;return y1([d[0]-x[0],d[1]-x[1]],y)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new Ea(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Ts,Z1e],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${W1e}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(qc(n.data).iterable)),r||o.dataChanged||n.radius!==i.radius||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{radiusCommon:u,hexOriginCommon:d,binIdRange:y,dataAsArray:x}=this.state;if(s.setProps({binIdRange:y,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:u,hexOriginCommon:d},onUpdate:this._onAggregationUpdate.bind(this)}),x){const{getColorValue:E,getElevationValue:S}=this.props;s.setProps({customOperations:[E&&(O=>E(O.map(k=>x[k]),{indices:O,data:n.data})),S&&(O=>S(O.map(k=>x[k]),{indices:O,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),r}_updateBinOptions(){const e=this.getBounds();let r=1,n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:u}=this.props,{unitsPerMeter:d}=o.getDistanceScales(s);r=d[0]*u;const y=y1(o.projectFlat(s),r);s=o.unprojectFlat(sF(y,r));const x=o.constructor;o=o.isGeospatial?new x({longitude:s[0],latitude:s[1],zoom:12}):new Ol({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=PC({dataBounds:e,getBinId:E=>{const S=o.projectFlat(E);return S[0]-=n[0],S[1]-=n[1],y1(S,r)},padding:1})}this.setState({radiusCommon:r,hexOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new E_(i,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new E_(i,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:i,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{radiusCommon:n,hexOriginCommon:i}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:e,radiusCommon:r,hexOriginCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:u,coverage:d,material:y,transitions:x,colorScaleType:E,lowerPercentile:S,upperPercentile:O,colorDomain:k,elevationScaleType:U,elevationLowerPercentile:J,elevationUpperPercentile:G,elevationDomain:H}=this.props,K=this.getSubLayerClass("cells",j8),he=e.getBins(),Y=this.state.colors?.update({scaleType:E,lowerPercentile:S,upperPercentile:O}),oe=this.state.elevations?.update({scaleType:U,lowerPercentile:J,upperPercentile:G});return!Y||!oe?null:new K(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:he,getColorValue:Y.attribute,getElevationValue:oe.attribute}},dataComparator:(Ee,ze)=>Ee.length===ze.length,updateTriggers:{getBin:[he],getColorValue:[Y.attribute],getElevationValue:[oe.attribute]},diskResolution:6,vertices:$1e,radius:r,hexOriginCommon:n,elevationScale:i,colorRange:o,colorScaleType:E,elevationRange:s,extruded:u,coverage:d,material:y,colorDomain:Y.domain||k||e.getResultDomain(0),elevationDomain:oe.domain||H||e.getResultDomain(1),colorCutoff:Y.cutoff,elevationCutoff:oe.cutoff,transitions:x&&{getFillColor:x.getColorValue||x.getColorWeight,getElevation:x.getElevationValue||x.getElevationWeight},extensions:[]})}getPickingInfo(e){const r=e.info,{index:n}=r;if(n>=0){const i=this.state.aggregator.getBin(n);let o;if(i){const s=sF(i.id,this.state.radiusCommon),u=this.context.viewport.unprojectFlat(s);o={col:i.id[0],row:i.id[1],position:u,colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(d=>this.props.data[d]):[])}r.object=o}return r}}RC.layerName="HexagonLayer";RC.defaultProps=Q1e;const ir=.5,yr=1/6,vt={N:[0,ir],E:[ir,0],S:[0,-ir],W:[-ir,0],NE:[ir,ir],NW:[-ir,ir],SE:[ir,-ir],SW:[-ir,-ir]},_d=[vt.W,vt.SW,vt.S],yd=[vt.S,vt.SE,vt.E],vd=[vt.E,vt.NE,vt.N],bd=[vt.NW,vt.W,vt.N],xd=[[-ir,yr],[-ir,-yr],[-yr,-ir],[yr,-ir]],wd=[[-yr,-ir],[yr,-ir],[ir,-yr],[ir,yr]],Cd=[[ir,-yr],[ir,yr],[yr,ir],[-yr,ir]],Td=[[-ir,yr],[-ir,-yr],[yr,ir],[-yr,ir]],aF=[vt.W,vt.SW,vt.SE,vt.E],cF=[vt.S,vt.SE,vt.NE,vt.N],lF=[vt.NW,vt.W,vt.E,vt.NE],uF=[vt.NW,vt.SW,vt.S,vt.N],fF=[[-ir,yr],[-ir,-yr],[ir,-yr],[ir,yr]],hF=[[-yr,-ir],[yr,-ir],[yr,ir],[-yr,ir]],e2e=[vt.NW,vt.SW,vt.SE,vt.NE],dF=[vt.NW,vt.SW,vt.SE,vt.E,vt.N],AF=[vt.W,vt.SW,vt.SE,vt.NE,vt.N],pF=[vt.NW,vt.W,vt.S,vt.SE,vt.NE],gF=[vt.NW,vt.SW,vt.S,vt.E,vt.NE],mF=[vt.NW,vt.W,[ir,-yr],[ir,yr],vt.N],_F=[[-yr,-ir],[yr,-ir],vt.E,vt.NE,vt.N],yF=[[-ir,yr],[-ir,-yr],vt.S,vt.SE,vt.E],vF=[vt.W,vt.SW,vt.S,[yr,ir],[-yr,ir]],bF=[vt.NW,vt.W,[-yr,-ir],[yr,-ir],vt.N],xF=[[-ir,yr],[-ir,-yr],vt.E,vt.NE,vt.N],wF=[vt.S,vt.SE,vt.E,[yr,ir],[-yr,ir]],CF=[vt.W,vt.SW,vt.S,[ir,-yr],[ir,yr]],TF=[vt.W,vt.SW,vt.SE,vt.E,[yr,ir],[-yr,ir]],EF=[[-ir,yr],[-ir,-yr],vt.S,vt.SE,vt.NE,vt.N],BF=[vt.NW,vt.W,[-yr,-ir],[yr,-ir],vt.E,vt.NE],SF=[vt.NW,vt.SW,vt.S,[ir,-yr],[ir,yr],vt.N],Ed=[vt.W,vt.SW,vt.S,vt.E,vt.NE,vt.N],Bd=[vt.NW,vt.W,vt.S,vt.SE,vt.E,vt.N],rm=[[-ir,yr],[-ir,-yr],[-yr,-ir],[yr,-ir],vt.E,vt.NE,vt.N],nm=[vt.W,vt.SW,vt.S,[ir,-yr],[ir,yr],[yr,ir],[-yr,ir]],im=[vt.NW,vt.W,[-yr,-ir],[yr,-ir],[ir,-yr],[ir,yr],vt.N],sm=[[-ir,yr],[-ir,-yr],vt.S,vt.SE,vt.E,[yr,ir],[-yr,ir]],IF=[[-ir,yr],[-ir,-yr],[-yr,-ir],[yr,-ir],[ir,-yr],[ir,yr],[yr,ir],[-yr,ir]],t2e={0:[],1:[[vt.W,vt.S]],2:[[vt.S,vt.E]],3:[[vt.W,vt.E]],4:[[vt.N,vt.E]],5:{0:[[vt.W,vt.S],[vt.N,vt.E]],1:[[vt.W,vt.N],[vt.S,vt.E]]},6:[[vt.N,vt.S]],7:[[vt.W,vt.N]],8:[[vt.W,vt.N]],9:[[vt.N,vt.S]],10:{0:[[vt.W,vt.N],[vt.S,vt.E]],1:[[vt.W,vt.S],[vt.N,vt.E]]},11:[[vt.N,vt.E]],12:[[vt.W,vt.E]],13:[[vt.S,vt.E]],14:[[vt.W,vt.S]],15:[]};function ar(t){return parseInt(t,4)}const r2e={[ar("0000")]:[],[ar("2222")]:[],[ar("2221")]:[_d],[ar("2212")]:[yd],[ar("2122")]:[vd],[ar("1222")]:[bd],[ar("0001")]:[_d],[ar("0010")]:[yd],[ar("0100")]:[vd],[ar("1000")]:[bd],[ar("2220")]:[xd],[ar("2202")]:[wd],[ar("2022")]:[Cd],[ar("0222")]:[Td],[ar("0002")]:[xd],[ar("0020")]:[wd],[ar("0200")]:[Cd],[ar("2000")]:[Td],[ar("0011")]:[aF],[ar("0110")]:[cF],[ar("1100")]:[lF],[ar("1001")]:[uF],[ar("2211")]:[aF],[ar("2112")]:[cF],[ar("1122")]:[lF],[ar("1221")]:[uF],[ar("2200")]:[fF],[ar("2002")]:[hF],[ar("0022")]:[fF],[ar("0220")]:[hF],[ar("1111")]:[e2e],[ar("1211")]:[dF],[ar("2111")]:[AF],[ar("1112")]:[pF],[ar("1121")]:[gF],[ar("1011")]:[dF],[ar("0111")]:[AF],[ar("1110")]:[pF],[ar("1101")]:[gF],[ar("1200")]:[mF],[ar("0120")]:[_F],[ar("0012")]:[yF],[ar("2001")]:[vF],[ar("1022")]:[mF],[ar("2102")]:[_F],[ar("2210")]:[yF],[ar("0221")]:[vF],[ar("1002")]:[bF],[ar("2100")]:[xF],[ar("0210")]:[wF],[ar("0021")]:[CF],[ar("1220")]:[bF],[ar("0122")]:[xF],[ar("2012")]:[wF],[ar("2201")]:[CF],[ar("0211")]:[TF],[ar("2110")]:[EF],[ar("1102")]:[BF],[ar("1021")]:[SF],[ar("2011")]:[TF],[ar("0112")]:[EF],[ar("1120")]:[BF],[ar("1201")]:[SF],[ar("2101")]:[Ed],[ar("0121")]:[Ed],[ar("1012")]:[Bd],[ar("1210")]:[Bd],[ar("0101")]:{0:[_d,vd],1:[Ed],2:[Ed]},[ar("1010")]:{0:[bd,yd],1:[Bd],2:[Bd]},[ar("2121")]:{0:[Ed],1:[Ed],2:[_d,vd]},[ar("1212")]:{0:[Bd],1:[Bd],2:[bd,yd]},[ar("2120")]:{0:[rm],1:[rm],2:[xd,vd]},[ar("2021")]:{0:[nm],1:[nm],2:[_d,Cd]},[ar("1202")]:{0:[im],1:[im],2:[bd,wd]},[ar("0212")]:{0:[sm],1:[sm],2:[yd,Td]},[ar("0102")]:{0:[xd,vd],1:[rm],2:[rm]},[ar("0201")]:{0:[_d,Cd],1:[nm],2:[nm]},[ar("1020")]:{0:[bd,wd],1:[im],2:[im]},[ar("2010")]:{0:[yd,Td],1:[sm],2:[sm]},[ar("2020")]:{0:[Td,wd],1:[IF],2:[xd,Cd]},[ar("0202")]:{0:[Cd,xd],1:[IF],2:[Td,wd]}};function yp(t,e){return Number.isNaN(t)?0:Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function n2e(t){const{x:e,y:r,xRange:n,yRange:i,getValue:o,threshold:s}=t,u=e<n[0],d=e>=n[1]-1,y=r<i[0],x=r>=i[1]-1,E=u||d||y||x;let S=0,O,k,U,J;if(u||x)U=0;else{const K=o(e,r+1);U=yp(K,s),S+=K}if(d||x)J=0;else{const K=o(e+1,r+1);J=yp(K,s),S+=K}if(d||y)k=0;else{const K=o(e+1,r);k=yp(K,s),S+=K}if(u||y)O=0;else{const K=o(e,r);O=yp(K,s),S+=K}let G=-1;Number.isFinite(s)&&(G=U<<3|J<<2|k<<1|O),Array.isArray(s)&&(G=U<<6|J<<4|k<<2|O);let H=0;return E||(H=yp(S/4,s)),{code:G,meanCode:H}}function i2e(t){const{x:e,y:r,z:n,code:i,meanCode:o}=t;let s=r2e[i];Array.isArray(s)||(s=s[o]);const u=e+1,d=r+1,y=[];return s.forEach(x=>{const E=[];x.forEach(S=>{const O=u+S[0],k=d+S[1];E.push([O,k,n])}),y.push(E)}),y}function s2e(t){const{x:e,y:r,z:n,code:i,meanCode:o}=t;let s=t2e[i];Array.isArray(s)||(s=s[o]);const u=e+1,d=r+1,y=[];return s.forEach(x=>{x.forEach(E=>{const S=u+E[0],O=d+E[1];y.push([S,O,n])})}),y}function o2e({contours:t,getValue:e,xRange:r,yRange:n}){const i=[],o=[];let s=0,u=0;for(let d=0;d<t.length;d++){const y=t[d],x=y.zIndex??d,{threshold:E}=y;for(let S=r[0]-1;S<r[1];S++)for(let O=n[0]-1;O<n[1];O++){const{code:k,meanCode:U}=n2e({getValue:e,threshold:E,x:S,y:O,xRange:r,yRange:n}),J={x:S,y:O,z:x,code:k,meanCode:U};if(Array.isArray(E)){const G=i2e(J);for(const H of G)o[u++]={vertices:H,contour:y}}else{const G=s2e(J);G.length>0&&(i[s++]={vertices:G,contour:y})}}}return{lines:i,polygons:o}}function a2e(t){const{aggregator:e,binIdRange:r,channel:n}=t;if(e instanceof Ea){const i=e.getResult(n)?.buffer;if(i){const o=new Float32Array(i.readSyncWebGL().buffer);return c2e(o,r)}}if(e instanceof BA){const i=e.getResult(n)?.value,o=e.getBins()?.value;if(o&&i)return l2e(i,o,e.binCount)}return null}function c2e(t,e){const[[r,n],[i,o]]=e,s=n-r,u=o-i;return(d,y)=>(d-=r,y-=i,d<0||d>=s||y<0||y>=u?NaN:t[y*s+d])}function l2e(t,e,r){const n={};for(let i=0;i<r;i++){const o=e[i*2],s=e[i*2+1];n[o]=n[o]||{},n[o][s]=t[i]}return(i,o)=>n[i]?.[o]??NaN}const u2e=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,f2e={name:"binOptions",vs:u2e,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},MF=[255,255,255,255],h2e=1,d2e={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let FC=class extends SA{getAggregatorType(){return this.props.gpuAggregation&&Ea.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new BA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,i)=>{const s=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:u,cellOriginCommon:d}=i;return[Math.floor((s[0]-d[0])/u[0]),Math.floor((s[1]-d[1])/u[1])]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}],onUpdate:this._onAggregationUpdate.bind(this)}):new Ea(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Ts,f2e],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if(r||o.dataChanged||n.cellSize!==i.cellSize||!Ji(n.gridOrigin,i.gridOrigin,1)||n.aggregation!==i.aggregation){this._updateBinOptions();const{cellSizeCommon:u,cellOriginCommon:d,binIdRange:y}=this.state;s.setProps({binIdRange:y,pointCount:this.getNumInstances(),operations:[n.aggregation],binOptions:{cellSizeCommon:u,cellOriginCommon:d}})}return Ji(i.contours,n.contours,2)||this.setState({contourData:null}),r}_updateBinOptions(){const e=this.getBounds(),r=[1,1];let n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:u,gridOrigin:d}=this.props,{unitsPerMeter:y}=o.getDistanceScales(s);r[0]=y[0]*u,r[1]=y[1]*u;const x=o.projectFlat(s);n=[Math.floor((x[0]-d[0])/r[0])*r[0]+d[0],Math.floor((x[1]-d[1])/r[1])*r[1]+d[1]],s=o.unprojectFlat(n);const E=o.constructor;o=o.isGeospatial?new E({longitude:s[0],latitude:s[1],zoom:12}):new Ol({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=PC({dataBounds:e,getBinId:S=>{const O=o.projectFlat(S);return[Math.floor((O[0]-n[0])/r[0]),Math.floor((O[1]-n[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){const{aggregator:e,binIdRange:r}=this.state;this.setState({aggregatedValueReader:a2e({aggregator:e,binIdRange:r,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){const{binIdRange:r}=this.state,{contours:n}=this.props,i=o2e({contours:n,getValue:e,xRange:r[0],yRange:r[1]});this.state.contourData=i}return this.state.contourData}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"counts":r.setNeedsUpdate(0);break}}renderLayers(){const e=this._getContours();if(!e)return null;const{lines:r,polygons:n}=e,{zOffset:i}=this.props,{cellOriginCommon:o,cellSizeCommon:s}=this.state,u=this.getSubLayerClass("lines",zu),d=this.getSubLayerClass("bands",Gu),y=new An().translate([o[0],o[1],0]).scale([s[0],s[1],i]),x=r&&r.length>0&&new u(this.getSubLayerProps({id:"lines"}),{data:r,coordinateSystem:Xr.CARTESIAN,modelMatrix:y,getPath:S=>S.vertices,getColor:S=>S.contour.color??MF,getWidth:S=>S.contour.strokeWidth??h2e,widthUnits:"pixels"}),E=n&&n.length>0&&new d(this.getSubLayerProps({id:"bands"}),{data:n,coordinateSystem:Xr.CARTESIAN,modelMatrix:y,getPolygon:S=>S.vertices,getFillColor:S=>S.contour.color??MF});return[x,E]}getPickingInfo(e){const r=e.info,{object:n}=r;return n&&(r.object={contour:n.contour}),r}};FC.layerName="ContourLayer";FC.defaultProps=d2e;const A2e=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,p2e=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,g2e={name:"grid",vs:p2e,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class $8 extends Yc{getShaders(){const e=super.getShaders();return e.modules.push(g2e),{...e,vs:A2e}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);const{props:r,oldProps:n}=e,i=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=IC(this.context.device,r.colorRange,r.colorScaleType);const o={colorRange:this.state.colorTexture};i.shaderInputs.setProps({grid:o})}else n.colorScaleType!==r.colorScaleType&&SC(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}_updateGeometry(){const e=new oL;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{cellOriginCommon:r,cellSizeCommon:n,elevationRange:i,elevationScale:o,extruded:s,coverage:u,colorDomain:d,elevationDomain:y}=this.props,x=this.props.colorCutoff||[-1/0,1/0],E=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel,O={colorDomain:[Math.max(d[0],x[0]),Math.min(d[1],x[1]),Math.max(d[0]-1,x[0]),Math.min(d[1]+1,x[1])],elevationDomain:[Math.max(y[0],E[0]),Math.min(y[1],E[1]),Math.max(y[0]-1,E[0]),Math.min(y[1]+1,E[1])],elevationRange:[i[0]*o,i[1]*o],originCommon:r,sizeCommon:n};S.shaderInputs.setProps({column:{extruded:s,coverage:u},grid:O}),S.draw(this.context.renderPass)}}$8.layerName="GridCellLayer";const m2e=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,_2e={name:"binOptions",vs:m2e,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function PF(){}const y2e={gpuAggregation:!0,colorDomain:null,colorRange:by,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:PF,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:PF,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class DC extends SA{getAggregatorType(){const{gpuAggregation:e,gridAggregator:r,getColorValue:n,getElevationValue:i}=this.props;return e&&(r||n||i)?(Wr.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Ea.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{gridAggregator:r,cellSize:n}=this.props;return new BA({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},o,s)=>{if(r)return r(i,n);const d=this.state.aggregatorViewport.projectPosition(i),{cellSizeCommon:y,cellOriginCommon:x}=s;return[Math.floor((d[0]-x[0])/y[0]),Math.floor((d[1]-x[1])/y[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:i})=>i},{sources:["elevationWeights"],getValue:({elevationWeights:i})=>i}]})}return new Ea(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Ts,_2e],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const r=super.updateState(e),{props:n,oldProps:i,changeFlags:o}=e,{aggregator:s}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(qc(n.data).iterable)),r||o.dataChanged||n.cellSize!==i.cellSize||n.getColorValue!==i.getColorValue||n.getElevationValue!==i.getElevationValue||n.colorAggregation!==i.colorAggregation||n.elevationAggregation!==i.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:u,cellOriginCommon:d,binIdRange:y,dataAsArray:x}=this.state;if(s.setProps({binIdRange:y,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:u,cellOriginCommon:d},onUpdate:this._onAggregationUpdate.bind(this)}),x){const{getColorValue:E,getElevationValue:S}=this.props;s.setProps({customOperations:[E&&(O=>E(O.map(k=>x[k]),{indices:O,data:n.data})),S&&(O=>S(O.map(k=>x[k]),{indices:O,data:n.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&s.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&s.setNeedsUpdate(1),r}_updateBinOptions(){const e=this.getBounds(),r=[1,1];let n=[0,0],i=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:u}=this.props,{unitsPerMeter:d}=o.getDistanceScales(s);r[0]=d[0]*u,r[1]=d[1]*u;const y=o.projectFlat(s);n=[Math.floor(y[0]/r[0])*r[0],Math.floor(y[1]/r[1])*r[1]],s=o.unprojectFlat(n);const x=o.constructor;o=o.isGeospatial?new x({longitude:s[0],latitude:s[1],zoom:12}):new Ol({position:[s[0],s[1],0],zoom:12}),n=[Math.fround(o.center[0]),Math.fround(o.center[1])],i=PC({dataBounds:e,getBinId:E=>{const S=o.projectFlat(E);return[Math.floor((S[0]-n[0])/r[0]),Math.floor((S[1]-n[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:n,binIdRange:i,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const i=n.getResult(0);this.setState({colors:new E_(i,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const i=n.getResult(1);this.setState({elevations:new E_(i,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:i,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{cellSizeCommon:n,cellOriginCommon:i}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:e,cellOriginCommon:r,cellSizeCommon:n}=this.state,{elevationScale:i,colorRange:o,elevationRange:s,extruded:u,coverage:d,material:y,transitions:x,colorScaleType:E,lowerPercentile:S,upperPercentile:O,colorDomain:k,elevationScaleType:U,elevationLowerPercentile:J,elevationUpperPercentile:G,elevationDomain:H}=this.props,K=this.getSubLayerClass("cells",$8),he=e.getBins(),Y=this.state.colors?.update({scaleType:E,lowerPercentile:S,upperPercentile:O}),oe=this.state.elevations?.update({scaleType:U,lowerPercentile:J,upperPercentile:G});return!Y||!oe?null:new K(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:he,getColorValue:Y.attribute,getElevationValue:oe.attribute}},dataComparator:(Ee,ze)=>Ee.length===ze.length,updateTriggers:{getBin:[he],getColorValue:[Y.attribute],getElevationValue:[oe.attribute]},cellOriginCommon:r,cellSizeCommon:n,elevationScale:i,colorRange:o,colorScaleType:E,elevationRange:s,extruded:u,coverage:d,material:y,colorDomain:Y.domain||k||e.getResultDomain(0),elevationDomain:oe.domain||H||e.getResultDomain(1),colorCutoff:Y.cutoff,elevationCutoff:oe.cutoff,transitions:x&&{getFillColor:x.getColorValue||x.getColorWeight,getElevation:x.getElevationValue||x.getElevationWeight},extensions:[]})}getPickingInfo(e){const r=e.info,{index:n}=r;if(n>=0){const i=this.state.aggregator.getBin(n);let o;i&&(o={col:i.id[0],row:i.id[1],colorValue:i.value[0],elevationValue:i.value[1],count:i.count},i.pointIndices&&(o.pointIndices=i.pointIndices,o.points=Array.isArray(this.props.data)?i.pointIndices.map(s=>this.props.data[s]):[])),r.object=o}return r}}DC.layerName="GridLayer";DC.defaultProps=y2e;function v2e(t){const e=t.map(u=>u[0]),r=t.map(u=>u[1]),n=Math.min.apply(null,e),i=Math.max.apply(null,e),o=Math.min.apply(null,r),s=Math.max.apply(null,r);return[n,o,i,s]}function b2e(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}const RF=new Float32Array(12);function FF(t,e=2){let r=0;for(const n of t)for(let i=0;i<e;i++)RF[r++]=n[i]||0;return RF}function x2e(t,e,r){const[n,i,o,s]=t,u=o-n,d=s-i;let y=u,x=d;u/d<e/r?y=e/r*d:x=r/e*u,y<e&&(y=e,x=r);const E=(o+n)/2,S=(s+i)/2;return[E-y/2,S-x/2,E+y/2,S+x/2]}function w2e(t,e){const[r,n,i,o]=e;return[(t[0]-r)/(i-r),(t[1]-n)/(o-n)]}const C2e=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,T2e=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,DF=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,E2e={name:"triangle",vs:DF,fs:DF,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class W8 extends ps{getShaders(){return super.getShaders({vs:C2e,fs:T2e,modules:[Ts,E2e]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:r,data:n}=this.props;return new Ei(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){const{model:e}=this.state,{aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:u,weightsTexture:d}=this.props,y={aggregationMode:r,colorDomain:n,intensity:i,threshold:o,colorTexture:s,maxTexture:u,weightsTexture:d};e.shaderInputs.setProps({triangle:y}),e.draw(this.context.renderPass)}}W8.layerName="TriangleLayer";function B2e(t,e){const r={};for(const n in t)e.includes(n)||(r[n]=t[n]);return r}class J8 extends gs{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:B2e(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:r}=e;if(r.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:r,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:r,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,r={}){const{props:n,oldProps:i,changeFlags:o}=e,{compareAll:s=!1,dimension:u}=r,{ignoreProps:d}=this.state,{props:y,accessors:x=[]}=u,{updateTriggersChanged:E}=o;if(o.dataChanged)return!0;if(E){if(E.all)return!0;for(const S of x)if(E[S])return!0}if(s)return o.extensionsChanged?!0:Zx({oldProps:i,newProps:n,ignoreProps:d,propTypes:this.constructor._propTypes});for(const S of y)if(n[S]!==i[S])return!0;return!1}isAttributeChanged(e){const{changedAttributes:r}=this.state;return e?r&&r[e]!==void 0:!S2e(r)}_getAttributeManager(){return new z_(this.context.device,{id:this.props.id,stats:this.context.stats})}}J8.layerName="AggregationLayer";function S2e(t){let e=!0;for(const r in t){e=!1;break}return e}const OF=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,LF=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,I2e=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,M2e=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,P2e=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,R2e={name:"weight",vs:P2e,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},F2e={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},D2e=2,v1={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},NF=[0,0],O2e={SUM:0,MEAN:1},L2e={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:by,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},N2e=["float32-renderable-webgl","texture-blend-float-webgl"],k2e={data:{props:["radiusPixels"]}};class OC extends J8{getShaders(e){let r=[Ts];return e.modules&&(r=[...r,...e.modules]),super.getShaders({...e,modules:r})}initializeState(){super.initializeAggregationLayer(k2e),this.setState({colorDomain:NF}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:r,oldProps:n}=e,i=this._getChangeFlags(e);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:r,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:o,colorDomain:s}=this.state,{updateTriggers:u,intensity:d,threshold:y,aggregation:x}=this.props,E=this.getSubLayerClass("triangle",W8);return new E(this.getSubLayerProps({id:"triangle-layer",updateTriggers:u}),{coordinateSystem:Xr.DEFAULT,data:{attributes:{positions:r,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:o,aggregationMode:O2e[x]||0,weightsTexture:e,intensity:d,threshold:y,colorDomain:s})}finalizeState(e){super.finalizeState(e);const{weightsTransform:r,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:o,triPositionBuffer:s,triTexCoordBuffer:u,colorTexture:d,updateTimer:y}=this.state;r?.destroy(),n?.destroy(),i?.destroy(),o?.destroy(),s?.destroy(),u?.destroy(),d?.destroy(),y&&clearTimeout(y)}_getAttributeManager(){return new z_(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const r={},{dimensions:n}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",r.viewportChanged=e.changeFlags.viewportChanged;const{zoom:i}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==i)&&(r.viewportZoomChanged=!0),r}_createTextures(){const{textureSize:e,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...v1,width:e,height:e,format:r}),maxWeightsTexture:this.context.device.createTexture({...v1,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:r}=this.props,n=Math.min(r,e.limits.maxTextureDimension2D),i=N2e.every(u=>e.features.has(u)),o=i?"rgba32float":"rgba8unorm",s=i?1:1/255;this.setState({textureSize:n,format:o,weightsScale:s}),i||Wr.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:r}=this.state;const{weightsTexture:n}=this.state,i=this.getAttributeManager();r?.destroy(),r=new _S(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:i.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,R2e]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:r,weightsTexture:n,maxWeightsTexture:i}=this.state,o=this.getShaders({vs:OF,fs:LF});this._createWeightsTransform(o);const s=this.getShaders({vs:I2e,fs:M2e,modules:[F2e]}),u=new _S(e,{id:`${this.id}-max-weights-transform`,targetTexture:i,...s,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),d={inTexture:n,textureSize:r};u.model.shaderInputs.setProps({maxWeight:d}),this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:u,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:OF,fs:LF,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:r}=this.context,n=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(u=>u.map(Math.fround)),i=v2e(n),o={visibleWorldBounds:i,viewportCorners:n};let s=!1;if(e||!this.state.worldBounds||!b2e(this.state.worldBounds,i)){const u=this._worldToCommonBounds(i),d=this._commonToWorldBounds(u);this.props.coordinateSystem===Xr.LNGLAT&&(d[1]=Math.max(d[1],-85.051129),d[3]=Math.min(d[3],85.051129),d[0]=Math.max(d[0],-360),d[2]=Math.min(d[2],360));const y=this._worldToCommonBounds(d);o.worldBounds=d,o.normalizedCommonBounds=y,s=!0}return this.setState(o),s}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:r,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:o}=this.context;e.write(FF(i,3));const s=i.map(u=>w2e(o.projectPosition(u),n));r.write(FF(s,2))}_updateColorTexture(e){const{colorRange:r}=e.props;let{colorTexture:n}=this.state;const i=G8(r,!1,Uint8Array);n&&n?.width===r.length?n.setTexture2DData({data:i}):(n?.destroy(),n=this.context.device.createTexture({...v1,data:i,width:r.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:r,aggregation:n}=this.props,{worldBounds:i,textureSize:o,weightsScale:s,weightsTexture:u}=this.state,d=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const y=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(r&&n==="SUM"){const{viewport:K}=this.context,he=K.distanceScales.metersPerUnit[2]*(y[2]-y[0])/o;this.state.colorDomain=r.map(Y=>Y*he*s)}else this.state.colorDomain=r||NF;const E=this.getAttributeManager().getAttributes(),S=this.getModuleSettings();this._setModelAttributes(d.model,E),d.model.setVertexCount(this.getNumInstances());const O={radiusPixels:e,commonBounds:y,textureWidth:o,weightsScale:s,weightsTexture:u},{viewport:k,devicePixelRatio:U,coordinateSystem:J,coordinateOrigin:G}=S,{modelMatrix:H}=this.props;d.model.shaderInputs.setProps({project:{viewport:k,devicePixelRatio:U,modelMatrix:H,coordinateSystem:J,coordinateOrigin:G},weight:O}),d.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:r}=this.state;const{debounceTimeout:n}=this.props;e?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:r})}_worldToCommonBounds(e,r={}){const{useLayerCoordinateSystem:n=!1}=r,[i,o,s,u]=e,{viewport:d}=this.context,{textureSize:y}=this.state,{coordinateSystem:x}=this.props,E=n&&(x===Xr.LNGLAT_OFFSETS||x===Xr.METER_OFFSETS),S=E?d.projectPosition(this.props.coordinateOrigin):[0,0],O=y*D2e/d.scale;let k,U;return n&&!E?(k=this.projectPosition([i,o,0]),U=this.projectPosition([s,u,0])):(k=d.projectPosition([i,o,0]),U=d.projectPosition([s,u,0])),x2e([k[0]-S[0],k[1]-S[1],U[0]-S[0],U[1]-S[1]],O,O)}_commonToWorldBounds(e){const[r,n,i,o]=e,{viewport:s}=this.context,u=s.unprojectPosition([r,n]),d=s.unprojectPosition([i,o]);return u.slice(0,2).concat(d.slice(0,2))}}OC.layerName="HeatmapLayer";OC.defaultProps=L2e;const U2e=Object.freeze(Object.defineProperty({__proto__:null,CPUAggregator:BA,ContourLayer:FC,GridLayer:DC,HeatmapLayer:OC,HexagonLayer:RC,ScreenGridLayer:MC,WebGLAggregator:Ea,_AggregationLayer:SA},Symbol.toStringTag,{value:"Module"}));var vp={},b1,kF;function z2e(){if(kF)return b1;kF=1;var t=Math.PI/180,e=180/Math.PI;function r(H){var K=i(H[0]+1,H[2]),he=i(H[0],H[2]),Y=o(H[1]+1,H[2]),oe=o(H[1],H[2]);return[he,Y,K,oe]}function n(H){var K=r(H),he={type:"Polygon",coordinates:[[[K[0],K[1]],[K[0],K[3]],[K[2],K[3]],[K[2],K[1]],[K[0],K[1]]]]};return he}function i(H,K){return H/Math.pow(2,K)*360-180}function o(H,K){var he=Math.PI-2*Math.PI*H/Math.pow(2,K);return e*Math.atan(.5*(Math.exp(he)-Math.exp(-he)))}function s(H,K,he){var Y=G(H,K,he);return Y[0]=Math.floor(Y[0]),Y[1]=Math.floor(Y[1]),Y}function u(H){return[[H[0]*2,H[1]*2,H[2]+1],[H[0]*2+1,H[1]*2,H[2]+1],[H[0]*2+1,H[1]*2+1,H[2]+1],[H[0]*2,H[1]*2+1,H[2]+1]]}function d(H){return H[0]%2===0&&H[1]%2===0?[H[0]/2,H[1]/2,H[2]-1]:H[0]%2===0&&!H[1]%2===0?[H[0]/2,(H[1]-1)/2,H[2]-1]:!H[0]%2===0&&H[1]%2===0?[(H[0]-1)/2,H[1]/2,H[2]-1]:[(H[0]-1)/2,(H[1]-1)/2,H[2]-1]}function y(H){return u(d(H))}function x(H,K){for(var he=y(H),Y=0;Y<he.length;Y++)if(!E(K,he[Y]))return!1;return!0}function E(H,K){for(var he=0;he<H.length;he++)if(S(H[he],K))return!0;return!1}function S(H,K){return H[0]===K[0]&&H[1]===K[1]&&H[2]===K[2]}function O(H){for(var K="",he=H[2];he>0;he--){var Y=0,oe=1<<he-1;(H[0]&oe)!==0&&Y++,(H[1]&oe)!==0&&(Y+=2),K+=Y.toString()}return K}function k(H){for(var K=0,he=0,Y=H.length,oe=Y;oe>0;oe--){var Ee=1<<oe-1;switch(H[Y-oe]){case"0":break;case"1":K|=Ee;break;case"2":he|=Ee;break;case"3":K|=Ee,he|=Ee;break}}return[K,he,Y]}function U(H){var K=s(H[0],H[1],32),he=s(H[2],H[3],32),Y=[K[0],K[1],he[0],he[1]],oe=J(Y);if(oe===0)return[0,0,0];var Ee=Y[0]>>>32-oe,ze=Y[1]>>>32-oe;return[Ee,ze,oe]}function J(H){for(var K=28,he=0;he<K;he++){var Y=1<<32-(he+1);if((H[0]&Y)!=(H[2]&Y)||(H[1]&Y)!=(H[3]&Y))return he}return K}function G(H,K,he){var Y=Math.sin(K*t),oe=Math.pow(2,he),Ee=oe*(H/360+.5),ze=oe*(.5-.25*Math.log((1+Y)/(1-Y))/Math.PI);return[Ee,ze,he]}return b1={tileToGeoJSON:n,tileToBBOX:r,getChildren:u,getParent:d,getSiblings:y,hasTile:E,hasSiblings:x,tilesEqual:S,tileToQuadkey:O,quadkeyToTile:k,pointToTile:s,bboxToTile:U,pointToTileFraction:G},b1}var UF;function G2e(){if(UF)return vp;UF=1;var t=z2e();vp.geojson=function(x,E){return{type:"FeatureCollection",features:r(x,E).map(e)}};function e(x){return{type:"Feature",geometry:t.tileToGeoJSON(x),properties:{}}}vp.tiles=r,vp.indexes=function(x,E){return r(x,E).map(t.tileToQuadkey)};function r(x,E){var S,O,k=x.coordinates,U=E.max_zoom,J={},G=[];if(x.type==="Point")return[t.pointToTile(k[0],k[1],U)];if(x.type==="MultiPoint")for(S=0;S<k.length;S++)O=t.pointToTile(k[S][0],k[S][1],U),J[d(O[0],O[1],O[2])]=!0;else if(x.type==="LineString")s(J,k,U);else if(x.type==="MultiLineString")for(S=0;S<k.length;S++)s(J,k[S],U);else if(x.type==="Polygon")i(J,G,k,U);else if(x.type==="MultiPolygon")for(S=0;S<k.length;S++)i(J,G,k[S],U);else throw new Error("Geometry type not implemented");if(E.min_zoom!==U){var H=G.length;for(u(J,G),S=0;S<H;S++){var K=G[S];J[d(K[0],K[1],K[2])]=!0}return n(J,G,E)}return u(J,G),G}function n(x,E,S){for(var O=[],k=S.max_zoom;k>S.min_zoom;k--){for(var U={},J=[],G=0;G<E.length;G++){var H=E[G];if(H[0]%2===0&&H[1]%2===0){var K=d(H[0]+1,H[1],k),he=d(H[0],H[1]+1,k),Y=d(H[0]+1,H[1]+1,k);if(x[K]&&x[he]&&x[Y]){x[d(H[0],H[1],H[2])]=!1,x[K]=!1,x[he]=!1,x[Y]=!1;var oe=[H[0]/2,H[1]/2,k-1];k-1===S.min_zoom?O.push(oe):(U[d(H[0]/2,H[1]/2,k-1)]=!0,J.push(oe))}}}for(G=0;G<E.length;G++)H=E[G],x[d(H[0],H[1],H[2])]&&O.push(H);x=U,E=J}return O}function i(x,E,S,O){for(var k=[],U=0;U<S.length;U++){var J=[];s(x,S[U],O,J);for(var G=0,H=J.length,K=H-1;G<H;K=G++){var he=(G+1)%H,Y=J[G][1];(Y>J[K][1]||Y>J[he][1])&&(Y<J[K][1]||Y<J[he][1])&&Y!==J[he][1]&&k.push(J[G])}}for(k.sort(o),U=0;U<k.length;U+=2){Y=k[U][1];for(var oe=k[U][0]+1;oe<k[U+1][0];oe++){var Ee=d(oe,Y,O);x[Ee]||E.push([oe,Y,O])}}}function o(x,E){return x[1]-E[1]||x[0]-E[0]}function s(x,E,S,O){for(var k,U,J=0;J<E.length-1;J++){var G=t.pointToTileFraction(E[J][0],E[J][1],S),H=t.pointToTileFraction(E[J+1][0],E[J+1][1],S),K=G[0],he=G[1],Y=H[0],oe=H[1],Ee=Y-K,ze=oe-he;if(!(ze===0&&Ee===0)){var de=Ee>0?1:-1,ve=ze>0?1:-1,Ae=Math.floor(K),$=Math.floor(he),re=Ee===0?1/0:Math.abs(((Ee>0?1:0)+Ae-K)/Ee),Te=ze===0?1/0:Math.abs(((ze>0?1:0)+$-he)/ze),Qe=Math.abs(de/Ee),me=Math.abs(ve/ze);for((Ae!==k||$!==U)&&(x[d(Ae,$,S)]=!0,O&&$!==U&&O.push([Ae,$]),k=Ae,U=$);re<1||Te<1;)re<Te?(re+=Qe,Ae+=de):(Te+=me,$+=ve),x[d(Ae,$,S)]=!0,O&&$!==U&&O.push([Ae,$]),k=Ae,U=$}}O&&$===O[0][1]&&O.pop()}function u(x,E){for(var S=Object.keys(x),O=0;O<S.length;O++)E.push(y(+S[O]))}function d(x,E,S){var O=2*(1<<S);return(O*E+x)*32+S}function y(x){var E=x%32,S=2*(1<<E),O=(x-E)/32,k=O%S,U=(O-k)/S%S;return[k,U,E]}return vp}G2e();const X8=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],K8=[0n,1n,2n,4n,8n,16n];function V2e(t){return BigInt(`0x${t}`)}function tx(t){return t.toString(16)}function H2e(t){if(t.z<0||t.z>26)throw new Error("Wrong zoom");const e=BigInt(t.z);let r=BigInt(t.x)<<32n-e,n=BigInt(t.y)<<32n-e;for(let o=0;o<5;o++){const s=K8[5-o],u=X8[4-o];r=(r|r<<s)&u,n=(n|n<<s)&u}return 0x4000000000000000n|1n<<59n|e<<52n|(r|n<<1n)>>12n|0xfffffffffffffn>>e*2n}function q8(t){const e=t>>59n&7n,r=t>>57n&3n,n=t>>52n&0x1fn,i=(t&0xfffffffffffffn)<<12n;if(e!==1n&&r!==0n)throw new Error("Wrong mode");let o=i,s=i>>1n;for(let u=0;u<6;u++){const d=K8[u],y=X8[u];o=(o|o>>d)&y,s=(s|s>>d)&y}return o=o>>32n-n,s=s>>32n-n,{z:Number(n),x:Number(o),y:Number(s)}}function LC(t){return t>>52n&0x1fn}function Y8(t){const e=LC(t)-1n;return t&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>e*2n}function Jf(t,e){Wr.assert(t,e)}function j2e(t,e){const{properties:r,numericProps:n}=t;return new Proxy(r[e]||{},{get(i,o){return o in n?n[o].value[e]:i[o]},has(i,o){return o in n||o in i},ownKeys(i){return[...Object.keys(n),...Reflect.ownKeys(i)]},getOwnPropertyDescriptor(i,o){return{enumerable:!0,configurable:!0}}})}function Cy(t,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${t}-worker.js`}const Wp=new Uint16Array,x1={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:Wp,size:1},globalFeatureIds:{value:Wp,size:1}};function Z8(){return{shape:"binary-feature-collection",points:{type:"Point",...x1},lines:{type:"LineString",pathIndices:{value:Wp,size:1},...x1},polygons:{type:"Polygon",polygonIndices:{value:Wp,size:1},primitivePolygonIndices:{value:Wp,size:1},...x1}}}function NC(t,e,r,n,i,o=2){return{type:"Point",positions:{value:new Float32Array(t),size:o},featureIds:{value:new Uint16Array(e),size:1},globalFeatureIds:{value:new Uint32Array(r),size:1},numericProps:n,properties:i}}function Q8(t,e){const r={};return e&&Object.keys(e).forEach(n=>{r[n]={value:new Float32Array(t),size:1}}),r}function ek(t,e,r,n){Object.keys(t).forEach(i=>{e[i].value[n]=t[i].value[r]})}function $2e(t,e,r,n=[],i,o){if(!t.content)return!1;t.userData||(t.userData={});const s=e.get(r)?.[0];if(s){if(n.every(d=>d.name in s))return!1;e.clear()}const u={};for(const d of t.content){let y=d.id;const x=typeof i=="function"?i(d,{}):i;for(let U=0;U<r-1;U++)y=Y8(y);const E=Number(y);if(!(E in u)){u[E]={id:y,count:0,position:[0,0]};for(const{name:U,aggregation:J}of n)J==="any"?u[E][U]=d.properties[U]:u[E][U]=0}const S=u[E].count;u[E].count+=typeof o=="function"?o(d,{}):o;const O=u[E].count,k=O-S;u[E].position[0]=(S*u[E].position[0]+k*x[0])/O,u[E].position[1]=(S*u[E].position[1]+k*x[1])/O;for(const{name:U,aggregation:J}of n){const G=u[E][U],H=d.properties[U];J==="average"?u[E][U]=(S*G+k*H)/O:J==="count"||J==="sum"?u[E][U]=G+H:J==="max"?u[E][U]=Math.max(G,H):J==="min"&&(u[E][U]=Math.min(G,H))}}return e.set(r,Object.values(u)),!0}function W2e(t){const e=[],r=["any","average","count","min","max","sum"];for(const n of Object.keys(t.content[0].properties)){let i=n.split("_").pop().toLowerCase();r.includes(i)||(Wr.warn(`No valid aggregation present in ${n} property`)(),i="any"),e.push({name:n,aggregation:i})}return e}function J2e(t,e){const r={};for(const{name:n,aggregation:i}of e)if(r[n]={min:1/0,max:-1/0},i!=="any")for(const o of t)r[n].min=Math.min(r[n].min,o[n]),r[n].max=Math.max(r[n].max,o[n]);return r}function X2e(t){const e=new Float32Array(t.length*2),r=new Uint16Array(t.length);for(let n=0;n<t.length;n++)e.set(t[n].position,2*n),r[n]=n;return{...Z8(),points:NC(e,r,r,{},t)}}const IA=512;class kC extends sy{getTileIndices(e){return super.getTileIndices(e).map(H2e).map(r=>({q:r,i:tx(r)}))}getTileId({q:e,i:r}){return r||tx(e)}getTileMetadata({q:e}){return super.getTileMetadata(q8(e))}getTileZoom({q:e}){return Number(LC(e))}getParentIndex({q:e}){return{q:Y8(e)}}}const zF=512;function tk(t){const{x:e,y:r,z:n}=q8(t),i=zF/(1<<n);return[e*i,zF-r*i,i]}function K2e(t,e){const[r,n,i]=tk(t);return[[r,n],[r+e*i,n-e*i]]}function rk(t,e=1){const[r,n]=K2e(t,e),[i,o]=Wc(r),[s,u]=Wc(n);return[s,o,s,u,i,u,i,o,s,o]}const om=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),GF=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);GF&&parseFloat(GF[1]);function q2e(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function Y2e(...t){return Z2e(t)}function Z2e(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,s)=>o+s.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function Q2e(t){const e=[];for await(const r of t)e.push(r);return Y2e(...e)}function exe(t){return t&&typeof t=="object"&&t.isBuffer}function am(t){if(exe(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function cm(t){return e=>new Promise((r,n)=>t(e,(i,o)=>i?n(i):r(o)))}class txe{constructor(e){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(e={}){q2e(e)}async compress(e){return await this.preload(),this.compressSync(e)}async decompress(e,r){return await this.preload(),this.decompressSync(e,r)}compressSync(e){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(e,r){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(e){const r=await this.concatenate(e);yield this.compress(r)}async*decompressBatches(e){const r=await this.concatenate(e);yield this.decompress(r)}concatenate(e){return Q2e(e)}improveError(e){return e.message.includes(this.name)||(e.message=`${this.name} ${e.message}`),e}}class rxe extends txe{name="deflate";extensions=[];contentEncodings=["deflate"];isSupported=!0;options;_chunks=[];constructor(e={}){super(e),this.options=e}async compress(e){if(!om&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?await cm(hu.gzip)(e):await cm(hu.deflate)(e);return am(r)}return this.compressSync(e)}async decompress(e){if(!om&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?await cm(hu.gunzip)(e):await cm(hu.inflate)(e);return am(r)}return this.decompressSync(e)}compressSync(e){if(!om&&this.options.deflate?.useZlib){const o=this.options.deflate?.gzip?hu.gzipSync(e):hu.deflateSync(e);return am(o)}const r=this.options?.deflate||{},n=new Uint8Array(e);return(this.options?.raw?md.deflateRaw:md.deflate)(n,r).buffer}decompressSync(e){if(!om&&this.options.deflate?.useZlib){const o=this.options.deflate?.gzip?hu.gunzipSync(e):hu.inflateSync(e);return am(o)}const r=this.options?.deflate||{},n=new Uint8Array(e);return(this.options?.raw?md.inflateRaw:md.inflate)(n,r).buffer}async*compressBatches(e){const r=this.options?.deflate||{},n=new md.Deflate(r);yield*this.transformBatches(n,e)}async*decompressBatches(e){const r=this.options?.deflate||{},n=new md.Inflate(r);yield*this.transformBatches(n,e)}async*transformBatches(e,r){e.onData=this._onData.bind(this),e.onEnd=this._onEnd.bind(this);for await(const o of r){const s=new Uint8Array(o);if(!e.push(s,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const n=new Uint8Array(0);e.push(n,!0),yield*this._getChunks()}_onData(e){this._chunks.push(e)}_onEnd(e){if(e!==0)throw new Error(this._getError(e)+this._chunks.length)}_getChunks(){const e=this._chunks;return this._chunks=[],e}_getError(e=0){const r={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${r[e]}`}}class nxe extends rxe{name="gzip";extensions=["gz","gzip"];contentEncodings=["gzip","x-gzip"];isSupported=!0;constructor(e){super({...e,deflate:{...e?.gzip,gzip:!0}})}}function Ty(t,e,r,n){const i=e.type===2?e.readVarint()+e.pos:e.pos+1,o=e.buf.buffer.slice(e.pos,i);if(n?.compression==="gzip"){const u=new nxe().decompressSync(o);r.value=new t(u)}else r.value=new t(o);return e.pos=i,r.value}class UC{static read(e,r){return e.readFields(UC._readField,{key:"",value:null},r)}static _readField(e,r,n){e===1?r.key=n.readString():e===2&&(r.value=n.readString())}}class ah{static read(e,r){return e.readFields(ah._readField,{},r)}static _readField(e,r,n){if(e===1){const{key:i,value:o}=UC.read(n,n.readVarint()+n.pos);r[i]=o}}}class Ig{static read(e,r){const{value:n,size:i}=e.readFields(Ig._readField,{value:[],size:0},r);return{value:n,size:i}}static _readField(e,r,n){e===1?Ty(Float64Array,n,r):e===2&&(r.size=n.readVarint(!0))}}class ba{static read(e,r){const{value:n,size:i}=e.readFields(ba._readField,{value:[],size:0},r);return{value:new Uint32Array(n),size:i}}static _readField(e,r,n){e===1?n.readPackedVarint(r.value):e===2&&(r.size=n.readVarint(!0))}}class Mg{static read(e,r){return e.readFields(Mg._readField,{id:0},r)}static _readField(e,r,n){e===1&&(r.id=n.readVarint())}}class zC{static read(e,r){return e.readFields(zC._readField,{value:[]},r)}static _readField(e,r,n){e===1&&Ty(Float64Array,n,r)}}class ch{static read(e,r){return e.readFields(ch._readField,{key:"",value:null},r)}static _readField(e,r,n){e===1?r.key=n.readString():e===2&&(r.value=zC.read(n,n.readVarint()+n.pos))}}class GC{static read(e,r){return e.readFields(GC._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,n){if(e===1)r.positions=Ig.read(n,n.readVarint()+n.pos);else if(e===2)r.globalFeatureIds=ba.read(n,n.readVarint()+n.pos);else if(e===3)r.featureIds=ba.read(n,n.readVarint()+n.pos);else if(e===4)r.properties.push(ah.read(n,n.readVarint()+n.pos));else if(e===5){const i=ch.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}else e===6&&r.fields.push(Mg.read(n,n.readVarint()+n.pos))}}class VC{static read(e,r){return e.readFields(VC._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,n){if(e===1)r.positions=Ig.read(n,n.readVarint()+n.pos);else if(e===2)r.pathIndices=ba.read(n,n.readVarint()+n.pos);else if(e===3)r.globalFeatureIds=ba.read(n,n.readVarint()+n.pos);else if(e===4)r.featureIds=ba.read(n,n.readVarint()+n.pos);else if(e===5)r.properties.push(ah.read(n,n.readVarint()+n.pos));else if(e===6){const i=ch.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}else e===7&&r.fields.push(Mg.read(n,n.readVarint()+n.pos))}}class HC{static read(e,r){return e.readFields(HC._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},r)}static _readField(e,r,n){if(e===1)r.positions=Ig.read(n,n.readVarint()+n.pos);else if(e===2)r.polygonIndices=ba.read(n,n.readVarint()+n.pos);else if(e===3)r.globalFeatureIds=ba.read(n,n.readVarint()+n.pos);else if(e===4)r.featureIds=ba.read(n,n.readVarint()+n.pos);else if(e===5)r.primitivePolygonIndices=ba.read(n,n.readVarint()+n.pos);else if(e===6)r.triangles=ba.read(n,n.readVarint()+n.pos);else if(e===7)r.properties.push(ah.read(n,n.readVarint()+n.pos));else if(e===8){const i=ch.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}else e===9&&r.fields.push(Mg.read(n,n.readVarint()+n.pos))}}let ixe=class nk{static read(e,r){return e.readFields(nk._readField,{points:null,lines:null,polygons:null},r)}static _readField(e,r,n){e===1?r.points=GC.read(n,n.readVarint()+n.pos):e===2?r.lines=VC.read(n,n.readVarint()+n.pos):e===3&&(r.polygons=HC.read(n,n.readVarint()+n.pos))}};class jC{static read(e,r){return e.readFields(jC._readField,{value:[]},r)}static _readField(e,r,n){e===1&&Ty(BigUint64Array,n,r)}}class $C{static read(e,r){return e.readFields($C._readField,{indices:null,properties:[],numericProps:{}},r)}static _readField(e,r,n){if(e===1)r.indices=jC.read(n,n.readVarint()+n.pos);else if(e===2)r.properties.push(ah.read(n,n.readVarint()+n.pos));else if(e===3){const i=ch.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}}}let sxe=class ik{static read(e,r){return e.readFields(ik._readField,{scheme:0,cells:null},r)}static _readField(e,r,n){e===1?r.scheme=n.readVarint():e===2&&(r.cells=$C.read(n,n.readVarint()+n.pos))}};function Ey(t,e){const r=new Jbe(t);return e.read(r)}function oxe(t){const{cells:e,scheme:r}=t,n=e.indices.value.length,i=[];for(let o=0;o<n;o++){const s=r==="h3"?tx(e.indices.value[o]):e.indices.value[o],u={...e.properties[o]};for(const d of Object.keys(e.numericProps))u[d]=e.numericProps[d].value[o];i.push({id:s,properties:u})}return i}const sk="9.1.13",ok="cartoSpatialTile",axe={cartoSpatialTile:{scheme:"quadbin",workerUrl:Cy(ok,sk)}},ak={name:"CARTO Spatial Tile",version:sk,id:ok,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(t,e)=>VF(t,e),parseSync:VF,worker:!0,options:axe};function VF(t,e){if(!t)return null;const r=Ey(t,sxe),{cells:n}=r,i=e?.cartoSpatialTile?.scheme;return oxe({cells:n,scheme:i})}function MA(t,e,r=0){if(!t)return e;if(!e)return t;if(r>10)return e;const n={...t};for(const i in e){const o=e[i];o===t||o===e||(typeof o=="object"&&o!==null?n[i]=MA(t[i],o,r+1):n[i]=o)}return n}function cxe(t,e){const r={};for(const{geoid:n,...i}of e.properties)n in r?Wr.warn("Duplicate geoid key in boundary mapping, using first occurance")():r[n]=i;for(const n of["points","lines","polygons"]){const i=t[n];if(i.positions.value.length===0)continue;i.properties=i.properties.map(({geoid:y})=>r[y]);const{positions:o,globalFeatureIds:s}=i;let u=null;n==="lines"&&(u=i.pathIndices.value),n==="polygons"&&(u=i.polygonIndices.value);const d=o.value.length/o.size;for(const y in e.numericProps){const x=e.numericProps[y].value,E=x.constructor,S=new E(d);if(i.numericProps[y]={value:S,size:1},u)for(let O=0;O<u.length-1;O++){const k=u[O],U=u[O+1],J=s.value[k];S.fill(x[J],k,U)}else for(let O=0;O<d;O++){const k=s.value[O];S[O]=x[k]}}}return t}const Xf={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="object"&&Array.isArray(t.tiles)&&t.tiles.every(r=>typeof r=="string"),equal:(t,e)=>Ji(t,e,2),async:!0};Ag([ak]);const ck={data:Xf,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:t})=>rk(t,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:IA};class WC extends Ul{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){const e=this.state.tileset?.tiles.filter(S=>S.isLoaded&&S.content&&this.state.tileset.isTileVisible(S));if(!e?.length)return null;e.sort((S,O)=>O.zoom-S.zoom);const{zoom:r}=this.context.viewport,{clusterLevel:n,getPosition:i,getWeight:o}=this.props,{aggregationCache:s}=this.state,u=W2e(e[0]),d=[];let y=!1;for(const S of e){const O=Math.round(r-S.zoom),k=Math.round(n)-O;let U=s.get(S.content);U||(U=new Map,s.set(S.content,U));const J=$2e(S,U,k,u,i,o);y||(y=J),d.push(...U.get(k))}d.sort((S,O)=>Number(O.count-S.count));const x=d?.map(S=>S.id);if(y||(y=!Ji(x,this.state.clusterIds,1)),this.setState({clusterIds:x}),y){const S=J2e(d,u),O=X2e(d);O.points.attributes={stats:S},this.setState({data:O})}const E={...this.props,id:"clusters",data:this.state.data,dataComparator:(S,O)=>{const k=S?.points?.properties?.map(J=>J.id),U=O?.points?.properties?.map(J=>J.id);return Ji(k,U,1)}};return new Nl(this.getSubLayerProps(E))}getPickingInfo(e){const r=e.info;if(r.index!==-1){const{data:n}=e.sourceLayer.props;r.object=ex(n,{globalFeatureId:r.index})}return r}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}filterSubLayer(){return!0}}WC.layerName="ClusterGeoJsonLayer";WC.defaultProps=ck;class JC extends gs{getLoadOptions(){const e=this.props.data;return MA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,maxresolution:n}=e;return[new WC(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:r,TilesetClass:kC,maxZoom:n,loadOptions:this.getLoadOptions()})]}}JC.layerName="ClusterTileLayer";JC.defaultProps=ck;const HF=85.051128;function lk({west:t,north:e,east:r,south:n},i,o=1){const d=[[e,r],[n,r],[n,t],[e,t]].map(E=>qw(E[0],E[1],i)).map(E=>Math.max(...sde(E).map(S=>ade(S,iA.rads)))*180/Math.PI),y=Math.max(...d)*o,x=Math.min(180,y/Math.cos((e+n)/2*Math.PI/180));return{north:Math.min(e+y,HF),east:r+x,south:Math.max(n-y,-HF),west:t-x}}function uk({west:t,north:e,east:r,south:n},i){const o=Math.abs(r-t);if(o>180){const u=Math.ceil(o/180);let d=[];for(let y=0;y<u;y++){const x=t+y*180,E=Math.min(x+179.9999999,r);d=d.concat(uk({west:x,north:e,east:E,south:n},i))}return[...new Set(d)]}return nde([[e,r],[n,r],[n,t],[e,t],[e,r]],i)}function lxe(t){const e=aN(t),r=e.map(y=>y[0]),n=e.map(y=>y[1]),i=Math.min(...n),o=Math.min(...r),s=Math.max(...n),u=Math.max(...r);return lk({west:i,south:o,east:s,north:u},p_(t),.12)}const uxe=2;function rx(t,e){const r=Math.log2(e/512),n=2/3*(t.zoom-r),i=Math.log(1/Math.cos(Math.PI*t.latitude/180));return Math.max(0,Math.floor(n+i-uxe))}class fxe extends sy{getTileIndices({viewport:e,minZoom:r,maxZoom:n}){if(e.latitude===void 0)return[];const[i,o,s,u]=e.getBounds(),{tileSize:d}=this.opts;let y=rx(e,d),x;if(typeof r=="number"&&Number.isFinite(r)&&y<r)return[];if(typeof n=="number"&&Number.isFinite(n)&&y>n){y=n;const E=qw(e.latitude,e.longitude,n);x=rde(E,1)}else{const E=lk({west:i,north:u,east:s,south:o},y);x=uk(E,y)}return x.map(E=>({i:E}))}getTileId({i:e}){return e}getTileMetadata({i:e}){return{bbox:lxe(e)}}getTileZoom({i:e}){return p_(e)}getParentIndex(e){const r=p_(e.i);return{i:tde(e.i,r-1)}}}Ag([ak]);function hxe(t){return t!=null&&t!==""}const dxe={tileSize:IA};class By extends Ul{_updateAutoHighlight(e){const{hoveredFeatureId:r}=this.state,n=e.object;let i=null;if(n&&(i=n.id),r!==i){let{highlightColor:o}=this.props;typeof o=="function"&&(o=o(e)),this.setState({highlightColor:o,hoveredFeatureId:i})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:r}=this.state,n=e.content;return!hxe(r)||!Array.isArray(n)||!this._featureInTile(e,r)?-1:n.findIndex(o=>o.id===r)}_featureInTile(e,r){const n=this.state.tileset,i=n.getTileZoom(e.index),o=e.index.q?"q":"i";let s={[o]:r},u=n.getTileZoom(s);for(;!(u<=i);)s=n.getParentIndex(s),u=n.getTileZoom(s);return s[o]===e.index[o]}}By.layerName="SpatialIndexTileLayer";By.defaultProps=dxe;const Axe=t=>{const{data:e}=t,{index:r}=t.tile;return!e||!e.length?null:new Zc(t,{getHexagon:n=>n.id,centerHexagon:r,highPrecision:!0})},pxe={data:Xf,tileSize:IA};class XC extends gs{initializeState(){Zc._checkH3Lib()}getLoadOptions(){const e=this.props.data;return MA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"h3"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r}=e;let{minresolution:n,maxresolution:i}=e;this.props.minZoom&&(n=Math.max(n,rx({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(i=Math.min(i,rx({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const o=this.getSubLayerClass("spatial-index-tile",By);return new o(this.props,{id:`h3-tile-layer-${this.props.id}`,data:r,TilesetClass:fxe,renderSubLayers:Axe,minZoom:n,maxZoom:i,loadOptions:this.getLoadOptions()})}}XC.layerName="H3TileLayer";XC.defaultProps=pxe;const gxe=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,mxe={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:t=>{if(!t)return{};const{colorDomain:e=[0,1],colorTexture:r,delta:n=[1,0],intensity:i=1,opacity:o=1,radiusPixels:s=20}=t;return{colorDomain:e,colorTexture:r,delta:n,intensity:i,opacity:o,radiusPixels:s}},fs:gxe,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},_xe={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function nx(t){for(;t.parent&&!t.applyPostProcess;)t=t.parent;return t}class fk extends ps{initializeState(){this.id=`draw-callback-${nx(this).props.id}`}_drawLayer(){nx(this).applyPostProcess()}}fk.layerName="DrawCallbackLayer";function hk(t){var e;return e=class extends t{draw(n){const{shaderModuleProps:i}=n,{picking:o}=i,s=nx(this);o.isActive||s.enableRTT(n),super.draw(n),o.isActive||s.disableRTT()}},e.layerName=`RTT-${t.layerName}`,e}function dk(t,e){var r;return r=class extends t{initializeState(i){super.initializeState(i),this._createTextures(),this.internalState.postProcess=new fJ(e,this.props),this.internalState.postProcess.setup(i)}updateState(i){super.updateState(i),this.internalState.postProcess.setProps(this.props)}renderLayers(){let i=super.renderLayers();return i?(i=Array.isArray(i)?i:[i],[...i,new fk]):null}_createTextures(){const{device:i}=this.context;this.internalState.renderBuffers=[0,1].map(o=>i.createFramebuffer({id:`layer-fbo-${o}`,colorAttachments:[i.createTexture(_xe)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(i){const{shaderModuleProps:o}=i,{viewport:s}=this.context,{devicePixelRatio:u}=o.project,d=u*s.width,y=u*s.height;this.internalState.renderBuffers.forEach(x=>x.resize({width:d,height:y}))}enableRTT(i){this._resizeBuffers(i),this.internalState.originalRenderPass=this.context.renderPass;const[o]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:o,parameters:{viewport:[0,0,o.width,o.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[i,o]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:i,swapBuffer:o,target:s}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(i=>{i.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},r.layerName=`PostProcess${t.layerName}`,r}const yxe=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,vxe={name:"copy",fs:yxe,getUniforms:()=>({}),passes:[{filter:!0}]},bxe={getQuadbin:{type:"accessor",value:t=>t.quadbin}};class KC extends Hu{indexToBounds(){const{data:e,extruded:r,getQuadbin:n}=this.props,i=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,s)=>rk(n(o,s),i),updateTriggers:{getPolygon:i}}}}KC.layerName="QuadbinLayer";KC.defaultProps=bxe;const xxe=t=>{const{data:e}=t;if(!e||!e.length)return null;const r=typeof e[0].id=="bigint";return new KC(t,{getQuadbin:r?n=>n.id:n=>V2e(n.id)})},wxe={data:Xf,tileSize:IA};class Sy extends gs{getLoadOptions(){const e=this.props.data;return MA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,maxresolution:n}=e,i=this.getSubLayerClass("spatial-index-tile",By);return new i(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:r,TilesetClass:kC,renderSubLayers:xxe,maxZoom:n,loadOptions:this.getLoadOptions()})}}Sy.layerName="QuadbinTileLayer";Sy.defaultProps=wxe;const Cxe=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],Txe={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function Ak(t){const e=Number(LC(t));return Math.pow(4,e)}function Exe(t){const e=new Uint8Array(t.length*4);let r=0;for(let n=0;n<t.length;n++){const i=t[n];e[r++]=i[0],e[r++]=i[1],e[r++]=i[2],e[r++]=Number.isFinite(i[3])?i[3]:255}return e}const Bxe=`uniform densityUniforms {
  float factor;
} density;
`,Sxe={name:"density",vs:Bxe,uniformTypes:{factor:"f32"}};class pk extends hk(Gu){getShaders(e){const r=super.getShaders(e);return r.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},r.modules=[...r.modules,Sxe],r}draw(e){const r=this.props.data[0],n=this.props.elevationScale,i={factor:Ak(r.id)/n};for(const o of this.state.models)o.shaderInputs.setProps({density:i});super.draw(e)}}pk.layerName="RTTSolidPolygonLayer";const Ixe=dk(Sy,mxe),Mxe={data:Xf,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:Cxe,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class qC extends gs{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:e}){const{viewportChanged:r}=e;return this.setState({viewportChanged:r}),e.somethingChanged}updateState(e){const{props:r,oldProps:n}=e;super.updateState(e),r.colorRange!==n.colorRange&&this._updateColorTexture(e)}renderLayers(){const{data:e,getWeight:r,colorDomain:n,intensity:i,radiusPixels:o,_subLayerProps:s,updateTriggers:u,onMaxDensityChange:d,onViewportLoad:y,onTileLoad:x,onTileUnload:E,...S}=this.props,O={...s,cell:{...s?.cell,_subLayerProps:{...s?.cell?._subLayerProps,fill:{...s?.cell?._subLayerProps?.fill,type:pk}}}};let k=0,U=0;const J=[...this.state.tiles].filter(Y=>Y.content),G=J.filter(Y=>Y.isVisible),H=G.length?G:J;for(const Y of H){const oe=Y.content[0],Ee=Ak(oe.id);U=Math.max(Y.userData.maxWeight*Ee,U),k=Math.max(Y.zoom,k)}const K=this.context.viewport.zoom-k;return U=U*Math.pow(2,K),typeof d=="function"&&d(U),new Ixe(S,this.getSubLayerProps({id:"heatmap",data:e,getFillColor:0,getElevation:r,elevationScale:U,colorDomain:n,radiusPixels:o,intensity:i,_subLayerProps:O,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:u.getWeight},onViewportLoad:Y=>{this.setState({isLoaded:!0}),typeof y=="function"&&y(Y)},onTileLoad:Y=>{let oe=-1/0;if(typeof r!="function")oe=r;else if(Y.content)for(const Ee of Y.content)oe=Math.max(r(Ee,{}),oe);Y.userData={maxWeight:oe},this.state.tiles.add(Y),typeof x=="function"&&x(Y)},onTileUnload:Y=>{this.state.tiles.delete(Y),typeof E=="function"&&E(Y)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(e){const{colorRange:r}=e.props;let{colorTexture:n}=this.state;const i=Exe(r);n&&n?.width===r.length?n.setTexture2DData({data:i}):(n?.destroy(),n=this.context.device.createTexture({...Txe,data:i,width:r.length,height:1})),this.setState({colorTexture:n})}}qC.layerName="HeatmapTileLayer";qC.defaultProps=Mxe;const[jF,$F,WF,JF]=[0,1,2,3];class gk extends xg{getShaders(){const e=super.getShaders();let r=e.vs;return r=r.replaceAll("textBackground.padding.","_padding."),r=r.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...e,vs:r}}}gk.layerName="EnhancedTextBackgroundLayer";class mk extends ih{filterSubLayer({layer:e,renderPass:r}){const n=e.id.includes("primary-background");return r==="collision"?n:!n}}mk.layerName="EnhancedTextLayer";const Pxe={...ih.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class Iy extends gs{calculatePixelOffset(e){const{getTextAnchor:r,getAlignmentBaseline:n,getRadius:i,getSecondaryText:o,radiusScale:s,secondarySizeScale:u,sizeScale:d}=this.props,y=r==="middle"?0:r==="start"?1:-1,x=n==="center"?0:n==="bottom"?1:-1,E=d/4,S=d*(1+1/4),O=.6*(1-x)*d;let k=e?O:0;r==="middle"&&n==="top"&&o&&(k-=O,k-=u,k+=d);const U=1+1/4;return typeof i=="function"?(J,G)=>{const H=(G?i(J,G):1)*s*U;return[y*(H+E),x*(H+S)+k]}:[y*(i*s*U+E),x*(i*s*U+S)+k]}calculateBackgroundPadding(){const{getTextAnchor:e,getAlignmentBaseline:r,sizeScale:n}=this.props,i=12*n,o=3*n,s=[0,0,0,0];return r==="top"?s[$F]=o:r==="bottom"?s[JF]=o:(s[$F]=.5*o,s[JF]=.5*o),e==="start"?s[jF]=i:e==="end"?s[WF]=i:(s[jF]=.5*i,s[WF]=.5*i),s}renderTextLayer(e,{updateTriggers:r={},...n}){const{data:i,characterSet:o,fontFamily:s,fontSettings:u,fontWeight:d,outlineColor:y,outlineWidth:x,sizeScale:E,radiusScale:S,getAlignmentBaseline:O,getColor:k,getPosition:U,getTextAnchor:J,updateTriggers:G}=this.props;if(E<2){const H=this.parent?.props?.textSizeScale?"textSizeScale":"sizeScale";Wr.warn(`${H} has small value (${E}). Note getTextSize is not supported on PointLabelLayer`)()}return new mk(this.getSubLayerProps({id:e,data:i,characterSet:o,fontFamily:s,fontSettings:u,fontWeight:d,outlineColor:y,outlineWidth:x,sizeScale:E,getAlignmentBaseline:O,getColor:k,getPosition:U,getTextAnchor:J,updateTriggers:{...G,...r,getPixelOffset:[G.getRadius,G.getTextAnchor,G.getAlignmentBaseline,S,E]}}),{getSize:1,_subLayerProps:{background:{type:gk}}},n)}renderLayers(){const{getText:e,getSecondaryColor:r,getSecondaryText:n,secondaryOutlineColor:i,secondarySizeScale:o,updateTriggers:s}=this.props,u=this.calculatePixelOffset(!1),d=this.calculateBackgroundPadding();return[this.renderTextLayer(`${s.getText}-primary`,{backgroundPadding:d,getText:e,getPixelOffset:u,background:!0}),!!n&&this.renderTextLayer(`${s.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...r&&{getColor:r},...o&&{sizeScale:o},...i&&{outlineColor:i}})]}}Iy.layerName="PointLabelLayer";Iy.defaultProps=Pxe;const Rxe=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
geometry.position.xy += cellCenter;
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Fxe={...Yc.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class _k extends hk(Yc){getShaders(){const e=super.getShaders(),r=this.props.data,n=r.data.blockSize??Math.sqrt(r.length);return{...e,defines:{...e.defines,BLOCK_WIDTH:n},vs:Rxe}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}_k.layerName="RasterColumnLayer";function Dxe(t,e){return t.data===e.data&&t.length===e.length}class YC extends gs{renderLayers(){const{data:e,getElevation:r,getFillColor:n,getLineColor:i,getLineWidth:o,tileIndex:s,updateTriggers:u}=this.props;if(!e||!s)return null;const d=e.blockSize??0,[y,x,E]=tk(s),S=[y,x],O=E/d,k=this.getSubLayerClass("column",_k),{highlightedObjectIndex:U,highlightColor:J}=this.state;return new k(this.props,this.getSubLayerProps({id:"cell",updateTriggers:u,getElevation:this.getSubLayerAccessor(r),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(o)}),{data:{data:e,length:d*d},dataComparator:Dxe,offset:S,lineWidthScale:O,highlightedObjectIndex:U,highlightColor:J,parameters:{blendColorSrcFactor:"one",blendAlphaSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaDstFactor:"zero",blendColorOperation:"add",blendAlphaOperation:"add"}})}getSubLayerAccessor(e){return typeof e!="function"?super.getSubLayerAccessor(e):(r,n)=>{const{data:i,index:o}=n,s=i.data,u=j2e(s.cells,o);return e({properties:u},n)}}getPickingInfo(e){const r=super.getPickingInfo(e);return r.index!==-1&&(r.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:r.index})),r}_updateAutoHighlight(e){const{highlightedObjectIndex:r}=this.state;let n=-1;if(e.index!==-1&&(n=e.index),r!==n){let{highlightColor:i}=this.props;typeof i=="function"&&(i=i(e)),this.setState({highlightColor:i,highlightedObjectIndex:n})}}}YC.layerName="RasterLayer";YC.defaultProps=Fxe;const Oxe={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class ZC{static read(e,r){return e.readFields(ZC._readField,{name:"",type:"",data:null},r)}static _readField(e,r,n){if(e===1)r.name=n.readString();else if(e===2)r.type=n.readString();else if(e===3){const i=Oxe[r.type];if(!i)throw Error(`Invalid data type: ${r.type}`);r.data={};const{compression:o}=ix;Ty(i,n,r.data,{compression:o})}}}let ix=class yk{static read(e,r){return e.readFields(yk._readField,{blockSize:0,bands:[]},r)}static _readField(e,r,n){e===1?r.blockSize=n.readVarint():e===2&&r.bands.push(ZC.read(n,n.readVarint()+n.pos))}};const vk="9.1.13",bk="cartoRasterTile",Lxe={cartoRasterTile:{metadata:null,workerUrl:Cy(bk,vk)}},Nxe={name:"CARTO Raster Tile",version:vk,id:bk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(t,e)=>XF(t,e),parseSync:XF,worker:!0,options:Lxe};function XF(t,e){const r=e?.cartoRasterTile?.metadata;if(!t||!r)return null;ix.compression=r.compression;const n=Ey(t,ix),{bands:i,blockSize:o}=n,s={};for(let u=0;u<i.length;u++){const{name:d,data:y}=i[u];s[d]=y}return{blockSize:o,cells:{numericProps:s,properties:[]}}}Ag([Nxe]);const kxe=t=>{const e=t.tile?.index?.q;return e?new YC(t,{tileIndex:e}):null},Uxe={data:Xf,refinementStrategy:"no-overlap",tileSize:IA};class zxe extends dk(Ul,vxe){filterSubLayer(e){const{tile:r}=e.layer.props;return r?super.filterSubLayer(e):!0}}class QC extends gs{getLoadOptions(){const e=this.props.data;return MA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:r,minzoom:n,maxzoom:i,raster_metadata:o}=e,s=this.getSubLayerClass("tile",zxe),u=this.getLoadOptions();return new s(this.props,{id:`raster-tile-layer-${this.props.id}`,data:r,TilesetClass:kC,renderSubLayers:kxe,minZoom:n,maxZoom:i,loadOptions:{...u,cartoRasterTile:{...u?.cartoRasterTile,metadata:o}}})}}QC.layerName="RasterTileLayer";QC.defaultProps=Uxe;class eT{static read(e,r){return e.readFields(eT._readField,{properties:[],numericProps:{}},r)}static _readField(e,r,n){if(e===1)r.properties.push(ah.read(n,n.readVarint()+n.pos));else if(e===2){const i=ch.read(n,n.readVarint()+n.pos);r.numericProps[i.key]=i.value}}}const xk="9.1.13",wk="cartoPropertiesTile",Gxe={cartoPropertiesTile:{workerUrl:Cy(wk,xk)}},Vxe={name:"CARTO Properties Tile",version:xk,id:wk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(t,e)=>KF(t),parseSync:KF,options:Gxe};function KF(t,e){return t?Ey(t,eT):null}const Ck="9.1.13",Tk="cartoVectorTile",Hxe={cartoVectorTile:{workerUrl:Cy(Tk,Ck)}},jxe={name:"CARTO Vector Tile",version:Ck,id:Tk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(t,e)=>qF(t),parseSync:qF,worker:!0,options:Hxe};function $xe(t,e,{startPosition:r,endPosition:n,indices:i}){const o=t.positions.size,s=r*o,u=n*o,d=t.positions.value.subarray(s,u),y=i.slice(1).map(E=>E-r),x=v6(d,y,o);for(let E=0,S=x.length;E<S;++E)e.push(r+x[E])}function Wxe(t){const{polygonIndices:e,primitivePolygonIndices:r}=t,n=[];let i=0;for(let o=0;o<e.value.length-1;o++){const s=e.value[o],u=e.value[o+1],d=r.value.indexOf(u),y=r.value.subarray(i,d);i=d,$xe(t,n,{startPosition:s,endPosition:u,indices:y})}t.triangles={value:new Uint32Array(n),size:1}}function qF(t,e){if(!t)return null;const r=Ey(t,ixe);return r.polygons&&!r.polygons.triangles&&Wxe(r.polygons),r}function Jxe(t,e){const r=e?e in t.numericProps:!1,n=new Map;for(let x=0;x<t.pathIndices.value.length-1;x++){const E=t.pathIndices.value[x],S=t.featureIds.value[E];let O;e===void 0?O=S:r?O=t.numericProps[e].value[E]:t.properties[S]&&e in t.properties[S]?O=t.properties[S][e]:O=void 0;const k=ewe(t,x);(!n.has(O)||k>n.get(O).length)&&n.set(O,{index:x,length:k})}const i=[],o=[],s=[],u=[],d=Q8(n.size,t.numericProps);let y=0;for(const[x,{index:E}]of n){const S=twe(t,E);i.push(...S);const O=t.pathIndices.value[E],k=t.featureIds.value[O];s.push(y),o.push(t.properties[k]),u.push(t.globalFeatureIds.value[O]),ek(t.numericProps,d,O,y),y++}return NC(i,s,u,d,o)}function Xxe(t,e,r){const{west:n,south:i,east:o,north:s}=e,d=(o-n)*(s-i)*1e-4,y=[],x=[],E=[],S=[],O=Q8(t.polygonIndices.value.length-1,t.numericProps);let k=0,U=0;const{extruded:J}=r;for(let G=0;G<t.polygonIndices.value.length-1;G++){const H=t.polygonIndices.value[G],K=t.polygonIndices.value[G+1];if(Kxe(t,G)<d)continue;const he=Zxe(t,G);let Y=-1,oe=[0,0],Ee=!1;for(;U<t.triangles.value.length;){const de=t.triangles.value[U];if(de>=K)break;if(Ee){U+=3;continue}const ve=t.triangles.value[U+1],Ae=t.triangles.value[U+2],$=t.positions.value.subarray(de*t.positions.size,de*t.positions.size+t.positions.size),re=t.positions.value.subarray(ve*t.positions.size,ve*t.positions.size+t.positions.size),Te=t.positions.value.subarray(Ae*t.positions.size,Ae*t.positions.size+t.positions.size);if(Yxe(he,$,re,Te))Ee=!0;else{const Qe=Ek($,re,Te);Qe>Y&&(Y=Qe,oe=[($[0]+re[0]+Te[0])/3,($[1]+re[1]+Te[1])/3])}U+=3}const ze=Ee?he:oe;if(qxe(ze,e)){y.push(...ze);const de=t.featureIds.value[H];if(J){const ve=r.getElevation(void 0,{data:t,index:de});y.push(ve*r.elevationScale)}x.push(t.properties[de]),E.push(k),S.push(t.globalFeatureIds.value[H]),ek(t.numericProps,O,H,k),k++}}return t.numericProps&&Object.keys(O).forEach(G=>{O[G].value=O[G].value.slice(0,k)}),NC(y,E,S,O,x,J?3:2)}function Kxe(t,e){const{positions:{value:r,size:n},polygonIndices:{value:i},triangles:{value:o}}=t,s=i[e],u=i[e+1];let d=0,y=0;for(;y<o.length&&!(o[y]>=s);)y+=3;for(;y<o.length;){const x=o[y];if(x>=u)break;const E=o[y+1],S=o[y+2],O=r.subarray(x*n,x*n+n),k=r.subarray(E*n,E*n+n),U=r.subarray(S*n,S*n+n);d+=Ek(O,k,U),y+=3}return d}function qxe([t,e],{west:r,east:n,south:i,north:o}){return t>=r&&t<n&&e>=i&&e<o}function Yxe(t,e,r,n){const i=Math.abs((r[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(r[1]-e[1]))/2,o=Math.abs((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]))/2,s=Math.abs((r[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(r[1]-t[1]))/2,u=Math.abs((n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1]))/2;return Math.abs(i-(o+s+u))<1e-10}function Ek([t,e],[r,n],[i,o]){return Math.abs((t*(n-o)+r*(o-e)+i*(e-n))/2)}function Zxe(t,e){const{positions:{value:r,size:n}}=t,i=n*t.polygonIndices.value[e],o=n*t.polygonIndices.value[e+1];let s=1/0,u=1/0,d=-1/0,y=-1/0;for(let x=i;x<o;x+=n){const[E,S]=r.subarray(x,x+2);s=Math.min(s,E),u=Math.min(u,S),d=Math.max(d,E),y=Math.max(y,S)}return[(s+d)/2,(u+y)/2]}function Qxe(t,e){const{positions:{value:r}}=t,[n,i,o,s]=r.subarray(e,e+4);return Math.sqrt(Math.pow(o-n,2)+Math.pow(s-i,2))}function ewe(t,e){const{positions:{size:r}}=t,n=r*t.pathIndices.value[e],i=r*t.pathIndices.value[e+1];let o=0;for(let s=n;s<i;s+=r)o+=Qxe(t,s);return o}function twe(t,e){const{positions:{value:r},pathIndices:{value:n}}=t,i=n[e]*2,s=(n[e+1]*2-i)/2;if(s===2){const[d,y,x,E]=r.subarray(i,i+4);return[(d+x)/2,(y+E)/2]}const u=i+Math.floor(s/2)*2;return[r[u],r[u+1]]}Ag([Vxe,jxe]);const rwe={...EA.defaultProps,autoLabels:!1,data:Xf,dataComparator:Xf.equal,tileSize:IA};class tT extends EA{constructor(...e){super(...e)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(e){const{props:r}=e;if(r.data){super.updateState(e);const i=new URL(r.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:i})}}getLoadOptions(){const e=this.props.data;return MA(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},gis:{format:"binary"}})}async getTileData(e){const r=this.props.data,{tiles:n,properties_tiles:i}=r,o=$f(n,e);if(!o)return Promise.reject("Invalid URL");const s=this.getLoadOptions(),{fetch:u}=this.props,{signal:d}=e,y=u(o,{propName:"data",layer:this,loadOptions:s,signal:d});if(!i)return await y;const x=$f(i,e);if(!x)return Promise.reject("Invalid properties URL");const E=u(x,{propName:"data",layer:this,loadOptions:s,signal:d}),[S,O]=await Promise.all([y,E]);return S?O?cxe(S,O):S:null}renderSubLayers(e){if(e.data===null)return null;const r=e.tile.bbox,n=[],i={"points-text":{type:Iy,...e?._subLayerProps?.["points-text"],extensions:[new EC,...e.extensions||[],...e?._subLayerProps?.["points-text"]?.extensions||[]]}};if(this.state.mvt)n.push(super.renderSubLayers(e));else{const{west:o,south:s,east:u,north:d}=r,y=[new yy,...e.extensions||[]],x={clipBounds:[o,s,u,d]},E=O=>({[O]:{...x,...e?._subLayerProps?.[O],extensions:[...y,...e?._subLayerProps?.[O]?.extensions||[]]}}),S={...e,data:{...e.data,tileBbox:r},autoHighlight:!1,_subLayerProps:{...e._subLayerProps,...i,...E("polygons-fill"),...E("polygons-stroke"),...E("linestrings")}};n.push(new Nl(S))}if(n[0]&&e.autoLabels){const o=Z8();e.data.lines&&e.data.lines.positions.value.length>0&&(o.points=Jxe(e.data.lines,typeof e.autoLabels=="object"?e.autoLabels.uniqueIdProperty:void 0)),e.data.polygons&&e.data.polygons.positions.value.length>0&&(o.points=Xxe(e.data.polygons,r,e)),n.push(n[0].clone({id:`${e.id}-labels`,data:o,pickable:!1,autoHighlight:!1}))}return n}renderLayers(){const e=super.renderLayers();if(!this.props.autoLabels)return e;const r=e.flat().filter(Boolean);return r.sort((n,i)=>{const o=n.id.includes("labels"),s=i.id.includes("labels");return o&&!s?1:!o&&s?-1:0}),r.map(n=>n.id.includes("labels")?n.clone({highlightedObjectIndex:-1}):n)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}tT.layerName="VectorTileLayer";tT.defaultProps=rwe;var Tn={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},nwe={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},iwe={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},swe={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},owe={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},awe={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},cwe={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},lwe={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},uwe={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},fwe={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},hwe={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},dwe={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},Awe={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},pwe={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},gwe={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},mwe={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},_we={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},ywe={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},vwe={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},bwe={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},xwe={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},wwe={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},Cwe={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},Twe={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Ewe={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},Bwe={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},Swe={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},Iwe={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},Mwe={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},Pwe={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},Rwe={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},Fwe={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},Dwe={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},Owe={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},Lwe={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},Nwe={...Tn.BuGn,tags:["quantitative"]},kwe={...Tn.BuPu,tags:["quantitative"]},Uwe={...Tn.GnBu,tags:["quantitative"]},zwe={...Tn.OrRd,tags:["quantitative"]},Gwe={...Tn.PuBu,tags:["quantitative"]},Vwe={...Tn.PuBuGn,tags:["quantitative"]},Hwe={...Tn.PuRd,tags:["quantitative"]},jwe={...Tn.RdPu,tags:["quantitative"]},$we={...Tn.YlGn,tags:["quantitative"]},Wwe={...Tn.YlGnBu,tags:["quantitative"]},Jwe={...Tn.YlOrBr,tags:["quantitative"]},Xwe={...Tn.YlOrRd,tags:["quantitative"]},Kwe={...Tn.Accent,tags:["qualitative"]},qwe={...Tn.Dark2,tags:["qualitative"]},Ywe={...Tn.Paired,tags:["qualitative"]},Zwe={...Tn.Pastel1,tags:["qualitative"]},Qwe={...Tn.Pastel2,tags:["qualitative"]},eCe={...Tn.Set1,tags:["qualitative"]},tCe={...Tn.Set2,tags:["qualitative"]},rCe={...Tn.Set3,tags:["qualitative"]},nCe={...Tn.Blues,tags:["quantitative"]},iCe={...Tn.Greens,tags:["quantitative"]},sCe={...Tn.Greys,tags:["quantitative"]},oCe={...Tn.Oranges,tags:["quantitative"]},aCe={...Tn.Purples,tags:["quantitative"]},cCe={...Tn.Reds,tags:["quantitative"]},lCe={...Tn.BrBG,tags:["diverging"]},uCe={...Tn.PiYG,tags:["diverging"]},fCe={...Tn.PRGn,tags:["diverging"]},hCe={...Tn.PuOr,tags:["diverging"]},dCe={...Tn.RdBu,tags:["diverging"]},ACe={...Tn.RdGy,tags:["diverging"]},pCe={...Tn.RdYlBu,tags:["diverging"]},gCe={...Tn.RdYlGn,tags:["diverging"]},mCe={...Tn.Spectral,tags:["diverging"]};const _Ce=Object.freeze(Object.defineProperty({__proto__:null,Antique:Pwe,ArmyRose:Cwe,BluGrn:uwe,BluYl:Awe,Bold:Rwe,BrwnYl:wwe,Burg:nwe,BurgYl:iwe,DarkMint:fwe,Earth:Mwe,Emrld:hwe,Fall:Twe,Geyser:Ewe,Magenta:vwe,Mint:lwe,OrYel:owe,Pastel:Fwe,Peach:awe,PinkYl:cwe,Prism:Dwe,Purp:mwe,PurpOr:_we,RedOr:swe,Safe:Owe,Sunset:ywe,SunsetDark:bwe,Teal:pwe,TealGrn:gwe,TealRose:Swe,Temps:Bwe,Tropic:Iwe,Vivid:Lwe,ag_GrnYl:dwe,ag_Sunset:xwe,cb_Accent:Kwe,cb_Blues:nCe,cb_BrBG:lCe,cb_BuGn:Nwe,cb_BuPu:kwe,cb_Dark2:qwe,cb_GnBu:Uwe,cb_Greens:iCe,cb_Greys:sCe,cb_OrRd:zwe,cb_Oranges:oCe,cb_PRGn:fCe,cb_Paired:Ywe,cb_Pastel1:Zwe,cb_Pastel2:Qwe,cb_PiYG:uCe,cb_PuBu:Gwe,cb_PuBuGn:Vwe,cb_PuOr:hCe,cb_PuRd:Hwe,cb_Purples:aCe,cb_RdBu:dCe,cb_RdGy:ACe,cb_RdPu:jwe,cb_RdYlBu:pCe,cb_RdYlGn:gCe,cb_Reds:cCe,cb_Set1:eCe,cb_Set2:tCe,cb_Set3:rCe,cb_Spectral:mCe,cb_YlGn:$we,cb_YlGnBu:Wwe,cb_YlOrBr:Jwe,cb_YlOrRd:Xwe},Symbol.toStringTag,{value:"Module"})),rT="PurpOr",nT=[204,204,204],yCe=[119,119,119];function iT(t,e){const r=_Ce[t];let n=e;Jf(r,`Palette "${t}" not found. Expected a CARTOColors string`);const i=Object.keys(r).filter(d=>d!=="tags").map(Number),o=Math.max(...i),s=Math.min(...i);!Number.isInteger(e)||e>o?n=o:e<s&&(n=s);let u=r[n];return r.tags&&r.tags.includes("qualitative")&&(u=u.slice(0,-1)),u.map(d=>vCe(d))}function vCe(t){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t);return e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255]:(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),Jf(e,`Hexadecimal color "${t}" was not parsed correctly`),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)])))}const bCe=Object.freeze(["function","string"]);function sT(t,e,r){return Jf(typeof e=="object",'Expected "data" to be an object'),Jf(bCe.includes(typeof t),'Expected "attr" to be a function or string'),typeof t=="function"?t(e,r):e?.properties?.[t]}function xCe({attr:t,domain:e,colors:r=rT,nullColor:n=nT}){Jf(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof r=="string"?iT(r,e.length+1):r,o=bU().domain(e).range(i);return(s,u)=>{const d=sT(t,s,u);return typeof d=="number"&&Number.isFinite(d)?o(d):n}}function wCe({attr:t,domain:e,colors:r=rT,nullColor:n=nT,othersColor:i=yCe}){Jf(Array.isArray(e),'Expected "domain" to be an array of numbers or strings');const o={},s=typeof r=="string"?iT(r,e.length):r;for(const[u,d]of e.entries())o[d]=s[u];return(u,d)=>{const y=sT(t,u,d);return typeof y=="number"&&Number.isFinite(y)||typeof y=="string"?o[y]||i:n}}function CCe({attr:t,domain:e,colors:r=rT,nullColor:n=nT}){Jf(Array.isArray(e),'Expected "domain" to be an array of numbers');const i=typeof r=="string"?iT(r,e.length):r,o=xU().domain(e).range(i);return(s,u)=>{const d=sT(t,s,u);return typeof d=="number"&&Number.isFinite(d)?o(d):n}}const TCe={ClusterTileLayer:JC,H3TileLayer:XC,HeatmapTileLayer:qC,PointLabelLayer:Iy,QuadbinTileLayer:Sy,RasterTileLayer:QC,VectorTileLayer:tT};function sx(t,e=""){if(!t)throw new Error(`JSON conversion error ${e}`)}function ECe(t,e){const r=SCe(e);let n=t;for(const i of r)n=BCe(n)?n[i]:void 0;return n}function BCe(t){return t!==null&&typeof t=="object"}const YF={};function SCe(t){if(typeof t=="string"){let e=YF[t];return e||(e=t.split("."),YF[t]=e),e}return Array.isArray(t)?t:[t]}var lm={exports:{}},ZF;function ICe(){return ZF||(ZF=1,function(t,e){(function(r){var n="Compound",i="Identifier",o="MemberExpression",s="Literal",u="ThisExpression",d="CallExpression",y="UnaryExpression",x="BinaryExpression",E="LogicalExpression",S="ConditionalExpression",O="ArrayExpression",k=46,U=44,J=39,G=34,H=40,K=41,he=91,Y=93,oe=63,Ee=59,ze=58,de=function(Tt,nt){var lr=new Error(Tt+" at character "+nt);throw lr.index=nt,lr.description=Tt,lr},ve=!0,Ae={"-":ve,"!":ve,"~":ve,"+":ve},$={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},re=function(Tt){var nt=0,lr;for(var qt in Tt)(lr=qt.length)>nt&&Tt.hasOwnProperty(qt)&&(nt=lr);return nt},Te=re(Ae),Qe=re($),me={true:!0,false:!1,null:null},Le="this",Ue=function(Tt){return $[Tt]||0},Ye=function(Tt,nt,lr){var qt=Tt==="||"||Tt==="&&"?E:x;return{type:qt,operator:Tt,left:nt,right:lr}},et=function(Tt){return Tt>=48&&Tt<=57},tt=function(Tt){return Tt===36||Tt===95||Tt>=65&&Tt<=90||Tt>=97&&Tt<=122||Tt>=128&&!$[String.fromCharCode(Tt)]},ct=function(Tt){return Tt===36||Tt===95||Tt>=65&&Tt<=90||Tt>=97&&Tt<=122||Tt>=48&&Tt<=57||Tt>=128&&!$[String.fromCharCode(Tt)]},mt=function(Tt){for(var nt=0,lr=Tt.charAt,qt=Tt.charCodeAt,$t=function(kt){return lr.call(Tt,kt)},Ot=function(kt){return qt.call(Tt,kt)},fr=Tt.length,rn=function(){for(var kt=Ot(nt);kt===32||kt===9||kt===10||kt===13;)kt=Ot(++nt)},Er=function(){var kt=Ln(),hr,Br;if(rn(),Ot(nt)===oe){if(nt++,hr=Er(),hr||de("Expected expression",nt),rn(),Ot(nt)===ze)return nt++,Br=Er(),Br||de("Expected expression",nt),{type:S,test:kt,consequent:hr,alternate:Br};de("Expected :",nt)}else return kt},mr=function(){rn();for(var kt=Tt.substr(nt,Qe),hr=kt.length;hr>0;){if($.hasOwnProperty(kt)&&(!tt(Ot(nt))||nt+kt.length<Tt.length&&!ct(Ot(nt+kt.length))))return nt+=hr,kt;kt=kt.substr(0,--hr)}return!1},Ln=function(){var kt,hr,Br,Zr,ui,Me,Dt,Gt,sr;if(Me=dr(),hr=mr(),!hr)return Me;for(ui={value:hr,prec:Ue(hr)},Dt=dr(),Dt||de("Expected expression after "+hr,nt),Zr=[Me,ui,Dt];(hr=mr())&&(Br=Ue(hr),Br!==0);){for(ui={value:hr,prec:Br},sr=hr;Zr.length>2&&Br<=Zr[Zr.length-2].prec;)Dt=Zr.pop(),hr=Zr.pop().value,Me=Zr.pop(),kt=Ye(hr,Me,Dt),Zr.push(kt);kt=dr(),kt||de("Expected expression after "+sr,nt),Zr.push(ui,kt)}for(Gt=Zr.length-1,kt=Zr[Gt];Gt>1;)kt=Ye(Zr[Gt-1].value,Zr[Gt-2],kt),Gt-=2;return kt},dr=function(){var kt,hr,Br;if(rn(),kt=Ot(nt),et(kt)||kt===k)return Ar();if(kt===J||kt===G)return nn();if(kt===he)return Jn();for(hr=Tt.substr(nt,Te),Br=hr.length;Br>0;){if(Ae.hasOwnProperty(hr)&&(!tt(Ot(nt))||nt+hr.length<Tt.length&&!ct(Ot(nt+hr.length))))return nt+=Br,{type:y,operator:hr,argument:dr(),prefix:!0};hr=hr.substr(0,--Br)}return tt(kt)||kt===H?jn():!1},Ar=function(){for(var kt="",hr,Br;et(Ot(nt));)kt+=$t(nt++);if(Ot(nt)===k)for(kt+=$t(nt++);et(Ot(nt));)kt+=$t(nt++);if(hr=$t(nt),hr==="e"||hr==="E"){for(kt+=$t(nt++),hr=$t(nt),(hr==="+"||hr==="-")&&(kt+=$t(nt++));et(Ot(nt));)kt+=$t(nt++);et(Ot(nt-1))||de("Expected exponent ("+kt+$t(nt)+")",nt)}return Br=Ot(nt),tt(Br)?de("Variable names cannot start with a number ("+kt+$t(nt)+")",nt):Br===k&&de("Unexpected period",nt),{type:s,value:parseFloat(kt),raw:kt}},nn=function(){for(var kt="",hr=$t(nt++),Br=!1,Zr;nt<fr;)if(Zr=$t(nt++),Zr===hr){Br=!0;break}else if(Zr==="\\")switch(Zr=$t(nt++),Zr){case"n":kt+=`
`;break;case"r":kt+="\r";break;case"t":kt+="	";break;case"b":kt+="\b";break;case"f":kt+="\f";break;case"v":kt+="\v";break;default:kt+=Zr}else kt+=Zr;return Br||de('Unclosed quote after "'+kt+'"',nt),{type:s,value:kt,raw:hr+kt+hr}},Ir=function(){var kt=Ot(nt),hr=nt,Br;for(tt(kt)?nt++:de("Unexpected "+$t(nt),nt);nt<fr&&(kt=Ot(nt),ct(kt));)nt++;return Br=Tt.slice(hr,nt),me.hasOwnProperty(Br)?{type:s,value:me[Br],raw:Br}:Br===Le?{type:u}:{type:i,name:Br}},ei=function(kt){for(var hr,Br=[],Zr,ui=!1,Me=0;nt<fr;)if(rn(),hr=Ot(nt),hr===kt){ui=!0,nt++,kt===K&&Me&&Me>=Br.length&&de("Unexpected token "+String.fromCharCode(kt),nt);break}else if(hr===U){if(nt++,Me++,Me!==Br.length){if(kt===K)de("Unexpected token ,",nt);else if(kt===Y)for(var Dt=Br.length;Dt<Me;Dt++)Br.push(null)}}else Zr=Er(),(!Zr||Zr.type===n)&&de("Expected comma",nt),Br.push(Zr);return ui||de("Expected "+String.fromCharCode(kt),nt),Br},jn=function(){var kt,hr;for(kt=Ot(nt),kt===H?hr=fn():hr=Ir(),rn(),kt=Ot(nt);kt===k||kt===he||kt===H;)nt++,kt===k?(rn(),hr={type:o,computed:!1,object:hr,property:Ir()}):kt===he?(hr={type:o,computed:!0,object:hr,property:Er()},rn(),kt=Ot(nt),kt!==Y&&de("Unclosed [",nt),nt++):kt===H&&(hr={type:d,arguments:ei(K),callee:hr}),rn(),kt=Ot(nt);return hr},fn=function(){nt++;var kt=Er();if(rn(),Ot(nt)===K)return nt++,kt;de("Unclosed (",nt)},Jn=function(){return nt++,{type:O,elements:ei(Y)}},Nn=[],bn,$n;nt<fr;)bn=Ot(nt),bn===Ee||bn===U?nt++:($n=Er())?Nn.push($n):nt<fr&&de('Unexpected "'+$t(nt)+'"',nt);return Nn.length===1?Nn[0]:{type:n,body:Nn}};mt.version="0.3.5",mt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+mt.version},mt.addUnaryOp=function(Tt){return Te=Math.max(Tt.length,Te),Ae[Tt]=ve,this},mt.addBinaryOp=function(Tt,nt){return Qe=Math.max(Tt.length,Qe),$[Tt]=nt,this},mt.addLiteral=function(Tt,nt){return me[Tt]=nt,this},mt.removeUnaryOp=function(Tt){return delete Ae[Tt],Tt.length===Te&&(Te=re(Ae)),this},mt.removeAllUnaryOps=function(){return Ae={},Te=0,this},mt.removeBinaryOp=function(Tt){return delete $[Tt],Tt.length===Qe&&(Qe=re($)),this},mt.removeAllBinaryOps=function(){return $={},Qe=0,this},mt.removeLiteral=function(Tt){return delete me[Tt],this},mt.removeAllLiterals=function(){return me={},this},t.exports?e=t.exports=mt:e.parse=mt})()}(lm,lm.exports)),lm.exports}var MCe=ICe();const PCe=Kf(MCe),QF={"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"&":(t,e)=>t&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},RCe={"-":t=>-t,"+":t=>+t,"~":t=>~t,"!":t=>!t};function eD(t,e){return t.map(function(r){return ks(r,e)})}function tD(t,e){const r=ks(t.object,e);let n;if(t.computed?n=ks(t.property,e):n=t.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[r,r[n]]}function ks(t,e){const r=t;switch(r.type){case"ArrayExpression":return eD(r.elements,e);case"BinaryExpression":return QF[r.operator](ks(r.left,e),ks(r.right,e));case"CallExpression":let n,i,o;return r.callee.type==="MemberExpression"?(o=tD(r.callee,e),n=o[0],i=o[1]):i=ks(r.callee,e),typeof i!="function"?void 0:i.apply(n,eD(r.arguments,e));case"ConditionalExpression":return ks(r.test,e)?ks(r.consequent,e):ks(r.alternate,e);case"Identifier":return e[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?ks(r.left,e)||ks(r.right,e):r.operator==="&&"?ks(r.left,e)&&ks(r.right,e):QF[r.operator](ks(r.left,e),ks(r.right,e));case"MemberExpression":return tD(r,e)[1];case"ThisExpression":return e;case"UnaryExpression":return RCe[r.operator](ks(r.argument,e));default:return}}const w1={"-":t=>t};function Bk(t,e){if(t in w1)return w1[t];let r;const n=PCe(t);return n.type==="Identifier"?r=i=>ECe(i,t):(ox(n,i=>{if(i.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=i=>ks(n,i)),w1[t]=r,r}function ox(t,e){if(Array.isArray(t))t.forEach(r=>ox(r,e));else if(t&&typeof t=="object"){t.type&&e(t);for(const r in t)ox(t[r],e)}}const B_="@@=",rD="@@#",FCe="@@type",Sk="@@function",nD=t=>t&&typeof t=="object";class ax{constructor(...e){this.typeKey=FCe,this.functionKey=Sk,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=Bk,this.preProcessClassProps=(r,n)=>n,this.postProcessConvertedJson=r=>r;for(const r of e)this.merge(r)}merge(e){for(const r in e)switch(r){case"layers":case"views":Object.assign(this.classes,e[r]);break;default:if(r in this){const n=e[r];this[r]=nD(this[r])?Object.assign(this[r],n):n}}}validate(e){return sx(!this.typeKey||typeof this.typeKey=="string"),sx(nD(this.classes)),!0}}function DCe(t){return typeof t=="string"&&t.startsWith(B_)}function OCe(t){return t.replace(B_,"")}function Ik(t,e){const r={};for(const n in t){let i=t[n];DCe(i)&&(i=OCe(i),i=Bk(i)),r[n]=i}return r}function LCe(t,e,r){const n=r.classes[t],i=r.reactComponents[t];if(!n&&!i){const{log:o}=r;if(o){const s=JSON.stringify(e,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${t}(${s}...)  `)}return null}return n?NCe(n,e,r):kCe(i,e,r)}function NCe(t,e,r){return r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Ik(e),new t(e)}function kCe(t,e,r){const{React:n}=r,{children:i=[]}=e;return delete e.children,r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Ik(e),n.createElement(t,e,i)}function UCe(t,e,r){const n=r.functions[t];if(!n){const{log:i}=r;if(i){const o=JSON.stringify(e,null,0).slice(0,40);i.warn(`JSON converter: No registered function ${t}(${o}...)  `)}return null}return n(e)}function zCe(t){return typeof t=="string"?JSON.parse(t):t}const oT=t=>t&&typeof t=="object";class GCe{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof ax?e.configuration:new ax(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;const r=zCe(e);let n=VCe(r,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(e){return this.convert(e)}}function VCe(t,e){return e=new ax(e),aT(t,"",e)}function aT(t,e,r){return Array.isArray(t)?t.map((n,i)=>aT(n,String(i),r)):HCe(t,r)?jCe(t,r):oT(t)?Sk in t?$Ce(t,r):cT(t,r):typeof t=="string"?WCe(t,e,r):t}function HCe(t,e){const{typeKey:r}=e;return oT(t)&&!!t[r]}function jCe(t,e){const{typeKey:r}=e,n=t[r];let i={...t};return delete i[r],i=cT(i,e),LCe(n,i,e)}function $Ce(t,e){const{functionKey:r}=e,n=t[r];let i={...t};return delete i[r],i=cT(i,e),UCe(n,i,e)}function cT(t,e){sx(oT(t));const r={};for(const n in t){const i=t[n];r[n]=aT(i,n,e)}return r}function WCe(t,e,r){if(t.startsWith(B_)&&r.convertFunction)return t=t.replace(B_,""),r.convertFunction(t,r);if(t.startsWith(rD)){if(t=t.replace(rD,""),r.constants[t])return r.constants[t];const[n,i]=t.split(".");return r.enumerations[n][i]}return t}const JCe={classes:{...yle,...U2e,...d1e,...c0e,...TCe},functions:{colorBins:xCe,colorCategories:wCe,colorContinuous:CCe}},Mk=new GCe({configuration:JCe}),XCe={[vy.layerName]:["getFillColor"],[ly.layerName]:["getFillColor"],[Zc.layerName]:["getFillColor"],[EA.layerName]:["getFillColor"],[ny.layerName]:["getFillColor"],[ry.layerName]:["getFillColor"],[oy.layerName]:["getColor"],[yg.layerName]:["getTargetColor","getSourceColor"],[Yc.layerName]:["getFillColor"],[Nl.layerName]:["getFillColor"],[TA.layerName]:["getColor"],[Z_.layerName]:["getColor"],[zu.layerName]:["getColor"],[vg.layerName]:["getColor"],[Vu.layerName]:["getFillColor"],[bg.layerName]:["getFillColor","getColor","getLineColor"],[Gu.layerName]:["getFillColor"],[ih.layerName]:["getColor"],[Sg.layerName]:["getColor"],[Wf.layerName]:["getColor"]},KCe=({object:t,objectInfo:e,originalFillFunction:r})=>{const n=typeof r=="function"?r(t,e):r;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const i=Mk.convert({originalColor:n}).originalColor(t);return[i[0]||0,i[1]||0,i[2]||0,i[3]||255]}return null},iD=({isSelected:t,object:e,objectInfo:r,opacity:n,originalFillFunction:i})=>{const o=KCe({object:e,objectInfo:r,originalFillFunction:i});if(!o)return null;let s=0;return t?s=Math.max(typeof o[3]=="number"?o[3]:n,n):s=Math.min(typeof o[3]=="number"?o[3]:n,n),[o[0]||0,o[1]||0,o[2]||0,s]},qCe=({isSelected:t,object:e,objectInfo:r,originalFillFunction:n,selectedColor:i,selectedOpacity:o=255,unselectedColor:s,unselectedOpacity:u=Math.floor(255*.4)})=>t?iD({opacity:o,isSelected:!0,object:e,objectInfo:r,originalFillFunction:n})||i:iD({opacity:u,isSelected:!1,object:e,objectInfo:r,originalFillFunction:n})||s,lg={selection:{indices:{},objects:{}}},sD=(t,e)=>{const r=e.match(/{(.*?)}/g);return r&&r.forEach(n=>{const i=n.substring(1,n.length-1);Object.hasOwn(t.object,i)?e=e.replace(n,t.object[i]):Object.hasOwn(t.object,"properties")&&Object.hasOwn(t.object.properties,i)&&(e=e.replace(n,t.object.properties[i]))}),e};function YCe(t,e){return e.id?t.getElementState(e.id,"selection")??lg:lg}function ZCe(t,e){if(!e.id)return lg;const r=t.getStringValue(e);return(r?T1.parse(r):null)??lg}function QCe(t,e,r,n){t.id&&e.setStringValue(t,JSON.stringify(r.value),{fromUi:r.fromUi},n)}const eTe=t=>{const{height:e,width:r,expanded:n}=lD(uD),{element:i,fragmentId:o,isLightTheme:s,theme:u,widgetMgr:d}=t,{selectionMode:y,tooltip:x,useContainerWidth:E}=i,S=n??!1,[O,k]=vU({element:i,getDefaultState:YCe,getStateFromWidgetMgr:ZCe,updateWidgetMgrState:QCe,widgetMgr:d,fragmentId:o}),[U,J]=Et.useState(null),{height:G,width:H}=sae({element:i,isFullScreen:S,shouldUseContainerWidth:E,container:{height:e,width:r},heightFallback:U?.initialViewState?.height||u.sizes.defaultMapHeight}),[K,he]=Et.useState(null),Y=y[0],oe=Y!==void 0,Ee=oe&&Object.keys(O.selection.indices).length>0,ze=Et.useMemo(()=>Object.freeze(T1.parse(i.json)),[S,s,i.json]),de=Et.useMemo(()=>{const $={...ze};if($.mapStyle||($.mapStyle=s?"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json":"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"),($?.mapProvider=="carto"||$?.mapStyle&&$.mapStyle?.indexOf("cartocdn")>=0)&&!$.cartoKey&&($.cartoKey="x7g2plm9yq8vfrc"),$.layers){const Te=Object.values(O.selection.indices).some(me=>me?.length),Qe=$.layers.some(me=>Object.hasOwn(me,"pickable"));$.layers=$.layers.map(me=>{if(!me||Array.isArray(me)||!oe)return me;Qe||(me.pickable=!0);const Le=`${me.id||null}`,Ue=O?.selection?.indices?.[Le]||[],Ye=XCe[me["@@type"]];if(!Ye)return me;const et={...me};return Ye.forEach(tt=>{et.updateTriggers={[tt]:[...et.updateTriggers?.[tt]||[],Ue,Te]};const ct=!Te,mt=me[tt];if(ct||!mt)return et;const Tt=255,nt=Math.floor(255*.4),lr=IE(u.colors.primary),qt=[lr[0],lr[1],lr[2],Tt],$t=IE(u.colors.gray20),Ot=[$t[0],$t[1],$t[2],nt],fr=(rn,Er)=>qCe({isSelected:Ue.includes(Er.index),object:rn,objectInfo:Er,originalFillFunction:mt,selectedColor:qt,unselectedColor:Ot,selectedOpacity:Tt,unselectedOpacity:nt});et[tt]=fr}),et})}return delete $?.views,Mk.convert($)},[O.selection.indices,s,oe,ze,u.colors.gray20,u.colors.primary]);Et.useEffect(()=>{if(!fU(de.initialViewState,K)){const $=Object.keys(de.initialViewState).reduce((re,Te)=>de.initialViewState[Te]===K?.[Te]?re:{...re,[Te]:de.initialViewState[Te]},{});J(re=>({...re,...$})),he(de.initialViewState)}},[de.initialViewState,K,U]);const ve=Et.useCallback($=>{if(!$||!$.object||!x)return null;const re=T1.parse(x);return re.html?re.html=sD($,re.html):re.text=sD($,re.text),re},[x]),Ae=Et.useCallback(({viewState:$})=>{J($)},[J]);return{createTooltip:ve,data:O,deck:de,hasActiveSelection:Ee,height:G,isSelectionModeActivated:oe,onViewStateChange:Ae,selectionMode:Y,setSelection:k,viewState:U,width:H}};Ag([aw,m2]);const C1=lg.selection,tTe=[],rTe=t=>{const{disabled:e,disableFullscreenMode:r,element:n,fragmentId:i,widgetMgr:o}=t,{libConfig:s}=Et.useContext(hU),u=dU(),{expanded:d,expand:y,collapse:x}=lD(uD),{createTooltip:E,data:S,deck:O,hasActiveSelection:k,height:U,isSelectionModeActivated:J,onViewStateChange:G,selectionMode:H,setSelection:K,viewState:he,width:Y}=eTe({element:n,fragmentId:i,isLightTheme:cD(u),theme:u,widgetMgr:o}),oe=n.mapboxToken||s.mapboxToken,Ee=O.mapProvider=="mapbox"||O?.mapStyle&&O.mapStyle?.indexOf("mapbox")>=0,[ze,de]=Et.useState(!1);Et.useEffect(()=>{de(!0)},[]);const ve=Et.useCallback($=>{if(H===void 0)return;const{index:re,object:Te}=$,Qe=`${$.layer?.id||null}`,me=S,Le=re===-1,Ye=(()=>{if(Le)return C1;switch(H){case PE.SelectionMode.SINGLE_OBJECT:return me.selection.indices[Qe]?.[0]===re?C1:{indices:{[`${Qe}`]:[re]},objects:{[`${Qe}`]:[Te]}};case PE.SelectionMode.MULTI_OBJECT:{const et=new Map((me?.selection?.indices?.[Qe]||[]).map((ct,mt)=>[ct,me.selection?.objects?.[Qe]?.[mt]]));if(et.has(re)?et.delete(re):et.set(re,Te),et.size===0){const{[Qe]:tt,...ct}=me.selection.indices,{[Qe]:mt,...Tt}=me.selection.objects;return{indices:ct,objects:Tt}}return{indices:{...me.selection.indices,[`${Qe}`]:Array.from(et.keys())},objects:{...me.selection.objects,[`${Qe}`]:Array.from(et.values())}}}default:throw AU(H),new Error("Invalid selection mode")}})();JSON.stringify(Ye)!==JSON.stringify(me.selection)&&K({fromUi:!0,value:{selection:Ye}})},[H,S,K]),Ae=Et.useCallback(()=>{K({value:{selection:C1},fromUi:!0})},[K]);return ME(H3,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:U,children:[Ee?Cf(nae,{}):null,Cf(yU,{isFullScreen:d,disableFullscreenMode:r,onExpand:y,onCollapse:x,target:H3,locked:k&&!e?!0:void 0,children:k&&!e&&Cf(_U,{label:"Clear selection",onClick:Ae,icon:gU})}),he&&ME(DY,{viewState:he,onViewStateChange:G,height:U,width:Y,layers:ze?O.layers:tTe,getTooltip:E,ContextProvider:nh.Provider,controller:!0,onClick:J&&!e?ve:void 0,children:[Cf(Ll,{height:U,width:Y,mapStyle:O.mapStyle&&(typeof O.mapStyle=="string"?O.mapStyle:O.mapStyle[0]),mapboxApiAccessToken:oe}),Cf(iae,{children:Cf(Qoe,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},nTe=mU(rTe),aEe=Et.memo(nTe);export{aEe as default};
